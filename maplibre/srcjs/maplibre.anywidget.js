var pq=Object.create;var HE=Object.defineProperty;var Aq=Object.getOwnPropertyDescriptor;var mq=Object.getOwnPropertyNames;var gq=Object.getPrototypeOf,_q=Object.prototype.hasOwnProperty;var zB=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var io=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),no=(t,e)=>{for(var r in e)HE(t,r,{get:e[r],enumerable:!0})},yq=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of mq(e))!_q.call(t,n)&&n!==r&&HE(t,n,{get:()=>e[n],enumerable:!(i=Aq(e,n))||i.enumerable});return t};var yc=(t,e,r)=>(r=t!=null?pq(gq(t)):{},yq(e||!t||!t.__esModule?HE(r,"default",{value:t,enumerable:!0}):r,t));var qE=io((WE,$E)=>{(function(t,e){typeof WE=="object"&&typeof $E<"u"?$E.exports=e():typeof define=="function"&&define.amd?define(e):(t=typeof globalThis<"u"?globalThis:t||self,t.maplibregl=e())})(WE,function(){"use strict";var t={},e={};function r(n,o,a){if(e[n]=a,n==="index"){var c="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",h={};return e.shared(h),e.index(t,h),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([c],{type:"text/javascript"}))),t}}r("shared",["exports"],function(n){"use strict";function o(f,l,d,g){return new(d||(d=Promise))(function(w,I){function P(G){try{U(g.next(G))}catch($){I($)}}function D(G){try{U(g.throw(G))}catch($){I($)}}function U(G){var $;G.done?w(G.value):($=G.value,$ instanceof d?$:new d(function(Y){Y($)})).then(P,D)}U((g=g.apply(f,l||[])).next())})}function a(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var c,h;function p(){if(h)return c;function f(l,d){this.x=l,this.y=d}return h=1,c=f,f.prototype={clone:function(){return new f(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,d){return this.clone()._rotateAround(l,d)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var d=l.x-this.x,g=l.y-this.y;return d*d+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,d){return Math.atan2(this.x*d-this.y*l,this.x*l+this.y*d)},_matMult:function(l){var d=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=d,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var d=Math.cos(l),g=Math.sin(l),w=g*this.x+d*this.y;return this.x=d*this.x-g*this.y,this.y=w,this},_rotateAround:function(l,d){var g=Math.cos(l),w=Math.sin(l),I=d.y+w*(this.x-d.x)+g*(this.y-d.y);return this.x=d.x+g*(this.x-d.x)-w*(this.y-d.y),this.y=I,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},f.convert=function(l){return l instanceof f?l:Array.isArray(l)?new f(l[0],l[1]):l},c}typeof SuppressedError=="function"&&SuppressedError;var x,T,R=a(p()),k=function(){if(T)return x;function f(l,d,g,w){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(w-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=d,this.p2x=g,this.p2y=w}return T=1,x=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,d){if(d===void 0&&(d=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,w=0;w<8;w++){var I=this.sampleCurveX(g)-l;if(Math.abs(I)<d)return g;var P=this.sampleCurveDerivativeX(g);if(Math.abs(P)<1e-6)break;g-=I/P}var D=0,U=1;for(g=l,w=0;w<20&&(I=this.sampleCurveX(g),!(Math.abs(I-l)<d));w++)l>I?D=g:U=g,g=.5*(U-D)+D;return g},solve:function(l,d){return this.sampleCurveY(this.solveCurveX(l,d))}},x}(),j=a(k);let q,Z;function re(){return q==null&&(q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),q}function ee(){if(Z==null&&(Z=!1,re())){let l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let g=0;g<5*5;g++){let w=4*g;l.fillStyle=`rgb(${w},${w+1},${w+2})`,l.fillRect(g%5,Math.floor(g/5),1,1)}let d=l.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&d[g]!==g){Z=!0;break}}}return Z||!1}var se,me=1e-6,Le=typeof Float32Array<"u"?Float32Array:Array;function je(){var f=new Le(9);return Le!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f}function Je(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function J(){var f=new Le(3);return Le!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f}function te(f,l,d){var g=new Le(3);return g[0]=f,g[1]=l,g[2]=d,g}function X(f,l,d){var g=l[0],w=l[1],I=l[2],P=l[3];return f[0]=d[0]*g+d[4]*w+d[8]*I+d[12]*P,f[1]=d[1]*g+d[5]*w+d[9]*I+d[13]*P,f[2]=d[2]*g+d[6]*w+d[10]*I+d[14]*P,f[3]=d[3]*g+d[7]*w+d[11]*I+d[15]*P,f}function ye(){var f=new Le(4);return Le!=Float32Array&&(f[0]=0,f[1]=0,f[2]=0),f[3]=1,f}function _e(){var f=new Le(2);return Le!=Float32Array&&(f[0]=0,f[1]=0),f}function Oe(f,l){var d=new Le(2);return d[0]=f,d[1]=l,d}Math.hypot||(Math.hypot=function(){for(var f=0,l=arguments.length;l--;)f+=arguments[l]*arguments[l];return Math.sqrt(f)}),J(),se=new Le(4),Le!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0,se[3]=0),J(),te(1,0,0),te(0,1,0),ye(),ye(),je(),_e();let ve=8192;function De(f,l,d){return l*(ve/(f.tileSize*Math.pow(2,d-f.tileID.overscaledZ)))}function Xe(f,l){return(f%l+l)%l}function rt(f,l,d){return f*(1-d)+l*d}function tt(f){if(f<=0)return 0;if(f>=1)return 1;let l=f*f,d=l*f;return 4*(f<.5?d:3*(f-l)+d-.75)}function yt(f,l,d,g){let w=new j(f,l,d,g);return I=>w.solve(I)}let Xt=yt(.25,.1,.25,1);function jt(f,l,d){return Math.min(d,Math.max(l,f))}function fr(f,l,d){let g=d-l,w=((f-l)%g+g)%g+l;return w===l?d:w}function qt(f,...l){for(let d of l)for(let g in d)f[g]=d[g];return f}let Ot=1;function Tr(f,l,d){let g={};for(let w in f)g[w]=l.call(this,f[w],w,f);return g}function Or(f,l,d){let g={};for(let w in f)l.call(this,f[w],w,f)&&(g[w]=f[w]);return g}function Dr(f){return Array.isArray(f)?f.map(Dr):typeof f=="object"&&f?Tr(f,Dr):f}let Xr={};function ki(f){Xr[f]||(typeof console<"u"&&console.warn(f),Xr[f]=!0)}function ei(f,l,d){return(d.y-f.y)*(l.x-f.x)>(l.y-f.y)*(d.x-f.x)}function Oi(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let ui=null;function tn(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}let Ni="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function si(f,l,d,g,w){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let I=new VideoFrame(f,{timestamp:0});try{let P=I?.format;if(!P||!P.startsWith("BGR")&&!P.startsWith("RGB"))throw new Error(`Unrecognized format ${P}`);let D=P.startsWith("BGR"),U=new Uint8ClampedArray(g*w*4);if(yield I.copyTo(U,function(G,$,Y,oe,le){let ue=4*Math.max(1,0),pe=(Math.max(0,Y)-Y)*oe*4+ue,Te=4*oe,Re=Math.max(0,$),et=Math.max(0,Y);return{rect:{x:Re,y:et,width:Math.min(G.width,$+oe)-Re,height:Math.min(G.height,Y+le)-et},layout:[{offset:pe,stride:Te}]}}(f,l,d,g,w)),D)for(let G=0;G<U.length;G+=4){let $=U[G];U[G]=U[G+2],U[G+2]=$}return U}finally{I.close()}})}let Es,Zo;function co(f,l,d,g){return f.addEventListener(l,d,g),{unsubscribe:()=>{f.removeEventListener(l,d,g)}}}function Xo(f){return f/Math.PI*180}let Aa={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},xo={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},as="AbortError";function bo(){return new Error(as)}let jr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jt(f){return jr.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}let kt="global-dispatcher";class Er extends Error{constructor(l,d,g,w){super(`AJAXError: ${d} (${l}): ${g}`),this.status=l,this.statusText=d,this.url=g,this.body=w}}let ai=()=>Oi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Mr=function(f,l){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){let g=Jt(f.url);if(g)return g(f,l);if(Oi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:kt},l)}if(!(/^file:/.test(d=f.url)||/^file:/.test(ai())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,w){return o(this,void 0,void 0,function*(){let I=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:ai(),signal:w.signal}),P,D;g.type!=="json"||I.headers.has("Accept")||I.headers.set("Accept","application/json");try{P=yield fetch(I)}catch(G){throw new Er(0,G.message,g.url,new Blob)}if(!P.ok){let G=yield P.blob();throw new Er(P.status,P.statusText,g.url,G)}D=g.type==="arrayBuffer"||g.type==="image"?P.arrayBuffer():g.type==="json"?P.json():P.text();let U=yield D;if(w.signal.aborted)throw bo();return{data:U,cacheControl:P.headers.get("Cache-Control"),expires:P.headers.get("Expires")}})}(f,l);if(Oi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:kt},l)}var d;return function(g,w){return new Promise((I,P)=>{var D;let U=new XMLHttpRequest;U.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(U.responseType="arraybuffer");for(let G in g.headers)U.setRequestHeader(G,g.headers[G]);g.type==="json"&&(U.responseType="text",!((D=g.headers)===null||D===void 0)&&D.Accept||U.setRequestHeader("Accept","application/json")),U.withCredentials=g.credentials==="include",U.onerror=()=>{P(new Error(U.statusText))},U.onload=()=>{if(!w.signal.aborted)if((U.status>=200&&U.status<300||U.status===0)&&U.response!==null){let G=U.response;if(g.type==="json")try{G=JSON.parse(U.response)}catch($){return void P($)}I({data:G,cacheControl:U.getResponseHeader("Cache-Control"),expires:U.getResponseHeader("Expires")})}else{let G=new Blob([U.response],{type:U.getResponseHeader("Content-Type")});P(new Er(U.status,U.statusText,g.url,G))}},w.signal.addEventListener("abort",()=>{U.abort(),P(bo())}),U.send(g.body)})}(f,l)};function Xi(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;let l=new URL(f),d=window.location;return l.protocol===d.protocol&&l.host===d.host}function uo(f,l,d){d[f]&&d[f].indexOf(l)!==-1||(d[f]=d[f]||[],d[f].push(l))}function zn(f,l,d){if(d&&d[f]){let g=d[f].indexOf(l);g!==-1&&d[f].splice(g,1)}}class st{constructor(l,d={}){qt(this,d),this.type=l}}class de extends st{constructor(l,d={}){super("error",qt({error:l},d))}}class ge{on(l,d){return this._listeners=this._listeners||{},uo(l,d,this._listeners),{unsubscribe:()=>{this.off(l,d)}}}off(l,d){return zn(l,d,this._listeners),zn(l,d,this._oneTimeListeners),this}once(l,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},uo(l,d,this._oneTimeListeners),this):new Promise(g=>this.once(l,g))}fire(l,d){typeof l=="string"&&(l=new st(l,d||{}));let g=l.type;if(this.listens(g)){l.target=this;let w=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(let D of w)D.call(this,l);let I=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(let D of I)zn(g,D,this._oneTimeListeners),D.call(this,l);let P=this._eventedParent;P&&(qt(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(l))}else l instanceof de&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,d){return this._eventedParent=l,this._eventedParentData=d,this}}var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let ze=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ye(f,l){let d={};for(let g in f)g!=="ref"&&(d[g]=f[g]);return ze.forEach(g=>{g in l&&(d[g]=l[g])}),d}function Ke(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let d=0;d<f.length;d++)if(!Ke(f[d],l[d]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(let d in f)if(!Ke(f[d],l[d]))return!1;return!0}return f===l}function dt(f,l){f.push(l)}function it(f,l,d){dt(d,{command:"addSource",args:[f,l[f]]})}function Bt(f,l,d){dt(l,{command:"removeSource",args:[f]}),d[f]=!0}function Mt(f,l,d,g){Bt(f,d,g),it(f,l,d)}function ut(f,l,d){let g;for(g in f[d])if(Object.prototype.hasOwnProperty.call(f[d],g)&&g!=="data"&&!Ke(f[d][g],l[d][g]))return!1;for(g in l[d])if(Object.prototype.hasOwnProperty.call(l[d],g)&&g!=="data"&&!Ke(f[d][g],l[d][g]))return!1;return!0}function zt(f,l,d,g,w,I){f=f||{},l=l||{};for(let P in f)Object.prototype.hasOwnProperty.call(f,P)&&(Ke(f[P],l[P])||d.push({command:I,args:[g,P,l[P],w]}));for(let P in l)Object.prototype.hasOwnProperty.call(l,P)&&!Object.prototype.hasOwnProperty.call(f,P)&&(Ke(f[P],l[P])||d.push({command:I,args:[g,P,l[P],w]}))}function rr(f){return f.id}function nr(f,l){return f[l.id]=l,f}class We{constructor(l,d,g,w){this.message=(l?`${l}: `:"")+g,w&&(this.identifier=w),d!=null&&d.__line__&&(this.line=d.__line__)}}function Fr(f,...l){for(let d of l)for(let g in d)f[g]=d[g];return f}class Cr extends Error{constructor(l,d){super(d),this.message=d,this.key=l}}class kr{constructor(l,d=[]){this.parent=l,this.bindings={};for(let[g,w]of d)this.bindings[g]=w}concat(l){return new kr(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}let gi={kind:"null"},Gt={kind:"number"},dr={kind:"string"},tr={kind:"boolean"},Ur={kind:"color"},xn={kind:"projectionDefinition"},ma={kind:"object"},Pr={kind:"value"},Kn={kind:"collator"},rn={kind:"formatted"},ih={kind:"padding"},Hl={kind:"resolvedImage"},Ct={kind:"variableAnchorOffsetCollection"};function Yr(f,l){return{kind:"array",itemType:f,N:l}}function ii(f){if(f.kind==="array"){let l=ii(f.itemType);return typeof f.N=="number"?`array<${l}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${l}>`}return f.kind}let Yo=[gi,Gt,dr,tr,Ur,xn,rn,ma,Yr(Pr),ih,Hl,Ct];function Qn(f,l){if(l.kind==="error")return null;if(f.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Qn(f.itemType,l.itemType))&&(typeof f.N!="number"||f.N===l.N))return null}else{if(f.kind===l.kind)return null;if(f.kind==="value"){for(let d of Yo)if(!Qn(d,l))return null}}return`Expected ${ii(f)} but found ${ii(l)} instead.`}function Cs(f,l){return l.some(d=>d.kind===f.kind)}function ho(f,l){return l.some(d=>d==="null"?f===null:d==="array"?Array.isArray(f):d==="object"?f&&!Array.isArray(f)&&typeof f=="object":d===typeof f)}function wi(f,l){return f.kind==="array"&&l.kind==="array"?f.itemType.kind===l.itemType.kind&&typeof f.N=="number":f.kind===l.kind}let Wl=.96422,ls=.82521,nh=4/29,cs=6/29,af=3*cs*cs,$c=cs*cs*cs,Gd=Math.PI/180,Fa=180/Math.PI;function $l(f){return(f%=360)<0&&(f+=360),f}function Jn([f,l,d,g]){let w,I,P=KA((.2225045*(f=qc(f))+.7168786*(l=qc(l))+.0606169*(d=qc(d)))/1);f===l&&l===d?w=I=P:(w=KA((.4360747*f+.3850649*l+.1430804*d)/Wl),I=KA((.0139322*f+.0971045*l+.7141733*d)/ls));let D=116*P-16;return[D<0?0:D,500*(w-P),200*(P-I),g]}function qc(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function KA(f){return f>$c?Math.pow(f,1/3):f/af+nh}function Dg([f,l,d,g]){let w=(f+16)/116,I=isNaN(l)?w:w+l/500,P=isNaN(d)?w:w-d/200;return w=1*Hd(w),I=Wl*Hd(I),P=ls*Hd(P),[QA(3.1338561*I-1.6168667*w-.4906146*P),QA(-.9787684*I+1.9161415*w+.033454*P),QA(.0719453*I-.2289914*w+1.4052427*P),g]}function QA(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function Hd(f){return f>cs?f*f*f:af*(f-nh)}function lf(f){return parseInt(f.padEnd(2,f),16)/255}function ga(f,l){return hi(l?f/100:f,0,1)}function hi(f,l,d){return Math.min(Math.max(l,f),d)}function Zc(f){return!f.some(Number.isNaN)}let ql={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function cl(f,l,d){return f+d*(l-f)}function oh(f,l,d){return f.map((g,w)=>cl(g,l[w],d))}class Ti{constructor(l,d,g,w=1,I=!0){this.r=l,this.g=d,this.b=g,this.a=w,I||(this.r*=w,this.g*=w,this.b*=w,w||this.overwriteGetter("rgb",[l,d,g,w]))}static parse(l){if(l instanceof Ti)return l;if(typeof l!="string")return;let d=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];let w=ql[g];if(w){let[P,D,U]=w;return[P/255,D/255,U/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){let P=g.length<6?1:2,D=1;return[lf(g.slice(D,D+=P)),lf(g.slice(D,D+=P)),lf(g.slice(D,D+=P)),lf(g.slice(D,D+P)||"ff")]}if(g.startsWith("rgb")){let P=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(P){let[D,U,G,$,Y,oe,le,ue,pe,Te,Re,et]=P,Ne=[$||" ",le||" ",Te].join("");if(Ne==="  "||Ne==="  /"||Ne===",,"||Ne===",,,"){let ae=[G,oe,pe].join(""),xe=ae==="%%%"?100:ae===""?255:0;if(xe){let He=[hi(+U/xe,0,1),hi(+Y/xe,0,1),hi(+ue/xe,0,1),Re?ga(+Re,et):1];if(Zc(He))return He}}return}}let I=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(I){let[P,D,U,G,$,Y,oe,le,ue]=I,pe=[U||" ",$||" ",oe].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){let Te=[+D,hi(+G,0,100),hi(+Y,0,100),le?ga(+le,ue):1];if(Zc(Te))return function([Re,et,Ne,ae]){function xe(He){let xt=(He+Re/30)%12,Ht=et*Math.min(Ne,1-Ne);return Ne-Ht*Math.max(-1,Math.min(xt-3,9-xt,1))}return Re=$l(Re),et/=100,Ne/=100,[xe(0),xe(8),xe(4),ae]}(Te)}}}(l);return d?new Ti(...d,!1):void 0}get rgb(){let{r:l,g:d,b:g,a:w}=this,I=w||1/0;return this.overwriteGetter("rgb",[l/I,d/I,g/I,w])}get hcl(){return this.overwriteGetter("hcl",function(l){let[d,g,w,I]=Jn(l),P=Math.sqrt(g*g+w*w);return[Math.round(1e4*P)?$l(Math.atan2(w,g)*Fa):NaN,P,d,I]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Jn(this.rgb))}overwriteGetter(l,d){return Object.defineProperty(this,l,{value:d}),d}toString(){let[l,d,g,w]=this.rgb;return`rgba(${[l,d,g].map(I=>Math.round(255*I)).join(",")},${w})`}static interpolate(l,d,g,w="rgb"){switch(w){case"rgb":{let[I,P,D,U]=oh(l.rgb,d.rgb,g);return new Ti(I,P,D,U,!1)}case"hcl":{let[I,P,D,U]=l.hcl,[G,$,Y,oe]=d.hcl,le,ue;if(isNaN(I)||isNaN(G))isNaN(I)?isNaN(G)?le=NaN:(le=G,D!==1&&D!==0||(ue=$)):(le=I,Y!==1&&Y!==0||(ue=P));else{let Ne=G-I;G>I&&Ne>180?Ne-=360:G<I&&I-G>180&&(Ne+=360),le=I+g*Ne}let[pe,Te,Re,et]=function([Ne,ae,xe,He]){return Ne=isNaN(Ne)?0:Ne*Gd,Dg([xe,Math.cos(Ne)*ae,Math.sin(Ne)*ae,He])}([le,ue??cl(P,$,g),cl(D,Y,g),cl(U,oe,g)]);return new Ti(pe,Te,Re,et,!1)}case"lab":{let[I,P,D,U]=Dg(oh(l.lab,d.lab,g));return new Ti(I,P,D,U,!1)}}}}Ti.black=new Ti(0,0,0,1),Ti.white=new Ti(1,1,1,1),Ti.transparent=new Ti(0,0,0,0),Ti.red=new Ti(1,0,0,1);class Js{constructor(l,d,g){this.sensitivity=l?d?"variant":"case":d?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,d){return this.collator.compare(l,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let cf=["bottom","center","top"];class sh{constructor(l,d,g,w,I,P){this.text=l,this.image=d,this.scale=g,this.fontStack=w,this.textColor=I,this.verticalAlign=P}}class us{constructor(l){this.sections=l}static fromString(l){return new us([new sh(l,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof us?l:us.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class Fo{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Fo)return l;if(typeof l=="number")return new Fo([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(let d of l)if(typeof d!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Fo(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,d,g){return new Fo(oh(l.values,d.values,g))}}class bn{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}let Wd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class hs{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof hs)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let d=0;d<l.length;d+=2){let g=l[d],w=l[d+1];if(typeof g!="string"||!Wd.has(g)||!Array.isArray(w)||w.length!==2||typeof w[0]!="number"||typeof w[1]!="number")return}return new hs(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,d,g){let w=l.values,I=d.values;if(w.length!==I.length)throw new bn(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${d.toString()}`);let P=[];for(let D=0;D<w.length;D+=2){if(w[D]!==I[D])throw new bn(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${w[D]}, to[${D}]: ${I[D]}`);P.push(w[D]);let[U,G]=w[D+1],[$,Y]=I[D+1];P.push([cl(U,$,g),cl(G,Y,g)])}return new hs(P)}}class Ss{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Ss({name:l,available:!1}):null}}class fo{constructor(l,d,g){this.from=l,this.to=d,this.transition=g}static interpolate(l,d,g){return new fo(l,d,g)}static parse(l){return l instanceof fo?l:Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"?new fo(l[0],l[1],l[2]):typeof l=="object"&&typeof l.from=="string"&&typeof l.to=="string"&&typeof l.transition=="number"?new fo(l.from,l.to,l.transition):typeof l=="string"?new fo(l,l,1):void 0}}function Fg(f,l,d,g){return typeof f=="number"&&f>=0&&f<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof d=="number"&&d>=0&&d<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[f,l,d,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[f,l,d,g]:[f,l,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zl(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof fo||f instanceof Ti||f instanceof Js||f instanceof us||f instanceof Fo||f instanceof hs||f instanceof Ss)return!0;if(Array.isArray(f)){for(let l of f)if(!Zl(l))return!1;return!0}if(typeof f=="object"){for(let l in f)if(!Zl(f[l]))return!1;return!0}return!1}function vn(f){if(f===null)return gi;if(typeof f=="string")return dr;if(typeof f=="boolean")return tr;if(typeof f=="number")return Gt;if(f instanceof Ti)return Ur;if(f instanceof fo)return xn;if(f instanceof Js)return Kn;if(f instanceof us)return rn;if(f instanceof Fo)return ih;if(f instanceof hs)return Ct;if(f instanceof Ss)return Hl;if(Array.isArray(f)){let l=f.length,d;for(let g of f){let w=vn(g);if(d){if(d===w)continue;d=Pr;break}d=w}return Yr(d||Pr,l)}return ma}function ah(f){let l=typeof f;return f===null?"":l==="string"||l==="number"||l==="boolean"?String(f):f instanceof Ti||f instanceof fo||f instanceof us||f instanceof Fo||f instanceof hs||f instanceof Ss?f.toString():JSON.stringify(f)}class Xl{constructor(l,d){this.type=l,this.value=d}static parse(l,d){if(l.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Zl(l[1]))return d.error("invalid value");let g=l[1],w=vn(g),I=d.expectedType;return w.kind!=="array"||w.N!==0||!I||I.kind!=="array"||typeof I.N=="number"&&I.N!==0||(w=I),new Xl(w,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let uf={string:dr,number:Gt,boolean:tr,object:ma};class Is{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g,w=1,I=l[0];if(I==="array"){let D,U;if(l.length>2){let G=l[1];if(typeof G!="string"||!(G in uf)||G==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);D=uf[G],w++}else D=Pr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return d.error('The length argument to "array" must be a positive integer literal',2);U=l[2],w++}g=Yr(D,U)}else{if(!uf[I])throw new Error(`Types doesn't contain name = ${I}`);g=uf[I]}let P=[];for(;w<l.length;w++){let D=d.parse(l[w],w,Pr);if(!D)return null;P.push(D)}return new Is(g,P)}evaluate(l){for(let d=0;d<this.args.length;d++){let g=this.args[d].evaluate(l);if(!Qn(this.type,vn(g)))return g;if(d===this.args.length-1)throw new bn(`Expected value to be of type ${ii(this.type)}, but found ${ii(vn(g))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let mn={"to-boolean":tr,"to-color":Ur,"to-number":Gt,"to-string":dr};class ka{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=l[0];if(!mn[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&l.length!==2)return d.error("Expected one argument.");let w=mn[g],I=[];for(let P=1;P<l.length;P++){let D=d.parse(l[P],P,Pr);if(!D)return null;I.push(D)}return new ka(w,I)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let d,g;for(let w of this.args){if(d=w.evaluate(l),g=null,d instanceof Ti)return d;if(typeof d=="string"){let I=l.parseColor(d);if(I)return I}else if(Array.isArray(d)&&(g=d.length<3||d.length>4?`Invalid rgba value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:Fg(d[0],d[1],d[2],d[3]),!g))return new Ti(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new bn(g||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(let g of this.args){d=g.evaluate(l);let w=Fo.parse(d);if(w)return w}throw new bn(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(let g of this.args){d=g.evaluate(l);let w=hs.parse(d);if(w)return w}throw new bn(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(let g of this.args){if(d=g.evaluate(l),d===null)return 0;let w=Number(d);if(!isNaN(w))return w}throw new bn(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return us.fromString(ah(this.args[0].evaluate(l)));case"resolvedImage":return Ss.fromString(ah(this.args[0].evaluate(l)));case"projectionDefinition":return this.args[0].evaluate(l);default:return ah(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let Di=["Unknown","Point","LineString","Polygon"];class ti{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Di[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let d=this._parseColorCache[l];return d||(d=this._parseColorCache[l]=Ti.parse(l)),d}}class lh{constructor(l,d,g=[],w,I=new kr,P=[]){this.registry=l,this.path=g,this.key=g.map(D=>`[${D}]`).join(""),this.scope=I,this.errors=P,this.expectedType=w,this._isConstant=d}parse(l,d,g,w,I={}){return d?this.concat(d,g,w)._parse(l,I):this._parse(l,I)}_parse(l,d){function g(w,I,P){return P==="assert"?new Is(I,[w]):P==="coerce"?new ka(I,[w]):w}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let w=l[0];if(typeof w!="string")return this.error(`Expression name must be a string, but found ${typeof w} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let I=this.registry[w];if(I){let P=I.parse(l,this);if(!P)return null;if(this.expectedType){let D=this.expectedType,U=P.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||U.kind!=="value")if(D.kind!=="projectionDefinition"||U.kind!=="string"&&U.kind!=="array")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||U.kind!=="value"&&U.kind!=="string")if(D.kind!=="padding"||U.kind!=="value"&&U.kind!=="number"&&U.kind!=="array")if(D.kind!=="variableAnchorOffsetCollection"||U.kind!=="value"&&U.kind!=="array"){if(this.checkSubtype(D,U))return null}else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"coerce");else P=g(P,D,d.typeAnnotation||"assert")}if(!(P instanceof Xl)&&P.type.kind!=="resolvedImage"&&this._isConstant(P)){let D=new ti;try{P=new Xl(P.type,P.evaluate(D))}catch(U){return this.error(U.message),null}}return P}return this.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,d,g){let w=typeof l=="number"?this.path.concat(l):this.path,I=g?this.scope.concat(g):this.scope;return new lh(this.registry,this._isConstant,w,d||null,I,this.errors)}error(l,...d){let g=`${this.key}${d.map(w=>`[${w}]`).join("")}`;this.errors.push(new Cr(g,l))}checkSubtype(l,d){let g=Qn(l,d);return g&&this.error(g),g}}class bi{constructor(l,d){this.type=d.type,this.bindings=[].concat(l),this.result=d}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(let d of this.bindings)l(d[1]);l(this.result)}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);let g=[];for(let I=1;I<l.length-1;I+=2){let P=l[I];if(typeof P!="string")return d.error(`Expected string, but found ${typeof P} instead.`,I);if(/[^a-zA-Z0-9_]/.test(P))return d.error("Variable names must contain only alphanumeric characters or '_'.",I);let D=d.parse(l[I+1],I+1);if(!D)return null;g.push([P,D])}let w=d.parse(l[l.length-1],l.length-1,d.expectedType,g);return w?new bi(g,w):null}outputDefined(){return this.result.outputDefined()}}class ch{constructor(l,d){this.type=d.type,this.name=l,this.boundExpression=d}static parse(l,d){if(l.length!==2||typeof l[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");let g=l[1];return d.scope.has(g)?new ch(g,d.scope.get(g)):d.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class _a{constructor(l,d,g){this.type=l,this.index=d,this.input=g}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Gt),w=d.parse(l[2],2,Yr(d.expectedType||Pr));return g&&w?new _a(w.type.itemType,g,w):null}evaluate(l){let d=this.index.evaluate(l),g=this.input.evaluate(l);if(d<0)throw new bn(`Array index out of bounds: ${d} < 0.`);if(d>=g.length)throw new bn(`Array index out of bounds: ${d} > ${g.length-1}.`);if(d!==Math.floor(d))throw new bn(`Array index must be an integer, but found ${d} instead.`);return g[d]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class hf{constructor(l,d){this.type=tr,this.needle=l,this.haystack=d}static parse(l,d){if(l.length!==3)return d.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Pr),w=d.parse(l[2],2,Pr);return g&&w?Cs(g.type,[tr,dr,Gt,gi,Pr])?new hf(g,w):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(g.type)} instead`):null}evaluate(l){let d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!g)return!1;if(!ho(d,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${ii(vn(d))} instead.`);if(!ho(g,["string","array"]))throw new bn(`Expected second argument to be of type array or string, but found ${ii(vn(g))} instead.`);return g.indexOf(d)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class ff{constructor(l,d,g){this.type=Gt,this.needle=l,this.haystack=d,this.fromIndex=g}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Pr),w=d.parse(l[2],2,Pr);if(!g||!w)return null;if(!Cs(g.type,[tr,dr,Gt,gi,Pr]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${ii(g.type)} instead`);if(l.length===4){let I=d.parse(l[3],3,Gt);return I?new ff(g,w,I):null}return new ff(g,w)}evaluate(l){let d=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!ho(d,["boolean","string","number","null"]))throw new bn(`Expected first argument to be of type boolean, string, number or null, but found ${ii(vn(d))} instead.`);let w;if(this.fromIndex&&(w=this.fromIndex.evaluate(l)),ho(g,["string"])){let I=g.indexOf(d,w);return I===-1?-1:[...g.slice(0,I)].length}if(ho(g,["array"]))return g.indexOf(d,w);throw new bn(`Expected second argument to be of type array or string, but found ${ii(vn(g))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class $d{constructor(l,d,g,w,I,P){this.inputType=l,this.type=d,this.input=g,this.cases=w,this.outputs=I,this.otherwise=P}static parse(l,d){if(l.length<5)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return d.error("Expected an even number of arguments.");let g,w;d.expectedType&&d.expectedType.kind!=="value"&&(w=d.expectedType);let I={},P=[];for(let G=2;G<l.length-1;G+=2){let $=l[G],Y=l[G+1];Array.isArray($)||($=[$]);let oe=d.concat(G);if($.length===0)return oe.error("Expected at least one branch label.");for(let ue of $){if(typeof ue!="number"&&typeof ue!="string")return oe.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return oe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ue=="number"&&Math.floor(ue)!==ue)return oe.error("Numeric branch labels must be integer values.");if(g){if(oe.checkSubtype(g,vn(ue)))return null}else g=vn(ue);if(I[String(ue)]!==void 0)return oe.error("Branch labels must be unique.");I[String(ue)]=P.length}let le=d.parse(Y,G,w);if(!le)return null;w=w||le.type,P.push(le)}let D=d.parse(l[1],1,Pr);if(!D)return null;let U=d.parse(l[l.length-1],l.length-1,w);return U?D.type.kind!=="value"&&d.concat(1).checkSubtype(g,D.type)?null:new $d(g,w,D,I,P,U):null}evaluate(l){let d=this.input.evaluate(l);return(vn(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class df{constructor(l,d,g){this.type=l,this.branches=d,this.otherwise=g}static parse(l,d){if(l.length<4)return d.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return d.error("Expected an odd number of arguments.");let g;d.expectedType&&d.expectedType.kind!=="value"&&(g=d.expectedType);let w=[];for(let P=1;P<l.length-1;P+=2){let D=d.parse(l[P],P,tr);if(!D)return null;let U=d.parse(l[P+1],P+1,g);if(!U)return null;w.push([D,U]),g=g||U.type}let I=d.parse(l[l.length-1],l.length-1,g);if(!I)return null;if(!g)throw new Error("Can't infer output type");return new df(g,w,I)}evaluate(l){for(let[d,g]of this.branches)if(d.evaluate(l))return g.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(let[d,g]of this.branches)l(d),l(g);l(this.otherwise)}outputDefined(){return this.branches.every(([l,d])=>d.outputDefined())&&this.otherwise.outputDefined()}}class pf{constructor(l,d,g,w){this.type=l,this.input=d,this.beginIndex=g,this.endIndex=w}static parse(l,d){if(l.length<=2||l.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=d.parse(l[1],1,Pr),w=d.parse(l[2],2,Gt);if(!g||!w)return null;if(!Cs(g.type,[Yr(Pr),dr,Pr]))return d.error(`Expected first argument to be of type array or string, but found ${ii(g.type)} instead`);if(l.length===4){let I=d.parse(l[3],3,Gt);return I?new pf(g.type,g,w,I):null}return new pf(g.type,g,w)}evaluate(l){let d=this.input.evaluate(l),g=this.beginIndex.evaluate(l),w;if(this.endIndex&&(w=this.endIndex.evaluate(l)),ho(d,["string"]))return[...d].slice(g,w).join("");if(ho(d,["array"]))return d.slice(g,w);throw new bn(`Expected first argument to be of type array or string, but found ${ii(vn(d))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function qd(f,l){let d=f.length-1,g,w,I=0,P=d,D=0;for(;I<=P;)if(D=Math.floor((I+P)/2),g=f[D],w=f[D+1],g<=l){if(D===d||l<w)return D;I=D+1}else{if(!(g>l))throw new bn("Input is not a number.");P=D-1}return 0}class uh{constructor(l,d,g){this.type=l,this.input=d,this.labels=[],this.outputs=[];for(let[w,I]of g)this.labels.push(w),this.outputs.push(I)}static parse(l,d){if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");let g=d.parse(l[1],1,Gt);if(!g)return null;let w=[],I=null;d.expectedType&&d.expectedType.kind!=="value"&&(I=d.expectedType);for(let P=1;P<l.length;P+=2){let D=P===1?-1/0:l[P],U=l[P+1],G=P,$=P+1;if(typeof D!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(w.length&&w[w.length-1][0]>=D)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',G);let Y=d.parse(U,$,I);if(!Y)return null;I=I||Y.type,w.push([D,Y])}return new uh(I,g,w)}evaluate(l){let d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);let w=this.input.evaluate(l);if(w<=d[0])return g[0].evaluate(l);let I=d.length;return w>=d[I-1]?g[I-1].evaluate(l):g[qd(d,w)].evaluate(l)}eachChild(l){l(this.input);for(let d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function kg(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Xc,ko,Zd=function(){if(ko)return Xc;function f(l,d,g,w){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*d,this.by=3*(w-d)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=d,this.p2x=g,this.p2y=w}return ko=1,Xc=f,f.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,d){if(d===void 0&&(d=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,w=0;w<8;w++){var I=this.sampleCurveX(g)-l;if(Math.abs(I)<d)return g;var P=this.sampleCurveDerivativeX(g);if(Math.abs(P)<1e-6)break;g-=I/P}var D=0,U=1;for(g=l,w=0;w<20&&(I=this.sampleCurveX(g),!(Math.abs(I-l)<d));w++)l>I?D=g:U=g,g=.5*(U-D)+D;return g},solve:function(l,d){return this.sampleCurveY(this.solveCurveX(l,d))}},Xc}(),Ng=kg(Zd);class Ko{constructor(l,d,g,w,I){this.type=l,this.operator=d,this.interpolation=g,this.input=w,this.labels=[],this.outputs=[];for(let[P,D]of I)this.labels.push(P),this.outputs.push(D)}static interpolationFactor(l,d,g,w){let I=0;if(l.name==="exponential")I=eo(d,l.base,g,w);else if(l.name==="linear")I=eo(d,1,g,w);else if(l.name==="cubic-bezier"){let P=l.controlPoints;I=new Ng(P[0],P[1],P[2],P[3]).solve(eo(d,1,g,w))}return I}static parse(l,d){let[g,w,I,...P]=l;if(!Array.isArray(w)||w.length===0)return d.error("Expected an interpolation type expression.",1);if(w[0]==="linear")w={name:"linear"};else if(w[0]==="exponential"){let G=w[1];if(typeof G!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);w={name:"exponential",base:G}}else{if(w[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(w[0])}`,1,0);{let G=w.slice(1);if(G.length!==4||G.some($=>typeof $!="number"||$<0||$>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);w={name:"cubic-bezier",controlPoints:G}}}if(l.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(I=d.parse(I,2,Gt),!I)return null;let D=[],U=null;g==="interpolate-hcl"||g==="interpolate-lab"?U=Ur:d.expectedType&&d.expectedType.kind!=="value"&&(U=d.expectedType);for(let G=0;G<P.length;G+=2){let $=P[G],Y=P[G+1],oe=G+3,le=G+4;if(typeof $!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',oe);if(D.length&&D[D.length-1][0]>=$)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',oe);let ue=d.parse(Y,le,U);if(!ue)return null;U=U||ue.type,D.push([$,ue])}return wi(U,Gt)||wi(U,xn)||wi(U,Ur)||wi(U,ih)||wi(U,Ct)||wi(U,Yr(Gt))?new Ko(U,g,w,I,D):d.error(`Type ${ii(U)} is not interpolatable.`)}evaluate(l){let d=this.labels,g=this.outputs;if(d.length===1)return g[0].evaluate(l);let w=this.input.evaluate(l);if(w<=d[0])return g[0].evaluate(l);let I=d.length;if(w>=d[I-1])return g[I-1].evaluate(l);let P=qd(d,w),D=Ko.interpolationFactor(this.interpolation,w,d[P],d[P+1]),U=g[P].evaluate(l),G=g[P+1].evaluate(l);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return cl(U,G,D);case"color":return Ti.interpolate(U,G,D);case"padding":return Fo.interpolate(U,G,D);case"variableAnchorOffsetCollection":return hs.interpolate(U,G,D);case"array":return oh(U,G,D);case"projectionDefinition":return fo.interpolate(U,G,D)}case"interpolate-hcl":return Ti.interpolate(U,G,D,"hcl");case"interpolate-lab":return Ti.interpolate(U,G,D,"lab")}}eachChild(l){l(this.input);for(let d of this.outputs)l(d)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function eo(f,l,d,g){let w=g-d,I=f-d;return w===0?0:l===1?I/w:(Math.pow(l,I)-1)/(Math.pow(l,w)-1)}let ya={color:Ti.interpolate,number:cl,padding:Fo.interpolate,variableAnchorOffsetCollection:hs.interpolate,array:oh};class hh{constructor(l,d){this.type=l,this.args=d}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=null,w=d.expectedType;w&&w.kind!=="value"&&(g=w);let I=[];for(let D of l.slice(1)){let U=d.parse(D,1+I.length,g,void 0,{typeAnnotation:"omit"});if(!U)return null;g=g||U.type,I.push(U)}if(!g)throw new Error("No output type");let P=w&&I.some(D=>Qn(w,D.type));return new hh(P?Pr:g,I)}evaluate(l){let d,g=null,w=0;for(let I of this.args)if(w++,g=I.evaluate(l),g&&g instanceof Ss&&!g.available&&(d||(d=g.name),g=null,w===this.args.length&&(g=d)),g!==null)break;return g}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function JA(f,l){return f==="=="||f==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function zg(f,l,d,g){return g.compare(l,d)===0}function ul(f,l,d){let g=f!=="=="&&f!=="!=";return class UB{constructor(I,P,D){this.type=tr,this.lhs=I,this.rhs=P,this.collator=D,this.hasUntypedArgument=I.type.kind==="value"||P.type.kind==="value"}static parse(I,P){if(I.length!==3&&I.length!==4)return P.error("Expected two or three arguments.");let D=I[0],U=P.parse(I[1],1,Pr);if(!U)return null;if(!JA(D,U.type))return P.concat(1).error(`"${D}" comparisons are not supported for type '${ii(U.type)}'.`);let G=P.parse(I[2],2,Pr);if(!G)return null;if(!JA(D,G.type))return P.concat(2).error(`"${D}" comparisons are not supported for type '${ii(G.type)}'.`);if(U.type.kind!==G.type.kind&&U.type.kind!=="value"&&G.type.kind!=="value")return P.error(`Cannot compare types '${ii(U.type)}' and '${ii(G.type)}'.`);g&&(U.type.kind==="value"&&G.type.kind!=="value"?U=new Is(G.type,[U]):U.type.kind!=="value"&&G.type.kind==="value"&&(G=new Is(U.type,[G])));let $=null;if(I.length===4){if(U.type.kind!=="string"&&G.type.kind!=="string"&&U.type.kind!=="value"&&G.type.kind!=="value")return P.error("Cannot use collator to compare non-string types.");if($=P.parse(I[3],3,Kn),!$)return null}return new UB(U,G,$)}evaluate(I){let P=this.lhs.evaluate(I),D=this.rhs.evaluate(I);if(g&&this.hasUntypedArgument){let U=vn(P),G=vn(D);if(U.kind!==G.kind||U.kind!=="string"&&U.kind!=="number")throw new bn(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${U.kind}, ${G.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){let U=vn(P),G=vn(D);if(U.kind!=="string"||G.kind!=="string")return l(I,P,D)}return this.collator?d(I,P,D,this.collator.evaluate(I)):l(I,P,D)}eachChild(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)}outputDefined(){return!0}}}let e0=ul("==",function(f,l,d){return l===d},zg),t0=ul("!=",function(f,l,d){return l!==d},function(f,l,d,g){return!zg(0,l,d,g)}),Af=ul("<",function(f,l,d){return l<d},function(f,l,d,g){return g.compare(l,d)<0}),mf=ul(">",function(f,l,d){return l>d},function(f,l,d,g){return g.compare(l,d)>0}),Ms=ul("<=",function(f,l,d){return l<=d},function(f,l,d,g){return g.compare(l,d)<=0}),Xd=ul(">=",function(f,l,d){return l>=d},function(f,l,d,g){return g.compare(l,d)>=0});class hl{constructor(l,d,g){this.type=Kn,this.locale=g,this.caseSensitive=l,this.diacriticSensitive=d}static parse(l,d){if(l.length!==2)return d.error("Expected one argument.");let g=l[1];if(typeof g!="object"||Array.isArray(g))return d.error("Collator options argument must be an object.");let w=d.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,tr);if(!w)return null;let I=d.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,tr);if(!I)return null;let P=null;return g.locale&&(P=d.parse(g.locale,1,dr),!P)?null:new hl(w,I,P)}evaluate(l){return new Js(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class gf{constructor(l,d,g,w,I){this.type=dr,this.number=l,this.locale=d,this.currency=g,this.minFractionDigits=w,this.maxFractionDigits=I}static parse(l,d){if(l.length!==3)return d.error("Expected two arguments.");let g=d.parse(l[1],1,Gt);if(!g)return null;let w=l[2];if(typeof w!="object"||Array.isArray(w))return d.error("NumberFormat options argument must be an object.");let I=null;if(w.locale&&(I=d.parse(w.locale,1,dr),!I))return null;let P=null;if(w.currency&&(P=d.parse(w.currency,1,dr),!P))return null;let D=null;if(w["min-fraction-digits"]&&(D=d.parse(w["min-fraction-digits"],1,Gt),!D))return null;let U=null;return w["max-fraction-digits"]&&(U=d.parse(w["max-fraction-digits"],1,Gt),!U)?null:new gf(g,I,P,D,U)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Na{constructor(l){this.type=rn,this.sections=l}static parse(l,d){if(l.length<2)return d.error("Expected at least one argument.");let g=l[1];if(!Array.isArray(g)&&typeof g=="object")return d.error("First argument must be an image or text section.");let w=[],I=!1;for(let P=1;P<=l.length-1;++P){let D=l[P];if(I&&typeof D=="object"&&!Array.isArray(D)){I=!1;let U=null;if(D["font-scale"]&&(U=d.parse(D["font-scale"],1,Gt),!U))return null;let G=null;if(D["text-font"]&&(G=d.parse(D["text-font"],1,Yr(dr)),!G))return null;let $=null;if(D["text-color"]&&($=d.parse(D["text-color"],1,Ur),!$))return null;let Y=null;if(D["vertical-align"]){if(typeof D["vertical-align"]=="string"&&!cf.includes(D["vertical-align"]))return d.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${D["vertical-align"]}' instead.`);if(Y=d.parse(D["vertical-align"],1,dr),!Y)return null}let oe=w[w.length-1];oe.scale=U,oe.font=G,oe.textColor=$,oe.verticalAlign=Y}else{let U=d.parse(l[P],1,Pr);if(!U)return null;let G=U.type.kind;if(G!=="string"&&G!=="value"&&G!=="null"&&G!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");I=!0,w.push({content:U,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Na(w)}evaluate(l){return new us(this.sections.map(d=>{let g=d.content.evaluate(l);return vn(g)===Hl?new sh("",g,null,null,null,d.verticalAlign?d.verticalAlign.evaluate(l):null):new sh(ah(g),null,d.scale?d.scale.evaluate(l):null,d.font?d.font.evaluate(l).join(","):null,d.textColor?d.textColor.evaluate(l):null,d.verticalAlign?d.verticalAlign.evaluate(l):null)}))}eachChild(l){for(let d of this.sections)l(d.content),d.scale&&l(d.scale),d.font&&l(d.font),d.textColor&&l(d.textColor),d.verticalAlign&&l(d.verticalAlign)}outputDefined(){return!1}}class fh{constructor(l){this.type=Hl,this.input=l}static parse(l,d){if(l.length!==2)return d.error("Expected two arguments.");let g=d.parse(l[1],1,dr);return g?new fh(g):d.error("No image name provided.")}evaluate(l){let d=this.input.evaluate(l),g=Ss.fromString(d);return g&&l.availableImages&&(g.available=l.availableImages.indexOf(d)>-1),g}eachChild(l){l(this.input)}outputDefined(){return!1}}class za{constructor(l){this.type=Gt,this.input=l}static parse(l,d){if(l.length!==2)return d.error(`Expected 1 argument, but found ${l.length-1} instead.`);let g=d.parse(l[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${ii(g.type)} instead.`):new za(g):null}evaluate(l){let d=this.input.evaluate(l);if(typeof d=="string")return[...d].length;if(Array.isArray(d))return d.length;throw new bn(`Expected value to be of type string or array, but found ${ii(vn(d))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}let gt=8192;function Wt(f,l){let d=(180+f[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,w=Math.pow(2,l.z);return[Math.round(d*w*gt),Math.round(g*w*gt)]}function sr(f,l){let d=Math.pow(2,l.z);return[(w=(f[0]/gt+l.x)/d,360*w-180),(g=(f[1]/gt+l.y)/d,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,w}function Lr(f,l){f[0]=Math.min(f[0],l[0]),f[1]=Math.min(f[1],l[1]),f[2]=Math.max(f[2],l[0]),f[3]=Math.max(f[3],l[1])}function y(f,l){return!(f[0]<=l[0]||f[2]>=l[2]||f[1]<=l[1]||f[3]>=l[3])}function Yi(f,l,d){let g=f[0]-l[0],w=f[1]-l[1],I=f[0]-d[0],P=f[1]-d[1];return g*P-I*w==0&&g*I<=0&&w*P<=0}function Ii(f,l,d,g){return(w=[g[0]-d[0],g[1]-d[1]])[0]*(I=[l[0]-f[0],l[1]-f[1]])[1]-w[1]*I[0]!=0&&!(!gn(f,l,d,g)||!gn(d,g,f,l));var w,I}function Ee(f,l,d){for(let g of d)for(let w=0;w<g.length-1;++w)if(Ii(f,l,g[w],g[w+1]))return!0;return!1}function Rn(f,l,d=!1){let g=!1;for(let D of l)for(let U=0;U<D.length-1;U++){if(Yi(f,D[U],D[U+1]))return d;(I=D[U])[1]>(w=f)[1]!=(P=D[U+1])[1]>w[1]&&w[0]<(P[0]-I[0])*(w[1]-I[1])/(P[1]-I[1])+I[0]&&(g=!g)}var w,I,P;return g}function fs(f,l){for(let d of l)if(Rn(f,d))return!0;return!1}function to(f,l){for(let d of f)if(!Rn(d,l))return!1;for(let d=0;d<f.length-1;++d)if(Ee(f[d],f[d+1],l))return!1;return!0}function Gi(f,l){for(let d of l)if(to(f,d))return!0;return!1}function gn(f,l,d,g){let w=g[0]-d[0],I=g[1]-d[1],P=(f[0]-d[0])*I-w*(f[1]-d[1]),D=(l[0]-d[0])*I-w*(l[1]-d[1]);return P>0&&D<0||P<0&&D>0}function Wn(f,l,d){let g=[];for(let w=0;w<f.length;w++){let I=[];for(let P=0;P<f[w].length;P++){let D=Wt(f[w][P],d);Lr(l,D),I.push(D)}g.push(I)}return g}function Ei(f,l,d){let g=[];for(let w=0;w<f.length;w++){let I=Wn(f[w],l,d);g.push(I)}return g}function Mi(f,l,d,g){if(f[0]<d[0]||f[0]>d[2]){let w=.5*g,I=f[0]-d[0]>w?-g:d[0]-f[0]>w?g:0;I===0&&(I=f[0]-d[2]>w?-g:d[2]-f[0]>w?g:0),f[0]+=I}Lr(l,f)}function Yc(f,l,d,g){let w=Math.pow(2,g.z)*gt,I=[g.x*gt,g.y*gt],P=[];for(let D of f)for(let U of D){let G=[U.x+I[0],U.y+I[1]];Mi(G,l,d,w),P.push(G)}return P}function r0(f,l,d,g){let w=Math.pow(2,g.z)*gt,I=[g.x*gt,g.y*gt],P=[];for(let U of f){let G=[];for(let $ of U){let Y=[$.x+I[0],$.y+I[1]];Lr(l,Y),G.push(Y)}P.push(G)}if(l[2]-l[0]<=w/2){(D=l)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(let U of P)for(let G of U)Mi(G,l,d,w)}var D;return P}class Yl{constructor(l,d){this.type=tr,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Zl(l[1])){let g=l[1];if(g.type==="FeatureCollection"){let w=[];for(let I of g.features){let{type:P,coordinates:D}=I.geometry;P==="Polygon"&&w.push(D),P==="MultiPolygon"&&w.push(...D)}if(w.length)return new Yl(g,{type:"MultiPolygon",coordinates:w})}else if(g.type==="Feature"){let w=g.geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new Yl(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new Yl(g,g)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,g){let w=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],P=d.canonicalID();if(g.type==="Polygon"){let D=Wn(g.coordinates,I,P),U=Yc(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!Rn(G,D))return!1}if(g.type==="MultiPolygon"){let D=Ei(g.coordinates,I,P),U=Yc(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!fs(G,D))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,g){let w=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],P=d.canonicalID();if(g.type==="Polygon"){let D=Wn(g.coordinates,I,P),U=r0(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!to(G,D))return!1}if(g.type==="MultiPolygon"){let D=Ei(g.coordinates,I,P),U=r0(d.geometry(),w,I,P);if(!y(w,I))return!1;for(let G of U)if(!Gi(G,D))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Kc=class{constructor(f=[],l=(d,g)=>d<g?-1:d>g?1:0){if(this.data=f,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;let f=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),f}peek(){return this.data[0]}_up(f){let{data:l,compare:d}=this,g=l[f];for(;f>0;){let w=f-1>>1,I=l[w];if(d(g,I)>=0)break;l[f]=I,f=w}l[f]=g}_down(f){let{data:l,compare:d}=this,g=this.length>>1,w=l[f];for(;f<g;){let I=1+(f<<1),P=I+1;if(P<this.length&&d(l[P],l[I])<0&&(I=P),d(l[I],w)>=0)break;l[f]=l[I],f=I}l[f]=w}};function Ps(f,l,d=0,g=f.length-1,w=ba){for(;g>d;){if(g-d>600){let U=g-d+1,G=l-d+1,$=Math.log(U),Y=.5*Math.exp(2*$/3),oe=.5*Math.sqrt($*Y*(U-Y)/U)*(G-U/2<0?-1:1);Ps(f,l,Math.max(d,Math.floor(l-G*Y/U+oe)),Math.min(g,Math.floor(l+(U-G)*Y/U+oe)),w)}let I=f[l],P=d,D=g;for(xa(f,d,l),w(f[g],I)>0&&xa(f,d,g);P<D;){for(xa(f,P,D),P++,D--;w(f[P],I)<0;)P++;for(;w(f[D],I)>0;)D--}w(f[d],I)===0?xa(f,d,D):(D++,xa(f,D,g)),D<=l&&(d=D+1),l<=D&&(g=D-1)}}function xa(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}function ba(f,l){return f<l?-1:f>l?1:0}function Kl(f,l){if(f.length<=1)return[f];let d=[],g,w;for(let I of f){let P=Ql(I);P!==0&&(I.area=Math.abs(P),w===void 0&&(w=P<0),w===P<0?(g&&d.push(g),g=[I]):g.push(I))}if(g&&d.push(g),l>1)for(let I=0;I<d.length;I++)d[I].length<=l||(Ps(d[I],l,1,d[I].length-1,i0),d[I]=d[I].slice(0,l));return d}function i0(f,l){return l.area-f.area}function Ql(f){let l=0;for(let d,g,w=0,I=f.length,P=I-1;w<I;P=w++)d=f[w],g=f[P],l+=(g.x-d.x)*(d.y+g.y);return l}let Kr=1/298.257223563,Me=Kr*(2-Kr),Nr=Math.PI/180;class _f{constructor(l){let d=6378.137*Nr*1e3,g=Math.cos(l*Nr),w=1/(1-Me*(1-g*g)),I=Math.sqrt(w);this.kx=d*I*g,this.ky=d*I*w*(1-Me)}distance(l,d){let g=this.wrap(l[0]-d[0])*this.kx,w=(l[1]-d[1])*this.ky;return Math.sqrt(g*g+w*w)}pointOnLine(l,d){let g,w,I,P,D=1/0;for(let U=0;U<l.length-1;U++){let G=l[U][0],$=l[U][1],Y=this.wrap(l[U+1][0]-G)*this.kx,oe=(l[U+1][1]-$)*this.ky,le=0;Y===0&&oe===0||(le=(this.wrap(d[0]-G)*this.kx*Y+(d[1]-$)*this.ky*oe)/(Y*Y+oe*oe),le>1?(G=l[U+1][0],$=l[U+1][1]):le>0&&(G+=Y/this.kx*le,$+=oe/this.ky*le)),Y=this.wrap(d[0]-G)*this.kx,oe=(d[1]-$)*this.ky;let ue=Y*Y+oe*oe;ue<D&&(D=ue,g=G,w=$,I=U,P=le)}return{point:[g,w],index:I,t:Math.max(0,Math.min(1,P))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function n0(f,l){return l[0]-f[0]}function yf(f){return f[1]-f[0]+1}function va(f,l){return f[1]>=f[0]&&f[1]<l}function Yd(f,l){if(f[0]>f[1])return[null,null];let d=yf(f);if(l){if(d===2)return[f,null];let w=Math.floor(d/2);return[[f[0],f[0]+w],[f[0]+w,f[1]]]}if(d===1)return[f,null];let g=Math.floor(d/2)-1;return[[f[0],f[0]+g],[f[0]+g+1,f[1]]]}function be(f,l){if(!va(l,f.length))return[1/0,1/0,-1/0,-1/0];let d=[1/0,1/0,-1/0,-1/0];for(let g=l[0];g<=l[1];++g)Lr(d,f[g]);return d}function Kd(f){let l=[1/0,1/0,-1/0,-1/0];for(let d of f)for(let g of d)Lr(l,g);return l}function o0(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function Pi(f,l,d){if(!o0(f)||!o0(l))return NaN;let g=0,w=0;return f[2]<l[0]&&(g=l[0]-f[2]),f[0]>l[2]&&(g=f[0]-l[2]),f[1]>l[3]&&(w=f[1]-l[3]),f[3]<l[1]&&(w=l[1]-f[3]),d.distance([0,0],[g,w])}function Jl(f,l,d){let g=d.pointOnLine(l,f);return d.distance(f,g.point)}function Qd(f,l,d,g,w){let I=Math.min(Jl(f,[d,g],w),Jl(l,[d,g],w)),P=Math.min(Jl(d,[f,l],w),Jl(g,[f,l],w));return Math.min(I,P)}function Ug(f,l,d,g,w){if(!va(l,f.length)||!va(g,d.length))return 1/0;let I=1/0;for(let P=l[0];P<l[1];++P){let D=f[P],U=f[P+1];for(let G=g[0];G<g[1];++G){let $=d[G],Y=d[G+1];if(Ii(D,U,$,Y))return 0;I=Math.min(I,Qd(D,U,$,Y,w))}}return I}function s0(f,l,d,g,w){if(!va(l,f.length)||!va(g,d.length))return NaN;let I=1/0;for(let P=l[0];P<=l[1];++P)for(let D=g[0];D<=g[1];++D)if(I=Math.min(I,w.distance(f[P],d[D])),I===0)return I;return I}function a0(f,l,d){if(Rn(f,l,!0))return 0;let g=1/0;for(let w of l){let I=w[0],P=w[w.length-1];if(I!==P&&(g=Math.min(g,Jl(f,[P,I],d)),g===0))return g;let D=d.pointOnLine(w,f);if(g=Math.min(g,d.distance(f,D.point)),g===0)return g}return g}function l0(f,l,d,g){if(!va(l,f.length))return NaN;for(let I=l[0];I<=l[1];++I)if(Rn(f[I],d,!0))return 0;let w=1/0;for(let I=l[0];I<l[1];++I){let P=f[I],D=f[I+1];for(let U of d)for(let G=0,$=U.length,Y=$-1;G<$;Y=G++){let oe=U[Y],le=U[G];if(Ii(P,D,oe,le))return 0;w=Math.min(w,Qd(P,D,oe,le,g))}}return w}function wa(f,l){for(let d of f)for(let g of d)if(Rn(g,l,!0))return!0;return!1}function po(f,l,d,g=1/0){let w=Kd(f),I=Kd(l);if(g!==1/0&&Pi(w,I,d)>=g)return g;if(y(w,I)){if(wa(f,l))return 0}else if(wa(l,f))return 0;let P=1/0;for(let D of f)for(let U=0,G=D.length,$=G-1;U<G;$=U++){let Y=D[$],oe=D[U];for(let le of l)for(let ue=0,pe=le.length,Te=pe-1;ue<pe;Te=ue++){let Re=le[Te],et=le[ue];if(Ii(Y,oe,Re,et))return 0;P=Math.min(P,Qd(Y,oe,Re,et,d))}}return P}function xf(f,l,d,g,w,I){if(!I)return;let P=Pi(be(g,I),w,d);P<l&&f.push([P,I,[0,0]])}function bf(f,l,d,g,w,I,P){if(!I||!P)return;let D=Pi(be(g,I),be(w,P),d);D<l&&f.push([D,I,P])}function vf(f,l,d,g,w=1/0){let I=Math.min(g.distance(f[0],d[0][0]),w);if(I===0)return I;let P=new Kc([[0,[0,f.length-1],[0,0]]],n0),D=Kd(d);for(;P.length>0;){let U=P.pop();if(U[0]>=I)continue;let G=U[1],$=l?50:100;if(yf(G)<=$){if(!va(G,f.length))return NaN;if(l){let Y=l0(f,G,d,g);if(isNaN(Y)||Y===0)return Y;I=Math.min(I,Y)}else for(let Y=G[0];Y<=G[1];++Y){let oe=a0(f[Y],d,g);if(I=Math.min(I,oe),I===0)return 0}}else{let Y=Yd(G,l);xf(P,I,g,f,D,Y[0]),xf(P,I,g,f,D,Y[1])}}return I}function dh(f,l,d,g,w,I=1/0){let P=Math.min(I,w.distance(f[0],d[0]));if(P===0)return P;let D=new Kc([[0,[0,f.length-1],[0,d.length-1]]],n0);for(;D.length>0;){let U=D.pop();if(U[0]>=P)continue;let G=U[1],$=U[2],Y=l?50:100,oe=g?50:100;if(yf(G)<=Y&&yf($)<=oe){if(!va(G,f.length)&&va($,d.length))return NaN;let le;if(l&&g)le=Ug(f,G,d,$,w),P=Math.min(P,le);else if(l&&!g){let ue=f.slice(G[0],G[1]+1);for(let pe=$[0];pe<=$[1];++pe)if(le=Jl(d[pe],ue,w),P=Math.min(P,le),P===0)return P}else if(!l&&g){let ue=d.slice($[0],$[1]+1);for(let pe=G[0];pe<=G[1];++pe)if(le=Jl(f[pe],ue,w),P=Math.min(P,le),P===0)return P}else le=s0(f,G,d,$,w),P=Math.min(P,le)}else{let le=Yd(G,l),ue=Yd($,g);bf(D,P,w,f,d,le[0],ue[0]),bf(D,P,w,f,d,le[0],ue[1]),bf(D,P,w,f,d,le[1],ue[0]),bf(D,P,w,f,d,le[1],ue[1])}}return P}function Jd(f){return f.type==="MultiPolygon"?f.coordinates.map(l=>({type:"Polygon",coordinates:l})):f.type==="MultiLineString"?f.coordinates.map(l=>({type:"LineString",coordinates:l})):f.type==="MultiPoint"?f.coordinates.map(l=>({type:"Point",coordinates:l})):[f]}class ec{constructor(l,d){this.type=Gt,this.geojson=l,this.geometries=d}static parse(l,d){if(l.length!==2)return d.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Zl(l[1])){let g=l[1];if(g.type==="FeatureCollection")return new ec(g,g.features.map(w=>Jd(w.geometry)).flat());if(g.type==="Feature")return new ec(g,Jd(g.geometry));if("type"in g&&"coordinates"in g)return new ec(g,Jd(g))}return d.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(d,g){let w=d.geometry(),I=w.flat().map(U=>sr([U.x,U.y],d.canonical));if(w.length===0)return NaN;let P=new _f(I[0][1]),D=1/0;for(let U of g){switch(U.type){case"Point":D=Math.min(D,dh(I,!1,[U.coordinates],!1,P,D));break;case"LineString":D=Math.min(D,dh(I,!1,U.coordinates,!0,P,D));break;case"Polygon":D=Math.min(D,vf(I,!1,U.coordinates,P,D))}if(D===0)return D}return D}(l,this.geometries);if(l.geometryType()==="LineString")return function(d,g){let w=d.geometry(),I=w.flat().map(U=>sr([U.x,U.y],d.canonical));if(w.length===0)return NaN;let P=new _f(I[0][1]),D=1/0;for(let U of g){switch(U.type){case"Point":D=Math.min(D,dh(I,!0,[U.coordinates],!1,P,D));break;case"LineString":D=Math.min(D,dh(I,!0,U.coordinates,!0,P,D));break;case"Polygon":D=Math.min(D,vf(I,!0,U.coordinates,P,D))}if(D===0)return D}return D}(l,this.geometries);if(l.geometryType()==="Polygon")return function(d,g){let w=d.geometry();if(w.length===0||w[0].length===0)return NaN;let I=Kl(w,0).map(U=>U.map(G=>G.map($=>sr([$.x,$.y],d.canonical)))),P=new _f(I[0][0][0][1]),D=1/0;for(let U of g)for(let G of I){switch(U.type){case"Point":D=Math.min(D,vf([U.coordinates],!1,G,P,D));break;case"LineString":D=Math.min(D,vf(U.coordinates,!0,G,P,D));break;case"Polygon":D=Math.min(D,po(G,U.coordinates,P,D))}if(D===0)return D}return D}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let Qc={"==":e0,"!=":t0,">":mf,"<":Af,">=":Xd,"<=":Ms,array:Is,at:_a,boolean:Is,case:df,coalesce:hh,collator:hl,format:Na,image:fh,in:hf,"index-of":ff,interpolate:Ko,"interpolate-hcl":Ko,"interpolate-lab":Ko,length:za,let:bi,literal:Xl,match:$d,number:Is,"number-format":gf,object:Is,slice:pf,step:uh,string:Is,"to-boolean":ka,"to-color":ka,"to-number":ka,"to-string":ka,var:ch,within:Yl,distance:ec};class _i{constructor(l,d,g,w){this.name=l,this.type=d,this._evaluate=g,this.args=w}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,d){let g=l[0],w=_i.definitions[g];if(!w)return d.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);let I=Array.isArray(w)?w[0]:w.type,P=Array.isArray(w)?[[w[1],w[2]]]:w.overloads,D=P.filter(([G])=>!Array.isArray(G)||G.length===l.length-1),U=null;for(let[G,$]of D){U=new lh(d.registry,Tf,d.path,null,d.scope);let Y=[],oe=!1;for(let le=1;le<l.length;le++){let ue=l[le],pe=Array.isArray(G)?G[le-1]:G.type,Te=U.parse(ue,1+Y.length,pe);if(!Te){oe=!0;break}Y.push(Te)}if(!oe)if(Array.isArray(G)&&G.length!==Y.length)U.error(`Expected ${G.length} arguments, but found ${Y.length} instead.`);else{for(let le=0;le<Y.length;le++){let ue=Array.isArray(G)?G[le]:G.type,pe=Y[le];U.concat(le+1).checkSubtype(ue,pe.type)}if(U.errors.length===0)return new _i(g,I,$,Y)}}if(D.length===1)d.errors.push(...U.errors);else{let G=(D.length?D:P).map(([Y])=>{return oe=Y,Array.isArray(oe)?`(${oe.map(ii).join(", ")})`:`(${ii(oe.type)}...)`;var oe}).join(" | "),$=[];for(let Y=1;Y<l.length;Y++){let oe=d.parse(l[Y],1+$.length);if(!oe)return null;$.push(ii(oe.type))}d.error(`Expected arguments of type ${G}, but found (${$.join(", ")}) instead.`)}return null}static register(l,d){_i.definitions=d;for(let g in d)l[g]=_i}}function wf(f,[l,d,g,w]){l=l.evaluate(f),d=d.evaluate(f),g=g.evaluate(f);let I=w?w.evaluate(f):1,P=Fg(l,d,g,I);if(P)throw new bn(P);return new Ti(l/255,d/255,g/255,I,!1)}function ep(f,l){return f in l}function tp(f,l){let d=l[f];return d===void 0?null:d}function tc(f){return{type:f}}function Tf(f){if(f instanceof ch)return Tf(f.boundExpression);if(f instanceof _i&&f.name==="error"||f instanceof hl||f instanceof Yl||f instanceof ec)return!1;let l=f instanceof ka||f instanceof Is,d=!0;return f.eachChild(g=>{d=l?d&&Tf(g):d&&g instanceof Xl}),!!d&&ph(f)&&Jc(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ph(f){if(f instanceof _i&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Yl||f instanceof ec)return!1;let l=!0;return f.eachChild(d=>{l&&!ph(d)&&(l=!1)}),l}function rc(f){if(f instanceof _i&&f.name==="feature-state")return!1;let l=!0;return f.eachChild(d=>{l&&!rc(d)&&(l=!1)}),l}function Jc(f,l){if(f instanceof _i&&l.indexOf(f.name)>=0)return!1;let d=!0;return f.eachChild(g=>{d&&!Jc(g,l)&&(d=!1)}),d}function c0(f){return{result:"success",value:f}}function eu(f){return{result:"error",value:f}}function ic(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function rp(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function Ef(f){return!!f.expression&&f.expression.interpolated}function Ci(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function Cf(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function ip(f){return f}function vo(f,l){let d=l.type==="color",g=f.stops&&typeof f.stops[0][0]=="object",w=g||!(g||f.property!==void 0),I=f.type||(Ef(l)?"exponential":"interval");if(d||l.type==="padding"){let $=d?Ti.parse:Fo.parse;(f=Fr({},f)).stops&&(f.stops=f.stops.map(Y=>[Y[0],$(Y[1])])),f.default=$(f.default?f.default:l.default)}if(f.colorSpace&&(P=f.colorSpace)!=="rgb"&&P!=="hcl"&&P!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var P;let D,U,G;if(I==="exponential")D=np;else if(I==="interval")D=Sf;else if(I==="categorical"){D=Qo,U=Object.create(null);for(let $ of f.stops)U[$[0]]=$[1];G=typeof f.stops[0][0]}else{if(I!=="identity")throw new Error(`Unknown function type "${I}"`);D=If}if(g){let $={},Y=[];for(let ue=0;ue<f.stops.length;ue++){let pe=f.stops[ue],Te=pe[0].zoom;$[Te]===void 0&&($[Te]={zoom:Te,type:f.type,property:f.property,default:f.default,stops:[]},Y.push(Te)),$[Te].stops.push([pe[0].value,pe[1]])}let oe=[];for(let ue of Y)oe.push([$[ue].zoom,vo($[ue],l)]);let le={name:"linear"};return{kind:"composite",interpolationType:le,interpolationFactor:Ko.interpolationFactor.bind(void 0,le),zoomStops:oe.map(ue=>ue[0]),evaluate:({zoom:ue},pe)=>np({stops:oe,base:f.base},l,ue).evaluate(ue,pe)}}if(w){let $=I==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:Ko.interpolationFactor.bind(void 0,$),zoomStops:f.stops.map(Y=>Y[0]),evaluate:({zoom:Y})=>D(f,l,Y,U,G)}}return{kind:"source",evaluate($,Y){let oe=Y&&Y.properties?Y.properties[f.property]:void 0;return oe===void 0?ea(f.default,l.default):D(f,l,oe,U,G)}}}function ea(f,l,d){return f!==void 0?f:l!==void 0?l:d!==void 0?d:void 0}function Qo(f,l,d,g,w){return ea(typeof d===w?g[d]:void 0,f.default,l.default)}function Sf(f,l,d){if(Ci(d)!=="number")return ea(f.default,l.default);let g=f.stops.length;if(g===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[g-1][0])return f.stops[g-1][1];let w=qd(f.stops.map(I=>I[0]),d);return f.stops[w][1]}function np(f,l,d){let g=f.base!==void 0?f.base:1;if(Ci(d)!=="number")return ea(f.default,l.default);let w=f.stops.length;if(w===1||d<=f.stops[0][0])return f.stops[0][1];if(d>=f.stops[w-1][0])return f.stops[w-1][1];let I=qd(f.stops.map($=>$[0]),d),P=function($,Y,oe,le){let ue=le-oe,pe=$-oe;return ue===0?0:Y===1?pe/ue:(Math.pow(Y,pe)-1)/(Math.pow(Y,ue)-1)}(d,g,f.stops[I][0],f.stops[I+1][0]),D=f.stops[I][1],U=f.stops[I+1][1],G=ya[l.type]||ip;return typeof D.evaluate=="function"?{evaluate(...$){let Y=D.evaluate.apply(void 0,$),oe=U.evaluate.apply(void 0,$);if(Y!==void 0&&oe!==void 0)return G(Y,oe,P,f.colorSpace)}}:G(D,U,P,f.colorSpace)}function If(f,l,d){switch(l.type){case"color":d=Ti.parse(d);break;case"formatted":d=us.fromString(d.toString());break;case"resolvedImage":d=Ss.fromString(d.toString());break;case"padding":d=Fo.parse(d);break;default:Ci(d)===l.type||l.type==="enum"&&l.values[d]||(d=void 0)}return ea(d,f.default,l.default)}_i.register(Qc,{error:[{kind:"error"},[dr],(f,[l])=>{throw new bn(l.evaluate(f))}],typeof:[dr,[Pr],(f,[l])=>ii(vn(l.evaluate(f)))],"to-rgba":[Yr(Gt,4),[Ur],(f,[l])=>{let[d,g,w,I]=l.evaluate(f).rgb;return[255*d,255*g,255*w,I]}],rgb:[Ur,[Gt,Gt,Gt],wf],rgba:[Ur,[Gt,Gt,Gt,Gt],wf],has:{type:tr,overloads:[[[dr],(f,[l])=>ep(l.evaluate(f),f.properties())],[[dr,ma],(f,[l,d])=>ep(l.evaluate(f),d.evaluate(f))]]},get:{type:Pr,overloads:[[[dr],(f,[l])=>tp(l.evaluate(f),f.properties())],[[dr,ma],(f,[l,d])=>tp(l.evaluate(f),d.evaluate(f))]]},"feature-state":[Pr,[dr],(f,[l])=>tp(l.evaluate(f),f.featureState||{})],properties:[ma,[],f=>f.properties()],"geometry-type":[dr,[],f=>f.geometryType()],id:[Pr,[],f=>f.id()],zoom:[Gt,[],f=>f.globals.zoom],"heatmap-density":[Gt,[],f=>f.globals.heatmapDensity||0],"line-progress":[Gt,[],f=>f.globals.lineProgress||0],accumulated:[Pr,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Gt,tc(Gt),(f,l)=>{let d=0;for(let g of l)d+=g.evaluate(f);return d}],"*":[Gt,tc(Gt),(f,l)=>{let d=1;for(let g of l)d*=g.evaluate(f);return d}],"-":{type:Gt,overloads:[[[Gt,Gt],(f,[l,d])=>l.evaluate(f)-d.evaluate(f)],[[Gt],(f,[l])=>-l.evaluate(f)]]},"/":[Gt,[Gt,Gt],(f,[l,d])=>l.evaluate(f)/d.evaluate(f)],"%":[Gt,[Gt,Gt],(f,[l,d])=>l.evaluate(f)%d.evaluate(f)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(f,[l,d])=>Math.pow(l.evaluate(f),d.evaluate(f))],sqrt:[Gt,[Gt],(f,[l])=>Math.sqrt(l.evaluate(f))],log10:[Gt,[Gt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN10],ln:[Gt,[Gt],(f,[l])=>Math.log(l.evaluate(f))],log2:[Gt,[Gt],(f,[l])=>Math.log(l.evaluate(f))/Math.LN2],sin:[Gt,[Gt],(f,[l])=>Math.sin(l.evaluate(f))],cos:[Gt,[Gt],(f,[l])=>Math.cos(l.evaluate(f))],tan:[Gt,[Gt],(f,[l])=>Math.tan(l.evaluate(f))],asin:[Gt,[Gt],(f,[l])=>Math.asin(l.evaluate(f))],acos:[Gt,[Gt],(f,[l])=>Math.acos(l.evaluate(f))],atan:[Gt,[Gt],(f,[l])=>Math.atan(l.evaluate(f))],min:[Gt,tc(Gt),(f,l)=>Math.min(...l.map(d=>d.evaluate(f)))],max:[Gt,tc(Gt),(f,l)=>Math.max(...l.map(d=>d.evaluate(f)))],abs:[Gt,[Gt],(f,[l])=>Math.abs(l.evaluate(f))],round:[Gt,[Gt],(f,[l])=>{let d=l.evaluate(f);return d<0?-Math.round(-d):Math.round(d)}],floor:[Gt,[Gt],(f,[l])=>Math.floor(l.evaluate(f))],ceil:[Gt,[Gt],(f,[l])=>Math.ceil(l.evaluate(f))],"filter-==":[tr,[dr,Pr],(f,[l,d])=>f.properties()[l.value]===d.value],"filter-id-==":[tr,[Pr],(f,[l])=>f.id()===l.value],"filter-type-==":[tr,[dr],(f,[l])=>f.geometryType()===l.value],"filter-<":[tr,[dr,Pr],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g<w}],"filter-id-<":[tr,[Pr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d<g}],"filter->":[tr,[dr,Pr],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g>w}],"filter-id->":[tr,[Pr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d>g}],"filter-<=":[tr,[dr,Pr],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g<=w}],"filter-id-<=":[tr,[Pr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d<=g}],"filter->=":[tr,[dr,Pr],(f,[l,d])=>{let g=f.properties()[l.value],w=d.value;return typeof g==typeof w&&g>=w}],"filter-id->=":[tr,[Pr],(f,[l])=>{let d=f.id(),g=l.value;return typeof d==typeof g&&d>=g}],"filter-has":[tr,[Pr],(f,[l])=>l.value in f.properties()],"filter-has-id":[tr,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[tr,[Yr(dr)],(f,[l])=>l.value.indexOf(f.geometryType())>=0],"filter-id-in":[tr,[Yr(Pr)],(f,[l])=>l.value.indexOf(f.id())>=0],"filter-in-small":[tr,[dr,Yr(Pr)],(f,[l,d])=>d.value.indexOf(f.properties()[l.value])>=0],"filter-in-large":[tr,[dr,Yr(Pr)],(f,[l,d])=>function(g,w,I,P){for(;I<=P;){let D=I+P>>1;if(w[D]===g)return!0;w[D]>g?P=D-1:I=D+1}return!1}(f.properties()[l.value],d.value,0,d.value.length-1)],all:{type:tr,overloads:[[[tr,tr],(f,[l,d])=>l.evaluate(f)&&d.evaluate(f)],[tc(tr),(f,l)=>{for(let d of l)if(!d.evaluate(f))return!1;return!0}]]},any:{type:tr,overloads:[[[tr,tr],(f,[l,d])=>l.evaluate(f)||d.evaluate(f)],[tc(tr),(f,l)=>{for(let d of l)if(d.evaluate(f))return!0;return!1}]]},"!":[tr,[tr],(f,[l])=>!l.evaluate(f)],"is-supported-script":[tr,[dr],(f,[l])=>{let d=f.globals&&f.globals.isSupportedScript;return!d||d(l.evaluate(f))}],upcase:[dr,[dr],(f,[l])=>l.evaluate(f).toUpperCase()],downcase:[dr,[dr],(f,[l])=>l.evaluate(f).toLowerCase()],concat:[dr,tc(Pr),(f,l)=>l.map(d=>ah(d.evaluate(f))).join("")],"resolved-locale":[dr,[Kn],(f,[l])=>l.evaluate(f).resolvedLocale()]});class tu{constructor(l,d){var g;this.expression=l,this._warningHistory={},this._evaluator=new ti,this._defaultValue=d?(g=d).type==="color"&&Cf(g.default)?new Ti(0,0,0,0):g.type==="color"?Ti.parse(g.default)||null:g.type==="padding"?Fo.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?hs.parse(g.default)||null:g.type==="projectionDefinition"?fo.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(l,d,g,w,I,P){return this._evaluator.globals=l,this._evaluator.feature=d,this._evaluator.featureState=g,this._evaluator.canonical=w,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=P,this.expression.evaluate(this._evaluator)}evaluate(l,d,g,w,I,P){this._evaluator.globals=l,this._evaluator.feature=d||null,this._evaluator.featureState=g||null,this._evaluator.canonical=w,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=P||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new bn(`Expected value to be one of ${Object.keys(this._enumValues).map(U=>JSON.stringify(U)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function Ah(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in Qc}function Mf(f,l){let d=new lh(Qc,Tf,[],l?function(w){let I={color:Ur,string:dr,number:Gt,enum:dr,boolean:tr,formatted:rn,padding:ih,projectionDefinition:xn,resolvedImage:Hl,variableAnchorOffsetCollection:Ct};return w.type==="array"?Yr(I[w.value]||Pr,w.length):I[w.type]}(l):void 0),g=d.parse(f,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?c0(new tu(g,l)):eu(d.errors)}class Pf{constructor(l,d){this.kind=l,this._styleExpression=d,this.isStateDependent=l!=="constant"&&!rc(d.expression)}evaluateWithoutErrorHandling(l,d,g,w,I,P){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,w,I,P)}evaluate(l,d,g,w,I,P){return this._styleExpression.evaluate(l,d,g,w,I,P)}}class ru{constructor(l,d,g,w){this.kind=l,this.zoomStops=g,this._styleExpression=d,this.isStateDependent=l!=="camera"&&!rc(d.expression),this.interpolationType=w}evaluateWithoutErrorHandling(l,d,g,w,I,P){return this._styleExpression.evaluateWithoutErrorHandling(l,d,g,w,I,P)}evaluate(l,d,g,w,I,P){return this._styleExpression.evaluate(l,d,g,w,I,P)}interpolationFactor(l,d,g){return this.interpolationType?Ko.interpolationFactor(this.interpolationType,l,d,g):0}}function fl(f,l){let d=Mf(f,l);if(d.result==="error")return d;let g=d.value.expression,w=ph(g);if(!w&&!ic(l))return eu([new Cr("","data expressions not supported")]);let I=Jc(g,["zoom"]);if(!I&&!rp(l))return eu([new Cr("","zoom expressions not supported")]);let P=iu(g);return P||I?P instanceof Cr?eu([P]):P instanceof Ko&&!Ef(l)?eu([new Cr("",'"interpolate" expressions cannot be used with this property')]):c0(P?new ru(w?"camera":"composite",d.value,P.labels,P instanceof Ko?P.interpolation:void 0):new Pf(w?"constant":"source",d.value)):eu([new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mh{constructor(l,d){this._parameters=l,this._specification=d,Fr(this,vo(this._parameters,this._specification))}static deserialize(l){return new mh(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function iu(f){let l=null;if(f instanceof bi)l=iu(f.result);else if(f instanceof hh){for(let d of f.args)if(l=iu(d),l)break}else(f instanceof uh||f instanceof Ko)&&f.input instanceof _i&&f.input.name==="zoom"&&(l=f);return l instanceof Cr||f.eachChild(d=>{let g=iu(d);g instanceof Cr?l=g:!l&&g?l=new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&g&&l!==g&&(l=new Cr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function nc(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(let l of f.slice(1))if(!nc(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}let oc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ta(f){if(f==null)return{filter:()=>!0,needGeometry:!1};nc(f)||(f=sc(f));let l=Mf(f,oc);if(l.result==="error")throw new Error(l.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,g,w)=>l.value.evaluate(d,g,{},w),needGeometry:Rf(f)}}function op(f,l){return f<l?-1:f>l?1:0}function Rf(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let l=1;l<f.length;l++)if(Rf(f[l]))return!0;return!1}function sc(f){if(!f)return!0;let l=f[0];return f.length<=1?l!=="any":l==="=="?Bf(f[1],f[2],"=="):l==="!="?nu(Bf(f[1],f[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Bf(f[1],f[2],l):l==="any"?(d=f.slice(1),["any"].concat(d.map(sc))):l==="all"?["all"].concat(f.slice(1).map(sc)):l==="none"?["all"].concat(f.slice(1).map(sc).map(nu)):l==="in"?Lf(f[1],f.slice(2)):l==="!in"?nu(Lf(f[1],f.slice(2))):l==="has"?gh(f[1]):l!=="!has"||nu(gh(f[1]));var d}function Bf(f,l,d){switch(f){case"$type":return[`filter-type-${d}`,l];case"$id":return[`filter-id-${d}`,l];default:return[`filter-${d}`,f,l]}}function Lf(f,l){if(l.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(d=>typeof d!=typeof l[0])?["filter-in-large",f,["literal",l.sort(op)]]:["filter-in-small",f,["literal",l]]}}function gh(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function nu(f){return["!",f]}function ou(f){let l=typeof f;if(l==="number"||l==="boolean"||l==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let w="[";for(let I of f)w+=`${ou(I)},`;return`${w}]`}let d=Object.keys(f).sort(),g="{";for(let w=0;w<d.length;w++)g+=`${JSON.stringify(d[w])}:${ou(f[d[w]])},`;return`${g}}`}function Vg(f){let l="";for(let d of ze)l+=`/${ou(f[d])}`;return l}function u0(f){let l=f.value;return l?[new We(f.key,l,"constants have been deprecated as of v8")]:[]}function Un(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function ac(f){if(Array.isArray(f))return f.map(ac);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){let l={};for(let d in f)l[d]=ac(f[d]);return l}return Un(f)}function zs(f){let l=f.key,d=f.value,g=f.valueSpec||{},w=f.objectElementValidators||{},I=f.style,P=f.styleSpec,D=f.validateSpec,U=[],G=Ci(d);if(G!=="object")return[new We(l,d,`object expected, ${G} found`)];for(let $ in d){let Y=$.split(".")[0],oe=g[Y]||g["*"],le;if(w[Y])le=w[Y];else if(g[Y])le=D;else if(w["*"])le=w["*"];else{if(!g["*"]){U.push(new We(l,d[$],`unknown property "${$}"`));continue}le=D}U=U.concat(le({key:(l&&`${l}.`)+$,value:d[$],valueSpec:oe,style:I,styleSpec:P,object:d,objectKey:$,validateSpec:D},d))}for(let $ in g)w[$]||g[$].required&&g[$].default===void 0&&d[$]===void 0&&U.push(new We(l,d,`missing required property "${$}"`));return U}function sp(f){let l=f.value,d=f.valueSpec,g=f.style,w=f.styleSpec,I=f.key,P=f.arrayElementValidator||f.validateSpec;if(Ci(l)!=="array")return[new We(I,l,`array expected, ${Ci(l)} found`)];if(d.length&&l.length!==d.length)return[new We(I,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new We(I,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let D={type:d.value,values:d.values};w.$version<7&&(D.function=d.function),Ci(d.value)==="object"&&(D=d.value);let U=[];for(let G=0;G<l.length;G++)U=U.concat(P({array:l,arrayIndex:G,value:l[G],valueSpec:D,validateSpec:f.validateSpec,style:g,styleSpec:w,key:`${I}[${G}]`}));return U}function lc(f){let l=f.key,d=f.value,g=f.valueSpec,w=Ci(d);return w==="number"&&d!=d&&(w="NaN"),w!=="number"?[new We(l,d,`number expected, ${w} found`)]:"minimum"in g&&d<g.minimum?[new We(l,d,`${d} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&d>g.maximum?[new We(l,d,`${d} is greater than the maximum value ${g.maximum}`)]:[]}function ap(f){let l=f.valueSpec,d=Un(f.value.type),g,w,I,P={},D=d!=="categorical"&&f.value.property===void 0,U=!D,G=Ci(f.value.stops)==="array"&&Ci(f.value.stops[0])==="array"&&Ci(f.value.stops[0][0])==="object",$=zs({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(le){if(d==="identity")return[new We(le.key,le.value,'identity function may not have a "stops" property')];let ue=[],pe=le.value;return ue=ue.concat(sp({key:le.key,value:pe,valueSpec:le.valueSpec,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,arrayElementValidator:Y})),Ci(pe)==="array"&&pe.length===0&&ue.push(new We(le.key,pe,"array must have at least one stop")),ue},default:function(le){return le.validateSpec({key:le.key,value:le.value,valueSpec:l,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec})}}});return d==="identity"&&D&&$.push(new We(f.key,f.value,'missing required property "property"')),d==="identity"||f.value.stops||$.push(new We(f.key,f.value,'missing required property "stops"')),d==="exponential"&&f.valueSpec.expression&&!Ef(f.valueSpec)&&$.push(new We(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(U&&!ic(f.valueSpec)?$.push(new We(f.key,f.value,"property functions not supported")):D&&!rp(f.valueSpec)&&$.push(new We(f.key,f.value,"zoom functions not supported"))),d!=="categorical"&&!G||f.value.property!==void 0||$.push(new We(f.key,f.value,'"property" property is required')),$;function Y(le){let ue=[],pe=le.value,Te=le.key;if(Ci(pe)!=="array")return[new We(Te,pe,`array expected, ${Ci(pe)} found`)];if(pe.length!==2)return[new We(Te,pe,`array length 2 expected, length ${pe.length} found`)];if(G){if(Ci(pe[0])!=="object")return[new We(Te,pe,`object expected, ${Ci(pe[0])} found`)];if(pe[0].zoom===void 0)return[new We(Te,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new We(Te,pe,"object stop key must have value")];if(I&&I>Un(pe[0].zoom))return[new We(Te,pe[0].zoom,"stop zoom values must appear in ascending order")];Un(pe[0].zoom)!==I&&(I=Un(pe[0].zoom),w=void 0,P={}),ue=ue.concat(zs({key:`${Te}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,objectElementValidators:{zoom:lc,value:oe}}))}else ue=ue.concat(oe({key:`${Te}[0]`,value:pe[0],validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec},pe));return Ah(ac(pe[1]))?ue.concat([new We(`${Te}[1]`,pe[1],"expressions are not allowed in function stops.")]):ue.concat(le.validateSpec({key:`${Te}[1]`,value:pe[1],valueSpec:l,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec}))}function oe(le,ue){let pe=Ci(le.value),Te=Un(le.value),Re=le.value!==null?le.value:ue;if(g){if(pe!==g)return[new We(le.key,Re,`${pe} stop domain type must match previous stop domain type ${g}`)]}else g=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new We(le.key,Re,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&d!=="categorical"){let et=`number expected, ${pe} found`;return ic(l)&&d===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(le.key,Re,et)]}return d!=="categorical"||pe!=="number"||isFinite(Te)&&Math.floor(Te)===Te?d!=="categorical"&&pe==="number"&&w!==void 0&&Te<w?[new We(le.key,Re,"stop domain values must appear in ascending order")]:(w=Te,d==="categorical"&&Te in P?[new We(le.key,Re,"stop domain values must be unique")]:(P[Te]=!0,[])):[new We(le.key,Re,`integer expected, found ${Te}`)]}}function Ua(f){let l=(f.expressionContext==="property"?fl:Mf)(ac(f.value),f.valueSpec);if(l.result==="error")return l.value.map(g=>new We(`${f.key}${g.key}`,f.value,g.message));let d=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!d.outputDefined())return[new We(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!rc(d))return[new We(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!rc(d))return[new We(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!Jc(d,["zoom","feature-state"]))return[new We(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!ph(d))return[new We(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _h(f){let l=f.key,d=f.value,g=f.valueSpec,w=[];return Array.isArray(g.values)?g.values.indexOf(Un(d))===-1&&w.push(new We(l,d,`expected one of [${g.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(g.values).indexOf(Un(d))===-1&&w.push(new We(l,d,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(d)} found`)),w}function dl(f){return nc(ac(f.value))?Ua(Fr({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):lp(f)}function lp(f){let l=f.value,d=f.key;if(Ci(l)!=="array")return[new We(d,l,`array expected, ${Ci(l)} found`)];let g=f.styleSpec,w,I=[];if(l.length<1)return[new We(d,l,"filter array must have at least 1 element")];switch(I=I.concat(_h({key:`${d}[0]`,value:l[0],valueSpec:g.filter_operator,style:f.style,styleSpec:f.styleSpec})),Un(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Un(l[1])==="$type"&&I.push(new We(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&I.push(new We(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(w=Ci(l[1]),w!=="string"&&I.push(new We(`${d}[1]`,l[1],`string expected, ${w} found`)));for(let P=2;P<l.length;P++)w=Ci(l[P]),Un(l[1])==="$type"?I=I.concat(_h({key:`${d}[${P}]`,value:l[P],valueSpec:g.geometry_type,style:f.style,styleSpec:f.styleSpec})):w!=="string"&&w!=="number"&&w!=="boolean"&&I.push(new We(`${d}[${P}]`,l[P],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let P=1;P<l.length;P++)I=I.concat(lp({key:`${d}[${P}]`,value:l[P],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":w=Ci(l[1]),l.length!==2?I.push(new We(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):w!=="string"&&I.push(new We(`${d}[1]`,l[1],`string expected, ${w} found`))}return I}function Of(f,l){let d=f.key,g=f.validateSpec,w=f.style,I=f.styleSpec,P=f.value,D=f.objectKey,U=I[`${l}_${f.layerType}`];if(!U)return[];let G=D.match(/^(.*)-transition$/);if(l==="paint"&&G&&U[G[1]]&&U[G[1]].transition)return g({key:d,value:P,valueSpec:I.transition,style:w,styleSpec:I});let $=f.valueSpec||U[D];if(!$)return[new We(d,P,`unknown property "${D}"`)];let Y;if(Ci(P)==="string"&&ic($)&&!$.tokens&&(Y=/^{([^}]+)}$/.exec(P)))return[new We(d,P,`"${D}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];let oe=[];return f.layerType==="symbol"&&(D==="text-field"&&w&&!w.glyphs&&oe.push(new We(d,P,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&Cf(ac(P))&&Un(P.type)==="identity"&&oe.push(new We(d,P,'"text-font" does not support identity functions'))),oe.concat(g({key:f.key,value:P,valueSpec:$,style:w,styleSpec:I,expressionContext:"property",propertyType:l,propertyKey:D}))}function Df(f){return Of(f,"paint")}function pl(f){return Of(f,"layout")}function su(f){let l=[],d=f.value,g=f.key,w=f.style,I=f.styleSpec;d.type||d.ref||l.push(new We(g,d,'either "type" or "ref" is required'));let P=Un(d.type),D=Un(d.ref);if(d.id){let U=Un(d.id);for(let G=0;G<f.arrayIndex;G++){let $=w.layers[G];Un($.id)===U&&l.push(new We(g,d.id,`duplicate layer id "${d.id}", previously used at line ${$.id.__line__}`))}}if("ref"in d){let U;["type","source","source-layer","filter","layout"].forEach(G=>{G in d&&l.push(new We(g,d[G],`"${G}" is prohibited for ref layers`))}),w.layers.forEach(G=>{Un(G.id)===D&&(U=G)}),U?U.ref?l.push(new We(g,d.ref,"ref cannot reference another ref layer")):P=Un(U.type):l.push(new We(g,d.ref,`ref layer "${D}" not found`))}else if(P!=="background")if(d.source){let U=w.sources&&w.sources[d.source],G=U&&Un(U.type);U?G==="vector"&&P==="raster"?l.push(new We(g,d.source,`layer "${d.id}" requires a raster source`)):G!=="raster-dem"&&P==="hillshade"?l.push(new We(g,d.source,`layer "${d.id}" requires a raster-dem source`)):G==="raster"&&P!=="raster"?l.push(new We(g,d.source,`layer "${d.id}" requires a vector source`)):G!=="vector"||d["source-layer"]?G==="raster-dem"&&P!=="hillshade"?l.push(new We(g,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!d.paint||!d.paint["line-gradient"]||G==="geojson"&&U.lineMetrics||l.push(new We(g,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new We(g,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new We(g,d.source,`source "${d.source}" not found`))}else l.push(new We(g,d,'missing required property "source"'));return l=l.concat(zs({key:g,value:d,valueSpec:I.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${g}.type`,value:d.type,valueSpec:I.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:d,objectKey:"type"}),filter:dl,layout:U=>zs({layer:d,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":G=>pl(Fr({layerType:P},G))}}),paint:U=>zs({layer:d,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":G=>Df(Fr({layerType:P},G))}})}})),l}function Va(f){let l=f.value,d=f.key,g=Ci(l);return g!=="string"?[new We(d,l,`string expected, ${g} found`)]:[]}let cp={promoteId:function({key:f,value:l}){if(Ci(l)==="string")return Va({key:f,value:l});{let d=[];for(let g in l)d.push(...Va({key:`${f}.${g}`,value:l[g]}));return d}}};function h0(f){let l=f.value,d=f.key,g=f.styleSpec,w=f.style,I=f.validateSpec;if(!l.type)return[new We(d,l,'"type" is required')];let P=Un(l.type),D;switch(P){case"vector":case"raster":return D=zs({key:d,value:l,valueSpec:g[`source_${P.replace("-","_")}`],style:f.style,styleSpec:g,objectElementValidators:cp,validateSpec:I}),D;case"raster-dem":return D=function(U){var G;let $=(G=U.sourceName)!==null&&G!==void 0?G:"",Y=U.value,oe=U.styleSpec,le=oe.source_raster_dem,ue=U.style,pe=[],Te=Ci(Y);if(Y===void 0)return pe;if(Te!=="object")return pe.push(new We("source_raster_dem",Y,`object expected, ${Te} found`)),pe;let Re=Un(Y.encoding)==="custom",et=["redFactor","greenFactor","blueFactor","baseShift"],Ne=U.value.encoding?`"${U.value.encoding}"`:"Default";for(let ae in Y)!Re&&et.includes(ae)?pe.push(new We(ae,Y[ae],`In "${$}": "${ae}" is only valid when "encoding" is set to "custom". ${Ne} encoding found`)):le[ae]?pe=pe.concat(U.validateSpec({key:ae,value:Y[ae],valueSpec:le[ae],validateSpec:U.validateSpec,style:ue,styleSpec:oe})):pe.push(new We(ae,Y[ae],`unknown property "${ae}"`));return pe}({sourceName:d,value:l,style:f.style,styleSpec:g,validateSpec:I}),D;case"geojson":if(D=zs({key:d,value:l,valueSpec:g.source_geojson,style:w,styleSpec:g,validateSpec:I,objectElementValidators:cp}),l.cluster)for(let U in l.clusterProperties){let[G,$]=l.clusterProperties[U],Y=typeof G=="string"?[G,["accumulated"],["get",U]]:G;D.push(...Ua({key:`${d}.${U}.map`,value:$,expressionContext:"cluster-map"})),D.push(...Ua({key:`${d}.${U}.reduce`,value:Y,expressionContext:"cluster-reduce"}))}return D;case"video":return zs({key:d,value:l,valueSpec:g.source_video,style:w,validateSpec:I,styleSpec:g});case"image":return zs({key:d,value:l,valueSpec:g.source_image,style:w,validateSpec:I,styleSpec:g});case"canvas":return[new We(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _h({key:`${d}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function up(f){let l=f.value,d=f.styleSpec,g=d.light,w=f.style,I=[],P=Ci(l);if(l===void 0)return I;if(P!=="object")return I=I.concat([new We("light",l,`object expected, ${P} found`)]),I;for(let D in l){let U=D.match(/^(.*)-transition$/);I=I.concat(U&&g[U[1]]&&g[U[1]].transition?f.validateSpec({key:D,value:l[D],valueSpec:d.transition,validateSpec:f.validateSpec,style:w,styleSpec:d}):g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:f.validateSpec,style:w,styleSpec:d}):[new We(D,l[D],`unknown property "${D}"`)])}return I}function Ff(f){let l=f.value,d=f.styleSpec,g=d.sky,w=f.style,I=Ci(l);if(l===void 0)return[];if(I!=="object")return[new We("sky",l,`object expected, ${I} found`)];let P=[];for(let D in l)P=P.concat(g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],style:w,styleSpec:d}):[new We(D,l[D],`unknown property "${D}"`)]);return P}function kf(f){let l=f.value,d=f.styleSpec,g=d.terrain,w=f.style,I=[],P=Ci(l);if(l===void 0)return I;if(P!=="object")return I=I.concat([new We("terrain",l,`object expected, ${P} found`)]),I;for(let D in l)I=I.concat(g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:f.validateSpec,style:w,styleSpec:d}):[new We(D,l[D],`unknown property "${D}"`)]);return I}function ja(f){let l=[],d=f.value,g=f.key;if(Array.isArray(d)){let w=[],I=[];for(let P in d)d[P].id&&w.includes(d[P].id)&&l.push(new We(g,d,`all the sprites' ids must be unique, but ${d[P].id} is duplicated`)),w.push(d[P].id),d[P].url&&I.includes(d[P].url)&&l.push(new We(g,d,`all the sprites' URLs must be unique, but ${d[P].url} is duplicated`)),I.push(d[P].url),l=l.concat(zs({key:`${g}[${P}]`,value:d[P],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return l}return Va({key:g,value:d})}let Hi={"*":()=>[],array:sp,boolean:function(f){let l=f.value,d=f.key,g=Ci(l);return g!=="boolean"?[new We(d,l,`boolean expected, ${g} found`)]:[]},number:lc,color:function(f){let l=f.key,d=f.value,g=Ci(d);return g!=="string"?[new We(l,d,`color expected, ${g} found`)]:Ti.parse(String(d))?[]:[new We(l,d,`color expected, "${d}" found`)]},constants:u0,enum:_h,filter:dl,function:ap,layer:su,object:zs,source:h0,light:up,sky:Ff,terrain:kf,projection:function(f){let l=f.value,d=f.styleSpec,g=d.projection,w=f.style,I=Ci(l);if(l===void 0)return[];if(I!=="object")return[new We("projection",l,`object expected, ${I} found`)];let P=[];for(let D in l)P=P.concat(g[D]?f.validateSpec({key:D,value:l[D],valueSpec:g[D],style:w,styleSpec:d}):[new We(D,l[D],`unknown property "${D}"`)]);return P},projectionDefinition:function(f){let l=f.key,d=f.value;d=d instanceof String?d.valueOf():d;let g=Ci(d);return g!=="array"||function(w){return Array.isArray(w)&&w.length===3&&typeof w[0]=="string"&&typeof w[1]=="string"&&typeof w[2]=="number"}(d)||function(w){return!!["interpolate","step","literal"].includes(w[0])}(d)?["array","string"].includes(g)?[]:[new We(l,d,`projection expected, invalid type "${g}" found`)]:[new We(l,d,`projection expected, invalid array ${JSON.stringify(d)} found`)]},string:Va,formatted:function(f){return Va(f).length===0?[]:Ua(f)},resolvedImage:function(f){return Va(f).length===0?[]:Ua(f)},padding:function(f){let l=f.key,d=f.value;if(Ci(d)==="array"){if(d.length<1||d.length>4)return[new We(l,d,`padding requires 1 to 4 values; ${d.length} values found`)];let g={type:"number"},w=[];for(let I=0;I<d.length;I++)w=w.concat(f.validateSpec({key:`${l}[${I}]`,value:d[I],validateSpec:f.validateSpec,valueSpec:g}));return w}return lc({key:l,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(f){let l=f.key,d=f.value,g=Ci(d),w=f.styleSpec;if(g!=="array"||d.length<1||d.length%2!=0)return[new We(l,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let I=[];for(let P=0;P<d.length;P+=2)I=I.concat(_h({key:`${l}[${P}]`,value:d[P],valueSpec:w.layout_symbol["text-anchor"]})),I=I.concat(sp({key:`${l}[${P+1}]`,value:d[P+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:w}));return I},sprite:ja};function No(f){let l=f.value,d=f.valueSpec,g=f.styleSpec;return f.validateSpec=No,d.expression&&Cf(Un(l))?ap(f):d.expression&&Ah(ac(l))?Ua(f):d.type&&Hi[d.type]?Hi[d.type](f):zs(Fr({},f,{valueSpec:d.type?g[d.type]:d}))}function au(f){let l=f.value,d=f.key,g=Va(f);return g.length||(l.indexOf("{fontstack}")===-1&&g.push(new We(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&g.push(new We(d,l,'"glyphs" url must include a "{range}" token'))),g}function Us(f,l=ce){let d=[];return d=d.concat(No({key:"",value:f,valueSpec:l.$root,styleSpec:l,style:f,validateSpec:No,objectElementValidators:{glyphs:au,"*":()=>[]}})),f.constants&&(d=d.concat(u0({key:"constants",value:f.constants}))),f0(d)}function Ea(f){return function(l){return f({...l,validateSpec:No})}}function f0(f){return[].concat(f).sort((l,d)=>l.line-d.line)}function ds(f){return function(...l){return f0(f.apply(this,l))}}Us.source=ds(Ea(h0)),Us.sprite=ds(Ea(ja)),Us.glyphs=ds(Ea(au)),Us.light=ds(Ea(up)),Us.sky=ds(Ea(Ff)),Us.terrain=ds(Ea(kf)),Us.layer=ds(Ea(su)),Us.filter=ds(Ea(dl)),Us.paintProperty=ds(Ea(Df)),Us.layoutProperty=ds(Ea(pl));let cc=Us,zo=cc.light,hp=cc.sky,Ga=cc.paintProperty,jg=cc.layoutProperty;function Al(f,l){let d=!1;if(l&&l.length)for(let g of l)f.fire(new de(new Error(g.message))),d=!0;return d}class yh{constructor(l,d,g){let w=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;let P=new Int32Array(this.arrayBuffer);l=P[0],this.d=(d=P[1])+2*(g=P[2]);for(let U=0;U<this.d*this.d;U++){let G=P[3+U],$=P[3+U+1];w.push(G===$?null:P.subarray(G,$))}let D=P[3+w.length+1];this.keys=P.subarray(P[3+w.length],D),this.bboxes=P.subarray(D),this.insert=this._insertReadonly}else{this.d=d+2*g;for(let P=0;P<this.d*this.d;P++)w.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=l,this.padding=g,this.scale=d/l,this.uid=0;let I=g/d*l;this.min=-I,this.max=l+I}insert(l,d,g,w,I){this._forEachCell(d,g,w,I,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(w),this.bboxes.push(I)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,d,g,w,I,P){this.cells[I].push(P)}query(l,d,g,w,I){let P=this.min,D=this.max;if(l<=P&&d<=P&&D<=g&&D<=w&&!I)return Array.prototype.slice.call(this.keys);{let U=[];return this._forEachCell(l,d,g,w,this._queryCell,U,{},I),U}}_queryCell(l,d,g,w,I,P,D,U){let G=this.cells[I];if(G!==null){let $=this.keys,Y=this.bboxes;for(let oe=0;oe<G.length;oe++){let le=G[oe];if(D[le]===void 0){let ue=4*le;(U?U(Y[ue+0],Y[ue+1],Y[ue+2],Y[ue+3]):l<=Y[ue+2]&&d<=Y[ue+3]&&g>=Y[ue+0]&&w>=Y[ue+1])?(D[le]=!0,P.push($[le])):D[le]=!1}}}}_forEachCell(l,d,g,w,I,P,D,U){let G=this._convertToCellCoord(l),$=this._convertToCellCoord(d),Y=this._convertToCellCoord(g),oe=this._convertToCellCoord(w);for(let le=G;le<=Y;le++)for(let ue=$;ue<=oe;ue++){let pe=this.d*ue+le;if((!U||U(this._convertFromCellCoord(le),this._convertFromCellCoord(ue),this._convertFromCellCoord(le+1),this._convertFromCellCoord(ue+1)))&&I.call(this,l,d,g,w,pe,P,D,U))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let l=this.cells,d=3+this.cells.length+1+1,g=0;for(let P=0;P<this.cells.length;P++)g+=this.cells[P].length;let w=new Int32Array(d+g+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;let I=d;for(let P=0;P<l.length;P++){let D=l[P];w[3+P]=I,w.set(D,I),I+=D.length}return w[3+l.length]=I,w.set(this.keys,I),I+=this.keys.length,w[3+l.length+1]=I,w.set(this.bboxes,I),I+=this.bboxes.length,w.buffer}static serialize(l,d){let g=l.toArrayBuffer();return d&&d.push(g),{buffer:g}}static deserialize(l){return new yh(l.buffer)}}let wn={};function ur(f,l,d={}){if(wn[f])throw new Error(`${f} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:f,writeable:!1}),wn[f]={klass:l,omit:d.omit||[],shallow:d.shallow||[]}}ur("Object",Object),ur("TransferableGridIndex",yh),ur("Color",Ti),ur("Error",Error),ur("AJAXError",Er),ur("ResolvedImage",Ss),ur("StylePropertyFunction",mh),ur("StyleExpression",tu,{omit:["_evaluator"]}),ur("ZoomDependentExpression",ru),ur("ZoomConstantExpression",Pf),ur("CompoundExpression",_i,{omit:["_evaluate"]});for(let f in Qc)Qc[f]._classRegistryKey||ur(`Expression_${f}`,Qc[f]);function Nf(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function ta(f){return f.$name||f.constructor._classRegistryKey}function lu(f){return!function(l){if(l===null||typeof l!="object")return!1;let d=ta(l);return!(!d||d==="Object")}(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||Nf(f)||tn(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function ra(f,l){if(lu(f))return(Nf(f)||tn(f))&&l&&l.push(f),ArrayBuffer.isView(f)&&l&&l.push(f.buffer),f instanceof ImageData&&l&&l.push(f.data.buffer),f;if(Array.isArray(f)){let I=[];for(let P of f)I.push(ra(P,l));return I}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);let d=ta(f);if(!d)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!wn[d])throw new Error(`${d} is not registered.`);let{klass:g}=wn[d],w=g.serialize?g.serialize(f,l):{};if(g.serialize){if(l&&w===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let I in f){if(!f.hasOwnProperty(I)||wn[d].omit.indexOf(I)>=0)continue;let P=f[I];w[I]=wn[d].shallow.indexOf(I)>=0?P:ra(P,l)}f instanceof Error&&(w.message=f.message)}if(w.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(w.$name=d),w}function ml(f){if(lu(f))return f;if(Array.isArray(f))return f.map(ml);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);let l=ta(f)||"Object";if(!wn[l])throw new Error(`can't deserialize unregistered class ${l}`);let{klass:d}=wn[l];if(!d)throw new Error(`can't deserialize unregistered class ${l}`);if(d.deserialize)return d.deserialize(f);let g=Object.create(d.prototype);for(let w of Object.keys(f)){if(w==="$name")continue;let I=f[w];g[w]=wn[l].shallow.indexOf(w)>=0?I:ml(I)}return g}class zf{constructor(){this.first=!0}update(l,d){let g=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=d),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=g,!0))}}let li={"Latin-1 Supplement":f=>f>=128&&f<=255,"Hangul Jamo":f=>f>=4352&&f<=4607,Khmer:f=>f>=6016&&f<=6143,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Kanbun:f=>f>=12688&&f<=12703,"CJK Strokes":f=>f>=12736&&f<=12783,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Hangul Syllables":f=>f>=44032&&f<=55215,"Private Use Area":f=>f>=57344&&f<=63743,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function cu(f){for(let l of f)if(gl(l.charCodeAt(0)))return!0;return!1}function d0(f){for(let l of f)if(!p0(l.charCodeAt(0)))return!1;return!0}function xh(f){let l=f.map(d=>{try{return new RegExp(`\\p{sc=${d}}`,"u").source}catch{return null}}).filter(d=>d);return new RegExp(l.join("|"),"u")}let fp=xh(["Arab","Dupl","Mong","Ougr","Syrc"]);function p0(f){return!fp.test(String.fromCodePoint(f))}let uc=xh(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function gl(f){return!(f!==746&&f!==747&&(f<4352||!(li["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||li["CJK Compatibility"](f)||li["CJK Strokes"](f)||!(!li["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||li["Enclosed CJK Letters and Months"](f)||li["Ideographic Description Characters"](f)||li.Kanbun(f)||li.Katakana(f)&&f!==12540||!(!li["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!li["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||li["Vertical Forms"](f)||li["Yijing Hexagram Symbols"](f)||/\p{sc=Cans}/u.test(String.fromCodePoint(f))||/\p{sc=Hang}/u.test(String.fromCodePoint(f))||uc.test(String.fromCodePoint(f)))))}function dp(f){return!(gl(f)||function(l){return!!(li["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||li["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||li["Letterlike Symbols"](l)||li["Number Forms"](l)||li["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||li["Control Pictures"](l)&&l!==9251||li["Optical Character Recognition"](l)||li["Enclosed Alphanumerics"](l)||li["Geometric Shapes"](l)||li["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||li["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||li["CJK Symbols and Punctuation"](l)||li.Katakana(l)||li["Private Use Area"](l)||li["CJK Compatibility Forms"](l)||li["Small Form Variants"](l)||li["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(f))}let uu=xh(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function pp(f){return uu.test(String.fromCodePoint(f))}function Gg(f,l){return!(!l&&pp(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||li.Khmer(f))}function Hg(f){for(let l of f)if(pp(l.charCodeAt(0)))return!0;return!1}let Ha=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){if(Ha.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(f,l){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(f.pluginStatus!=="loading")return this.setState(f),f;let d=f.pluginURL,g=new Promise(I=>{this.loadScriptResolve=I});l(d);let w=new Promise(I=>setTimeout(()=>I(),this.TIMEOUT));if(yield Promise.race([g,w]),this.isParsed()){let I={pluginStatus:"loaded",pluginURL:d};return this.setState(I),I}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${d}`)})}};class hn{constructor(l,d){this.zoom=l,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zf,this.transition={})}isSupportedScript(l){return function(d,g){for(let w of d)if(!Gg(w.charCodeAt(0),g))return!1;return!0}(l,Ha.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let l=this.zoom,d=l-Math.floor(l),g=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*d}}}class bh{constructor(l,d){this.property=l,this.value=d,this.expression=function(g,w){if(Cf(g))return new mh(g,w);if(Ah(g)){let I=fl(g,w);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));return I.value}{let I=g;return w.type==="color"&&typeof g=="string"?I=Ti.parse(g):w.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?w.type==="variableAnchorOffsetCollection"&&Array.isArray(g)?I=hs.parse(g):w.type==="projectionDefinition"&&typeof g=="string"&&(I=fo.parse(g)):I=Fo.parse(g),{kind:"constant",evaluate:()=>I}}}(d===void 0?l.specification.default:d,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,d,g){return this.property.possiblyEvaluate(this,l,d,g)}}class Uf{constructor(l){this.property=l,this.value=new bh(l,void 0)}transitioned(l,d){return new Ap(this.property,this.value,d,qt({},l.transition,this.transition),l.now)}untransitioned(){return new Ap(this.property,this.value,null,{},0)}}class hc{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return Dr(this._values[l].value.value)}setValue(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Uf(this._values[l].property)),this._values[l].value=new bh(this._values[l].property,d===null?void 0:Dr(d))}getTransition(l){return Dr(this._values[l].transition)}setTransition(l,d){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new Uf(this._values[l].property)),this._values[l].transition=Dr(d)||void 0}serialize(){let l={};for(let d of Object.keys(this._values)){let g=this.getValue(d);g!==void 0&&(l[d]=g);let w=this.getTransition(d);w!==void 0&&(l[`${d}-transition`]=w)}return l}transitioned(l,d){let g=new hu(this._properties);for(let w of Object.keys(this._values))g._values[w]=this._values[w].transitioned(l,d._values[w]);return g}untransitioned(){let l=new hu(this._properties);for(let d of Object.keys(this._values))l._values[d]=this._values[d].untransitioned();return l}}class Ap{constructor(l,d,g,w,I){this.property=l,this.value=d,this.begin=I+w.delay||0,this.end=this.begin+w.duration||0,l.specification.transition&&(w.delay||w.duration)&&(this.prior=g)}possiblyEvaluate(l,d,g){let w=l.now||0,I=this.value.possiblyEvaluate(l,d,g),P=this.prior;if(P){if(w>this.end)return this.prior=null,I;if(this.value.isDataDriven())return this.prior=null,I;if(w<this.begin)return P.possiblyEvaluate(l,d,g);{let D=(w-this.begin)/(this.end-this.begin);return this.property.interpolate(P.possiblyEvaluate(l,d,g),I,tt(D))}}return I}}class hu{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,d,g){let w=new vh(this._properties);for(let I of Object.keys(this._values))w._values[I]=this._values[I].possiblyEvaluate(l,d,g);return w}hasTransition(){for(let l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class Wg{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return Dr(this._values[l].value)}setValue(l,d){this._values[l]=new bh(this._values[l].property,d===null?void 0:Dr(d))}serialize(){let l={};for(let d of Object.keys(this._values)){let g=this.getValue(d);g!==void 0&&(l[d]=g)}return l}possiblyEvaluate(l,d,g){let w=new vh(this._properties);for(let I of Object.keys(this._values))w._values[I]=this._values[I].possiblyEvaluate(l,d,g);return w}}class Ca{constructor(l,d,g){this.property=l,this.value=d,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,d,g,w){return this.property.evaluate(this.value,this.parameters,l,d,g,w)}}class vh{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class xr{constructor(l){this.specification=l}possiblyEvaluate(l,d){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(d)}interpolate(l,d,g){let w=ya[this.specification.type];return w?w(l,d,g):l}}class Rr{constructor(l,d){this.specification=l,this.overrides=d}possiblyEvaluate(l,d,g,w){return new Ca(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(d,null,{},g,w)}:l.expression,d)}interpolate(l,d,g){if(l.value.kind!=="constant"||d.value.kind!=="constant")return l;if(l.value.value===void 0||d.value.value===void 0)return new Ca(this,{kind:"constant",value:void 0},l.parameters);let w=ya[this.specification.type];if(w){let I=w(l.value.value,d.value.value,g);return new Ca(this,{kind:"constant",value:I},l.parameters)}return l}evaluate(l,d,g,w,I,P){return l.kind==="constant"?l.value:l.evaluate(d,g,w,I,P)}}class Vf extends Rr{possiblyEvaluate(l,d,g,w){if(l.value===void 0)return new Ca(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){let I=l.expression.evaluate(d,null,{},g,w),P=l.property.specification.type==="resolvedImage"&&typeof I!="string"?I.name:I,D=this._calculate(P,P,P,d);return new Ca(this,{kind:"constant",value:D},d)}if(l.expression.kind==="camera"){let I=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new Ca(this,{kind:"constant",value:I},d)}return new Ca(this,l.expression,d)}evaluate(l,d,g,w,I,P){if(l.kind==="source"){let D=l.evaluate(d,g,w,I,P);return this._calculate(D,D,D,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},g,w),l.evaluate({zoom:Math.floor(d.zoom)},g,w),l.evaluate({zoom:Math.floor(d.zoom)+1},g,w),d):l.value}_calculate(l,d,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class mp{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,w){if(l.value!==void 0){if(l.expression.kind==="constant"){let I=l.expression.evaluate(d,null,{},g,w);return this._calculate(I,I,I,d)}return this._calculate(l.expression.evaluate(new hn(Math.floor(d.zoom-1),d)),l.expression.evaluate(new hn(Math.floor(d.zoom),d)),l.expression.evaluate(new hn(Math.floor(d.zoom+1),d)),d)}}_calculate(l,d,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:g,to:d}}interpolate(l){return l}}class jf{constructor(l){this.specification=l}possiblyEvaluate(l,d,g,w){return!!l.expression.evaluate(d,null,{},g,w)}interpolate(){return!1}}class ps{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let d in l){let g=l[d];g.specification.overridable&&this.overridableProperties.push(d);let w=this.defaultPropertyValues[d]=new bh(g,void 0),I=this.defaultTransitionablePropertyValues[d]=new Uf(g);this.defaultTransitioningPropertyValues[d]=I.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=w.possiblyEvaluate({})}}}ur("DataDrivenProperty",Rr),ur("DataConstantProperty",xr),ur("CrossFadedDataDrivenProperty",Vf),ur("CrossFadedProperty",mp),ur("ColorRampProperty",jf);let gp="-transition";class Bn extends ge{constructor(l,d){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Wg(d.layout)),d.paint)){this._transitionablePaint=new hc(d.paint);for(let g in l.paint)this.setPaintProperty(g,l.paint[g],{validate:!1});for(let g in l.layout)this.setLayoutProperty(g,l.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new vh(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,d,g={}){d!=null&&this._validate(jg,`layers.${this.id}.layout.${l}`,l,d,g)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)}getPaintProperty(l){return l.endsWith(gp)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,d,g={}){if(d!=null&&this._validate(Ga,`layers.${this.id}.paint.${l}`,l,d,g))return!1;if(l.endsWith(gp))return this._transitionablePaint.setTransition(l.slice(0,-11),d||void 0),!1;{let w=this._transitionablePaint._values[l],I=w.property.specification["property-type"]==="cross-faded-data-driven",P=w.value.isDataDriven(),D=w.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);let U=this._transitionablePaint._values[l].value;return U.isDataDriven()||P||I||this._handleOverridablePaintPropertyUpdate(l,D,U)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,d,g){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)}serialize(){let l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Or(l,(d,g)=>!(d===void 0||g==="layout"&&!Object.keys(d).length||g==="paint"&&!Object.keys(d).length))}_validate(l,d,g,w,I={}){return(!I||I.validate!==!1)&&Al(this,l.call(cc,{key:d,layerType:this.type,objectKey:g,value:w,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let l in this.paint._values){let d=this.paint.get(l);if(d instanceof Ca&&ic(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}let A0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wh{constructor(l,d){this._structArray=l,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,d){return l._trim(),d&&(l.isTransferred=!0,d.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){let d=Object.create(this.prototype);return d.arrayBuffer=l.arrayBuffer,d.length=l.length,d.capacity=l.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Vn(f,l=1){let d=0,g=0;return{members:f.map(w=>{let I=A0[w.type].BYTES_PER_ELEMENT,P=d=m0(d,Math.max(l,I)),D=w.components||1;return g=Math.max(g,I),d+=I*D,{name:w.name,type:w.type,components:D,offset:P}}),size:m0(d,Math.max(g,l)),alignment:l}}function m0(f,l){return Math.ceil(f/l)*l}class Th extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let w=2*l;return this.int16[w+0]=d,this.int16[w+1]=g,l}}Th.prototype.bytesPerElement=4,ur("StructArrayLayout2i4",Th);class wo extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.int16[I+0]=d,this.int16[I+1]=g,this.int16[I+2]=w,l}}wo.prototype.bytesPerElement=6,ur("StructArrayLayout3i6",wo);class Eh extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w){let I=this.length;return this.resize(I+1),this.emplace(I,l,d,g,w)}emplace(l,d,g,w,I){let P=4*l;return this.int16[P+0]=d,this.int16[P+1]=g,this.int16[P+2]=w,this.int16[P+3]=I,l}}Eh.prototype.bytesPerElement=8,ur("StructArrayLayout4i8",Eh);class fu extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=6*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.int16[U+2]=w,this.int16[U+3]=I,this.int16[U+4]=P,this.int16[U+5]=D,l}}fu.prototype.bytesPerElement=12,ur("StructArrayLayout2i4i12",fu);class Gf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=4*l,G=8*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.uint8[G+4]=w,this.uint8[G+5]=I,this.uint8[G+6]=P,this.uint8[G+7]=D,l}}Gf.prototype.bytesPerElement=8,ur("StructArrayLayout2i4ub8",Gf);class fc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let w=2*l;return this.float32[w+0]=d,this.float32[w+1]=g,l}}fc.prototype.bytesPerElement=8,ur("StructArrayLayout2f8",fc);class _p extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$){let Y=this.length;return this.resize(Y+1),this.emplace(Y,l,d,g,w,I,P,D,U,G,$)}emplace(l,d,g,w,I,P,D,U,G,$,Y){let oe=10*l;return this.uint16[oe+0]=d,this.uint16[oe+1]=g,this.uint16[oe+2]=w,this.uint16[oe+3]=I,this.uint16[oe+4]=P,this.uint16[oe+5]=D,this.uint16[oe+6]=U,this.uint16[oe+7]=G,this.uint16[oe+8]=$,this.uint16[oe+9]=Y,l}}_p.prototype.bytesPerElement=20,ur("StructArrayLayout10ui20",_p);class du extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$,Y,oe){let le=this.length;return this.resize(le+1),this.emplace(le,l,d,g,w,I,P,D,U,G,$,Y,oe)}emplace(l,d,g,w,I,P,D,U,G,$,Y,oe,le){let ue=12*l;return this.int16[ue+0]=d,this.int16[ue+1]=g,this.int16[ue+2]=w,this.int16[ue+3]=I,this.uint16[ue+4]=P,this.uint16[ue+5]=D,this.uint16[ue+6]=U,this.uint16[ue+7]=G,this.int16[ue+8]=$,this.int16[ue+9]=Y,this.int16[ue+10]=oe,this.int16[ue+11]=le,l}}du.prototype.bytesPerElement=24,ur("StructArrayLayout4i4ui4i24",du);class dc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.float32[I+0]=d,this.float32[I+1]=g,this.float32[I+2]=w,l}}dc.prototype.bytesPerElement=12,ur("StructArrayLayout3f12",dc);class yp extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint32[1*l+0]=d,l}}yp.prototype.bytesPerElement=4,ur("StructArrayLayout1ul4",yp);class Hf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G){let $=this.length;return this.resize($+1),this.emplace($,l,d,g,w,I,P,D,U,G)}emplace(l,d,g,w,I,P,D,U,G,$){let Y=10*l,oe=5*l;return this.int16[Y+0]=d,this.int16[Y+1]=g,this.int16[Y+2]=w,this.int16[Y+3]=I,this.int16[Y+4]=P,this.int16[Y+5]=D,this.uint32[oe+3]=U,this.uint16[Y+8]=G,this.uint16[Y+9]=$,l}}Hf.prototype.bytesPerElement=20,ur("StructArrayLayout6i1ul2ui20",Hf);class pc extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=6*l;return this.int16[U+0]=d,this.int16[U+1]=g,this.int16[U+2]=w,this.int16[U+3]=I,this.int16[U+4]=P,this.int16[U+5]=D,l}}pc.prototype.bytesPerElement=12,ur("StructArrayLayout2i2i2i12",pc);class xp extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I){let P=this.length;return this.resize(P+1),this.emplace(P,l,d,g,w,I)}emplace(l,d,g,w,I,P){let D=4*l,U=8*l;return this.float32[D+0]=d,this.float32[D+1]=g,this.float32[D+2]=w,this.int16[U+6]=I,this.int16[U+7]=P,l}}xp.prototype.bytesPerElement=16,ur("StructArrayLayout2f1f2i16",xp);class bp extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P){let D=this.length;return this.resize(D+1),this.emplace(D,l,d,g,w,I,P)}emplace(l,d,g,w,I,P,D){let U=16*l,G=4*l,$=8*l;return this.uint8[U+0]=d,this.uint8[U+1]=g,this.float32[G+1]=w,this.float32[G+2]=I,this.int16[$+6]=P,this.int16[$+7]=D,l}}bp.prototype.bytesPerElement=16,ur("StructArrayLayout2ub2f2i16",bp);class Ch extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.uint16[I+0]=d,this.uint16[I+1]=g,this.uint16[I+2]=w,l}}Ch.prototype.bytesPerElement=6,ur("StructArrayLayout3ui6",Ch);class Wf extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue,pe,Te,Re){let et=this.length;return this.resize(et+1),this.emplace(et,l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue,pe,Te,Re)}emplace(l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue,pe,Te,Re,et){let Ne=24*l,ae=12*l,xe=48*l;return this.int16[Ne+0]=d,this.int16[Ne+1]=g,this.uint16[Ne+2]=w,this.uint16[Ne+3]=I,this.uint32[ae+2]=P,this.uint32[ae+3]=D,this.uint32[ae+4]=U,this.uint16[Ne+10]=G,this.uint16[Ne+11]=$,this.uint16[Ne+12]=Y,this.float32[ae+7]=oe,this.float32[ae+8]=le,this.uint8[xe+36]=ue,this.uint8[xe+37]=pe,this.uint8[xe+38]=Te,this.uint32[ae+10]=Re,this.int16[Ne+22]=et,l}}Wf.prototype.bytesPerElement=48,ur("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Wf);class C extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue,pe,Te,Re,et,Ne,ae,xe,He,xt,Ht,Et,Rt,Yt,$t){let Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue,pe,Te,Re,et,Ne,ae,xe,He,xt,Ht,Et,Rt,Yt,$t)}emplace(l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue,pe,Te,Re,et,Ne,ae,xe,He,xt,Ht,Et,Rt,Yt,$t,Qt){let Dt=32*l,Ar=16*l;return this.int16[Dt+0]=d,this.int16[Dt+1]=g,this.int16[Dt+2]=w,this.int16[Dt+3]=I,this.int16[Dt+4]=P,this.int16[Dt+5]=D,this.int16[Dt+6]=U,this.int16[Dt+7]=G,this.uint16[Dt+8]=$,this.uint16[Dt+9]=Y,this.uint16[Dt+10]=oe,this.uint16[Dt+11]=le,this.uint16[Dt+12]=ue,this.uint16[Dt+13]=pe,this.uint16[Dt+14]=Te,this.uint16[Dt+15]=Re,this.uint16[Dt+16]=et,this.uint16[Dt+17]=Ne,this.uint16[Dt+18]=ae,this.uint16[Dt+19]=xe,this.uint16[Dt+20]=He,this.uint16[Dt+21]=xt,this.uint16[Dt+22]=Ht,this.uint32[Ar+12]=Et,this.float32[Ar+13]=Rt,this.float32[Ar+14]=Yt,this.uint16[Dt+30]=$t,this.uint16[Dt+31]=Qt,l}}C.prototype.bytesPerElement=64,ur("StructArrayLayout8i15ui1ul2f2ui64",C);class s extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.float32[1*l+0]=d,l}}s.prototype.bytesPerElement=4,ur("StructArrayLayout1f4",s);class u extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=3*l;return this.uint16[6*l+0]=d,this.float32[I+1]=g,this.float32[I+2]=w,l}}u.prototype.bytesPerElement=12,ur("StructArrayLayout1ui2f12",u);class _ extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,d,g)}emplace(l,d,g,w){let I=4*l;return this.uint32[2*l+0]=d,this.uint16[I+2]=g,this.uint16[I+3]=w,l}}_.prototype.bytesPerElement=8,ur("StructArrayLayout1ul2ui8",_);class v extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,d){let g=this.length;return this.resize(g+1),this.emplace(g,l,d)}emplace(l,d,g){let w=2*l;return this.uint16[w+0]=d,this.uint16[w+1]=g,l}}v.prototype.bytesPerElement=4,ur("StructArrayLayout2ui4",v);class S extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){let d=this.length;return this.resize(d+1),this.emplace(d,l)}emplace(l,d){return this.uint16[1*l+0]=d,l}}S.prototype.bytesPerElement=2,ur("StructArrayLayout1ui2",S);class O extends Ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,d,g,w){let I=this.length;return this.resize(I+1),this.emplace(I,l,d,g,w)}emplace(l,d,g,w,I){let P=4*l;return this.float32[P+0]=d,this.float32[P+1]=g,this.float32[P+2]=w,this.float32[P+3]=I,l}}O.prototype.bytesPerElement=16,ur("StructArrayLayout4f16",O);class z extends wh{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new R(this.anchorPointX,this.anchorPointY)}}z.prototype.size=20;class V extends Hf{get(l){return new z(this,l)}}ur("CollisionBoxArray",V);class H extends wh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}H.prototype.size=48;class K extends Wf{get(l){return new H(this,l)}}ur("PlacedSymbolArray",K);class ne extends wh{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ne.prototype.size=64;class ie extends C{get(l){return new ne(this,l)}}ur("SymbolInstanceArray",ie);class fe extends s{getoffsetX(l){return this.float32[1*l+0]}}ur("GlyphOffsetArray",fe);class Ae extends wo{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}ur("SymbolLineVertexArray",Ae);class Ie extends wh{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ie.prototype.size=12;class Ce extends u{get(l){return new Ie(this,l)}}ur("TextAnchorOffsetArray",Ce);class Pe extends wh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Pe.prototype.size=8;class Fe extends _{get(l){return new Pe(this,l)}}ur("FeatureIndexArray",Fe);class Ve extends Th{}class Be extends Th{}class qe extends Th{}class Ge extends fu{}class Ze extends Gf{}class _t extends fc{}class At extends _p{}class Pt extends du{}class Lt extends dc{}class Tt extends yp{}class er extends pc{}class Kt extends bp{}class Ut extends Ch{}class mt extends v{}let Nt=Vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ri}=Nt;class Hr{constructor(l=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=l}prepareSegment(l,d,g,w){let I=this.segments[this.segments.length-1];return l>Hr.MAX_VERTEX_ARRAY_LENGTH&&ki(`Max vertices per segment is ${Hr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Hr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!I||I.vertexLength+l>Hr.MAX_VERTEX_ARRAY_LENGTH||I.sortKey!==w?this.createNewSegment(d,g,w):I}createNewSegment(l,d,g){let w={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0,vaos:{}};return g!==void 0&&(w.sortKey=g),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(w),w}getOrCreateLatestSegment(l,d,g){return this.prepareSegment(0,l,d,g)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let l of this.segments)for(let d in l.vaos)l.vaos[d].destroy()}static simpleSegment(l,d,g,w){return new Hr([{vertexOffset:l,primitiveOffset:d,vertexLength:g,primitiveLength:w,vaos:{},sortKey:0}])}}function zi(f,l){return 256*(f=jt(Math.floor(f),0,255))+jt(Math.floor(l),0,255)}Hr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ur("SegmentVector",Hr);let Zi=Vn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ui,Wi,vi,m={exports:{}},A={exports:{}},b={exports:{}},E=function(){if(vi)return m.exports;vi=1;var f=(Ui||(Ui=1,A.exports=function(d,g){var w,I,P,D,U,G,$,Y;for(I=d.length-(w=3&d.length),P=g,U=3432918353,G=461845907,Y=0;Y<I;)$=255&d.charCodeAt(Y)|(255&d.charCodeAt(++Y))<<8|(255&d.charCodeAt(++Y))<<16|(255&d.charCodeAt(++Y))<<24,++Y,P=27492+(65535&(D=5*(65535&(P=(P^=$=(65535&($=($=(65535&$)*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch($=0,w){case 3:$^=(255&d.charCodeAt(Y+2))<<16;case 2:$^=(255&d.charCodeAt(Y+1))<<8;case 1:P^=$=(65535&($=($=(65535&($^=255&d.charCodeAt(Y)))*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295}return P^=d.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0}),A.exports),l=(Wi||(Wi=1,b.exports=function(d,g){for(var w,I=d.length,P=g^I,D=0;I>=4;)w=1540483477*(65535&(w=255&d.charCodeAt(D)|(255&d.charCodeAt(++D))<<8|(255&d.charCodeAt(++D))<<16|(255&d.charCodeAt(++D))<<24))+((1540483477*(w>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(w=1540483477*(65535&(w^=w>>>24))+((1540483477*(w>>>16)&65535)<<16)),I-=4,++D;switch(I){case 3:P^=(255&d.charCodeAt(D+2))<<16;case 2:P^=(255&d.charCodeAt(D+1))<<8;case 1:P=1540483477*(65535&(P^=255&d.charCodeAt(D)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0}),b.exports);return m.exports=f,m.exports.murmur3=f,m.exports.murmur2=l,m.exports}(),M=a(E);class B{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,d,g,w){this.ids.push(F(l)),this.positions.push(d,g,w)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let d=F(l),g=0,w=this.ids.length-1;for(;g<w;){let P=g+w>>1;this.ids[P]>=d?w=P:g=P+1}let I=[];for(;this.ids[g]===d;)I.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return I}static serialize(l,d){let g=new Float64Array(l.ids),w=new Uint32Array(l.positions);return N(g,w,0,g.length-1),d&&d.push(g.buffer,w.buffer),{ids:g,positions:w}}static deserialize(l){let d=new B;return d.ids=l.ids,d.positions=l.positions,d.indexed=!0,d}}function F(f){let l=+f;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:M(String(f))}function N(f,l,d,g){for(;d<g;){let w=f[d+g>>1],I=d-1,P=g+1;for(;;){do I++;while(f[I]<w);do P--;while(f[P]>w);if(I>=P)break;W(f,I,P),W(l,3*I,3*P),W(l,3*I+1,3*P+1),W(l,3*I+2,3*P+2)}P-d<g-P?(N(f,l,d,P),d=P+1):(N(f,l,P+1,g),g=P)}}function W(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}ur("FeaturePositionMap",B);class Q{constructor(l,d){this.gl=l.gl,this.location=d}}class he extends Q{constructor(l,d){super(l,d),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class we extends Q{constructor(l,d){super(l,d),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class $e extends Q{constructor(l,d){super(l,d),this.current=Ti.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}let Qe=new Float32Array(16);function Ue(f){return[zi(255*f.r,255*f.g),zi(255*f.b,255*f.a)]}class nt{constructor(l,d,g){this.value=l,this.uniformNames=d.map(w=>`u_${w}`),this.type=g}setUniform(l,d,g){l.set(g.constantOr(this.value))}getBinding(l,d,g){return this.type==="color"?new $e(l,d):new he(l,d)}}class It{constructor(l,d){this.uniformNames=d.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=l.tlbr}setUniform(l,d,g,w){let I=w==="u_pattern_to"?this.patternTo:w==="u_pattern_from"?this.patternFrom:w==="u_pixel_ratio_to"?this.pixelRatioTo:w==="u_pixel_ratio_from"?this.pixelRatioFrom:null;I&&l.set(I)}getBinding(l,d,g){return g.substr(0,9)==="u_pattern"?new we(l,d):new he(l,d)}}class wt{constructor(l,d,g,w){this.expression=l,this.type=g,this.maxValue=0,this.paintVertexAttributes=d.map(I=>({name:`a_${I}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new w}populatePaintArray(l,d,g,w,I){let P=this.paintVertexArray.length,D=this.expression.evaluate(new hn(0),d,{},w,[],I);this.paintVertexArray.resize(l),this._setPaintValue(P,l,D)}updatePaintArray(l,d,g,w){let I=this.expression.evaluate({zoom:0},g,w);this._setPaintValue(l,d,I)}_setPaintValue(l,d,g){if(this.type==="color"){let w=Ue(g);for(let I=l;I<d;I++)this.paintVertexArray.emplace(I,w[0],w[1])}else{for(let w=l;w<d;w++)this.paintVertexArray.emplace(w,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class at{constructor(l,d,g,w,I,P){this.expression=l,this.uniformNames=d.map(D=>`u_${D}_t`),this.type=g,this.useIntegerZoom=w,this.zoom=I,this.maxValue=0,this.paintVertexAttributes=d.map(D=>({name:`a_${D}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new P}populatePaintArray(l,d,g,w,I){let P=this.expression.evaluate(new hn(this.zoom),d,{},w,[],I),D=this.expression.evaluate(new hn(this.zoom+1),d,{},w,[],I),U=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(U,l,P,D)}updatePaintArray(l,d,g,w){let I=this.expression.evaluate({zoom:this.zoom},g,w),P=this.expression.evaluate({zoom:this.zoom+1},g,w);this._setPaintValue(l,d,I,P)}_setPaintValue(l,d,g,w){if(this.type==="color"){let I=Ue(g),P=Ue(w);for(let D=l;D<d;D++)this.paintVertexArray.emplace(D,I[0],I[1],P[0],P[1])}else{for(let I=l;I<d;I++)this.paintVertexArray.emplace(I,g,w);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(w))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,d){let g=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,w=jt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);l.set(w)}getBinding(l,d,g){return new he(l,d)}}class bt{constructor(l,d,g,w,I,P){this.expression=l,this.type=d,this.useIntegerZoom=g,this.zoom=w,this.layerId=P,this.zoomInPaintVertexArray=new I,this.zoomOutPaintVertexArray=new I}populatePaintArray(l,d,g){let w=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(w,l,d.patterns&&d.patterns[this.layerId],g)}updatePaintArray(l,d,g,w,I){this._setPaintValues(l,d,g.patterns&&g.patterns[this.layerId],I)}_setPaintValues(l,d,g,w){if(!w||!g)return;let{min:I,mid:P,max:D}=g,U=w[I],G=w[P],$=w[D];if(U&&G&&$)for(let Y=l;Y<d;Y++)this.zoomInPaintVertexArray.emplace(Y,G.tl[0],G.tl[1],G.br[0],G.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],G.pixelRatio,U.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,G.tl[0],G.tl[1],G.br[0],G.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],G.pixelRatio,$.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,Zi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,Zi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ft{constructor(l,d,g){this.binders={},this._buffers=[];let w=[];for(let I in l.paint._values){if(!g(I))continue;let P=l.paint.get(I);if(!(P instanceof Ca&&ic(P.property.specification)))continue;let D=mr(I,l.type),U=P.value,G=P.property.specification.type,$=P.property.useIntegerZoom,Y=P.property.specification["property-type"],oe=Y==="cross-faded"||Y==="cross-faded-data-driven";if(U.kind==="constant")this.binders[I]=oe?new It(U.value,D):new nt(U.value,D,G),w.push(`/u_${I}`);else if(U.kind==="source"||oe){let le=or(I,G,"source");this.binders[I]=oe?new bt(U,G,$,d,le,l.id):new wt(U,D,G,le),w.push(`/a_${I}`)}else{let le=or(I,G,"composite");this.binders[I]=new at(U,D,G,$,d,le),w.push(`/z_${I}`)}}this.cacheKey=w.sort().join("")}getMaxValue(l){let d=this.binders[l];return d instanceof wt||d instanceof at?d.maxValue:0}populatePaintArrays(l,d,g,w,I){for(let P in this.binders){let D=this.binders[P];(D instanceof wt||D instanceof at||D instanceof bt)&&D.populatePaintArray(l,d,g,w,I)}}setConstantPatternPositions(l,d){for(let g in this.binders){let w=this.binders[g];w instanceof It&&w.setConstantPatternPositions(l,d)}}updatePaintArrays(l,d,g,w,I){let P=!1;for(let D in l){let U=d.getPositions(D);for(let G of U){let $=g.feature(G.index);for(let Y in this.binders){let oe=this.binders[Y];if((oe instanceof wt||oe instanceof at||oe instanceof bt)&&oe.expression.isStateDependent===!0){let le=w.paint.get(Y);oe.expression=le.value,oe.updatePaintArray(G.start,G.end,$,l[D],I),P=!0}}}}return P}defines(){let l=[];for(let d in this.binders){let g=this.binders[d];(g instanceof nt||g instanceof It)&&l.push(...g.uniformNames.map(w=>`#define HAS_UNIFORM_${w}`))}return l}getBinderAttributes(){let l=[];for(let d in this.binders){let g=this.binders[d];if(g instanceof wt||g instanceof at)for(let w=0;w<g.paintVertexAttributes.length;w++)l.push(g.paintVertexAttributes[w].name);else if(g instanceof bt)for(let w=0;w<Zi.members.length;w++)l.push(Zi.members[w].name)}return l}getBinderUniforms(){let l=[];for(let d in this.binders){let g=this.binders[d];if(g instanceof nt||g instanceof It||g instanceof at)for(let w of g.uniformNames)l.push(w)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,d){let g=[];for(let w in this.binders){let I=this.binders[w];if(I instanceof nt||I instanceof It||I instanceof at){for(let P of I.uniformNames)if(d[P]){let D=I.getBinding(l,d[P],P);g.push({name:P,property:w,binding:D})}}}return g}setUniforms(l,d,g,w){for(let{name:I,property:P,binding:D}of d)this.binders[P].setUniform(D,w,g.get(P),I)}updatePaintBuffers(l){this._buffers=[];for(let d in this.binders){let g=this.binders[d];if(l&&g instanceof bt){let w=l.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;w&&this._buffers.push(w)}else(g instanceof wt||g instanceof at)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(l){for(let d in this.binders){let g=this.binders[d];(g instanceof wt||g instanceof at||g instanceof bt)&&g.upload(l)}this.updatePaintBuffers()}destroy(){for(let l in this.binders){let d=this.binders[l];(d instanceof wt||d instanceof at||d instanceof bt)&&d.destroy()}}}class ar{constructor(l,d,g=()=>!0){this.programConfigurations={};for(let w of l)this.programConfigurations[w.id]=new ft(w,d,g);this.needsUpload=!1,this._featureMap=new B,this._bufferOffset=0}populatePaintArrays(l,d,g,w,I,P){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(l,d,w,I,P);d.id!==void 0&&this._featureMap.add(d.id,g,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,d,g,w){for(let I of g)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(l,this._featureMap,d,I,w)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(let d in this.programConfigurations)this.programConfigurations[d].upload(l);this.needsUpload=!1}}destroy(){for(let l in this.programConfigurations)this.programConfigurations[l].destroy()}}function mr(f,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${l}-`,"").replace(/-/g,"_")]}function or(f,l,d){let g={color:{source:fc,composite:O},number:{source:s,composite:fc}},w=function(I){return{"line-pattern":{source:At,composite:At},"fill-pattern":{source:At,composite:At},"fill-extrusion-pattern":{source:At,composite:At}}[I]}(f);return w&&w[d]||g[l][d]}ur("ConstantBinder",nt),ur("CrossFadedConstantBinder",It),ur("SourceExpressionBinder",wt),ur("CrossFadedCompositeBinder",bt),ur("CompositeExpressionBinder",at),ur("ProgramConfiguration",ft,{omit:["_buffers"]}),ur("ProgramConfigurationSet",ar);let lr=Math.pow(2,14)-1,Ai=-lr-1;function ri(f){let l=ve/f.extent,d=f.loadGeometry();for(let g=0;g<d.length;g++){let w=d[g];for(let I=0;I<w.length;I++){let P=w[I],D=Math.round(P.x*l),U=Math.round(P.y*l);P.x=jt(D,Ai,lr),P.y=jt(U,Ai,lr),(D<P.x||D>P.x+1||U<P.y||U>P.y+1)&&ki("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function ni(f,l){return{type:f.type,id:f.id,properties:f.properties,geometry:l?ri(f):[]}}let Wr=-32768;function Vr(f,l,d,g,w){f.emplaceBack(Wr+8*l+g,Wr+8*d+w)}class Gr{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.indexArray=new Ut,this.segments=new Hr,this.programConfigurations=new ar(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){let w=this.layers[0],I=[],P=null,D=!1,U=w.type==="heatmap";if(w.type==="circle"){let $=w;P=$.layout.get("circle-sort-key"),D=!P.isConstant(),U=U||$.paint.get("circle-pitch-alignment")==="map"}let G=U?d.subdivisionGranularity.circle:1;for(let{feature:$,id:Y,index:oe,sourceLayerIndex:le}of l){let ue=this.layers[0]._featureFilter.needGeometry,pe=ni($,ue);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),pe,g))continue;let Te=D?P.evaluate(pe,{},g):void 0,Re={id:Y,properties:$.properties,type:$.type,sourceLayerIndex:le,index:oe,geometry:ue?pe.geometry:ri($),patterns:{},sortKey:Te};I.push(Re)}D&&I.sort(($,Y)=>$.sortKey-Y.sortKey);for(let $ of I){let{geometry:Y,index:oe,sourceLayerIndex:le}=$,ue=l[oe].feature;this.addFeature($,Y,oe,g,G),d.featureIndex.insert(ue,Y,oe,le,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ri),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,d,g,w,I=1){let P;switch(I){case 1:P=[0,7];break;case 3:P=[0,2,5,7];break;case 5:P=[0,1,3,4,6,7];break;case 7:P=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${I}; valid values are 1, 3, 5, 7.`)}let D=P.length;for(let U of d)for(let G of U){let $=G.x,Y=G.y;if($<0||$>=ve||Y<0||Y>=ve)continue;let oe=this.segments.prepareSegment(D*D,this.layoutVertexArray,this.indexArray,l.sortKey),le=oe.vertexLength;for(let ue=0;ue<D;ue++)for(let pe=0;pe<D;pe++)Vr(this.layoutVertexArray,$,Y,P[pe],P[ue]);for(let ue=0;ue<D-1;ue++)for(let pe=0;pe<D-1;pe++){let Te=le+ue*D+pe,Re=le+(ue+1)*D+pe;this.indexArray.emplaceBack(Te,Re+1,Te+1),this.indexArray.emplaceBack(Te,Re,Re+1)}oe.vertexLength+=D*D,oe.primitiveLength+=(D-1)*(D-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,{},w)}}function Vi(f,l){for(let d=0;d<f.length;d++)if(vp(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(vp(f,l[d]))return!0;return!!g0(f,l)}function $r(f,l,d){return!!vp(f,l)||!!iE(l,f,d)}function fn(f,l){if(f.length===1)return oR(l,f[0]);for(let d=0;d<l.length;d++){let g=l[d];for(let w=0;w<g.length;w++)if(vp(f,g[w]))return!0}for(let d=0;d<f.length;d++)if(oR(l,f[d]))return!0;for(let d=0;d<l.length;d++)if(g0(f,l[d]))return!0;return!1}function Rs(f,l,d){if(f.length>1){if(g0(f,l))return!0;for(let g=0;g<l.length;g++)if(iE(l[g],f,d))return!0}for(let g=0;g<f.length;g++)if(iE(f[g],l,d))return!0;return!1}function g0(f,l){if(f.length===0||l.length===0)return!1;for(let d=0;d<f.length-1;d++){let g=f[d],w=f[d+1];for(let I=0;I<l.length-1;I++)if(LW(g,w,l[I],l[I+1]))return!0}return!1}function LW(f,l,d,g){return ei(f,d,g)!==ei(l,d,g)&&ei(f,l,d)!==ei(f,l,g)}function iE(f,l,d){let g=d*d;if(l.length===1)return f.distSqr(l[0])<g;for(let w=1;w<l.length;w++)if(nR(f,l[w-1],l[w])<g)return!0;return!1}function nR(f,l,d){let g=l.distSqr(d);if(g===0)return f.distSqr(l);let w=((f.x-l.x)*(d.x-l.x)+(f.y-l.y)*(d.y-l.y))/g;return f.distSqr(w<0?l:w>1?d:d.sub(l)._mult(w)._add(l))}function oR(f,l){for(let d=0;d<f.length;d++)if(vp(f[d],l))return!0;return!1}function vp(f,l){let d=!1;for(let g=0,w=f.length-1;g<f.length;w=g++){let I=f[g],P=f[w];I.y>l.y!=P.y>l.y&&l.x<(P.x-I.x)*(l.y-I.y)/(P.y-I.y)+I.x&&(d=!d)}return d}function OW(f,l,d){let g=d[0],w=d[2];if(f.x<g.x&&l.x<g.x||f.x>w.x&&l.x>w.x||f.y<g.y&&l.y<g.y||f.y>w.y&&l.y>w.y)return!1;let I=ei(f,l,d[0]);return I!==ei(f,l,d[1])||I!==ei(f,l,d[2])||I!==ei(f,l,d[3])}function $g(f,l,d){let g=l.paint.get(f).value;return g.kind==="constant"?g.value:d.programConfigurations.get(l.id).getMaxValue(f)}function h2(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function f2(f,l,d,g,w){if(!l[0]&&!l[1])return f;let I=R.convert(l)._mult(w);d==="viewport"&&I._rotate(-g);let P=[];for(let D=0;D<f.length;D++)P.push(f[D].sub(I));return P}let sR,aR;ur("CircleBucket",Gr,{omit:["layers"]});var DW={get paint(){return aR=aR||new ps({"circle-radius":new Rr(ce.paint_circle["circle-radius"]),"circle-color":new Rr(ce.paint_circle["circle-color"]),"circle-blur":new Rr(ce.paint_circle["circle-blur"]),"circle-opacity":new Rr(ce.paint_circle["circle-opacity"]),"circle-translate":new xr(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new xr(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xr(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xr(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rr(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rr(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rr(ce.paint_circle["circle-stroke-opacity"])})},get layout(){return sR=sR||new ps({"circle-sort-key":new Rr(ce.layout_circle["circle-sort-key"])})}};class FW extends Bn{constructor(l){super(l,DW)}createBucket(l){return new Gr(l)}queryRadius(l){let d=l;return $g("circle-radius",this,d)+$g("circle-stroke-width",this,d)+h2(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:w,transform:I,pixelsToTileUnits:P,unwrappedTileID:D,getElevation:U}){let G=f2(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-I.bearingInRadians,P),$=this.paint.get("circle-radius").evaluate(d,g)+this.paint.get("circle-stroke-width").evaluate(d,g),Y=this.paint.get("circle-pitch-alignment")==="map",oe=Y?G:function(ue,pe,Te,Re){return ue.map(et=>lR(et,pe,Te,Re))}(G,I,D,U),le=Y?$*P:$;for(let ue of w)for(let pe of ue){let Te=Y?pe:lR(pe,I,D,U),Re=le,et=I.projectTileCoordinates(pe.x,pe.y,D,U).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Re*=et/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Re*=I.cameraToCenterDistance/et),$r(oe,Te,Re))return!0}return!1}}function lR(f,l,d,g){let w=l.projectTileCoordinates(f.x,f.y,d,g).point;return new R((.5*w.x+.5)*l.width,(.5*-w.y+.5)*l.height)}class cR extends Gr{}let uR;ur("HeatmapBucket",cR,{omit:["layers"]});var kW={get paint(){return uR=uR||new ps({"heatmap-radius":new Rr(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rr(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xr(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jf(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xr(ce.paint_heatmap["heatmap-opacity"])})}};function nE(f,{width:l,height:d},g,w){if(w){if(w instanceof Uint8ClampedArray)w=new Uint8Array(w.buffer);else if(w.length!==l*d*g)throw new RangeError(`mismatched image size. expected: ${w.length} but got: ${l*d*g}`)}else w=new Uint8Array(l*d*g);return f.width=l,f.height=d,f.data=w,f}function hR(f,{width:l,height:d},g){if(l===f.width&&d===f.height)return;let w=nE({},{width:l,height:d},g);oE(f,w,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,l),height:Math.min(f.height,d)},g),f.width=l,f.height=d,f.data=w.data}function oE(f,l,d,g,w,I){if(w.width===0||w.height===0)return l;if(w.width>f.width||w.height>f.height||d.x>f.width-w.width||d.y>f.height-w.height)throw new RangeError("out of range source coordinates for image copy");if(w.width>l.width||w.height>l.height||g.x>l.width-w.width||g.y>l.height-w.height)throw new RangeError("out of range destination coordinates for image copy");let P=f.data,D=l.data;if(P===D)throw new Error("srcData equals dstData, so image is already copied");for(let U=0;U<w.height;U++){let G=((d.y+U)*f.width+d.x)*I,$=((g.y+U)*l.width+g.x)*I;for(let Y=0;Y<w.width*I;Y++)D[$+Y]=P[G+Y]}return l}class qg{constructor(l,d){nE(this,l,1,d)}resize(l){hR(this,l,1)}clone(){return new qg({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,w,I){oE(l,d,g,w,I,1)}}class Wa{constructor(l,d){nE(this,l,4,d)}resize(l){hR(this,l,4)}replace(l,d){d?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Wa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,d,g,w,I){oE(l,d,g,w,I,4)}}function fR(f){let l={},d=f.resolution||256,g=f.clips?f.clips.length:1,w=f.image||new Wa({width:d,height:g});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);let I=(P,D,U)=>{l[f.evaluationKey]=U;let G=f.expression.evaluate(l);w.data[P+D+0]=Math.floor(255*G.r/G.a),w.data[P+D+1]=Math.floor(255*G.g/G.a),w.data[P+D+2]=Math.floor(255*G.b/G.a),w.data[P+D+3]=Math.floor(255*G.a)};if(f.clips)for(let P=0,D=0;P<g;++P,D+=4*d)for(let U=0,G=0;U<d;U++,G+=4){let $=U/(d-1),{start:Y,end:oe}=f.clips[P];I(D,G,Y*(1-$)+oe*$)}else for(let P=0,D=0;P<d;P++,D+=4)I(0,D,P/(d-1));return w}ur("AlphaImage",qg),ur("RGBAImage",Wa);let sE="big-fb";class NW extends Bn{createBucket(l){return new cR(l)}constructor(l){super(l,kW),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fR({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(sE)&&this.heatmapFbos.delete(sE)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dR;var zW={get paint(){return dR=dR||new ps({"hillshade-illumination-direction":new xr(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xr(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xr(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xr(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xr(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xr(ce.paint_hillshade["hillshade-accent-color"])})}};class UW extends Bn{constructor(l){super(l,zW)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let VW=Vn([{name:"a_pos",components:2,type:"Int16"}],4),{members:jW}=VW;function aE(f,l,d){let g=d.patternDependencies,w=!1;for(let I of l){let P=I.paint.get(`${f}-pattern`);P.isConstant()||(w=!0);let D=P.constantOr(null);D&&(w=!0,g[D.to]=!0,g[D.from]=!0)}return w}function lE(f,l,d,g,w){let I=w.patternDependencies;for(let P of l){let D=P.paint.get(`${f}-pattern`).value;if(D.kind!=="constant"){let U=D.evaluate({zoom:g-1},d,{},w.availableImages),G=D.evaluate({zoom:g},d,{},w.availableImages),$=D.evaluate({zoom:g+1},d,{},w.availableImages);U=U&&U.name?U.name:U,G=G&&G.name?G.name:G,$=$&&$.name?$.name:$,I[U]=!0,I[G]=!0,I[$]=!0,d.patterns[P.id]={min:U,mid:G,max:$}}}return d}function pR(f,l,d,g,w){let I;if(w===function(P,D,U,G){let $=0;for(let Y=D,oe=U-G;Y<U;Y+=G)$+=(P[oe]-P[Y])*(P[Y+1]+P[oe+1]),oe=Y;return $}(f,l,d,g)>0)for(let P=l;P<d;P+=g)I=_R(P/g|0,f[P],f[P+1],I);else for(let P=d-g;P>=l;P-=g)I=_R(P/g|0,f[P],f[P+1],I);return I&&_0(I,I.next)&&(Kg(I),I=I.next),I}function wp(f,l){if(!f)return f;l||(l=f);let d,g=f;do if(d=!1,g.steiner||!_0(g,g.next)&&ro(g.prev,g,g.next)!==0)g=g.next;else{if(Kg(g),g=l=g.prev,g===g.next)break;d=!0}while(d||g!==l);return l}function Zg(f,l,d,g,w,I,P){if(!f)return;!P&&I&&function(U,G,$,Y){let oe=U;do oe.z===0&&(oe.z=cE(oe.x,oe.y,G,$,Y)),oe.prevZ=oe.prev,oe.nextZ=oe.next,oe=oe.next;while(oe!==U);oe.prevZ.nextZ=null,oe.prevZ=null,function(le){let ue,pe=1;do{let Te,Re=le;le=null;let et=null;for(ue=0;Re;){ue++;let Ne=Re,ae=0;for(let He=0;He<pe&&(ae++,Ne=Ne.nextZ,Ne);He++);let xe=pe;for(;ae>0||xe>0&&Ne;)ae!==0&&(xe===0||!Ne||Re.z<=Ne.z)?(Te=Re,Re=Re.nextZ,ae--):(Te=Ne,Ne=Ne.nextZ,xe--),et?et.nextZ=Te:le=Te,Te.prevZ=et,et=Te;Re=Ne}et.nextZ=null,pe*=2}while(ue>1)}(oe)}(f,g,w,I);let D=f;for(;f.prev!==f.next;){let U=f.prev,G=f.next;if(I?HW(f,g,w,I):GW(f))l.push(U.i,f.i,G.i),Kg(f),f=G.next,D=G.next;else if((f=G)===D){P?P===1?Zg(f=WW(wp(f),l),l,d,g,w,I,2):P===2&&$W(f,l,d,g,w,I):Zg(wp(f),l,d,g,w,I,1);break}}}function GW(f){let l=f.prev,d=f,g=f.next;if(ro(l,d,g)>=0)return!1;let w=l.x,I=d.x,P=g.x,D=l.y,U=d.y,G=g.y,$=Math.min(w,I,P),Y=Math.min(D,U,G),oe=Math.max(w,I,P),le=Math.max(D,U,G),ue=g.next;for(;ue!==l;){if(ue.x>=$&&ue.x<=oe&&ue.y>=Y&&ue.y<=le&&Xg(w,D,I,U,P,G,ue.x,ue.y)&&ro(ue.prev,ue,ue.next)>=0)return!1;ue=ue.next}return!0}function HW(f,l,d,g){let w=f.prev,I=f,P=f.next;if(ro(w,I,P)>=0)return!1;let D=w.x,U=I.x,G=P.x,$=w.y,Y=I.y,oe=P.y,le=Math.min(D,U,G),ue=Math.min($,Y,oe),pe=Math.max(D,U,G),Te=Math.max($,Y,oe),Re=cE(le,ue,l,d,g),et=cE(pe,Te,l,d,g),Ne=f.prevZ,ae=f.nextZ;for(;Ne&&Ne.z>=Re&&ae&&ae.z<=et;){if(Ne.x>=le&&Ne.x<=pe&&Ne.y>=ue&&Ne.y<=Te&&Ne!==w&&Ne!==P&&Xg(D,$,U,Y,G,oe,Ne.x,Ne.y)&&ro(Ne.prev,Ne,Ne.next)>=0||(Ne=Ne.prevZ,ae.x>=le&&ae.x<=pe&&ae.y>=ue&&ae.y<=Te&&ae!==w&&ae!==P&&Xg(D,$,U,Y,G,oe,ae.x,ae.y)&&ro(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;Ne&&Ne.z>=Re;){if(Ne.x>=le&&Ne.x<=pe&&Ne.y>=ue&&Ne.y<=Te&&Ne!==w&&Ne!==P&&Xg(D,$,U,Y,G,oe,Ne.x,Ne.y)&&ro(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.prevZ}for(;ae&&ae.z<=et;){if(ae.x>=le&&ae.x<=pe&&ae.y>=ue&&ae.y<=Te&&ae!==w&&ae!==P&&Xg(D,$,U,Y,G,oe,ae.x,ae.y)&&ro(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function WW(f,l){let d=f;do{let g=d.prev,w=d.next.next;!_0(g,w)&&mR(g,d,d.next,w)&&Yg(g,w)&&Yg(w,g)&&(l.push(g.i,d.i,w.i),Kg(d),Kg(d.next),d=f=w),d=d.next}while(d!==f);return wp(d)}function $W(f,l,d,g,w,I){let P=f;do{let D=P.next.next;for(;D!==P.prev;){if(P.i!==D.i&&KW(P,D)){let U=gR(P,D);return P=wp(P,P.next),U=wp(U,U.next),Zg(P,l,d,g,w,I,0),void Zg(U,l,d,g,w,I,0)}D=D.next}P=P.next}while(P!==f)}function qW(f,l){let d=f.x-l.x;return d===0&&(d=f.y-l.y,d===0)&&(d=(f.next.y-f.y)/(f.next.x-f.x)-(l.next.y-l.y)/(l.next.x-l.x)),d}function ZW(f,l){let d=function(w,I){let P=I,D=w.x,U=w.y,G,$=-1/0;if(_0(w,P))return P;do{if(_0(w,P.next))return P.next;if(U<=P.y&&U>=P.next.y&&P.next.y!==P.y){let pe=P.x+(U-P.y)*(P.next.x-P.x)/(P.next.y-P.y);if(pe<=D&&pe>$&&($=pe,G=P.x<P.next.x?P:P.next,pe===D))return G}P=P.next}while(P!==I);if(!G)return null;let Y=G,oe=G.x,le=G.y,ue=1/0;P=G;do{if(D>=P.x&&P.x>=oe&&D!==P.x&&AR(U<le?D:$,U,oe,le,U<le?$:D,U,P.x,P.y)){let pe=Math.abs(U-P.y)/(D-P.x);Yg(P,w)&&(pe<ue||pe===ue&&(P.x>G.x||P.x===G.x&&XW(G,P)))&&(G=P,ue=pe)}P=P.next}while(P!==Y);return G}(f,l);if(!d)return l;let g=gR(d,f);return wp(g,g.next),wp(d,d.next)}function XW(f,l){return ro(f.prev,f,l.prev)<0&&ro(l.next,f,f.next)<0}function cE(f,l,d,g,w){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-d)*w|0)|f<<8))|f<<4))|f<<2))|f<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-g)*w|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function YW(f){let l=f,d=f;do(l.x<d.x||l.x===d.x&&l.y<d.y)&&(d=l),l=l.next;while(l!==f);return d}function AR(f,l,d,g,w,I,P,D){return(w-P)*(l-D)>=(f-P)*(I-D)&&(f-P)*(g-D)>=(d-P)*(l-D)&&(d-P)*(I-D)>=(w-P)*(g-D)}function Xg(f,l,d,g,w,I,P,D){return!(f===P&&l===D)&&AR(f,l,d,g,w,I,P,D)}function KW(f,l){return f.next.i!==l.i&&f.prev.i!==l.i&&!function(d,g){let w=d;do{if(w.i!==d.i&&w.next.i!==d.i&&w.i!==g.i&&w.next.i!==g.i&&mR(w,w.next,d,g))return!0;w=w.next}while(w!==d);return!1}(f,l)&&(Yg(f,l)&&Yg(l,f)&&function(d,g){let w=d,I=!1,P=(d.x+g.x)/2,D=(d.y+g.y)/2;do w.y>D!=w.next.y>D&&w.next.y!==w.y&&P<(w.next.x-w.x)*(D-w.y)/(w.next.y-w.y)+w.x&&(I=!I),w=w.next;while(w!==d);return I}(f,l)&&(ro(f.prev,f,l.prev)||ro(f,l.prev,l))||_0(f,l)&&ro(f.prev,f,f.next)>0&&ro(l.prev,l,l.next)>0)}function ro(f,l,d){return(l.y-f.y)*(d.x-l.x)-(l.x-f.x)*(d.y-l.y)}function _0(f,l){return f.x===l.x&&f.y===l.y}function mR(f,l,d,g){let w=p2(ro(f,l,d)),I=p2(ro(f,l,g)),P=p2(ro(d,g,f)),D=p2(ro(d,g,l));return w!==I&&P!==D||!(w!==0||!d2(f,d,l))||!(I!==0||!d2(f,g,l))||!(P!==0||!d2(d,f,g))||!(D!==0||!d2(d,l,g))}function d2(f,l,d){return l.x<=Math.max(f.x,d.x)&&l.x>=Math.min(f.x,d.x)&&l.y<=Math.max(f.y,d.y)&&l.y>=Math.min(f.y,d.y)}function p2(f){return f>0?1:f<0?-1:0}function Yg(f,l){return ro(f.prev,f,f.next)<0?ro(f,l,f.next)>=0&&ro(f,f.prev,l)>=0:ro(f,l,f.prev)<0||ro(f,f.next,l)<0}function gR(f,l){let d=uE(f.i,f.x,f.y),g=uE(l.i,l.x,l.y),w=f.next,I=l.prev;return f.next=l,l.prev=f,d.next=w,w.prev=d,g.next=d,d.prev=g,I.next=g,g.prev=I,g}function _R(f,l,d,g){let w=uE(f,l,d);return g?(w.next=g.next,w.prev=g,g.next.prev=w,g.next=w):(w.prev=w,w.next=w),w}function Kg(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function uE(f,l,d){return{i:f,x:l,y:d,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class y0{constructor(l,d){if(d>l)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=l,this._minGranularity=d}getGranularityForZoomLevel(l){return Math.max(Math.floor(this._baseZoomGranularity/(1<<l)),this._minGranularity,1)}}class A2{constructor(l){this.fill=l.fill,this.line=l.line,this.tile=l.tile,this.stencil=l.stencil,this.circle=l.circle}}A2.noSubdivision=new A2({fill:new y0(0,0),line:new y0(0,0),tile:new y0(0,0),stencil:new y0(0,0),circle:1}),ur("SubdivisionGranularityExpression",y0),ur("SubdivisionGranularitySetting",A2);let x0=-32768,Qg=32767;class QW{constructor(l,d){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=l,this._granularityCellSize=ve/l,this._canonical=d}_getKey(l,d){return(l+=32768)<<16|(d+=32768)<<0}_vertexToIndex(l,d){if(l<-32768||d<-32768||l>32767||d>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let g=0|Math.round(l),w=0|Math.round(d),I=this._getKey(g,w);if(this._vertexDictionary.has(I))return this._vertexDictionary.get(I);let P=this._vertexBuffer.length/2;return this._vertexDictionary.set(I,P),this._vertexBuffer.push(g,w),P}_subdivideTrianglesScanline(l){if(this._granularity<2)return function(w,I){let P=[];for(let D=0;D<I.length;D+=3){let U=I[D],G=I[D+1],$=I[D+2],Y=w[2*U],oe=w[2*U+1];(w[2*G]-Y)*(w[2*$+1]-oe)-(w[2*G+1]-oe)*(w[2*$]-Y)>0?(P.push(U),P.push($),P.push(G)):(P.push(U),P.push(G),P.push($))}return P}(this._vertexBuffer,l);let d=[],g=l.length;for(let w=0;w<g;w+=3){let I=[l[w+0],l[w+1],l[w+2]],P=[this._vertexBuffer[2*l[w+0]+0],this._vertexBuffer[2*l[w+0]+1],this._vertexBuffer[2*l[w+1]+0],this._vertexBuffer[2*l[w+1]+1],this._vertexBuffer[2*l[w+2]+0],this._vertexBuffer[2*l[w+2]+1]],D=1/0,U=1/0,G=-1/0,$=-1/0;for(let pe=0;pe<3;pe++){let Te=P[2*pe],Re=P[2*pe+1];D=Math.min(D,Te),G=Math.max(G,Te),U=Math.min(U,Re),$=Math.max($,Re)}if(D===G||U===$)continue;let Y=Math.floor(D/this._granularityCellSize),oe=Math.ceil(G/this._granularityCellSize),le=Math.floor(U/this._granularityCellSize),ue=Math.ceil($/this._granularityCellSize);if(Y!==oe||le!==ue)for(let pe=le;pe<ue;pe++){let Te=this._scanlineGenerateVertexRingForCellRow(pe,P,I);JW(this._vertexBuffer,Te,d)}else d.push(...I)}return d}_scanlineGenerateVertexRingForCellRow(l,d,g){let w=l*this._granularityCellSize,I=w+this._granularityCellSize,P=[];for(let D=0;D<3;D++){let U=d[2*D],G=d[2*D+1],$=d[2*(D+1)%6],Y=d[(2*(D+1)+1)%6],oe=d[2*(D+2)%6],le=d[(2*(D+2)+1)%6],ue=$-U,pe=Y-G,Te=ue===0,Re=pe===0,et=(w-G)/pe,Ne=(I-G)/pe,ae=Math.min(et,Ne),xe=Math.max(et,Ne);if(!Re&&(ae>=1||xe<=0)||Re&&(G<w||G>I)){Y>=w&&Y<=I&&P.push(g[(D+1)%3]);continue}!Re&&ae>0&&P.push(this._vertexToIndex(U+ue*ae,G+pe*ae));let He=U+ue*Math.max(ae,0),xt=U+ue*Math.min(xe,1);Te||this._generateIntraEdgeVertices(P,U,G,$,Y,He,xt),!Re&&xe<1&&P.push(this._vertexToIndex(U+ue*xe,G+pe*xe)),(Re||Y>=w&&Y<=I)&&P.push(g[(D+1)%3]),!Re&&(Y<=w||Y>=I)&&this._generateInterEdgeVertices(P,U,G,$,Y,oe,le,xt,w,I)}return P}_generateIntraEdgeVertices(l,d,g,w,I,P,D){let U=w-d,G=I-g,$=G===0,Y=$?Math.min(d,w):Math.min(P,D),oe=$?Math.max(d,w):Math.max(P,D),le=Math.floor(Y/this._granularityCellSize)+1,ue=Math.ceil(oe/this._granularityCellSize)-1;if($?d<w:P<D)for(let pe=le;pe<=ue;pe++){let Te=pe*this._granularityCellSize;l.push(this._vertexToIndex(Te,g+G*(Te-d)/U))}else for(let pe=ue;pe>=le;pe--){let Te=pe*this._granularityCellSize;l.push(this._vertexToIndex(Te,g+G*(Te-d)/U))}}_generateInterEdgeVertices(l,d,g,w,I,P,D,U,G,$){let Y=I-g,oe=P-w,le=D-I,ue=(G-I)/le,pe=($-I)/le,Te=Math.min(ue,pe),Re=Math.max(ue,pe),et=w+oe*Te,Ne=Math.floor(Math.min(et,U)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(et,U)/this._granularityCellSize)-1,xe=U<et,He=le===0;if(He&&(D===G||D===$))return;if(He||Te>=1||Re<=0){let Ht=g-D,Et=P+(d-P)*Math.min((G-D)/Ht,($-D)/Ht);Ne=Math.floor(Math.min(Et,U)/this._granularityCellSize)+1,ae=Math.ceil(Math.max(Et,U)/this._granularityCellSize)-1,xe=U<Et}let xt=Y>0?$:G;if(xe)for(let Ht=Ne;Ht<=ae;Ht++)l.push(this._vertexToIndex(Ht*this._granularityCellSize,xt));else for(let Ht=ae;Ht>=Ne;Ht--)l.push(this._vertexToIndex(Ht*this._granularityCellSize,xt))}_generateOutline(l){let d=[];for(let g of l){let w=Tp(g,this._granularity,!0),I=this._pointArrayToIndices(w),P=[];for(let D=1;D<I.length;D++)P.push(I[D-1]),P.push(I[D]);d.push(P)}return d}_handlePoles(l){let d=!1,g=!1;this._canonical&&(this._canonical.y===0&&(d=!0),this._canonical.y===(1<<this._canonical.z)-1&&(g=!0)),(d||g)&&this._fillPoles(l,d,g)}_ensureNoPoleVertices(){let l=this._vertexBuffer;for(let d=0;d<l.length;d+=2){let g=l[d+1];g===x0&&(l[d+1]=-32767),g===Qg&&(l[d+1]=32766)}}_generatePoleQuad(l,d,g,w,I,P){w>I!=(P===x0)?(l.push(d),l.push(g),l.push(this._vertexToIndex(w,P)),l.push(g),l.push(this._vertexToIndex(I,P)),l.push(this._vertexToIndex(w,P))):(l.push(g),l.push(d),l.push(this._vertexToIndex(w,P)),l.push(this._vertexToIndex(I,P)),l.push(g),l.push(this._vertexToIndex(w,P)))}_fillPoles(l,d,g){let w=this._vertexBuffer,I=ve,P=l.length;for(let D=2;D<P;D+=3){let U=l[D-2],G=l[D-1],$=l[D],Y=w[2*U],oe=w[2*U+1],le=w[2*G],ue=w[2*G+1],pe=w[2*$],Te=w[2*$+1];d&&(oe===0&&ue===0&&this._generatePoleQuad(l,U,G,Y,le,x0),ue===0&&Te===0&&this._generatePoleQuad(l,G,$,le,pe,x0),Te===0&&oe===0&&this._generatePoleQuad(l,$,U,pe,Y,x0)),g&&(oe===I&&ue===I&&this._generatePoleQuad(l,U,G,Y,le,Qg),ue===I&&Te===I&&this._generatePoleQuad(l,G,$,le,pe,Qg),Te===I&&oe===I&&this._generatePoleQuad(l,$,U,pe,Y,Qg))}}_initializeVertices(l){for(let d=0;d<l.length;d+=2)this._vertexToIndex(l[d],l[d+1])}subdividePolygonInternal(l,d){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:g,holeIndices:w}=function(D){let U=[],G=[];for(let $ of D)if($.length!==0){$!==D[0]&&U.push(G.length/2);for(let Y=0;Y<$.length;Y++)G.push($[Y].x),G.push($[Y].y)}return{flattened:G,holeIndices:U}}(l),I;this._initializeVertices(g);try{let D=function(G,$,Y=2){let oe=$&&$.length,le=oe?$[0]*Y:G.length,ue=pR(G,0,le,Y,!0),pe=[];if(!ue||ue.next===ue.prev)return pe;let Te,Re,et;if(oe&&(ue=function(Ne,ae,xe,He){let xt=[];for(let Ht=0,Et=ae.length;Ht<Et;Ht++){let Rt=pR(Ne,ae[Ht]*He,Ht<Et-1?ae[Ht+1]*He:Ne.length,He,!1);Rt===Rt.next&&(Rt.steiner=!0),xt.push(YW(Rt))}xt.sort(qW);for(let Ht=0;Ht<xt.length;Ht++)xe=ZW(xt[Ht],xe);return xe}(G,$,ue,Y)),G.length>80*Y){Te=1/0,Re=1/0;let Ne=-1/0,ae=-1/0;for(let xe=Y;xe<le;xe+=Y){let He=G[xe],xt=G[xe+1];He<Te&&(Te=He),xt<Re&&(Re=xt),He>Ne&&(Ne=He),xt>ae&&(ae=xt)}et=Math.max(Ne-Te,ae-Re),et=et!==0?32767/et:0}return Zg(ue,pe,Y,Te,Re,et,0),pe}(g,w),U=this._convertIndices(g,D);I=this._subdivideTrianglesScanline(U)}catch(D){console.error(D)}let P=[];return d&&(P=this._generateOutline(l)),this._ensureNoPoleVertices(),this._handlePoles(I),{verticesFlattened:this._vertexBuffer,indicesTriangles:I,indicesLineList:P}}_convertIndices(l,d){let g=[];for(let w=0;w<d.length;w++)g.push(this._vertexToIndex(l[2*d[w]],l[2*d[w]+1]));return g}_pointArrayToIndices(l){let d=[];for(let g=0;g<l.length;g++){let w=l[g];d.push(this._vertexToIndex(w.x,w.y))}return d}}function yR(f,l,d,g=!0){return new QW(d,l).subdividePolygonInternal(f,g)}function Tp(f,l,d=!1){if(!f||f.length<1)return[];if(f.length<2)return[];let g=f[0],w=f[f.length-1],I=d&&(g.x!==w.x||g.y!==w.y);if(l<2)return I?[...f,f[0]]:[...f];let P=Math.floor(ve/l),D=[];D.push(new R(f[0].x,f[0].y));let U=f.length,G=I?U:U-1;for(let $=0;$<G;$++){let Y=f[$],oe=$<U-1?f[$+1]:f[0],le=Y.x,ue=Y.y,pe=oe.x,Te=oe.y,Re=le!==pe,et=ue!==Te;if(!Re&&!et)continue;let Ne=pe-le,ae=Te-ue,xe=Math.abs(Ne),He=Math.abs(ae),xt=le,Ht=ue;for(;;){let Rt=Ne>0?(Math.floor(xt/P)+1)*P:(Math.ceil(xt/P)-1)*P,Yt=ae>0?(Math.floor(Ht/P)+1)*P:(Math.ceil(Ht/P)-1)*P,$t=Math.abs(xt-Rt),Qt=Math.abs(Ht-Yt),Dt=Math.abs(xt-pe),Ar=Math.abs(Ht-Te),Br=Re?$t/xe:Number.POSITIVE_INFINITY,Ir=et?Qt/He:Number.POSITIVE_INFINITY;if((Dt<=$t||!Re)&&(Ar<=Qt||!et))break;if(Br<Ir&&Re||!et){xt=Rt,Ht+=ae*Br;let yr=new R(xt,Math.round(Ht));D[D.length-1].x===yr.x&&D[D.length-1].y===yr.y||D.push(yr)}else{xt+=Ne*Ir,Ht=Yt;let yr=new R(Math.round(xt),Ht);D[D.length-1].x===yr.x&&D[D.length-1].y===yr.y||D.push(yr)}}let Et=new R(pe,Te);D[D.length-1].x===Et.x&&D[D.length-1].y===Et.y||D.push(Et)}return D}function JW(f,l,d){if(l.length===0)throw new Error("Subdivision vertex ring is empty.");let g=0,w=f[2*l[0]];for(let U=1;U<l.length;U++){let G=f[2*l[U]];G<w&&(w=G,g=U)}let I=l.length,P=g,D=(P+1)%I;for(;;){let U=P-1>=0?P-1:I-1,G=(D+1)%I,$=f[2*l[U]],Y=f[2*l[G]],oe=f[2*l[P]],le=f[2*l[P]+1],ue=f[2*l[D]+1],pe=!1;if($<Y)pe=!0;else if($>Y)pe=!1;else{let Te=ue-le,Re=-(f[2*l[D]]-oe),et=le<ue?1:-1;(($-oe)*Te+(f[2*l[U]+1]-le)*Re)*et>((Y-oe)*Te+(f[2*l[G]+1]-le)*Re)*et&&(pe=!0)}if(pe){let Te=l[U],Re=l[P],et=l[D];Te!==Re&&Te!==et&&Re!==et&&d.push(et,Re,Te),P--,P<0&&(P=I-1)}else{let Te=l[G],Re=l[P],et=l[D];Te!==Re&&Te!==et&&Re!==et&&d.push(et,Re,Te),D++,D>=I&&(D=0)}if(U===G)break}}function xR(f,l,d,g,w,I,P,D,U){let G=w.length/2,$=P&&D&&U;if(G<Hr.MAX_VERTEX_ARRAY_LENGTH){let Y=l.prepareSegment(G,d,g),oe=Y.vertexLength;for(let pe=0;pe<I.length;pe+=3)g.emplaceBack(oe+I[pe],oe+I[pe+1],oe+I[pe+2]);let le,ue;Y.vertexLength+=G,Y.primitiveLength+=I.length/3,$&&(ue=P.prepareSegment(G,d,D),le=ue.vertexLength,ue.vertexLength+=G);for(let pe=0;pe<w.length;pe+=2)f(w[pe],w[pe+1]);if($)for(let pe=0;pe<U.length;pe++){let Te=U[pe];for(let Re=1;Re<Te.length;Re+=2)D.emplaceBack(le+Te[Re-1],le+Te[Re]);ue.primitiveLength+=Te.length/2}}else(function(Y,oe,le,ue,pe,Te){let Re=[];for(let He=0;He<ue.length/2;He++)Re.push(-1);let et={count:0},Ne=0,ae=Y.getOrCreateLatestSegment(oe,le),xe=ae.vertexLength;for(let He=2;He<pe.length;He+=3){let xt=pe[He-2],Ht=pe[He-1],Et=pe[He],Rt=Re[xt]<Ne,Yt=Re[Ht]<Ne,$t=Re[Et]<Ne;ae.vertexLength+((Rt?1:0)+(Yt?1:0)+($t?1:0))>Hr.MAX_VERTEX_ARRAY_LENGTH&&(ae=Y.createNewSegment(oe,le),Ne=et.count,Rt=!0,Yt=!0,$t=!0,xe=0);let Qt=Jg(Re,ue,Te,et,xt,Rt,ae),Dt=Jg(Re,ue,Te,et,Ht,Yt,ae),Ar=Jg(Re,ue,Te,et,Et,$t,ae);le.emplaceBack(xe+Qt-Ne,xe+Dt-Ne,xe+Ar-Ne),ae.primitiveLength++}})(l,d,g,w,I,f),$&&function(Y,oe,le,ue,pe,Te){let Re=[];for(let He=0;He<ue.length/2;He++)Re.push(-1);let et={count:0},Ne=0,ae=Y.getOrCreateLatestSegment(oe,le),xe=ae.vertexLength;for(let He=0;He<pe.length;He++){let xt=pe[He];for(let Ht=1;Ht<pe[He].length;Ht+=2){let Et=xt[Ht-1],Rt=xt[Ht],Yt=Re[Et]<Ne,$t=Re[Rt]<Ne;ae.vertexLength+((Yt?1:0)+($t?1:0))>Hr.MAX_VERTEX_ARRAY_LENGTH&&(ae=Y.createNewSegment(oe,le),Ne=et.count,Yt=!0,$t=!0,xe=0);let Qt=Jg(Re,ue,Te,et,Et,Yt,ae),Dt=Jg(Re,ue,Te,et,Rt,$t,ae);le.emplaceBack(xe+Qt-Ne,xe+Dt-Ne),ae.primitiveLength++}}}(P,d,D,w,U,f),l.forceNewSegmentOnNextPrepare(),P?.forceNewSegmentOnNextPrepare()}function Jg(f,l,d,g,w,I,P){if(I){let D=g.count;return d(l[2*w],l[2*w+1]),f[w]=g.count,g.count++,P.vertexLength++,D}return f[w]}class hE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qe,this.indexArray=new Ut,this.indexArray2=new mt,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new Hr,this.segments2=new Hr,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=aE("fill",this.layers,d);let w=this.layers[0].layout.get("fill-sort-key"),I=!w.isConstant(),P=[];for(let{feature:D,id:U,index:G,sourceLayerIndex:$}of l){let Y=this.layers[0]._featureFilter.needGeometry,oe=ni(D,Y);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),oe,g))continue;let le=I?w.evaluate(oe,{},g,d.availableImages):void 0,ue={id:U,properties:D.properties,type:D.type,sourceLayerIndex:$,index:G,geometry:Y?oe.geometry:ri(D),patterns:{},sortKey:le};P.push(ue)}I&&P.sort((D,U)=>D.sortKey-U.sortKey);for(let D of P){let{geometry:U,index:G,sourceLayerIndex:$}=D;if(this.hasPattern){let Y=lE("fill",this.layers,D,this.zoom,d);this.patternFeatures.push(Y)}else this.addFeature(D,U,G,g,{},d.subdivisionGranularity);d.featureIndex.insert(l[G].feature,U,G,$,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,d,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,jW),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,d,g,w,I,P){for(let D of Kl(d,500)){let U=yR(D,w,P.fill.getGranularityForZoomLevel(w.z)),G=this.layoutVertexArray;xR(($,Y)=>{G.emplaceBack($,Y)},this.segments,this.layoutVertexArray,this.indexArray,U.verticesFlattened,U.indicesTriangles,this.segments2,this.indexArray2,U.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}}let bR,vR;ur("FillBucket",hE,{omit:["layers","patternFeatures"]});var e$={get paint(){return vR=vR||new ps({"fill-antialias":new xr(ce.paint_fill["fill-antialias"]),"fill-opacity":new Rr(ce.paint_fill["fill-opacity"]),"fill-color":new Rr(ce.paint_fill["fill-color"]),"fill-outline-color":new Rr(ce.paint_fill["fill-outline-color"]),"fill-translate":new xr(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new xr(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Vf(ce.paint_fill["fill-pattern"])})},get layout(){return bR=bR||new ps({"fill-sort-key":new Rr(ce.layout_fill["fill-sort-key"])})}};class t$ extends Bn{constructor(l){super(l,e$)}recalculate(l,d){super.recalculate(l,d);let g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new hE(l)}queryRadius(){return h2(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:l,geometry:d,transform:g,pixelsToTileUnits:w}){return fn(f2(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-g.bearingInRadians,w),d)}isTileClipped(){return!0}}let r$=Vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),i$=Vn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:n$}=r$;var fE,wR,dE,TR,pE,ER,CR,m2={};function SR(){if(wR)return fE;wR=1;var f=p();function l(w,I,P,D,U){this.properties={},this.extent=P,this.type=0,this._pbf=w,this._geometry=-1,this._keys=D,this._values=U,w.readFields(d,this,I)}function d(w,I,P){w==1?I.id=P.readVarint():w==2?function(D,U){for(var G=D.readVarint()+D.pos;D.pos<G;){var $=U._keys[D.readVarint()],Y=U._values[D.readVarint()];U.properties[$]=Y}}(P,I):w==3?I.type=P.readVarint():w==4&&(I._geometry=P.pos)}function g(w){for(var I,P,D=0,U=0,G=w.length,$=G-1;U<G;$=U++)D+=((P=w[$]).x-(I=w[U]).x)*(I.y+P.y);return D}return fE=l,l.types=["Unknown","Point","LineString","Polygon"],l.prototype.loadGeometry=function(){var w=this._pbf;w.pos=this._geometry;for(var I,P=w.readVarint()+w.pos,D=1,U=0,G=0,$=0,Y=[];w.pos<P;){if(U<=0){var oe=w.readVarint();D=7&oe,U=oe>>3}if(U--,D===1||D===2)G+=w.readSVarint(),$+=w.readSVarint(),D===1&&(I&&Y.push(I),I=[]),I.push(new f(G,$));else{if(D!==7)throw new Error("unknown command "+D);I&&I.push(I[0].clone())}}return I&&Y.push(I),Y},l.prototype.bbox=function(){var w=this._pbf;w.pos=this._geometry;for(var I=w.readVarint()+w.pos,P=1,D=0,U=0,G=0,$=1/0,Y=-1/0,oe=1/0,le=-1/0;w.pos<I;){if(D<=0){var ue=w.readVarint();P=7&ue,D=ue>>3}if(D--,P===1||P===2)(U+=w.readSVarint())<$&&($=U),U>Y&&(Y=U),(G+=w.readSVarint())<oe&&(oe=G),G>le&&(le=G);else if(P!==7)throw new Error("unknown command "+P)}return[$,oe,Y,le]},l.prototype.toGeoJSON=function(w,I,P){var D,U,G=this.extent*Math.pow(2,P),$=this.extent*w,Y=this.extent*I,oe=this.loadGeometry(),le=l.types[this.type];function ue(Re){for(var et=0;et<Re.length;et++){var Ne=Re[et];Re[et]=[360*(Ne.x+$)/G-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ne.y+Y)/G)*Math.PI/180))-90]}}switch(this.type){case 1:var pe=[];for(D=0;D<oe.length;D++)pe[D]=oe[D][0];ue(oe=pe);break;case 2:for(D=0;D<oe.length;D++)ue(oe[D]);break;case 3:for(oe=function(Re){var et=Re.length;if(et<=1)return[Re];for(var Ne,ae,xe=[],He=0;He<et;He++){var xt=g(Re[He]);xt!==0&&(ae===void 0&&(ae=xt<0),ae===xt<0?(Ne&&xe.push(Ne),Ne=[Re[He]]):Ne.push(Re[He]))}return Ne&&xe.push(Ne),xe}(oe),D=0;D<oe.length;D++)for(U=0;U<oe[D].length;U++)ue(oe[D][U])}oe.length===1?oe=oe[0]:le="Multi"+le;var Te={type:"Feature",geometry:{type:le,coordinates:oe},properties:this.properties};return"id"in this&&(Te.id=this.id),Te},fE}function IR(){if(TR)return dE;TR=1;var f=SR();function l(g,w){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(d,this,w),this.length=this._features.length}function d(g,w,I){g===15?w.version=I.readVarint():g===1?w.name=I.readString():g===5?w.extent=I.readVarint():g===2?w._features.push(I.pos):g===3?w._keys.push(I.readString()):g===4&&w._values.push(function(P){for(var D=null,U=P.readVarint()+P.pos;P.pos<U;){var G=P.readVarint()>>3;D=G===1?P.readString():G===2?P.readFloat():G===3?P.readDouble():G===4?P.readVarint64():G===5?P.readVarint():G===6?P.readSVarint():G===7?P.readBoolean():null}return D}(I))}return dE=l,l.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var w=this._pbf.readVarint()+this._pbf.pos;return new f(this._pbf,w,this.extent,this._keys,this._values)},dE}function MR(){return CR||(CR=1,m2.VectorTile=function(){if(ER)return pE;ER=1;var f=IR();function l(d,g,w){if(d===3){var I=new f(w,w.readVarint()+w.pos);I.length&&(g[I.name]=I)}}return pE=function(d,g){this.layers=d.readFields(l,{},g)},pE}(),m2.VectorTileFeature=SR(),m2.VectorTileLayer=IR()),m2}var e_=a(MR());let o$=e_.VectorTileFeature.types,AE=Math.pow(2,13);function t_(f,l,d,g,w,I,P,D){f.emplaceBack(l,d,2*Math.floor(g*AE)+P,w*AE*2,I*AE*2,Math.round(D))}class mE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Ge,this.centroidVertexArray=new Ve,this.indexArray=new Ut,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new Hr,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.features=[],this.hasPattern=aE("fill-extrusion",this.layers,d);for(let{feature:w,id:I,index:P,sourceLayerIndex:D}of l){let U=this.layers[0]._featureFilter.needGeometry,G=ni(w,U);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),G,g))continue;let $={id:I,sourceLayerIndex:D,index:P,geometry:U?G.geometry:ri(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(lE("fill-extrusion",this.layers,$,this.zoom,d)):this.addFeature($,$.geometry,P,g,{},d.subdivisionGranularity),d.featureIndex.insert(w,$.geometry,P,D,this.index,!0)}}addFeatures(l,d,g){for(let w of this.features){let{geometry:I}=w;this.addFeature(w,I,w.index,d,g,l.subdivisionGranularity)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,n$),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,i$.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,d,g,w,I,P){for(let D of Kl(d,500)){let U={x:0,y:0,sampleCount:0},G=this.layoutVertexArray.length;this.processPolygon(U,w,l,D,P);let $=this.layoutVertexArray.length-G,Y=Math.floor(U.x/U.sampleCount),oe=Math.floor(U.y/U.sampleCount);for(let le=0;le<$;le++)this.centroidVertexArray.emplaceBack(Y,oe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}processPolygon(l,d,g,w,I){if(w.length<1||PR(w[0]))return;for(let Y of w)Y.length!==0&&s$(l,Y);let P={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},D=I.fill.getGranularityForZoomLevel(d.z),U=o$[g.type]==="Polygon";for(let Y of w){if(Y.length===0||PR(Y))continue;let oe=Tp(Y,D,U);this._generateSideFaces(oe,P)}if(!U)return;let G=yR(w,d,D,!1),$=this.layoutVertexArray;xR((Y,oe)=>{t_($,Y,oe,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,G.verticesFlattened,G.indicesTriangles)}_generateSideFaces(l,d){let g=0;for(let w=1;w<l.length;w++){let I=l[w],P=l[w-1];if(a$(I,P))continue;d.segment.vertexLength+4>Hr.MAX_VERTEX_ARRAY_LENGTH&&(d.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let D=I.sub(P)._perp()._unit(),U=P.dist(I);g+U>32768&&(g=0),t_(this.layoutVertexArray,I.x,I.y,D.x,D.y,0,0,g),t_(this.layoutVertexArray,I.x,I.y,D.x,D.y,0,1,g),g+=U,t_(this.layoutVertexArray,P.x,P.y,D.x,D.y,0,0,g),t_(this.layoutVertexArray,P.x,P.y,D.x,D.y,0,1,g);let G=d.segment.vertexLength;this.indexArray.emplaceBack(G,G+2,G+1),this.indexArray.emplaceBack(G+1,G+2,G+3),d.segment.vertexLength+=4,d.segment.primitiveLength+=2}}}function s$(f,l){for(let d=0;d<l.length;d++){let g=l[d];d===l.length-1&&l[0].x===g.x&&l[0].y===g.y||(f.x+=g.x,f.y+=g.y,f.sampleCount++)}}function a$(f,l){return f.x===l.x&&(f.x<0||f.x>ve)||f.y===l.y&&(f.y<0||f.y>ve)}function PR(f){return f.every(l=>l.x<0)||f.every(l=>l.x>ve)||f.every(l=>l.y<0)||f.every(l=>l.y>ve)}let RR;ur("FillExtrusionBucket",mE,{omit:["layers","features"]});var l$={get paint(){return RR=RR||new ps({"fill-extrusion-opacity":new xr(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rr(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xr(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xr(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Vf(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rr(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rr(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xr(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class c$ extends Bn{constructor(l){super(l,l$)}createBucket(l){return new mE(l)}queryRadius(){return h2(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:w,transform:I,pixelsToTileUnits:P,pixelPosMatrix:D}){let U=f2(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-I.bearingInRadians,P),G=this.paint.get("fill-extrusion-height").evaluate(d,g),$=this.paint.get("fill-extrusion-base").evaluate(d,g),Y=function(le,ue,pe){let Te=[];for(let Re of le){let et=[Re.x,Re.y,0,1];X(et,et,ue),Te.push(new R(et[0]/et[3],et[1]/et[3]))}return Te}(U,D),oe=function(le,ue,pe,Te){let Re=[],et=[],Ne=Te[8]*ue,ae=Te[9]*ue,xe=Te[10]*ue,He=Te[11]*ue,xt=Te[8]*pe,Ht=Te[9]*pe,Et=Te[10]*pe,Rt=Te[11]*pe;for(let Yt of le){let $t=[],Qt=[];for(let Dt of Yt){let Ar=Dt.x,Br=Dt.y,Ir=Te[0]*Ar+Te[4]*Br+Te[12],yr=Te[1]*Ar+Te[5]*Br+Te[13],yi=Te[2]*Ar+Te[6]*Br+Te[14],$n=Te[3]*Ar+Te[7]*Br+Te[15],Eo=yi+xe,ms=$n+He,qa=Ir+xt,na=yr+Ht,Jo=yi+Et,jn=$n+Rt,Uo=new R((Ir+Ne)/ms,(yr+ae)/ms);Uo.z=Eo/ms,$t.push(Uo);let es=new R(qa/jn,na/jn);es.z=Jo/jn,Qt.push(es)}Re.push($t),et.push(Qt)}return[Re,et]}(w,$,G,D);return function(le,ue,pe){let Te=1/0;fn(pe,ue)&&(Te=BR(pe,ue[0]));for(let Re=0;Re<ue.length;Re++){let et=ue[Re],Ne=le[Re];for(let ae=0;ae<et.length-1;ae++){let xe=et[ae],He=[xe,et[ae+1],Ne[ae+1],Ne[ae],xe];Vi(pe,He)&&(Te=Math.min(Te,BR(pe,He)))}}return Te!==1/0&&Te}(oe[0],oe[1],Y)}}function r_(f,l){return f.x*l.x+f.y*l.y}function BR(f,l){if(f.length===1){let d=0,g=l[d++],w;for(;!w||g.equals(w);)if(w=l[d++],!w)return 1/0;for(;d<l.length;d++){let I=l[d],P=f[0],D=w.sub(g),U=I.sub(g),G=P.sub(g),$=r_(D,D),Y=r_(D,U),oe=r_(U,U),le=r_(G,D),ue=r_(G,U),pe=$*oe-Y*Y,Te=(oe*le-Y*ue)/pe,Re=($*ue-Y*le)/pe,et=g.z*(1-Te-Re)+w.z*Te+I.z*Re;if(isFinite(et))return et}return 1/0}{let d=1/0;for(let g of l)d=Math.min(d,g.z);return d}}let u$=Vn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:h$}=u$,f$=Vn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:d$}=f$,p$=e_.VectorTileFeature.types,A$=Math.cos(Math.PI/180*37.5),LR=Math.pow(2,14)/.5;class gE{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(d=>d.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Ze,this.layoutVertexArray2=new _t,this.indexArray=new Ut,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new Hr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(l,d,g){this.hasPattern=aE("line",this.layers,d);let w=this.layers[0].layout.get("line-sort-key"),I=!w.isConstant(),P=[];for(let{feature:D,id:U,index:G,sourceLayerIndex:$}of l){let Y=this.layers[0]._featureFilter.needGeometry,oe=ni(D,Y);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom),oe,g))continue;let le=I?w.evaluate(oe,{},g):void 0,ue={id:U,properties:D.properties,type:D.type,sourceLayerIndex:$,index:G,geometry:Y?oe.geometry:ri(D),patterns:{},sortKey:le};P.push(ue)}I&&P.sort((D,U)=>D.sortKey-U.sortKey);for(let D of P){let{geometry:U,index:G,sourceLayerIndex:$}=D;if(this.hasPattern){let Y=lE("line",this.layers,D,this.zoom,d);this.patternFeatures.push(Y)}else this.addFeature(D,U,G,g,{},d.subdivisionGranularity);d.featureIndex.insert(l[G].feature,U,G,$,this.index)}}update(l,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,d,this.stateDependentLayers,g)}addFeatures(l,d,g){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,d,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,d$)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,h$),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,d,g,w,I,P){let D=this.layers[0].layout,U=D.get("line-join").evaluate(l,{}),G=D.get("line-cap"),$=D.get("line-miter-limit"),Y=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(let oe of d)this.addLine(oe,l,U,G,$,Y,w,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}addLine(l,d,g,w,I,P,D,U){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,l=Tp(l,D?U.line.getGranularityForZoomLevel(D.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ne=0;Ne<l.length-1;Ne++)this.totalDistance+=l[Ne].dist(l[Ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let G=p$[d.type]==="Polygon",$=l.length;for(;$>=2&&l[$-1].equals(l[$-2]);)$--;let Y=0;for(;Y<$-1&&l[Y].equals(l[Y+1]);)Y++;if($<(G?3:2))return;g==="bevel"&&(I=1.05);let oe=this.overscaling<=16?15*ve/(512*this.overscaling):0,le=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray),ue,pe,Te,Re,et;this.e1=this.e2=-1,G&&(ue=l[$-2],et=l[Y].sub(ue)._unit()._perp());for(let Ne=Y;Ne<$;Ne++){if(Te=Ne===$-1?G?l[Y+1]:void 0:l[Ne+1],Te&&l[Ne].equals(Te))continue;et&&(Re=et),ue&&(pe=ue),ue=l[Ne],et=Te?Te.sub(ue)._unit()._perp():Re,Re=Re||et;let ae=Re.add(et);ae.x===0&&ae.y===0||ae._unit();let xe=Re.x*et.x+Re.y*et.y,He=ae.x*et.x+ae.y*et.y,xt=He!==0?1/He:1/0,Ht=2*Math.sqrt(2-2*He),Et=He<A$&&pe&&Te,Rt=Re.x*et.y-Re.y*et.x>0;if(Et&&Ne>Y){let Qt=ue.dist(pe);if(Qt>2*oe){let Dt=ue.sub(ue.sub(pe)._mult(oe/Qt)._round());this.updateDistance(pe,Dt),this.addCurrentVertex(Dt,Re,0,0,le),pe=Dt}}let Yt=pe&&Te,$t=Yt?g:G?"butt":w;if(Yt&&$t==="round"&&(xt<P?$t="miter":xt<=2&&($t="fakeround")),$t==="miter"&&xt>I&&($t="bevel"),$t==="bevel"&&(xt>2&&($t="flipbevel"),xt<I&&($t="miter")),pe&&this.updateDistance(pe,ue),$t==="miter")ae._mult(xt),this.addCurrentVertex(ue,ae,0,0,le);else if($t==="flipbevel"){if(xt>100)ae=et.mult(-1);else{let Qt=xt*Re.add(et).mag()/Re.sub(et).mag();ae._perp()._mult(Qt*(Rt?-1:1))}this.addCurrentVertex(ue,ae,0,0,le),this.addCurrentVertex(ue,ae.mult(-1),0,0,le)}else if($t==="bevel"||$t==="fakeround"){let Qt=-Math.sqrt(xt*xt-1),Dt=Rt?Qt:0,Ar=Rt?0:Qt;if(pe&&this.addCurrentVertex(ue,Re,Dt,Ar,le),$t==="fakeround"){let Br=Math.round(180*Ht/Math.PI/20);for(let Ir=1;Ir<Br;Ir++){let yr=Ir/Br;if(yr!==.5){let $n=yr-.5;yr+=yr*$n*(yr-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*$n*$n+(.848013+xe*(.215638*xe-1.06021)))}let yi=et.sub(Re)._mult(yr)._add(Re)._unit()._mult(Rt?-1:1);this.addHalfVertex(ue,yi.x,yi.y,!1,Rt,0,le)}}Te&&this.addCurrentVertex(ue,et,-Dt,-Ar,le)}else if($t==="butt")this.addCurrentVertex(ue,ae,0,0,le);else if($t==="square"){let Qt=pe?1:-1;this.addCurrentVertex(ue,ae,Qt,Qt,le)}else $t==="round"&&(pe&&(this.addCurrentVertex(ue,Re,0,0,le),this.addCurrentVertex(ue,Re,1,1,le,!0)),Te&&(this.addCurrentVertex(ue,et,-1,-1,le,!0),this.addCurrentVertex(ue,et,0,0,le)));if(Et&&Ne<$-1){let Qt=ue.dist(Te);if(Qt>2*oe){let Dt=ue.add(Te.sub(ue)._mult(oe/Qt)._round());this.updateDistance(ue,Dt),this.addCurrentVertex(Dt,et,0,0,le),ue=Dt}}}}addCurrentVertex(l,d,g,w,I,P=!1){let D=d.y*w-d.x,U=-d.y-d.x*w;this.addHalfVertex(l,d.x+d.y*g,d.y-d.x*g,P,!1,g,I),this.addHalfVertex(l,D,U,P,!0,-w,I),this.distance>LR/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,d,g,w,I,P))}addHalfVertex({x:l,y:d},g,w,I,P,D,U){let G=.5*(this.lineClips?this.scaledDistance*(LR-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(I?1:0),(d<<1)+(P?1:0),Math.round(63*g)+128,Math.round(63*w)+128,1+(D===0?0:D<0?-1:1)|(63&G)<<2,G>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let $=U.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,$,this.e2),U.primitiveLength++),P?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,d){this.distance+=l.dist(d),this.updateScaledDistance()}}let OR,DR;ur("LineBucket",gE,{omit:["layers","patternFeatures"]});var FR={get paint(){return DR=DR||new ps({"line-opacity":new Rr(ce.paint_line["line-opacity"]),"line-color":new Rr(ce.paint_line["line-color"]),"line-translate":new xr(ce.paint_line["line-translate"]),"line-translate-anchor":new xr(ce.paint_line["line-translate-anchor"]),"line-width":new Rr(ce.paint_line["line-width"]),"line-gap-width":new Rr(ce.paint_line["line-gap-width"]),"line-offset":new Rr(ce.paint_line["line-offset"]),"line-blur":new Rr(ce.paint_line["line-blur"]),"line-dasharray":new mp(ce.paint_line["line-dasharray"]),"line-pattern":new Vf(ce.paint_line["line-pattern"]),"line-gradient":new jf(ce.paint_line["line-gradient"])})},get layout(){return OR=OR||new ps({"line-cap":new xr(ce.layout_line["line-cap"]),"line-join":new Rr(ce.layout_line["line-join"]),"line-miter-limit":new xr(ce.layout_line["line-miter-limit"]),"line-round-limit":new xr(ce.layout_line["line-round-limit"]),"line-sort-key":new Rr(ce.layout_line["line-sort-key"])})}};class m$ extends Rr{possiblyEvaluate(l,d){return d=new hn(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(l,d)}evaluate(l,d,g,w){return d=qt({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(l,d,g,w)}}let g2;class g$ extends Bn{constructor(l){super(l,FR),this.gradientVersion=0,g2||(g2=new m$(FR.paint.properties["line-width"].specification),g2.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let d=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof uh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,d){super.recalculate(l,d),this.paint._values["line-floorwidth"]=g2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new gE(l)}queryRadius(l){let d=l,g=kR($g("line-width",this,d),$g("line-gap-width",this,d)),w=$g("line-offset",this,d);return g/2+Math.abs(w)+h2(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:l,feature:d,featureState:g,geometry:w,transform:I,pixelsToTileUnits:P}){let D=f2(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-I.bearingInRadians,P),U=P/2*kR(this.paint.get("line-width").evaluate(d,g),this.paint.get("line-gap-width").evaluate(d,g)),G=this.paint.get("line-offset").evaluate(d,g);return G&&(w=function($,Y){let oe=[];for(let le=0;le<$.length;le++){let ue=$[le],pe=[];for(let Te=0;Te<ue.length;Te++){let Re=ue[Te-1],et=ue[Te],Ne=ue[Te+1],ae=Te===0?new R(0,0):et.sub(Re)._unit()._perp(),xe=Te===ue.length-1?new R(0,0):Ne.sub(et)._unit()._perp(),He=ae._add(xe)._unit(),xt=He.x*xe.x+He.y*xe.y;xt!==0&&He._mult(1/xt),pe.push(He._mult(Y)._add(et))}oe.push(pe)}return oe}(w,G*P)),function($,Y,oe){for(let le=0;le<Y.length;le++){let ue=Y[le];if($.length>=3){for(let pe=0;pe<ue.length;pe++)if(vp($,ue[pe]))return!0}if(Rs($,ue,oe))return!0}return!1}(D,w,U)}isTileClipped(){return!0}}function kR(f,l){return l>0?l+2*f:f}let _$=Vn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),y$=Vn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Vn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let x$=Vn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Vn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let NR=Vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),b$=Vn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function v$(f,l,d){return f.sections.forEach(g=>{g.text=function(w,I,P){let D=I.layout.get("text-transform").evaluate(P,{});return D==="uppercase"?w=w.toLocaleUpperCase():D==="lowercase"&&(w=w.toLocaleLowerCase()),Ha.applyArabicShaping&&(w=Ha.applyArabicShaping(w)),w}(g.text,l,d)}),f}Vn([{name:"triangle",components:3,type:"Uint16"}]),Vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Vn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Vn([{type:"Float32",name:"offsetX"}]),Vn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Vn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let i_={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var zR,_E,UR,To=24,yE={};function w$(){return zR||(zR=1,yE.read=function(f,l,d,g,w){var I,P,D=8*w-g-1,U=(1<<D)-1,G=U>>1,$=-7,Y=d?w-1:0,oe=d?-1:1,le=f[l+Y];for(Y+=oe,I=le&(1<<-$)-1,le>>=-$,$+=D;$>0;I=256*I+f[l+Y],Y+=oe,$-=8);for(P=I&(1<<-$)-1,I>>=-$,$+=g;$>0;P=256*P+f[l+Y],Y+=oe,$-=8);if(I===0)I=1-G;else{if(I===U)return P?NaN:1/0*(le?-1:1);P+=Math.pow(2,g),I-=G}return(le?-1:1)*P*Math.pow(2,I-g)},yE.write=function(f,l,d,g,w,I){var P,D,U,G=8*I-w-1,$=(1<<G)-1,Y=$>>1,oe=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,le=g?0:I-1,ue=g?1:-1,pe=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(D=isNaN(l)?1:0,P=$):(P=Math.floor(Math.log(l)/Math.LN2),l*(U=Math.pow(2,-P))<1&&(P--,U*=2),(l+=P+Y>=1?oe/U:oe*Math.pow(2,1-Y))*U>=2&&(P++,U/=2),P+Y>=$?(D=0,P=$):P+Y>=1?(D=(l*U-1)*Math.pow(2,w),P+=Y):(D=l*Math.pow(2,Y-1)*Math.pow(2,w),P=0));w>=8;f[d+le]=255&D,le+=ue,D/=256,w-=8);for(P=P<<w|D,G+=w;G>0;f[d+le]=255&P,le+=ue,P/=256,G-=8);f[d+le-ue]|=128*pe}),yE}function VR(){if(UR)return _E;UR=1,_E=l;var f=w$();function l(ae){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ae)?ae:new Uint8Array(ae||0),this.pos=0,this.type=0,this.length=this.buf.length}l.Varint=0,l.Fixed64=1,l.Bytes=2,l.Fixed32=5;var d=4294967296,g=1/d,w=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function I(ae){return ae.type===l.Bytes?ae.readVarint()+ae.pos:ae.pos+1}function P(ae,xe,He){return He?4294967296*xe+(ae>>>0):4294967296*(xe>>>0)+(ae>>>0)}function D(ae,xe,He){var xt=xe<=16383?1:xe<=2097151?2:xe<=268435455?3:Math.floor(Math.log(xe)/(7*Math.LN2));He.realloc(xt);for(var Ht=He.pos-1;Ht>=ae;Ht--)He.buf[Ht+xt]=He.buf[Ht]}function U(ae,xe){for(var He=0;He<ae.length;He++)xe.writeVarint(ae[He])}function G(ae,xe){for(var He=0;He<ae.length;He++)xe.writeSVarint(ae[He])}function $(ae,xe){for(var He=0;He<ae.length;He++)xe.writeFloat(ae[He])}function Y(ae,xe){for(var He=0;He<ae.length;He++)xe.writeDouble(ae[He])}function oe(ae,xe){for(var He=0;He<ae.length;He++)xe.writeBoolean(ae[He])}function le(ae,xe){for(var He=0;He<ae.length;He++)xe.writeFixed32(ae[He])}function ue(ae,xe){for(var He=0;He<ae.length;He++)xe.writeSFixed32(ae[He])}function pe(ae,xe){for(var He=0;He<ae.length;He++)xe.writeFixed64(ae[He])}function Te(ae,xe){for(var He=0;He<ae.length;He++)xe.writeSFixed64(ae[He])}function Re(ae,xe){return(ae[xe]|ae[xe+1]<<8|ae[xe+2]<<16)+16777216*ae[xe+3]}function et(ae,xe,He){ae[He]=xe,ae[He+1]=xe>>>8,ae[He+2]=xe>>>16,ae[He+3]=xe>>>24}function Ne(ae,xe){return(ae[xe]|ae[xe+1]<<8|ae[xe+2]<<16)+(ae[xe+3]<<24)}return l.prototype={destroy:function(){this.buf=null},readFields:function(ae,xe,He){for(He=He||this.length;this.pos<He;){var xt=this.readVarint(),Ht=xt>>3,Et=this.pos;this.type=7&xt,ae(Ht,xe,this),this.pos===Et&&this.skip(xt)}return xe},readMessage:function(ae,xe){return this.readFields(ae,xe,this.readVarint()+this.pos)},readFixed32:function(){var ae=Re(this.buf,this.pos);return this.pos+=4,ae},readSFixed32:function(){var ae=Ne(this.buf,this.pos);return this.pos+=4,ae},readFixed64:function(){var ae=Re(this.buf,this.pos)+Re(this.buf,this.pos+4)*d;return this.pos+=8,ae},readSFixed64:function(){var ae=Re(this.buf,this.pos)+Ne(this.buf,this.pos+4)*d;return this.pos+=8,ae},readFloat:function(){var ae=f.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ae},readDouble:function(){var ae=f.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ae},readVarint:function(ae){var xe,He,xt=this.buf;return xe=127&(He=xt[this.pos++]),He<128?xe:(xe|=(127&(He=xt[this.pos++]))<<7,He<128?xe:(xe|=(127&(He=xt[this.pos++]))<<14,He<128?xe:(xe|=(127&(He=xt[this.pos++]))<<21,He<128?xe:function(Ht,Et,Rt){var Yt,$t,Qt=Rt.buf;if(Yt=(112&($t=Qt[Rt.pos++]))>>4,$t<128||(Yt|=(127&($t=Qt[Rt.pos++]))<<3,$t<128)||(Yt|=(127&($t=Qt[Rt.pos++]))<<10,$t<128)||(Yt|=(127&($t=Qt[Rt.pos++]))<<17,$t<128)||(Yt|=(127&($t=Qt[Rt.pos++]))<<24,$t<128)||(Yt|=(1&($t=Qt[Rt.pos++]))<<31,$t<128))return P(Ht,Yt,Et);throw new Error("Expected varint not more than 10 bytes")}(xe|=(15&(He=xt[this.pos]))<<28,ae,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ae=this.readVarint();return ae%2==1?(ae+1)/-2:ae/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ae=this.readVarint()+this.pos,xe=this.pos;return this.pos=ae,ae-xe>=12&&w?function(He,xt,Ht){return w.decode(He.subarray(xt,Ht))}(this.buf,xe,ae):function(He,xt,Ht){for(var Et="",Rt=xt;Rt<Ht;){var Yt,$t,Qt,Dt=He[Rt],Ar=null,Br=Dt>239?4:Dt>223?3:Dt>191?2:1;if(Rt+Br>Ht)break;Br===1?Dt<128&&(Ar=Dt):Br===2?(192&(Yt=He[Rt+1]))==128&&(Ar=(31&Dt)<<6|63&Yt)<=127&&(Ar=null):Br===3?($t=He[Rt+2],(192&(Yt=He[Rt+1]))==128&&(192&$t)==128&&((Ar=(15&Dt)<<12|(63&Yt)<<6|63&$t)<=2047||Ar>=55296&&Ar<=57343)&&(Ar=null)):Br===4&&($t=He[Rt+2],Qt=He[Rt+3],(192&(Yt=He[Rt+1]))==128&&(192&$t)==128&&(192&Qt)==128&&((Ar=(15&Dt)<<18|(63&Yt)<<12|(63&$t)<<6|63&Qt)<=65535||Ar>=1114112)&&(Ar=null)),Ar===null?(Ar=65533,Br=1):Ar>65535&&(Ar-=65536,Et+=String.fromCharCode(Ar>>>10&1023|55296),Ar=56320|1023&Ar),Et+=String.fromCharCode(Ar),Rt+=Br}return Et}(this.buf,xe,ae)},readBytes:function(){var ae=this.readVarint()+this.pos,xe=this.buf.subarray(this.pos,ae);return this.pos=ae,xe},readPackedVarint:function(ae,xe){if(this.type!==l.Bytes)return ae.push(this.readVarint(xe));var He=I(this);for(ae=ae||[];this.pos<He;)ae.push(this.readVarint(xe));return ae},readPackedSVarint:function(ae){if(this.type!==l.Bytes)return ae.push(this.readSVarint());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readSVarint());return ae},readPackedBoolean:function(ae){if(this.type!==l.Bytes)return ae.push(this.readBoolean());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readBoolean());return ae},readPackedFloat:function(ae){if(this.type!==l.Bytes)return ae.push(this.readFloat());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readFloat());return ae},readPackedDouble:function(ae){if(this.type!==l.Bytes)return ae.push(this.readDouble());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readDouble());return ae},readPackedFixed32:function(ae){if(this.type!==l.Bytes)return ae.push(this.readFixed32());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readFixed32());return ae},readPackedSFixed32:function(ae){if(this.type!==l.Bytes)return ae.push(this.readSFixed32());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readSFixed32());return ae},readPackedFixed64:function(ae){if(this.type!==l.Bytes)return ae.push(this.readFixed64());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readFixed64());return ae},readPackedSFixed64:function(ae){if(this.type!==l.Bytes)return ae.push(this.readSFixed64());var xe=I(this);for(ae=ae||[];this.pos<xe;)ae.push(this.readSFixed64());return ae},skip:function(ae){var xe=7&ae;if(xe===l.Varint)for(;this.buf[this.pos++]>127;);else if(xe===l.Bytes)this.pos=this.readVarint()+this.pos;else if(xe===l.Fixed32)this.pos+=4;else{if(xe!==l.Fixed64)throw new Error("Unimplemented type: "+xe);this.pos+=8}},writeTag:function(ae,xe){this.writeVarint(ae<<3|xe)},realloc:function(ae){for(var xe=this.length||16;xe<this.pos+ae;)xe*=2;if(xe!==this.length){var He=new Uint8Array(xe);He.set(this.buf),this.buf=He,this.length=xe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ae){this.realloc(4),et(this.buf,ae,this.pos),this.pos+=4},writeSFixed32:function(ae){this.realloc(4),et(this.buf,ae,this.pos),this.pos+=4},writeFixed64:function(ae){this.realloc(8),et(this.buf,-1&ae,this.pos),et(this.buf,Math.floor(ae*g),this.pos+4),this.pos+=8},writeSFixed64:function(ae){this.realloc(8),et(this.buf,-1&ae,this.pos),et(this.buf,Math.floor(ae*g),this.pos+4),this.pos+=8},writeVarint:function(ae){(ae=+ae||0)>268435455||ae<0?function(xe,He){var xt,Ht;if(xe>=0?(xt=xe%4294967296|0,Ht=xe/4294967296|0):(Ht=~(-xe/4294967296),4294967295^(xt=~(-xe%4294967296))?xt=xt+1|0:(xt=0,Ht=Ht+1|0)),xe>=18446744073709552e3||xe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");He.realloc(10),function(Et,Rt,Yt){Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Yt.buf[Yt.pos]=127&(Et>>>=7)}(xt,0,He),function(Et,Rt){var Yt=(7&Et)<<4;Rt.buf[Rt.pos++]|=Yt|((Et>>>=3)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et)))))}(Ht,He)}(ae,this):(this.realloc(4),this.buf[this.pos++]=127&ae|(ae>127?128:0),ae<=127||(this.buf[this.pos++]=127&(ae>>>=7)|(ae>127?128:0),ae<=127||(this.buf[this.pos++]=127&(ae>>>=7)|(ae>127?128:0),ae<=127||(this.buf[this.pos++]=ae>>>7&127))))},writeSVarint:function(ae){this.writeVarint(ae<0?2*-ae-1:2*ae)},writeBoolean:function(ae){this.writeVarint(!!ae)},writeString:function(ae){ae=String(ae),this.realloc(4*ae.length),this.pos++;var xe=this.pos;this.pos=function(xt,Ht,Et){for(var Rt,Yt,$t=0;$t<Ht.length;$t++){if((Rt=Ht.charCodeAt($t))>55295&&Rt<57344){if(!Yt){Rt>56319||$t+1===Ht.length?(xt[Et++]=239,xt[Et++]=191,xt[Et++]=189):Yt=Rt;continue}if(Rt<56320){xt[Et++]=239,xt[Et++]=191,xt[Et++]=189,Yt=Rt;continue}Rt=Yt-55296<<10|Rt-56320|65536,Yt=null}else Yt&&(xt[Et++]=239,xt[Et++]=191,xt[Et++]=189,Yt=null);Rt<128?xt[Et++]=Rt:(Rt<2048?xt[Et++]=Rt>>6|192:(Rt<65536?xt[Et++]=Rt>>12|224:(xt[Et++]=Rt>>18|240,xt[Et++]=Rt>>12&63|128),xt[Et++]=Rt>>6&63|128),xt[Et++]=63&Rt|128)}return Et}(this.buf,ae,this.pos);var He=this.pos-xe;He>=128&&D(xe,He,this),this.pos=xe-1,this.writeVarint(He),this.pos+=He},writeFloat:function(ae){this.realloc(4),f.write(this.buf,ae,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ae){this.realloc(8),f.write(this.buf,ae,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ae){var xe=ae.length;this.writeVarint(xe),this.realloc(xe);for(var He=0;He<xe;He++)this.buf[this.pos++]=ae[He]},writeRawMessage:function(ae,xe){this.pos++;var He=this.pos;ae(xe,this);var xt=this.pos-He;xt>=128&&D(He,xt,this),this.pos=He-1,this.writeVarint(xt),this.pos+=xt},writeMessage:function(ae,xe,He){this.writeTag(ae,l.Bytes),this.writeRawMessage(xe,He)},writePackedVarint:function(ae,xe){xe.length&&this.writeMessage(ae,U,xe)},writePackedSVarint:function(ae,xe){xe.length&&this.writeMessage(ae,G,xe)},writePackedBoolean:function(ae,xe){xe.length&&this.writeMessage(ae,oe,xe)},writePackedFloat:function(ae,xe){xe.length&&this.writeMessage(ae,$,xe)},writePackedDouble:function(ae,xe){xe.length&&this.writeMessage(ae,Y,xe)},writePackedFixed32:function(ae,xe){xe.length&&this.writeMessage(ae,le,xe)},writePackedSFixed32:function(ae,xe){xe.length&&this.writeMessage(ae,ue,xe)},writePackedFixed64:function(ae,xe){xe.length&&this.writeMessage(ae,pe,xe)},writePackedSFixed64:function(ae,xe){xe.length&&this.writeMessage(ae,Te,xe)},writeBytesField:function(ae,xe){this.writeTag(ae,l.Bytes),this.writeBytes(xe)},writeFixed32Field:function(ae,xe){this.writeTag(ae,l.Fixed32),this.writeFixed32(xe)},writeSFixed32Field:function(ae,xe){this.writeTag(ae,l.Fixed32),this.writeSFixed32(xe)},writeFixed64Field:function(ae,xe){this.writeTag(ae,l.Fixed64),this.writeFixed64(xe)},writeSFixed64Field:function(ae,xe){this.writeTag(ae,l.Fixed64),this.writeSFixed64(xe)},writeVarintField:function(ae,xe){this.writeTag(ae,l.Varint),this.writeVarint(xe)},writeSVarintField:function(ae,xe){this.writeTag(ae,l.Varint),this.writeSVarint(xe)},writeStringField:function(ae,xe){this.writeTag(ae,l.Bytes),this.writeString(xe)},writeFloatField:function(ae,xe){this.writeTag(ae,l.Fixed32),this.writeFloat(xe)},writeDoubleField:function(ae,xe){this.writeTag(ae,l.Fixed64),this.writeDouble(xe)},writeBooleanField:function(ae,xe){this.writeVarintField(ae,!!xe)}},_E}var xE=a(VR());let bE=3;function T$(f,l,d){f===1&&d.readMessage(E$,l)}function E$(f,l,d){if(f===3){let{id:g,bitmap:w,width:I,height:P,left:D,top:U,advance:G}=d.readMessage(C$,{});l.push({id:g,bitmap:new qg({width:I+2*bE,height:P+2*bE},w),metrics:{width:I,height:P,left:D,top:U,advance:G}})}}function C$(f,l,d){f===1?l.id=d.readVarint():f===2?l.bitmap=d.readBytes():f===3?l.width=d.readVarint():f===4?l.height=d.readVarint():f===5?l.left=d.readSVarint():f===6?l.top=d.readSVarint():f===7&&(l.advance=d.readVarint())}let S$=bE;function jR(f){let l=0,d=0;for(let P of f)l+=P.w*P.h,d=Math.max(d,P.w);f.sort((P,D)=>D.h-P.h);let g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),d),h:1/0}],w=0,I=0;for(let P of f)for(let D=g.length-1;D>=0;D--){let U=g[D];if(!(P.w>U.w||P.h>U.h)){if(P.x=U.x,P.y=U.y,I=Math.max(I,P.y+P.h),w=Math.max(w,P.x+P.w),P.w===U.w&&P.h===U.h){let G=g.pop();D<g.length&&(g[D]=G)}else P.h===U.h?(U.x+=P.w,U.w-=P.w):P.w===U.w?(U.y+=P.h,U.h-=P.h):(g.push({x:U.x+P.w,y:U.y,w:U.w-P.w,h:P.h}),U.y+=P.h,U.h-=P.h);break}}return{w,h:I,fill:l/(w*I)||0}}let ia=1;class vE{constructor(l,{pixelRatio:d,version:g,stretchX:w,stretchY:I,content:P,textFitWidth:D,textFitHeight:U}){this.paddedRect=l,this.pixelRatio=d,this.stretchX=w,this.stretchY=I,this.content=P,this.version=g,this.textFitWidth=D,this.textFitHeight=U}get tl(){return[this.paddedRect.x+ia,this.paddedRect.y+ia]}get br(){return[this.paddedRect.x+this.paddedRect.w-ia,this.paddedRect.y+this.paddedRect.h-ia]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ia)/this.pixelRatio,(this.paddedRect.h-2*ia)/this.pixelRatio]}}class GR{constructor(l,d){let g={},w={};this.haveRenderCallbacks=[];let I=[];this.addImages(l,g,I),this.addImages(d,w,I);let{w:P,h:D}=jR(I),U=new Wa({width:P||1,height:D||1});for(let G in l){let $=l[G],Y=g[G].paddedRect;Wa.copy($.data,U,{x:0,y:0},{x:Y.x+ia,y:Y.y+ia},$.data)}for(let G in d){let $=d[G],Y=w[G].paddedRect,oe=Y.x+ia,le=Y.y+ia,ue=$.data.width,pe=$.data.height;Wa.copy($.data,U,{x:0,y:0},{x:oe,y:le},$.data),Wa.copy($.data,U,{x:0,y:pe-1},{x:oe,y:le-1},{width:ue,height:1}),Wa.copy($.data,U,{x:0,y:0},{x:oe,y:le+pe},{width:ue,height:1}),Wa.copy($.data,U,{x:ue-1,y:0},{x:oe-1,y:le},{width:1,height:pe}),Wa.copy($.data,U,{x:0,y:0},{x:oe+ue,y:le},{width:1,height:pe})}this.image=U,this.iconPositions=g,this.patternPositions=w}addImages(l,d,g){for(let w in l){let I=l[w],P={x:0,y:0,w:I.data.width+2*ia,h:I.data.height+2*ia};g.push(P),d[w]=new vE(P,I),I.hasRenderCallback&&this.haveRenderCallbacks.push(w)}}patchUpdatedImages(l,d){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let g in l.updatedImages)this.patchUpdatedImage(this.iconPositions[g],l.getImage(g),d),this.patchUpdatedImage(this.patternPositions[g],l.getImage(g),d)}patchUpdatedImage(l,d,g){if(!l||!d||l.version===d.version)return;l.version=d.version;let[w,I]=l.tl;g.update(d.data,void 0,{x:w,y:I})}}var $f;ur("ImagePosition",vE),ur("ImageAtlas",GR),n.ah=void 0,($f=n.ah||(n.ah={}))[$f.none=0]="none",$f[$f.horizontal=1]="horizontal",$f[$f.vertical=2]="vertical",$f[$f.horizontalOnly=3]="horizontalOnly";let _2=-17;class n_{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(l,d,g){let w=new n_;return w.scale=l||1,w.fontStack=d,w.verticalAlign=g||"bottom",w}static forImage(l,d){let g=new n_;return g.imageName=l,g.verticalAlign=d||"bottom",g}}class b0{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,d){let g=new b0;for(let w=0;w<l.sections.length;w++){let I=l.sections[w];I.image?g.addImageSection(I):g.addTextSection(I,d)}return g}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let d="";for(let g=0;g<l.length;g++){let w=l.charCodeAt(g+1)||null,I=l.charCodeAt(g-1)||null;d+=w&&dp(w)&&!i_[l[g+1]]||I&&dp(I)&&!i_[l[g-1]]||!i_[l[g]]?l[g]:i_[l[g]]}return d}(this.text)}trim(){let l=0;for(let g=0;g<this.text.length&&x2[this.text.charCodeAt(g)];g++)l++;let d=this.text.length;for(let g=this.text.length-1;g>=0&&g>=l&&x2[this.text.charCodeAt(g)];g--)d--;this.text=this.text.substring(l,d),this.sectionIndex=this.sectionIndex.slice(l,d)}substring(l,d){let g=new b0;return g.text=this.text.substring(l,d),g.sectionIndex=this.sectionIndex.slice(l,d),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,d)=>Math.max(l,this.sections[d].scale),0)}getMaxImageSize(l){let d=0,g=0;for(let w=0;w<this.length();w++){let I=this.getSection(w);if(I.imageName){let P=l[I.imageName];if(!P)continue;let D=P.displaySize;d=Math.max(d,D[0]),g=Math.max(g,D[1])}}return{maxImageWidth:d,maxImageHeight:g}}addTextSection(l,d){this.text+=l.text,this.sections.push(n_.forText(l.scale,l.fontStack||d,l.verticalAlign));let g=this.sections.length-1;for(let w=0;w<l.text.length;++w)this.sectionIndex.push(g)}addImageSection(l){let d=l.image?l.image.name:"";if(d.length===0)return void ki("Can't add FormattedSection with an empty image.");let g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(n_.forImage(d,l.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function y2(f,l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue){let pe=b0.fromFeature(f,w),Te;Y===n.ah.vertical&&pe.verticalizePunctuation();let{processBidirectionalText:Re,processStyledBidirectionalText:et}=Ha;if(Re&&pe.sections.length===1){Te=[];let xe=Re(pe.toString(),wE(pe,G,I,l,g,le));for(let He of xe){let xt=new b0;xt.text=He,xt.sections=pe.sections;for(let Ht=0;Ht<He.length;Ht++)xt.sectionIndex.push(0);Te.push(xt)}}else if(et){Te=[];let xe=et(pe.text,pe.sectionIndex,wE(pe,G,I,l,g,le));for(let He of xe){let xt=new b0;xt.text=He[0],xt.sectionIndex=He[1],xt.sections=pe.sections,Te.push(xt)}}else Te=function(xe,He){let xt=[],Ht=xe.text,Et=0;for(let Rt of He)xt.push(xe.substring(Et,Rt)),Et=Rt;return Et<Ht.length&&xt.push(xe.substring(Et,Ht.length)),xt}(pe,wE(pe,G,I,l,g,le));let Ne=[],ae={positionedLines:Ne,text:pe.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return function(xe,He,xt,Ht,Et,Rt,Yt,$t,Qt,Dt,Ar,Br){let Ir=0,yr=0,yi=0,$n=0,Eo=$t==="right"?1:$t==="left"?0:.5,ms=To/Br,qa=0;for(let jn of Et){jn.trim();let Uo=jn.getMaxScale(),es={positionedGlyphs:[],lineOffset:0};xe.positionedLines[qa]=es;let ts=es.positionedGlyphs,Vs=0;if(!jn.length()){yr+=Rt,++qa;continue}let Za=R$(Ht,jn,ms);for(let oa=0;oa<jn.length();oa++){let Co=jn.getSection(oa),jo=jn.getSectionIndex(oa),Go=jn.getCharCode(oa),Ao=B$(Qt,Ar,Go),Tn;if(Co.imageName){if(xe.iconsInText=!0,Co.scale=Co.scale*ms,Tn=O$(Co,Ao,Uo,Za,Ht),!Tn)continue;Vs=Math.max(Vs,Tn.imageOffset)}else if(Tn=L$(Co,Go,Ao,Za,He,xt),!Tn)continue;let{rect:Ac,metrics:E0,baselineOffset:mc}=Tn;ts.push({glyph:Go,imageName:Co.imageName,x:Ir,y:yr+mc+_2,vertical:Ao,scale:Co.scale,fontStack:Co.fontStack,sectionIndex:jo,metrics:E0,rect:Ac}),Ao?(xe.verticalizable=!0,Ir+=(Co.imageName?E0.advance:To)*Co.scale+Dt):Ir+=E0.advance*Co.scale+Dt}ts.length!==0&&(yi=Math.max(Ir-Dt,yi),D$(ts,0,ts.length-1,Eo)),Ir=0,es.lineOffset=Math.max(Vs,(Uo-1)*To);let Vo=Rt*Uo+Vs;yr+=Vo,$n=Math.max(Vo,$n),++qa}let{horizontalAlign:na,verticalAlign:Jo}=TE(Yt);(function(jn,Uo,es,ts,Vs,Za,Vo,oa,Co){let jo=(Uo-es)*Vs,Go=0;Go=Za!==Vo?-oa*ts-_2:-ts*Co*Vo+.5*Vo;for(let Ao of jn)for(let Tn of Ao.positionedGlyphs)Tn.x+=jo,Tn.y+=Go})(xe.positionedLines,Eo,na,Jo,yi,$n,Rt,yr,Et.length),xe.top+=-Jo*yr,xe.bottom=xe.top+yr,xe.left+=-na*yi,xe.right=xe.left+yi}(ae,l,d,g,Te,P,D,U,Y,G,oe,ue),!function(xe){for(let He of xe)if(He.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&ae}let x2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},I$={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},M$={40:!0};function HR(f,l,d,g,w,I){if(l.imageName){let P=g[l.imageName];return P?P.displaySize[0]*l.scale*To/I+w:0}{let P=d[l.fontStack],D=P&&P[f];return D?D.metrics.advance*l.scale+w:0}}function WR(f,l,d,g){let w=Math.pow(f-l,2);return g?f<l?w/2:2*w:w+Math.abs(d)*d}function P$(f,l,d){let g=0;return f===10&&(g-=1e4),d&&(g+=150),f!==40&&f!==65288||(g+=50),l!==41&&l!==65289||(g+=50),g}function $R(f,l,d,g,w,I){let P=null,D=WR(l,d,w,I);for(let U of g){let G=WR(l-U.x,d,w,I)+U.badness;G<=D&&(P=U,D=G)}return{index:f,x:l,priorBreak:P,badness:D}}function qR(f){return f?qR(f.priorBreak).concat(f.index):[]}function wE(f,l,d,g,w,I){if(!f)return[];let P=[],D=function(Y,oe,le,ue,pe,Te){let Re=0;for(let et=0;et<Y.length();et++){let Ne=Y.getSection(et);Re+=HR(Y.getCharCode(et),Ne,ue,pe,oe,Te)}return Re/Math.max(1,Math.ceil(Re/le))}(f,l,d,g,w,I),U=f.text.indexOf("\u200B")>=0,G=0;for(let Y=0;Y<f.length();Y++){let oe=f.getSection(Y),le=f.getCharCode(Y);if(x2[le]||(G+=HR(le,oe,g,w,l,I)),Y<f.length()-1){let ue=!(($=le)<11904)&&(!!li["CJK Compatibility Forms"]($)||!!li["CJK Compatibility"]($)||!!li["CJK Strokes"]($)||!!li["CJK Symbols and Punctuation"]($)||!!li["Enclosed CJK Letters and Months"]($)||!!li["Halfwidth and Fullwidth Forms"]($)||!!li["Ideographic Description Characters"]($)||!!li["Vertical Forms"]($)||uc.test(String.fromCodePoint($)));(I$[le]||ue||oe.imageName||Y!==f.length()-2&&M$[f.getCharCode(Y+1)])&&P.push($R(Y+1,G,D,P,P$(le,f.getCharCode(Y+1),ue&&U),!1))}}var $;return qR($R(f.length(),G,D,P,0,!0))}function TE(f){let l=.5,d=.5;switch(f){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:l,verticalAlign:d}}function R$(f,l,d){let g=l.getMaxScale()*To,{maxImageWidth:w,maxImageHeight:I}=l.getMaxImageSize(f),P=Math.max(g,I*d);return{verticalLineContentWidth:Math.max(g,w*d),horizontalLineContentHeight:P}}function ZR(f){switch(f){case"top":return 0;case"center":return .5;default:return 1}}function B$(f,l,d){return!(f===n.ah.horizontal||!l&&!gl(d)||l&&(x2[d]||(g=d,/\p{sc=Arab}/u.test(String.fromCodePoint(g)))));var g}function L$(f,l,d,g,w,I){let P=I[f.fontStack],D=function(G,$,Y,oe){if(G&&G.rect)return G;let le=$[Y.fontStack],ue=le&&le[oe];return ue?{rect:null,metrics:ue.metrics}:null}(P&&P[l],w,f,l);if(D===null)return null;let U;if(d)U=g.verticalLineContentWidth-f.scale*To;else{let G=ZR(f.verticalAlign);U=(g.horizontalLineContentHeight-f.scale*To)*G}return{rect:D.rect,metrics:D.metrics,baselineOffset:U}}function O$(f,l,d,g,w){let I=w[f.imageName];if(!I)return null;let P=I.paddedRect,D=I.displaySize,U={width:D[0],height:D[1],left:ia,top:-3,advance:l?D[1]:D[0]},G;if(l)G=g.verticalLineContentWidth-D[1]*f.scale;else{let $=ZR(f.verticalAlign);G=(g.horizontalLineContentHeight-D[1]*f.scale)*$}return{rect:P,metrics:U,baselineOffset:G,imageOffset:(l?D[0]:D[1])*f.scale-To*d}}function D$(f,l,d,g){if(g===0)return;let w=f[d],I=(f[d].x+w.metrics.advance*w.scale)*g;for(let P=l;P<=d;P++)f[P].x-=I}function F$(f,l,d){let{horizontalAlign:g,verticalAlign:w}=TE(d),I=l[0]-f.displaySize[0]*g,P=l[1]-f.displaySize[1]*w;return{image:f,top:P,bottom:P+f.displaySize[1],left:I,right:I+f.displaySize[0]}}function XR(f){var l,d;let g=f.left,w=f.top,I=f.right-g,P=f.bottom-w,D=(l=f.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",U=(d=f.image.textFitHeight)!==null&&d!==void 0?d:"stretchOrShrink",G=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(U==="proportional"){if(D==="stretchOnly"&&I/P<G||D==="proportional"){let $=Math.ceil(P*G);g*=$/I,I=$}}else if(D==="proportional"&&U==="stretchOnly"&&G!==0&&I/P>G){let $=Math.ceil(I/G);w*=$/P,P=$}return{x1:g,y1:w,x2:g+I,y2:w+P}}function YR(f,l,d,g,w,I){let P=f.image,D;if(P.content){let Te=P.content,Re=P.pixelRatio||1;D=[Te[0]/Re,Te[1]/Re,P.displaySize[0]-Te[2]/Re,P.displaySize[1]-Te[3]/Re]}let U=l.left*I,G=l.right*I,$,Y,oe,le;d==="width"||d==="both"?(le=w[0]+U-g[3],Y=w[0]+G+g[1]):(le=w[0]+(U+G-P.displaySize[0])/2,Y=le+P.displaySize[0]);let ue=l.top*I,pe=l.bottom*I;return d==="height"||d==="both"?($=w[1]+ue-g[0],oe=w[1]+pe+g[2]):($=w[1]+(ue+pe-P.displaySize[1])/2,oe=$+P.displaySize[1]),{image:P,top:$,right:Y,bottom:oe,left:le,collisionPadding:D}}let o_=255,pu=128,qf=o_*pu;function KR(f,l){let{expression:d}=l;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new hn(f+1))};if(d.kind==="source")return{kind:"source"};{let{zoomStops:g,interpolationType:w}=d,I=0;for(;I<g.length&&g[I]<=f;)I++;I=Math.max(0,I-1);let P=I;for(;P<g.length&&g[P]<f+1;)P++;P=Math.min(g.length-1,P);let D=g[I],U=g[P];return d.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:U,interpolationType:w}:{kind:"camera",minZoom:D,maxZoom:U,minSize:d.evaluate(new hn(D)),maxSize:d.evaluate(new hn(U)),interpolationType:w}}}function EE(f,l,d){let g="never",w=f.get(l);return w?g=w:f.get(d)&&(g="always"),g}let k$=e_.VectorTileFeature.types,N$=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function b2(f,l,d,g,w,I,P,D,U,G,$,Y,oe){let le=D?Math.min(qf,Math.round(D[0])):0,ue=D?Math.min(qf,Math.round(D[1])):0;f.emplaceBack(l,d,Math.round(32*g),Math.round(32*w),I,P,(le<<1)+(U?1:0),ue,16*G,16*$,256*Y,256*oe)}function CE(f,l,d){f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d),f.emplaceBack(l.x,l.y,d)}function z$(f){for(let l of f.sections)if(Hg(l.text))return!0;return!1}class SE{constructor(l){this.layoutVertexArray=new Pt,this.indexArray=new Ut,this.programConfigurations=l,this.segments=new Hr,this.dynamicLayoutVertexArray=new Lt,this.opacityVertexArray=new Tt,this.hasVisibleVertices=!1,this.placedSymbolArray=new K}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,d,g,w){this.isEmpty()||(g&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,_$.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,y$.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,N$,!0),this.opacityVertexBuffer.itemSize=1),(g||w)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ur("SymbolBuffers",SE);class IE{constructor(l,d,g){this.layoutVertexArray=new l,this.layoutAttributes=d,this.indexArray=new g,this.segments=new Hr,this.collisionVertexArray=new Kt}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,x$.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ur("CollisionBuffers",IE);class v0{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(P=>P.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=KR(this.zoom,d["text-size"]),this.iconSizeData=KR(this.zoom,d["icon-size"]);let g=this.layers[0].layout,w=g.get("symbol-sort-key"),I=g.get("symbol-z-order");this.canOverlap=EE(g,"text-overlap","text-allow-overlap")!=="never"||EE(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=I!=="viewport-y"&&!w.isConstant(),this.sortFeaturesByY=(I==="viewport-y"||I==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(P=>n.ah[P])),this.stateDependentLayerIds=this.layers.filter(P=>P.isStateDependent()).map(P=>P.id),this.sourceID=l.sourceID}createArrays(){this.text=new SE(new ar(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new SE(new ar(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new fe,this.lineVertexArray=new Ae,this.symbolInstances=new ie,this.textAnchorOffsets=new Ce}calculateGlyphDependencies(l,d,g,w,I){for(let P=0;P<l.length;P++)if(d[l.charCodeAt(P)]=!0,(g||w)&&I){let D=i_[l.charAt(P)];D&&(d[D.charCodeAt(0)]=!0)}}populate(l,d,g){let w=this.layers[0],I=w.layout,P=I.get("text-font"),D=I.get("text-field"),U=I.get("icon-image"),G=(D.value.kind!=="constant"||D.value.value instanceof us&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(P.value.kind!=="constant"||P.value.value.length>0),$=U.value.kind!=="constant"||!!U.value.value||Object.keys(U.parameters).length>0,Y=I.get("symbol-sort-key");if(this.features=[],!G&&!$)return;let oe=d.iconDependencies,le=d.glyphDependencies,ue=d.availableImages,pe=new hn(this.zoom);for(let{feature:Te,id:Re,index:et,sourceLayerIndex:Ne}of l){let ae=w._featureFilter.needGeometry,xe=ni(Te,ae);if(!w._featureFilter.filter(pe,xe,g))continue;let He,xt;if(ae||(xe.geometry=ri(Te)),G){let Et=w.getValueAndResolveTokens("text-field",xe,g,ue),Rt=us.factory(Et),Yt=this.hasRTLText=this.hasRTLText||z$(Rt);(!Yt||Ha.getRTLTextPluginStatus()==="unavailable"||Yt&&Ha.isParsed())&&(He=v$(Rt,w,xe))}if($){let Et=w.getValueAndResolveTokens("icon-image",xe,g,ue);xt=Et instanceof Ss?Et:Ss.fromString(Et)}if(!He&&!xt)continue;let Ht=this.sortFeaturesByKey?Y.evaluate(xe,{},g):void 0;if(this.features.push({id:Re,text:He,icon:xt,index:et,sourceLayerIndex:Ne,geometry:xe.geometry,properties:Te.properties,type:k$[Te.type],sortKey:Ht}),xt&&(oe[xt.name]=!0),He){let Et=P.evaluate(xe,{},g).join(","),Rt=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.ah.vertical)>=0;for(let Yt of He.sections)if(Yt.image)oe[Yt.image.name]=!0;else{let $t=cu(He.toString()),Qt=Yt.fontStack||Et,Dt=le[Qt]=le[Qt]||{};this.calculateGlyphDependencies(Yt.text,Dt,Rt,this.allowVerticalPlacement,$t)}}}I.get("symbol-placement")==="line"&&(this.features=function(Te){let Re={},et={},Ne=[],ae=0;function xe(Et){Ne.push(Te[Et]),ae++}function He(Et,Rt,Yt){let $t=et[Et];return delete et[Et],et[Rt]=$t,Ne[$t].geometry[0].pop(),Ne[$t].geometry[0]=Ne[$t].geometry[0].concat(Yt[0]),$t}function xt(Et,Rt,Yt){let $t=Re[Rt];return delete Re[Rt],Re[Et]=$t,Ne[$t].geometry[0].shift(),Ne[$t].geometry[0]=Yt[0].concat(Ne[$t].geometry[0]),$t}function Ht(Et,Rt,Yt){let $t=Yt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${Et}:${$t.x}:${$t.y}`}for(let Et=0;Et<Te.length;Et++){let Rt=Te[Et],Yt=Rt.geometry,$t=Rt.text?Rt.text.toString():null;if(!$t){xe(Et);continue}let Qt=Ht($t,Yt),Dt=Ht($t,Yt,!0);if(Qt in et&&Dt in Re&&et[Qt]!==Re[Dt]){let Ar=xt(Qt,Dt,Yt),Br=He(Qt,Dt,Ne[Ar].geometry);delete Re[Qt],delete et[Dt],et[Ht($t,Ne[Br].geometry,!0)]=Br,Ne[Ar].geometry=null}else Qt in et?He(Qt,Dt,Yt):Dt in Re?xt(Qt,Dt,Yt):(xe(Et),Re[Qt]=ae-1,et[Dt]=ae-1)}return Ne.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Re)=>Te.sortKey-Re.sortKey)}update(l,d,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,d,this.layers,g),this.icon.programConfigurations.updatePaintArrays(l,d,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,d){let g=this.lineVertexArray.length;if(l.segment!==void 0){let w=l.dist(d[l.segment+1]),I=l.dist(d[l.segment]),P={};for(let D=l.segment+1;D<d.length;D++)P[D]={x:d[D].x,y:d[D].y,tileUnitDistanceFromAnchor:w},D<d.length-1&&(w+=d[D+1].dist(d[D]));for(let D=l.segment||0;D>=0;D--)P[D]={x:d[D].x,y:d[D].y,tileUnitDistanceFromAnchor:I},D>0&&(I+=d[D-1].dist(d[D]));for(let D=0;D<d.length;D++){let U=P[D];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(l,d,g,w,I,P,D,U,G,$,Y,oe){let le=l.indexArray,ue=l.layoutVertexArray,pe=l.segments.prepareSegment(4*d.length,ue,le,this.canOverlap?P.sortKey:void 0),Te=this.glyphOffsetArray.length,Re=pe.vertexLength,et=this.allowVerticalPlacement&&D===n.ah.vertical?Math.PI/2:0,Ne=P.text&&P.text.sections;for(let ae=0;ae<d.length;ae++){let{tl:xe,tr:He,bl:xt,br:Ht,tex:Et,pixelOffsetTL:Rt,pixelOffsetBR:Yt,minFontScaleX:$t,minFontScaleY:Qt,glyphOffset:Dt,isSDF:Ar,sectionIndex:Br}=d[ae],Ir=pe.vertexLength,yr=Dt[1];b2(ue,U.x,U.y,xe.x,yr+xe.y,Et.x,Et.y,g,Ar,Rt.x,Rt.y,$t,Qt),b2(ue,U.x,U.y,He.x,yr+He.y,Et.x+Et.w,Et.y,g,Ar,Yt.x,Rt.y,$t,Qt),b2(ue,U.x,U.y,xt.x,yr+xt.y,Et.x,Et.y+Et.h,g,Ar,Rt.x,Yt.y,$t,Qt),b2(ue,U.x,U.y,Ht.x,yr+Ht.y,Et.x+Et.w,Et.y+Et.h,g,Ar,Yt.x,Yt.y,$t,Qt),CE(l.dynamicLayoutVertexArray,U,et),le.emplaceBack(Ir,Ir+2,Ir+1),le.emplaceBack(Ir+1,Ir+2,Ir+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),ae!==d.length-1&&Br===d[ae+1].sectionIndex||l.programConfigurations.populatePaintArrays(ue.length,P,P.index,{},oe,Ne&&Ne[Br])}l.placedSymbolArray.emplaceBack(U.x,U.y,Te,this.glyphOffsetArray.length-Te,Re,G,$,U.segment,g?g[0]:0,g?g[1]:0,w[0],w[1],D,0,!1,0,Y)}_addCollisionDebugVertex(l,d,g,w,I,P){return d.emplaceBack(0,0),l.emplaceBack(g.x,g.y,w,I,Math.round(P.x),Math.round(P.y))}addCollisionDebugVertices(l,d,g,w,I,P,D){let U=I.segments.prepareSegment(4,I.layoutVertexArray,I.indexArray),G=U.vertexLength,$=I.layoutVertexArray,Y=I.collisionVertexArray,oe=D.anchorX,le=D.anchorY;this._addCollisionDebugVertex($,Y,P,oe,le,new R(l,d)),this._addCollisionDebugVertex($,Y,P,oe,le,new R(g,d)),this._addCollisionDebugVertex($,Y,P,oe,le,new R(g,w)),this._addCollisionDebugVertex($,Y,P,oe,le,new R(l,w)),U.vertexLength+=4;let ue=I.indexArray;ue.emplaceBack(G,G+1),ue.emplaceBack(G+1,G+2),ue.emplaceBack(G+2,G+3),ue.emplaceBack(G+3,G),U.primitiveLength+=4}addDebugCollisionBoxes(l,d,g,w){for(let I=l;I<d;I++){let P=this.collisionBoxArray.get(I);this.addCollisionDebugVertices(P.x1,P.y1,P.x2,P.y2,w?this.textCollisionBox:this.iconCollisionBox,P.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new IE(er,NR.members,mt),this.iconCollisionBox=new IE(er,NR.members,mt);for(let l=0;l<this.symbolInstances.length;l++){let d=this.symbolInstances.get(l);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(l,d,g,w,I,P,D,U,G){let $={};for(let Y=d;Y<g;Y++){let oe=l.get(Y);$.textBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},$.textFeatureIndex=oe.featureIndex;break}for(let Y=w;Y<I;Y++){let oe=l.get(Y);$.verticalTextBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},$.verticalTextFeatureIndex=oe.featureIndex;break}for(let Y=P;Y<D;Y++){let oe=l.get(Y);$.iconBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},$.iconFeatureIndex=oe.featureIndex;break}for(let Y=U;Y<G;Y++){let oe=l.get(Y);$.verticalIconBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},$.verticalIconFeatureIndex=oe.featureIndex;break}return $}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){let g=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,d){let g=l.placedSymbolArray.get(d),w=g.vertexStartIndex+4*g.numGlyphs;for(let I=g.vertexStartIndex;I<w;I+=4)l.indexArray.emplaceBack(I,I+2,I+1),l.indexArray.emplaceBack(I+1,I+2,I+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let d=Math.sin(l),g=Math.cos(l),w=[],I=[],P=[];for(let D=0;D<this.symbolInstances.length;++D){P.push(D);let U=this.symbolInstances.get(D);w.push(0|Math.round(d*U.anchorX+g*U.anchorY)),I.push(U.featureIndex)}return P.sort((D,U)=>w[D]-w[U]||I[U]-I[D]),P}addToSortKeyRanges(l,d){let g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===d?g.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let d of this.symbolInstanceIndexes){let g=this.symbolInstances.get(d);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((w,I,P)=>{w>=0&&P.indexOf(w)===I&&this.addIndicesForPlacedSymbol(this.text,w)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let QR,JR;ur("SymbolBucket",v0,{omit:["layers","collisionBoxArray","features","compareText"]}),v0.MAX_GLYPHS=65535,v0.addDynamicAttributes=CE;var ME={get paint(){return JR=JR||new ps({"icon-opacity":new Rr(ce.paint_symbol["icon-opacity"]),"icon-color":new Rr(ce.paint_symbol["icon-color"]),"icon-halo-color":new Rr(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rr(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rr(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new xr(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new xr(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rr(ce.paint_symbol["text-opacity"]),"text-color":new Rr(ce.paint_symbol["text-color"],{runtimeType:Ur,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new Rr(ce.paint_symbol["text-halo-color"]),"text-halo-width":new Rr(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Rr(ce.paint_symbol["text-halo-blur"]),"text-translate":new xr(ce.paint_symbol["text-translate"]),"text-translate-anchor":new xr(ce.paint_symbol["text-translate-anchor"])})},get layout(){return QR=QR||new ps({"symbol-placement":new xr(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new xr(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xr(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rr(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xr(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xr(ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new xr(ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new xr(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new xr(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xr(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rr(ce.layout_symbol["icon-size"]),"icon-text-fit":new xr(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xr(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rr(ce.layout_symbol["icon-image"]),"icon-rotate":new Rr(ce.layout_symbol["icon-rotate"]),"icon-padding":new Rr(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new xr(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Rr(ce.layout_symbol["icon-offset"]),"icon-anchor":new Rr(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xr(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xr(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xr(ce.layout_symbol["text-rotation-alignment"]),"text-field":new Rr(ce.layout_symbol["text-field"]),"text-font":new Rr(ce.layout_symbol["text-font"]),"text-size":new Rr(ce.layout_symbol["text-size"]),"text-max-width":new Rr(ce.layout_symbol["text-max-width"]),"text-line-height":new xr(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Rr(ce.layout_symbol["text-letter-spacing"]),"text-justify":new Rr(ce.layout_symbol["text-justify"]),"text-radial-offset":new Rr(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xr(ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Rr(ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Rr(ce.layout_symbol["text-anchor"]),"text-max-angle":new xr(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new xr(ce.layout_symbol["text-writing-mode"]),"text-rotate":new Rr(ce.layout_symbol["text-rotate"]),"text-padding":new xr(ce.layout_symbol["text-padding"]),"text-keep-upright":new xr(ce.layout_symbol["text-keep-upright"]),"text-transform":new Rr(ce.layout_symbol["text-transform"]),"text-offset":new Rr(ce.layout_symbol["text-offset"]),"text-allow-overlap":new xr(ce.layout_symbol["text-allow-overlap"]),"text-overlap":new xr(ce.layout_symbol["text-overlap"]),"text-ignore-placement":new xr(ce.layout_symbol["text-ignore-placement"]),"text-optional":new xr(ce.layout_symbol["text-optional"])})}};class eB{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:gi,this.defaultValue=l}evaluate(l){if(l.formattedSection){let d=this.defaultValue.property.overrides;if(d&&d.hasOverride(l.formattedSection))return d.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ur("FormatSectionOverride",eB,{omit:["defaultValue"]});class v2 extends Bn{constructor(l){super(l,ME)}recalculate(l,d){if(super.recalculate(l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let g=this.layout.get("text-writing-mode");if(g){let w=[];for(let I of g)w.indexOf(I)<0&&w.push(I);this.layout._values["text-writing-mode"]=w}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,d,g,w){let I=this.layout.get(l).evaluate(d,{},g,w),P=this._unevaluatedLayout._values[l];return P.isDataDriven()||Ah(P.value)||!I?I:function(D,U){return U.replace(/{([^{}]+)}/g,(G,$)=>D&&$ in D?String(D[$]):"")}(d.properties,I)}createBucket(l){return new v0(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let l of ME.paint.overridableProperties){if(!v2.hasPaintOverride(this.layout,l))continue;let d=this.paint.get(l),g=new eB(d),w=new tu(g,d.property.specification),I=null;I=d.value.kind==="constant"||d.value.kind==="source"?new Pf("source",w):new ru("composite",w,d.value.zoomStops),this.paint._values[l]=new Ca(d.property,I,d.parameters)}}_handleOverridablePaintPropertyUpdate(l,d,g){return!(!this.layout||d.isDataDriven()||g.isDataDriven())&&v2.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,d){let g=l.get("text-field"),w=ME.paint.properties[d],I=!1,P=D=>{for(let U of D)if(w.overrides&&w.overrides.hasOverride(U))return void(I=!0)};if(g.value.kind==="constant"&&g.value.value instanceof us)P(g.value.value.sections);else if(g.value.kind==="source"){let D=G=>{I||(G instanceof Xl&&vn(G.value)===rn?P(G.value.sections):G instanceof Na?P(G.sections):G.eachChild(D))},U=g.value;U._styleExpression&&D(U._styleExpression.expression)}return I}}let tB;var U$={get paint(){return tB=tB||new ps({"background-color":new xr(ce.paint_background["background-color"]),"background-pattern":new mp(ce.paint_background["background-pattern"]),"background-opacity":new xr(ce.paint_background["background-opacity"])})}};class V$ extends Bn{constructor(l){super(l,U$)}}let rB;var j$={get paint(){return rB=rB||new ps({"raster-opacity":new xr(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new xr(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xr(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xr(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new xr(ce.paint_raster["raster-saturation"]),"raster-contrast":new xr(ce.paint_raster["raster-contrast"]),"raster-resampling":new xr(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new xr(ce.paint_raster["raster-fade-duration"])})}};class G$ extends Bn{constructor(l){super(l,j$)}}class H$ extends Bn{constructor(l){super(l,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class W${constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let $$={once:!0},PE=63710088e-1;class Zf{constructor(l,d){if(isNaN(l)||isNaN(d))throw new Error(`Invalid LngLat object: (${l}, ${d})`);if(this.lng=+l,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zf(fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){let d=Math.PI/180,g=this.lat*d,w=l.lat*d,I=Math.sin(g)*Math.sin(w)+Math.cos(g)*Math.cos(w)*Math.cos((l.lng-this.lng)*d);return PE*Math.acos(Math.min(I,1))}static convert(l){if(l instanceof Zf)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Zf(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Zf(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let iB=2*Math.PI*PE;function nB(f){return iB*Math.cos(f*Math.PI/180)}function oB(f){return(180+f)/360}function sB(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function aB(f,l){return f/nB(l)}function RE(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}function lB(f,l){return f*nB(RE(l))}class s_{constructor(l,d,g=0){this.x=+l,this.y=+d,this.z=+g}static fromLngLat(l,d=0){let g=Zf.convert(l);return new s_(oB(g.lng),sB(g.lat),aB(d,g.lat))}toLngLat(){return new Zf(360*this.x-180,RE(this.y))}toAltitude(){return lB(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/iB*(l=RE(this.y),1/Math.cos(l*Math.PI/180));var l}}function cB(f,l,d){var g=2*Math.PI*6378137/256/Math.pow(2,d);return[f*g-2*Math.PI*6378137/2,l*g-2*Math.PI*6378137/2]}class BE{constructor(l,d,g){if(!function(w,I,P){return!(w<0||w>25||P<0||P>=Math.pow(2,w)||I<0||I>=Math.pow(2,w))}(l,d,g))throw new Error(`x=${d}, y=${g}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=d,this.y=g,this.key=w0(0,l,l,d,g)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,d,g){let w=(P=this.y,D=this.z,U=cB(256*(I=this.x),256*(P=Math.pow(2,D)-P-1),D),G=cB(256*(I+1),256*(P+1),D),U[0]+","+U[1]+","+G[0]+","+G[1]);var I,P,D,U,G;let $=function(Y,oe,le){let ue,pe="";for(let Te=Y;Te>0;Te--)ue=1<<Te-1,pe+=(oe&ue?1:0)+(le&ue?2:0);return pe}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,$).replace(/{bbox-epsg-3857}/g,w)}isChildOf(l){let d=this.z-l.z;return d>0&&l.x===this.x>>d&&l.y===this.y>>d}getTilePoint(l){let d=Math.pow(2,this.z);return new R((l.x*d-this.x)*ve,(l.y*d-this.y)*ve)}toString(){return`${this.z}/${this.x}/${this.y}`}}class uB{constructor(l,d){this.wrap=l,this.canonical=d,this.key=w0(l,d.z,d.z,d.x,d.y)}}class $a{constructor(l,d,g,w,I){if(this.terrainRttPosMatrix32f=null,l<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${g}`);this.overscaledZ=l,this.wrap=d,this.canonical=new BE(g,+w,+I),this.key=w0(d,l,g,w,I)}clone(){return new $a(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let d=this.canonical.z-l;return l>this.canonical.z?new $a(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $a(l,this.wrap,l,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(l,d){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let g=this.canonical.z-l;return l>this.canonical.z?w0(this.wrap*+d,l,this.canonical.z,this.canonical.x,this.canonical.y):w0(this.wrap*+d,l,l,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(l){if(l.wrap!==this.wrap)return!1;let d=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>d&&l.canonical.y===this.canonical.y>>d}children(l){if(this.overscaledZ>=l)return[new $a(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let d=this.canonical.z+1,g=2*this.canonical.x,w=2*this.canonical.y;return[new $a(d,this.wrap,d,g,w),new $a(d,this.wrap,d,g+1,w),new $a(d,this.wrap,d,g,w+1),new $a(d,this.wrap,d,g+1,w+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new $a(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new $a(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uB(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new s_(l.x-this.wrap,l.y))}}function w0(f,l,d,g,w){(f*=2)<0&&(f=-1*f-1);let I=1<<d;return(I*I*f+I*w+g).toString(36)+d.toString(36)+l.toString(36)}ur("CanonicalTileID",BE),ur("OverscaledTileID",$a,{omit:["terrainRttPosMatrix32f"]});class hB{constructor(l,d,g,w=1,I=1,P=1,D=0){if(this.uid=l,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void ki(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;let U=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=w,this.greenFactor=I,this.blueFactor=P,this.baseShift=D;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let G=0;G<U;G++)this.data[this._idx(-1,G)]=this.data[this._idx(0,G)],this.data[this._idx(U,G)]=this.data[this._idx(U-1,G)],this.data[this._idx(G,-1)]=this.data[this._idx(G,0)],this.data[this._idx(G,U)]=this.data[this._idx(G,U-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(U,-1)]=this.data[this._idx(U-1,0)],this.data[this._idx(-1,U)]=this.data[this._idx(0,U-1)],this.data[this._idx(U,U)]=this.data[this._idx(U-1,U-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let G=0;G<U;G++)for(let $=0;$<U;$++){let Y=this.get(G,$);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(l,d){let g=new Uint8Array(this.data.buffer),w=4*this._idx(l,d);return this.unpack(g[w],g[w+1],g[w+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,d){if(l<-1||l>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(l+1)}unpack(l,d,g){return l*this.redFactor+d*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Wa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,d,g){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let w=d*this.dim,I=d*this.dim+this.dim,P=g*this.dim,D=g*this.dim+this.dim;switch(d){case-1:w=I-1;break;case 1:I=w+1}switch(g){case-1:P=D-1;break;case 1:D=P+1}let U=-d*this.dim,G=-g*this.dim;for(let $=P;$<D;$++)for(let Y=w;Y<I;Y++)this.data[this._idx(Y,$)]=l.data[this._idx(Y+U,$+G)]}}ur("DEMData",hB);class fB{constructor(l){this._stringToNumber={},this._numberToString=[];for(let d=0;d<l.length;d++){let g=l[d];this._stringToNumber[g]=d,this._numberToString[d]=g}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class dB{constructor(l,d,g,w,I){this.type="Feature",this._vectorTileFeature=l,l._z=d,l._x=g,l._y=w,this.properties=l.properties,this.id=I}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){let l={geometry:this.geometry};for(let d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(l[d]=this[d]);return l}}class pB{constructor(l,d){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new yh(ve,16,0),this.grid3D=new yh(ve,16,0),this.featureIndexArray=new Fe,this.promoteId=d}insert(l,d,g,w,I,P){let D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,w,I);let U=P?this.grid3D:this.grid;for(let G=0;G<d.length;G++){let $=d[G],Y=[1/0,1/0,-1/0,-1/0];for(let oe=0;oe<$.length;oe++){let le=$[oe];Y[0]=Math.min(Y[0],le.x),Y[1]=Math.min(Y[1],le.y),Y[2]=Math.max(Y[2],le.x),Y[3]=Math.max(Y[3],le.y)}Y[0]<ve&&Y[1]<ve&&Y[2]>=0&&Y[3]>=0&&U.insert(D,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new e_.VectorTile(new xE(this.rawTileData)).layers,this.sourceLayerCoder=new fB(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,d,g,w){this.loadVTLayers();let I=l.params,P=ve/l.tileSize/l.scale,D=Ta(I.filter),U=l.queryGeometry,G=l.queryPadding*P,$=mB(U),Y=this.grid.query($.minX-G,$.minY-G,$.maxX+G,$.maxY+G),oe=mB(l.cameraQueryGeometry),le=this.grid3D.query(oe.minX-G,oe.minY-G,oe.maxX+G,oe.maxY+G,(Te,Re,et,Ne)=>function(ae,xe,He,xt,Ht){for(let Rt of ae)if(xe<=Rt.x&&He<=Rt.y&&xt>=Rt.x&&Ht>=Rt.y)return!0;let Et=[new R(xe,He),new R(xe,Ht),new R(xt,Ht),new R(xt,He)];if(ae.length>2){for(let Rt of Et)if(vp(ae,Rt))return!0}for(let Rt=0;Rt<ae.length-1;Rt++)if(OW(ae[Rt],ae[Rt+1],Et))return!0;return!1}(l.cameraQueryGeometry,Te-G,Re-G,et+G,Ne+G));for(let Te of le)Y.push(Te);Y.sort(q$);let ue={},pe;for(let Te=0;Te<Y.length;Te++){let Re=Y[Te];if(Re===pe)continue;pe=Re;let et=this.featureIndexArray.get(Re),Ne=null;this.loadMatchingFeature(ue,et.bucketIndex,et.sourceLayerIndex,et.featureIndex,D,I.layers,I.availableImages,d,g,w,(ae,xe,He)=>(Ne||(Ne=ri(ae)),xe.queryIntersectsFeature({queryGeometry:U,feature:ae,featureState:He,geometry:Ne,zoom:this.z,transform:l.transform,pixelsToTileUnits:P,pixelPosMatrix:l.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:l.getElevation})))}return ue}loadMatchingFeature(l,d,g,w,I,P,D,U,G,$,Y){let oe=this.bucketLayerIDs[d];if(P&&!oe.some(Te=>P.has(Te)))return;let le=this.sourceLayerCoder.decode(g),ue=this.vtLayers[le].feature(w);if(I.needGeometry){let Te=ni(ue,!0);if(!I.filter(new hn(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!I.filter(new hn(this.tileID.overscaledZ),ue))return;let pe=this.getId(ue,le);for(let Te=0;Te<oe.length;Te++){let Re=oe[Te];if(P&&!P.has(Re))continue;let et=U[Re];if(!et)continue;let Ne={};pe&&$&&(Ne=$.getState(et.sourceLayer||"_geojsonTileLayer",pe));let ae=qt({},G[Re]);ae.paint=AB(ae.paint,et.paint,ue,Ne,D),ae.layout=AB(ae.layout,et.layout,ue,Ne,D);let xe=!Y||Y(ue,et,Ne);if(!xe)continue;let He=new dB(ue,this.z,this.x,this.y,pe);He.layer=ae;let xt=l[Re];xt===void 0&&(xt=l[Re]=[]),xt.push({featureIndex:w,feature:He,intersectionZ:xe})}}lookupSymbolFeatures(l,d,g,w,I,P,D,U){let G={};this.loadVTLayers();let $=Ta(I);for(let Y of l)this.loadMatchingFeature(G,g,w,Y,$,P,D,U,d);return G}hasLayer(l){for(let d of this.bucketLayerIDs)for(let g of d)if(l===g)return!0;return!1}getId(l,d){var g;let w=l.id;return this.promoteId&&(w=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof w=="boolean"&&(w=Number(w)),w===void 0&&(!((g=l.properties)===null||g===void 0)&&g.cluster)&&this.promoteId&&(w=Number(l.properties.cluster_id))),w}}function AB(f,l,d,g,w){return Tr(f,(I,P)=>{let D=l instanceof vh?l.get(P):null;return D&&D.evaluate?D.evaluate(d,g,w):D})}function mB(f){let l=1/0,d=1/0,g=-1/0,w=-1/0;for(let I of f)l=Math.min(l,I.x),d=Math.min(d,I.y),g=Math.max(g,I.x),w=Math.max(w,I.y);return{minX:l,minY:d,maxX:g,maxY:w}}function q$(f,l){return l-f}function gB(f,l,d,g,w){let I=[];for(let P=0;P<f.length;P++){let D=f[P],U;for(let G=0;G<D.length-1;G++){let $=D[G],Y=D[G+1];$.x<l&&Y.x<l||($.x<l?$=new R(l,$.y+(l-$.x)/(Y.x-$.x)*(Y.y-$.y))._round():Y.x<l&&(Y=new R(l,$.y+(l-$.x)/(Y.x-$.x)*(Y.y-$.y))._round()),$.y<d&&Y.y<d||($.y<d?$=new R($.x+(d-$.y)/(Y.y-$.y)*(Y.x-$.x),d)._round():Y.y<d&&(Y=new R($.x+(d-$.y)/(Y.y-$.y)*(Y.x-$.x),d)._round()),$.x>=g&&Y.x>=g||($.x>=g?$=new R(g,$.y+(g-$.x)/(Y.x-$.x)*(Y.y-$.y))._round():Y.x>=g&&(Y=new R(g,$.y+(g-$.x)/(Y.x-$.x)*(Y.y-$.y))._round()),$.y>=w&&Y.y>=w||($.y>=w?$=new R($.x+(w-$.y)/(Y.y-$.y)*(Y.x-$.x),w)._round():Y.y>=w&&(Y=new R($.x+(w-$.y)/(Y.y-$.y)*(Y.x-$.x),w)._round()),U&&$.equals(U[U.length-1])||(U=[$],I.push(U)),U.push(Y)))))}}return I}ur("FeatureIndex",pB,{omit:["rawTileData","sourceLayerCoder"]});class Xf extends R{constructor(l,d,g,w){super(l,d),this.angle=g,w!==void 0&&(this.segment=w)}clone(){return new Xf(this.x,this.y,this.angle,this.segment)}}function _B(f,l,d,g,w){if(l.segment===void 0||d===0)return!0;let I=l,P=l.segment+1,D=0;for(;D>-d/2;){if(P--,P<0)return!1;D-=f[P].dist(I),I=f[P]}D+=f[P].dist(f[P+1]),P++;let U=[],G=0;for(;D<d/2;){let $=f[P],Y=f[P+1];if(!Y)return!1;let oe=f[P-1].angleTo($)-$.angleTo(Y);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:D,angleDelta:oe}),G+=oe;D-U[0].distance>g;)G-=U.shift().angleDelta;if(G>w)return!1;P++,D+=$.dist(Y)}return!0}function yB(f){let l=0;for(let d=0;d<f.length-1;d++)l+=f[d].dist(f[d+1]);return l}function xB(f,l,d){return f?.6*l*d:0}function bB(f,l){return Math.max(f?f.right-f.left:0,l?l.right-l.left:0)}function Z$(f,l,d,g,w,I){let P=xB(d,w,I),D=bB(d,g)*I,U=0,G=yB(f)/2;for(let $=0;$<f.length-1;$++){let Y=f[$],oe=f[$+1],le=Y.dist(oe);if(U+le>G){let ue=(G-U)/le,pe=ya.number(Y.x,oe.x,ue),Te=ya.number(Y.y,oe.y,ue),Re=new Xf(pe,Te,oe.angleTo(Y),$);return Re._round(),!P||_B(f,Re,D,P,l)?Re:void 0}U+=le}}function X$(f,l,d,g,w,I,P,D,U){let G=xB(g,I,P),$=bB(g,w),Y=$*P,oe=f[0].x===0||f[0].x===U||f[0].y===0||f[0].y===U;return l-Y<l/4&&(l=Y+l/4),vB(f,oe?l/2*D%l:($/2+2*I)*P*D%l,l,G,d,Y,oe,!1,U)}function vB(f,l,d,g,w,I,P,D,U){let G=I/2,$=yB(f),Y=0,oe=l-d,le=[];for(let ue=0;ue<f.length-1;ue++){let pe=f[ue],Te=f[ue+1],Re=pe.dist(Te),et=Te.angleTo(pe);for(;oe+d<Y+Re;){oe+=d;let Ne=(oe-Y)/Re,ae=ya.number(pe.x,Te.x,Ne),xe=ya.number(pe.y,Te.y,Ne);if(ae>=0&&ae<U&&xe>=0&&xe<U&&oe-G>=0&&oe+G<=$){let He=new Xf(ae,xe,et,ue);He._round(),g&&!_B(f,He,I,g,w)||le.push(He)}}Y+=Re}return D||le.length||P||(le=vB(f,Y/2,d,g,w,I,P,!0,U)),le}ur("Anchor",Xf);let a_=ia;function wB(f,l,d,g){let w=[],I=f.image,P=I.pixelRatio,D=I.paddedRect.w-2*a_,U=I.paddedRect.h-2*a_,G={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom},$=I.stretchX||[[0,D]],Y=I.stretchY||[[0,U]],oe=(Dt,Ar)=>Dt+Ar[1]-Ar[0],le=$.reduce(oe,0),ue=Y.reduce(oe,0),pe=D-le,Te=U-ue,Re=0,et=le,Ne=0,ae=ue,xe=0,He=pe,xt=0,Ht=Te;if(I.content&&g){let Dt=I.content,Ar=Dt[2]-Dt[0],Br=Dt[3]-Dt[1];(I.textFitWidth||I.textFitHeight)&&(G=XR(f)),Re=w2($,0,Dt[0]),Ne=w2(Y,0,Dt[1]),et=w2($,Dt[0],Dt[2]),ae=w2(Y,Dt[1],Dt[3]),xe=Dt[0]-Re,xt=Dt[1]-Ne,He=Ar-et,Ht=Br-ae}let Et=G.x1,Rt=G.y1,Yt=G.x2-Et,$t=G.y2-Rt,Qt=(Dt,Ar,Br,Ir)=>{let yr=T2(Dt.stretch-Re,et,Yt,Et),yi=E2(Dt.fixed-xe,He,Dt.stretch,le),$n=T2(Ar.stretch-Ne,ae,$t,Rt),Eo=E2(Ar.fixed-xt,Ht,Ar.stretch,ue),ms=T2(Br.stretch-Re,et,Yt,Et),qa=E2(Br.fixed-xe,He,Br.stretch,le),na=T2(Ir.stretch-Ne,ae,$t,Rt),Jo=E2(Ir.fixed-xt,Ht,Ir.stretch,ue),jn=new R(yr,$n),Uo=new R(ms,$n),es=new R(ms,na),ts=new R(yr,na),Vs=new R(yi/P,Eo/P),Za=new R(qa/P,Jo/P),Vo=l*Math.PI/180;if(Vo){let jo=Math.sin(Vo),Go=Math.cos(Vo),Ao=[Go,-jo,jo,Go];jn._matMult(Ao),Uo._matMult(Ao),ts._matMult(Ao),es._matMult(Ao)}let oa=Dt.stretch+Dt.fixed,Co=Ar.stretch+Ar.fixed;return{tl:jn,tr:Uo,bl:ts,br:es,tex:{x:I.paddedRect.x+a_+oa,y:I.paddedRect.y+a_+Co,w:Br.stretch+Br.fixed-oa,h:Ir.stretch+Ir.fixed-Co},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vs,pixelOffsetBR:Za,minFontScaleX:He/P/Yt,minFontScaleY:Ht/P/$t,isSDF:d}};if(g&&(I.stretchX||I.stretchY)){let Dt=TB($,pe,le),Ar=TB(Y,Te,ue);for(let Br=0;Br<Dt.length-1;Br++){let Ir=Dt[Br],yr=Dt[Br+1];for(let yi=0;yi<Ar.length-1;yi++)w.push(Qt(Ir,Ar[yi],yr,Ar[yi+1]))}}else w.push(Qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:U+1}));return w}function w2(f,l,d){let g=0;for(let w of f)g+=Math.max(l,Math.min(d,w[1]))-Math.max(l,Math.min(d,w[0]));return g}function TB(f,l,d){let g=[{fixed:-1,stretch:0}];for(let[w,I]of f){let P=g[g.length-1];g.push({fixed:w-P.stretch,stretch:P.stretch}),g.push({fixed:w-P.stretch,stretch:P.stretch+(I-w)})}return g.push({fixed:l+a_,stretch:d}),g}function T2(f,l,d,g){return f/l*d+g}function E2(f,l,d,g){return f-l*d/g}class C2{constructor(l,d,g,w,I,P,D,U,G,$){var Y;if(this.boxStartIndex=l.length,G){let oe=P.top,le=P.bottom,ue=P.collisionPadding;ue&&(oe-=ue[1],le+=ue[3]);let pe=le-oe;pe>0&&(pe=Math.max(10,pe),this.circleDiameter=pe)}else{let oe=!((Y=P.image)===null||Y===void 0)&&Y.content&&(P.image.textFitWidth||P.image.textFitHeight)?XR(P):{x1:P.left,y1:P.top,x2:P.right,y2:P.bottom};oe.y1=oe.y1*D-U[0],oe.y2=oe.y2*D+U[2],oe.x1=oe.x1*D-U[3],oe.x2=oe.x2*D+U[1];let le=P.collisionPadding;if(le&&(oe.x1-=le[0]*D,oe.y1-=le[1]*D,oe.x2+=le[2]*D,oe.y2+=le[3]*D),$){let ue=new R(oe.x1,oe.y1),pe=new R(oe.x2,oe.y1),Te=new R(oe.x1,oe.y2),Re=new R(oe.x2,oe.y2),et=$*Math.PI/180;ue._rotate(et),pe._rotate(et),Te._rotate(et),Re._rotate(et),oe.x1=Math.min(ue.x,pe.x,Te.x,Re.x),oe.x2=Math.max(ue.x,pe.x,Te.x,Re.x),oe.y1=Math.min(ue.y,pe.y,Te.y,Re.y),oe.y2=Math.max(ue.y,pe.y,Te.y,Re.y)}l.emplaceBack(d.x,d.y,oe.x1,oe.y1,oe.x2,oe.y2,g,w,I)}this.boxEndIndex=l.length}}class Y${constructor(l=[],d=(g,w)=>g<w?-1:g>w?1:0){if(this.data=l,this.length=this.data.length,this.compare=d,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;let l=this.data[0],d=this.data.pop();return--this.length>0&&(this.data[0]=d,this._down(0)),l}peek(){return this.data[0]}_up(l){let{data:d,compare:g}=this,w=d[l];for(;l>0;){let I=l-1>>1,P=d[I];if(g(w,P)>=0)break;d[l]=P,l=I}d[l]=w}_down(l){let{data:d,compare:g}=this,w=this.length>>1,I=d[l];for(;l<w;){let P=1+(l<<1),D=P+1;if(D<this.length&&g(d[D],d[P])<0&&(P=D),g(d[P],I)>=0)break;d[l]=d[P],l=P}d[l]=I}}function K$(f,l=1,d=!1){let g=1/0,w=1/0,I=-1/0,P=-1/0,D=f[0];for(let le=0;le<D.length;le++){let ue=D[le];(!le||ue.x<g)&&(g=ue.x),(!le||ue.y<w)&&(w=ue.y),(!le||ue.x>I)&&(I=ue.x),(!le||ue.y>P)&&(P=ue.y)}let U=Math.min(I-g,P-w),G=U/2,$=new Y$([],Q$);if(U===0)return new R(g,w);for(let le=g;le<I;le+=U)for(let ue=w;ue<P;ue+=U)$.push(new T0(le+G,ue+G,G,f));let Y=function(le){let ue=0,pe=0,Te=0,Re=le[0];for(let et=0,Ne=Re.length,ae=Ne-1;et<Ne;ae=et++){let xe=Re[et],He=Re[ae],xt=xe.x*He.y-He.x*xe.y;pe+=(xe.x+He.x)*xt,Te+=(xe.y+He.y)*xt,ue+=3*xt}return new T0(pe/ue,Te/ue,0,le)}(f),oe=$.length;for(;$.length;){let le=$.pop();(le.d>Y.d||!Y.d)&&(Y=le,d&&console.log("found best %d after %d probes",Math.round(1e4*le.d)/1e4,oe)),le.max-Y.d<=l||(G=le.h/2,$.push(new T0(le.p.x-G,le.p.y-G,G,f)),$.push(new T0(le.p.x+G,le.p.y-G,G,f)),$.push(new T0(le.p.x-G,le.p.y+G,G,f)),$.push(new T0(le.p.x+G,le.p.y+G,G,f)),oe+=4)}return d&&(console.log(`num probes: ${oe}`),console.log(`best distance: ${Y.d}`)),Y.p}function Q$(f,l){return l.max-f.max}function T0(f,l,d,g){this.p=new R(f,l),this.h=d,this.d=function(w,I){let P=!1,D=1/0;for(let U=0;U<I.length;U++){let G=I[U];for(let $=0,Y=G.length,oe=Y-1;$<Y;oe=$++){let le=G[$],ue=G[oe];le.y>w.y!=ue.y>w.y&&w.x<(ue.x-le.x)*(w.y-le.y)/(ue.y-le.y)+le.x&&(P=!P),D=Math.min(D,nR(w,le,ue))}}return(P?1:-1)*Math.sqrt(D)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var As;n.ay=void 0,(As=n.ay||(n.ay={}))[As.center=1]="center",As[As.left=2]="left",As[As.right=3]="right",As[As.top=4]="top",As[As.bottom=5]="bottom",As[As["top-left"]=6]="top-left",As[As["top-right"]=7]="top-right",As[As["bottom-left"]=8]="bottom-left",As[As["bottom-right"]=9]="bottom-right";let Yf=7,LE=Number.POSITIVE_INFINITY;function EB(f,l){return l[1]!==LE?function(d,g,w){let I=0,P=0;switch(g=Math.abs(g),w=Math.abs(w),d){case"top-right":case"top-left":case"top":P=w-Yf;break;case"bottom-right":case"bottom-left":case"bottom":P=-w+Yf}switch(d){case"top-right":case"bottom-right":case"right":I=-g;break;case"top-left":case"bottom-left":case"left":I=g}return[I,P]}(f,l[0],l[1]):function(d,g){let w=0,I=0;g<0&&(g=0);let P=g/Math.SQRT2;switch(d){case"top-right":case"top-left":I=P-Yf;break;case"bottom-right":case"bottom-left":I=-P+Yf;break;case"bottom":I=-g+Yf;break;case"top":I=g-Yf}switch(d){case"top-right":case"bottom-right":w=-P;break;case"top-left":case"bottom-left":w=P;break;case"left":w=g;break;case"right":w=-g}return[w,I]}(f,l[0])}function CB(f,l,d){var g;let w=f.layout,I=(g=w.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(l,{},d);if(I){let D=I.values,U=[];for(let G=0;G<D.length;G+=2){let $=U[G]=D[G],Y=D[G+1].map(oe=>oe*To);$.startsWith("top")?Y[1]-=Yf:$.startsWith("bottom")&&(Y[1]+=Yf),U[G+1]=Y}return new hs(U)}let P=w.get("text-variable-anchor");if(P){let D;D=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[w.get("text-radial-offset").evaluate(l,{},d)*To,LE]:w.get("text-offset").evaluate(l,{},d).map(G=>G*To);let U=[];for(let G of P)U.push(G,EB(G,D));return new hs(U)}return null}function OE(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function J$(f,l,d,g,w,I,P,D,U,G,$,Y){let oe=I.textMaxSize.evaluate(l,{});oe===void 0&&(oe=P);let le=f.layers[0].layout,ue=le.get("icon-offset").evaluate(l,{},$),pe=IB(d.horizontal),Te=P/24,Re=f.tilePixelRatio*Te,et=f.tilePixelRatio*oe/24,Ne=f.tilePixelRatio*D,ae=f.tilePixelRatio*le.get("symbol-spacing"),xe=le.get("text-padding")*f.tilePixelRatio,He=function(Br,Ir,yr,yi=1){let $n=Br.get("icon-padding").evaluate(Ir,{},yr),Eo=$n&&$n.values;return[Eo[0]*yi,Eo[1]*yi,Eo[2]*yi,Eo[3]*yi]}(le,l,$,f.tilePixelRatio),xt=le.get("text-max-angle")/180*Math.PI,Ht=le.get("text-rotation-alignment")!=="viewport"&&le.get("symbol-placement")!=="point",Et=le.get("icon-rotation-alignment")==="map"&&le.get("symbol-placement")!=="point",Rt=le.get("symbol-placement"),Yt=ae/2,$t=le.get("icon-text-fit"),Qt;g&&$t!=="none"&&(f.allowVerticalPlacement&&d.vertical&&(Qt=YR(g,d.vertical,$t,le.get("icon-text-fit-padding"),ue,Te)),pe&&(g=YR(g,pe,$t,le.get("icon-text-fit-padding"),ue,Te)));let Dt=$?Y.line.getGranularityForZoomLevel($.z):1,Ar=(Br,Ir)=>{Ir.x<0||Ir.x>=ve||Ir.y<0||Ir.y>=ve||function(yr,yi,$n,Eo,ms,qa,na,Jo,jn,Uo,es,ts,Vs,Za,Vo,oa,Co,jo,Go,Ao,Tn,Ac,E0,mc,rq){let C0=yr.addToLineVertexArray(yi,$n),Ep,S0,I0,M0,BB=0,LB=0,OB=0,DB=0,jE=-1,GE=-1,Sh={},FB=M("");if(yr.allowVerticalPlacement&&Eo.vertical){let Bs=Jo.layout.get("text-rotate").evaluate(Tn,{},mc)+90;I0=new C2(jn,yi,Uo,es,ts,Eo.vertical,Vs,Za,Vo,Bs),na&&(M0=new C2(jn,yi,Uo,es,ts,na,Co,jo,Vo,Bs))}if(ms){let Bs=Jo.layout.get("icon-rotate").evaluate(Tn,{}),Xa=Jo.layout.get("icon-text-fit")!=="none",Cp=wB(ms,Bs,E0,Xa),_c=na?wB(na,Bs,E0,Xa):void 0;S0=new C2(jn,yi,Uo,es,ts,ms,Co,jo,!1,Bs),BB=4*Cp.length;let Sp=yr.iconSizeData,Au=null;Sp.kind==="source"?(Au=[pu*Jo.layout.get("icon-size").evaluate(Tn,{})],Au[0]>qf&&ki(`${yr.layerIds[0]}: Value for "icon-size" is >= ${o_}. Reduce your "icon-size".`)):Sp.kind==="composite"&&(Au=[pu*Ac.compositeIconSizes[0].evaluate(Tn,{},mc),pu*Ac.compositeIconSizes[1].evaluate(Tn,{},mc)],(Au[0]>qf||Au[1]>qf)&&ki(`${yr.layerIds[0]}: Value for "icon-size" is >= ${o_}. Reduce your "icon-size".`)),yr.addSymbols(yr.icon,Cp,Au,Ao,Go,Tn,n.ah.none,yi,C0.lineStartIndex,C0.lineLength,-1,mc),jE=yr.icon.placedSymbolArray.length-1,_c&&(LB=4*_c.length,yr.addSymbols(yr.icon,_c,Au,Ao,Go,Tn,n.ah.vertical,yi,C0.lineStartIndex,C0.lineLength,-1,mc),GE=yr.icon.placedSymbolArray.length-1)}let kB=Object.keys(Eo.horizontal);for(let Bs of kB){let Xa=Eo.horizontal[Bs];if(!Ep){FB=M(Xa.text);let _c=Jo.layout.get("text-rotate").evaluate(Tn,{},mc);Ep=new C2(jn,yi,Uo,es,ts,Xa,Vs,Za,Vo,_c)}let Cp=Xa.positionedLines.length===1;if(OB+=SB(yr,yi,Xa,qa,Jo,Vo,Tn,oa,C0,Eo.vertical?n.ah.horizontal:n.ah.horizontalOnly,Cp?kB:[Bs],Sh,jE,Ac,mc),Cp)break}Eo.vertical&&(DB+=SB(yr,yi,Eo.vertical,qa,Jo,Vo,Tn,oa,C0,n.ah.vertical,["vertical"],Sh,GE,Ac,mc));let iq=Ep?Ep.boxStartIndex:yr.collisionBoxArray.length,nq=Ep?Ep.boxEndIndex:yr.collisionBoxArray.length,oq=I0?I0.boxStartIndex:yr.collisionBoxArray.length,sq=I0?I0.boxEndIndex:yr.collisionBoxArray.length,aq=S0?S0.boxStartIndex:yr.collisionBoxArray.length,lq=S0?S0.boxEndIndex:yr.collisionBoxArray.length,cq=M0?M0.boxStartIndex:yr.collisionBoxArray.length,uq=M0?M0.boxEndIndex:yr.collisionBoxArray.length,gc=-1,I2=(Bs,Xa)=>Bs&&Bs.circleDiameter?Math.max(Bs.circleDiameter,Xa):Xa;gc=I2(Ep,gc),gc=I2(I0,gc),gc=I2(S0,gc),gc=I2(M0,gc);let NB=gc>-1?1:0;NB&&(gc*=rq/To),yr.glyphOffsetArray.length>=v0.MAX_GLYPHS&&ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tn.sortKey!==void 0&&yr.addToSortKeyRanges(yr.symbolInstances.length,Tn.sortKey);let hq=CB(Jo,Tn,mc),[fq,dq]=function(Bs,Xa){let Cp=Bs.length,_c=Xa?.values;if(_c?.length>0)for(let Sp=0;Sp<_c.length;Sp+=2){let Au=_c[Sp+1];Bs.emplaceBack(n.ay[_c[Sp]],Au[0],Au[1])}return[Cp,Bs.length]}(yr.textAnchorOffsets,hq);yr.symbolInstances.emplaceBack(yi.x,yi.y,Sh.right>=0?Sh.right:-1,Sh.center>=0?Sh.center:-1,Sh.left>=0?Sh.left:-1,Sh.vertical||-1,jE,GE,FB,iq,nq,oq,sq,aq,lq,cq,uq,Uo,OB,DB,BB,LB,NB,0,Vs,gc,fq,dq)}(f,Ir,Br,d,g,w,Qt,f.layers[0],f.collisionBoxArray,l.index,l.sourceLayerIndex,f.index,Re,[xe,xe,xe,xe],Ht,U,Ne,He,Et,ue,l,I,G,$,P)};if(Rt==="line")for(let Br of gB(l.geometry,0,0,ve,ve)){let Ir=Tp(Br,Dt),yr=X$(Ir,ae,xt,d.vertical||pe,g,24,et,f.overscaling,ve);for(let yi of yr)pe&&eq(f,pe.text,Yt,yi)||Ar(Ir,yi)}else if(Rt==="line-center"){for(let Br of l.geometry)if(Br.length>1){let Ir=Tp(Br,Dt),yr=Z$(Ir,xt,d.vertical||pe,g,24,et);yr&&Ar(Ir,yr)}}else if(l.type==="Polygon")for(let Br of Kl(l.geometry,0)){let Ir=K$(Br,16);Ar(Tp(Br[0],Dt,!0),new Xf(Ir.x,Ir.y,0))}else if(l.type==="LineString")for(let Br of l.geometry){let Ir=Tp(Br,Dt);Ar(Ir,new Xf(Ir[0].x,Ir[0].y,0))}else if(l.type==="Point")for(let Br of l.geometry)for(let Ir of Br)Ar([Ir],new Xf(Ir.x,Ir.y,0))}function SB(f,l,d,g,w,I,P,D,U,G,$,Y,oe,le,ue){let pe=function(et,Ne,ae,xe,He,xt,Ht,Et){let Rt=xe.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,Yt=[];for(let $t of Ne.positionedLines)for(let Qt of $t.positionedGlyphs){if(!Qt.rect)continue;let Dt=Qt.rect||{},Ar=S$+1,Br=!0,Ir=1,yr=0,yi=(He||Et)&&Qt.vertical,$n=Qt.metrics.advance*Qt.scale/2;if(Et&&Ne.verticalizable&&(yr=$t.lineOffset/2-(Qt.imageName?-(To-Qt.metrics.width*Qt.scale)/2:(Qt.scale-1)*To)),Qt.imageName){let jo=Ht[Qt.imageName];Br=jo.sdf,Ir=jo.pixelRatio,Ar=ia/Ir}let Eo=He?[Qt.x+$n,Qt.y]:[0,0],ms=He?[0,0]:[Qt.x+$n+ae[0],Qt.y+ae[1]-yr],qa=[0,0];yi&&(qa=ms,ms=[0,0]);let na=Qt.metrics.isDoubleResolution?2:1,Jo=(Qt.metrics.left-Ar)*Qt.scale-$n+ms[0],jn=(-Qt.metrics.top-Ar)*Qt.scale+ms[1],Uo=Jo+Dt.w/na*Qt.scale/Ir,es=jn+Dt.h/na*Qt.scale/Ir,ts=new R(Jo,jn),Vs=new R(Uo,jn),Za=new R(Jo,es),Vo=new R(Uo,es);if(yi){let jo=new R(-$n,$n-_2),Go=-Math.PI/2,Ao=To/2-$n,Tn=new R(5-_2-Ao,-(Qt.imageName?Ao:0)),Ac=new R(...qa);ts._rotateAround(Go,jo)._add(Tn)._add(Ac),Vs._rotateAround(Go,jo)._add(Tn)._add(Ac),Za._rotateAround(Go,jo)._add(Tn)._add(Ac),Vo._rotateAround(Go,jo)._add(Tn)._add(Ac)}if(Rt){let jo=Math.sin(Rt),Go=Math.cos(Rt),Ao=[Go,-jo,jo,Go];ts._matMult(Ao),Vs._matMult(Ao),Za._matMult(Ao),Vo._matMult(Ao)}let oa=new R(0,0),Co=new R(0,0);Yt.push({tl:ts,tr:Vs,bl:Za,br:Vo,tex:Dt,writingMode:Ne.writingMode,glyphOffset:Eo,sectionIndex:Qt.sectionIndex,isSDF:Br,pixelOffsetTL:oa,pixelOffsetBR:Co,minFontScaleX:0,minFontScaleY:0})}return Yt}(0,d,D,w,I,P,g,f.allowVerticalPlacement),Te=f.textSizeData,Re=null;Te.kind==="source"?(Re=[pu*w.layout.get("text-size").evaluate(P,{})],Re[0]>qf&&ki(`${f.layerIds[0]}: Value for "text-size" is >= ${o_}. Reduce your "text-size".`)):Te.kind==="composite"&&(Re=[pu*le.compositeTextSizes[0].evaluate(P,{},ue),pu*le.compositeTextSizes[1].evaluate(P,{},ue)],(Re[0]>qf||Re[1]>qf)&&ki(`${f.layerIds[0]}: Value for "text-size" is >= ${o_}. Reduce your "text-size".`)),f.addSymbols(f.text,pe,Re,D,I,P,G,l,U.lineStartIndex,U.lineLength,oe,ue);for(let et of $)Y[et]=f.text.placedSymbolArray.length-1;return 4*pe.length}function IB(f){for(let l in f)return f[l];return null}function eq(f,l,d,g){let w=f.compareText;if(l in w){let I=w[l];for(let P=I.length-1;P>=0;P--)if(g.dist(I[P])<d)return!0}else w[l]=[];return w[l].push(g),!1}let MB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class DE{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[d,g]=new Uint8Array(l,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");let w=g>>4;if(w!==1)throw new Error(`Got v${w} data when expected v1.`);let I=MB[15&g];if(!I)throw new Error("Unrecognized array type.");let[P]=new Uint16Array(l,2,1),[D]=new Uint32Array(l,4,1);return new DE(D,P,I,l)}constructor(l,d=64,g=Float64Array,w){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=g,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;let I=MB.indexOf(this.ArrayType),P=2*l*this.ArrayType.BYTES_PER_ELEMENT,D=l*this.IndexArrayType.BYTES_PER_ELEMENT,U=(8-D%8)%8;if(I<0)throw new Error(`Unexpected typed array class: ${g}.`);w&&w instanceof ArrayBuffer?(this.data=w,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+P+D+U),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+I]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=l)}add(l,d){let g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=l,this.coords[this._pos++]=d,g}finish(){let l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return FE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,d,g,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:I,coords:P,nodeSize:D}=this,U=[0,I.length-1,0],G=[];for(;U.length;){let $=U.pop()||0,Y=U.pop()||0,oe=U.pop()||0;if(Y-oe<=D){for(let Te=oe;Te<=Y;Te++){let Re=P[2*Te],et=P[2*Te+1];Re>=l&&Re<=g&&et>=d&&et<=w&&G.push(I[Te])}continue}let le=oe+Y>>1,ue=P[2*le],pe=P[2*le+1];ue>=l&&ue<=g&&pe>=d&&pe<=w&&G.push(I[le]),($===0?l<=ue:d<=pe)&&(U.push(oe),U.push(le-1),U.push(1-$)),($===0?g>=ue:w>=pe)&&(U.push(le+1),U.push(Y),U.push(1-$))}return G}within(l,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:w,coords:I,nodeSize:P}=this,D=[0,w.length-1,0],U=[],G=g*g;for(;D.length;){let $=D.pop()||0,Y=D.pop()||0,oe=D.pop()||0;if(Y-oe<=P){for(let Te=oe;Te<=Y;Te++)RB(I[2*Te],I[2*Te+1],l,d)<=G&&U.push(w[Te]);continue}let le=oe+Y>>1,ue=I[2*le],pe=I[2*le+1];RB(ue,pe,l,d)<=G&&U.push(w[le]),($===0?l-g<=ue:d-g<=pe)&&(D.push(oe),D.push(le-1),D.push(1-$)),($===0?l+g>=ue:d+g>=pe)&&(D.push(le+1),D.push(Y),D.push(1-$))}return U}}function FE(f,l,d,g,w,I){if(w-g<=d)return;let P=g+w>>1;PB(f,l,P,g,w,I),FE(f,l,d,g,P-1,1-I),FE(f,l,d,P+1,w,1-I)}function PB(f,l,d,g,w,I){for(;w>g;){if(w-g>600){let G=w-g+1,$=d-g+1,Y=Math.log(G),oe=.5*Math.exp(2*Y/3),le=.5*Math.sqrt(Y*oe*(G-oe)/G)*($-G/2<0?-1:1);PB(f,l,d,Math.max(g,Math.floor(d-$*oe/G+le)),Math.min(w,Math.floor(d+(G-$)*oe/G+le)),I)}let P=l[2*d+I],D=g,U=w;for(l_(f,l,g,d),l[2*w+I]>P&&l_(f,l,g,w);D<U;){for(l_(f,l,D,U),D++,U--;l[2*D+I]<P;)D++;for(;l[2*U+I]>P;)U--}l[2*g+I]===P?l_(f,l,g,U):(U++,l_(f,l,U,w)),U<=d&&(g=U+1),d<=U&&(w=U-1)}}function l_(f,l,d,g){kE(f,d,g),kE(l,2*d,2*g),kE(l,2*d+1,2*g+1)}function kE(f,l,d){let g=f[l];f[l]=f[d],f[d]=g}function RB(f,l,d,g){let w=f-d,I=l-g;return w*w+I*I}var NE;n.ck=void 0,(NE=n.ck||(n.ck={})).create="create",NE.load="load",NE.fullLoad="fullLoad";let S2=null,c_=[],zE=1e3/60,UE="loadTime",VE="fullLoadTime",tq={mark(f){performance.mark(f)},frame(f){let l=f;S2!=null&&c_.push(l-S2),S2=l},clearMetrics(){S2=null,c_=[],performance.clearMeasures(UE),performance.clearMeasures(VE);for(let f in n.ck)performance.clearMarks(n.ck[f])},getPerformanceMetrics(){performance.measure(UE,n.ck.create,n.ck.load),performance.measure(VE,n.ck.create,n.ck.fullLoad);let f=performance.getEntriesByName(UE)[0].duration,l=performance.getEntriesByName(VE)[0].duration,d=c_.length,g=1/(c_.reduce((I,P)=>I+P,0)/d/1e3),w=c_.filter(I=>I>zE).reduce((I,P)=>I+(P-zE)/zE,0);return{loadTime:f,fullLoadTime:l,fps:g,percentDroppedFrames:w/(d+w)*100,totalFrames:d}}};n.$=s_,n.A=Le,n.B=ya,n.C=hn,n.D=xr,n.E=ge,n.F=hp,n.G=function(f){if(ui==null){let l=f.navigator?f.navigator.userAgent:null;ui=!!f.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return ui},n.H=class{constructor(f,l){this.target=f,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new W$(()=>this.process()),this.subscription=co(this.target,"message",d=>this.receive(d),!1),this.globalScope=Oi(self)?f:window}registerMessageHandler(f,l){this.messageHandlers[f]=l}sendAsync(f,l){return new Promise((d,g)=>{let w=Math.round(1e18*Math.random()).toString(36).substring(0,10),I=l?co(l.signal,"abort",()=>{I?.unsubscribe(),delete this.resolveRejects[w];let U={id:w,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(U)},$$):null;this.resolveRejects[w]={resolve:U=>{I?.unsubscribe(),d(U)},reject:U=>{I?.unsubscribe(),g(U)}};let P=[],D=Object.assign(Object.assign({},f),{id:w,sourceMapId:this.mapId,origin:location.origin,data:ra(f.data,P)});this.target.postMessage(D,{transfer:P})})}receive(f){let l=f.data,d=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[d];let g=this.abortControllers[d];return delete this.abortControllers[d],void(g&&g.abort())}if(Oi(self)||l.mustQueue)return this.tasks[d]=l,this.taskQueue.push(d),void this.invoker.trigger();this.processTask(d,l)}}process(){if(this.taskQueue.length===0)return;let f=this.taskQueue.shift(),l=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(f,l)}processTask(f,l){return o(this,void 0,void 0,function*(){if(l.type==="<response>"){let w=this.resolveRejects[f];return delete this.resolveRejects[f],w?void(l.error?w.reject(ml(l.error)):w.resolve(ml(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let d=ml(l.data),g=new AbortController;this.abortControllers[f]=g;try{let w=yield this.messageHandlers[l.type](l.sourceMapId,d,g);this.completeTask(f,null,w)}catch(w){this.completeTask(f,w)}})}completeTask(f,l,d){let g=[];delete this.abortControllers[f];let w={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?ra(l):null,data:ra(d,g)};this.target.postMessage(w,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},n.I=vE,n.J=kt,n.K=function(){var f=new Le(16);return Le!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},n.L=function(f,l,d){var g,w,I,P,D,U,G,$,Y,oe,le,ue,pe=d[0],Te=d[1],Re=d[2];return l===f?(f[12]=l[0]*pe+l[4]*Te+l[8]*Re+l[12],f[13]=l[1]*pe+l[5]*Te+l[9]*Re+l[13],f[14]=l[2]*pe+l[6]*Te+l[10]*Re+l[14],f[15]=l[3]*pe+l[7]*Te+l[11]*Re+l[15]):(w=l[1],I=l[2],P=l[3],D=l[4],U=l[5],G=l[6],$=l[7],Y=l[8],oe=l[9],le=l[10],ue=l[11],f[0]=g=l[0],f[1]=w,f[2]=I,f[3]=P,f[4]=D,f[5]=U,f[6]=G,f[7]=$,f[8]=Y,f[9]=oe,f[10]=le,f[11]=ue,f[12]=g*pe+D*Te+Y*Re+l[12],f[13]=w*pe+U*Te+oe*Re+l[13],f[14]=I*pe+G*Te+le*Re+l[14],f[15]=P*pe+$*Te+ue*Re+l[15]),f},n.M=function(f,l,d){var g=d[0],w=d[1],I=d[2];return f[0]=l[0]*g,f[1]=l[1]*g,f[2]=l[2]*g,f[3]=l[3]*g,f[4]=l[4]*w,f[5]=l[5]*w,f[6]=l[6]*w,f[7]=l[7]*w,f[8]=l[8]*I,f[9]=l[9]*I,f[10]=l[10]*I,f[11]=l[11]*I,f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},n.N=function(f,l,d){var g=l[0],w=l[1],I=l[2],P=l[3],D=l[4],U=l[5],G=l[6],$=l[7],Y=l[8],oe=l[9],le=l[10],ue=l[11],pe=l[12],Te=l[13],Re=l[14],et=l[15],Ne=d[0],ae=d[1],xe=d[2],He=d[3];return f[0]=Ne*g+ae*D+xe*Y+He*pe,f[1]=Ne*w+ae*U+xe*oe+He*Te,f[2]=Ne*I+ae*G+xe*le+He*Re,f[3]=Ne*P+ae*$+xe*ue+He*et,f[4]=(Ne=d[4])*g+(ae=d[5])*D+(xe=d[6])*Y+(He=d[7])*pe,f[5]=Ne*w+ae*U+xe*oe+He*Te,f[6]=Ne*I+ae*G+xe*le+He*Re,f[7]=Ne*P+ae*$+xe*ue+He*et,f[8]=(Ne=d[8])*g+(ae=d[9])*D+(xe=d[10])*Y+(He=d[11])*pe,f[9]=Ne*w+ae*U+xe*oe+He*Te,f[10]=Ne*I+ae*G+xe*le+He*Re,f[11]=Ne*P+ae*$+xe*ue+He*et,f[12]=(Ne=d[12])*g+(ae=d[13])*D+(xe=d[14])*Y+(He=d[15])*pe,f[13]=Ne*w+ae*U+xe*oe+He*Te,f[14]=Ne*I+ae*G+xe*le+He*Re,f[15]=Ne*P+ae*$+xe*ue+He*et,f},n.O=function(f,l){let d={};for(let g=0;g<l.length;g++){let w=l[g];w in f&&(d[w]=f[w])}return d},n.P=R,n.Q=Zf,n.R=Wa,n.S=sB,n.T=hc,n.U=oB,n.V=re,n.W=ee,n.X=si,n.Y=$a,n.Z=ve,n._=o,n.a=jr,n.a$=function(f,l,d){var g=Math.sin(d),w=Math.cos(d),I=l[4],P=l[5],D=l[6],U=l[7],G=l[8],$=l[9],Y=l[10],oe=l[11];return l!==f&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[4]=I*w+G*g,f[5]=P*w+$*g,f[6]=D*w+Y*g,f[7]=U*w+oe*g,f[8]=G*w-I*g,f[9]=$*w-P*g,f[10]=Y*w-D*g,f[11]=oe*w-U*g,f},n.a0=25,n.a1=BE,n.a2=f=>{let l=window.document.createElement("video");return l.muted=!0,new Promise(d=>{l.onloadstart=()=>{d(l)};for(let g of f){let w=window.document.createElement("source");Xi(g)||(l.crossOrigin="Anonymous"),w.src=g,l.appendChild(w)}})},n.a3=We,n.a4=function(){return Ot++},n.a5=V,n.a6=v0,n.a7=Ta,n.a8=ni,n.a9=dB,n.aA=OE,n.aB=TE,n.aC=DE,n.aD=Vn,n.aE=A2,n.aF=Ve,n.aG=Hr,n.aH=Ut,n.aI=function(f){return Math.pow(2,f)},n.aJ=85.051129,n.aK=aB,n.aL=fr,n.aM=Xo,n.aN=lB,n.aO=function(f,l,d){return f[0]=l[0]*d,f[1]=l[1]*d,f[2]=l[2]*d,f},n.aP=function(f,l,d){return f[0]=l[0]+d[0],f[1]=l[1]+d[1],f[2]=l[2]+d[2],f},n.aQ=function(f){var l=new Le(3);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l},n.aR=function(f,l,d){return f[0]=l[0]*d[0],f[1]=l[1]*d[1],f[2]=l[2]*d[2],f[3]=l[3]*d[3],f},n.aS=function(f,l,d){return f[0]=l[0]-d[0],f[1]=l[1]-d[1],f[2]=l[2]-d[2],f},n.aT=function(f,l){var d=l[0],g=l[1],w=l[2],I=d*d+g*g+w*w;return I>0&&(I=1/Math.sqrt(I)),f[0]=l[0]*I,f[1]=l[1]*I,f[2]=l[2]*I,f},n.aU=function(f,l,d){var g=l[0],w=l[1],I=l[2],P=d[0],D=d[1],U=d[2];return f[0]=w*U-I*D,f[1]=I*P-g*U,f[2]=g*D-w*P,f},n.aV=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]},n.aW=uB,n.aX=w0,n.aY=function(f,l,d,g,w){var I,P=1/Math.tan(l/2);return f[0]=P/d,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=P,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,w!=null&&w!==1/0?(f[10]=(w+g)*(I=1/(g-w)),f[14]=2*w*g*I):(f[10]=-1,f[14]=-2*g),f},n.aZ=function(f){var l=new Le(16);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l},n.a_=function(f,l,d){var g=Math.sin(d),w=Math.cos(d),I=l[0],P=l[1],D=l[2],U=l[3],G=l[4],$=l[5],Y=l[6],oe=l[7];return l!==f&&(f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=I*w+G*g,f[1]=P*w+$*g,f[2]=D*w+Y*g,f[3]=U*w+oe*g,f[4]=G*w-I*g,f[5]=$*w-P*g,f[6]=Y*w-D*g,f[7]=oe*w-U*g,f},n.aa=function(f){let l={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,g,w,I)=>{let P=w||I;return l[g]=!P||P.toLowerCase(),""}),l["max-age"]){let d=parseInt(l["max-age"],10);isNaN(d)?delete l["max-age"]:l["max-age"]=d}return l},n.ab=function(f){return Math.log(f)/Math.LN2},n.ac=function(f){var l=f[0],d=f[1];return l*l+d*d},n.ad=function(f){return f*Math.PI/180},n.ae=jt,n.af=function(f,l){let d=[];for(let g in f)g in l||d.push(g);return d},n.ag=function(f,l){let d=0,g=0;if(f.kind==="constant")g=f.layoutSize;else if(f.kind!=="source"){let{interpolationType:w,minZoom:I,maxZoom:P}=f,D=w?jt(Ko.interpolationFactor(w,l,I,P),0,1):0;f.kind==="camera"?g=ya.number(f.minSize,f.maxSize,D):d=D}return{uSizeT:d,uSize:g}},n.ai=function(f,{uSize:l,uSizeT:d},{lowerSize:g,upperSize:w}){return f.kind==="source"?g/pu:f.kind==="composite"?ya.number(g/pu,w/pu,d):l},n.aj=function(f,l){var d=l[0],g=l[1],w=l[2],I=l[3],P=l[4],D=l[5],U=l[6],G=l[7],$=l[8],Y=l[9],oe=l[10],le=l[11],ue=l[12],pe=l[13],Te=l[14],Re=l[15],et=d*D-g*P,Ne=d*U-w*P,ae=d*G-I*P,xe=g*U-w*D,He=g*G-I*D,xt=w*G-I*U,Ht=$*pe-Y*ue,Et=$*Te-oe*ue,Rt=$*Re-le*ue,Yt=Y*Te-oe*pe,$t=Y*Re-le*pe,Qt=oe*Re-le*Te,Dt=et*Qt-Ne*$t+ae*Yt+xe*Rt-He*Et+xt*Ht;return Dt?(f[0]=(D*Qt-U*$t+G*Yt)*(Dt=1/Dt),f[1]=(w*$t-g*Qt-I*Yt)*Dt,f[2]=(pe*xt-Te*He+Re*xe)*Dt,f[3]=(oe*He-Y*xt-le*xe)*Dt,f[4]=(U*Rt-P*Qt-G*Et)*Dt,f[5]=(d*Qt-w*Rt+I*Et)*Dt,f[6]=(Te*ae-ue*xt-Re*Ne)*Dt,f[7]=($*xt-oe*ae+le*Ne)*Dt,f[8]=(P*$t-D*Rt+G*Ht)*Dt,f[9]=(g*Rt-d*$t-I*Ht)*Dt,f[10]=(ue*He-pe*ae+Re*et)*Dt,f[11]=(Y*ae-$*He-le*et)*Dt,f[12]=(D*Et-P*Yt-U*Ht)*Dt,f[13]=(d*Yt-g*Et+w*Ht)*Dt,f[14]=(pe*Ne-ue*xe-Te*et)*Dt,f[15]=($*xe-Y*Ne+oe*et)*Dt,f):null},n.ak=_e,n.al=function(f){return Math.hypot(f[0],f[1])},n.am=function(f){return f[0]=0,f[1]=0,f},n.an=function(f,l,d){return f[0]=l[0]*d,f[1]=l[1]*d,f},n.ao=CE,n.ap=X,n.aq=function(f,l,d,g){let w=l.y-f.y,I=l.x-f.x,P=g.y-d.y,D=g.x-d.x,U=P*I-D*w;if(U===0)return null;let G=(D*(f.y-d.y)-P*(f.x-d.x))/U;return new R(f.x+G*I,f.y+G*w)},n.ar=gB,n.as=Vi,n.at=Je,n.au=function(f){let l=1/0,d=1/0,g=-1/0,w=-1/0;for(let I of f)l=Math.min(l,I.x),d=Math.min(d,I.y),g=Math.max(g,I.x),w=Math.max(w,I.y);return[l,d,g,w]},n.av=To,n.aw=De,n.ax=function(f,l,d,g,w=!1){if(!d[0]&&!d[1])return[0,0];let I=w?g==="map"?-f.bearingInRadians:0:g==="viewport"?f.bearingInRadians:0;if(I){let P=Math.sin(I),D=Math.cos(I);d=[d[0]*D-d[1]*P,d[0]*P+d[1]*D]}return[w?d[0]:De(l,d[0],f.zoom),w?d[1]:De(l,d[1],f.zoom)]},n.az=EE,n.b=tn,n.b$=f=>f.type==="symbol",n.b0=function(){let f=new Float32Array(16);return Je(f),f},n.b1=function(){let f=new Float64Array(16);return Je(f),f},n.b2=function(){return new Float64Array(16)},n.b3=function(f,l,d){let g=new Float64Array(4);return function(w,I,P,D){var U=.5*Math.PI/180;I*=U,P*=U,D*=U;var G=Math.sin(I),$=Math.cos(I),Y=Math.sin(P),oe=Math.cos(P),le=Math.sin(D),ue=Math.cos(D);w[0]=G*oe*ue-$*Y*le,w[1]=$*Y*ue+G*oe*le,w[2]=$*oe*le-G*Y*ue,w[3]=$*oe*ue+G*Y*le}(g,f,l-90,d),g},n.b4=function(f,l,d,g){var w,I,P,D,U,G=l[0],$=l[1],Y=l[2],oe=l[3],le=d[0],ue=d[1],pe=d[2],Te=d[3];return(I=G*le+$*ue+Y*pe+oe*Te)<0&&(I=-I,le=-le,ue=-ue,pe=-pe,Te=-Te),1-I>me?(w=Math.acos(I),P=Math.sin(w),D=Math.sin((1-g)*w)/P,U=Math.sin(g*w)/P):(D=1-g,U=g),f[0]=D*G+U*le,f[1]=D*$+U*ue,f[2]=D*Y+U*pe,f[3]=D*oe+U*Te,f},n.b5=function(f){let l=new Float64Array(9);var d,g,w,I,P,D,U,G,$,Y,oe,le,ue,pe,Te,Re,et,Ne;Y=(w=(g=f)[0])*(U=w+w),oe=(I=g[1])*U,ue=(P=g[2])*U,pe=P*(G=I+I),Re=(D=g[3])*U,et=D*G,Ne=D*($=P+P),(d=l)[0]=1-(le=I*G)-(Te=P*$),d[3]=oe-Ne,d[6]=ue+et,d[1]=oe+Ne,d[4]=1-Y-Te,d[7]=pe-Re,d[2]=ue-et,d[5]=pe+Re,d[8]=1-Y-le;let ae=Xo(-Math.asin(jt(l[2],-1,1))),xe,He;return Math.hypot(l[5],l[8])<.001?(xe=0,He=-Xo(Math.atan2(l[3],l[4]))):(xe=Xo(l[5]===0&&l[8]===0?0:Math.atan2(l[5],l[8])),He=Xo(l[1]===0&&l[0]===0?0:Math.atan2(l[1],l[0]))),{roll:xe,pitch:ae+90,bearing:He}},n.b6=function(f,l){return f.roll==l.roll&&f.pitch==l.pitch&&f.bearing==l.bearing},n.b7=Ti,n.b8=he,n.b9=x0,n.bA=function(f,l){if(!f)return[{command:"setStyle",args:[l]}];let d=[];try{if(!Ke(f.version,l.version))return[{command:"setStyle",args:[l]}];Ke(f.center,l.center)||d.push({command:"setCenter",args:[l.center]}),Ke(f.centerAltitude,l.centerAltitude)||d.push({command:"setCenterAltitude",args:[l.centerAltitude]}),Ke(f.zoom,l.zoom)||d.push({command:"setZoom",args:[l.zoom]}),Ke(f.bearing,l.bearing)||d.push({command:"setBearing",args:[l.bearing]}),Ke(f.pitch,l.pitch)||d.push({command:"setPitch",args:[l.pitch]}),Ke(f.roll,l.roll)||d.push({command:"setRoll",args:[l.roll]}),Ke(f.sprite,l.sprite)||d.push({command:"setSprite",args:[l.sprite]}),Ke(f.glyphs,l.glyphs)||d.push({command:"setGlyphs",args:[l.glyphs]}),Ke(f.transition,l.transition)||d.push({command:"setTransition",args:[l.transition]}),Ke(f.light,l.light)||d.push({command:"setLight",args:[l.light]}),Ke(f.terrain,l.terrain)||d.push({command:"setTerrain",args:[l.terrain]}),Ke(f.sky,l.sky)||d.push({command:"setSky",args:[l.sky]}),Ke(f.projection,l.projection)||d.push({command:"setProjection",args:[l.projection]});let g={},w=[];(function(P,D,U,G){let $;for($ in D=D||{},P=P||{})Object.prototype.hasOwnProperty.call(P,$)&&(Object.prototype.hasOwnProperty.call(D,$)||Bt($,U,G));for($ in D)Object.prototype.hasOwnProperty.call(D,$)&&(Object.prototype.hasOwnProperty.call(P,$)?Ke(P[$],D[$])||(P[$].type==="geojson"&&D[$].type==="geojson"&&ut(P,D,$)?dt(U,{command:"setGeoJSONSourceData",args:[$,D[$].data]}):Mt($,D,U,G)):it($,D,U))})(f.sources,l.sources,w,g);let I=[];f.layers&&f.layers.forEach(P=>{"source"in P&&g[P.source]?d.push({command:"removeLayer",args:[P.id]}):I.push(P)}),d=d.concat(w),function(P,D,U){D=D||[];let G=(P=P||[]).map(rr),$=D.map(rr),Y=P.reduce(nr,{}),oe=D.reduce(nr,{}),le=G.slice(),ue=Object.create(null),pe,Te,Re,et,Ne;for(let ae=0,xe=0;ae<G.length;ae++)pe=G[ae],Object.prototype.hasOwnProperty.call(oe,pe)?xe++:(dt(U,{command:"removeLayer",args:[pe]}),le.splice(le.indexOf(pe,xe),1));for(let ae=0,xe=0;ae<$.length;ae++)pe=$[$.length-1-ae],le[le.length-1-ae]!==pe&&(Object.prototype.hasOwnProperty.call(Y,pe)?(dt(U,{command:"removeLayer",args:[pe]}),le.splice(le.lastIndexOf(pe,le.length-xe),1)):xe++,et=le[le.length-ae],dt(U,{command:"addLayer",args:[oe[pe],et]}),le.splice(le.length-ae,0,pe),ue[pe]=!0);for(let ae=0;ae<$.length;ae++)if(pe=$[ae],Te=Y[pe],Re=oe[pe],!ue[pe]&&!Ke(Te,Re))if(Ke(Te.source,Re.source)&&Ke(Te["source-layer"],Re["source-layer"])&&Ke(Te.type,Re.type)){for(Ne in zt(Te.layout,Re.layout,U,pe,null,"setLayoutProperty"),zt(Te.paint,Re.paint,U,pe,null,"setPaintProperty"),Ke(Te.filter,Re.filter)||dt(U,{command:"setFilter",args:[pe,Re.filter]}),Ke(Te.minzoom,Re.minzoom)&&Ke(Te.maxzoom,Re.maxzoom)||dt(U,{command:"setLayerZoomRange",args:[pe,Re.minzoom,Re.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?zt(Te[Ne],Re[Ne],U,pe,Ne.slice(6),"setPaintProperty"):Ke(Te[Ne],Re[Ne])||dt(U,{command:"setLayerProperty",args:[pe,Ne,Re[Ne]]}));for(Ne in Re)Object.prototype.hasOwnProperty.call(Re,Ne)&&!Object.prototype.hasOwnProperty.call(Te,Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?zt(Te[Ne],Re[Ne],U,pe,Ne.slice(6),"setPaintProperty"):Ke(Te[Ne],Re[Ne])||dt(U,{command:"setLayerProperty",args:[pe,Ne,Re[Ne]]}))}else dt(U,{command:"removeLayer",args:[pe]}),et=le[le.lastIndexOf(pe)+1],dt(U,{command:"addLayer",args:[Re,et]})}(I,l.layers,d)}catch(g){console.warn("Unable to compute style diff:",g),d=[{command:"setStyle",args:[l]}]}return d},n.bB=function(f){let l=[],d=f.id;return d===void 0&&l.push({message:`layers.${d}: missing required property "id"`}),f.render===void 0&&l.push({message:`layers.${d}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&l.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),l},n.bC=function f(l,d){if(Array.isArray(l)){if(!Array.isArray(d)||l.length!==d.length)return!1;for(let g=0;g<l.length;g++)if(!f(l[g],d[g]))return!1;return!0}if(typeof l=="object"&&l!==null&&d!==null){if(typeof d!="object"||Object.keys(l).length!==Object.keys(d).length)return!1;for(let g in l)if(!f(l[g],d[g]))return!1;return!0}return l===d},n.bD=Tr,n.bE=Or,n.bF=class extends Q{constructor(f,l){super(f,l),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},n.bG=$e,n.bH=class extends Q{constructor(f,l){super(f,l),this.current=Qe}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let l=1;l<16;l++)if(f[l]!==this.current[l]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},n.bI=we,n.bJ=class extends Q{constructor(f,l){super(f,l),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},n.bK=class extends Q{constructor(f,l){super(f,l),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},n.bL=je,n.bM=function(f,l){var d=Math.sin(l),g=Math.cos(l);return f[0]=g,f[1]=d,f[2]=0,f[3]=-d,f[4]=g,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},n.bN=function(f,l,d){var g=l[0],w=l[1],I=l[2];return f[0]=g*d[0]+w*d[3]+I*d[6],f[1]=g*d[1]+w*d[4]+I*d[7],f[2]=g*d[2]+w*d[5]+I*d[8],f},n.bO=function(f,l,d,g,w,I,P){var D=1/(l-d),U=1/(g-w),G=1/(I-P);return f[0]=-2*D,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*U,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*G,f[11]=0,f[12]=(l+d)*D,f[13]=(w+g)*U,f[14]=(P+I)*G,f[15]=1,f},n.bP=class extends xp{},n.bQ=b$,n.bR=class extends Ch{},n.bS=sE,n.bT=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},n.bU=fR,n.bV=function(f,l,d){var g=l[0],w=l[1],I=l[2],P=d[3]*g+d[7]*w+d[11]*I+d[15];return f[0]=(d[0]*g+d[4]*w+d[8]*I+d[12])/(P=P||1),f[1]=(d[1]*g+d[5]*w+d[9]*I+d[13])/P,f[2]=(d[2]*g+d[6]*w+d[10]*I+d[14])/P,f},n.bW=class extends Eh{},n.bX=class extends S{},n.bY=function(f,l){return f[0]===l[0]&&f[1]===l[1]&&f[2]===l[2]&&f[3]===l[3]&&f[4]===l[4]&&f[5]===l[5]&&f[6]===l[6]&&f[7]===l[7]&&f[8]===l[8]&&f[9]===l[9]&&f[10]===l[10]&&f[11]===l[11]&&f[12]===l[12]&&f[13]===l[13]&&f[14]===l[14]&&f[15]===l[15]},n.bZ=function(f,l){var d=f[0],g=f[1],w=f[2],I=f[3],P=f[4],D=f[5],U=f[6],G=f[7],$=f[8],Y=f[9],oe=f[10],le=f[11],ue=f[12],pe=f[13],Te=f[14],Re=f[15],et=l[0],Ne=l[1],ae=l[2],xe=l[3],He=l[4],xt=l[5],Ht=l[6],Et=l[7],Rt=l[8],Yt=l[9],$t=l[10],Qt=l[11],Dt=l[12],Ar=l[13],Br=l[14],Ir=l[15];return Math.abs(d-et)<=me*Math.max(1,Math.abs(d),Math.abs(et))&&Math.abs(g-Ne)<=me*Math.max(1,Math.abs(g),Math.abs(Ne))&&Math.abs(w-ae)<=me*Math.max(1,Math.abs(w),Math.abs(ae))&&Math.abs(I-xe)<=me*Math.max(1,Math.abs(I),Math.abs(xe))&&Math.abs(P-He)<=me*Math.max(1,Math.abs(P),Math.abs(He))&&Math.abs(D-xt)<=me*Math.max(1,Math.abs(D),Math.abs(xt))&&Math.abs(U-Ht)<=me*Math.max(1,Math.abs(U),Math.abs(Ht))&&Math.abs(G-Et)<=me*Math.max(1,Math.abs(G),Math.abs(Et))&&Math.abs($-Rt)<=me*Math.max(1,Math.abs($),Math.abs(Rt))&&Math.abs(Y-Yt)<=me*Math.max(1,Math.abs(Y),Math.abs(Yt))&&Math.abs(oe-$t)<=me*Math.max(1,Math.abs(oe),Math.abs($t))&&Math.abs(le-Qt)<=me*Math.max(1,Math.abs(le),Math.abs(Qt))&&Math.abs(ue-Dt)<=me*Math.max(1,Math.abs(ue),Math.abs(Dt))&&Math.abs(pe-Ar)<=me*Math.max(1,Math.abs(pe),Math.abs(Ar))&&Math.abs(Te-Br)<=me*Math.max(1,Math.abs(Te),Math.abs(Br))&&Math.abs(Re-Ir)<=me*Math.max(1,Math.abs(Re),Math.abs(Ir))},n.b_=function(f,l){return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},n.ba=Qg,n.bb=y0,n.bc=rt,n.bd=tt,n.be=fo,n.bf=function(f,l,d,g,w){return rt(g,w,jt((f-l)/(d-l),0,1))},n.bg=Xe,n.bh=function(){return new Float64Array(4)},n.bi=function(){return new Float64Array(3)},n.bj=function(f,l,d,g){var w=[],I=[];return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],I[0]=w[0]*Math.cos(g)-w[1]*Math.sin(g),I[1]=w[0]*Math.sin(g)+w[1]*Math.cos(g),I[2]=w[2],f[0]=I[0]+d[0],f[1]=I[1]+d[1],f[2]=I[2]+d[2],f},n.bk=function(f,l,d,g){var w=[],I=[];return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],I[0]=w[0],I[1]=w[1]*Math.cos(g)-w[2]*Math.sin(g),I[2]=w[1]*Math.sin(g)+w[2]*Math.cos(g),f[0]=I[0]+d[0],f[1]=I[1]+d[1],f[2]=I[2]+d[2],f},n.bl=function(f,l,d,g){var w=[],I=[];return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],I[0]=w[2]*Math.sin(g)+w[0]*Math.cos(g),I[1]=w[1],I[2]=w[2]*Math.cos(g)-w[0]*Math.sin(g),f[0]=I[0]+d[0],f[1]=I[1]+d[1],f[2]=I[2]+d[2],f},n.bm=function(f,l,d){var g=Math.sin(d),w=Math.cos(d),I=l[0],P=l[1],D=l[2],U=l[3],G=l[8],$=l[9],Y=l[10],oe=l[11];return l!==f&&(f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=I*w-G*g,f[1]=P*w-$*g,f[2]=D*w-Y*g,f[3]=U*w-oe*g,f[8]=I*g+G*w,f[9]=P*g+$*w,f[10]=D*g+Y*w,f[11]=U*g+oe*w,f},n.bn=function(f,l){let d=Xe(f,360),g=Xe(l,360),w=g-d,I=g>d?w-360:w+360;return Math.abs(w)<Math.abs(I)?w:I},n.bo=function(f){return f[0]=0,f[1]=0,f[2]=0,f},n.bp=function(f,l,d,g){let w=Math.sqrt(f*f+l*l),I=Math.sqrt(d*d+g*g);f/=w,l/=w,d/=I,g/=I;let P=Math.acos(f*d+l*g);return-l*d+f*g>0?P:-P},n.bq=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]},n.br=PE,n.bs=function(f,l){let d=Xe(f,2*Math.PI),g=Xe(l,2*Math.PI);return Math.min(Math.abs(d-g),Math.abs(d-g+2*Math.PI),Math.abs(d-g-2*Math.PI))},n.bt=function(f){return Math.hypot(f[0],f[1],f[2])},n.bu=function(){let f={},l=ce.$version;for(let d in ce.$root){let g=ce.$root[d];if(g.required){let w=null;w=d==="version"?l:g.type==="array"?[]:{},w!=null&&(f[d]=w)}}return f},n.bv=zf,n.bw=ai,n.bx=function(f){f=f.slice();let l=Object.create(null);for(let d=0;d<f.length;d++)l[f[d].id]=f[d];for(let d=0;d<f.length;d++)"ref"in f[d]&&(f[d]=Ye(f[d],l[f[d].ref]));return f},n.by=function(f){if(f.type==="custom")return new H$(f);switch(f.type){case"background":return new V$(f);case"circle":return new FW(f);case"fill":return new t$(f);case"fill-extrusion":return new c$(f);case"heatmap":return new NW(f);case"hillshade":return new UW(f);case"line":return new g$(f);case"raster":return new G$(f);case"symbol":return new v2(f)}},n.bz=Dr,n.c=bo,n.c0=f=>f.type==="circle",n.c1=f=>f.type==="heatmap",n.c2=f=>f.type==="line",n.c3=f=>f.type==="fill",n.c4=f=>f.type==="fill-extrusion",n.c5=f=>f.type==="hillshade",n.c6=f=>f.type==="raster",n.c7=f=>f.type==="background",n.c8=f=>f.type==="custom",n.c9=yt,n.cA=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},n.cB=function(f,l,d,g,w){return o(this,void 0,void 0,function*(){if(ee())try{return yield si(f,l,d,g,w)}catch{}return function(I,P,D,U,G){let $=I.width,Y=I.height;Es&&Zo||(Es=new OffscreenCanvas($,Y),Zo=Es.getContext("2d",{willReadFrequently:!0})),Es.width=$,Es.height=Y,Zo.drawImage(I,0,0,$,Y);let oe=Zo.getImageData(P,D,U,G);return Zo.clearRect(0,0,$,Y),oe.data}(f,l,d,g,w)})},n.cC=hB,n.cD=a,n.cE=p,n.cF=MR,n.cG=VR,n.cH=Mf,n.cI=Ha,n.ca=function(f,l,d){let g=Oe(l.x-d.x,l.y-d.y),w=Oe(f.x-d.x,f.y-d.y);var I,P;return Xo(Math.atan2(g[0]*w[1]-g[1]*w[0],(I=g)[0]*(P=w)[0]+I[1]*P[1]))},n.cb=Xt,n.cc=function(f,l){return xo[l]&&(f instanceof MouseEvent||f instanceof WheelEvent)},n.cd=function(f,l){return Aa[l]&&"touches"in f},n.ce=function(f){return Aa[f]||xo[f]},n.cf=function(f,l,d){var g=l[0],w=l[1];return f[0]=d[0]*g+d[4]*w+d[12],f[1]=d[1]*g+d[5]*w+d[13],f},n.cg=function(f,l){let{x:d,y:g}=s_.fromLngLat(l);return!(f<0||f>25||g<0||g>=1||d<0||d>=1)},n.ch=function(f,l){return f[0]=l[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},n.ci=class extends wo{},n.cj=tq,n.cl=function(f){return f.message===as},n.cm=Er,n.cn=function(f,l){jr.REGISTERED_PROTOCOLS[f]=l},n.co=function(f){delete jr.REGISTERED_PROTOCOLS[f]},n.cp=function(f,l){let d={};for(let w=0;w<f.length;w++){let I=l&&l[f[w].id]||Vg(f[w]);l&&(l[f[w].id]=I);let P=d[I];P||(P=d[I]=[]),P.push(f[w])}let g=[];for(let w in d)g.push(d[w]);return g},n.cq=ur,n.cr=fB,n.cs=pB,n.ct=GR,n.cu=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=ve/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;let l=f.bucket.layers[0],d=l.layout,g=l._unevaluatedLayout._values,w={layoutIconSize:g["icon-size"].possiblyEvaluate(new hn(f.bucket.zoom+1),f.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new hn(f.bucket.zoom+1),f.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new hn(18))};if(f.bucket.textSizeData.kind==="composite"){let{minZoom:G,maxZoom:$}=f.bucket.textSizeData;w.compositeTextSizes=[g["text-size"].possiblyEvaluate(new hn(G),f.canonical),g["text-size"].possiblyEvaluate(new hn($),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){let{minZoom:G,maxZoom:$}=f.bucket.iconSizeData;w.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new hn(G),f.canonical),g["icon-size"].possiblyEvaluate(new hn($),f.canonical)]}let I=d.get("text-line-height")*To,P=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",D=d.get("text-keep-upright"),U=d.get("text-size");for(let G of f.bucket.features){let $=d.get("text-font").evaluate(G,{},f.canonical).join(","),Y=U.evaluate(G,{},f.canonical),oe=w.layoutTextSize.evaluate(G,{},f.canonical),le=w.layoutIconSize.evaluate(G,{},f.canonical),ue={horizontal:{},vertical:void 0},pe=G.text,Te,Re=[0,0];if(pe){let ae=pe.toString(),xe=d.get("text-letter-spacing").evaluate(G,{},f.canonical)*To,He=d0(ae)?xe:0,xt=d.get("text-anchor").evaluate(G,{},f.canonical),Ht=CB(l,G,f.canonical);if(!Ht){let $t=d.get("text-radial-offset").evaluate(G,{},f.canonical);Re=$t?EB(xt,[$t*To,LE]):d.get("text-offset").evaluate(G,{},f.canonical).map(Qt=>Qt*To)}let Et=P?"center":d.get("text-justify").evaluate(G,{},f.canonical),Rt=d.get("symbol-placement")==="point"?d.get("text-max-width").evaluate(G,{},f.canonical)*To:1/0,Yt=()=>{f.bucket.allowVerticalPlacement&&cu(ae)&&(ue.vertical=y2(pe,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,xt,"left",He,Re,n.ah.vertical,!0,oe,Y))};if(!P&&Ht){let $t=new Set;if(Et==="auto")for(let Dt=0;Dt<Ht.values.length;Dt+=2)$t.add(OE(Ht.values[Dt]));else $t.add(Et);let Qt=!1;for(let Dt of $t)if(!ue.horizontal[Dt])if(Qt)ue.horizontal[Dt]=ue.horizontal[0];else{let Ar=y2(pe,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,"center",Dt,He,Re,n.ah.horizontal,!1,oe,Y);Ar&&(ue.horizontal[Dt]=Ar,Qt=Ar.positionedLines.length===1)}Yt()}else{Et==="auto"&&(Et=OE(xt));let $t=y2(pe,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,xt,Et,He,Re,n.ah.horizontal,!1,oe,Y);$t&&(ue.horizontal[Et]=$t),Yt(),cu(ae)&&P&&D&&(ue.vertical=y2(pe,f.glyphMap,f.glyphPositions,f.imagePositions,$,Rt,I,xt,Et,He,Re,n.ah.vertical,!1,oe,Y))}}let et=!1;if(G.icon&&G.icon.name){let ae=f.imageMap[G.icon.name];ae&&(Te=F$(f.imagePositions[G.icon.name],d.get("icon-offset").evaluate(G,{},f.canonical),d.get("icon-anchor").evaluate(G,{},f.canonical)),et=!!ae.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=et:f.bucket.sdfIcons!==et&&ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==f.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}let Ne=IB(ue.horizontal)||ue.vertical;f.bucket.iconsInText=!!Ne&&Ne.iconsInText,(Ne||Te)&&J$(f.bucket,G,ue,Te,f.imageMap,w,oe,le,Re,et,f.canonical,f.subdivisionGranularity)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},n.cv=gE,n.cw=hE,n.cx=mE,n.cy=e_,n.cz=xE,n.d=Xi,n.e=qt,n.f=f=>o(void 0,void 0,void 0,function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));let l=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(l)}catch(d){throw new Error(`Could not load image because of ${d.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),n.g=Jt,n.h=f=>new Promise((l,d)=>{let g=new Image;g.onload=()=>{l(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=Ni})},g.onerror=()=>d(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let w=new Blob([new Uint8Array(f)],{type:"image/png"});g.src=f.byteLength?URL.createObjectURL(w):Ni}),n.i=Oi,n.j=(f,l)=>Mr(qt(f,{type:"json"}),l),n.k=de,n.l=st,n.m=Mr,n.n=(f,l)=>Mr(qt(f,{type:"arrayBuffer"}),l),n.o=function(f){return new xE(f).readFields(T$,[])},n.p=jR,n.q=qg,n.r=ps,n.s=co,n.t=zo,n.u=li,n.v=ce,n.w=ki,n.x=Al,n.y=cc,n.z=function([f,l,d]){return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:f*Math.cos(l)*Math.sin(d),y:f*Math.sin(l)*Math.sin(d),z:f*Math.cos(d)}}}),r("worker",["./shared"],function(n){"use strict";class o{constructor(de){this.keyCache={},de&&this.replace(de)}replace(de){this._layerConfigs={},this._layers={},this.update(de,[])}update(de,ge){for(let ze of de){this._layerConfigs[ze.id]=ze;let Ye=this._layers[ze.id]=n.by(ze);Ye._featureFilter=n.a7(Ye.filter),this.keyCache[ze.id]&&delete this.keyCache[ze.id]}for(let ze of ge)delete this.keyCache[ze],delete this._layerConfigs[ze],delete this._layers[ze];this.familiesBySource={};let ce=n.cp(Object.values(this._layerConfigs),this.keyCache);for(let ze of ce){let Ye=ze.map(ut=>this._layers[ut.id]),Ke=Ye[0];if(Ke.visibility==="none")continue;let dt=Ke.source||"",it=this.familiesBySource[dt];it||(it=this.familiesBySource[dt]={});let Bt=Ke.sourceLayer||"_geojsonTileLayer",Mt=it[Bt];Mt||(Mt=it[Bt]=[]),Mt.push(Ye)}}}class a{constructor(de){let ge={},ce=[];for(let dt in de){let it=de[dt],Bt=ge[dt]={};for(let Mt in it){let ut=it[+Mt];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let zt={x:0,y:0,w:ut.bitmap.width+2,h:ut.bitmap.height+2};ce.push(zt),Bt[Mt]={rect:zt,metrics:ut.metrics}}}let{w:ze,h:Ye}=n.p(ce),Ke=new n.q({width:ze||1,height:Ye||1});for(let dt in de){let it=de[dt];for(let Bt in it){let Mt=it[+Bt];if(!Mt||Mt.bitmap.width===0||Mt.bitmap.height===0)continue;let ut=ge[dt][Bt].rect;n.q.copy(Mt.bitmap,Ke,{x:0,y:0},{x:ut.x+1,y:ut.y+1},Mt.bitmap)}}this.image=Ke,this.positions=ge}}n.cq("GlyphAtlas",a);class c{constructor(de){this.tileID=new n.Y(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),this.uid=de.uid,this.zoom=de.zoom,this.pixelRatio=de.pixelRatio,this.tileSize=de.tileSize,this.source=de.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=de.showCollisionBoxes,this.collectResourceTiming=!!de.collectResourceTiming,this.returnDependencies=!!de.returnDependencies,this.promoteId=de.promoteId,this.inFlightDependencies=[]}parse(de,ge,ce,ze,Ye){return n._(this,void 0,void 0,function*(){this.status="parsing",this.data=de,this.collisionBoxArray=new n.a5;let Ke=new n.cr(Object.keys(de.layers).sort()),dt=new n.cs(this.tileID,this.promoteId);dt.bucketLayerIDs=[];let it={},Bt={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce,subdivisionGranularity:Ye},Mt=ge.familiesBySource[this.source];for(let tr in Mt){let Ur=de.layers[tr];if(!Ur)continue;Ur.version===1&&n.w(`Vector tile source "${this.source}" layer "${tr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let xn=Ke.encode(tr),ma=[];for(let Pr=0;Pr<Ur.length;Pr++){let Kn=Ur.feature(Pr),rn=dt.getId(Kn,tr);ma.push({feature:Kn,id:rn,index:Pr,sourceLayerIndex:xn})}for(let Pr of Mt[tr]){let Kn=Pr[0];Kn.source!==this.source&&n.w(`layer.source = ${Kn.source} does not equal this.source = ${this.source}`),Kn.minzoom&&this.zoom<Math.floor(Kn.minzoom)||Kn.maxzoom&&this.zoom>=Kn.maxzoom||Kn.visibility!=="none"&&(h(Pr,this.zoom,ce),(it[Kn.id]=Kn.createBucket({index:dt.bucketLayerIDs.length,layers:Pr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xn,sourceID:this.source})).populate(ma,Bt,this.tileID.canonical),dt.bucketLayerIDs.push(Pr.map(rn=>rn.id)))}}let ut=n.bD(Bt.glyphDependencies,tr=>Object.keys(tr).map(Number));this.inFlightDependencies.forEach(tr=>tr?.abort()),this.inFlightDependencies=[];let zt=Promise.resolve({});if(Object.keys(ut).length){let tr=new AbortController;this.inFlightDependencies.push(tr),zt=ze.sendAsync({type:"GG",data:{stacks:ut,source:this.source,tileID:this.tileID,type:"glyphs"}},tr)}let rr=Object.keys(Bt.iconDependencies),nr=Promise.resolve({});if(rr.length){let tr=new AbortController;this.inFlightDependencies.push(tr),nr=ze.sendAsync({type:"GI",data:{icons:rr,source:this.source,tileID:this.tileID,type:"icons"}},tr)}let We=Object.keys(Bt.patternDependencies),Fr=Promise.resolve({});if(We.length){let tr=new AbortController;this.inFlightDependencies.push(tr),Fr=ze.sendAsync({type:"GI",data:{icons:We,source:this.source,tileID:this.tileID,type:"patterns"}},tr)}let[Cr,kr,gi]=yield Promise.all([zt,nr,Fr]),Gt=new a(Cr),dr=new n.ct(kr,gi);for(let tr in it){let Ur=it[tr];Ur instanceof n.a6?(h(Ur.layers,this.zoom,ce),n.cu({bucket:Ur,glyphMap:Cr,glyphPositions:Gt.positions,imageMap:kr,imagePositions:dr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Bt.subdivisionGranularity})):Ur.hasPattern&&(Ur instanceof n.cv||Ur instanceof n.cw||Ur instanceof n.cx)&&(h(Ur.layers,this.zoom,ce),Ur.addFeatures(Bt,this.tileID.canonical,dr.patternPositions))}return this.status="done",{buckets:Object.values(it).filter(tr=>!tr.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gt.image,imageAtlas:dr,glyphMap:this.returnDependencies?Cr:null,iconMap:this.returnDependencies?kr:null,glyphPositions:this.returnDependencies?Gt.positions:null}})}}function h(st,de,ge){let ce=new n.C(de);for(let ze of st)ze.recalculate(ce,ge)}class p{constructor(de,ge,ce){this.actor=de,this.layerIndex=ge,this.availableImages=ce,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(de,ge){return n._(this,void 0,void 0,function*(){let ce=yield n.n(de.request,ge);try{return{vectorTile:new n.cy.VectorTile(new n.cz(ce.data)),rawData:ce.data,cacheControl:ce.cacheControl,expires:ce.expires}}catch(ze){let Ye=new Uint8Array(ce.data),Ke=`Unable to parse the tile at ${de.request.url}, `;throw Ke+=Ye[0]===31&&Ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ze.message}`,new Error(Ke)}})}loadTile(de){return n._(this,void 0,void 0,function*(){let ge=de.uid,ce=!!(de&&de.request&&de.request.collectResourceTiming)&&new n.cA(de.request),ze=new c(de);this.loading[ge]=ze;let Ye=new AbortController;ze.abort=Ye;try{let Ke=yield this.loadVectorTile(de,Ye);if(delete this.loading[ge],!Ke)return null;let dt=Ke.rawData,it={};Ke.expires&&(it.expires=Ke.expires),Ke.cacheControl&&(it.cacheControl=Ke.cacheControl);let Bt={};if(ce){let ut=ce.finish();ut&&(Bt.resourceTiming=JSON.parse(JSON.stringify(ut)))}ze.vectorTile=Ke.vectorTile;let Mt=ze.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.actor,de.subdivisionGranularity);this.loaded[ge]=ze,this.fetching[ge]={rawTileData:dt,cacheControl:it,resourceTiming:Bt};try{let ut=yield Mt;return n.e({rawTileData:dt.slice(0)},ut,it,Bt)}finally{delete this.fetching[ge]}}catch(Ke){throw delete this.loading[ge],ze.status="done",this.loaded[ge]=ze,Ke}})}reloadTile(de){return n._(this,void 0,void 0,function*(){let ge=de.uid;if(!this.loaded||!this.loaded[ge])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let ce=this.loaded[ge];if(ce.showCollisionBoxes=de.showCollisionBoxes,ce.status==="parsing"){let ze=yield ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,de.subdivisionGranularity),Ye;if(this.fetching[ge]){let{rawTileData:Ke,cacheControl:dt,resourceTiming:it}=this.fetching[ge];delete this.fetching[ge],Ye=n.e({rawTileData:Ke.slice(0)},ze,dt,it)}else Ye=ze;return Ye}if(ce.status==="done"&&ce.vectorTile)return ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,de.subdivisionGranularity)})}abortTile(de){return n._(this,void 0,void 0,function*(){let ge=this.loading,ce=de.uid;ge&&ge[ce]&&ge[ce].abort&&(ge[ce].abort.abort(),delete ge[ce])})}removeTile(de){return n._(this,void 0,void 0,function*(){this.loaded&&this.loaded[de.uid]&&delete this.loaded[de.uid]})}}class x{constructor(){this.loaded={}}loadTile(de){return n._(this,void 0,void 0,function*(){let{uid:ge,encoding:ce,rawImageData:ze,redFactor:Ye,greenFactor:Ke,blueFactor:dt,baseShift:it}=de,Bt=ze.width+2,Mt=ze.height+2,ut=n.b(ze)?new n.R({width:Bt,height:Mt},yield n.cB(ze,-1,-1,Bt,Mt)):ze,zt=new n.cC(ge,ut,ce,Ye,Ke,dt,it);return this.loaded=this.loaded||{},this.loaded[ge]=zt,zt})}removeTile(de){let ge=this.loaded,ce=de.uid;ge&&ge[ce]&&delete ge[ce]}}var T,R,k=function(){if(R)return T;function st(ge,ce){if(ge.length!==0){de(ge[0],ce);for(var ze=1;ze<ge.length;ze++)de(ge[ze],!ce)}}function de(ge,ce){for(var ze=0,Ye=0,Ke=0,dt=ge.length,it=dt-1;Ke<dt;it=Ke++){var Bt=(ge[Ke][0]-ge[it][0])*(ge[it][1]+ge[Ke][1]),Mt=ze+Bt;Ye+=Math.abs(ze)>=Math.abs(Bt)?ze-Mt+Bt:Bt-Mt+ze,ze=Mt}ze+Ye>=0!=!!ce&&ge.reverse()}return R=1,T=function ge(ce,ze){var Ye,Ke=ce&&ce.type;if(Ke==="FeatureCollection")for(Ye=0;Ye<ce.features.length;Ye++)ge(ce.features[Ye],ze);else if(Ke==="GeometryCollection")for(Ye=0;Ye<ce.geometries.length;Ye++)ge(ce.geometries[Ye],ze);else if(Ke==="Feature")ge(ce.geometry,ze);else if(Ke==="Polygon")st(ce.coordinates,ze);else if(Ke==="MultiPolygon")for(Ye=0;Ye<ce.coordinates.length;Ye++)st(ce.coordinates[Ye],ze);return ce}}(),j=n.cD(k);let q=n.cy.VectorTileFeature.prototype.toGeoJSON;class Z{constructor(de){this._feature=de,this.extent=n.Z,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){let de=[];for(let ge of this._feature.geometry)de.push([new n.P(ge[0],ge[1])]);return de}{let de=[];for(let ge of this._feature.geometry){let ce=[];for(let ze of ge)ce.push(new n.P(ze[0],ze[1]));de.push(ce)}return de}}toGeoJSON(de,ge,ce){return q.call(this,de,ge,ce)}}class re{constructor(de){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.Z,this.length=de.length,this._features=de}feature(de){return new Z(this._features[de])}}var ee,se,me,Le={exports:{}},je=function(){if(me)return Le.exports;me=1;var st=n.cG(),de=function(){if(se)return ee;se=1;var Mt=n.cE(),ut=n.cF().VectorTileFeature;function zt(nr,We){this.options=We||{},this.features=nr,this.length=nr.length}function rr(nr,We){this.id=typeof nr.id=="number"?nr.id:void 0,this.type=nr.type,this.rawGeometry=nr.type===1?[nr.geometry]:nr.geometry,this.properties=nr.tags,this.extent=We||4096}return ee=zt,zt.prototype.feature=function(nr){return new rr(this.features[nr],this.options.extent)},rr.prototype.loadGeometry=function(){var nr=this.rawGeometry;this.geometry=[];for(var We=0;We<nr.length;We++){for(var Fr=nr[We],Cr=[],kr=0;kr<Fr.length;kr++)Cr.push(new Mt(Fr[kr][0],Fr[kr][1]));this.geometry.push(Cr)}return this.geometry},rr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var nr=this.geometry,We=1/0,Fr=-1/0,Cr=1/0,kr=-1/0,gi=0;gi<nr.length;gi++)for(var Gt=nr[gi],dr=0;dr<Gt.length;dr++){var tr=Gt[dr];We=Math.min(We,tr.x),Fr=Math.max(Fr,tr.x),Cr=Math.min(Cr,tr.y),kr=Math.max(kr,tr.y)}return[We,Cr,Fr,kr]},rr.prototype.toGeoJSON=ut.prototype.toGeoJSON,ee}();function ge(Mt){var ut=new st;return function(zt,rr){for(var nr in zt.layers)rr.writeMessage(3,ce,zt.layers[nr])}(Mt,ut),ut.finish()}function ce(Mt,ut){var zt;ut.writeVarintField(15,Mt.version||1),ut.writeStringField(1,Mt.name||""),ut.writeVarintField(5,Mt.extent||4096);var rr={keys:[],values:[],keycache:{},valuecache:{}};for(zt=0;zt<Mt.length;zt++)rr.feature=Mt.feature(zt),ut.writeMessage(2,ze,rr);var nr=rr.keys;for(zt=0;zt<nr.length;zt++)ut.writeStringField(3,nr[zt]);var We=rr.values;for(zt=0;zt<We.length;zt++)ut.writeMessage(4,Bt,We[zt])}function ze(Mt,ut){var zt=Mt.feature;zt.id!==void 0&&ut.writeVarintField(1,zt.id),ut.writeMessage(2,Ye,Mt),ut.writeVarintField(3,zt.type),ut.writeMessage(4,it,zt)}function Ye(Mt,ut){var zt=Mt.feature,rr=Mt.keys,nr=Mt.values,We=Mt.keycache,Fr=Mt.valuecache;for(var Cr in zt.properties){var kr=zt.properties[Cr],gi=We[Cr];if(kr!==null){gi===void 0&&(rr.push(Cr),We[Cr]=gi=rr.length-1),ut.writeVarint(gi);var Gt=typeof kr;Gt!=="string"&&Gt!=="boolean"&&Gt!=="number"&&(kr=JSON.stringify(kr));var dr=Gt+":"+kr,tr=Fr[dr];tr===void 0&&(nr.push(kr),Fr[dr]=tr=nr.length-1),ut.writeVarint(tr)}}}function Ke(Mt,ut){return(ut<<3)+(7&Mt)}function dt(Mt){return Mt<<1^Mt>>31}function it(Mt,ut){for(var zt=Mt.loadGeometry(),rr=Mt.type,nr=0,We=0,Fr=zt.length,Cr=0;Cr<Fr;Cr++){var kr=zt[Cr],gi=1;rr===1&&(gi=kr.length),ut.writeVarint(Ke(1,gi));for(var Gt=rr===3?kr.length-1:kr.length,dr=0;dr<Gt;dr++){dr===1&&rr!==1&&ut.writeVarint(Ke(2,Gt-1));var tr=kr[dr].x-nr,Ur=kr[dr].y-We;ut.writeVarint(dt(tr)),ut.writeVarint(dt(Ur)),nr+=tr,We+=Ur}rr===3&&ut.writeVarint(Ke(7,1))}}function Bt(Mt,ut){var zt=typeof Mt;zt==="string"?ut.writeStringField(1,Mt):zt==="boolean"?ut.writeBooleanField(7,Mt):zt==="number"&&(Mt%1!=0?ut.writeDoubleField(3,Mt):Mt<0?ut.writeSVarintField(6,Mt):ut.writeVarintField(5,Mt))}return Le.exports=ge,Le.exports.fromVectorTileJs=ge,Le.exports.fromGeojsonVt=function(Mt,ut){ut=ut||{};var zt={};for(var rr in Mt)zt[rr]=new de(Mt[rr].features,ut),zt[rr].name=rr,zt[rr].version=ut.version,zt[rr].extent=ut.extent;return ge({layers:zt})},Le.exports.GeoJSONWrapper=de,Le.exports}(),Je=n.cD(je);let J={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:st=>st},te=Math.fround||(X=new Float32Array(1),st=>(X[0]=+st,X[0]));var X;let ye=3,_e=5,Oe=6;class ve{constructor(de){this.options=Object.assign(Object.create(J),de),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(de){let{log:ge,minZoom:ce,maxZoom:ze}=this.options;ge&&console.time("total time");let Ye=`prepare ${de.length} points`;ge&&console.time(Ye),this.points=de;let Ke=[];for(let it=0;it<de.length;it++){let Bt=de[it];if(!Bt.geometry)continue;let[Mt,ut]=Bt.geometry.coordinates,zt=te(rt(Mt)),rr=te(tt(ut));Ke.push(zt,rr,1/0,it,-1,1),this.options.reduce&&Ke.push(0)}let dt=this.trees[ze+1]=this._createTree(Ke);ge&&console.timeEnd(Ye);for(let it=ze;it>=ce;it--){let Bt=+Date.now();dt=this.trees[it]=this._createTree(this._cluster(dt,it)),ge&&console.log("z%d: %d clusters in %dms",it,dt.numItems,+Date.now()-Bt)}return ge&&console.timeEnd("total time"),this}getClusters(de,ge){let ce=((de[0]+180)%360+360)%360-180,ze=Math.max(-90,Math.min(90,de[1])),Ye=de[2]===180?180:((de[2]+180)%360+360)%360-180,Ke=Math.max(-90,Math.min(90,de[3]));if(de[2]-de[0]>=360)ce=-180,Ye=180;else if(ce>Ye){let ut=this.getClusters([ce,ze,180,Ke],ge),zt=this.getClusters([-180,ze,Ye,Ke],ge);return ut.concat(zt)}let dt=this.trees[this._limitZoom(ge)],it=dt.range(rt(ce),tt(Ke),rt(Ye),tt(ze)),Bt=dt.data,Mt=[];for(let ut of it){let zt=this.stride*ut;Mt.push(Bt[zt+_e]>1?De(Bt,zt,this.clusterProps):this.points[Bt[zt+ye]])}return Mt}getChildren(de){let ge=this._getOriginId(de),ce=this._getOriginZoom(de),ze="No cluster with the specified id.",Ye=this.trees[ce];if(!Ye)throw new Error(ze);let Ke=Ye.data;if(ge*this.stride>=Ke.length)throw new Error(ze);let dt=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),it=Ye.within(Ke[ge*this.stride],Ke[ge*this.stride+1],dt),Bt=[];for(let Mt of it){let ut=Mt*this.stride;Ke[ut+4]===de&&Bt.push(Ke[ut+_e]>1?De(Ke,ut,this.clusterProps):this.points[Ke[ut+ye]])}if(Bt.length===0)throw new Error(ze);return Bt}getLeaves(de,ge,ce){let ze=[];return this._appendLeaves(ze,de,ge=ge||10,ce=ce||0,0),ze}getTile(de,ge,ce){let ze=this.trees[this._limitZoom(de)],Ye=Math.pow(2,de),{extent:Ke,radius:dt}=this.options,it=dt/Ke,Bt=(ce-it)/Ye,Mt=(ce+1+it)/Ye,ut={features:[]};return this._addTileFeatures(ze.range((ge-it)/Ye,Bt,(ge+1+it)/Ye,Mt),ze.data,ge,ce,Ye,ut),ge===0&&this._addTileFeatures(ze.range(1-it/Ye,Bt,1,Mt),ze.data,Ye,ce,Ye,ut),ge===Ye-1&&this._addTileFeatures(ze.range(0,Bt,it/Ye,Mt),ze.data,-1,ce,Ye,ut),ut.features.length?ut:null}getClusterExpansionZoom(de){let ge=this._getOriginZoom(de)-1;for(;ge<=this.options.maxZoom;){let ce=this.getChildren(de);if(ge++,ce.length!==1)break;de=ce[0].properties.cluster_id}return ge}_appendLeaves(de,ge,ce,ze,Ye){let Ke=this.getChildren(ge);for(let dt of Ke){let it=dt.properties;if(it&&it.cluster?Ye+it.point_count<=ze?Ye+=it.point_count:Ye=this._appendLeaves(de,it.cluster_id,ce,ze,Ye):Ye<ze?Ye++:de.push(dt),de.length===ce)break}return Ye}_createTree(de){let ge=new n.aC(de.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<de.length;ce+=this.stride)ge.add(de[ce],de[ce+1]);return ge.finish(),ge.data=de,ge}_addTileFeatures(de,ge,ce,ze,Ye,Ke){for(let dt of de){let it=dt*this.stride,Bt=ge[it+_e]>1,Mt,ut,zt;if(Bt)Mt=Xe(ge,it,this.clusterProps),ut=ge[it],zt=ge[it+1];else{let We=this.points[ge[it+ye]];Mt=We.properties;let[Fr,Cr]=We.geometry.coordinates;ut=rt(Fr),zt=tt(Cr)}let rr={type:1,geometry:[[Math.round(this.options.extent*(ut*Ye-ce)),Math.round(this.options.extent*(zt*Ye-ze))]],tags:Mt},nr;nr=Bt||this.options.generateId?ge[it+ye]:this.points[ge[it+ye]].id,nr!==void 0&&(rr.id=nr),Ke.features.push(rr)}}_limitZoom(de){return Math.max(this.options.minZoom,Math.min(Math.floor(+de),this.options.maxZoom+1))}_cluster(de,ge){let{radius:ce,extent:ze,reduce:Ye,minPoints:Ke}=this.options,dt=ce/(ze*Math.pow(2,ge)),it=de.data,Bt=[],Mt=this.stride;for(let ut=0;ut<it.length;ut+=Mt){if(it[ut+2]<=ge)continue;it[ut+2]=ge;let zt=it[ut],rr=it[ut+1],nr=de.within(it[ut],it[ut+1],dt),We=it[ut+_e],Fr=We;for(let Cr of nr){let kr=Cr*Mt;it[kr+2]>ge&&(Fr+=it[kr+_e])}if(Fr>We&&Fr>=Ke){let Cr,kr=zt*We,gi=rr*We,Gt=-1,dr=((ut/Mt|0)<<5)+(ge+1)+this.points.length;for(let tr of nr){let Ur=tr*Mt;if(it[Ur+2]<=ge)continue;it[Ur+2]=ge;let xn=it[Ur+_e];kr+=it[Ur]*xn,gi+=it[Ur+1]*xn,it[Ur+4]=dr,Ye&&(Cr||(Cr=this._map(it,ut,!0),Gt=this.clusterProps.length,this.clusterProps.push(Cr)),Ye(Cr,this._map(it,Ur)))}it[ut+4]=dr,Bt.push(kr/Fr,gi/Fr,1/0,dr,-1,Fr),Ye&&Bt.push(Gt)}else{for(let Cr=0;Cr<Mt;Cr++)Bt.push(it[ut+Cr]);if(Fr>1)for(let Cr of nr){let kr=Cr*Mt;if(!(it[kr+2]<=ge)){it[kr+2]=ge;for(let gi=0;gi<Mt;gi++)Bt.push(it[kr+gi])}}}}return Bt}_getOriginId(de){return de-this.points.length>>5}_getOriginZoom(de){return(de-this.points.length)%32}_map(de,ge,ce){if(de[ge+_e]>1){let Ke=this.clusterProps[de[ge+Oe]];return ce?Object.assign({},Ke):Ke}let ze=this.points[de[ge+ye]].properties,Ye=this.options.map(ze);return ce&&Ye===ze?Object.assign({},Ye):Ye}}function De(st,de,ge){return{type:"Feature",id:st[de+ye],properties:Xe(st,de,ge),geometry:{type:"Point",coordinates:[(ce=st[de],360*(ce-.5)),yt(st[de+1])]}};var ce}function Xe(st,de,ge){let ce=st[de+_e],ze=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Ye=st[de+Oe],Ke=Ye===-1?{}:Object.assign({},ge[Ye]);return Object.assign(Ke,{cluster:!0,cluster_id:st[de+ye],point_count:ce,point_count_abbreviated:ze})}function rt(st){return st/360+.5}function tt(st){let de=Math.sin(st*Math.PI/180),ge=.5-.25*Math.log((1+de)/(1-de))/Math.PI;return ge<0?0:ge>1?1:ge}function yt(st){let de=(180-360*st)*Math.PI/180;return 360*Math.atan(Math.exp(de))/Math.PI-90}function Xt(st,de,ge,ce){let ze=ce,Ye=de+(ge-de>>1),Ke,dt=ge-de,it=st[de],Bt=st[de+1],Mt=st[ge],ut=st[ge+1];for(let zt=de+3;zt<ge;zt+=3){let rr=jt(st[zt],st[zt+1],it,Bt,Mt,ut);if(rr>ze)Ke=zt,ze=rr;else if(rr===ze){let nr=Math.abs(zt-Ye);nr<dt&&(Ke=zt,dt=nr)}}ze>ce&&(Ke-de>3&&Xt(st,de,Ke,ce),st[Ke+2]=ze,ge-Ke>3&&Xt(st,Ke,ge,ce))}function jt(st,de,ge,ce,ze,Ye){let Ke=ze-ge,dt=Ye-ce;if(Ke!==0||dt!==0){let it=((st-ge)*Ke+(de-ce)*dt)/(Ke*Ke+dt*dt);it>1?(ge=ze,ce=Ye):it>0&&(ge+=Ke*it,ce+=dt*it)}return Ke=st-ge,dt=de-ce,Ke*Ke+dt*dt}function fr(st,de,ge,ce){let ze={id:st??null,type:de,geometry:ge,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(de==="Point"||de==="MultiPoint"||de==="LineString")qt(ze,ge);else if(de==="Polygon")qt(ze,ge[0]);else if(de==="MultiLineString")for(let Ye of ge)qt(ze,Ye);else if(de==="MultiPolygon")for(let Ye of ge)qt(ze,Ye[0]);return ze}function qt(st,de){for(let ge=0;ge<de.length;ge+=3)st.minX=Math.min(st.minX,de[ge]),st.minY=Math.min(st.minY,de[ge+1]),st.maxX=Math.max(st.maxX,de[ge]),st.maxY=Math.max(st.maxY,de[ge+1])}function Ot(st,de,ge,ce){if(!de.geometry)return;let ze=de.geometry.coordinates;if(ze&&ze.length===0)return;let Ye=de.geometry.type,Ke=Math.pow(ge.tolerance/((1<<ge.maxZoom)*ge.extent),2),dt=[],it=de.id;if(ge.promoteId?it=de.properties[ge.promoteId]:ge.generateId&&(it=ce||0),Ye==="Point")Tr(ze,dt);else if(Ye==="MultiPoint")for(let Bt of ze)Tr(Bt,dt);else if(Ye==="LineString")Or(ze,dt,Ke,!1);else if(Ye==="MultiLineString"){if(ge.lineMetrics){for(let Bt of ze)dt=[],Or(Bt,dt,Ke,!1),st.push(fr(it,"LineString",dt,de.properties));return}Dr(ze,dt,Ke,!1)}else if(Ye==="Polygon")Dr(ze,dt,Ke,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(let Bt of de.geometry.geometries)Ot(st,{id:it,geometry:Bt,properties:de.properties},ge,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Bt of ze){let Mt=[];Dr(Bt,Mt,Ke,!0),dt.push(Mt)}}st.push(fr(it,Ye,dt,de.properties))}function Tr(st,de){de.push(Xr(st[0]),ki(st[1]),0)}function Or(st,de,ge,ce){let ze,Ye,Ke=0;for(let it=0;it<st.length;it++){let Bt=Xr(st[it][0]),Mt=ki(st[it][1]);de.push(Bt,Mt,0),it>0&&(Ke+=ce?(ze*Mt-Bt*Ye)/2:Math.sqrt(Math.pow(Bt-ze,2)+Math.pow(Mt-Ye,2))),ze=Bt,Ye=Mt}let dt=de.length-3;de[2]=1,Xt(de,0,dt,ge),de[dt+2]=1,de.size=Math.abs(Ke),de.start=0,de.end=de.size}function Dr(st,de,ge,ce){for(let ze=0;ze<st.length;ze++){let Ye=[];Or(st[ze],Ye,ge,ce),de.push(Ye)}}function Xr(st){return st/360+.5}function ki(st){let de=Math.sin(st*Math.PI/180),ge=.5-.25*Math.log((1+de)/(1-de))/Math.PI;return ge<0?0:ge>1?1:ge}function ei(st,de,ge,ce,ze,Ye,Ke,dt){if(ce/=de,Ye>=(ge/=de)&&Ke<ce)return st;if(Ke<ge||Ye>=ce)return null;let it=[];for(let Bt of st){let Mt=Bt.geometry,ut=Bt.type,zt=ze===0?Bt.minX:Bt.minY,rr=ze===0?Bt.maxX:Bt.maxY;if(zt>=ge&&rr<ce){it.push(Bt);continue}if(rr<ge||zt>=ce)continue;let nr=[];if(ut==="Point"||ut==="MultiPoint")Oi(Mt,nr,ge,ce,ze);else if(ut==="LineString")ui(Mt,nr,ge,ce,ze,!1,dt.lineMetrics);else if(ut==="MultiLineString")Ni(Mt,nr,ge,ce,ze,!1);else if(ut==="Polygon")Ni(Mt,nr,ge,ce,ze,!0);else if(ut==="MultiPolygon")for(let We of Mt){let Fr=[];Ni(We,Fr,ge,ce,ze,!0),Fr.length&&nr.push(Fr)}if(nr.length){if(dt.lineMetrics&&ut==="LineString"){for(let We of nr)it.push(fr(Bt.id,ut,We,Bt.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(nr.length===1?(ut="LineString",nr=nr[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=nr.length===3?"Point":"MultiPoint"),it.push(fr(Bt.id,ut,nr,Bt.tags))}}return it.length?it:null}function Oi(st,de,ge,ce,ze){for(let Ye=0;Ye<st.length;Ye+=3){let Ke=st[Ye+ze];Ke>=ge&&Ke<=ce&&si(de,st[Ye],st[Ye+1],st[Ye+2])}}function ui(st,de,ge,ce,ze,Ye,Ke){let dt=tn(st),it=ze===0?Es:Zo,Bt,Mt,ut=st.start;for(let Fr=0;Fr<st.length-3;Fr+=3){let Cr=st[Fr],kr=st[Fr+1],gi=st[Fr+2],Gt=st[Fr+3],dr=st[Fr+4],tr=ze===0?Cr:kr,Ur=ze===0?Gt:dr,xn=!1;Ke&&(Bt=Math.sqrt(Math.pow(Cr-Gt,2)+Math.pow(kr-dr,2))),tr<ge?Ur>ge&&(Mt=it(dt,Cr,kr,Gt,dr,ge),Ke&&(dt.start=ut+Bt*Mt)):tr>ce?Ur<ce&&(Mt=it(dt,Cr,kr,Gt,dr,ce),Ke&&(dt.start=ut+Bt*Mt)):si(dt,Cr,kr,gi),Ur<ge&&tr>=ge&&(Mt=it(dt,Cr,kr,Gt,dr,ge),xn=!0),Ur>ce&&tr<=ce&&(Mt=it(dt,Cr,kr,Gt,dr,ce),xn=!0),!Ye&&xn&&(Ke&&(dt.end=ut+Bt*Mt),de.push(dt),dt=tn(st)),Ke&&(ut+=Bt)}let zt=st.length-3,rr=st[zt],nr=st[zt+1],We=ze===0?rr:nr;We>=ge&&We<=ce&&si(dt,rr,nr,st[zt+2]),zt=dt.length-3,Ye&&zt>=3&&(dt[zt]!==dt[0]||dt[zt+1]!==dt[1])&&si(dt,dt[0],dt[1],dt[2]),dt.length&&de.push(dt)}function tn(st){let de=[];return de.size=st.size,de.start=st.start,de.end=st.end,de}function Ni(st,de,ge,ce,ze,Ye){for(let Ke of st)ui(Ke,de,ge,ce,ze,Ye,!1)}function si(st,de,ge,ce){st.push(de,ge,ce)}function Es(st,de,ge,ce,ze,Ye){let Ke=(Ye-de)/(ce-de);return si(st,Ye,ge+(ze-ge)*Ke,1),Ke}function Zo(st,de,ge,ce,ze,Ye){let Ke=(Ye-ge)/(ze-ge);return si(st,de+(ce-de)*Ke,Ye,1),Ke}function co(st,de){let ge=[];for(let ce=0;ce<st.length;ce++){let ze=st[ce],Ye=ze.type,Ke;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")Ke=Xo(ze.geometry,de);else if(Ye==="MultiLineString"||Ye==="Polygon"){Ke=[];for(let dt of ze.geometry)Ke.push(Xo(dt,de))}else if(Ye==="MultiPolygon"){Ke=[];for(let dt of ze.geometry){let it=[];for(let Bt of dt)it.push(Xo(Bt,de));Ke.push(it)}}ge.push(fr(ze.id,Ye,Ke,ze.tags))}return ge}function Xo(st,de){let ge=[];ge.size=st.size,st.start!==void 0&&(ge.start=st.start,ge.end=st.end);for(let ce=0;ce<st.length;ce+=3)ge.push(st[ce]+de,st[ce+1],st[ce+2]);return ge}function Aa(st,de){if(st.transformed)return st;let ge=1<<st.z,ce=st.x,ze=st.y;for(let Ye of st.features){let Ke=Ye.geometry,dt=Ye.type;if(Ye.geometry=[],dt===1)for(let it=0;it<Ke.length;it+=2)Ye.geometry.push(xo(Ke[it],Ke[it+1],de,ge,ce,ze));else for(let it=0;it<Ke.length;it++){let Bt=[];for(let Mt=0;Mt<Ke[it].length;Mt+=2)Bt.push(xo(Ke[it][Mt],Ke[it][Mt+1],de,ge,ce,ze));Ye.geometry.push(Bt)}}return st.transformed=!0,st}function xo(st,de,ge,ce,ze,Ye){return[Math.round(ge*(st*ce-ze)),Math.round(ge*(de*ce-Ye))]}function as(st,de,ge,ce,ze){let Ye=de===ze.maxZoom?0:ze.tolerance/((1<<de)*ze.extent),Ke={features:[],numPoints:0,numSimplified:0,numFeatures:st.length,source:null,x:ge,y:ce,z:de,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let dt of st)bo(Ke,dt,Ye,ze);return Ke}function bo(st,de,ge,ce){let ze=de.geometry,Ye=de.type,Ke=[];if(st.minX=Math.min(st.minX,de.minX),st.minY=Math.min(st.minY,de.minY),st.maxX=Math.max(st.maxX,de.maxX),st.maxY=Math.max(st.maxY,de.maxY),Ye==="Point"||Ye==="MultiPoint")for(let dt=0;dt<ze.length;dt+=3)Ke.push(ze[dt],ze[dt+1]),st.numPoints++,st.numSimplified++;else if(Ye==="LineString")jr(Ke,ze,st,ge,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(let dt=0;dt<ze.length;dt++)jr(Ke,ze[dt],st,ge,Ye==="Polygon",dt===0);else if(Ye==="MultiPolygon")for(let dt=0;dt<ze.length;dt++){let it=ze[dt];for(let Bt=0;Bt<it.length;Bt++)jr(Ke,it[Bt],st,ge,!0,Bt===0)}if(Ke.length){let dt=de.tags||null;if(Ye==="LineString"&&ce.lineMetrics){dt={};for(let Bt in de.tags)dt[Bt]=de.tags[Bt];dt.mapbox_clip_start=ze.start/ze.size,dt.mapbox_clip_end=ze.end/ze.size}let it={geometry:Ke,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:dt};de.id!==null&&(it.id=de.id),st.features.push(it)}}function jr(st,de,ge,ce,ze,Ye){let Ke=ce*ce;if(ce>0&&de.size<(ze?Ke:ce))return void(ge.numPoints+=de.length/3);let dt=[];for(let it=0;it<de.length;it+=3)(ce===0||de[it+2]>Ke)&&(ge.numSimplified++,dt.push(de[it],de[it+1])),ge.numPoints++;ze&&function(it,Bt){let Mt=0;for(let ut=0,zt=it.length,rr=zt-2;ut<zt;rr=ut,ut+=2)Mt+=(it[ut]-it[rr])*(it[ut+1]+it[rr+1]);if(Mt>0===Bt)for(let ut=0,zt=it.length;ut<zt/2;ut+=2){let rr=it[ut],nr=it[ut+1];it[ut]=it[zt-2-ut],it[ut+1]=it[zt-1-ut],it[zt-2-ut]=rr,it[zt-1-ut]=nr}}(dt,Ye),st.push(dt)}let Jt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class kt{constructor(de,ge){let ce=(ge=this.options=function(Ye,Ke){for(let dt in Ke)Ye[dt]=Ke[dt];return Ye}(Object.create(Jt),ge)).debug;if(ce&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");let ze=function(Ye,Ke){let dt=[];if(Ye.type==="FeatureCollection")for(let it=0;it<Ye.features.length;it++)Ot(dt,Ye.features[it],Ke,it);else Ot(dt,Ye.type==="Feature"?Ye:{geometry:Ye},Ke);return dt}(de,ge);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ze=function(Ye,Ke){let dt=Ke.buffer/Ke.extent,it=Ye,Bt=ei(Ye,1,-1-dt,dt,0,-1,2,Ke),Mt=ei(Ye,1,1-dt,2+dt,0,-1,2,Ke);return(Bt||Mt)&&(it=ei(Ye,1,-dt,1+dt,0,-1,2,Ke)||[],Bt&&(it=co(Bt,1).concat(it)),Mt&&(it=it.concat(co(Mt,-1)))),it}(ze,ge),ze.length&&this.splitTile(ze,0,0,0),ce&&(ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(de,ge,ce,ze,Ye,Ke,dt){let it=[de,ge,ce,ze],Bt=this.options,Mt=Bt.debug;for(;it.length;){ze=it.pop(),ce=it.pop(),ge=it.pop(),de=it.pop();let ut=1<<ge,zt=Er(ge,ce,ze),rr=this.tiles[zt];if(!rr&&(Mt>1&&console.time("creation"),rr=this.tiles[zt]=as(de,ge,ce,ze,Bt),this.tileCoords.push({z:ge,x:ce,y:ze}),Mt)){Mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,ce,ze,rr.numFeatures,rr.numPoints,rr.numSimplified),console.timeEnd("creation"));let xn=`z${ge}`;this.stats[xn]=(this.stats[xn]||0)+1,this.total++}if(rr.source=de,Ye==null){if(ge===Bt.indexMaxZoom||rr.numPoints<=Bt.indexMaxPoints)continue}else{if(ge===Bt.maxZoom||ge===Ye)continue;if(Ye!=null){let xn=Ye-ge;if(ce!==Ke>>xn||ze!==dt>>xn)continue}}if(rr.source=null,de.length===0)continue;Mt>1&&console.time("clipping");let nr=.5*Bt.buffer/Bt.extent,We=.5-nr,Fr=.5+nr,Cr=1+nr,kr=null,gi=null,Gt=null,dr=null,tr=ei(de,ut,ce-nr,ce+Fr,0,rr.minX,rr.maxX,Bt),Ur=ei(de,ut,ce+We,ce+Cr,0,rr.minX,rr.maxX,Bt);de=null,tr&&(kr=ei(tr,ut,ze-nr,ze+Fr,1,rr.minY,rr.maxY,Bt),gi=ei(tr,ut,ze+We,ze+Cr,1,rr.minY,rr.maxY,Bt),tr=null),Ur&&(Gt=ei(Ur,ut,ze-nr,ze+Fr,1,rr.minY,rr.maxY,Bt),dr=ei(Ur,ut,ze+We,ze+Cr,1,rr.minY,rr.maxY,Bt),Ur=null),Mt>1&&console.timeEnd("clipping"),it.push(kr||[],ge+1,2*ce,2*ze),it.push(gi||[],ge+1,2*ce,2*ze+1),it.push(Gt||[],ge+1,2*ce+1,2*ze),it.push(dr||[],ge+1,2*ce+1,2*ze+1)}}getTile(de,ge,ce){de=+de,ge=+ge,ce=+ce;let ze=this.options,{extent:Ye,debug:Ke}=ze;if(de<0||de>24)return null;let dt=1<<de,it=Er(de,ge=ge+dt&dt-1,ce);if(this.tiles[it])return Aa(this.tiles[it],Ye);Ke>1&&console.log("drilling down to z%d-%d-%d",de,ge,ce);let Bt,Mt=de,ut=ge,zt=ce;for(;!Bt&&Mt>0;)Mt--,ut>>=1,zt>>=1,Bt=this.tiles[Er(Mt,ut,zt)];return Bt&&Bt.source?(Ke>1&&(console.log("found parent tile z%d-%d-%d",Mt,ut,zt),console.time("drilling down")),this.splitTile(Bt.source,Mt,ut,zt,de,ge,ce),Ke>1&&console.timeEnd("drilling down"),this.tiles[it]?Aa(this.tiles[it],Ye):null):null}}function Er(st,de,ge){return 32*((1<<st)*ge+de)+st}function ai(st,de){return de?st.properties[de]:st.id}function Mr(st,de){if(st==null)return!0;if(st.type==="Feature")return ai(st,de)!=null;if(st.type==="FeatureCollection"){let ge=new Set;for(let ce of st.features){let ze=ai(ce,de);if(ze==null||ge.has(ze))return!1;ge.add(ze)}return!0}return!1}function Xi(st,de){let ge=new Map;if(st!=null)if(st.type==="Feature")ge.set(ai(st,de),st);else for(let ce of st.features)ge.set(ai(ce,de),ce);return ge}class uo extends p{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(de,ge){return n._(this,void 0,void 0,function*(){let ce=de.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let ze=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ze)return null;let Ye=new re(ze.features),Ke=Je(Ye);return Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),{vectorTile:Ye,rawData:Ke.buffer}})}loadData(de){return n._(this,void 0,void 0,function*(){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.abort();let ce=!!(de&&de.request&&de.request.collectResourceTiming)&&new n.cA(de.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(de,this._pendingRequest),this._geoJSONIndex=de.cluster?new ve(function({superclusterOptions:Ke,clusterProperties:dt}){if(!dt||!Ke)return Ke;let it={},Bt={},Mt={accumulated:null,zoom:0},ut={properties:null},zt=Object.keys(dt);for(let rr of zt){let[nr,We]=dt[rr],Fr=n.cH(We),Cr=n.cH(typeof nr=="string"?[nr,["accumulated"],["get",rr]]:nr);it[rr]=Fr.value,Bt[rr]=Cr.value}return Ke.map=rr=>{ut.properties=rr;let nr={};for(let We of zt)nr[We]=it[We].evaluate(Mt,ut);return nr},Ke.reduce=(rr,nr)=>{ut.properties=nr;for(let We of zt)Mt.accumulated=rr[We],rr[We]=Bt[We].evaluate(Mt,ut)},Ke}(de)).load((yield this._pendingData).features):(ze=yield this._pendingData,new kt(ze,de.geojsonVtOptions)),this.loaded={};let Ye={};if(ce){let Ke=ce.finish();Ke&&(Ye.resourceTiming={},Ye.resourceTiming[de.source]=JSON.parse(JSON.stringify(Ke)))}return Ye}catch(Ye){if(delete this._pendingRequest,n.cl(Ye))return{abandoned:!0};throw Ye}var ze})}getData(){return n._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(de){let ge=this.loaded;return ge&&ge[de.uid]?super.reloadTile(de):this.loadTile(de)}loadAndProcessGeoJSON(de,ge){return n._(this,void 0,void 0,function*(){let ce=yield this.loadGeoJSON(de,ge);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`);if(j(ce,!0),de.filter){let ze=n.cH(de.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(Ke=>ze.value.evaluate({zoom:0},Ke))}}return ce})}loadGeoJSON(de,ge){return n._(this,void 0,void 0,function*(){let{promoteId:ce}=de;if(de.request){let ze=yield n.j(de.request,ge);return this._dataUpdateable=Mr(ze.data,ce)?Xi(ze.data,ce):void 0,ze.data}if(typeof de.data=="string")try{let ze=JSON.parse(de.data);return this._dataUpdateable=Mr(ze,ce)?Xi(ze,ce):void 0,ze}catch{throw new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`)}if(!de.dataDiff)throw new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${de.source}`);return function(ze,Ye,Ke){var dt,it,Bt,Mt;if(Ye.removeAll&&ze.clear(),Ye.remove)for(let ut of Ye.remove)ze.delete(ut);if(Ye.add)for(let ut of Ye.add){let zt=ai(ut,Ke);zt!=null&&ze.set(zt,ut)}if(Ye.update)for(let ut of Ye.update){let zt=ze.get(ut.id);if(zt==null)continue;let rr=!ut.removeAllProperties&&(((dt=ut.removeProperties)===null||dt===void 0?void 0:dt.length)>0||((it=ut.addOrUpdateProperties)===null||it===void 0?void 0:it.length)>0);if((ut.newGeometry||ut.removeAllProperties||rr)&&(zt=Object.assign({},zt),ze.set(ut.id,zt),rr&&(zt.properties=Object.assign({},zt.properties))),ut.newGeometry&&(zt.geometry=ut.newGeometry),ut.removeAllProperties)zt.properties={};else if(((Bt=ut.removeProperties)===null||Bt===void 0?void 0:Bt.length)>0)for(let nr of ut.removeProperties)Object.prototype.hasOwnProperty.call(zt.properties,nr)&&delete zt.properties[nr];if(((Mt=ut.addOrUpdateProperties)===null||Mt===void 0?void 0:Mt.length)>0)for(let{key:nr,value:We}of ut.addOrUpdateProperties)zt.properties[nr]=We}}(this._dataUpdateable,de.dataDiff,ce),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(de){return n._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(de){return this._geoJSONIndex.getClusterExpansionZoom(de.clusterId)}getClusterChildren(de){return this._geoJSONIndex.getChildren(de.clusterId)}getClusterLeaves(de){return this._geoJSONIndex.getLeaves(de.clusterId,de.limit,de.offset)}}class zn{constructor(de){this.self=de,this.actor=new n.H(de),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ge,ce)=>{if(this.externalWorkerSourceTypes[ge])throw new Error(`Worker source with name "${ge}" already registered.`);this.externalWorkerSourceTypes[ge]=ce},this.self.addProtocol=n.cn,this.self.removeProtocol=n.co,this.self.registerRTLTextPlugin=ge=>{n.cI.setMethods(ge)},this.actor.registerMessageHandler("LDT",(ge,ce)=>this._getDEMWorkerSource(ge,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RDT",(ge,ce)=>n._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ge,ce.source).removeTile(ce)})),this.actor.registerMessageHandler("GCEZ",(ge,ce)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,ce.type,ce.source).getClusterExpansionZoom(ce)})),this.actor.registerMessageHandler("GCC",(ge,ce)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,ce.type,ce.source).getClusterChildren(ce)})),this.actor.registerMessageHandler("GCL",(ge,ce)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,ce.type,ce.source).getClusterLeaves(ce)})),this.actor.registerMessageHandler("LD",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).loadData(ce)),this.actor.registerMessageHandler("GD",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).getData()),this.actor.registerMessageHandler("LT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).reloadTile(ce)),this.actor.registerMessageHandler("AT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).abortTile(ce)),this.actor.registerMessageHandler("RMT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).removeTile(ce)),this.actor.registerMessageHandler("RS",(ge,ce)=>n._(this,void 0,void 0,function*(){if(!this.workerSources[ge]||!this.workerSources[ge][ce.type]||!this.workerSources[ge][ce.type][ce.source])return;let ze=this.workerSources[ge][ce.type][ce.source];delete this.workerSources[ge][ce.type][ce.source],ze.removeSource!==void 0&&ze.removeSource(ce)})),this.actor.registerMessageHandler("RM",ge=>n._(this,void 0,void 0,function*(){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge]})),this.actor.registerMessageHandler("SR",(ge,ce)=>n._(this,void 0,void 0,function*(){this.referrer=ce})),this.actor.registerMessageHandler("SRPS",(ge,ce)=>this._syncRTLPluginState(ge,ce)),this.actor.registerMessageHandler("IS",(ge,ce)=>n._(this,void 0,void 0,function*(){this.self.importScripts(ce)})),this.actor.registerMessageHandler("SI",(ge,ce)=>this._setImages(ge,ce)),this.actor.registerMessageHandler("UL",(ge,ce)=>n._(this,void 0,void 0,function*(){this._getLayerIndex(ge).update(ce.layers,ce.removedIds)})),this.actor.registerMessageHandler("SL",(ge,ce)=>n._(this,void 0,void 0,function*(){this._getLayerIndex(ge).replace(ce)}))}_setImages(de,ge){return n._(this,void 0,void 0,function*(){this.availableImages[de]=ge;for(let ce in this.workerSources[de]){let ze=this.workerSources[de][ce];for(let Ye in ze)ze[Ye].availableImages=ge}})}_syncRTLPluginState(de,ge){return n._(this,void 0,void 0,function*(){return yield n.cI.syncState(ge,this.self.importScripts)})}_getAvailableImages(de){let ge=this.availableImages[de];return ge||(ge=[]),ge}_getLayerIndex(de){let ge=this.layerIndexes[de];return ge||(ge=this.layerIndexes[de]=new o),ge}_getWorkerSource(de,ge,ce){if(this.workerSources[de]||(this.workerSources[de]={}),this.workerSources[de][ge]||(this.workerSources[de][ge]={}),!this.workerSources[de][ge][ce]){let ze={sendAsync:(Ye,Ke)=>(Ye.targetMapId=de,this.actor.sendAsync(Ye,Ke))};switch(ge){case"vector":this.workerSources[de][ge][ce]=new p(ze,this._getLayerIndex(de),this._getAvailableImages(de));break;case"geojson":this.workerSources[de][ge][ce]=new uo(ze,this._getLayerIndex(de),this._getAvailableImages(de));break;default:this.workerSources[de][ge][ce]=new this.externalWorkerSourceTypes[ge](ze,this._getLayerIndex(de),this._getAvailableImages(de))}}return this.workerSources[de][ge][ce]}_getDEMWorkerSource(de,ge){return this.demWorkerSources[de]||(this.demWorkerSources[de]={}),this.demWorkerSources[de][ge]||(this.demWorkerSources[de][ge]=new x),this.demWorkerSources[de][ge]}}return n.i(self)&&(self.worker=new zn(self)),zn}),r("index",["exports","./shared"],function(n,o){"use strict";var a="5.3.1";function c(){var C=new o.A(4);return o.A!=Float32Array&&(C[1]=0,C[2]=0),C[0]=1,C[3]=1,C}let h,p,x={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(C,s,u){let _=requestAnimationFrame(S=>{v(),s(S)}),{unsubscribe:v}=o.s(C.signal,"abort",()=>{v(),cancelAnimationFrame(_),u(o.c())},!1)},frameAsync(C){return new Promise((s,u)=>{this.frame(C,s,u)})},getImageData(C,s=0){return this.getImageCanvasContext(C).getImageData(-s,-s,C.width+2*s,C.height+2*s)},getImageCanvasContext(C){let s=window.document.createElement("canvas"),u=s.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return s.width=C.width,s.height=C.height,u.drawImage(C,0,0,C.width,C.height),u},resolveURL:C=>(h||(h=document.createElement("a")),h.href=C,h.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(p==null&&(p=matchMedia("(prefers-reduced-motion: reduce)")),p.matches)}};class T{static testProp(s){if(!T.docStyle)return s[0];for(let u=0;u<s.length;u++)if(s[u]in T.docStyle)return s[u];return s[0]}static create(s,u,_){let v=window.document.createElement(s);return u!==void 0&&(v.className=u),_&&_.appendChild(v),v}static createNS(s,u){return window.document.createElementNS(s,u)}static disableDrag(){T.docStyle&&T.selectProp&&(T.userSelect=T.docStyle[T.selectProp],T.docStyle[T.selectProp]="none")}static enableDrag(){T.docStyle&&T.selectProp&&(T.docStyle[T.selectProp]=T.userSelect)}static setTransform(s,u){s.style[T.transformProp]=u}static addEventListener(s,u,_,v={}){s.addEventListener(u,_,"passive"in v?v:v.capture)}static removeEventListener(s,u,_,v={}){s.removeEventListener(u,_,"passive"in v?v:v.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",T.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",T.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",T.suppressClickInternal,!0)},0)}static getScale(s){let u=s.getBoundingClientRect();return{x:u.width/s.offsetWidth||1,y:u.height/s.offsetHeight||1,boundingClientRect:u}}static getPoint(s,u,_){let v=u.boundingClientRect;return new o.P((_.clientX-v.left)/u.x-s.clientLeft,(_.clientY-v.top)/u.y-s.clientTop)}static mousePos(s,u){let _=T.getScale(s);return T.getPoint(s,_,u)}static touchPos(s,u){let _=[],v=T.getScale(s);for(let S=0;S<u.length;S++)_.push(T.getPoint(s,v,u[S]));return _}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}static sanitize(s){let u=new DOMParser().parseFromString(s,"text/html").body||document.createElement("body"),_=u.querySelectorAll("script");for(let v of _)v.remove();return T.clean(u),u.innerHTML}static isPossiblyDangerous(s,u){let _=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(s)||!_.includes("javascript:")&&!_.includes("data:"))||!!s.startsWith("on")||void 0}static clean(s){let u=s.children;for(let _ of u)T.removeAttributes(_),T.clean(_)}static removeAttributes(s){for(let{name:u,value:_}of s.attributes)T.isPossiblyDangerous(u,_)&&s.removeAttribute(u)}}T.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,T.selectProp=T.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),T.transformProp=T.testProp(["transform","WebkitTransform"]);let R={supported:!1,testSupport:function(C){!q&&j&&(Z?re(C):k=C)}},k,j,q=!1,Z=!1;function re(C){let s=C.createTexture();C.bindTexture(C.TEXTURE_2D,s);try{if(C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,j),C.isContextLost())return;R.supported=!0}catch{}C.deleteTexture(s),q=!0}var ee;typeof document<"u"&&(j=document.createElement("img"),j.onload=()=>{k&&re(k),k=null,Z=!0},j.onerror=()=>{q=!0,k=null},j.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(C){let s,u,_,v;C.resetRequestQueue=()=>{s=[],u=0,_=0,v={}},C.addThrottleControl=V=>{let H=_++;return v[H]=V,H},C.removeThrottleControl=V=>{delete v[V],O()},C.getImage=(V,H,K=!0)=>new Promise((ne,ie)=>{R.supported&&(V.headers||(V.headers={}),V.headers.accept="image/webp,*/*"),o.e(V,{type:"image"}),s.push({abortController:H,requestParameters:V,supportImageRefresh:K,state:"queued",onError:fe=>{ie(fe)},onSuccess:fe=>{ne(fe)}}),O()});let S=V=>o._(this,void 0,void 0,function*(){V.state="running";let{requestParameters:H,supportImageRefresh:K,onError:ne,onSuccess:ie,abortController:fe}=V,Ae=K===!1&&!o.i(self)&&!o.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((Pe,Fe)=>Pe&&Fe==="accept",!0));u++;let Ie=Ae?z(H,fe):o.m(H,fe);try{let Pe=yield Ie;delete V.abortController,V.state="completed",Pe.data instanceof HTMLImageElement||o.b(Pe.data)?ie(Pe):Pe.data&&ie({data:yield(Ce=Pe.data,typeof createImageBitmap=="function"?o.f(Ce):o.h(Ce)),cacheControl:Pe.cacheControl,expires:Pe.expires})}catch(Pe){delete V.abortController,ne(Pe)}finally{u--,O()}var Ce}),O=()=>{let V=(()=>{for(let H of Object.keys(v))if(v[H]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=u;H<V&&s.length>0;H++){let K=s.shift();K.abortController.signal.aborted?H--:S(K)}},z=(V,H)=>new Promise((K,ne)=>{let ie=new Image,fe=V.url,Ae=V.credentials;Ae&&Ae==="include"?ie.crossOrigin="use-credentials":(Ae&&Ae==="same-origin"||!o.d(fe))&&(ie.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{ie.src="",ne(o.c())}),ie.fetchPriority="high",ie.onload=()=>{ie.onerror=ie.onload=null,K({data:ie})},ie.onerror=()=>{ie.onerror=ie.onload=null,H.signal.aborted||ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ie.src=fe})}(ee||(ee={})),ee.resetRequestQueue();class se{constructor(s){this._transformRequestFn=s}transformRequest(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function me(C){let s=[];if(typeof C=="string")s.push({id:"default",url:C});else if(C&&C.length>0){let u=[];for(let{id:_,url:v}of C){let S=`${_}${v}`;u.indexOf(S)===-1&&(u.push(S),s.push({id:_,url:v}))}}return s}function Le(C,s,u){try{let _=new URL(C);return _.pathname+=`${s}${u}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${C}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class je{constructor(s,u,_,v){this.context=s,this.format=_,this.texture=s.gl.createTexture(),this.update(u,v)}update(s,u,_){let{width:v,height:S}=s,O=!(this.size&&this.size[0]===v&&this.size[1]===S||_),{context:z}=this,{gl:V}=z;if(this.useMipmap=!!(u&&u.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),z.pixelStoreUnpackFlipY.set(!1),z.pixelStoreUnpack.set(1),z.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!u||u.premultiply!==!1)),O)this.size=[v,S],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.b(s)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,s):V.texImage2D(V.TEXTURE_2D,0,this.format,v,S,0,this.format,V.UNSIGNED_BYTE,s.data);else{let{x:H,y:K}=_||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.b(s)?V.texSubImage2D(V.TEXTURE_2D,0,H,K,V.RGBA,V.UNSIGNED_BYTE,s):V.texSubImage2D(V.TEXTURE_2D,0,H,K,v,S,V.RGBA,V.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D),z.pixelStoreUnpackFlipY.setDefault(),z.pixelStoreUnpack.setDefault(),z.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(s,u,_){let{context:v}=this,{gl:S}=v;S.bindTexture(S.TEXTURE_2D,this.texture),_!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=S.LINEAR),s!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,s),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,_||s),this.filter=s),u!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,u),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Je(C){let{userImage:s}=C;return!!(s&&s.render&&s.render())&&(C.data.replace(new Uint8Array(s.data.buffer)),!0)}class J extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(let{ids:u,promiseResolve:_}of this.requestors)_(this._getImagesForIds(u));this.requestors=[]}}getImage(s){let u=this.images[s];if(u&&!u.data&&u.spriteData){let _=u.spriteData;u.data=new o.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),u.spriteData=null}return u}addImage(s,u){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,u)&&(this.images[s]=u)}_validate(s,u){let _=!0,v=u.data||u.spriteData;return this._validateStretch(u.stretchX,v&&v.width)||(this.fire(new o.k(new Error(`Image "${s}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,v&&v.height)||(this.fire(new o.k(new Error(`Image "${s}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new o.k(new Error(`Image "${s}" has invalid "content" value`))),_=!1),_}_validateStretch(s,u){if(!s)return!0;let _=0;for(let v of s){if(v[0]<_||v[1]<v[0]||u<v[1])return!1;_=v[1]}return!0}_validateContent(s,u){if(!s)return!0;if(s.length!==4)return!1;let _=u.spriteData,v=_&&_.width||u.data.width,S=_&&_.height||u.data.height;return!(s[0]<0||v<s[0]||s[1]<0||S<s[1]||s[2]<0||v<s[2]||s[3]<0||S<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,u,_=!0){let v=this.getImage(s);if(_&&(v.data.width!==u.data.width||v.data.height!==u.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=v.version+1,this.images[s]=u,this.updatedImages[s]=!0}removeImage(s){let u=this.images[s];delete this.images[s],delete this.patterns[s],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((u,_)=>{let v=!0;if(!this.isLoaded())for(let S of s)this.images[S]||(v=!1);this.isLoaded()||v?u(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:u})})}_getImagesForIds(s){let u={};for(let _ of s){let v=this.getImage(_);v||(this.fire(new o.l("styleimagemissing",{id:_})),v=this.getImage(_)),v?u[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,textFitWidth:v.textFitWidth,textFitHeight:v.textFitHeight,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:o.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){let{width:s,height:u}=this.atlasImage;return{width:s,height:u}}getPattern(s){let u=this.patterns[s],_=this.getImage(s);if(!_)return null;if(u&&u.position.version===_.version)return u.position;if(u)u.position.version=_.version;else{let v={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new o.I(v,_);this.patterns[s]={bin:v,position:S}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){let u=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new je(s,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){let s=[];for(let S in this.patterns)s.push(this.patterns[S].bin);let{w:u,h:_}=o.p(s),v=this.atlasImage;v.resize({width:u||1,height:_||1});for(let S in this.patterns){let{bin:O}=this.patterns[S],z=O.x+1,V=O.y+1,H=this.getImage(S).data,K=H.width,ne=H.height;o.R.copy(H,v,{x:0,y:0},{x:z,y:V},{width:K,height:ne}),o.R.copy(H,v,{x:0,y:ne-1},{x:z,y:V-1},{width:K,height:1}),o.R.copy(H,v,{x:0,y:0},{x:z,y:V+ne},{width:K,height:1}),o.R.copy(H,v,{x:K-1,y:0},{x:z-1,y:V},{width:1,height:ne}),o.R.copy(H,v,{x:0,y:0},{x:z+K,y:V},{width:1,height:ne})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(let u of s){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;let _=this.getImage(u);_||o.w(`Image with ID: "${u}" was not found`),Je(_)&&this.updateImage(u,_)}}}let te=1e20;function X(C,s,u,_,v,S,O,z,V){for(let H=s;H<s+_;H++)ye(C,u*S+H,S,v,O,z,V);for(let H=u;H<u+v;H++)ye(C,H*S+s,1,_,O,z,V)}function ye(C,s,u,_,v,S,O){S[0]=0,O[0]=-1e20,O[1]=te,v[0]=C[s];for(let z=1,V=0,H=0;z<_;z++){v[z]=C[s+z*u];let K=z*z;do{let ne=S[V];H=(v[z]-v[ne]+K-ne*ne)/(z-ne)/2}while(H<=O[V]&&--V>-1);V++,S[V]=z,O[V]=H,O[V+1]=te}for(let z=0,V=0;z<_;z++){for(;O[V+1]<z;)V++;let H=S[V],K=z-H;C[s+z*u]=v[H]+K*K}}class _e{constructor(s,u){this.requestManager=s,this.localIdeographFontFamily=u,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return o._(this,void 0,void 0,function*(){let u=[];for(let S in s)for(let O of s[S])u.push(this._getAndCacheGlyphsPromise(S,O));let _=yield Promise.all(u),v={};for(let{stack:S,id:O,glyph:z}of _)v[S]||(v[S]={}),v[S][O]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics};return v})}_getAndCacheGlyphsPromise(s,u){return o._(this,void 0,void 0,function*(){let _=this.entries[s];_||(_=this.entries[s]={glyphs:{},requests:{},ranges:{}});let v=_.glyphs[u];if(v!==void 0)return{stack:s,id:u,glyph:v};if(v=this._tinySDF(_,s,u),v)return _.glyphs[u]=v,{stack:s,id:u,glyph:v};let S=Math.floor(u/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[S])return{stack:s,id:u,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[S]){let z=_e.loadGlyphRange(s,S,this.url,this.requestManager);_.requests[S]=z}let O=yield _.requests[S];for(let z in O)this._doesCharSupportLocalGlyph(+z)||(_.glyphs[+z]=O[+z]);return _.ranges[S]=!0,{stack:s,id:u,glyph:O[u]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(s))||o.u["CJK Unified Ideographs"](s)||o.u["Hangul Syllables"](s)||o.u.Hiragana(s)||o.u.Katakana(s)||o.u["CJK Symbols and Punctuation"](s)||o.u["Halfwidth and Fullwidth Forms"](s))}_tinySDF(s,u,_){let v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(_))return;let S=s.tinySDF;if(!S){let z="400";/bold/i.test(u)?z="900":/medium/i.test(u)?z="500":/light/i.test(u)&&(z="200"),S=s.tinySDF=new _e.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:z})}let O=S.draw(String.fromCharCode(_));return{id:_,bitmap:new o.q({width:O.width||60,height:O.height||60},O.data),metrics:{width:O.glyphWidth/2||24,height:O.glyphHeight/2||24,left:O.glyphLeft/2+.5||0,top:O.glyphTop/2-27.5||-8,advance:O.glyphAdvance/2||24,isDoubleResolution:!0}}}}_e.loadGlyphRange=function(C,s,u,_){return o._(this,void 0,void 0,function*(){let v=256*s,S=v+255,O=_.transformRequest(u.replace("{fontstack}",C).replace("{range}",`${v}-${S}`),"Glyphs"),z=yield o.n(O,new AbortController);if(!z||!z.data)throw new Error(`Could not load glyph range. range: ${s}, ${v}-${S}`);let V={};for(let H of o.o(z.data))V[H.id]=H;return V})},_e.TinySDF=class{constructor({fontSize:C=24,buffer:s=3,radius:u=8,cutoff:_=.25,fontFamily:v="sans-serif",fontWeight:S="normal",fontStyle:O="normal"}={}){this.buffer=s,this.cutoff=_,this.radius=u;let z=this.size=C+4*s,V=this._createCanvas(z),H=this.ctx=V.getContext("2d",{willReadFrequently:!0});H.font=`${O} ${S} ${C}px ${v}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Uint16Array(z)}_createCanvas(C){let s=document.createElement("canvas");return s.width=s.height=C,s}draw(C){let{width:s,actualBoundingBoxAscent:u,actualBoundingBoxDescent:_,actualBoundingBoxLeft:v,actualBoundingBoxRight:S}=this.ctx.measureText(C),O=Math.ceil(u),z=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-v))),V=Math.min(this.size-this.buffer,O+Math.ceil(_)),H=z+2*this.buffer,K=V+2*this.buffer,ne=Math.max(H*K,0),ie=new Uint8ClampedArray(ne),fe={data:ie,width:H,height:K,glyphWidth:z,glyphHeight:V,glyphTop:O,glyphLeft:0,glyphAdvance:s};if(z===0||V===0)return fe;let{ctx:Ae,buffer:Ie,gridInner:Ce,gridOuter:Pe}=this;Ae.clearRect(Ie,Ie,z,V),Ae.fillText(C,Ie,Ie+O);let Fe=Ae.getImageData(Ie,Ie,z,V);Pe.fill(te,0,ne),Ce.fill(0,0,ne);for(let Ve=0;Ve<V;Ve++)for(let Be=0;Be<z;Be++){let qe=Fe.data[4*(Ve*z+Be)+3]/255;if(qe===0)continue;let Ge=(Ve+Ie)*H+Be+Ie;if(qe===1)Pe[Ge]=0,Ce[Ge]=te;else{let Ze=.5-qe;Pe[Ge]=Ze>0?Ze*Ze:0,Ce[Ge]=Ze<0?Ze*Ze:0}}X(Pe,0,0,H,K,H,this.f,this.v,this.z),X(Ce,Ie,Ie,z,V,H,this.f,this.v,this.z);for(let Ve=0;Ve<ne;Ve++){let Be=Math.sqrt(Pe[Ve])-Math.sqrt(Ce[Ve]);ie[Ve]=Math.round(255-255*(Be/this.radius+this.cutoff))}return fe}};class Oe{constructor(){this.specification=o.v.light.position}possiblyEvaluate(s,u){return o.z(s.expression.evaluate(u))}interpolate(s,u,_){return{x:o.B.number(s.x,u.x,_),y:o.B.number(s.y,u.y,_),z:o.B.number(s.z,u.z,_)}}}let ve;class De extends o.E{constructor(s){super(),ve=ve||new o.r({anchor:new o.D(o.v.light.anchor),position:new Oe,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(ve),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u={}){if(!this._validate(o.t,s,u))for(let _ in s){let v=s[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,_){return(!_||_.validate!==!1)&&o.x(this,s.call(o.y,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}let Xe=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class rt extends o.E{constructor(s){super(),this._transitionable=new o.T(Xe),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.C(0))}setSky(s,u={}){if(!this._validate(o.F,s,u)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let _ in s){let v=s[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,_={}){return _?.validate!==!1&&o.x(this,s.call(o.y,o.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class tt{constructor(s,u){this.width=s,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,u){let _=s.join(",")+String(u);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(s,u)),this.dashEntry[_]}getDashRanges(s,u,_){let v=[],S=s.length%2==1?-s[s.length-1]*_:0,O=s[0]*_,z=!0;v.push({left:S,right:O,isDash:z,zeroLength:s[0]===0});let V=s[0];for(let H=1;H<s.length;H++){z=!z;let K=s[H];S=V*_,V+=K,O=V*_,v.push({left:S,right:O,isDash:z,zeroLength:K===0})}return v}addRoundDash(s,u,_){let v=u/2;for(let S=-_;S<=_;S++){let O=this.width*(this.nextRow+_+S),z=0,V=s[z];for(let H=0;H<this.width;H++){H/V.right>1&&(V=s[++z]);let K=Math.abs(H-V.left),ne=Math.abs(H-V.right),ie=Math.min(K,ne),fe,Ae=S/_*(v+1);if(V.isDash){let Ie=v-Math.abs(Ae);fe=Math.sqrt(ie*ie+Ie*Ie)}else fe=v-Math.sqrt(ie*ie+Ae*Ae);this.data[O+H]=Math.max(0,Math.min(255,fe+128))}}}addRegularDash(s){for(let z=s.length-1;z>=0;--z){let V=s[z],H=s[z+1];V.zeroLength?s.splice(z,1):H&&H.isDash===V.isDash&&(H.left=V.left,s.splice(z,1))}let u=s[0],_=s[s.length-1];u.isDash===_.isDash&&(u.left=_.left-this.width,_.right=u.right+this.width);let v=this.width*this.nextRow,S=0,O=s[S];for(let z=0;z<this.width;z++){z/O.right>1&&(O=s[++S]);let V=Math.abs(z-O.left),H=Math.abs(z-O.right),K=Math.min(V,H);this.data[v+z]=Math.max(0,Math.min(255,(O.isDash?K:-K)+128))}}addDash(s,u){let _=u?7:0,v=2*_+1;if(this.nextRow+v>this.height)return o.w("LineAtlas out of space"),null;let S=0;for(let z=0;z<s.length;z++)S+=s[z];if(S!==0){let z=this.width/S,V=this.getDashRanges(s,this.width,z);u?this.addRoundDash(V,z,_):this.addRegularDash(V)}let O={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:S};return this.nextRow+=v,this.dirty=!0,O}bind(s){let u=s.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}let yt="maplibre_preloaded_worker_pool";class Xt{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Xt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yt]}numActive(){return Object.keys(this.active).length}}let jt=Math.floor(x.hardwareConcurrency/2),fr,qt;function Ot(){return fr||(fr=new Xt),fr}Xt.workerCount=o.G(globalThis)?Math.max(Math.min(jt,3),1):1;class Tr{constructor(s,u){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=u;let _=this.workerPool.acquire(u);for(let v=0;v<_.length;v++){let S=new o.H(_[v],u);S.name=`Worker ${v}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,u){let _=[];for(let v of this.actors)_.push(v.sendAsync({type:s,data:u}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,u){for(let _ of this.actors)_.registerMessageHandler(s,u)}}function Or(){return qt||(qt=new Tr(Ot(),o.J),qt.registerMessageHandler("GR",(C,s,u)=>o.m(s,u))),qt}function Dr(C,s){let u=o.K();return o.L(u,u,[1,1,0]),o.M(u,u,[.5*C.width,.5*C.height,1]),C.calculatePosMatrix?o.N(u,u,C.calculatePosMatrix(s.toUnwrapped())):u}function Xr(C,s,u,_,v,S,O){var z;let V=function(ie,fe,Ae){if(ie)for(let Ie of ie){let Ce=fe[Ie];if(Ce&&Ce.source===Ae&&Ce.type==="fill-extrusion")return!0}else for(let Ie in fe){let Ce=fe[Ie];if(Ce.source===Ae&&Ce.type==="fill-extrusion")return!0}return!1}((z=v?.layers)!==null&&z!==void 0?z:null,s,C.id),H=S.maxPitchScaleFactor(),K=C.tilesIn(_,H,V);K.sort(ki);let ne=[];for(let ie of K)ne.push({wrappedTileID:ie.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(s,u,C._state,ie.queryGeometry,ie.cameraQueryGeometry,ie.scale,v,S,H,Dr(C.transform,ie.tileID),O?(fe,Ae)=>O(ie.tileID,fe,Ae):void 0)});return function(ie,fe){for(let Ae in ie)for(let Ie of ie[Ae])ei(Ie,fe);return ie}(function(ie){let fe={},Ae={};for(let Ie of ie){let Ce=Ie.queryResults,Pe=Ie.wrappedTileID,Fe=Ae[Pe]=Ae[Pe]||{};for(let Ve in Ce){let Be=Ce[Ve],qe=Fe[Ve]=Fe[Ve]||{},Ge=fe[Ve]=fe[Ve]||[];for(let Ze of Be)qe[Ze.featureIndex]||(qe[Ze.featureIndex]=!0,Ge.push(Ze))}}return fe}(ne),C)}function ki(C,s){let u=C.tileID,_=s.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}function ei(C,s){let u=C.feature,_=s.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=_}function Oi(C,s,u){return o._(this,void 0,void 0,function*(){let _=C;if(C.url?_=(yield o.j(s.transformRequest(C.url,"Source"),u)).data:yield x.frameAsync(u),!_)return null;let v=o.O(o.e(_,C),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(v.vectorLayerIds=_.vector_layers.map(S=>S.id)),v})}class ui{constructor(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof o.Q?new o.Q(s.lng,s.lat):o.Q.convert(s),this}setSouthWest(s){return this._sw=s instanceof o.Q?new o.Q(s.lng,s.lat):o.Q.convert(s),this}extend(s){let u=this._sw,_=this._ne,v,S;if(s instanceof o.Q)v=s,S=s;else{if(!(s instanceof ui))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(ui.convert(s)):this.extend(o.Q.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(o.Q.convert(s)):this;if(v=s._sw,S=s._ne,!v||!S)return this}return u||_?(u.lng=Math.min(v.lng,u.lng),u.lat=Math.min(v.lat,u.lat),_.lng=Math.max(S.lng,_.lng),_.lat=Math.max(S.lat,_.lat)):(this._sw=new o.Q(v.lng,v.lat),this._ne=new o.Q(S.lng,S.lat)),this}getCenter(){return new o.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.Q(this.getWest(),this.getNorth())}getSouthEast(){return new o.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){let{lng:u,lat:_}=o.Q.convert(s),v=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&v}static convert(s){return s instanceof ui?s:s&&new ui(s)}static fromLngLat(s,u=0){let _=360*u/40075017,v=_/Math.cos(Math.PI/180*s.lat);return new ui(new o.Q(s.lng-v,s.lat-_),new o.Q(s.lng+v,s.lat+_))}adjustAntiMeridian(){let s=new o.Q(this._sw.lng,this._sw.lat),u=new o.Q(this._ne.lng,this._ne.lat);return new ui(s,s.lng>u.lng?new o.Q(u.lng+360,u.lat):u)}}class tn{constructor(s,u,_){this.bounds=ui.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){let u=Math.pow(2,s.z),_=Math.floor(o.U(this.bounds.getWest())*u),v=Math.floor(o.S(this.bounds.getNorth())*u),S=Math.ceil(o.U(this.bounds.getEast())*u),O=Math.ceil(o.S(this.bounds.getSouth())*u);return s.x>=_&&s.x<S&&s.y>=v&&s.y<O}}class Ni extends o.E{constructor(s,u,_,v){if(super(),this.id=s,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.O(u,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let s=yield Oi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(o.e(this,s),s.bounds&&(this.tileBounds=new tn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new o.k(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(s){return o._(this,void 0,void 0,function*(){let u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(u,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};_.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((S,O)=>{s.reloadPromise={resolve:S,reject:O}})}else s.actor=this.dispatcher.getActor(),v="LT";s.abortController=new AbortController;try{let S=yield s.actor.sendAsync({type:v,data:_},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,S)}catch(S){if(delete s.abortController,s.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,u){if(u&&u.resourceTiming&&(s.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&s.setExpiryData(u),s.loadVectorData(u,this.map.painter),s.reloadPromise){let _=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(_.resolve).catch(_.reject)}}abortTile(s){return o._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return o._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class si extends o.E{constructor(s,u,_,v){super(),this.id=s,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},u),o.e(this,o.O(u,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(s=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let u=yield Oi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(o.e(this,u),u.bounds&&(this.tileBounds=new tn(u.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:s})))}catch(u){this._tileJSONRequest=null,this.fire(new o.k(u))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load(!0)}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return o.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return o._(this,void 0,void 0,function*(){let u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{let _=yield ee.getImage(this.map._requestManager.transformRequest(u,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&s.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});let v=this.map.painter.context,S=v.gl,O=_.data;s.texture=this.map.painter.getTileTexture(O.width),s.texture?s.texture.update(O,{useMipmap:!0}):(s.texture=new je(v,O,S.RGBA,{useMipmap:!0}),s.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(_){if(delete s.abortController,s.aborted)s.state="unloaded";else if(_)throw s.state="errored",_}})}abortTile(s){return o._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return o._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class Es extends si{constructor(s,u,_,v){super(s,u,_,v),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(s){return o._(this,void 0,void 0,function*(){let u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(u,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{let v=yield ee.getImage(_,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(v&&v.data){let S=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&s.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});let O=o.b(S)&&o.V()?S:yield this.readImageNow(S),z={type:this.type,uid:s.uid,source:this.id,rawImageData:O,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();let V=yield s.actor.sendAsync({type:"LDT",data:z});s.dem=V,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(v){if(delete s.abortController,s.aborted)s.state="unloaded";else if(v)throw s.state="errored",v}})}readImageNow(s){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.W()){let u=s.width+2,_=s.height+2;try{return new o.R({width:u,height:_},yield o.X(s,-1,-1,u,_))}catch{}}return x.getImageData(s,1)})}_getNeighboringTiles(s){let u=s.canonical,_=Math.pow(2,u.z),v=(u.x-1+_)%_,S=u.x===0?s.wrap-1:s.wrap,O=(u.x+1+_)%_,z=u.x+1===_?s.wrap+1:s.wrap,V={};return V[new o.Y(s.overscaledZ,S,u.z,v,u.y).key]={backfilled:!1},V[new o.Y(s.overscaledZ,z,u.z,O,u.y).key]={backfilled:!1},u.y>0&&(V[new o.Y(s.overscaledZ,S,u.z,v,u.y-1).key]={backfilled:!1},V[new o.Y(s.overscaledZ,s.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},V[new o.Y(s.overscaledZ,z,u.z,O,u.y-1).key]={backfilled:!1}),u.y+1<_&&(V[new o.Y(s.overscaledZ,S,u.z,v,u.y+1).key]={backfilled:!1},V[new o.Y(s.overscaledZ,s.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},V[new o.Y(s.overscaledZ,z,u.z,O,u.y+1).key]={backfilled:!1}),V}unloadTile(s){return o._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class Zo extends o.E{constructor(s,u,_,v){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(v),this._data=u.data,this._options=o.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:o.Z,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.Z,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(s){return s*(o.Z/this.tileSize)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}getData(){return o._(this,void 0,void 0,function*(){let s=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})})}getCoordinatesFromGeometry(s){return s.type==="GeometryCollection"?s.geometries.map(u=>u.coordinates).flat(1/0):s.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){let s=new ui,u=yield this.getData(),_;switch(u.type){case"FeatureCollection":_=u.features.map(v=>this.getCoordinatesFromGeometry(v.geometry)).flat(1/0);break;case"Feature":_=this.getCoordinatesFromGeometry(u.geometry);break;default:_=this.getCoordinatesFromGeometry(u)}if(_.length==0)return s;for(let v=0;v<_.length-1;v+=2)s.extend([_[v],_[v+1]]);return s})}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(s.clusterRadius)),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,u,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:u,offset:_}})}_updateWorkerData(s){return o._(this,void 0,void 0,function*(){let u=o.e({type:this.type},this.workerOptions);s?u.dataDiff=s:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(x.resolveURL(this._data),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.l("dataloading",{dataType:"source"}));try{let _=yield this.actor.sendAsync({type:"LD",data:u});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));let v=null;_.resourceTiming&&_.resourceTiming[this.id]&&(v=_.resourceTiming[this.id].slice(0));let S={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&o.e(S,{resourceTiming:v}),this.fire(new o.l("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(_))}})}loaded(){return this._pendingLoads===0}loadTile(s){return o._(this,void 0,void 0,function*(){let u=s.actor?"RT":"LT";s.actor=this.actor;let _={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};s.abortController=new AbortController;let v=yield this.actor.sendAsync({type:u,data:_},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(v,this.map.painter,u==="RT")})}abortTile(s){return o._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return o._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class co extends o.E{constructor(s,u,_,v){super(),this.flippedWindingOrder=!1,this.id=s,this.dispatcher=_,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(s){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let u=yield ee.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,s&&(this.coordinates=s),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new o.k(u))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;let u=s.map(o.$.fromLngLat);var _;return this.tileID=function(v){let S=1/0,O=1/0,z=-1/0,V=-1/0;for(let ie of v)S=Math.min(S,ie.x),O=Math.min(O,ie.y),z=Math.max(z,ie.x),V=Math.max(V,ie.y);let H=Math.max(z-S,V-O),K=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),ne=Math.pow(2,K);return new o.a1(K,Math.floor((S+z)/2*ne),Math.floor((O+V)/2*ne))}(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(v=>this.tileID.getTilePoint(v)._round()),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let s=this.map.painter.context,u=s.gl;this.texture||(this.texture=new je(s,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(let v in this.tiles){let S=this.tiles[v];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(s){let u=1/0,_=1/0,v=-1/0,S=-1/0;for(let z of s)u=Math.min(u,z.x),_=Math.min(_,z.y),v=Math.max(v,z.x),S=Math.max(S,z.y);let O={};for(let z=0;z<=o.a0;z++){let V=Math.pow(2,z),H=Math.floor(u*V),K=Math.floor(_*V),ne=Math.floor(v*V),ie=Math.floor(S*V);O[z]={minTileX:H,minTileY:K,maxTileX:ne,maxTileY:ie}}return O}}class Xo extends co{constructor(s,u,_,v){super(s,u,_,v),this.roundZoom=!0,this.type="video",this.options=u}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;let s=this.options;this.urls=[];for(let u of s.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{let u=yield o.a2(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new o.k(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){let u=this.video.seekable;s<u.start(0)||s>u.end(0)?this.fire(new o.k(new o.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let s=this.map.painter.context,u=s.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new je(s,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(let v in this.tiles){let S=this.tiles[v];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Aa extends co{constructor(s,u,_,v){super(s,u,_,v),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(O=>typeof O!="number"))||this.fire(new o.k(new o.a3(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a3(`sources.${s}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new o.k(new o.a3(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a3(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a3(`sources.${s}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let u=this.map.painter.context,_=u.gl;this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new je(u,this.canvas,_.RGBA,{premultiply:!0});let v=!1;for(let S in this.tiles){let O=this.tiles[S];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,v=!0)}v&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}let xo={},as=C=>{switch(C){case"geojson":return Zo;case"image":return co;case"raster":return si;case"raster-dem":return Es;case"vector":return Ni;case"video":return Xo;case"canvas":return Aa}return xo[C]},bo="RTLPluginLoaded";class jr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Or()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return o._(this,arguments,void 0,function*(u,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=x.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(bo))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Jt=null;function kt(){return Jt||(Jt=new jr),Jt}class Er{constructor(s,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=o.a4(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){let u=s+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,u,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(v,S){let O={};if(!S)return O;for(let z of v){let V=z.layerIds.map(H=>S.getLayer(H)).filter(Boolean);if(V.length!==0){z.layers=V,z.stateDependentLayerIds&&(z.stateDependentLayers=z.stateDependentLayerIds.map(H=>V.filter(K=>K.id===H)[0]));for(let H of V)O[H.id]=z}}return O}(s.buckets,u?.style),this.hasSymbolBuckets=!1;for(let v in this.buckets){let S=this.buckets[v];if(S instanceof o.a6){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let v in this.buckets){let S=this.buckets[v];if(S instanceof o.a6&&S.hasRTLText){this.hasRTLText=!0,kt().lazyLoad();break}}this.queryPadding=0;for(let v in this.buckets){let S=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(v).queryRadius(S))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new o.a5}unloadVectorData(){for(let s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(let _ in this.buckets){let v=this.buckets[_];v.uploadPending()&&v.upload(s)}let u=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new je(s,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new je(s,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,u,_,v,S,O,z,V,H,K,ne){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:S,scale:O,tileSize:this.tileSize,pixelPosMatrix:K,transform:V,params:z,queryPadding:this.queryPadding*H,getElevation:ne},s,u,_):{}}querySourceFeatures(s,u){let _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;let v=_.loadVTLayers(),S=u&&u.sourceLayer?u.sourceLayer:"",O=v._geojsonTileLayer||v[S];if(!O)return;let z=o.a7(u&&u.filter),{z:V,x:H,y:K}=this.tileID.canonical,ne={z:V,x:H,y:K};for(let ie=0;ie<O.length;ie++){let fe=O.feature(ie);if(z.needGeometry){let Ce=o.a8(fe,!0);if(!z.filter(new o.C(this.tileID.overscaledZ),Ce,this.tileID.canonical))continue}else if(!z.filter(new o.C(this.tileID.overscaledZ),fe))continue;let Ae=_.getId(fe,S),Ie=new o.a9(fe,V,H,K,Ae);Ie.tile=ne,s.push(Ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){let u=this.expirationTime;if(s.cacheControl){let _=o.aa(s.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){let _=Date.now(),v=!1;if(this.expirationTime>_)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{let S=this.expirationTime-u;S?this.expirationTime=_+Math.max(S,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;let _=this.latestFeatureIndex.loadVTLayers();for(let v in this.buckets){if(!u.style.hasLayer(v))continue;let S=this.buckets[v],O=S.layers[0].sourceLayer||"_geojsonTileLayer",z=_[O],V=s[O];if(!z||!V||Object.keys(V).length===0)continue;S.update(V,z,this.imageAtlas&&this.imageAtlas.patternPositions||{});let H=u&&u.style&&u.style.getLayer(v);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<x.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=x.now()+s}setDependencies(s,u){let _={};for(let v of u)_[v]=!0;this.dependencies[s]=_}hasDependency(s,u){for(let _ of s){let v=this.dependencies[_];if(v){for(let S of u)if(v[S])return!0}}return!1}}class ai{constructor(s,u){this.max=s,this.onRemove=u,this.reset()}reset(){for(let s in this.data)for(let u of this.data[s])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(s,u,_){let v=s.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);let S={value:u,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout(()=>{this.remove(s,S)},_)),this.data[v].push(S),this.order.push(v),this.order.length>this.max){let O=this._getAndRemoveByKey(this.order[0]);O&&this.onRemove(O)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){let u=this.data[s].shift();return u.timeout&&clearTimeout(u.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),u.value}getByKey(s){let u=this.data[s];return u?u[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,u){if(!this.has(s))return this;let _=s.wrapped().key,v=u===void 0?0:this.data[_].indexOf(u),S=this.data[_][v];return this.data[_].splice(v,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){let u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(s){let u=[];for(let _ in this.data)for(let v of this.data[_])s(v.value)||u.push(v);for(let _ of u)this.remove(_.value.tileID,_)}}class Mr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,u,_){let v=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},o.e(this.stateChanges[s][v],_),this.deletedStates[s]===null){this.deletedStates[s]={};for(let S in this.state[s])S!==v&&(this.deletedStates[s][S]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][v]===null){this.deletedStates[s][v]={};for(let S in this.state[s][v])_[S]||(this.deletedStates[s][v][S]=null)}else for(let S in _)this.deletedStates[s]&&this.deletedStates[s][v]&&this.deletedStates[s][v][S]===null&&delete this.deletedStates[s][v][S]}removeFeatureState(s,u,_){if(this.deletedStates[s]===null)return;let v=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},_&&u!==void 0)this.deletedStates[s][v]!==null&&(this.deletedStates[s][v]=this.deletedStates[s][v]||{},this.deletedStates[s][v][_]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][v])for(_ in this.deletedStates[s][v]={},this.stateChanges[s][v])this.deletedStates[s][v][_]=null;else this.deletedStates[s][v]=null;else this.deletedStates[s]=null}getState(s,u){let _=String(u),v=o.e({},(this.state[s]||{})[_],(this.stateChanges[s]||{})[_]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){let S=this.deletedStates[s][u];if(S===null)return{};for(let O in S)delete v[O]}return v}initializeTileState(s,u){s.setFeatureState(this.state,u)}coalesceChanges(s,u){let _={};for(let v in this.stateChanges){this.state[v]=this.state[v]||{};let S={};for(let O in this.stateChanges[v])this.state[v][O]||(this.state[v][O]={}),o.e(this.state[v][O],this.stateChanges[v][O]),S[O]=this.state[v][O];_[v]=S}for(let v in this.deletedStates){this.state[v]=this.state[v]||{};let S={};if(this.deletedStates[v]===null)for(let O in this.state[v])S[O]={},this.state[v][O]={};else for(let O in this.deletedStates[v]){if(this.deletedStates[v][O]===null)this.state[v][O]={};else for(let z of Object.keys(this.deletedStates[v][O]))delete this.state[v][O][z];S[O]=this.state[v][O]}_[v]=_[v]||{},o.e(_[v],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(let v in s)s[v].setFeatureState(_,u)}}function Xi(C,s,u){let _=s.intersectsFrustum(C);if(!u)return _;let v=s.intersectsPlane(u);return _===0||v===0?0:_===2&&v===2?2:1}function uo(C,s,u,_,v){let S=C,O=Math.atan(s/u),z=Math.hypot(s,u);return S=C+o.ab(_/z/Math.max(.5,Math.cos(o.ad(v/2)))),S+=1*o.ab(Math.cos(O))/2,S+=o.ae(C-S,-0,0),S}function zn(C,s){let u=(s.roundZoom?Math.round:Math.floor)(C.zoom+o.ab(C.tileSize/s.tileSize));return Math.max(0,u)}function st(C,s){let u=C.getCameraFrustum(),_=C.getClippingPlane(),v=C.screenPointToMercatorCoordinate(C.getCameraPoint()),S=o.$.fromLngLat(C.center,C.elevation);v.z=S.z+Math.cos(C.pitchInRadians)*C.cameraToCenterDistance/C.worldSize;let O=C.getCoveringTilesDetailsProvider(),z=O.allowVariableZoom(C,s),V=zn(C,s),H=s.minzoom||0,K=s.maxzoom!==void 0?s.maxzoom:C.maxZoom,ne=Math.min(Math.max(0,V),K),ie=Math.pow(2,ne),fe=[ie*v.x,ie*v.y,0],Ae=[ie*S.x,ie*S.y,0],Ie=Math.hypot(S.x-v.x,S.y-v.y),Ce=Math.abs(S.z-v.z),Pe=Math.hypot(Ie,Ce),Fe=qe=>({zoom:0,x:0,y:0,wrap:qe,fullyVisible:!1}),Ve=[],Be=[];if(C.renderWorldCopies&&O.allowWorldCopies())for(let qe=1;qe<=3;qe++)Ve.push(Fe(-qe)),Ve.push(Fe(qe));for(Ve.push(Fe(0));Ve.length>0;){let qe=Ve.pop(),Ge=qe.x,Ze=qe.y,_t=qe.fullyVisible,At={x:Ge,y:Ze,z:qe.zoom},Pt=O.getTileAABB(At,qe.wrap,C.elevation,s);if(!_t){let Kt=Xi(u,Pt,_);if(Kt===0)continue;_t=Kt===2}let Lt=O.distanceToTile2d(v.x,v.y,At,Pt),Tt=V;z&&(Tt=(s.calculateTileZoom||uo)(C.zoom+o.ab(C.tileSize/s.tileSize),Lt,Ce,Pe,C.fov)),Tt=(s.roundZoom?Math.round:Math.floor)(Tt),Tt=Math.max(0,Tt);let er=Math.min(Tt,K);if(qe.wrap=O.getWrap(S,At,qe.wrap),qe.zoom>=er){if(qe.zoom<H)continue;let Kt=ne-qe.zoom,Ut=fe[0]-.5-(Ge<<Kt),mt=fe[1]-.5-(Ze<<Kt),Nt=s.reparseOverscaled?Math.max(qe.zoom,Tt):qe.zoom;Be.push({tileID:new o.Y(qe.zoom===K?Nt:qe.zoom,qe.wrap,qe.zoom,Ge,Ze),distanceSq:o.ac([Ae[0]-.5-Ge,Ae[1]-.5-Ze]),tileDistanceToCamera:Math.sqrt(Ut*Ut+mt*mt)})}else for(let Kt=0;Kt<4;Kt++)Ve.push({zoom:qe.zoom+1,x:(Ge<<1)+Kt%2,y:(Ze<<1)+(Kt>>1),wrap:qe.wrap,fullyVisible:_t})}return Be.sort((qe,Ge)=>qe.distanceSq-Ge.distanceSq).map(qe=>qe.tileID)}class de extends o.E{constructor(s,u,_){super(),this.id=s,this.dispatcher=_,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,S,O,z)=>{let V=new(as(S.type))(v,S,O,z);if(V.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${V.id}`);return V})(s,u,_,this),this._tiles={},this._cache=new ai(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Mr,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let s in this._tiles){let u=this._tiles[s];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,u,_){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,u,_)}catch(v){s.state="errored",v.status!==404?this._source.fire(new o.k(v,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new o.l("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let u in this._tiles){let _=this._tiles[u];_.upload(s),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(ge).map(s=>s.key)}getRenderableIds(s){let u=[];for(let _ in this._tiles)this._isIdRenderable(_,s)&&u.push(this._tiles[_]);return s?u.sort((_,v)=>{let S=_.tileID,O=v.tileID,z=new o.P(S.canonical.x,S.canonical.y)._rotate(-this.transform.bearingInRadians),V=new o.P(O.canonical.x,O.canonical.y)._rotate(-this.transform.bearingInRadians);return S.overscaledZ-O.overscaledZ||V.y-z.y||V.x-z.x}).map(_=>_.tileID.key):u.map(_=>_.tileID).sort(ge).map(_=>_.key)}hasRenderableParent(s){let u=this.findLoadedParent(s,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(s,u){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(u||!this._tiles[s].holdingForFade())}reload(s){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let u in this._tiles)(s||this._tiles[u].state!=="errored")&&this._reloadTile(u,"reloading")}}_reloadTile(s,u){return o._(this,void 0,void 0,function*(){let _=this._tiles[s];_&&(_.state!=="loading"&&(_.state=u),yield this._loadTile(_,s,u))})}_tileLoaded(s,u,_){s.timeAdded=x.now(),_==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(u,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){let u=this.getRenderableIds();for(let v=0;v<u.length;v++){let S=u[v];if(s.neighboringTiles&&s.neighboringTiles[S]){let O=this.getTileByID(S);_(s,O),_(O,s)}}function _(v,S){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let O=S.tileID.canonical.x-v.tileID.canonical.x,z=S.tileID.canonical.y-v.tileID.canonical.y,V=Math.pow(2,v.tileID.canonical.z),H=S.tileID.key;O===0&&z===0||Math.abs(z)>1||(Math.abs(O)>1&&(Math.abs(O+V)===1?O+=V:Math.abs(O-V)===1&&(O-=V)),S.dem&&v.dem&&(v.dem.backfillBorder(S.dem,O,z),v.neighboringTiles&&v.neighboringTiles[H]&&(v.neighboringTiles[H].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,u,_,v){for(let S in this._tiles){let O=this._tiles[S];if(v[S]||!O.hasData()||O.tileID.overscaledZ<=u||O.tileID.overscaledZ>_)continue;let z=O.tileID;for(;O&&O.tileID.overscaledZ>u+1;){let H=O.tileID.scaledTo(O.tileID.overscaledZ-1);O=this._tiles[H.key],O&&O.hasData()&&(z=H)}let V=z;for(;V.overscaledZ>u;)if(V=V.scaledTo(V.overscaledZ-1),s[V.key]||s[V.canonical.key]){v[z.key]=z;break}}}findLoadedParent(s,u){if(s.key in this._loadedParentTiles){let _=this._loadedParentTiles[s.key];return _&&_.tileID.overscaledZ>=u?_:null}for(let _=s.overscaledZ-1;_>=u;_--){let v=s.scaledTo(_),S=this._getLoadedTile(v);if(S)return S}}findLoadedSibling(s){return this._getLoadedTile(s)}_getLoadedTile(s){let u=this._tiles[s.key];return u&&u.hasData()?u:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){let u=Math.ceil(s.width/this._source.tileSize)+1,_=Math.ceil(s.height/this._source.tileSize)+1,v=Math.floor(u*_*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(s){let u=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,u){let _={};for(let v in this._tiles){let S=this._tiles[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),_[S.tileID.key]=S}this._tiles=_;for(let v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(let v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}_updateCoveredAndRetainedTiles(s,u,_,v,S,O){let z={},V={},H=Object.keys(s),K=x.now();for(let ne of H){let ie=s[ne],fe=this._tiles[ne];if(!fe||fe.fadeEndTime!==0&&fe.fadeEndTime<=K)continue;let Ae=this.findLoadedParent(ie,u),Ie=this.findLoadedSibling(ie),Ce=Ae||Ie||null;Ce&&(this._addTile(Ce.tileID),z[Ce.tileID.key]=Ce.tileID),V[ne]=ie}this._retainLoadedChildren(V,v,_,s);for(let ne in z)s[ne]||(this._coveredTiles[ne]=!0,s[ne]=z[ne]);if(O){let ne={},ie={};for(let fe of S)this._tiles[fe.key].hasData()?ne[fe.key]=fe:ie[fe.key]=fe;for(let fe in ie){let Ae=ie[fe].children(this._source.maxzoom);this._tiles[Ae[0].key]&&this._tiles[Ae[1].key]&&this._tiles[Ae[2].key]&&this._tiles[Ae[3].key]&&(ne[Ae[0].key]=s[Ae[0].key]=Ae[0],ne[Ae[1].key]=s[Ae[1].key]=Ae[1],ne[Ae[2].key]=s[Ae[2].key]=Ae[2],ne[Ae[3].key]=s[Ae[3].key]=Ae[3],delete ie[fe])}for(let fe in ie){let Ae=ie[fe],Ie=this.findLoadedParent(Ae,this._source.minzoom),Ce=this.findLoadedSibling(Ae),Pe=Ie||Ce||null;if(Pe){ne[Pe.tileID.key]=s[Pe.tileID.key]=Pe.tileID;for(let Fe in ne)ne[Fe].isChildOf(Pe.tileID)&&delete ne[Fe]}}for(let fe in this._tiles)ne[fe]||(this._coveredTiles[fe]=!0)}}update(s,u){if(!this._sourceLoaded||this._paused)return;let _;this.transform=s,this.terrain=u,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new o.Y(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y)):(_=st(s,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter(K=>this._source.hasTile(K)))):_=[];let v=zn(s,this._source),S=Math.max(v-de.maxOverzooming,this._source.minzoom),O=Math.max(v+de.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let K={};for(let ne of _)if(ne.canonical.z>this._source.minzoom){let ie=ne.scaledTo(ne.canonical.z-1);K[ie.key]=ie;let fe=ne.scaledTo(Math.max(this._source.minzoom,Math.min(ne.canonical.z,5)));K[fe.key]=fe}_=_.concat(Object.values(K))}let z=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,z&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let V=this._updateRetainedTiles(_,v);ce(this._source.type)&&this._updateCoveredAndRetainedTiles(V,S,O,v,_,u);for(let K in V)this._tiles[K].clearFadeHold();let H=o.af(this._tiles,V);for(let K of H){let ne=this._tiles[K];ne.hasSymbolBuckets&&!ne.holdingForFade()?ne.setHoldDuration(this.map._fadeDuration):ne.hasSymbolBuckets&&!ne.symbolFadeFinished()||this._removeTile(K)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,u){var _;let v={},S={},O=Math.max(u-de.maxOverzooming,this._source.minzoom),z=Math.max(u+de.maxUnderzooming,this._source.minzoom),V={};for(let H of s){let K=this._addTile(H);v[H.key]=H,K.hasData()||u<this._source.maxzoom&&(V[H.key]=H)}this._retainLoadedChildren(V,u,z,v);for(let H of s){let K=this._tiles[H.key];if(K.hasData())continue;if(u+1>this._source.maxzoom){let ie=H.children(this._source.maxzoom)[0],fe=this.getTile(ie);if(fe&&fe.hasData()){v[ie.key]=ie;continue}}else{let ie=H.children(this._source.maxzoom);if(v[ie[0].key]&&v[ie[1].key]&&v[ie[2].key]&&v[ie[3].key])continue}let ne=K.wasRequested();for(let ie=H.overscaledZ-1;ie>=O;--ie){let fe=H.scaledTo(ie);if(S[fe.key])break;if(S[fe.key]=!0,K=this.getTile(fe),!K&&ne&&(K=this._addTile(fe)),K){let Ae=K.hasData();if((Ae||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||ne)&&(v[fe.key]=fe),ne=K.wasRequested(),Ae)break}}}return v}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let s in this._tiles){let u=[],_,v=this._tiles[s].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){_=this._loadedParentTiles[v.key];break}u.push(v.key);let S=v.scaledTo(v.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;v=S}for(let S of u)this._loadedParentTiles[S]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let s in this._tiles){let u=this._tiles[s].tileID,_=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=_}}_addTile(s){let u=this._tiles[s.key];if(u)return u;u=this._cache.getAndRemove(s),u&&(this._setTileReloadTimer(s.key,u),u.tileID=s,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,u)));let _=u;return u||(u=new Er(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(u,s.key,u.state)),u.uses++,this._tiles[s.key]=u,_||this._source.fire(new o.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(s,u){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);let _=u.getExpiryTimeout();_&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},_))}_removeTile(s){let u=this._tiles[s];u&&(u.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(s){let u=s.sourceDataType;s.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&u==="content"&&(this.reload(s.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,u,_){let v=[],S=this.transform;if(!S)return v;let O=_?S.getCameraQueryGeometry(s):s,z=s.map(Ae=>S.screenPointToMercatorCoordinate(Ae,this.terrain)),V=O.map(Ae=>S.screenPointToMercatorCoordinate(Ae,this.terrain)),H=this.getIds(),K=1/0,ne=1/0,ie=-1/0,fe=-1/0;for(let Ae of V)K=Math.min(K,Ae.x),ne=Math.min(ne,Ae.y),ie=Math.max(ie,Ae.x),fe=Math.max(fe,Ae.y);for(let Ae=0;Ae<H.length;Ae++){let Ie=this._tiles[H[Ae]];if(Ie.holdingForFade())continue;let Ce=Ie.tileID,Pe=Math.pow(2,S.zoom-Ie.tileID.overscaledZ),Fe=u*Ie.queryPadding*o.Z/Ie.tileSize/Pe,Ve=[Ce.getTilePoint(new o.$(K,ne)),Ce.getTilePoint(new o.$(ie,fe))];if(Ve[0].x-Fe<o.Z&&Ve[0].y-Fe<o.Z&&Ve[1].x+Fe>=0&&Ve[1].y+Fe>=0){let Be=z.map(Ge=>Ce.getTilePoint(Ge)),qe=V.map(Ge=>Ce.getTilePoint(Ge));v.push({tile:Ie,tileID:Ce,queryGeometry:Be,cameraQueryGeometry:qe,scale:Pe})}}return v}getVisibleCoordinates(s){let u=this.getRenderableIds(s).map(_=>this._tiles[_].tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(ce(this._source.type)){let s=x.now();for(let u in this._tiles)if(this._tiles[u].fadeEndTime>=s)return!0}return!1}setFeatureState(s,u,_){this._state.updateState(s=s||"_geojsonTileLayer",u,_)}removeFeatureState(s,u,_){this._state.removeFeatureState(s=s||"_geojsonTileLayer",u,_)}getFeatureState(s,u){return this._state.getState(s=s||"_geojsonTileLayer",u)}setDependencies(s,u,_){let v=this._tiles[s];v&&v.setDependencies(u,_)}reloadTilesForDependencies(s,u){for(let _ in this._tiles)this._tiles[_].hasDependency(s,u)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(s,u))}}function ge(C,s){let u=Math.abs(2*C.wrap)-+(C.wrap<0),_=Math.abs(2*s.wrap)-+(s.wrap<0);return C.overscaledZ-s.overscaledZ||_-u||s.canonical.y-C.canonical.y||s.canonical.x-C.canonical.x}function ce(C){return C==="raster"||C==="image"||C==="video"}de.maxOverzooming=10,de.maxUnderzooming=3;class ze{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=o.ae(s,0,1);let u=1,_=this._distances[u],v=s*this.paddedLength+this.padding;for(;_<v&&u<this._distances.length;)_=this._distances[++u];let S=u-1,O=this._distances[S],z=_-O,V=z>0?(v-O)/z:0;return this.points[S].mult(1-V).add(this.points[u].mult(V))}}function Ye(C,s){let u=!0;return C==="always"||C!=="never"&&s!=="never"||(u=!1),u}class Ke{constructor(s,u,_){let v=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(s/_),this.yCellCount=Math.ceil(u/_);for(let O=0;O<this.xCellCount*this.yCellCount;O++)v.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,_,v,S){this._forEachCell(u,_,v,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(S)}insertCircle(s,u,_,v){this._forEachCell(u-v,_-v,u+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(_),this.circles.push(v)}_insertBoxCell(s,u,_,v,S,O){this.boxCells[S].push(O)}_insertCircleCell(s,u,_,v,S,O){this.circleCells[S].push(O)}_query(s,u,_,v,S,O,z){if(_<0||s>this.width||v<0||u>this.height)return[];let V=[];if(s<=0&&u<=0&&this.width<=_&&this.height<=v){if(S)return[{key:null,x1:s,y1:u,x2:_,y2:v}];for(let H=0;H<this.boxKeys.length;H++)V.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){let K=this.circles[3*H],ne=this.circles[3*H+1],ie=this.circles[3*H+2];V.push({key:this.circleKeys[H],x1:K-ie,y1:ne-ie,x2:K+ie,y2:ne+ie})}}else this._forEachCell(s,u,_,v,this._queryCell,V,{hitTest:S,overlapMode:O,seenUids:{box:{},circle:{}}},z);return V}query(s,u,_,v){return this._query(s,u,_,v,!1,null)}hitTest(s,u,_,v,S,O){return this._query(s,u,_,v,!0,S,O).length>0}hitTestCircle(s,u,_,v,S){let O=s-_,z=s+_,V=u-_,H=u+_;if(z<0||O>this.width||H<0||V>this.height)return!1;let K=[];return this._forEachCell(O,V,z,H,this._queryCellCircle,K,{hitTest:!0,overlapMode:v,circle:{x:s,y:u,radius:_},seenUids:{box:{},circle:{}}},S),K.length>0}_queryCell(s,u,_,v,S,O,z,V){let{seenUids:H,hitTest:K,overlapMode:ne}=z,ie=this.boxCells[S];if(ie!==null){let Ae=this.bboxes;for(let Ie of ie)if(!H.box[Ie]){H.box[Ie]=!0;let Ce=4*Ie,Pe=this.boxKeys[Ie];if(s<=Ae[Ce+2]&&u<=Ae[Ce+3]&&_>=Ae[Ce+0]&&v>=Ae[Ce+1]&&(!V||V(Pe))&&(!K||!Ye(ne,Pe.overlapMode))&&(O.push({key:Pe,x1:Ae[Ce],y1:Ae[Ce+1],x2:Ae[Ce+2],y2:Ae[Ce+3]}),K))return!0}}let fe=this.circleCells[S];if(fe!==null){let Ae=this.circles;for(let Ie of fe)if(!H.circle[Ie]){H.circle[Ie]=!0;let Ce=3*Ie,Pe=this.circleKeys[Ie];if(this._circleAndRectCollide(Ae[Ce],Ae[Ce+1],Ae[Ce+2],s,u,_,v)&&(!V||V(Pe))&&(!K||!Ye(ne,Pe.overlapMode))){let Fe=Ae[Ce],Ve=Ae[Ce+1],Be=Ae[Ce+2];if(O.push({key:Pe,x1:Fe-Be,y1:Ve-Be,x2:Fe+Be,y2:Ve+Be}),K)return!0}}}return!1}_queryCellCircle(s,u,_,v,S,O,z,V){let{circle:H,seenUids:K,overlapMode:ne}=z,ie=this.boxCells[S];if(ie!==null){let Ae=this.bboxes;for(let Ie of ie)if(!K.box[Ie]){K.box[Ie]=!0;let Ce=4*Ie,Pe=this.boxKeys[Ie];if(this._circleAndRectCollide(H.x,H.y,H.radius,Ae[Ce+0],Ae[Ce+1],Ae[Ce+2],Ae[Ce+3])&&(!V||V(Pe))&&!Ye(ne,Pe.overlapMode))return O.push(!0),!0}}let fe=this.circleCells[S];if(fe!==null){let Ae=this.circles;for(let Ie of fe)if(!K.circle[Ie]){K.circle[Ie]=!0;let Ce=3*Ie,Pe=this.circleKeys[Ie];if(this._circlesCollide(Ae[Ce],Ae[Ce+1],Ae[Ce+2],H.x,H.y,H.radius)&&(!V||V(Pe))&&!Ye(ne,Pe.overlapMode))return O.push(!0),!0}}}_forEachCell(s,u,_,v,S,O,z,V){let H=this._convertToXCellCoord(s),K=this._convertToYCellCoord(u),ne=this._convertToXCellCoord(_),ie=this._convertToYCellCoord(v);for(let fe=H;fe<=ne;fe++)for(let Ae=K;Ae<=ie;Ae++)if(S.call(this,s,u,_,v,this.xCellCount*Ae+fe,O,z,V))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,_,v,S,O){let z=v-s,V=S-u,H=_+O;return H*H>z*z+V*V}_circleAndRectCollide(s,u,_,v,S,O,z){let V=(O-v)/2,H=Math.abs(s-(v+V));if(H>V+_)return!1;let K=(z-S)/2,ne=Math.abs(u-(S+K));if(ne>K+_)return!1;if(H<=V||ne<=K)return!0;let ie=H-V,fe=ne-K;return ie*ie+fe*fe<=_*_}}function dt(C,s,u){let _=o.K();if(!C){let{vecSouth:ne,vecEast:ie}=Bt(s),fe=c();fe[0]=ie[0],fe[1]=ie[1],fe[2]=ne[0],fe[3]=ne[1],v=fe,(K=(O=(S=fe)[0])*(H=S[3])-(V=S[2])*(z=S[1]))&&(v[0]=H*(K=1/K),v[1]=-z*K,v[2]=-V*K,v[3]=O*K),_[0]=fe[0],_[1]=fe[1],_[4]=fe[2],_[5]=fe[3]}var v,S,O,z,V,H,K;return o.M(_,_,[1/u,1/u,1]),_}function it(C,s,u,_){if(C){let v=o.K();if(!s){let{vecSouth:S,vecEast:O}=Bt(u);v[0]=O[0],v[1]=O[1],v[4]=S[0],v[5]=S[1]}return o.M(v,v,[_,_,1]),v}return u.pixelsToClipSpaceMatrix}function Bt(C){let s=Math.cos(C.rollInRadians),u=Math.sin(C.rollInRadians),_=Math.cos(C.pitchInRadians),v=Math.cos(C.bearingInRadians),S=Math.sin(C.bearingInRadians),O=o.ak();O[0]=-v*_*u-S*s,O[1]=-S*_*u+v*s;let z=o.al(O);z<1e-9?o.am(O):o.an(O,O,1/z);let V=o.ak();V[0]=v*_*s-S*u,V[1]=S*_*s+v*u;let H=o.al(V);return H<1e-9?o.am(V):o.an(V,V,1/H),{vecEast:V,vecSouth:O}}function Mt(C,s,u,_){let v;_?(v=[C,s,_(C,s),1],o.ap(v,v,u)):(v=[C,s,0,1],Kn(v,v,u));let S=v[3];return{point:new o.P(v[0]/S,v[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}function ut(C,s){return .5+C/s*.5}function zt(C,s){return C.x>=-s[0]&&C.x<=s[0]&&C.y>=-s[1]&&C.y<=s[1]}function rr(C,s,u,_,v,S,O,z,V,H,K,ne,ie){let fe=u?C.textSizeData:C.iconSizeData,Ae=o.ag(fe,s.transform.zoom),Ie=[256/s.width*2+1,256/s.height*2+1],Ce=u?C.text.dynamicLayoutVertexArray:C.icon.dynamicLayoutVertexArray;Ce.clear();let Pe=C.lineVertexArray,Fe=u?C.text.placedSymbolArray:C.icon.placedSymbolArray,Ve=s.transform.width/s.transform.height,Be=!1;for(let qe=0;qe<Fe.length;qe++){let Ge=Fe.get(qe);if(Ge.hidden||Ge.writingMode===o.ah.vertical&&!Be){Pr(Ge.numGlyphs,Ce);continue}Be=!1;let Ze=new o.P(Ge.anchorX,Ge.anchorY),_t={getElevation:ie,pitchedLabelPlaneMatrix:_,lineVertexArray:Pe,pitchWithMap:S,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:s.transform,tileAnchorPoint:Ze,unwrappedTileID:V,width:H,height:K,translation:ne},At=dr(Ge.anchorX,Ge.anchorY,_t);if(!zt(At.point,Ie)){Pr(Ge.numGlyphs,Ce);continue}let Pt=ut(s.transform.cameraToCenterDistance,At.signedDistanceFromCamera),Lt=o.ai(fe,Ae,Ge),Tt=S?Lt*s.transform.getPitchedTextCorrection(Ge.anchorX,Ge.anchorY,V)/Pt:Lt*Pt,er=Fr({projectionContext:_t,pitchedLabelPlaneMatrixInverse:v,symbol:Ge,fontSize:Tt,flip:!1,keepUpright:O,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:Ce,aspectRatio:Ve,rotateToLine:z});Be=er.useVertical,(er.notEnoughRoom||Be||er.needsFlipping&&Fr({projectionContext:_t,pitchedLabelPlaneMatrixInverse:v,symbol:Ge,fontSize:Tt,flip:!0,keepUpright:O,glyphOffsetArray:C.glyphOffsetArray,dynamicLayoutVertexArray:Ce,aspectRatio:Ve,rotateToLine:z}).notEnoughRoom)&&Pr(Ge.numGlyphs,Ce)}u?C.text.dynamicLayoutVertexBuffer.updateData(Ce):C.icon.dynamicLayoutVertexBuffer.updateData(Ce)}function nr(C,s,u,_,v,S,O,z){let V=S.glyphStartIndex+S.numGlyphs,H=S.lineStartIndex,K=S.lineStartIndex+S.lineLength,ne=s.getoffsetX(S.glyphStartIndex),ie=s.getoffsetX(V-1),fe=xn(C*ne,u,_,v,S.segment,H,K,z,O);if(!fe)return null;let Ae=xn(C*ie,u,_,v,S.segment,H,K,z,O);return Ae?z.projectionCache.anyProjectionOccluded?null:{first:fe,last:Ae}:null}function We(C,s,u,_){return C===o.ah.horizontal&&Math.abs(u.y-s.y)>Math.abs(u.x-s.x)*_?{useVertical:!0}:(C===o.ah.vertical?s.y<u.y:s.x>u.x)?{needsFlipping:!0}:null}function Fr(C){let{projectionContext:s,pitchedLabelPlaneMatrixInverse:u,symbol:_,fontSize:v,flip:S,keepUpright:O,glyphOffsetArray:z,dynamicLayoutVertexArray:V,aspectRatio:H,rotateToLine:K}=C,ne=v/24,ie=_.lineOffsetX*ne,fe=_.lineOffsetY*ne,Ae;if(_.numGlyphs>1){let Ie=_.glyphStartIndex+_.numGlyphs,Ce=_.lineStartIndex,Pe=_.lineStartIndex+_.lineLength,Fe=nr(ne,z,ie,fe,S,_,K,s);if(!Fe)return{notEnoughRoom:!0};let Ve=Gt(Fe.first.point.x,Fe.first.point.y,s,u),Be=Gt(Fe.last.point.x,Fe.last.point.y,s,u);if(O&&!S){let qe=We(_.writingMode,Ve,Be,H);if(qe)return qe}Ae=[Fe.first];for(let qe=_.glyphStartIndex+1;qe<Ie-1;qe++)Ae.push(xn(ne*z.getoffsetX(qe),ie,fe,S,_.segment,Ce,Pe,s,K));Ae.push(Fe.last)}else{if(O&&!S){let Ce=gi(s.tileAnchorPoint.x,s.tileAnchorPoint.y,s).point,Pe=_.lineStartIndex+_.segment+1,Fe=new o.P(s.lineVertexArray.getx(Pe),s.lineVertexArray.gety(Pe)),Ve=gi(Fe.x,Fe.y,s),Be=Ve.signedDistanceFromCamera>0?Ve.point:Cr(s.tileAnchorPoint,Fe,Ce,1,s),qe=Gt(Ce.x,Ce.y,s,u),Ge=Gt(Be.x,Be.y,s,u),Ze=We(_.writingMode,qe,Ge,H);if(Ze)return Ze}let Ie=xn(ne*z.getoffsetX(_.glyphStartIndex),ie,fe,S,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,s,K);if(!Ie||s.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Ae=[Ie]}for(let Ie of Ae)o.ao(V,Ie.point,Ie.angle);return{}}function Cr(C,s,u,_,v){let S=C.add(C.sub(s)._unit()),O=gi(S.x,S.y,v).point,z=u.sub(O);return u.add(z._mult(_/z.mag()))}function kr(C,s,u){let _=s.projectionCache;if(_.projections[C])return _.projections[C];let v=new o.P(s.lineVertexArray.getx(C),s.lineVertexArray.gety(C)),S=gi(v.x,v.y,s);if(S.signedDistanceFromCamera>0)return _.projections[C]=S.point,_.anyProjectionOccluded=_.anyProjectionOccluded||S.isOccluded,S.point;let O=C-u.direction;return Cr(u.distanceFromAnchor===0?s.tileAnchorPoint:new o.P(s.lineVertexArray.getx(O),s.lineVertexArray.gety(O)),v,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,s)}function gi(C,s,u){let _=C+u.translation[0],v=s+u.translation[1],S;return u.pitchWithMap?(S=Mt(_,v,u.pitchedLabelPlaneMatrix,u.getElevation),S.isOccluded=!1):(S=u.transform.projectTileCoordinates(_,v,u.unwrappedTileID,u.getElevation),S.point.x=(.5*S.point.x+.5)*u.width,S.point.y=(.5*-S.point.y+.5)*u.height),S}function Gt(C,s,u,_){if(u.pitchWithMap){let v=[C,s,0,1];return o.ap(v,v,_),u.transform.projectTileCoordinates(v[0]/v[3],v[1]/v[3],u.unwrappedTileID,u.getElevation).point}return{x:C/u.width*2-1,y:s/u.height*2-1}}function dr(C,s,u){return u.transform.projectTileCoordinates(C,s,u.unwrappedTileID,u.getElevation)}function tr(C,s,u){return C._unit()._perp()._mult(s*u)}function Ur(C,s,u,_,v,S,O,z,V){if(z.projectionCache.offsets[C])return z.projectionCache.offsets[C];let H=u.add(s);if(C+V.direction<_||C+V.direction>=v)return z.projectionCache.offsets[C]=H,H;let K=kr(C+V.direction,z,V),ne=tr(K.sub(u),O,V.direction),ie=u.add(ne),fe=K.add(ne);return z.projectionCache.offsets[C]=o.aq(S,H,ie,fe)||H,z.projectionCache.offsets[C]}function xn(C,s,u,_,v,S,O,z,V){let H=_?C-s:C+s,K=H>0?1:-1,ne=0;_&&(K*=-1,ne=Math.PI),K<0&&(ne+=Math.PI);let ie,fe=K>0?S+v:S+v+1;z.projectionCache.cachedAnchorPoint?ie=z.projectionCache.cachedAnchorPoint:(ie=gi(z.tileAnchorPoint.x,z.tileAnchorPoint.y,z).point,z.projectionCache.cachedAnchorPoint=ie);let Ae,Ie,Ce=ie,Pe=ie,Fe=0,Ve=0,Be=Math.abs(H),qe=[],Ge;for(;Fe+Ve<=Be;){if(fe+=K,fe<S||fe>=O)return null;Fe+=Ve,Pe=Ce,Ie=Ae;let At={absOffsetX:Be,direction:K,distanceFromAnchor:Fe,previousVertex:Pe};if(Ce=kr(fe,z,At),u===0)qe.push(Pe),Ge=Ce.sub(Pe);else{let Pt,Lt=Ce.sub(Pe);Pt=Lt.mag()===0?tr(kr(fe+K,z,At).sub(Ce),u,K):tr(Lt,u,K),Ie||(Ie=Pe.add(Pt)),Ae=Ur(fe,Pt,Ce,S,O,Ie,u,z,At),qe.push(Ie),Ge=Ae.sub(Ie)}Ve=Ge.mag()}let Ze=Ge._mult((Be-Fe)/Ve)._add(Ie||Pe),_t=ne+Math.atan2(Ce.y-Pe.y,Ce.x-Pe.x);return qe.push(Ze),{point:Ze,angle:V?_t:0,path:qe}}let ma=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pr(C,s){for(let u=0;u<C;u++){let _=s.length;s.resize(_+4),s.float32.set(ma,3*_)}}function Kn(C,s,u){let _=s[0],v=s[1];return C[0]=u[0]*_+u[4]*v+u[12],C[1]=u[1]*_+u[5]*v+u[13],C[3]=u[3]*_+u[7]*v+u[15],C}let rn=100;class ih{constructor(s,u=new Ke(s.width+200,s.height+200,25),_=new Ke(s.width+200,s.height+200,25)){this.transform=s,this.grid=u,this.ignoredGrid=_,this.pitchFactor=Math.cos(s.pitch*Math.PI/180)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+rn,this.screenBottomBoundary=s.height+rn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,u,_,v,S,O,z,V,H,K,ne,ie){let fe=this.projectAndGetPerspectiveRatio(s.anchorPointX+V[0],s.anchorPointY+V[1],S,K,ie),Ae=_*fe.perspectiveRatio,Ie;if(O||z)Ie=this._projectCollisionBox(s,Ae,v,S,O,z,V,fe,K,ne,ie);else{let Ge=fe.x+(ne?ne.x*Ae:0),Ze=fe.y+(ne?ne.y*Ae:0);Ie={allPointsOccluded:!1,box:[Ge+s.x1*Ae,Ze+s.y1*Ae,Ge+s.x2*Ae,Ze+s.y2*Ae]}}let[Ce,Pe,Fe,Ve]=Ie.box,Be=O?Ie.allPointsOccluded:fe.isOccluded,qe=Be;return qe||(qe=fe.perspectiveRatio<this.perspectiveRatioCutoff),qe||(qe=!this.isInsideGrid(Ce,Pe,Fe,Ve)),qe||u!=="always"&&this.grid.hitTest(Ce,Pe,Fe,Ve,u,H)?{box:[Ce,Pe,Fe,Ve],placeable:!1,offscreen:!1,occluded:Be}:{box:[Ce,Pe,Fe,Ve],placeable:!0,offscreen:this.isOffscreen(Ce,Pe,Fe,Ve),occluded:Be}}placeCollisionCircles(s,u,_,v,S,O,z,V,H,K,ne,ie,fe,Ae){let Ie=[],Ce=new o.P(u.anchorX,u.anchorY),Pe=this.getPerspectiveRatio(Ce.x,Ce.y,O,Ae),Fe=(H?S*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,O)/Pe:S*Pe)/o.av,Ve={getElevation:Ae,pitchedLabelPlaneMatrix:z,lineVertexArray:_,pitchWithMap:H,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Ce,unwrappedTileID:O,width:this.transform.width,height:this.transform.height,translation:fe},Be=nr(Fe,v,u.lineOffsetX*Fe,u.lineOffsetY*Fe,!1,u,!1,Ve),qe=!1,Ge=!1,Ze=!0;if(Be){let _t=.5*ne*Pe+ie,At=new o.P(-100,-100),Pt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Lt=new ze,Tt=Be.first,er=Be.last,Kt=[];for(let Nt=Tt.path.length-1;Nt>=1;Nt--)Kt.push(Tt.path[Nt]);for(let Nt=1;Nt<er.path.length;Nt++)Kt.push(er.path[Nt]);let Ut=2.5*_t;if(H){let Nt=this.projectPathToScreenSpace(Kt,Ve);Kt=Nt.some(Ri=>Ri.signedDistanceFromCamera<=0)?[]:Nt.map(Ri=>Ri.point)}let mt=[];if(Kt.length>0){let Nt=Kt[0].clone(),Ri=Kt[0].clone();for(let Hr=1;Hr<Kt.length;Hr++)Nt.x=Math.min(Nt.x,Kt[Hr].x),Nt.y=Math.min(Nt.y,Kt[Hr].y),Ri.x=Math.max(Ri.x,Kt[Hr].x),Ri.y=Math.max(Ri.y,Kt[Hr].y);mt=Nt.x>=At.x&&Ri.x<=Pt.x&&Nt.y>=At.y&&Ri.y<=Pt.y?[Kt]:Ri.x<At.x||Nt.x>Pt.x||Ri.y<At.y||Nt.y>Pt.y?[]:o.ar([Kt],At.x,At.y,Pt.x,Pt.y)}for(let Nt of mt){Lt.reset(Nt,.25*_t);let Ri=0;Ri=Lt.length<=.5*_t?1:Math.ceil(Lt.paddedLength/Ut)+1;for(let Hr=0;Hr<Ri;Hr++){let zi=Hr/Math.max(Ri-1,1),Zi=Lt.lerp(zi),Ui=Zi.x+rn,Wi=Zi.y+rn;Ie.push(Ui,Wi,_t,0);let vi=Ui-_t,m=Wi-_t,A=Ui+_t,b=Wi+_t;if(Ze=Ze&&this.isOffscreen(vi,m,A,b),Ge=Ge||this.isInsideGrid(vi,m,A,b),s!=="always"&&this.grid.hitTestCircle(Ui,Wi,_t,s,K)&&(qe=!0,!V))return{circles:[],offscreen:!1,collisionDetected:qe}}}}return{circles:!V&&qe||!Ge||Pe<this.perspectiveRatioCutoff?[]:Ie,offscreen:Ze,collisionDetected:qe}}projectPathToScreenSpace(s,u){let _=function(v,S){let O=o.K();return o.aj(O,S.pitchedLabelPlaneMatrix),v.map(z=>{let V=Mt(z.x,z.y,O,S.getElevation),H=S.transform.projectTileCoordinates(V.point.x,V.point.y,S.unwrappedTileID,S.getElevation);return H.point.x=(.5*H.point.x+.5)*S.width,H.point.y=(.5*-H.point.y+.5)*S.height,H})}(s,u);return function(v){let S=0,O=0,z=0,V=0;for(let H=0;H<v.length;H++)v[H].isOccluded?(z=H+1,V=0):(V++,V>O&&(O=V,S=z));return v.slice(S,S+O)}(_)}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],_=1/0,v=1/0,S=-1/0,O=-1/0;for(let K of s){let ne=new o.P(K.x+rn,K.y+rn);_=Math.min(_,ne.x),v=Math.min(v,ne.y),S=Math.max(S,ne.x),O=Math.max(O,ne.y),u.push(ne)}let z=this.grid.query(_,v,S,O).concat(this.ignoredGrid.query(_,v,S,O)),V={},H={};for(let K of z){let ne=K.key;if(V[ne.bucketInstanceId]===void 0&&(V[ne.bucketInstanceId]={}),V[ne.bucketInstanceId][ne.featureIndex])continue;let ie=[new o.P(K.x1,K.y1),new o.P(K.x2,K.y1),new o.P(K.x2,K.y2),new o.P(K.x1,K.y2)];o.as(u,ie)&&(V[ne.bucketInstanceId][ne.featureIndex]=!0,H[ne.bucketInstanceId]===void 0&&(H[ne.bucketInstanceId]=[]),H[ne.bucketInstanceId].push(ne.featureIndex))}return H}insertCollisionBox(s,u,_,v,S,O){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:S,collisionGroupID:O,overlapMode:u},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,_,v,S,O){let z=_?this.ignoredGrid:this.grid,V={bucketInstanceId:v,featureIndex:S,collisionGroupID:O,overlapMode:u};for(let H=0;H<s.length;H+=4)z.insertCircle(V,s[H],s[H+1],s[H+2])}projectAndGetPerspectiveRatio(s,u,_,v,S){if(S){let O;v?(O=[s,u,v(s,u),1],o.ap(O,O,S)):(O=[s,u,0,1],Kn(O,O,S));let z=O[3];return{x:(O[0]/z+1)/2*this.transform.width+rn,y:(-O[1]/z+1)/2*this.transform.height+rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/z*.5,isOccluded:!1,signedDistanceFromCamera:z}}{let O=this.transform.projectTileCoordinates(s,u,_,v);return{x:(O.point.x+1)/2*this.transform.width+rn,y:(1-O.point.y)/2*this.transform.height+rn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O.signedDistanceFromCamera*.5,isOccluded:O.isOccluded,signedDistanceFromCamera:O.signedDistanceFromCamera}}}getPerspectiveRatio(s,u,_,v){let S=this.transform.projectTileCoordinates(s,u,_,v);return .5+this.transform.cameraToCenterDistance/S.signedDistanceFromCamera*.5}isOffscreen(s,u,_,v){return _<rn||s>=this.screenRightBoundary||v<rn||u>this.screenBottomBoundary}isInsideGrid(s,u,_,v){return _>=0&&s<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let s=o.at([]);return o.L(s,s,[-100,-100,0]),s}_projectCollisionBox(s,u,_,v,S,O,z,V,H,K,ne){let ie=1,fe=0,Ae=0,Ie=1,Ce=s.anchorPointX+z[0],Pe=s.anchorPointY+z[1];if(O&&!S){let Kt=this.projectAndGetPerspectiveRatio(Ce+1,Pe,v,H,ne),Ut=Kt.x-V.x,mt=Math.atan((Kt.y-V.y)/Ut)+(Ut<0?Math.PI:0),Nt=Math.sin(mt),Ri=Math.cos(mt);ie=Ri,fe=Nt,Ae=-Nt,Ie=Ri}else if(!O&&S){let Kt=Bt(this.transform);ie=Kt.vecEast[0],fe=Kt.vecEast[1],Ae=Kt.vecSouth[0],Ie=Kt.vecSouth[1]}let Fe=V.x,Ve=V.y,Be=u;S&&(Fe=Ce,Ve=Pe,Be=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),Be*=this.transform.getPitchedTextCorrection(Ce,Pe,v),K||(Be*=o.ae(.5+V.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),K&&(Fe+=ie*K.x*Be+Ae*K.y*Be,Ve+=fe*K.x*Be+Ie*K.y*Be);let qe=s.x1*Be,Ge=s.x2*Be,Ze=(qe+Ge)/2,_t=s.y1*Be,At=s.y2*Be,Pt=(_t+At)/2,Lt=[{offsetX:qe,offsetY:_t},{offsetX:Ze,offsetY:_t},{offsetX:Ge,offsetY:_t},{offsetX:Ge,offsetY:Pt},{offsetX:Ge,offsetY:At},{offsetX:Ze,offsetY:At},{offsetX:qe,offsetY:At},{offsetX:qe,offsetY:Pt}],Tt=[];for(let{offsetX:Kt,offsetY:Ut}of Lt)Tt.push(new o.P(Fe+ie*Kt+Ae*Ut,Ve+fe*Kt+Ie*Ut));let er=!1;if(S){let Kt=Tt.map(Ut=>this.projectAndGetPerspectiveRatio(Ut.x,Ut.y,v,H,ne));er=Kt.some(Ut=>!Ut.isOccluded),Tt=Kt.map(Ut=>new o.P(Ut.x,Ut.y))}else er=!0;return{box:o.au(Tt),allPointsOccluded:!er}}}class Hl{constructor(s,u,_,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Ct{constructor(s,u,_,v,S){this.text=new Hl(s?s.text:null,u,_,S),this.icon=new Hl(s?s.icon:null,u,v,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yr{constructor(s,u,_){this.text=s,this.icon=u,this.skipFade=_}}class ii{constructor(s,u,_,v,S){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=S}}class Yo{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){let u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[s]}}function Qn(C,s,u,_,v){let{horizontalAlign:S,verticalAlign:O}=o.aB(C);return new o.P(-(S-.5)*s+_[0]*v,-(O-.5)*u+_[1]*v)}class Cs{constructor(s,u,_,v,S){this.transform=s.clone(),this.terrain=u,this.collisionIndex=new ih(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Yo(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){let u=this.terrain;return u?(_,v)=>u.getElevation(s,_,v):null}getBucketParts(s,u,_,v){let S=_.getBucket(u),O=_.latestFeatureIndex;if(!S||!O||u.id!==S.layerIds[0])return;let z=_.collisionBoxArray,V=S.layers[0].layout,H=S.layers[0].paint,K=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),ne=_.tileSize/o.Z,ie=_.tileID.toUnwrapped(),fe=V.get("text-rotation-alignment")==="map",Ae=o.aw(_,1,this.transform.zoom),Ie=o.ax(this.collisionIndex.transform,_,H.get("text-translate"),H.get("text-translate-anchor")),Ce=o.ax(this.collisionIndex.transform,_,H.get("icon-translate"),H.get("icon-translate-anchor")),Pe=dt(fe,this.transform,Ae);this.retainedQueryData[S.bucketInstanceId]=new ii(S.bucketInstanceId,O,S.sourceLayerIndex,S.index,_.tileID);let Fe={bucket:S,layout:V,translationText:Ie,translationIcon:Ce,unwrappedTileID:ie,pitchedLabelPlaneMatrix:Pe,scale:K,textPixelRatio:ne,holdingForFade:_.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:o.ag(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(v)for(let Ve of S.sortKeyRanges){let{sortKey:Be,symbolInstanceStart:qe,symbolInstanceEnd:Ge}=Ve;s.push({sortKey:Be,symbolInstanceStart:qe,symbolInstanceEnd:Ge,parameters:Fe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(s,u,_,v,S,O,z,V,H,K,ne,ie,fe,Ae,Ie,Ce,Pe,Fe,Ve,Be){let qe=o.ay[s.textAnchor],Ge=[s.textOffset0,s.textOffset1],Ze=Qn(qe,_,v,Ge,S),_t=this.collisionIndex.placeCollisionBox(u,ie,V,H,K,z,O,Ce,ne.predicate,Ve,Ze,Be);if((!Fe||this.collisionIndex.placeCollisionBox(Fe,ie,V,H,K,z,O,Pe,ne.predicate,Ve,Ze,Be).placeable)&&_t.placeable){let At;if(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(At=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[fe.crossTileID]={textOffset:Ge,width:_,height:v,anchor:qe,textBoxScale:S,prevAnchor:At},this.markUsedJustification(Ae,qe,fe,Ie),Ae.allowVerticalPlacement&&(this.markUsedOrientation(Ae,Ie,fe),this.placedOrientations[fe.crossTileID]=Ie),{shift:Ze,placedGlyphBoxes:_t}}}placeLayerBucketPart(s,u,_){let{bucket:v,layout:S,translationText:O,translationIcon:z,unwrappedTileID:V,pitchedLabelPlaneMatrix:H,textPixelRatio:K,holdingForFade:ne,collisionBoxArray:ie,partiallyEvaluatedTextSize:fe,collisionGroup:Ae}=s.parameters,Ie=S.get("text-optional"),Ce=S.get("icon-optional"),Pe=o.az(S,"text-overlap","text-allow-overlap"),Fe=Pe==="always",Ve=o.az(S,"icon-overlap","icon-allow-overlap"),Be=Ve==="always",qe=S.get("text-rotation-alignment")==="map",Ge=S.get("text-pitch-alignment")==="map",Ze=S.get("icon-text-fit")!=="none",_t=S.get("symbol-z-order")==="viewport-y",At=Fe&&(Be||!v.hasIconData()||Ce),Pt=Be&&(Fe||!v.hasTextData()||Ie);!v.collisionArrays&&ie&&v.deserializeCollisionBoxes(ie);let Lt=this.retainedQueryData[v.bucketInstanceId].tileID,Tt=this._getTerrainElevationFunc(Lt),er=this.transform.getFastPathSimpleProjectionMatrix(Lt),Kt=(Ut,mt,Nt)=>{var Ri,Hr;if(u[Ut.crossTileID])return;if(ne)return void(this.placements[Ut.crossTileID]=new Yr(!1,!1,!1));let zi=!1,Zi=!1,Ui=!0,Wi=null,vi={box:null,placeable:!1,offscreen:null,occluded:!1},m={placeable:!1},A=null,b=null,E=null,M=0,B=0,F=0;mt.textFeatureIndex?M=mt.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(M=Ut.featureIndex),mt.verticalTextFeatureIndex&&(B=mt.verticalTextFeatureIndex);let N=mt.textBox;if(N){let we=nt=>{let It=o.ah.horizontal;if(v.allowVerticalPlacement&&!nt&&this.prevPlacement){let wt=this.prevPlacement.placedOrientations[Ut.crossTileID];wt&&(this.placedOrientations[Ut.crossTileID]=wt,It=wt,this.markUsedOrientation(v,It,Ut))}return It},$e=(nt,It)=>{if(v.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(let wt of v.writingModes)if(wt===o.ah.vertical?(vi=It(),m=vi):vi=nt(),vi&&vi.placeable)break}else vi=nt()},Qe=Ut.textAnchorOffsetStartIndex,Ue=Ut.textAnchorOffsetEndIndex;if(Ue===Qe){let nt=(It,wt)=>{let at=this.collisionIndex.placeCollisionBox(It,Pe,K,Lt,V,Ge,qe,O,Ae.predicate,Tt,void 0,er);return at&&at.placeable&&(this.markUsedOrientation(v,wt,Ut),this.placedOrientations[Ut.crossTileID]=wt),at};$e(()=>nt(N,o.ah.horizontal),()=>{let It=mt.verticalTextBox;return v.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&It?nt(It,o.ah.vertical):{box:null,offscreen:null}}),we(vi&&vi.placeable)}else{let nt=o.ay[(Hr=(Ri=this.prevPlacement)===null||Ri===void 0?void 0:Ri.variableOffsets[Ut.crossTileID])===null||Hr===void 0?void 0:Hr.anchor],It=(at,bt,ft)=>{let ar=at.x2-at.x1,mr=at.y2-at.y1,or=Ut.textBoxScale,lr=Ze&&Ve==="never"?bt:null,Ai=null,ri=Pe==="never"?1:2,ni="never";nt&&ri++;for(let Wr=0;Wr<ri;Wr++){for(let Vr=Qe;Vr<Ue;Vr++){let Gr=v.textAnchorOffsets.get(Vr);if(nt&&Gr.textAnchor!==nt)continue;let Vi=this.attemptAnchorPlacement(Gr,at,ar,mr,or,qe,Ge,K,Lt,V,Ae,ni,Ut,v,ft,O,z,lr,Tt);if(Vi&&(Ai=Vi.placedGlyphBoxes,Ai&&Ai.placeable))return zi=!0,Wi=Vi.shift,Ai}nt?nt=null:ni=Pe}return _&&!Ai&&(Ai={box:this.collisionIndex.placeCollisionBox(N,"always",K,Lt,V,Ge,qe,O,Ae.predicate,Tt,void 0,er).box,offscreen:!1,placeable:!1,occluded:!1}),Ai};$e(()=>It(N,mt.iconBox,o.ah.horizontal),()=>{let at=mt.verticalTextBox;return v.allowVerticalPlacement&&(!vi||!vi.placeable)&&Ut.numVerticalGlyphVertices>0&&at?It(at,mt.verticalIconBox,o.ah.vertical):{box:null,occluded:!0,offscreen:null}}),vi&&(zi=vi.placeable,Ui=vi.offscreen);let wt=we(vi&&vi.placeable);if(!zi&&this.prevPlacement){let at=this.prevPlacement.variableOffsets[Ut.crossTileID];at&&(this.variableOffsets[Ut.crossTileID]=at,this.markUsedJustification(v,at.anchor,Ut,wt))}}}if(A=vi,zi=A&&A.placeable,Ui=A&&A.offscreen,Ut.useRuntimeCollisionCircles){let we=v.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),$e=o.ai(v.textSizeData,fe,we),Qe=S.get("text-padding");b=this.collisionIndex.placeCollisionCircles(Pe,we,v.lineVertexArray,v.glyphOffsetArray,$e,V,H,_,Ge,Ae.predicate,Ut.collisionCircleDiameter,Qe,O,Tt),b.circles.length&&b.collisionDetected&&!_&&o.w("Collisions detected, but collision boxes are not shown"),zi=Fe||b.circles.length>0&&!b.collisionDetected,Ui=Ui&&b.offscreen}if(mt.iconFeatureIndex&&(F=mt.iconFeatureIndex),mt.iconBox){let we=$e=>this.collisionIndex.placeCollisionBox($e,Ve,K,Lt,V,Ge,qe,z,Ae.predicate,Tt,Ze&&Wi?Wi:void 0,er);m&&m.placeable&&mt.verticalIconBox?(E=we(mt.verticalIconBox),Zi=E.placeable):(E=we(mt.iconBox),Zi=E.placeable),Ui=Ui&&E.offscreen}let W=Ie||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,Q=Ce||Ut.numIconVertices===0;W||Q?Q?W||(Zi=Zi&&zi):zi=Zi&&zi:Zi=zi=Zi&&zi;let he=Zi&&E.placeable;if(zi&&A.placeable&&this.collisionIndex.insertCollisionBox(A.box,Pe,S.get("text-ignore-placement"),v.bucketInstanceId,m&&m.placeable&&B?B:M,Ae.ID),he&&this.collisionIndex.insertCollisionBox(E.box,Ve,S.get("icon-ignore-placement"),v.bucketInstanceId,F,Ae.ID),b&&zi&&this.collisionIndex.insertCollisionCircles(b.circles,Pe,S.get("text-ignore-placement"),v.bucketInstanceId,M,Ae.ID),_&&this.storeCollisionData(v.bucketInstanceId,Nt,mt,A,E,b),Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new Yr((zi||At)&&!A?.occluded,(Zi||Pt)&&!E?.occluded,Ui||v.justReloaded),u[Ut.crossTileID]=!0};if(_t){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ut=v.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let mt=Ut.length-1;mt>=0;--mt){let Nt=Ut[mt];Kt(v.symbolInstances.get(Nt),v.collisionArrays[Nt],Nt)}}else for(let Ut=s.symbolInstanceStart;Ut<s.symbolInstanceEnd;Ut++)Kt(v.symbolInstances.get(Ut),v.collisionArrays[Ut],Ut);v.justReloaded=!1}storeCollisionData(s,u,_,v,S,O){if(_.textBox||_.iconBox){let z,V;this.collisionBoxArrays.has(s)?z=this.collisionBoxArrays.get(s):(z=new Map,this.collisionBoxArrays.set(s,z)),z.has(u)?V=z.get(u):(V={text:null,icon:null},z.set(u,V)),_.textBox&&(V.text=v.box),_.iconBox&&(V.icon=S.box)}if(O){let z=this.collisionCircleArrays[s];z===void 0&&(z=this.collisionCircleArrays[s]=[]);for(let V=0;V<O.circles.length;V+=4)z.push(O.circles[V+0]-rn),z.push(O.circles[V+1]-rn),z.push(O.circles[V+2]),z.push(O.collisionDetected?1:0)}}markUsedJustification(s,u,_,v){let S;S=v===o.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[o.aA(u)];let O=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(let z of O)z>=0&&(s.text.placedSymbolArray.get(z).crossTileID=S>=0&&z!==S?0:_.crossTileID)}markUsedOrientation(s,u,_){let v=u===o.ah.horizontal||u===o.ah.horizontalOnly?u:0,S=u===o.ah.vertical?u:0,O=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(let z of O)s.text.placedSymbolArray.get(z).placedOrientation=v;_.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,_=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let v=u?u.symbolFadeChange(s):1,S=u?u.opacities:{},O=u?u.variableOffsets:{},z=u?u.placedOrientations:{};for(let V in this.placements){let H=this.placements[V],K=S[V];K?(this.opacities[V]=new Ct(K,v,H.text,H.icon),_=_||H.text!==K.text.placed||H.icon!==K.icon.placed):(this.opacities[V]=new Ct(null,v,H.text,H.icon,H.skipFade),_=_||H.text||H.icon)}for(let V in S){let H=S[V];if(!this.opacities[V]){let K=new Ct(H,v,!1,!1);K.isHidden()||(this.opacities[V]=K,_=_||H.text.placed||H.icon.placed)}}for(let V in O)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=O[V]);for(let V in z)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=z[V]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u){let _={};for(let v of u){let S=v.getBucket(s);S&&v.latestFeatureIndex&&s.id===S.layerIds[0]&&this.updateBucketOpacities(S,v.tileID,_,v.collisionBoxArray)}}updateBucketOpacities(s,u,_,v){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();let S=s.layers[0],O=S.layout,z=new Ct(null,0,!1,!1,!0),V=O.get("text-allow-overlap"),H=O.get("icon-allow-overlap"),K=S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ne=O.get("text-rotation-alignment")==="map",ie=O.get("text-pitch-alignment")==="map",fe=O.get("icon-text-fit")!=="none",Ae=new Ct(null,0,V&&(H||!s.hasIconData()||O.get("icon-optional")),H&&(V||!s.hasTextData()||O.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);let Ie=(Pe,Fe,Ve)=>{for(let Be=0;Be<Fe/4;Be++)Pe.opacityVertexArray.emplaceBack(Ve);Pe.hasVisibleVertices=Pe.hasVisibleVertices||Ve!==Fa},Ce=this.collisionBoxArrays.get(s.bucketInstanceId);for(let Pe=0;Pe<s.symbolInstances.length;Pe++){let Fe=s.symbolInstances.get(Pe),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:Be,crossTileID:qe}=Fe,Ge=this.opacities[qe];_[qe]?Ge=z:Ge||(Ge=Ae,this.opacities[qe]=Ge),_[qe]=!0;let Ze=Fe.numIconVertices>0,_t=this.placedOrientations[Fe.crossTileID],At=_t===o.ah.vertical,Pt=_t===o.ah.horizontal||_t===o.ah.horizontalOnly;if(Ve>0||Be>0){let Tt=Gd(Ge.text);Ie(s.text,Ve,At?Fa:Tt),Ie(s.text,Be,Pt?Fa:Tt);let er=Ge.text.isHidden();[Fe.rightJustifiedTextSymbolIndex,Fe.centerJustifiedTextSymbolIndex,Fe.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(s.text.placedSymbolArray.get(mt).hidden=er||At?1:0)}),Fe.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Fe.verticalPlacedTextSymbolIndex).hidden=er||Pt?1:0);let Kt=this.variableOffsets[Fe.crossTileID];Kt&&this.markUsedJustification(s,Kt.anchor,Fe,_t);let Ut=this.placedOrientations[Fe.crossTileID];Ut&&(this.markUsedJustification(s,"left",Fe,Ut),this.markUsedOrientation(s,Ut,Fe))}if(Ze){let Tt=Gd(Ge.icon),er=!(fe&&Fe.verticalPlacedIconSymbolIndex&&At);Fe.placedIconSymbolIndex>=0&&(Ie(s.icon,Fe.numIconVertices,er?Tt:Fa),s.icon.placedSymbolArray.get(Fe.placedIconSymbolIndex).hidden=Ge.icon.isHidden()),Fe.verticalPlacedIconSymbolIndex>=0&&(Ie(s.icon,Fe.numVerticalIconVertices,er?Fa:Tt),s.icon.placedSymbolArray.get(Fe.verticalPlacedIconSymbolIndex).hidden=Ge.icon.isHidden())}let Lt=Ce&&Ce.has(Pe)?Ce.get(Pe):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){let Tt=s.collisionArrays[Pe];if(Tt){let er=new o.P(0,0);if(Tt.textBox||Tt.verticalTextBox){let Kt=!0;if(K){let Ut=this.variableOffsets[qe];Ut?(er=Qn(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),ne&&er._rotate(ie?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Kt=!1}if(Tt.textBox||Tt.verticalTextBox){let Ut;Tt.textBox&&(Ut=At),Tt.verticalTextBox&&(Ut=Pt),ho(s.textCollisionBox.collisionVertexArray,Ge.text.placed,!Kt||Ut,Lt.text,er.x,er.y)}}if(Tt.iconBox||Tt.verticalIconBox){let Kt=!!(!Pt&&Tt.verticalIconBox),Ut;Tt.iconBox&&(Ut=Kt),Tt.verticalIconBox&&(Ut=!Kt),ho(s.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Ut,Lt.icon,fe?er.x:0,fe?er.y:0)}}}}if(s.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);s.bucketInstanceId in this.collisionCircleArrays&&(s.collisionCircleArray=this.collisionCircleArrays[s.bucketInstanceId],delete this.collisionCircleArrays[s.bucketInstanceId])}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){let _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>s}setStale(){this.stale=!0}}function ho(C,s,u,_,v,S){_&&_.length!==0||(_=[0,0,0,0]);let O=_[0]-rn,z=_[1]-rn,V=_[2]-rn,H=_[3]-rn;C.emplaceBack(s?1:0,u?1:0,v||0,S||0,O,z),C.emplaceBack(s?1:0,u?1:0,v||0,S||0,V,z),C.emplaceBack(s?1:0,u?1:0,v||0,S||0,V,H),C.emplaceBack(s?1:0,u?1:0,v||0,S||0,O,H)}let wi=Math.pow(2,25),Wl=Math.pow(2,24),ls=Math.pow(2,17),nh=Math.pow(2,16),cs=Math.pow(2,9),af=Math.pow(2,8),$c=Math.pow(2,1);function Gd(C){if(C.opacity===0&&!C.placed)return 0;if(C.opacity===1&&C.placed)return 4294967295;let s=C.placed?1:0,u=Math.floor(127*C.opacity);return u*wi+s*Wl+u*ls+s*nh+u*cs+s*af+u*$c+s}let Fa=0;class $l{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,u,_,v,S){let O=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(O,v,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((z,V)=>z.sortKey-V.sortKey));this._currentPartIndex<O.length;)if(u.placeLayerBucketPart(O[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,S())return!0;return!1}}class Jn{constructor(s,u,_,v,S,O,z,V){this.placement=new Cs(s,u,O,z,V),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(s,u,_){let v=x.now(),S=()=>!this._forceFullPlacement&&x.now()-v>2;for(;this._currentPlacementIndex>=0;){let O=u[s[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=z)&&(!O.maxzoom||O.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new $l(O)),this._inProgressLayer.continuePlacement(_[O.source],this.placement,this._showCollisionBoxes,O,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}let qc=512/o.Z/2;class KA{constructor(s,u,_){this.tileID=s,this.bucketInstanceId=_,this._symbolsByKey={};let v=new Map;for(let S=0;S<u.length;S++){let O=u.get(S),z=O.key,V=v.get(z);V?V.push(O):v.set(z,[O])}for(let[S,O]of v){let z={positions:O.map(V=>({x:Math.floor(V.anchorX*qc),y:Math.floor(V.anchorY*qc)})),crossTileIDs:O.map(V=>V.crossTileID)};if(z.positions.length>128){let V=new o.aC(z.positions.length,16,Uint16Array);for(let{x:H,y:K}of z.positions)V.add(H,K);V.finish(),delete z.positions,z.index=V}this._symbolsByKey[S]=z}}getScaledCoordinates(s,u){let{x:_,y:v,z:S}=this.tileID.canonical,{x:O,y:z,z:V}=u.canonical,H=qc/Math.pow(2,V-S),K=(z*o.Z+s.anchorY)*H,ne=v*o.Z*qc;return{x:Math.floor((O*o.Z+s.anchorX)*H-_*o.Z*qc),y:Math.floor(K-ne)}}findMatches(s,u,_){let v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let S=0;S<s.length;S++){let O=s.get(S);if(O.crossTileID)continue;let z=this._symbolsByKey[O.key];if(!z)continue;let V=this.getScaledCoordinates(O,u);if(z.index){let H=z.index.range(V.x-v,V.y-v,V.x+v,V.y+v).sort();for(let K of H){let ne=z.crossTileIDs[K];if(!_[ne]){_[ne]=!0,O.crossTileID=ne;break}}}else if(z.positions)for(let H=0;H<z.positions.length;H++){let K=z.positions[H],ne=z.crossTileIDs[H];if(Math.abs(K.x-V.x)<=v&&Math.abs(K.y-V.y)<=v&&!_[ne]){_[ne]=!0,O.crossTileID=ne;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Dg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class QA{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){let u=Math.round((s-this.lng)/360);if(u!==0)for(let _ in this.indexes){let v=this.indexes[_],S={};for(let O in v){let z=v[O];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+u),S[z.tileID.key]=z}this.indexes[_]=S}this.lng=s}addBucket(s,u,_){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let S=0;S<u.symbolInstances.length;S++)u.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});let v=this.usedCrossTileIDs[s.overscaledZ];for(let S in this.indexes){let O=this.indexes[S];if(Number(S)>s.overscaledZ)for(let z in O){let V=O[z];V.tileID.isChildOf(s)&&V.findMatches(u.symbolInstances,s,v)}else{let z=O[s.scaledTo(Number(S)).key];z&&z.findMatches(u.symbolInstances,s,v)}}for(let S=0;S<u.symbolInstances.length;S++){let O=u.symbolInstances.get(S);O.crossTileID||(O.crossTileID=_.generate(),v[O.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new KA(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(let _ of u.getCrossTileIDsLists())for(let v of _)delete this.usedCrossTileIDs[s][v]}removeStaleBuckets(s){let u=!1;for(let _ in this.indexes){let v=this.indexes[_];for(let S in v)s[v[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[S]),delete v[S],u=!0)}return u}}class Hd{constructor(){this.layerIndexes={},this.crossTileIDs=new Dg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,_){let v=this.layerIndexes[s.id];v===void 0&&(v=this.layerIndexes[s.id]=new QA);let S=!1,O={};v.handleWrapJump(_);for(let z of u){let V=z.getBucket(s);V&&s.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(z.tileID,V,this.crossTileIDs)&&(S=!0),O[V.bucketInstanceId]=!0)}return v.removeStaleBuckets(O)&&(S=!0),S}pruneUnusedLayers(s){let u={};s.forEach(_=>{u[_]=!0});for(let _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}var lf="void main() {fragColor=vec4(1.0);}";let ga={prelude:hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:hi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:hi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:hi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hi(lf,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:hi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:hi(lf,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:hi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:hi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:hi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:hi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:hi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:hi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:hi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:hi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function hi(C,s){let u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=s.match(/in ([\w]+) ([\w]+)/g),v=C.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=S?S.concat(v):v,z={};return{fragmentSource:C=C.replace(u,(V,H,K,ne,ie)=>(z[ie]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
in ${K} ${ne} ${ie};
#else
uniform ${K} ${ne} u_${ie};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ie}
    ${K} ${ne} ${ie} = u_${ie};
#endif
`)),vertexSource:s=s.replace(u,(V,H,K,ne,ie)=>{let fe=ne==="float"?"vec2":"vec4",Ae=ie.match(/color/)?"color":fe;return z[ie]?H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${K} ${fe} a_${ie};
out ${K} ${ne} ${ie};
#else
uniform ${K} ${ne} u_${ie};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = a_${ie};
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = unpack_mix_${Ae}(a_${ie}, u_${ie}_t);
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${K} ${fe} a_${ie};
#else
uniform ${K} ${ne} u_${ie};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${K} ${ne} ${ie} = a_${ie};
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${K} ${ne} ${ie} = unpack_mix_${Ae}(a_${ie}, u_${ie}_t);
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`}),staticAttributes:_,staticUniforms:O}}class Zc{constructor(s,u,_){this.vertexBuffer=s,this.indexBuffer=u,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ql=o.aD([{name:"a_pos",type:"Int16",components:2}]);let cl="#define PROJECTION_MERCATOR",oh="mercator";class Ti{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return oh}get shaderDefine(){return cl}get shaderPreludeCode(){return ga.projectionMercator}get vertexShaderPreludeCode(){return ga.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aE.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(s){}getMeshFromTileID(s,u,_,v,S){if(this._cachedMesh)return this._cachedMesh;let O=new o.aF;O.emplaceBack(0,0),O.emplaceBack(o.Z,0),O.emplaceBack(0,o.Z),O.emplaceBack(o.Z,o.Z);let z=s.createVertexBuffer(O,ql.members),V=o.aG.simpleSegment(0,0,4,2),H=new o.aH;H.emplaceBack(1,0,2),H.emplaceBack(1,2,3);let K=s.createIndexBuffer(H);return this._cachedMesh=new Zc(z,K,V),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(s){}}function Js(C,s){let u=o.ae(s.lat,-85.051129,o.aJ);return new o.P(o.U(s.lng)*C,o.S(u)*C)}function cf(C,s){return new o.$(s.x/C,s.y/C).toLngLat()}function sh(C){return C.cameraToCenterDistance*Math.min(.85*Math.tan(o.ad(90-C.pitch)),Math.tan(o.ad(89.25-C.pitch)))}function us(C,s){let u=C.canonical,_=s/o.aI(u.z),v=u.x+Math.pow(2,u.z)*C.wrap,S=o.at(new Float64Array(16));return o.L(S,S,[v*_,u.y*_,0]),o.M(S,S,[_/o.Z,_/o.Z,1]),S}function Fo(C,s,u,_,v){let S=o.$.fromLngLat(C,s),O=v*o.aK(1,C.lat),z=O*Math.cos(o.ad(u)),V=Math.sqrt(O*O-z*z),H=V*Math.sin(o.ad(-_)),K=V*Math.cos(o.ad(-_));return new o.$(S.x+H,S.y+K,S.z+z)}class bn{constructor(s=0,u=0,_=0,v=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=_,this.right=v}interpolate(s,u,_){return u.top!=null&&s.top!=null&&(this.top=o.B.number(s.top,u.top,_)),u.bottom!=null&&s.bottom!=null&&(this.bottom=o.B.number(s.bottom,u.bottom,_)),u.left!=null&&s.left!=null&&(this.left=o.B.number(s.left,u.left,_)),u.right!=null&&s.right!=null&&(this.right=o.B.number(s.right,u.right,_)),this}getCenter(s,u){let _=o.ae((this.left+s-this.right)/2,0,s),v=o.ae((this.top+u-this.bottom)/2,0,u);return new o.P(_,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new bn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Wd(C,s){if(!C.renderWorldCopies||C.lngRange)return;let u=s.lng-C.center.lng;s.lng+=u>180?-360:u<-180?360:0}function hs(C){return Math.max(0,Math.floor(C))}class Ss{constructor(s,u,_,v,S,O){this._callbacks=s,this._tileSize=512,this._renderWorldCopies=O===void 0||!!O,this._minZoom=u||0,this._maxZoom=_||22,this._minPitch=v??0,this._maxPitch=S??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=hs(this._zoom),this._scale=o.aI(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new bn,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(s,u,_){this._latRange=s.latRange,this._lngRange=s.lngRange,this._width=s.width,this._height=s.height,this._center=s.center,this._elevation=s.elevation,this._minElevationForCurrentTile=s.minElevationForCurrentTile,this._zoom=s.zoom,this._tileZoom=hs(this._zoom),this._scale=o.aI(this._zoom),this._bearingInRadians=s.bearingInRadians,this._fovInRadians=s.fovInRadians,this._pitchInRadians=s.pitchInRadians,this._rollInRadians=s.rollInRadians,this._unmodified=s.unmodified,this._edgeInsets=new bn(s.padding.top,s.padding.bottom,s.padding.left,s.padding.right),this._minZoom=s.minZoom,this._maxZoom=s.maxZoom,this._minPitch=s.minPitch,this._maxPitch=s.maxPitch,this._renderWorldCopies=s.renderWorldCopies,this._cameraToCenterDistance=s.cameraToCenterDistance,this._nearZ=s.nearZ,this._farZ=s.farZ,this._autoCalculateNearFarZ=!_&&s.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(s){this._minElevationForCurrentTile=s}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(s){this._minZoom!==s&&(this._minZoom=s,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(s){this._minPitch!==s&&(this._minPitch=s,this.setPitch(Math.max(this.pitch,s)))}get maxPitch(){return this._maxPitch}setMaxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.setPitch(Math.min(this.pitch,s)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(s){let u=o.aL(s,-180,180)*Math.PI/180;var _,v,S,O,z,V,H,K,ne;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=c(),_=this._rotationMatrix,S=-this._bearingInRadians,O=(v=this._rotationMatrix)[0],z=v[1],V=v[2],H=v[3],K=Math.sin(S),ne=Math.cos(S),_[0]=O*ne+V*K,_[1]=z*ne+H*K,_[2]=O*-K+V*ne,_[3]=z*-K+H*ne)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(s){let u=o.ae(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(s){let u=s/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aM(this._fovInRadians)}setFov(s){s=o.ae(s,.1,150),this.fov!==s&&(this._unmodified=!1,this._fovInRadians=o.ad(s),this._calcMatrices())}get zoom(){return this._zoom}setZoom(s){let u=this.getConstrained(this._center,s).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=o.aI(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(s,u){this._autoCalculateNearFarZ=!1,this._nearZ=s,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,_){this._unmodified=!1,this._edgeInsets.interpolate(s,u,_),this._constrain(),this._calcMatrices()}resize(s,u,_=!0){this._width=s,this._height=u,_&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new ui([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(s){s?(this._lngRange=[s.getWest(),s.getEast()],this._latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,o.aJ])}getConstrained(s,u){return this._callbacks.getConstrained(s,u)}getCameraQueryGeometry(s,u){if(u.length===1)return[u[0],s];{let _=s.x,v=s.y,S=s.x,O=s.y;for(let z of u)_=Math.min(_,z.x),v=Math.min(v,z.y),S=Math.max(S,z.x),O=Math.max(O,z.y);return[new o.P(_,v),new o.P(S,v),new o.P(S,O),new o.P(_,O),new o.P(_,v)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let s=this._unmodified,{center:u,zoom:_}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(_),this._unmodified=s,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let s=o.at(new Float64Array(16));o.M(s,s,[this._width/2,-this._height/2,1]),o.L(s,s,[1,-1,0]),this._clipSpaceToPixelsMatrix=s,s=o.at(new Float64Array(16)),o.M(s,s,[1,-1,1]),o.L(s,s,[-1,-1,0]),o.M(s,s,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=s,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(s,u,_,v){let S=_!==void 0?_:this.bearing,O=v=v!==void 0?v:this.pitch,z=o.$.fromLngLat(s,u),V=-Math.cos(o.ad(O)),H=Math.sin(o.ad(O)),K=H*Math.sin(o.ad(S)),ne=-H*Math.cos(o.ad(S)),ie=this.elevation,fe=u-ie,Ae;V*fe>=0||Math.abs(V)<.1?(Ae=1e4,ie=u+Ae*V):Ae=-fe/V;let Ie,Ce,Pe=o.aN(1,z.y),Fe=0;do{if(Fe+=1,Fe>10)break;Ce=Ae/Pe,Ie=new o.$(z.x+K*Ce,z.y+ne*Ce),Pe=1/Ie.meterInMercatorCoordinateUnits()}while(Math.abs(Ae-Ce*Pe)>1e-12);return{center:Ie.toLngLat(),elevation:ie,zoom:o.ab(this.height/2/Math.tan(this.fovInRadians/2)/Ce/this.tileSize)}}recalculateZoomAndCenter(s){if(this.elevation-s==0)return;let u=o.aK(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/u,v=o.$.fromLngLat(this.center,this.elevation),S=Fo(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=s;let O=this.calculateCenterFromCameraLngLatAlt(S.toLngLat(),o.aN(S.z,v.y),this.bearing,this.pitch);this._elevation=O.elevation,this._center=O.center,this.setZoom(O.zoom)}getCameraPoint(){let s=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(s*Math.sin(this.rollInRadians),s*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let s=o.aK(1,this.center.lat)*this.worldSize;return Fo(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/s).toLngLat()}getMercatorTileCoordinates(s){if(!s)return[0,0,1,1];let u=s.canonical.z>=0?1<<s.canonical.z:Math.pow(2,s.canonical.z);return[s.canonical.x/u,s.canonical.y/u,1/u/o.Z,1/u/o.Z]}}class fo{constructor(s,u){this.min=s,this.max=u,this.center=o.aO([],o.aP([],this.min,this.max),.5)}quadrant(s){let u=[s%2==0,s<2],_=o.aQ(this.min),v=o.aQ(this.max);for(let S=0;S<u.length;S++)_[S]=u[S]?this.min[S]:this.center[S],v[S]=u[S]?this.center[S]:this.max[S];return v[2]=this.max[2],new fo(_,v)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersectsFrustum(s){let u=!0;for(let _=0;_<s.planes.length;_++){let v=this.intersectsPlane(s.planes[_]);if(v===0)return 0;v===1&&(u=!1)}return u?2:s.aabb.min[0]>this.max[0]||s.aabb.min[1]>this.max[1]||s.aabb.min[2]>this.max[2]||s.aabb.max[0]<this.min[0]||s.aabb.max[1]<this.min[1]||s.aabb.max[2]<this.min[2]?0:1}intersectsPlane(s){let u=s[3],_=s[3];for(let v=0;v<3;v++)s[v]>0?(u+=s[v]*this.min[v],_+=s[v]*this.max[v]):(_+=s[v]*this.min[v],u+=s[v]*this.max[v]);return u>=0?2:_<0?0:1}}class Fg{distanceToTile2d(s,u,_,v){let S=v.distanceX([s,u]),O=v.distanceY([s,u]);return Math.hypot(S,O)}getWrap(s,u,_){return _}getTileAABB(s,u,_,v){var S,O;let z=_,V=_;if(v.terrain){let K=new o.Y(s.z,u,s.z,s.x,s.y),ne=v.terrain.getMinMaxElevation(K);z=(S=ne.minElevation)!==null&&S!==void 0?S:_,V=(O=ne.maxElevation)!==null&&O!==void 0?O:_}let H=1<<s.z;return new fo([u+s.x/H,s.y/H,z],[u+(s.x+1)/H,(s.y+1)/H,V])}allowVariableZoom(s,u){let _=s.fov*(Math.abs(Math.cos(s.rollInRadians))*s.height+Math.abs(Math.sin(s.rollInRadians))*s.width)/s.height,v=o.ae(78.5-_/2,0,60);return!!u.terrain||s.pitch>v}allowWorldCopies(){return!0}recalculateCache(){}}class Zl{constructor(s,u,_){this.points=s,this.planes=u,this.aabb=_}static fromInvProjectionMatrix(s,u=1,_=0){let v=Math.pow(2,_),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{let K=1/(H=o.ap([],H,s))[3]/u*v;return o.aR(H,H,[K,K,1/H[3],K])}),O=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{let K=o.aS([],S[H[0]],S[H[1]]),ne=o.aS([],S[H[2]],S[H[1]]),ie=o.aT([],o.aU([],K,ne)),fe=-o.aV(ie,S[H[1]]);return ie.concat(fe)}),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],V=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let H of S)for(let K=0;K<3;K++)z[K]=Math.min(z[K],H[K]),V[K]=Math.max(V[K],H[K]);return new Zl(S,O,new fo(z,V))}}class vn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,u,_){return this._helper.interpolatePadding(s,u,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,u,_=!0){this._helper.resize(s,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,u){this._helper.overrideNearFarZ(s,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s,u){}constructor(s,u,_,v,S){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ss({calcMatrices:()=>{this._calcMatrices()},getConstrained:(O,z)=>this.getConstrained(O,z)},s,u,_,v,S),this._coveringTilesDetailsProvider=new Fg}clone(){let s=new vn;return s.apply(this),s}apply(s,u,_){this._helper.apply(s,u,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(s){let u=[new o.aW(0,s)];if(this._helper._renderWorldCopies){let _=this.screenPointToMercatorCoordinate(new o.P(0,0)),v=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),S=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),O=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),z=Math.floor(Math.min(_.x,v.x,S.x,O.x)),V=Math.floor(Math.max(_.x,v.x,S.x,O.x)),H=1;for(let K=z-H;K<=V+H;K++)K!==0&&u.push(new o.aW(K,s))}return u}getCameraFrustum(){return Zl.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){let u=this.screenPointToLocation(this.centerPoint,s),_=s?s.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(s,u){let _=o.aK(this.elevation,this.center.lat),v=this.screenPointToMercatorCoordinateAtZ(u,_),S=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),O=o.$.fromLngLat(s),z=new o.$(O.x-(v.x-S.x),O.y-(v.y-S.y));this.setCenter(z?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(s,u){return u?this.coordinatePoint(o.$.fromLngLat(s),u.getElevationForLngLatZoom(s,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.$.fromLngLat(s))}screenPointToLocation(s,u){var _;return(_=this.screenPointToMercatorCoordinate(s,u))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(s,u){if(u){let _=u.pointCoordinate(s);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(s)}screenPointToMercatorCoordinateAtZ(s,u){let _=u||0,v=[s.x,s.y,0,1],S=[s.x,s.y,1,1];o.ap(v,v,this._pixelMatrixInverse),o.ap(S,S,this._pixelMatrixInverse);let O=v[3],z=S[3],V=v[1]/O,H=S[1]/z,K=v[2]/O,ne=S[2]/z,ie=K===ne?0:(_-K)/(ne-K);return new o.$(o.B.number(v[0]/O,S[0]/z,ie)/this.worldSize,o.B.number(V,H,ie)/this.worldSize,_)}coordinatePoint(s,u=0,_=this._pixelMatrix){let v=[s.x*this.worldSize,s.y*this.worldSize,u,1];return o.ap(v,v,_),new o.P(v[0]/v[3],v[1]/v[3])}getBounds(){let s=Math.max(0,this._helper._height/2-sh(this));return new ui().extend(this.screenPointToLocation(new o.P(0,s))).extend(this.screenPointToLocation(new o.P(this._helper._width,s))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(s,u){return u?u.pointCoordinate(s)!=null:s.y>this.height/2-sh(this)}calculatePosMatrix(s,u=!1,_){var v;let S=(v=s.key)!==null&&v!==void 0?v:o.aX(s.wrap,s.canonical.z,s.canonical.z,s.canonical.x,s.canonical.y),O=u?this._alignedPosMatrixCache:this._posMatrixCache;if(O.has(S)){let H=O.get(S);return _?H.f32:H.f64}let z=us(s,this.worldSize);o.N(z,u?this._alignedProjMatrix:this._viewProjMatrix,z);let V={f64:z,f32:new Float32Array(z)};return O.set(S,V),_?V.f32:V.f64}calculateFogMatrix(s){let u=s.key,_=this._fogMatrixCacheF32;if(_.has(u))return _.get(u);let v=us(s,this.worldSize);return o.N(v,this._fogMatrix,v),_.set(u,new Float32Array(v)),_.get(u)}getConstrained(s,u){u=o.ae(+u,this.minZoom,this.maxZoom);let _={center:new o.Q(s.lng,s.lat),zoom:u},v=this._helper._lngRange;this._helper._renderWorldCopies||v!==null||(v=[-179.9999999999,180-1e-10]);let S=this.tileSize*o.aI(_.zoom),O=0,z=S,V=0,H=S,K=0,ne=0,{x:ie,y:fe}=this.size;if(this._helper._latRange){let Ve=this._helper._latRange;O=o.S(Ve[1])*S,z=o.S(Ve[0])*S,z-O<fe&&(K=fe/(z-O))}v&&(V=o.aL(o.U(v[0])*S,0,S),H=o.aL(o.U(v[1])*S,0,S),H<V&&(H+=S),H-V<ie&&(ne=ie/(H-V)));let{x:Ae,y:Ie}=Js(S,s),Ce,Pe,Fe=Math.max(ne||0,K||0);if(Fe){let Ve=new o.P(ne?(H+V)/2:Ae,K?(z+O)/2:Ie);return _.center=cf(S,Ve).wrap(),_.zoom+=o.ab(Fe),_}if(this._helper._latRange){let Ve=fe/2;Ie-Ve<O&&(Pe=O+Ve),Ie+Ve>z&&(Pe=z-Ve)}if(v){let Ve=(V+H)/2,Be=Ae;this._helper._renderWorldCopies&&(Be=o.aL(Ae,Ve-S/2,Ve+S/2));let qe=ie/2;Be-qe<V&&(Ce=V+qe),Be+qe>H&&(Ce=H-qe)}if(Ce!==void 0||Pe!==void 0){let Ve=new o.P(Ce??Ae,Pe??Ie);_.center=cf(S,Ve).wrap()}return _}calculateCenterFromCameraLngLatAlt(s,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(s,u,_,v)}_calculateNearFarZIfNeeded(s,u,_){if(!this._helper.autoCalculateNearFarZ)return;let v=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),S=s-v*this._helper._pixelPerMeter/Math.cos(u),O=v<0?S:s,z=Math.PI/2+this.pitchInRadians,V=o.ad(this.fov)*(Math.abs(Math.cos(o.ad(this.roll)))*this.height+Math.abs(Math.sin(o.ad(this.roll)))*this.width)/this.height*(.5+_.y/this.height),H=Math.sin(V)*O/Math.sin(o.ae(Math.PI-z-V,.01,Math.PI-.01)),K=sh(this),ne=Math.atan(K/this._helper.cameraToCenterDistance),ie=o.ad(.75),fe=ne>ie?2*ne*(.5+_.y/(2*K)):ie,Ae=Math.sin(fe)*O/Math.sin(o.ae(Math.PI-z-fe,.01,Math.PI-.01)),Ie=Math.min(H,Ae);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*Ie+O),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let s=this.centerOffset,u=Js(this.worldSize,this.center),_=u.x,v=u.y;this._helper._pixelPerMeter=o.aK(1,this.center.lat)*this.worldSize;let S=o.ad(Math.min(this.pitch,89.25)),O=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(S)),z;this._calculateNearFarZIfNeeded(O,S,s),z=new Float64Array(16),o.aY(z,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aj(this._invProjMatrix,z),z[8]=2*-s.x/this._helper._width,z[9]=2*s.y/this._helper._height,this._projectionMatrix=o.aZ(z),o.M(z,z,[1,-1,1]),o.L(z,z,[0,0,-this._helper.cameraToCenterDistance]),o.a_(z,z,-this.rollInRadians),o.a$(z,z,this.pitchInRadians),o.a_(z,z,-this.bearingInRadians),o.L(z,z,[-_,-v,0]),this._mercatorMatrix=o.M([],z,[this.worldSize,this.worldSize,this.worldSize]),o.M(z,z,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,z),o.L(z,z,[0,0,-this.elevation]),this._viewProjMatrix=z,this._invViewProjMatrix=o.aj([],z);let V=[0,0,-1,1];o.ap(V,V,this._invViewProjMatrix),this._cameraPosition=[V[0]/V[3],V[1]/V[3],V[2]/V[3]],this._fogMatrix=new Float64Array(16),o.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,O,this._helper._farZ),this._fogMatrix[8]=2*-s.x/this.width,this._fogMatrix[9]=2*s.y/this.height,o.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.L(this._fogMatrix,this._fogMatrix,[-_,-v,0]),o.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,z);let H=this._helper._width%2/2,K=this._helper._height%2/2,ne=Math.cos(this.bearingInRadians),ie=Math.sin(-this.bearingInRadians),fe=_-Math.round(_)+ne*H+ie*K,Ae=v-Math.round(v)+ne*K+ie*H,Ie=new Float64Array(z);if(o.L(Ie,Ie,[fe>.5?fe-1:fe,Ae>.5?Ae-1:Ae,0]),this._alignedProjMatrix=Ie,z=o.aj(new Float64Array(16),this._pixelMatrix),!z)throw new Error("failed to invert matrix");this._pixelMatrixInverse=z,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let s=this.screenPointToMercatorCoordinate(new o.P(0,0)),u=[s.x*this.worldSize,s.y*this.worldSize,0,1];return o.ap(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let s=o.aK(1,this.center.lat)*this.worldSize;return Fo(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/s).toLngLat()}lngLatToCameraDepth(s,u){let _=o.$.fromLngLat(s),v=[_.x*this.worldSize,_.y*this.worldSize,u,1];return o.ap(v,v,this._viewProjMatrix),v[2]/v[3]}getProjectionData(s){let{overscaledTileID:u,aligned:_,applyTerrainMatrix:v}=s,S=this._helper.getMercatorTileCoordinates(u),O=u?this.calculatePosMatrix(u,_,!0):null,z;return z=u&&u.terrainRttPosMatrix32f&&v?u.terrainRttPosMatrix32f:O||o.b0(),{mainMatrix:z,tileMercatorCoords:S,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:z}}isLocationOccluded(s){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(s,u,_){return 1}transformLightDirection(s){return o.aQ(s)}getRayDirectionFromPixel(s){throw new Error("Not implemented.")}projectTileCoordinates(s,u,_,v){let S=this.calculatePosMatrix(_),O;v?(O=[s,u,v(s,u),1],o.ap(O,O,S)):(O=[s,u,0,1],Kn(O,O,S));let z=O[3];return{point:new o.P(O[0]/z,O[1]/z),signedDistanceFromCamera:z,isOccluded:!1}}populateCache(s){for(let u of s)this.calculatePosMatrix(u)}getMatrixForModel(s,u){let _=o.$.fromLngLat(s,u),v=_.meterInMercatorCoordinateUnits(),S=o.b1();return o.L(S,S,[_.x,_.y,_.z]),o.a_(S,S,Math.PI),o.a$(S,S,Math.PI/2),o.M(S,S,[-v,v,v]),S}getProjectionDataForCustomLayer(s=!0){let u=new o.Y(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:s}),v=us(u,this.worldSize);o.N(v,this._viewProjMatrix,v),_.tileMercatorCoords=[0,0,1,1];let S=[o.Z,o.Z,this.worldSize/this._helper.pixelsPerMeter],O=o.b2();return o.M(O,v,S),_.fallbackMatrix=O,_.mainMatrix=O,_}getFastPathSimpleProjectionMatrix(s){return this.calculatePosMatrix(s)}}function ah(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Xl(C){if(C.useSlerp)if(C.k<1){let s=o.b3(C.startEulerAngles.roll,C.startEulerAngles.pitch,C.startEulerAngles.bearing),u=o.b3(C.endEulerAngles.roll,C.endEulerAngles.pitch,C.endEulerAngles.bearing),_=new Float64Array(4);o.b4(_,s,u,C.k);let v=o.b5(_);C.tr.setRoll(v.roll),C.tr.setPitch(v.pitch),C.tr.setBearing(v.bearing)}else C.tr.setRoll(C.endEulerAngles.roll),C.tr.setPitch(C.endEulerAngles.pitch),C.tr.setBearing(C.endEulerAngles.bearing);else C.tr.setRoll(o.B.number(C.startEulerAngles.roll,C.endEulerAngles.roll,C.k)),C.tr.setPitch(o.B.number(C.startEulerAngles.pitch,C.endEulerAngles.pitch,C.k)),C.tr.setBearing(o.B.number(C.startEulerAngles.bearing,C.endEulerAngles.bearing,C.k))}function uf(C,s,u,_,v){let S=v.padding,O=Js(v.worldSize,u.getNorthWest()),z=Js(v.worldSize,u.getNorthEast()),V=Js(v.worldSize,u.getSouthEast()),H=Js(v.worldSize,u.getSouthWest()),K=o.ad(-_),ne=O.rotate(K),ie=z.rotate(K),fe=V.rotate(K),Ae=H.rotate(K),Ie=new o.P(Math.max(ne.x,ie.x,Ae.x,fe.x),Math.max(ne.y,ie.y,Ae.y,fe.y)),Ce=new o.P(Math.min(ne.x,ie.x,Ae.x,fe.x),Math.min(ne.y,ie.y,Ae.y,fe.y)),Pe=Ie.sub(Ce),Fe=(v.width-(S.left+S.right+s.left+s.right))/Pe.x,Ve=(v.height-(S.top+S.bottom+s.top+s.bottom))/Pe.y;if(Ve<0||Fe<0)return void ah();let Be=Math.min(o.ab(v.scale*Math.min(Fe,Ve)),C.maxZoom),qe=o.P.convert(C.offset),Ge=new o.P((s.left-s.right)/2,(s.top-s.bottom)/2).rotate(o.ad(_)),Ze=qe.add(Ge).mult(v.scale/o.aI(Be));return{center:cf(v.worldSize,O.add(V).div(2).sub(Ze)),zoom:Be,bearing:_}}class Is{get useGlobeControls(){return!1}handlePanInertia(s,u){return{easingOffset:s,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(s,u){s.bearingDelta&&u.setBearing(u.bearing+s.bearingDelta),s.pitchDelta&&u.setPitch(u.pitch+s.pitchDelta),s.rollDelta&&u.setRoll(u.roll+s.rollDelta),s.zoomDelta&&u.setZoom(u.zoom+s.zoomDelta)}handleMapControlsPan(s,u,_){s.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(_,s.around)}cameraForBoxAndBearing(s,u,_,v,S){return uf(s,u,_,v,S)}handleJumpToCenterZoom(s,u){s.zoom!==(u.zoom!==void 0?+u.zoom:s.zoom)&&s.setZoom(+u.zoom),u.center!==void 0&&s.setCenter(o.Q.convert(u.center))}handleEaseTo(s,u){let _=s.zoom,v=s.padding,S={roll:s.roll,pitch:s.pitch,bearing:s.bearing},O={roll:u.roll===void 0?s.roll:u.roll,pitch:u.pitch===void 0?s.pitch:u.pitch,bearing:u.bearing===void 0?s.bearing:u.bearing},z=u.zoom!==void 0,V=!s.isPaddingEqual(u.padding),H=!1,K=z?+u.zoom:s.zoom,ne=s.centerPoint.add(u.offsetAsPoint),ie=s.screenPointToLocation(ne),{center:fe,zoom:Ae}=s.getConstrained(o.Q.convert(u.center||ie),K??_);Wd(s,fe);let Ie=Js(s.worldSize,ie),Ce=Js(s.worldSize,fe).sub(Ie),Pe=o.aI(Ae-_);return H=Ae!==_,{easeFunc:Fe=>{if(H&&s.setZoom(o.B.number(_,Ae,Fe)),o.b6(S,O)||Xl({startEulerAngles:S,endEulerAngles:O,tr:s,k:Fe,useSlerp:S.roll!=O.roll}),V&&(s.interpolatePadding(v,u.padding,Fe),ne=s.centerPoint.add(u.offsetAsPoint)),u.around)s.setLocationAtPoint(u.around,u.aroundPoint);else{let Ve=o.aI(s.zoom-_),Be=Ae>_?Math.min(2,Pe):Math.max(.5,Pe),qe=Math.pow(Be,1-Fe),Ge=cf(s.worldSize,Ie.add(Ce.mult(Fe*qe)).mult(Ve));s.setLocationAtPoint(s.renderWorldCopies?Ge.wrap():Ge,ne)}},isZooming:H,elevationCenter:fe}}handleFlyTo(s,u){let _=u.zoom!==void 0,v=s.zoom,S=s.getConstrained(o.Q.convert(u.center||u.locationAtOffset),_?+u.zoom:v),O=S.center,z=S.zoom;Wd(s,O);let V=Js(s.worldSize,u.locationAtOffset),H=Js(s.worldSize,O).sub(V),K=H.mag(),ne=o.aI(z-v),ie;if(u.minZoom!==void 0){let fe=Math.min(+u.minZoom,v,z),Ae=s.getConstrained(O,fe).zoom;ie=o.aI(Ae-v)}return{easeFunc:(fe,Ae,Ie,Ce)=>{s.setZoom(fe===1?z:v+o.ab(Ae));let Pe=fe===1?O:cf(s.worldSize,V.add(H.mult(Ie)).mult(Ae));s.setLocationAtPoint(s.renderWorldCopies?Pe.wrap():Pe,Ce)},scaleOfZoom:ne,targetCenter:O,scaleOfMinZoom:ie,pixelPathLength:K}}}class mn{constructor(s,u,_){this.blendFunction=s,this.blendColor=u,this.mask=_}}mn.Replace=[1,0],mn.disabled=new mn(mn.Replace,o.b7.transparent,[!1,!1,!1,!1]),mn.unblended=new mn(mn.Replace,o.b7.transparent,[!0,!0,!0,!0]),mn.alphaBlended=new mn([1,771],o.b7.transparent,[!0,!0,!0,!0]);let ka=2305;class Di{constructor(s,u,_){this.enable=s,this.mode=u,this.frontFace=_}}Di.disabled=new Di(!1,1029,ka),Di.backCCW=new Di(!0,1029,ka),Di.frontCCW=new Di(!0,1028,ka);class ti{constructor(s,u,_){this.func=s,this.mask=u,this.range=_}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);let lh=7680;class bi{constructor(s,u,_,v,S,O){this.test=s,this.ref=u,this.mask=_,this.fail=v,this.depthFail=S,this.pass=O}}bi.disabled=new bi({func:519,mask:0},0,0,lh,lh,lh);let ch=new WeakMap;function _a(C){var s;if(ch.has(C))return ch.get(C);{let u=(s=C.getParameter(C.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return ch.set(C,u),u}}class hf{get awaitingQuery(){return!!this._readbackQueue}constructor(s){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=s;let u=s.context,_=u.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;let v=new o.aF;v.emplaceBack(-1,-1),v.emplaceBack(2,-1),v.emplaceBack(-1,2);let S=new o.aH;S.emplaceBack(0,1,2),this._fullscreenTriangle=new Zc(u.createVertexBuffer(v,ql.members),u.createIndexBuffer(S),o.aG.simpleSegment(0,0,v.length,S.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(_.TEXTURE1);let O=_.createTexture();_.bindTexture(_.TEXTURE_2D,O),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(O),_a(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){let s=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),s.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(s,u){let _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(s,u),this._updateCount++,this._measuredError}_bindFramebuffer(){let s=this._cachedRenderContext.context,u=s.gl;s.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),s.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(s,u){let _=this._cachedRenderContext.context,v=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:o.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,v.TRIANGLES,ti.disabled,bi.disabled,mn.unblended,Di.disabled,((S,O)=>({u_input:S,u_output_expected:O}))(s,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&_a(v)){v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.readBuffer(v.COLOR_ATTACHMENT0),v.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),v.bindBuffer(v.PIXEL_PACK_BUFFER,null);let S=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:S}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let s=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&_a(s)){let u=s.clientWaitSync(this._readbackQueue.sync,0,0);if(u===s.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===s.TIMEOUT_EXPIRED)return;s.bindBuffer(s.PIXEL_PACK_BUFFER,this._pbo),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),s.bindBuffer(s.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),s.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=hf._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(s){let u=0;return u+=s[0]/256,u+=s[1]/65536,u+=s[2]/16777216,s[3]<127&&(u=-u),u/128}}let ff=o.Z/128;function $d(C,s){let u=C.granularity!==void 0?Math.max(C.granularity,1):1,_=u+(C.generateBorders?2:0),v=u+(C.extendToNorthPole||C.generateBorders?1:0)+(C.extendToSouthPole||C.generateBorders?1:0),S=_+1,O=v+1,z=C.generateBorders?-1:0,V=C.generateBorders||C.extendToNorthPole?-1:0,H=u+(C.generateBorders?1:0),K=u+(C.generateBorders||C.extendToSouthPole?1:0),ne=S*O,ie=_*v*6,fe=S*O>65536;if(fe&&s==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let Ae=fe||s==="32bit",Ie=new Int16Array(2*ne),Ce=0;for(let Ve=V;Ve<=K;Ve++)for(let Be=z;Be<=H;Be++){let qe=Be/u*o.Z;Be===-1&&(qe=-64),Be===u+1&&(qe=o.Z+ff);let Ge=Ve/u*o.Z;Ve===-1&&(Ge=C.extendToNorthPole?o.b9:-64),Ve===u+1&&(Ge=C.extendToSouthPole?o.ba:o.Z+ff),Ie[Ce++]=qe,Ie[Ce++]=Ge}let Pe=Ae?new Uint32Array(ie):new Uint16Array(ie),Fe=0;for(let Ve=0;Ve<v;Ve++)for(let Be=0;Be<_;Be++){let qe=Be+1+Ve*S,Ge=Be+(Ve+1)*S,Ze=Be+1+(Ve+1)*S;Pe[Fe++]=Be+Ve*S,Pe[Fe++]=Ge,Pe[Fe++]=qe,Pe[Fe++]=qe,Pe[Fe++]=Ge,Pe[Fe++]=Ze}return{vertices:Ie.buffer.slice(0),indices:Pe.buffer.slice(0),uses32bitIndices:Ae}}let df=new o.aE({fill:new o.bb(128,2),line:new o.bb(512,0),tile:new o.bb(128,32),stencil:new o.bb(128,1),circle:3});class pf{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ga.projectionGlobe}get vertexShaderPreludeCode(){return ga.projectionMercator.vertexSource}get subdivisionGranularity(){return df}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(s){this._errorMeasurement||(this._errorMeasurement=new hf(s));let u=o.S(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,v=this._errorMeasurement.updateErrorLoop(u,_),S=x.now();v!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=v,this._errorMeasurementLastChangeTime=S);let O=Math.min(Math.max((S-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bd(O))}_getMeshKey(s){return`${s.granularity.toString(36)}_${s.generateBorders?"b":""}${s.extendToNorthPole?"n":""}${s.extendToSouthPole?"s":""}`}getMeshFromTileID(s,u,_,v,S){let O=(S==="stencil"?df.stencil:df.tile).getGranularityForZoomLevel(u.z);return this._getMesh(s,{granularity:O,generateBorders:_,extendToNorthPole:u.y===0&&v,extendToSouthPole:u.y===(1<<u.z)-1&&v})}_getMesh(s,u){let _=this._getMeshKey(u);if(_ in this._tileMeshCache)return this._tileMeshCache[_];let v=function(S,O){let z=$d(O,"16bit"),V=o.aF.deserialize({arrayBuffer:z.vertices,length:z.vertices.byteLength/2/2}),H=o.aH.deserialize({arrayBuffer:z.indices,length:z.indices.byteLength/2/3});return new Zc(S.createVertexBuffer(V,ql.members),S.createIndexBuffer(H),o.aG.simpleSegment(0,0,V.length,H.length))}(s,u);return this._tileMeshCache[_]=v,v}recalculate(s){}hasTransition(){let s=x.now(),u=!1;return u=u||(s-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(s){this._errorQueryLatitudeDegrees=s}}let qd=new o.r({type:new o.D(o.v.projection.type)});class uh extends o.E{constructor(s){super(),this._transitionable=new o.T(qd),this.setProjection(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.C(0)),this._mercatorProjection=new Ti,this._verticalPerspectiveProjection=new pf}get transitionState(){let s=this.properties.get("type");if(typeof s=="string"&&s==="mercator")return 0;if(typeof s=="string"&&s==="vertical-perspective")return 1;if(s instanceof o.be){if(s.from==="vertical-perspective"&&s.to==="mercator")return 1-s.transition;if(s.from==="mercator"&&s.to==="vertical-perspective")return s.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(s){this._mercatorProjection.updateGPUdependent(s),this._verticalPerspectiveProjection.updateGPUdependent(s)}getMeshFromTileID(s,u,_,v,S){return this.currentProjection.getMeshFromTileID(s,u,_,v,S)}setProjection(s){this._transitionable.setValue("type",s?.type||"mercator")}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}setErrorQueryLatitudeDegrees(s){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(s),this._mercatorProjection.setErrorQueryLatitudeDegrees(s)}}function kg(C){let s=Zd(C.worldSize,C.center.lat);return 2*Math.PI*s}function Xc(C,s,u,_,v){let S=1/(1<<v),O=s/o.Z*S+_*S,z=o.bg((C/o.Z*S+u*S)*Math.PI*2+Math.PI,2*Math.PI),V=2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI,H=Math.cos(V),K=new Float64Array(3);return K[0]=Math.sin(z)*H,K[1]=Math.sin(V),K[2]=Math.cos(z)*H,K}function ko(C){return function(s,u){let _=Math.cos(u),v=new Float64Array(3);return v[0]=Math.sin(s)*_,v[1]=Math.sin(u),v[2]=Math.cos(s)*_,v}(C.lng*Math.PI/180,C.lat*Math.PI/180)}function Zd(C,s){return C/(2*Math.PI)/Math.cos(s*Math.PI/180)}function Ng(C){let s=Math.asin(C[1])/Math.PI*180,u=Math.sqrt(C[0]*C[0]+C[2]*C[2]);if(u>1e-6){let _=C[0]/u,v=Math.acos(C[2]/u),S=(_>0?v:-v)/Math.PI*180;return new o.Q(o.aL(S,-180,180),s)}return new o.Q(0,s)}function Ko(C){return Math.cos(C*Math.PI/180)}function eo(C,s){let u=Ko(C),_=Ko(s);return o.ab(_/u)}function ya(C,s){let u=C.rotate(s.bearingInRadians),_=s.zoom+eo(s.center.lat,0),v=o.bc(1/Ko(s.center.lat),1/Ko(Math.min(Math.abs(s.center.lat),60)),o.bf(_,7,3,0,1)),S=360/kg({worldSize:s.worldSize,center:{lat:s.center.lat}});return new o.Q(s.center.lng-u.x*S*v,o.ae(s.center.lat+u.y*S,-85.051129,o.aJ))}function hh(C){let s=.5*C,u=Math.sin(s),_=Math.cos(s);return Math.log(u+_)-Math.log(_-u)}function JA(C,s,u,_){let v=C.lat+u*_;if(Math.abs(u)>1){let S=(Math.sign(C.lat+u)!==Math.sign(C.lat)?-Math.abs(C.lat):Math.abs(C.lat))*Math.PI/180,O=Math.abs(C.lat+u)*Math.PI/180,z=hh(S+_*(O-S)),V=hh(S),H=hh(O);return new o.Q(C.lng+s*((z-V)/(H-V)),v)}return new o.Q(C.lng+s*_,v)}class zg{constructor(s){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=s}recalculateCache(){if(!this._hadAnyChanges)return;let s=this._cachePrevious;this._cachePrevious=this._cache,this._cache=s,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(s,u,_,v){let S=`${s.z}_${s.x}_${s.y}`,O=this._cache.get(S);if(O)return O;let z=this._cachePrevious.get(S);if(z)return this._cache.set(S,z),z;let V=this._aabbFactory(s,u,_,v);return this._cache.set(S,V),this._hadAnyChanges=!0,V}}function ul(C,s,u){let _=C-s;return _<0?-_:Math.max(0,_-u)}function e0(C,s,u,_,v){let S=C-u,O;return O=S<0?Math.min(-S,1+S-v):S>1?Math.min(Math.max(S-v,0),1-S):0,Math.max(O,ul(s,_,v))}class t0{constructor(){this._aabbCache=new zg(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(s,u,_,v){let S=1<<_.z,O=1/S,z=_.x/S,V=_.y/S,H=2;return H=Math.min(H,e0(s,u,z,V,O)),H=Math.min(H,e0(s,u,z+.5,-V-O,O)),H=Math.min(H,e0(s,u,z+.5,2-V-O,O)),H}getWrap(s,u,_){let v=1<<u.z,S=1/v,O=u.x/v,z=ul(s.x,O,S),V=ul(s.x,O-1,S),H=ul(s.x,O+1,S),K=Math.min(z,V,H);return K===H?1:K===V?-1:0}allowVariableZoom(s,u){return zn(s,u)>4}allowWorldCopies(){return!1}getTileAABB(s,u,_,v){return this._aabbCache.getTileAABB(s,u,_,v)}_computeTileAABB(s,u,_,v){if(s.z<=0)return new fo([-1,-1,-1],[1,1,1]);if(s.z===1)return new fo([s.x===0?-1:0,s.y===0?0:-1,-1],[s.x===0?0:1,s.y===0?1:0,1]);{let S=[Xc(0,0,s.x,s.y,s.z),Xc(o.Z,0,s.x,s.y,s.z),Xc(o.Z,o.Z,s.x,s.y,s.z),Xc(0,o.Z,s.x,s.y,s.z)],O=[1,1,1],z=[-1,-1,-1];for(let V of S)for(let H=0;H<3;H++)O[H]=Math.min(O[H],V[H]),z[H]=Math.max(z[H],V[H]);if(s.y===0||s.y===(1<<s.z)-1){let V=[0,s.y===0?1:-1,0];for(let H=0;H<3;H++)O[H]=Math.min(O[H],V[H]),z[H]=Math.max(z[H],V[H])}return new fo(O,z)}}}class Af{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,u,_){return this._helper.interpolatePadding(s,u,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,u){this._helper.resize(s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,u){this._helper.overrideNearFarZ(s,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(s){}constructor(){this._cachedClippingPlane=o.bh(),this._projectionMatrix=o.b1(),this._globeViewProjMatrix32f=o.b0(),this._globeViewProjMatrixNoCorrection=o.b1(),this._globeViewProjMatrixNoCorrectionInverted=o.b1(),this._globeProjMatrixInverted=o.b1(),this._cameraPosition=o.bi(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ss({calcMatrices:()=>{this._calcMatrices()},getConstrained:(s,u)=>this.getConstrained(s,u)}),this._coveringTilesDetailsProvider=new t0}clone(){let s=new Af;return s.apply(this),s}apply(s,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(s)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let s=o.bi();return s[0]=this._cameraPosition[0],s[1]=this._cameraPosition[1],s[2]=this._cameraPosition[2],s}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(s){let{overscaledTileID:u,applyGlobeMatrix:_}=s,v=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:v,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(s){let u=this.pitchInRadians,_=this.cameraToCenterDistance/s,v=Math.sin(u)*_,S=Math.cos(u)*_+1,O=1/Math.sqrt(v*v+S*S)*1,z=-v,V=S,H=Math.sqrt(z*z+V*V);z/=H,V/=H;let K=[0,z,V];return o.bj(K,K,[0,0,0],-this.bearingInRadians),o.bk(K,K,[0,0,0],-1*this.center.lat*Math.PI/180),o.bl(K,K,[0,0,0],this.center.lng*Math.PI/180),o.aO(K,K,.25),[...K,.25*-O]}isLocationOccluded(s){return!this.isSurfacePointVisible(ko(s))}transformLightDirection(s){let u=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,v=Math.cos(_),S=[Math.sin(u)*v,Math.sin(_),Math.cos(u)*v],O=[S[2],0,-S[0]],z=[0,0,0];o.aU(z,O,S),o.aT(O,O),o.aT(z,z);let V=[0,0,0];return o.aT(V,[O[0]*s[0]+z[0]*s[1]+S[0]*s[2],O[1]*s[0]+z[1]*s[1]+S[1]*s[2],O[2]*s[0]+z[2]*s[1]+S[2]*s[2]]),V}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(s,u,_){let v=function(z,V,H){let K=1/(1<<H.z);return new o.$(z/o.Z*K+H.x*K,V/o.Z*K+H.y*K)}(s,u,_.canonical),S=(O=v.y,[o.bg(v.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI]);var O;return this.getCircleRadiusCorrection()/Math.cos(S[1])}projectTileCoordinates(s,u,_,v){let S=_.canonical,O=Xc(s,u,S.x,S.y,S.z),z=1+(v?v(s,u):0)/o.br,V=[O[0]*z,O[1]*z,O[2]*z,1];o.ap(V,V,this._globeViewProjMatrixNoCorrection);let H=this._cachedClippingPlane,K=H[0]*O[0]+H[1]*O[1]+H[2]*O[2]+H[3]<0;return{point:new o.P(V[0]/V[3],V[1]/V[3]),signedDistanceFromCamera:V[3],isOccluded:K}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let s=Zd(this.worldSize,this.center.lat),u=o.b2(),_=o.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*s),o.aY(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let v=this.centerOffset;u[8]=2*-v.x/this._helper._width,u[9]=2*v.y/this._helper._height,this._projectionMatrix=o.aZ(u),this._globeProjMatrixInverted=o.b2(),o.aj(this._globeProjMatrixInverted,u),o.L(u,u,[0,0,-this.cameraToCenterDistance]),o.a_(u,u,this.rollInRadians),o.a$(u,u,-this.pitchInRadians),o.a_(u,u,this.bearingInRadians),o.L(u,u,[0,0,-s]);let S=o.bi();S[0]=s,S[1]=s,S[2]=s,o.a$(_,u,this.center.lat*Math.PI/180),o.bm(_,_,-this.center.lng*Math.PI/180),o.M(_,_,S),this._globeViewProjMatrixNoCorrection=_,o.a$(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bm(u,u,-this.center.lng*Math.PI/180),o.M(u,u,S),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=o.b2(),o.aj(this._globeViewProjMatrixNoCorrectionInverted,_);let O=o.bi();this._cameraPosition=o.bi(),this._cameraPosition[2]=this.cameraToCenterDistance/s,o.bj(this._cameraPosition,this._cameraPosition,O,-this.rollInRadians),o.bk(this._cameraPosition,this._cameraPosition,O,this.pitchInRadians),o.bj(this._cameraPosition,this._cameraPosition,O,-this.bearingInRadians),o.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bk(this._cameraPosition,this._cameraPosition,O,-this.center.lat*Math.PI/180),o.bl(this._cameraPosition,this._cameraPosition,O,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(s);let z=o.aZ(this._globeViewProjMatrixNoCorrectionInverted);o.M(z,z,[1,1,-1]),this._cachedFrustum=Zl.fromInvProjectionMatrix(z)}calculateFogMatrix(s){o.w("calculateFogMatrix is not supported on globe projection.");let u=o.b2();return o.at(u),u}getVisibleUnwrappedCoordinates(s){return[new o.aW(0,s)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(s){s&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,u){if(!this._globeViewProjMatrixNoCorrection)return 1;let _=ko(s);o.aO(_,_,1+u/o.br);let v=o.bh();return o.ap(v,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),v[2]/v[3]}populateCache(s){}getBounds(){let s=.5*this.width,u=.5*this.height,_=[new o.P(0,0),new o.P(s,0),new o.P(this.width,0),new o.P(this.width,u),new o.P(this.width,this.height),new o.P(s,this.height),new o.P(0,this.height),new o.P(0,u)],v=[];for(let ne of _)v.push(this.unprojectScreenPoint(ne));let S=0,O=0,z=0,V=0,H=this.center;for(let ne of v){let ie=o.bn(H.lng,ne.lng),fe=o.bn(H.lat,ne.lat);ie<O&&(O=ie),ie>S&&(S=ie),fe<V&&(V=fe),fe>z&&(z=fe)}let K=[H.lng+O,H.lat+V,H.lng+S,H.lat+z];return this.isSurfacePointOnScreen([0,1,0])&&(K[3]=90,K[0]=-180,K[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(K[1]=-90,K[0]=-180,K[2]=180),new ui(K)}getConstrained(s,u){let _=o.ae(s.lat,-85.051129,o.aJ),v=o.ae(+u,this.minZoom+eo(0,_),this.maxZoom);return{center:new o.Q(s.lng,_),zoom:v}}calculateCenterFromCameraLngLatAlt(s,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(s,u,_,v)}setLocationAtPoint(s,u){let _=ko(this.unprojectScreenPoint(u)),v=ko(s),S=o.bi();o.bo(S);let O=o.bi();o.bl(O,_,S,-this.center.lng*Math.PI/180),o.bk(O,O,S,this.center.lat*Math.PI/180);let z=v[0]*v[0]+v[2]*v[2],V=O[0]*O[0];if(z<V)return;let H=Math.sqrt(z-V),K=-H,ne=o.bp(v[0],v[2],O[0],H),ie=o.bp(v[0],v[2],O[0],K),fe=o.bi();o.bl(fe,v,S,-ne);let Ae=o.bp(fe[1],fe[2],O[1],O[2]),Ie=o.bi();o.bl(Ie,v,S,-ie);let Ce=o.bp(Ie[1],Ie[2],O[1],O[2]),Pe=.5*Math.PI,Fe=Ae>=-Pe&&Ae<=Pe,Ve=Ce>=-Pe&&Ce<=Pe,Be,qe;if(Fe&&Ve){let At=this.center.lng*Math.PI/180,Pt=this.center.lat*Math.PI/180;o.bs(ne,At)+o.bs(Ae,Pt)<o.bs(ie,At)+o.bs(Ce,Pt)?(Be=ne,qe=Ae):(Be=ie,qe=Ce)}else if(Fe)Be=ne,qe=Ae;else{if(!Ve)return;Be=ie,qe=Ce}let Ge=Be/Math.PI*180,Ze=qe/Math.PI*180,_t=this.center.lat;this.setCenter(new o.Q(Ge,o.ae(Ze,-90,90))),this.setZoom(this.zoom+eo(_t,this.center.lat))}locationToScreenPoint(s,u){let _=ko(s);if(u){let v=u.getElevationForLngLatZoom(s,this._helper._tileZoom);o.aO(_,_,1+v/o.br)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(s){let u=o.bh();return o.ap(u,[...s,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new o.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(s,u){if(u){let _=u.pointCoordinate(s);if(_)return _}return o.$.fromLngLat(this.unprojectScreenPoint(s))}screenPointToLocation(s,u){var _;return(_=this.screenPointToMercatorCoordinate(s,u))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(s,u){let _=this._cameraPosition,v=this.getRayDirectionFromPixel(s);return!!this.rayPlanetIntersection(_,v)}getRayDirectionFromPixel(s){let u=o.bh();u[0]=s.x/this.width*2-1,u[1]=-1*(s.y/this.height*2-1),u[2]=1,u[3]=1,o.ap(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];let _=o.bi();_[0]=u[0]-this._cameraPosition[0],_[1]=u[1]-this._cameraPosition[1],_[2]=u[2]-this._cameraPosition[2];let v=o.bi();return o.aT(v,_),v}isSurfacePointVisible(s){let u=this._cachedClippingPlane;return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]>=0}isSurfacePointOnScreen(s){if(!this.isSurfacePointVisible(s))return!1;let u=o.bh();return o.ap(u,[...s,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(s,u){let _=o.aV(s,u),v=o.bi(),S=o.bi();o.aO(S,u,_),o.aS(v,s,S);let O=1-o.aV(v,v);if(O<0)return null;let z=o.aV(s,s)-1,V=-_+(_<0?1:-1)*Math.sqrt(O),H=z/V,K=V;return{tMin:Math.min(H,K),tMax:Math.max(H,K)}}unprojectScreenPoint(s){let u=this._cameraPosition,_=this.getRayDirectionFromPixel(s),v=this.rayPlanetIntersection(u,_);if(v){let H=o.bi();o.aP(H,u,[_[0]*v.tMin,_[1]*v.tMin,_[2]*v.tMin]);let K=o.bi();return o.aT(K,H),Ng(K)}let S=this._cachedClippingPlane[0]*_[0]+this._cachedClippingPlane[1]*_[1]+this._cachedClippingPlane[2]*_[2],O=-o.bq(this._cachedClippingPlane,u)/S,z=o.bi();if(O>0)o.aP(z,u,[_[0]*O,_[1]*O,_[2]*O]);else{let H=o.bi();o.aP(H,u,[2*_[0],2*_[1],2*_[2]]);let K=o.bq(this._cachedClippingPlane,H);o.aS(z,H,[this._cachedClippingPlane[0]*K,this._cachedClippingPlane[1]*K,this._cachedClippingPlane[2]*K])}let V=o.bi();return o.aT(V,z),Ng(V)}getMatrixForModel(s,u){let _=o.Q.convert(s),v=1/o.br,S=o.b1();return o.bm(S,S,_.lng/180*Math.PI),o.a$(S,S,-_.lat/180*Math.PI),o.L(S,S,[0,0,1+u/o.br]),o.a$(S,S,.5*Math.PI),o.M(S,S,[v,v,v]),S}getProjectionDataForCustomLayer(s=!0){let u=this.getProjectionData({overscaledTileID:new o.Y(0,0,0,0,0),applyGlobeMatrix:s});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(s){}}class mf{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(s){this._helper.setMinZoom(s)}setMaxZoom(s){this._helper.setMaxZoom(s)}setMinPitch(s){this._helper.setMinPitch(s)}setMaxPitch(s){this._helper.setMaxPitch(s)}setRenderWorldCopies(s){this._helper.setRenderWorldCopies(s)}setBearing(s){this._helper.setBearing(s)}setPitch(s){this._helper.setPitch(s)}setRoll(s){this._helper.setRoll(s)}setFov(s){this._helper.setFov(s)}setZoom(s){this._helper.setZoom(s)}setCenter(s){this._helper.setCenter(s)}setElevation(s){this._helper.setElevation(s)}setMinElevationForCurrentTile(s){this._helper.setMinElevationForCurrentTile(s)}setPadding(s){this._helper.setPadding(s)}interpolatePadding(s,u,_){return this._helper.interpolatePadding(s,u,_)}isPaddingEqual(s){return this._helper.isPaddingEqual(s)}resize(s,u,_=!0){this._helper.resize(s,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(s){this._helper.setMaxBounds(s)}overrideNearFarZ(s,u){this._helper.overrideNearFarZ(s,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(s){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),s)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(s,u){this._globeness=s,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ss({calcMatrices:()=>{this._calcMatrices()},getConstrained:(s,u)=>this.getConstrained(s,u)}),this._globeness=1,this._mercatorTransform=new vn,this._verticalPerspectiveTransform=new Af}clone(){let s=new mf;return s._globeness=this._globeness,s._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,s.apply(this),s}apply(s){this._helper.apply(s),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(s){let u=this._mercatorTransform.getProjectionData(s),_=this._verticalPerspectiveTransform.getProjectionData(s);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:u.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:s.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(s){return this.currentTransform.isLocationOccluded(s)}transformLightDirection(s){return this.currentTransform.transformLightDirection(s)}getPixelScale(){return o.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(s,u,_){let v=this._mercatorTransform.getPitchedTextCorrection(s,u,_),S=this._verticalPerspectiveTransform.getPitchedTextCorrection(s,u,_);return o.bc(v,S,this._globeness)}projectTileCoordinates(s,u,_,v){return this.currentTransform.projectTileCoordinates(s,u,_,v)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(s){return this.currentTransform.calculateFogMatrix(s)}getVisibleUnwrappedCoordinates(s){return this.currentTransform.getVisibleUnwrappedCoordinates(s)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(s){this._mercatorTransform.recalculateZoomAndCenter(s),this._verticalPerspectiveTransform.recalculateZoomAndCenter(s)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(s,u){return this.currentTransform.lngLatToCameraDepth(s,u)}populateCache(s){this._mercatorTransform.populateCache(s),this._verticalPerspectiveTransform.populateCache(s)}getBounds(){return this.currentTransform.getBounds()}getConstrained(s,u){return this.currentTransform.getConstrained(s,u)}calculateCenterFromCameraLngLatAlt(s,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(s,u,_,v)}setLocationAtPoint(s,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(s,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(s,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(s,u){return this.currentTransform.locationToScreenPoint(s,u)}screenPointToMercatorCoordinate(s,u){return this.currentTransform.screenPointToMercatorCoordinate(s,u)}screenPointToLocation(s,u){return this.currentTransform.screenPointToLocation(s,u)}isPointOnMapSurface(s,u){return this.currentTransform.isPointOnMapSurface(s,u)}getRayDirectionFromPixel(s){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(s)}getMatrixForModel(s,u){return this.currentTransform.getMatrixForModel(s,u)}getProjectionDataForCustomLayer(s=!0){let u=this._mercatorTransform.getProjectionDataForCustomLayer(s);if(!this.isGlobeRendering)return u;let _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(s);return _.fallbackMatrix=u.mainMatrix,_}getFastPathSimpleProjectionMatrix(s){return this.currentTransform.getFastPathSimpleProjectionMatrix(s)}}class Ms{get useGlobeControls(){return!0}handlePanInertia(s,u){let _=ya(s,u);return Math.abs(_.lng-u.center.lng)>180&&(_.lng=u.center.lng+179.5*Math.sign(_.lng-u.center.lng)),{easingCenter:_,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(s,u){let _=s.around,v=u.screenPointToLocation(_);s.bearingDelta&&u.setBearing(u.bearing+s.bearingDelta),s.pitchDelta&&u.setPitch(u.pitch+s.pitchDelta),s.rollDelta&&u.setRoll(u.roll+s.rollDelta);let S=u.zoom;s.zoomDelta&&u.setZoom(u.zoom+s.zoomDelta);let O=u.zoom-S;if(O===0)return;let z=o.bn(u.center.lng,v.lng),V=z/(Math.abs(z/180)+1),H=o.bn(u.center.lat,v.lat),K=u.getRayDirectionFromPixel(_),ne=u.cameraPosition,ie=-1*o.aV(ne,K),fe=o.bi();o.aP(fe,ne,[K[0]*ie,K[1]*ie,K[2]*ie]);let Ae=o.bt(fe)-1,Ie=Math.exp(.5*-Math.max(Ae-.3,0)),Ce=Zd(u.worldSize,u.center.lat)/Math.min(u.width,u.height),Pe=o.bf(Ce,.9,.5,1,.25),Fe=(1-o.aI(-O))*Math.min(Ie,Pe),Ve=u.center.lat,Be=u.zoom,qe=new o.Q(u.center.lng+V*Fe,o.ae(u.center.lat+H*Fe,-85.051129,o.aJ));u.setLocationAtPoint(v,_);let Ge=u.center,Ze=o.bf(Math.abs(z),45,85,0,1),_t=o.bf(Ce,.75,.35,0,1),At=Math.pow(Math.max(Ze,_t),.25),Pt=o.bn(Ge.lng,qe.lng),Lt=o.bn(Ge.lat,qe.lat);u.setCenter(new o.Q(Ge.lng+Pt*At,Ge.lat+Lt*At).wrap()),u.setZoom(Be+eo(Ve,u.center.lat))}handleMapControlsPan(s,u,_){if(!s.panDelta)return;let v=u.center.lat,S=u.zoom;u.setCenter(ya(s.panDelta,u).wrap()),u.setZoom(S+eo(v,u.center.lat))}cameraForBoxAndBearing(s,u,_,v,S){let O=uf(s,u,_,v,S),z=u.left/S.width*2-1,V=(S.width-u.right)/S.width*2-1,H=u.top/S.height*-2+1,K=(S.height-u.bottom)/S.height*-2+1,ne=o.bn(_.getWest(),_.getEast())<0,ie=ne?_.getEast():_.getWest(),fe=ne?_.getWest():_.getEast(),Ae=Math.max(_.getNorth(),_.getSouth()),Ie=Math.min(_.getNorth(),_.getSouth()),Ce=ie+.5*o.bn(ie,fe),Pe=Ae+.5*o.bn(Ae,Ie),Fe=S.clone();Fe.setCenter(O.center),Fe.setBearing(O.bearing),Fe.setPitch(0),Fe.setRoll(0),Fe.setZoom(O.zoom);let Ve=Fe.modelViewProjectionMatrix,Be=[ko(_.getNorthWest()),ko(_.getNorthEast()),ko(_.getSouthWest()),ko(_.getSouthEast()),ko(new o.Q(fe,Pe)),ko(new o.Q(ie,Pe)),ko(new o.Q(Ce,Ae)),ko(new o.Q(Ce,Ie))],qe=ko(O.center),Ge=Number.POSITIVE_INFINITY;for(let Ze of Be)z<0&&(Ge=Ms.getLesserNonNegativeNonNull(Ge,Ms.solveVectorScale(Ze,qe,Ve,"x",z))),V>0&&(Ge=Ms.getLesserNonNegativeNonNull(Ge,Ms.solveVectorScale(Ze,qe,Ve,"x",V))),H>0&&(Ge=Ms.getLesserNonNegativeNonNull(Ge,Ms.solveVectorScale(Ze,qe,Ve,"y",H))),K<0&&(Ge=Ms.getLesserNonNegativeNonNull(Ge,Ms.solveVectorScale(Ze,qe,Ve,"y",K)));if(Number.isFinite(Ge)&&Ge!==0)return O.zoom=Fe.zoom+o.ab(Ge),O;ah()}handleJumpToCenterZoom(s,u){let _=s.center.lat,v=s.getConstrained(u.center?o.Q.convert(u.center):s.center,s.zoom).center;s.setCenter(v.wrap());let S=u.zoom!==void 0?+u.zoom:s.zoom+eo(_,v.lat);s.zoom!==S&&s.setZoom(S)}handleEaseTo(s,u){let _=s.zoom,v=s.center,S=s.padding,O={roll:s.roll,pitch:s.pitch,bearing:s.bearing},z={roll:u.roll===void 0?s.roll:u.roll,pitch:u.pitch===void 0?s.pitch:u.pitch,bearing:u.bearing===void 0?s.bearing:u.bearing},V=u.zoom!==void 0,H=!s.isPaddingEqual(u.padding),K=!1,ne=u.center?o.Q.convert(u.center):v,ie=s.getConstrained(ne,_).center;Wd(s,ie);let fe=s.clone();fe.setCenter(ie),fe.setZoom(V?+u.zoom:_+eo(v.lat,ne.lat)),fe.setBearing(u.bearing);let Ae=new o.P(o.ae(s.centerPoint.x+u.offsetAsPoint.x,0,s.width),o.ae(s.centerPoint.y+u.offsetAsPoint.y,0,s.height));fe.setLocationAtPoint(ie,Ae);let Ie=(u.offset&&u.offsetAsPoint.mag())>0?fe.center:ie,Ce=V?+u.zoom:_+eo(v.lat,Ie.lat),Pe=_+eo(v.lat,0),Fe=Ce+eo(Ie.lat,0),Ve=o.bn(v.lng,Ie.lng),Be=o.bn(v.lat,Ie.lat),qe=o.aI(Fe-Pe);return K=Ce!==_,{easeFunc:Ge=>{if(o.b6(O,z)||Xl({startEulerAngles:O,endEulerAngles:z,tr:s,k:Ge,useSlerp:O.roll!=z.roll}),H&&s.interpolatePadding(S,u.padding,Ge),u.around)o.w("Easing around a point is not supported under globe projection."),s.setLocationAtPoint(u.around,u.aroundPoint);else{let Ze=Fe>Pe?Math.min(2,qe):Math.max(.5,qe),_t=Math.pow(Ze,1-Ge),At=JA(v,Ve,Be,Ge*_t);s.setCenter(At.wrap())}if(K){let Ze=o.B.number(Pe,Fe,Ge)+eo(0,s.center.lat);s.setZoom(Ze)}},isZooming:K,elevationCenter:Ie}}handleFlyTo(s,u){let _=u.zoom!==void 0,v=s.center,S=s.zoom,O=s.padding,z=!s.isPaddingEqual(u.padding),V=s.getConstrained(o.Q.convert(u.center||u.locationAtOffset),S).center,H=_?+u.zoom:s.zoom+eo(s.center.lat,V.lat),K=s.clone();K.setCenter(V),K.setZoom(H),K.setBearing(u.bearing);let ne=new o.P(o.ae(s.centerPoint.x+u.offsetAsPoint.x,0,s.width),o.ae(s.centerPoint.y+u.offsetAsPoint.y,0,s.height));K.setLocationAtPoint(V,ne);let ie=K.center;Wd(s,ie);let fe=function(Be,qe,Ge){let Ze=ko(qe),_t=ko(Ge),At=o.aV(Ze,_t),Pt=Math.acos(At),Lt=kg(Be);return Pt/(2*Math.PI)*Lt}(s,v,ie),Ae=S+eo(v.lat,0),Ie=H+eo(ie.lat,0),Ce=o.aI(Ie-Ae),Pe;if(typeof u.minZoom=="number"){let Be=+u.minZoom+eo(ie.lat,0),qe=Math.min(Be,Ae,Ie)+eo(0,ie.lat),Ge=s.getConstrained(ie,qe).zoom+eo(ie.lat,0);Pe=o.aI(Ge-Ae)}let Fe=o.bn(v.lng,ie.lng),Ve=o.bn(v.lat,ie.lat);return{easeFunc:(Be,qe,Ge,Ze)=>{let _t=JA(v,Fe,Ve,Ge);z&&s.interpolatePadding(O,u.padding,Be);let At=Be===1?ie:_t;s.setCenter(At.wrap());let Pt=Ae+o.ab(qe);s.setZoom(Be===1?H:Pt+eo(0,At.lat))},scaleOfZoom:Ce,targetCenter:ie,scaleOfMinZoom:Pe,pixelPathLength:fe}}static solveVectorScale(s,u,_,v,S){let O=v==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],z=[_[3],_[7],_[11],_[15]],V=s[0]*O[0]+s[1]*O[1]+s[2]*O[2],H=s[0]*z[0]+s[1]*z[1]+s[2]*z[2],K=u[0]*O[0]+u[1]*O[1]+u[2]*O[2],ne=u[0]*z[0]+u[1]*z[1]+u[2]*z[2];return K+S*H===V+S*ne||z[3]*(V-K)+O[3]*(ne-H)+V*ne==K*H?null:(K+O[3]-S*ne-S*z[3])/(K-V-S*ne+S*H)}static getLesserNonNegativeNonNull(s,u){return u!==null&&u>=0&&u<s?u:s}}class Xd{constructor(s){this._globe=s,this._mercatorCameraHelper=new Is,this._verticalPerspectiveCameraHelper=new Ms}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(s,u){return this.currentHelper.handlePanInertia(s,u)}handleMapControlsRollPitchBearingZoom(s,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(s,u)}handleMapControlsPan(s,u,_){this.currentHelper.handleMapControlsPan(s,u,_)}cameraForBoxAndBearing(s,u,_,v,S){return this.currentHelper.cameraForBoxAndBearing(s,u,_,v,S)}handleJumpToCenterZoom(s,u){this.currentHelper.handleJumpToCenterZoom(s,u)}handleEaseTo(s,u){return this.currentHelper.handleEaseTo(s,u)}handleFlyTo(s,u){return this.currentHelper.handleFlyTo(s,u)}}let hl=(C,s)=>o.x(C,s&&s.filter(u=>u.identifier!=="source.canvas")),gf=o.bu();class Na extends o.E{constructor(s,u={}){super(),this._rtlPluginLoaded=()=>{for(let _ in this.sourceCaches){let v=this.sourceCaches[_].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[_].reload()}},this.map=s,this.dispatcher=new Tr(Ot(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,v)=>this.getGlyphs(_,v)),this.dispatcher.registerMessageHandler("GI",(_,v)=>this.getImages(_,v)),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new _e(s._requestManager,u.localIdeographFontFamily),this.lineAtlas=new tt(256,512),this.crossTileSymbolIndex=new Hd,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bv,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.bw()),kt().on(bo,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let v=this.sourceCaches[_.sourceId];if(!v)return;let S=v.getSource();if(S&&S.vectorLayerIds)for(let O in this._layers){let z=this._layers[O];z.source===S.id&&this._validateLayer(z)}})}loadURL(s,u={},_){this.fire(new o.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;let v=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;let S=this._loadStyleRequest;o.j(v,this._loadStyleRequest).then(O=>{this._loadStyleRequest=null,this._load(O.data,u,_)}).catch(O=>{this._loadStyleRequest=null,O&&!S.signal.aborted&&this.fire(new o.k(O))})}loadJSON(s,u={},_){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,x.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(s,u,_)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(gf,{validate:!1})}_load(s,u,_){var v,S;let O=u.transformStyle?u.transformStyle(_,s):s;if(!u.validate||!hl(this,o.y(O))){this._loaded=!0,this.stylesheet=O;for(let z in O.sources)this.addSource(z,O.sources[z],{validate:!1});O.sprite?this._loadSprite(O.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(O.glyphs),this._createLayers(),this.light=new De(this.stylesheet.light),this._setProjectionInternal(((v=this.stylesheet.projection)===null||v===void 0?void 0:v.type)||"mercator"),this.sky=new rt(this.stylesheet.sky),this.map.setTerrain((S=this.stylesheet.terrain)!==null&&S!==void 0?S:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){let s=o.bx(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(u=>u.id),this._layers={},this._serializedLayers=null;for(let u of s){let _=o.by(u);_.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=_}}_loadSprite(s,u=!1,_=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,O,z,V){return o._(this,void 0,void 0,function*(){let H=me(S),K=z>1?"@2x":"",ne={},ie={};for(let{id:fe,url:Ae}of H){let Ie=O.transformRequest(Le(Ae,K,".json"),"SpriteJSON");ne[fe]=o.j(Ie,V);let Ce=O.transformRequest(Le(Ae,K,".png"),"SpriteImage");ie[fe]=ee.getImage(Ce,V)}return yield Promise.all([...Object.values(ne),...Object.values(ie)]),function(fe,Ae){return o._(this,void 0,void 0,function*(){let Ie={};for(let Ce in fe){Ie[Ce]={};let Pe=x.getImageCanvasContext((yield Ae[Ce]).data),Fe=(yield fe[Ce]).data;for(let Ve in Fe){let{width:Be,height:qe,x:Ge,y:Ze,sdf:_t,pixelRatio:At,stretchX:Pt,stretchY:Lt,content:Tt,textFitWidth:er,textFitHeight:Kt}=Fe[Ve];Ie[Ce][Ve]={data:null,pixelRatio:At,sdf:_t,stretchX:Pt,stretchY:Lt,content:Tt,textFitWidth:er,textFitHeight:Kt,spriteData:{width:Be,height:qe,x:Ge,y:Ze,context:Pe}}}}return Ie})}(ne,ie)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(let O in S){this._spritesImagesIds[O]=[];let z=this._spritesImagesIds[O]?this._spritesImagesIds[O].filter(V=>!(V in S)):[];for(let V of z)this.imageManager.removeImage(V),this._changedImages[V]=!0;for(let V in S[O]){let H=O==="default"?V:`${O}:${V}`;this._spritesImagesIds[O].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,S[O][V],!1):this.imageManager.addImage(H,S[O][V]),u&&(this._changedImages[H]=!0)}}}).catch(S=>{this._spriteRequest=null,v=S,this.fire(new o.k(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),_&&_(v)})}_unloadSprite(){for(let s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(s){let u=this.sourceCaches[s.source];if(!u)return;let _=s.sourceLayer;if(!_)return;let v=u.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(_)===-1)&&this.fire(new o.k(new Error(`Source layer "${_}" does not exist on source "${v.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,u=!1){let _=this._serializedAllLayers();if(!s||s.length===0)return Object.values(u?o.bz(_):_);let v=[];for(let S of s)if(_[S]){let O=u?o.bz(_[S]):_[S];v.push(O)}return v}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};let u=Object.keys(this._layers);for(let _ of u){let v=this._layers[_];v.type!=="custom"&&(s[_]=v.serialize())}return s}hasTransitions(){var s,u,_;if(!((s=this.light)===null||s===void 0)&&s.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(let v in this.sourceCaches)if(this.sourceCaches[v].hasTransition())return!0;for(let v in this._layers)if(this._layers[v].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;let u=this._changed;if(u){let v=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(v.length||S.length)&&this._updateWorkerLayers(v,S);for(let O in this._updatedSources){let z=this._updatedSources[O];if(z==="reload")this._reloadSource(O);else{if(z!=="clear")throw new Error(`Invalid action ${z}`);this._clearSource(O)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let O in this._updatedPaintProps)this._layers[O].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}let _={};for(let v in this.sourceCaches){let S=this.sourceCaches[v];_[v]=S.used,S.used=!1}for(let v of this._order){let S=this._layers[v];S.recalculate(s,this._availableImages),!S.isHidden(s.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(let v in _){let S=this.sourceCaches[v];!!_[v]!=!!S.used&&S.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(s),this.sky.recalculate(s),this.projection.recalculate(s),this.z=s.zoom,u&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let s=Object.keys(this._changedImages);if(s.length){for(let u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,u={}){var _;this._checkLoaded();let v=this.serialize();if(s=u.transformStyle?u.transformStyle(v,s):s,((_=u.validate)===null||_===void 0||_)&&hl(this,o.y(s)))return!1;(s=o.bz(s)).layers=o.bx(s.layers);let S=o.bA(v,s),O=this._getOperationsToPerform(S);if(O.unimplemented.length>0)throw new Error(`Unimplemented: ${O.unimplemented.join(", ")}.`);if(O.operations.length===0)return!1;for(let z of O.operations)z();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){let u=[],_=[];for(let v of s)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":u.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":u.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setSky":u.push(()=>this.setSky.apply(this,v.args));break;case"setProjection":this.setProjection.apply(this,v.args);break;case"setTransition":u.push(()=>{});break;default:_.push(v.command)}return{operations:u,unimplemented:_}}addImage(s,u){if(this.getImage(s))return this.fire(new o.k(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,u),this._afterImageUpdated(s)}updateImage(s,u){this.imageManager.updateImage(s,u)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new o.k(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,u,_={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(o.y.source,`sources.${s}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let v=this.sourceCaches[s]=new de(s,u,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:s})),v.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===s)return this.fire(new o.k(new Error(`Source "${s}" cannot be removed while layer "${_}" is using it.`)));let u=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],u.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,u){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);let _=this.sourceCaches[s].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(u),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,u,_={}){this._checkLoaded();let v=s.id;if(this.getLayer(v))return void this.fire(new o.k(new Error(`Layer "${v}" already exists on this map.`)));let S;if(s.type==="custom"){if(hl(this,o.bB(s)))return;S=o.by(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(v,s.source),s=o.bz(s),s=o.e(s,{source:v})),this._validate(o.y.layer,`layers.${v}`,s,{arrayIndex:-1},_))return;S=o.by(s),this._validateLayer(S),S.setEventedParent(this,{layer:{id:v}})}let O=u?this._order.indexOf(u):this._order.length;if(u&&O===-1)this.fire(new o.k(new Error(`Cannot add layer "${v}" before non-existing layer "${u}".`)));else{if(this._order.splice(O,0,v),this._layerOrderChanged=!0,this._layers[v]=S,this._removedLayers[v]&&S.source&&S.type!=="custom"){let z=this._removedLayers[v];delete this._removedLayers[v],z.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(s,u){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new o.k(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===u)return;let _=this._order.indexOf(s);this._order.splice(_,1);let v=u?this._order.indexOf(u):this._order.length;u&&v===-1?this.fire(new o.k(new Error(`Cannot move layer "${s}" before non-existing layer "${u}".`))):(this._order.splice(v,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();let u=this._layers[s];if(!u)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${s}".`)));u.setEventedParent(null);let _=this._order.indexOf(s);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=u,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],u.onRemove&&u.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,u,_){this._checkLoaded();let v=this.getLayer(s);v?v.minzoom===u&&v.maxzoom===_||(u!=null&&(v.minzoom=u),_!=null&&(v.maxzoom=_),this._updateLayer(v)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,u,_={}){this._checkLoaded();let v=this.getLayer(s);if(v){if(!o.bC(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(o.y.filter,`layers.${v.id}.filter`,u,null,_)||(v.filter=o.bz(u),this._updateLayer(v)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return o.bz(this.getLayer(s).filter)}setLayoutProperty(s,u,_,v={}){this._checkLoaded();let S=this.getLayer(s);S?o.bC(S.getLayoutProperty(u),_)||(S.setLayoutProperty(u,_,v),this._updateLayer(S)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,u){let _=this.getLayer(s);if(_)return _.getLayoutProperty(u);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,u,_,v={}){this._checkLoaded();let S=this.getLayer(s);S?o.bC(S.getPaintProperty(u),_)||(S.setPaintProperty(u,_,v)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,u){return this.getLayer(s).getPaintProperty(u)}setFeatureState(s,u){this._checkLoaded();let _=s.source,v=s.sourceLayer,S=this.sourceCaches[_];if(S===void 0)return void this.fire(new o.k(new Error(`The source '${_}' does not exist in the map's style.`)));let O=S.getSource().type;O==="geojson"&&v?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||v?(s.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),S.setFeatureState(v,s.id,u)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,u){this._checkLoaded();let _=s.source,v=this.sourceCaches[_];if(v===void 0)return void this.fire(new o.k(new Error(`The source '${_}' does not exist in the map's style.`)));let S=v.getSource().type,O=S==="vector"?s.sourceLayer:void 0;S!=="vector"||O?u&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(O,s.id,u):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();let u=s.source,_=s.sourceLayer,v=this.sourceCaches[u];if(v!==void 0)return v.getSource().type!=="vector"||_?(s.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),v.getFeatureState(_,s.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let s=o.bD(this.sourceCaches,S=>S.serialize()),u=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,v=this.stylesheet;return o.bE({version:v.version,name:v.name,metadata:v.metadata,light:v.light,sky:v.sky,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,projection:v.projection,sources:s,layers:u,terrain:_},S=>S!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){let u=O=>this._layers[O].type==="fill-extrusion",_={},v=[];for(let O=this._order.length-1;O>=0;O--){let z=this._order[O];if(u(z)){_[z]=O;for(let V of s){let H=V[z];if(H)for(let K of H)v.push(K)}}}v.sort((O,z)=>z.intersectionZ-O.intersectionZ);let S=[];for(let O=this._order.length-1;O>=0;O--){let z=this._order[O];if(u(z))for(let V=v.length-1;V>=0;V--){let H=v[V].feature;if(_[H.layer.id]<O)break;S.push(H),v.pop()}else for(let V of s){let H=V[z];if(H)for(let K of H)S.push(K.feature)}}return S}queryRenderedFeatures(s,u,_){u&&u.filter&&this._validate(o.y.filter,"queryRenderedFeatures.filter",u.filter,null,u);let v={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let H of u.layers){let K=this._layers[H];if(!K)return this.fire(new o.k(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];v[K.source]=!0}}let S=[];u.availableImages=this._availableImages;let O=this._serializedAllLayers(),z=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,V=Object.assign(Object.assign({},u),{layers:z});for(let H in this.sourceCaches)u.layers&&!v[H]||S.push(Xr(this.sourceCaches[H],this._layers,O,s,V,_,this.map.terrain?(K,ne,ie)=>this.map.terrain.getElevation(K,ne,ie):void 0));return this.placement&&S.push(function(H,K,ne,ie,fe,Ae,Ie){let Ce={},Pe=Ae.queryRenderedSymbols(ie),Fe=[];for(let Ve of Object.keys(Pe).map(Number))Fe.push(Ie[Ve]);Fe.sort(ki);for(let Ve of Fe){let Be=Ve.featureIndex.lookupSymbolFeatures(Pe[Ve.bucketInstanceId],K,Ve.bucketIndex,Ve.sourceLayerIndex,fe.filter,fe.layers,fe.availableImages,H);for(let qe in Be){let Ge=Ce[qe]=Ce[qe]||[],Ze=Be[qe];Ze.sort((_t,At)=>{let Pt=Ve.featureSortOrder;if(Pt){let Lt=Pt.indexOf(_t.featureIndex);return Pt.indexOf(At.featureIndex)-Lt}return At.featureIndex-_t.featureIndex});for(let _t of Ze)Ge.push(_t)}}return function(Ve,Be,qe){for(let Ge in Ve)for(let Ze of Ve[Ge])ei(Ze,qe[Be[Ge].source]);return Ve}(Ce,H,ne)}(this._layers,O,this.sourceCaches,s,V,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(s,u){u&&u.filter&&this._validate(o.y.filter,"querySourceFeatures.filter",u.filter,null,u);let _=this.sourceCaches[s];return _?function(v,S){let O=v.getRenderableIds().map(H=>v.getTileByID(H)),z=[],V={};for(let H=0;H<O.length;H++){let K=O[H],ne=K.tileID.canonical.key;V[ne]||(V[ne]=!0,K.querySourceFeatures(z,S))}return z}(_,u):[]}getLight(){return this.light.getLight()}setLight(s,u={}){this._checkLoaded();let _=this.light.getLight(),v=!1;for(let O in s)if(!o.bC(s[O],_[O])){v=!0;break}if(!v)return;let S={now:x.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,u),this.light.updateTransitions(S)}getProjection(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.projection}setProjection(s){if(this._checkLoaded(),this.projection){if(this.projection.name===s.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=s,this._setProjectionInternal(s.type)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,u={}){this._checkLoaded();let _=this.getSky(),v=!1;if(!s&&!_)return;if(s&&!_)v=!0;else if(!s&&_)v=!0;else for(let O in s)if(!o.bC(s[O],_[O])){v=!0;break}if(!v)return;let S={now:x.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,u),this.sky.updateTransitions(S)}_setProjectionInternal(s){let u=function(_){if(Array.isArray(_)){let v=new uh({type:_});return{projection:v,transform:new mf,cameraHelper:new Xd(v)}}switch(_){case"mercator":return{projection:new Ti,transform:new vn,cameraHelper:new Is};case"globe":{let v=new uh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new mf,cameraHelper:new Xd(v)}}case"vertical-perspective":return{projection:new pf,transform:new Af,cameraHelper:new Ms};default:return o.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new Ti,transform:new vn,cameraHelper:new Is}}}(s);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(let _ in this.sourceCaches)this.sourceCaches[_].reload()}_validate(s,u,_,v,S={}){return(!S||S.validate!==!1)&&hl(this,s.call(o.y,o.e({key:u,style:this.serialize(),value:_,styleSpec:o.v},v)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),kt().off(bo,this._rtlPluginLoaded);for(let u in this._layers)this._layers[u].setEventedParent(null);for(let u in this.sourceCaches){let _=this.sourceCaches[u];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(let u in this.sourceCaches)this.sourceCaches[u].update(s,this.map.terrain)}_generateCollisionBoxes(){for(let s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,u,_,v,S=!1){let O=!1,z=!1,V={};for(let H of this._order){let K=this._layers[H];if(K.type!=="symbol")continue;if(!V[K.source]){let ie=this.sourceCaches[K.source];V[K.source]=ie.getRenderableIds(!0).map(fe=>ie.getTileByID(fe)).sort((fe,Ae)=>Ae.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(Ae.tileID)?-1:1))}let ne=this.crossTileSymbolIndex.addLayer(K,V[K.source],s.center.lng);O=O||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(x.now(),s.zoom))&&(this.pauseablePlacement=new Jn(s,this.map.terrain,this._order,S,u,_,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(x.now()),z=!0),O&&this.pauseablePlacement.placement.setStale()),z||O)for(let H of this._order){let K=this._layers[H];K.type==="symbol"&&this.placement.updateLayerOpacities(K,V[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(x.now())}_releaseSymbolFadeTiles(){for(let s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,u){return o._(this,void 0,void 0,function*(){let _=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();let v=this.sourceCaches[u.source];return v&&v.setDependencies(u.tileID.key,u.type,u.icons),_})}getGlyphs(s,u){return o._(this,void 0,void 0,function*(){let _=yield this.glyphManager.getGlyphs(u.stacks),v=this.sourceCaches[u.source];return v&&v.setDependencies(u.tileID.key,u.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,u={}){this._checkLoaded(),s&&this._validate(o.y.glyphs,"glyphs",s,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,u,_={},v){this._checkLoaded();let S=[{id:s,url:u}],O=[...me(this.stylesheet.sprite),...S];this._validate(o.y.sprite,"sprite",O,null,_)||(this.stylesheet.sprite=O,this._loadSprite(S,!0,v))}removeSprite(s){this._checkLoaded();let u=me(this.stylesheet.sprite);if(u.find(_=>_.id===s)){if(this._spritesImagesIds[s])for(let _ of this._spritesImagesIds[s])this.imageManager.removeImage(_),this._changedImages[_]=!0;u.splice(u.findIndex(_=>_.id===s),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return me(this.stylesheet.sprite)}setSprite(s,u={},_){this._checkLoaded(),s&&this._validate(o.y.sprite,"sprite",s,null,u)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,_):(this._unloadSprite(),_&&_(null)))}}var fh=o.aD([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class za{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,u,_,v,S,O,z,V,H){this.context=s;let K=this.boundPaintVertexBuffers.length!==v.length;for(let ne=0;!K&&ne<v.length;ne++)this.boundPaintVertexBuffers[ne]!==v[ne]&&(K=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||K||this.boundIndexBuffer!==S||this.boundVertexOffset!==O||this.boundDynamicVertexBuffer!==z||this.boundDynamicVertexBuffer2!==V||this.boundDynamicVertexBuffer3!==H?this.freshBind(u,_,v,S,O,z,V,H):(s.bindVertexArray.set(this.vao),z&&z.bind(),S&&S.dynamicDraw&&S.bind(),V&&V.bind(),H&&H.bind())}freshBind(s,u,_,v,S,O,z,V){let H=s.numAttributes,K=this.context,ne=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=O,this.boundDynamicVertexBuffer2=z,this.boundDynamicVertexBuffer3=V,u.enableAttributes(ne,s);for(let ie of _)ie.enableAttributes(ne,s);O&&O.enableAttributes(ne,s),z&&z.enableAttributes(ne,s),V&&V.enableAttributes(ne,s),u.bind(),u.setVertexAttribPointers(ne,s,S);for(let ie of _)ie.bind(),ie.setVertexAttribPointers(ne,s,S);O&&(O.bind(),O.setVertexAttribPointers(ne,s,S)),v&&v.bind(),z&&(z.bind(),z.setVertexAttribPointers(ne,s,S)),V&&(V.bind(),V.setVertexAttribPointers(ne,s,S)),K.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let gt=(C,s,u,_,v)=>({u_texture:0,u_ele_delta:C,u_fog_matrix:s,u_fog_color:u?u.properties.get("fog-color"):o.b7.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:v?0:u?u.calculateFogBlendOpacity(_):0,u_horizon_color:u?u.properties.get("horizon-color"):o.b7.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:v?1:0}),Wt={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function sr(C){let s=[];for(let u=0;u<C.length;u++){if(C[u]===null)continue;let _=C[u].split(" ");s.push(_.pop())}return s}class Lr{constructor(s,u,_,v,S,O,z,V){let H=s.gl;this.program=H.createProgram();let K=sr(u.staticAttributes),ne=_?_.getBinderAttributes():[],ie=K.concat(ne),fe=ga.prelude.staticUniforms?sr(ga.prelude.staticUniforms):[],Ae=z.staticUniforms?sr(z.staticUniforms):[],Ie=u.staticUniforms?sr(u.staticUniforms):[],Ce=_?_.getBinderUniforms():[],Pe=fe.concat(Ae).concat(Ie).concat(Ce),Fe=[];for(let At of Pe)Fe.indexOf(At)<0&&Fe.push(At);let Ve=_?_.defines():[];_a(H)&&Ve.unshift("#version 300 es"),S&&Ve.push("#define OVERDRAW_INSPECTOR;"),O&&Ve.push("#define TERRAIN3D;"),V&&Ve.push(V);let Be=Ve.concat(ga.prelude.fragmentSource,z.fragmentSource,u.fragmentSource).join(`
`),qe=Ve.concat(ga.prelude.vertexSource,z.vertexSource,u.vertexSource).join(`
`);_a(H)||(Be=function(At){return At.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Be),qe=function(At){return At.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(qe));let Ge=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Ge,Be),H.compileShader(Ge),!H.getShaderParameter(Ge,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(Ge)}`);H.attachShader(this.program,Ge);let Ze=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Ze,qe),H.compileShader(Ze),!H.getShaderParameter(Ze,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(Ze)}`);H.attachShader(this.program,Ze),this.attributes={};let _t={};this.numAttributes=ie.length;for(let At=0;At<this.numAttributes;At++)ie[At]&&(H.bindAttribLocation(this.program,At,ie[At]),this.attributes[ie[At]]=At);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(Ze),H.deleteShader(Ge);for(let At=0;At<Fe.length;At++){let Pt=Fe[At];if(Pt&&!_t[Pt]){let Lt=H.getUniformLocation(this.program,Pt);Lt&&(_t[Pt]=Lt)}}this.fixedUniforms=v(s,_t),this.terrainUniforms=((At,Pt)=>({u_depth:new o.bF(At,Pt.u_depth),u_terrain:new o.bF(At,Pt.u_terrain),u_terrain_dim:new o.b8(At,Pt.u_terrain_dim),u_terrain_matrix:new o.bH(At,Pt.u_terrain_matrix),u_terrain_unpack:new o.bI(At,Pt.u_terrain_unpack),u_terrain_exaggeration:new o.b8(At,Pt.u_terrain_exaggeration)}))(s,_t),this.projectionUniforms=((At,Pt)=>({u_projection_matrix:new o.bH(At,Pt.u_projection_matrix),u_projection_tile_mercator_coords:new o.bI(At,Pt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bI(At,Pt.u_projection_clipping_plane),u_projection_transition:new o.b8(At,Pt.u_projection_transition),u_projection_fallback_matrix:new o.bH(At,Pt.u_projection_fallback_matrix)}))(s,_t),this.binderUniforms=_?_.getUniforms(s,_t):[]}draw(s,u,_,v,S,O,z,V,H,K,ne,ie,fe,Ae,Ie,Ce,Pe,Fe,Ve){let Be=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(_),s.setStencilMode(v),s.setColorMode(S),s.setCullFace(O),V){s.activeTexture.set(Be.TEXTURE2),Be.bindTexture(Be.TEXTURE_2D,V.depthTexture),s.activeTexture.set(Be.TEXTURE3),Be.bindTexture(Be.TEXTURE_2D,V.texture);for(let Ge in this.terrainUniforms)this.terrainUniforms[Ge].set(V[Ge])}if(H)for(let Ge in H)this.projectionUniforms[Wt[Ge]].set(H[Ge]);if(z)for(let Ge in this.fixedUniforms)this.fixedUniforms[Ge].set(z[Ge]);Ce&&Ce.setUniforms(s,this.binderUniforms,Ae,{zoom:Ie});let qe=0;switch(u){case Be.LINES:qe=2;break;case Be.TRIANGLES:qe=3;break;case Be.LINE_STRIP:qe=1}for(let Ge of fe.get()){let Ze=Ge.vaos||(Ge.vaos={});(Ze[K]||(Ze[K]=new za)).bind(s,this,ne,Ce?Ce.getPaintVertexBuffers():[],ie,Ge.vertexOffset,Pe,Fe,Ve),Be.drawElements(u,Ge.primitiveLength*qe,Be.UNSIGNED_SHORT,Ge.primitiveOffset*qe*2)}}}function y(C,s,u){let _=1/o.aw(u,1,s.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),S=u.tileSize*Math.pow(2,s.transform.tileZoom)/v,O=S*(u.tileID.canonical.x+u.tileID.wrap*v),z=S*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[_,C.fromScale,C.toScale],u_fade:C.t,u_pixel_coord_upper:[O>>16,z>>16],u_pixel_coord_lower:[65535&O,65535&z]}}let Yi=(C,s,u,_)=>{let v=C.style.light,S=v.properties.get("position"),O=[S.x,S.y,S.z],z=o.bL();v.properties.get("anchor")==="viewport"&&o.bM(z,C.transform.bearingInRadians),o.bN(O,O,z);let V=C.transform.transformLightDirection(O),H=v.properties.get("color");return{u_lightpos:O,u_lightpos_globe:V,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+s,u_opacity:u,u_fill_translate:_}},Ii=(C,s,u,_,v,S,O)=>o.e(Yi(C,s,u,_),y(S,C,O),{u_height_factor:-Math.pow(2,v.overscaledZ)/O.tileSize/8}),Ee=(C,s,u,_)=>o.e(y(s,C,u),{u_fill_translate:_}),Rn=(C,s)=>({u_world:C,u_fill_translate:s}),fs=(C,s,u,_,v)=>o.e(Ee(C,s,u,v),{u_world:_}),to=(C,s,u,_,v)=>{let S=C.transform,O,z,V=0;if(u.paint.get("circle-pitch-alignment")==="map"){let H=o.aw(s,1,S.zoom);O=!0,z=[H,H],V=H/(o.Z*Math.pow(2,s.tileID.overscaledZ))*2*Math.PI*v}else O=!1,z=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+O,u_device_pixel_ratio:C.pixelRatio,u_extrude_scale:z,u_globe_extrude_scale:V,u_translate:_}},Gi=C=>({u_pixel_extrude_scale:[1/C.width,1/C.height]}),gn=C=>({u_viewport_size:[C.width,C.height]}),Wn=(C,s=1)=>({u_color:C,u_overlay:0,u_overlay_scale:s}),Ei=(C,s,u,_)=>{let v=o.aw(C,1,s)/(o.Z*Math.pow(2,C.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:o.aw(C,1,s),u_intensity:u,u_globe_extrude_scale:v}},Mi=(C,s,u,_)=>{let v=o.K();o.bO(v,0,C.width,C.height,0,0,1);let S=C.context.gl;return{u_matrix:v,u_world:[S.drawingBufferWidth,S.drawingBufferHeight],u_image:u,u_color_ramp:_,u_opacity:s.paint.get("heatmap-opacity")}},Yc=(C,s,u)=>{let _=u.paint.get("hillshade-shadow-color"),v=u.paint.get("hillshade-highlight-color"),S=u.paint.get("hillshade-accent-color"),O=u.paint.get("hillshade-illumination-direction")*(Math.PI/180);return u.paint.get("hillshade-illumination-anchor")==="viewport"&&(O+=C.transform.bearingInRadians),{u_image:0,u_latrange:Yl(0,s.tileID),u_light:[u.paint.get("hillshade-exaggeration"),O],u_shadow:_,u_highlight:v,u_accent:S}},r0=(C,s)=>{let u=s.stride,_=o.K();return o.bO(_,0,o.Z,-8192,0,0,1),o.L(_,_,[0,-8192,0]),{u_matrix:_,u_image:1,u_dimension:[u,u],u_zoom:C.overscaledZ,u_unpack:s.getUnpackVector()}};function Yl(C,s){let u=Math.pow(2,s.canonical.z),_=s.canonical.y;return[new o.$(0,_/u).toLngLat().lat,new o.$(0,(_+1)/u).toLngLat().lat]}let Kc=(C,s,u,_)=>{let v=C.transform;return{u_translation:i0(C,s,u),u_ratio:_/o.aw(s,1,v.zoom),u_device_pixel_ratio:C.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Ps=(C,s,u,_,v)=>o.e(Kc(C,s,u,_),{u_image:0,u_image_height:v}),xa=(C,s,u,_,v)=>{let S=C.transform,O=Kl(s,S);return{u_translation:i0(C,s,u),u_texsize:s.imageAtlasTexture.size,u_ratio:_/o.aw(s,1,S.zoom),u_device_pixel_ratio:C.pixelRatio,u_image:0,u_scale:[O,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},ba=(C,s,u,_,v,S)=>{let O=C.lineAtlas,z=Kl(s,C.transform),V=u.layout.get("line-cap")==="round",H=O.getDash(v.from,V),K=O.getDash(v.to,V),ne=H.width*S.fromScale,ie=K.width*S.toScale;return o.e(Kc(C,s,u,_),{u_patternscale_a:[z/ne,-H.height/2],u_patternscale_b:[z/ie,-K.height/2],u_sdfgamma:O.width/(256*Math.min(ne,ie)*C.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:K.y,u_mix:S.t})};function Kl(C,s){return 1/o.aw(C,1,s.tileZoom)}function i0(C,s,u){return o.ax(C.transform,s,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}let Ql=(C,s,u,_,v)=>{return{u_tl_parent:C,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(O=_.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(S=_.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:Kr(_.paint.get("raster-hue-rotate")),u_coords_top:[v[0].x,v[0].y,v[1].x,v[1].y],u_coords_bottom:[v[3].x,v[3].y,v[2].x,v[2].y]};var S,O};function Kr(C){C*=Math.PI/180;let s=Math.sin(C),u=Math.cos(C);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}let Me=(C,s,u,_,v,S,O,z,V,H,K,ne,ie)=>{let fe=O.transform;return{u_is_size_zoom_constant:+(C==="constant"||C==="source"),u_is_size_feature_constant:+(C==="constant"||C==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:fe.cameraToCenterDistance,u_pitch:fe.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:fe.width/fe.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_label_plane_matrix:z,u_coord_matrix:V,u_is_text:+K,u_pitch_with_map:+_,u_is_along_line:v,u_is_variable_anchor:S,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:ie}},Nr=(C,s,u,_,v,S,O,z,V,H,K,ne,ie,fe)=>{let Ae=O.transform;return o.e(Me(C,s,u,_,v,S,O,z,V,H,K,ne,fe),{u_gamma_scale:_?Math.cos(Ae.pitch*Math.PI/180)*Ae.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:1})},_f=(C,s,u,_,v,S,O,z,V,H,K,ne,ie)=>o.e(Nr(C,s,u,_,v,S,O,z,V,H,!0,K,0,ie),{u_texsize_icon:ne,u_texture_icon:1}),n0=(C,s)=>({u_opacity:C,u_color:s}),yf=(C,s,u,_,v)=>o.e(function(S,O,z,V){let H=z.imageManager.getPattern(S.from.toString()),K=z.imageManager.getPattern(S.to.toString()),{width:ne,height:ie}=z.imageManager.getPixelSize(),fe=Math.pow(2,V.tileID.overscaledZ),Ae=V.tileSize*Math.pow(2,z.transform.tileZoom)/fe,Ie=Ae*(V.tileID.canonical.x+V.tileID.wrap*fe),Ce=Ae*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[ne,ie],u_mix:O.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/o.aw(V,1,z.transform.tileZoom),u_pixel_coord_upper:[Ie>>16,Ce>>16],u_pixel_coord_lower:[65535&Ie,65535&Ce]}}(u,v,s,_),{u_opacity:C}),va=(C,s)=>{},Yd={fillExtrusion:(C,s)=>({u_lightpos:new o.bJ(C,s.u_lightpos),u_lightpos_globe:new o.bJ(C,s.u_lightpos_globe),u_lightintensity:new o.b8(C,s.u_lightintensity),u_lightcolor:new o.bJ(C,s.u_lightcolor),u_vertical_gradient:new o.b8(C,s.u_vertical_gradient),u_opacity:new o.b8(C,s.u_opacity),u_fill_translate:new o.bK(C,s.u_fill_translate)}),fillExtrusionPattern:(C,s)=>({u_lightpos:new o.bJ(C,s.u_lightpos),u_lightpos_globe:new o.bJ(C,s.u_lightpos_globe),u_lightintensity:new o.b8(C,s.u_lightintensity),u_lightcolor:new o.bJ(C,s.u_lightcolor),u_vertical_gradient:new o.b8(C,s.u_vertical_gradient),u_height_factor:new o.b8(C,s.u_height_factor),u_opacity:new o.b8(C,s.u_opacity),u_fill_translate:new o.bK(C,s.u_fill_translate),u_image:new o.bF(C,s.u_image),u_texsize:new o.bK(C,s.u_texsize),u_pixel_coord_upper:new o.bK(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bK(C,s.u_pixel_coord_lower),u_scale:new o.bJ(C,s.u_scale),u_fade:new o.b8(C,s.u_fade)}),fill:(C,s)=>({u_fill_translate:new o.bK(C,s.u_fill_translate)}),fillPattern:(C,s)=>({u_image:new o.bF(C,s.u_image),u_texsize:new o.bK(C,s.u_texsize),u_pixel_coord_upper:new o.bK(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bK(C,s.u_pixel_coord_lower),u_scale:new o.bJ(C,s.u_scale),u_fade:new o.b8(C,s.u_fade),u_fill_translate:new o.bK(C,s.u_fill_translate)}),fillOutline:(C,s)=>({u_world:new o.bK(C,s.u_world),u_fill_translate:new o.bK(C,s.u_fill_translate)}),fillOutlinePattern:(C,s)=>({u_world:new o.bK(C,s.u_world),u_image:new o.bF(C,s.u_image),u_texsize:new o.bK(C,s.u_texsize),u_pixel_coord_upper:new o.bK(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bK(C,s.u_pixel_coord_lower),u_scale:new o.bJ(C,s.u_scale),u_fade:new o.b8(C,s.u_fade),u_fill_translate:new o.bK(C,s.u_fill_translate)}),circle:(C,s)=>({u_camera_to_center_distance:new o.b8(C,s.u_camera_to_center_distance),u_scale_with_map:new o.bF(C,s.u_scale_with_map),u_pitch_with_map:new o.bF(C,s.u_pitch_with_map),u_extrude_scale:new o.bK(C,s.u_extrude_scale),u_device_pixel_ratio:new o.b8(C,s.u_device_pixel_ratio),u_globe_extrude_scale:new o.b8(C,s.u_globe_extrude_scale),u_translate:new o.bK(C,s.u_translate)}),collisionBox:(C,s)=>({u_pixel_extrude_scale:new o.bK(C,s.u_pixel_extrude_scale)}),collisionCircle:(C,s)=>({u_viewport_size:new o.bK(C,s.u_viewport_size)}),debug:(C,s)=>({u_color:new o.bG(C,s.u_color),u_overlay:new o.bF(C,s.u_overlay),u_overlay_scale:new o.b8(C,s.u_overlay_scale)}),depth:va,clippingMask:va,heatmap:(C,s)=>({u_extrude_scale:new o.b8(C,s.u_extrude_scale),u_intensity:new o.b8(C,s.u_intensity),u_globe_extrude_scale:new o.b8(C,s.u_globe_extrude_scale)}),heatmapTexture:(C,s)=>({u_matrix:new o.bH(C,s.u_matrix),u_world:new o.bK(C,s.u_world),u_image:new o.bF(C,s.u_image),u_color_ramp:new o.bF(C,s.u_color_ramp),u_opacity:new o.b8(C,s.u_opacity)}),hillshade:(C,s)=>({u_image:new o.bF(C,s.u_image),u_latrange:new o.bK(C,s.u_latrange),u_light:new o.bK(C,s.u_light),u_shadow:new o.bG(C,s.u_shadow),u_highlight:new o.bG(C,s.u_highlight),u_accent:new o.bG(C,s.u_accent)}),hillshadePrepare:(C,s)=>({u_matrix:new o.bH(C,s.u_matrix),u_image:new o.bF(C,s.u_image),u_dimension:new o.bK(C,s.u_dimension),u_zoom:new o.b8(C,s.u_zoom),u_unpack:new o.bI(C,s.u_unpack)}),line:(C,s)=>({u_translation:new o.bK(C,s.u_translation),u_ratio:new o.b8(C,s.u_ratio),u_device_pixel_ratio:new o.b8(C,s.u_device_pixel_ratio),u_units_to_pixels:new o.bK(C,s.u_units_to_pixels)}),lineGradient:(C,s)=>({u_translation:new o.bK(C,s.u_translation),u_ratio:new o.b8(C,s.u_ratio),u_device_pixel_ratio:new o.b8(C,s.u_device_pixel_ratio),u_units_to_pixels:new o.bK(C,s.u_units_to_pixels),u_image:new o.bF(C,s.u_image),u_image_height:new o.b8(C,s.u_image_height)}),linePattern:(C,s)=>({u_translation:new o.bK(C,s.u_translation),u_texsize:new o.bK(C,s.u_texsize),u_ratio:new o.b8(C,s.u_ratio),u_device_pixel_ratio:new o.b8(C,s.u_device_pixel_ratio),u_image:new o.bF(C,s.u_image),u_units_to_pixels:new o.bK(C,s.u_units_to_pixels),u_scale:new o.bJ(C,s.u_scale),u_fade:new o.b8(C,s.u_fade)}),lineSDF:(C,s)=>({u_translation:new o.bK(C,s.u_translation),u_ratio:new o.b8(C,s.u_ratio),u_device_pixel_ratio:new o.b8(C,s.u_device_pixel_ratio),u_units_to_pixels:new o.bK(C,s.u_units_to_pixels),u_patternscale_a:new o.bK(C,s.u_patternscale_a),u_patternscale_b:new o.bK(C,s.u_patternscale_b),u_sdfgamma:new o.b8(C,s.u_sdfgamma),u_image:new o.bF(C,s.u_image),u_tex_y_a:new o.b8(C,s.u_tex_y_a),u_tex_y_b:new o.b8(C,s.u_tex_y_b),u_mix:new o.b8(C,s.u_mix)}),raster:(C,s)=>({u_tl_parent:new o.bK(C,s.u_tl_parent),u_scale_parent:new o.b8(C,s.u_scale_parent),u_buffer_scale:new o.b8(C,s.u_buffer_scale),u_fade_t:new o.b8(C,s.u_fade_t),u_opacity:new o.b8(C,s.u_opacity),u_image0:new o.bF(C,s.u_image0),u_image1:new o.bF(C,s.u_image1),u_brightness_low:new o.b8(C,s.u_brightness_low),u_brightness_high:new o.b8(C,s.u_brightness_high),u_saturation_factor:new o.b8(C,s.u_saturation_factor),u_contrast_factor:new o.b8(C,s.u_contrast_factor),u_spin_weights:new o.bJ(C,s.u_spin_weights),u_coords_top:new o.bI(C,s.u_coords_top),u_coords_bottom:new o.bI(C,s.u_coords_bottom)}),symbolIcon:(C,s)=>({u_is_size_zoom_constant:new o.bF(C,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bF(C,s.u_is_size_feature_constant),u_size_t:new o.b8(C,s.u_size_t),u_size:new o.b8(C,s.u_size),u_camera_to_center_distance:new o.b8(C,s.u_camera_to_center_distance),u_pitch:new o.b8(C,s.u_pitch),u_rotate_symbol:new o.bF(C,s.u_rotate_symbol),u_aspect_ratio:new o.b8(C,s.u_aspect_ratio),u_fade_change:new o.b8(C,s.u_fade_change),u_label_plane_matrix:new o.bH(C,s.u_label_plane_matrix),u_coord_matrix:new o.bH(C,s.u_coord_matrix),u_is_text:new o.bF(C,s.u_is_text),u_pitch_with_map:new o.bF(C,s.u_pitch_with_map),u_is_along_line:new o.bF(C,s.u_is_along_line),u_is_variable_anchor:new o.bF(C,s.u_is_variable_anchor),u_texsize:new o.bK(C,s.u_texsize),u_texture:new o.bF(C,s.u_texture),u_translation:new o.bK(C,s.u_translation),u_pitched_scale:new o.b8(C,s.u_pitched_scale)}),symbolSDF:(C,s)=>({u_is_size_zoom_constant:new o.bF(C,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bF(C,s.u_is_size_feature_constant),u_size_t:new o.b8(C,s.u_size_t),u_size:new o.b8(C,s.u_size),u_camera_to_center_distance:new o.b8(C,s.u_camera_to_center_distance),u_pitch:new o.b8(C,s.u_pitch),u_rotate_symbol:new o.bF(C,s.u_rotate_symbol),u_aspect_ratio:new o.b8(C,s.u_aspect_ratio),u_fade_change:new o.b8(C,s.u_fade_change),u_label_plane_matrix:new o.bH(C,s.u_label_plane_matrix),u_coord_matrix:new o.bH(C,s.u_coord_matrix),u_is_text:new o.bF(C,s.u_is_text),u_pitch_with_map:new o.bF(C,s.u_pitch_with_map),u_is_along_line:new o.bF(C,s.u_is_along_line),u_is_variable_anchor:new o.bF(C,s.u_is_variable_anchor),u_texsize:new o.bK(C,s.u_texsize),u_texture:new o.bF(C,s.u_texture),u_gamma_scale:new o.b8(C,s.u_gamma_scale),u_device_pixel_ratio:new o.b8(C,s.u_device_pixel_ratio),u_is_halo:new o.bF(C,s.u_is_halo),u_translation:new o.bK(C,s.u_translation),u_pitched_scale:new o.b8(C,s.u_pitched_scale)}),symbolTextAndIcon:(C,s)=>({u_is_size_zoom_constant:new o.bF(C,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bF(C,s.u_is_size_feature_constant),u_size_t:new o.b8(C,s.u_size_t),u_size:new o.b8(C,s.u_size),u_camera_to_center_distance:new o.b8(C,s.u_camera_to_center_distance),u_pitch:new o.b8(C,s.u_pitch),u_rotate_symbol:new o.bF(C,s.u_rotate_symbol),u_aspect_ratio:new o.b8(C,s.u_aspect_ratio),u_fade_change:new o.b8(C,s.u_fade_change),u_label_plane_matrix:new o.bH(C,s.u_label_plane_matrix),u_coord_matrix:new o.bH(C,s.u_coord_matrix),u_is_text:new o.bF(C,s.u_is_text),u_pitch_with_map:new o.bF(C,s.u_pitch_with_map),u_is_along_line:new o.bF(C,s.u_is_along_line),u_is_variable_anchor:new o.bF(C,s.u_is_variable_anchor),u_texsize:new o.bK(C,s.u_texsize),u_texsize_icon:new o.bK(C,s.u_texsize_icon),u_texture:new o.bF(C,s.u_texture),u_texture_icon:new o.bF(C,s.u_texture_icon),u_gamma_scale:new o.b8(C,s.u_gamma_scale),u_device_pixel_ratio:new o.b8(C,s.u_device_pixel_ratio),u_is_halo:new o.bF(C,s.u_is_halo),u_translation:new o.bK(C,s.u_translation),u_pitched_scale:new o.b8(C,s.u_pitched_scale)}),background:(C,s)=>({u_opacity:new o.b8(C,s.u_opacity),u_color:new o.bG(C,s.u_color)}),backgroundPattern:(C,s)=>({u_opacity:new o.b8(C,s.u_opacity),u_image:new o.bF(C,s.u_image),u_pattern_tl_a:new o.bK(C,s.u_pattern_tl_a),u_pattern_br_a:new o.bK(C,s.u_pattern_br_a),u_pattern_tl_b:new o.bK(C,s.u_pattern_tl_b),u_pattern_br_b:new o.bK(C,s.u_pattern_br_b),u_texsize:new o.bK(C,s.u_texsize),u_mix:new o.b8(C,s.u_mix),u_pattern_size_a:new o.bK(C,s.u_pattern_size_a),u_pattern_size_b:new o.bK(C,s.u_pattern_size_b),u_scale_a:new o.b8(C,s.u_scale_a),u_scale_b:new o.b8(C,s.u_scale_b),u_pixel_coord_upper:new o.bK(C,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.bK(C,s.u_pixel_coord_lower),u_tile_units_to_pixels:new o.b8(C,s.u_tile_units_to_pixels)}),terrain:(C,s)=>({u_texture:new o.bF(C,s.u_texture),u_ele_delta:new o.b8(C,s.u_ele_delta),u_fog_matrix:new o.bH(C,s.u_fog_matrix),u_fog_color:new o.bG(C,s.u_fog_color),u_fog_ground_blend:new o.b8(C,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.b8(C,s.u_fog_ground_blend_opacity),u_horizon_color:new o.bG(C,s.u_horizon_color),u_horizon_fog_blend:new o.b8(C,s.u_horizon_fog_blend),u_is_globe_mode:new o.b8(C,s.u_is_globe_mode)}),terrainDepth:(C,s)=>({u_ele_delta:new o.b8(C,s.u_ele_delta)}),terrainCoords:(C,s)=>({u_texture:new o.bF(C,s.u_texture),u_terrain_coords_id:new o.b8(C,s.u_terrain_coords_id),u_ele_delta:new o.b8(C,s.u_ele_delta)}),projectionErrorMeasurement:(C,s)=>({u_input:new o.b8(C,s.u_input),u_output_expected:new o.b8(C,s.u_output_expected)}),atmosphere:(C,s)=>({u_sun_pos:new o.bJ(C,s.u_sun_pos),u_atmosphere_blend:new o.b8(C,s.u_atmosphere_blend),u_globe_position:new o.bJ(C,s.u_globe_position),u_globe_radius:new o.b8(C,s.u_globe_radius),u_inv_proj_matrix:new o.bH(C,s.u_inv_proj_matrix)}),sky:(C,s)=>({u_sky_color:new o.bG(C,s.u_sky_color),u_horizon_color:new o.bG(C,s.u_horizon_color),u_horizon:new o.bK(C,s.u_horizon),u_horizon_normal:new o.bK(C,s.u_horizon_normal),u_sky_horizon_blend:new o.b8(C,s.u_sky_horizon_blend),u_sky_blend:new o.b8(C,s.u_sky_blend)})};class be{constructor(s,u,_){this.context=s;let v=s.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){let u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let Kd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class o0{constructor(s,u,_,v){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=s;let S=s.gl;this.buffer=S.createBuffer(),s.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let _=0;_<this.attributes.length;_++){let v=u.attributes[this.attributes[_].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,u,_){for(let v=0;v<this.attributes.length;v++){let S=this.attributes[v],O=u.attributes[S.name];O!==void 0&&s.vertexAttribPointer(O,S.components,s[Kd[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pi{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jl extends Pi{getDefault(){return o.b7.transparent}set(s){let u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Qd extends Pi{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ug extends Pi{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class s0 extends Pi{getDefault(){return[!0,!0,!0,!0]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class a0 extends Pi{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class l0 extends Pi{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class wa extends Pi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){let u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class po extends Pi{getDefault(){let s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class xf extends Pi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class bf extends Pi{getDefault(){return[0,1]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class vf extends Pi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class dh extends Pi{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Jd extends Pi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class ec extends Pi{getDefault(){let s=this.gl;return[s.ONE,s.ZERO]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Qc extends Pi{getDefault(){return o.b7.transparent}set(s){let u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class _i extends Pi{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class wf extends Pi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class ep extends Pi{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class tp extends Pi{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class tc extends Pi{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Tf extends Pi{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ph extends Pi{getDefault(){let s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){let u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class rc extends Pi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Jc extends Pi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class c0 extends Pi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class eu extends Pi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ic extends Pi{getDefault(){return null}set(s){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class rp extends Pi{getDefault(){return null}set(s){var u;if(s===this.current&&!this.dirty)return;let _=this.gl;_a(_)?_.bindVertexArray(s):(u=_.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Ef extends Pi{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Ci extends Pi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Cf extends Pi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class ip extends Pi{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class vo extends ip{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class ea extends ip{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Qo extends ip{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}let Sf="Framebuffer is not complete";class np{constructor(s,u,_,v,S){this.context=s,this.width=u,this.height=_;let O=s.gl,z=this.framebuffer=O.createFramebuffer();if(this.colorAttachment=new vo(s,z),v)this.depthAttachment=S?new Qo(s,z):new ea(s,z);else if(S)throw new Error("Stencil cannot be set without depth");if(O.checkFramebufferStatus(O.FRAMEBUFFER)!==O.FRAMEBUFFER_COMPLETE)throw new Error(Sf)}destroy(){let s=this.context.gl,u=this.colorAttachment.get();if(u&&s.deleteTexture(u),this.depthAttachment){let _=this.depthAttachment.get();_&&s.deleteRenderbuffer(_)}s.deleteFramebuffer(this.framebuffer)}}class If{constructor(s){var u,_;if(this.gl=s,this.clearColor=new Jl(this),this.clearDepth=new Qd(this),this.clearStencil=new Ug(this),this.colorMask=new s0(this),this.depthMask=new a0(this),this.stencilMask=new l0(this),this.stencilFunc=new wa(this),this.stencilOp=new po(this),this.stencilTest=new xf(this),this.depthRange=new bf(this),this.depthTest=new vf(this),this.depthFunc=new dh(this),this.blend=new Jd(this),this.blendFunc=new ec(this),this.blendColor=new Qc(this),this.blendEquation=new _i(this),this.cullFace=new wf(this),this.cullFaceSide=new ep(this),this.frontFace=new tp(this),this.program=new tc(this),this.activeTexture=new Tf(this),this.viewport=new ph(this),this.bindFramebuffer=new rc(this),this.bindRenderbuffer=new Jc(this),this.bindTexture=new c0(this),this.bindVertexBuffer=new eu(this),this.bindElementBuffer=new ic(this),this.bindVertexArray=new rp(this),this.pixelStoreUnpack=new Ef(this),this.pixelStoreUnpackPremultiplyAlpha=new Ci(this),this.pixelStoreUnpackFlipY=new Cf(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),_a(s)){this.HALF_FLOAT=s.HALF_FLOAT;let v=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=s.RGBA16F)!==null&&u!==void 0?u:v?.RGBA16F_EXT,this.RGB16F=(_=s.RGB16F)!==null&&_!==void 0?_:v?.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");let v=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=v?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u){return new be(this,s,u)}createVertexBuffer(s,u,_){return new o0(this,s,u,_)}createRenderbuffer(s,u,_){let v=this.gl,S=v.createRenderbuffer();return this.bindRenderbuffer.set(S),v.renderbufferStorage(v.RENDERBUFFER,s,u,_),this.bindRenderbuffer.set(null),S}createFramebuffer(s,u,_,v){return new np(this,s,u,_,v)}clear({color:s,depth:u,stencil:_}){let v=this.gl,S=0;s&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),v.clear(S)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.bC(s.blendFunction,mn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return _a(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var u;return _a(this.gl)?this.gl.deleteVertexArray(s):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}let tu;function Ah(C,s,u,_,v){let S=C.context,O=C.transform,z=S.gl,V=C.useProgram("collisionBox"),H=[],K=0,ne=0;for(let Pe=0;Pe<_.length;Pe++){let Fe=_[Pe],Ve=s.getTile(Fe).getBucket(u);if(!Ve)continue;let Be=v?Ve.textCollisionBox:Ve.iconCollisionBox,qe=Ve.collisionCircleArray;qe.length>0&&(H.push({circleArray:qe,circleOffset:ne,coord:Fe}),K+=qe.length/4,ne=K),Be&&V.draw(S,z.LINES,ti.disabled,bi.disabled,C.colorModeForRenderPass(),Di.disabled,Gi(C.transform),C.style.map.terrain&&C.style.map.terrain.getTerrainData(Fe),O.getProjectionData({overscaledTileID:Fe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,C.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!v||!H.length)return;let ie=C.useProgram("collisionCircle"),fe=new o.bP;fe.resize(4*K),fe._trim();let Ae=0;for(let Pe of H)for(let Fe=0;Fe<Pe.circleArray.length/4;Fe++){let Ve=4*Fe,Be=Pe.circleArray[Ve+0],qe=Pe.circleArray[Ve+1],Ge=Pe.circleArray[Ve+2],Ze=Pe.circleArray[Ve+3];fe.emplace(Ae++,Be,qe,Ge,Ze,0),fe.emplace(Ae++,Be,qe,Ge,Ze,1),fe.emplace(Ae++,Be,qe,Ge,Ze,2),fe.emplace(Ae++,Be,qe,Ge,Ze,3)}(!tu||tu.length<2*K)&&(tu=function(Pe){let Fe=2*Pe,Ve=new o.bR;Ve.resize(Fe),Ve._trim();for(let Be=0;Be<Fe;Be++){let qe=6*Be;Ve.uint16[qe+0]=4*Be+0,Ve.uint16[qe+1]=4*Be+1,Ve.uint16[qe+2]=4*Be+2,Ve.uint16[qe+3]=4*Be+2,Ve.uint16[qe+4]=4*Be+3,Ve.uint16[qe+5]=4*Be+0}return Ve}(K));let Ie=S.createIndexBuffer(tu,!0),Ce=S.createVertexBuffer(fe,o.bQ.members,!0);for(let Pe of H){let Fe=gn(C.transform);ie.draw(S,z.TRIANGLES,ti.disabled,bi.disabled,C.colorModeForRenderPass(),Di.disabled,Fe,C.style.map.terrain&&C.style.map.terrain.getTerrainData(Pe.coord),null,u.id,Ce,Ie,o.aG.simpleSegment(0,2*Pe.circleOffset,Pe.circleArray.length,Pe.circleArray.length/2),null,C.transform.zoom,null,null,null)}Ce.destroy(),Ie.destroy()}let Mf=o.at(new Float32Array(16));function Pf(C,s,u,_,v,S){let{horizontalAlign:O,verticalAlign:z}=o.aB(C);return new o.P((-(O-.5)*s/v+_[0])*S,(-(z-.5)*u/v+_[1])*S)}function ru(C,s,u,_,v,S){let O=s.tileAnchorPoint.add(new o.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let z=_.mult(S);u||(z=z.rotate(-v));let V=O.add(z);return Mt(V.x,V.y,s.pitchedLabelPlaneMatrix,s.getElevation).point}if(u){let z=gi(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(C),V=Math.atan(z.y/z.x)+(z.x<0?Math.PI:0);return C.add(_.rotate(V))}return C.add(_)}function fl(C,s,u,_,v,S,O,z,V,H,K,ne){let ie=C.text.placedSymbolArray,fe=C.text.dynamicLayoutVertexArray,Ae=C.icon.dynamicLayoutVertexArray,Ie={};fe.clear();for(let Ce=0;Ce<ie.length;Ce++){let Pe=ie.get(Ce),Fe=Pe.hidden||!Pe.crossTileID||C.allowVerticalPlacement&&!Pe.placedOrientation?null:_[Pe.crossTileID];if(Fe){let Ve=new o.P(Pe.anchorX,Pe.anchorY),Be={getElevation:ne,width:v.width,height:v.height,pitchedLabelPlaneMatrix:S,pitchWithMap:u,transform:v,tileAnchorPoint:Ve,translation:H,unwrappedTileID:K},qe=u?dr(Ve.x,Ve.y,Be):gi(Ve.x,Ve.y,Be),Ge=ut(v.cameraToCenterDistance,qe.signedDistanceFromCamera),Ze=o.ai(C.textSizeData,z,Pe)*Ge/o.av;u&&(Ze*=C.tilePixelRatio/O);let{width:_t,height:At,anchor:Pt,textOffset:Lt,textBoxScale:Tt}=Fe,er=Pf(Pt,_t,At,Lt,Tt,Ze),Kt=v.getPitchedTextCorrection(Ve.x+H[0],Ve.y+H[1],K),Ut=ru(qe.point,Be,s,er,-v.bearingInRadians,Kt),mt=C.allowVerticalPlacement&&Pe.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let Nt=0;Nt<Pe.numGlyphs;Nt++)o.ao(fe,Ut,mt);V&&Pe.associatedIconIndex>=0&&(Ie[Pe.associatedIconIndex]={shiftedAnchor:Ut,angle:mt})}else Pr(Pe.numGlyphs,fe)}if(V){Ae.clear();let Ce=C.icon.placedSymbolArray;for(let Pe=0;Pe<Ce.length;Pe++){let Fe=Ce.get(Pe);if(Fe.hidden)Pr(Fe.numGlyphs,Ae);else{let Ve=Ie[Pe];if(Ve)for(let Be=0;Be<Fe.numGlyphs;Be++)o.ao(Ae,Ve.shiftedAnchor,Ve.angle);else Pr(Fe.numGlyphs,Ae)}}C.icon.dynamicLayoutVertexBuffer.updateData(Ae)}C.text.dynamicLayoutVertexBuffer.updateData(fe)}function mh(C,s,u){return u.iconsInText&&s?"symbolTextAndIcon":C?"symbolSDF":"symbolIcon"}function iu(C,s,u,_,v,S,O,z,V,H,K,ne,ie){let fe=C.context,Ae=fe.gl,Ie=C.transform,Ce=z==="map",Pe=V==="map",Fe=z!=="viewport"&&u.layout.get("symbol-placement")!=="point",Ve=Ce&&!Pe&&!Fe,Be=!u.layout.get("symbol-sort-key").isConstant(),qe=!1,Ge=C.getDepthModeForSublayer(0,ti.ReadOnly),Ze=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_t=[],At=Ie.getCircleRadiusCorrection();for(let Pt of _){let Lt=s.getTile(Pt),Tt=Lt.getBucket(u);if(!Tt)continue;let er=v?Tt.text:Tt.icon;if(!er||!er.segments.get().length||!er.hasVisibleVertices)continue;let Kt=er.programConfigurations.get(u.id),Ut=v||Tt.sdfIcons,mt=v?Tt.textSizeData:Tt.iconSizeData,Nt=Pe||Ie.pitch!==0,Ri=C.useProgram(mh(Ut,v,Tt),Kt),Hr=o.ag(mt,Ie.zoom),zi=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Pt),Zi,Ui,Wi,vi,m=[0,0],A=null;if(v)Ui=Lt.glyphAtlasTexture,Wi=Ae.LINEAR,Zi=Lt.glyphAtlasTexture.size,Tt.iconsInText&&(m=Lt.imageAtlasTexture.size,A=Lt.imageAtlasTexture,vi=Nt||C.options.rotating||C.options.zooming||mt.kind==="composite"||mt.kind==="camera"?Ae.LINEAR:Ae.NEAREST);else{let nt=u.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear;Ui=Lt.imageAtlasTexture,Wi=Ut||C.options.rotating||C.options.zooming||nt||Nt?Ae.LINEAR:Ae.NEAREST,Zi=Lt.imageAtlasTexture.size}let b=o.aw(Lt,1,C.transform.zoom),E=dt(Ce,C.transform,b),M=o.K();o.aj(M,E);let B=it(Pe,Ce,C.transform,b),F=o.ax(Ie,Lt,S,O),N=Ie.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!ie,applyTerrainMatrix:!0}),W=Ze&&Tt.hasTextData(),Q=u.layout.get("icon-text-fit")!=="none"&&W&&Tt.hasIconData();if(Fe){let nt=C.style.map.terrain?(wt,at)=>C.style.map.terrain.getElevation(Pt,wt,at):null,It=u.layout.get("text-rotation-alignment")==="map";rr(Tt,C,v,E,M,Pe,H,It,Pt.toUnwrapped(),Ie.width,Ie.height,F,nt)}let he=v&&Ze||Q,we=Fe||he?Mf:Pe?E:C.transform.clipSpaceToPixelsMatrix,$e=Ut&&u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Qe;Qe=Ut?Tt.iconsInText?_f(mt.kind,Hr,Ve,Pe,Fe,he,C,we,B,F,Zi,m,At):Nr(mt.kind,Hr,Ve,Pe,Fe,he,C,we,B,F,v,Zi,0,At):Me(mt.kind,Hr,Ve,Pe,Fe,he,C,we,B,F,v,Zi,At);let Ue={program:Ri,buffers:er,uniformValues:Qe,projectionData:N,atlasTexture:Ui,atlasTextureIcon:A,atlasInterpolation:Wi,atlasInterpolationIcon:vi,isSDF:Ut,hasHalo:$e};if(Be&&Tt.canOverlap){qe=!0;let nt=er.segments.get();for(let It of nt)_t.push({segments:new o.aG([It]),sortKey:It.sortKey,state:Ue,terrainData:zi})}else _t.push({segments:er.segments,sortKey:0,state:Ue,terrainData:zi})}qe&&_t.sort((Pt,Lt)=>Pt.sortKey-Lt.sortKey);for(let Pt of _t){let Lt=Pt.state;if(fe.activeTexture.set(Ae.TEXTURE0),Lt.atlasTexture.bind(Lt.atlasInterpolation,Ae.CLAMP_TO_EDGE),Lt.atlasTextureIcon&&(fe.activeTexture.set(Ae.TEXTURE1),Lt.atlasTextureIcon&&Lt.atlasTextureIcon.bind(Lt.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),Lt.isSDF){let Tt=Lt.uniformValues;Lt.hasHalo&&(Tt.u_is_halo=1,nc(Lt.buffers,Pt.segments,u,C,Lt.program,Ge,K,ne,Tt,Lt.projectionData,Pt.terrainData)),Tt.u_is_halo=0}nc(Lt.buffers,Pt.segments,u,C,Lt.program,Ge,K,ne,Lt.uniformValues,Lt.projectionData,Pt.terrainData)}}function nc(C,s,u,_,v,S,O,z,V,H,K){let ne=_.context;v.draw(ne,ne.gl.TRIANGLES,S,O,z,Di.backCCW,V,K,H,u.id,C.layoutVertexBuffer,C.indexBuffer,s,u.paint,_.transform.zoom,C.programConfigurations.get(u.id),C.dynamicLayoutVertexBuffer,C.opacityVertexBuffer)}function oc(C,s,u,_,v){let S=C.context,O=S.gl,z=bi.disabled,V=new mn([O.ONE,O.ONE],o.b7.transparent,[!0,!0,!0,!0]),H=s.getBucket(u);if(!H)return;let K=_.key,ne=u.heatmapFbos.get(K);ne||(ne=op(S,s.tileSize,s.tileSize),u.heatmapFbos.set(K,ne)),S.bindFramebuffer.set(ne.framebuffer),S.viewport.set([0,0,s.tileSize,s.tileSize]),S.clear({color:o.b7.transparent});let ie=H.programConfigurations.get(u.id),fe=C.useProgram("heatmap",ie,!v),Ae=C.transform.getProjectionData({overscaledTileID:s.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ie=C.style.map.terrain.getTerrainData(_);fe.draw(S,O.TRIANGLES,ti.disabled,z,V,Di.disabled,Ei(s,C.transform.zoom,u.paint.get("heatmap-intensity"),1),Ie,Ae,u.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,u.paint,C.transform.zoom,ie)}function Ta(C,s,u,_,v){let S=C.context,O=S.gl,z=C.transform;S.setColorMode(C.colorModeForRenderPass());let V=Rf(S,s),H=u.key,K=s.heatmapFbos.get(H);if(!K)return;S.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,K.colorAttachment.get()),S.activeTexture.set(O.TEXTURE1),V.bind(O.LINEAR,O.CLAMP_TO_EDGE);let ne=z.getProjectionData({overscaledTileID:u,applyTerrainMatrix:v,applyGlobeMatrix:!_});C.useProgram("heatmapTexture").draw(S,O.TRIANGLES,ti.disabled,bi.disabled,C.colorModeForRenderPass(),Di.disabled,Mi(C,s,0,1),null,ne,s.id,C.rasterBoundsBuffer,C.quadTriangleIndexBuffer,C.rasterBoundsSegments,s.paint,z.zoom),K.destroy(),s.heatmapFbos.delete(H)}function op(C,s,u){var _,v;let S=C.gl,O=S.createTexture();S.bindTexture(S.TEXTURE_2D,O),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,S.CLAMP_TO_EDGE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,S.LINEAR),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,S.LINEAR);let z=(_=C.HALF_FLOAT)!==null&&_!==void 0?_:S.UNSIGNED_BYTE,V=(v=C.RGBA16F)!==null&&v!==void 0?v:S.RGBA;S.texImage2D(S.TEXTURE_2D,0,V,s,u,0,S.RGBA,z,null);let H=C.createFramebuffer(s,u,!1,!1);return H.colorAttachment.set(O),H}function Rf(C,s){return s.colorRampTexture||(s.colorRampTexture=new je(C,s.colorRamp,C.gl.RGBA)),s.colorRampTexture}function sc(C,s,u,_,v){if(!u||!_||!_.imageAtlas)return;let S=_.imageAtlas.patternPositions,O=S[u.to.toString()],z=S[u.from.toString()];if(!O&&z&&(O=z),!z&&O&&(z=O),!O||!z){let V=v.getPaintProperty(s);O=S[V],z=S[V]}O&&z&&C.setConstantPatternPositions(O,z)}function Bf(C,s,u,_,v,S,O,z){let V=C.context.gl,H="fill-pattern",K=u.paint.get(H),ne=K&&K.constantOr(1),ie=u.getCrossfadeParameters(),fe,Ae,Ie,Ce,Pe,Fe=C.transform,Ve=u.paint.get("fill-translate"),Be=u.paint.get("fill-translate-anchor");O?(Ae=ne&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",fe=V.LINES):(Ae=ne?"fillPattern":"fill",fe=V.TRIANGLES);let qe=K.constantOr(null);for(let Ge of _){let Ze=s.getTile(Ge);if(ne&&!Ze.patternsLoaded())continue;let _t=Ze.getBucket(u);if(!_t)continue;let At=_t.programConfigurations.get(u.id),Pt=C.useProgram(Ae,At),Lt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Ge);ne&&(C.context.activeTexture.set(V.TEXTURE0),Ze.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),At.updatePaintBuffers(ie)),sc(At,H,qe,Ze,u);let Tt=Fe.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),er=o.ax(Fe,Ze,Ve,Be);if(O){Ce=_t.indexBuffer2,Pe=_t.segments2;let Ut=[V.drawingBufferWidth,V.drawingBufferHeight];Ie=Ae==="fillOutlinePattern"&&ne?fs(C,ie,Ze,Ut,er):Rn(Ut,er)}else Ce=_t.indexBuffer,Pe=_t.segments,Ie=ne?Ee(C,ie,Ze,er):{u_fill_translate:er};let Kt;if(C.renderPass==="translucent"&&z){let[Ut]=C.getStencilConfigForOverlapAndUpdateStencilID(_);Kt=Ut[Ge.overscaledZ]}else Kt=C.stencilModeForClipping(Ge);Pt.draw(C.context,fe,v,Kt,S,Di.backCCW,Ie,Lt,Tt,u.id,_t.layoutVertexBuffer,Ce,Pe,u.paint,C.transform.zoom,At)}}function Lf(C,s,u,_,v,S,O,z){let V=C.context,H=V.gl,K="fill-extrusion-pattern",ne=u.paint.get(K),ie=ne.constantOr(1),fe=u.getCrossfadeParameters(),Ae=u.paint.get("fill-extrusion-opacity"),Ie=ne.constantOr(null),Ce=C.transform;for(let Pe of _){let Fe=s.getTile(Pe),Ve=Fe.getBucket(u);if(!Ve)continue;let Be=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Pe),qe=Ve.programConfigurations.get(u.id),Ge=C.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",qe);ie&&(C.context.activeTexture.set(H.TEXTURE0),Fe.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),qe.updatePaintBuffers(fe));let Ze=Ce.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!z,applyTerrainMatrix:!0});sc(qe,K,Ie,Fe,u);let _t=o.ax(Ce,Fe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),At=u.paint.get("fill-extrusion-vertical-gradient"),Pt=ie?Ii(C,At,Ae,_t,Pe,fe,Fe):Yi(C,At,Ae,_t);Ge.draw(V,V.gl.TRIANGLES,v,S,O,Di.backCCW,Pt,Be,Ze,u.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,u.paint,C.transform.zoom,qe,C.style.map.terrain&&Ve.centroidVertexBuffer)}}function gh(C,s,u,_,v,S,O,z,V){var H;let K=C.style.projection,ne=C.context,ie=C.transform,fe=ne.gl,Ae=C.useProgram("hillshade"),Ie=!C.options.moving;for(let Ce of _){let Pe=s.getTile(Ce),Fe=Pe.fbo;if(!Fe)continue;let Ve=K.getMeshFromTileID(ne,Ce.canonical,z,!0,"raster"),Be=(H=C.style.map.terrain)===null||H===void 0?void 0:H.getTerrainData(Ce);ne.activeTexture.set(fe.TEXTURE0),fe.bindTexture(fe.TEXTURE_2D,Fe.colorAttachment.get());let qe=ie.getProjectionData({overscaledTileID:Ce,aligned:Ie,applyGlobeMatrix:!V,applyTerrainMatrix:!0});Ae.draw(ne,fe.TRIANGLES,S,v[Ce.overscaledZ],O,Di.backCCW,Yc(C,Pe,u),Be,qe,u.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}let nu=[new o.P(0,0),new o.P(o.Z,0),new o.P(o.Z,o.Z),new o.P(0,o.Z)];function ou(C,s,u,_,v,S,O,z,V=!1,H=!1){let K=_[_.length-1].overscaledZ,ne=C.context,ie=ne.gl,fe=C.useProgram("raster"),Ae=C.transform,Ie=C.style.projection,Ce=C.colorModeForRenderPass(),Pe=!C.options.moving;for(let Fe of _){let Ve=C.getDepthModeForSublayer(Fe.overscaledZ-K,u.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,ie.LESS),Be=s.getTile(Fe);Be.registerFadeDuration(u.paint.get("raster-fade-duration"));let qe=s.findLoadedParent(Fe,0),Ge=s.findLoadedSibling(Fe),Ze=Vg(Be,qe||Ge||null,s,u,C.transform,C.style.map.terrain),_t,At,Pt=u.paint.get("raster-resampling")==="nearest"?ie.NEAREST:ie.LINEAR;ne.activeTexture.set(ie.TEXTURE0),Be.texture.bind(Pt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),ne.activeTexture.set(ie.TEXTURE1),qe?(qe.texture.bind(Pt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),_t=Math.pow(2,qe.tileID.overscaledZ-Be.tileID.overscaledZ),At=[Be.tileID.canonical.x*_t%1,Be.tileID.canonical.y*_t%1]):Be.texture.bind(Pt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),Be.texture.useMipmap&&ne.extTextureFilterAnisotropic&&C.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);let Lt=C.style.map.terrain&&C.style.map.terrain.getTerrainData(Fe),Tt=Ae.getProjectionData({overscaledTileID:Fe,aligned:Pe,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),er=Ql(At||[0,0],_t||1,Ze,u,z),Kt=Ie.getMeshFromTileID(ne,Fe.canonical,S,O,"raster");fe.draw(ne,ie.TRIANGLES,Ve,v?v[Fe.overscaledZ]:bi.disabled,Ce,V?Di.frontCCW:Di.backCCW,er,Lt,Tt,u.id,Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}}function Vg(C,s,u,_,v,S){let O=_.paint.get("raster-fade-duration");if(!S&&O>0){let z=x.now(),V=(z-C.timeAdded)/O,H=s?(z-s.timeAdded)/O:-1,K=u.getSource(),ne=zn(v,{tileSize:K.tileSize,roundZoom:K.roundZoom}),ie=!s||Math.abs(s.tileID.overscaledZ-ne)>Math.abs(C.tileID.overscaledZ-ne),fe=ie&&C.refreshedUponExpiration?1:o.ae(ie?V:1-H,0,1);return C.refreshedUponExpiration&&V>=1&&(C.refreshedUponExpiration=!1),s?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}let u0=new o.b7(1,0,0,1),Un=new o.b7(0,1,0,1),ac=new o.b7(0,0,1,1),zs=new o.b7(1,0,1,1),sp=new o.b7(0,1,1,1);function lc(C,s,u,_){Ua(C,0,s+u/2,C.transform.width,u,_)}function ap(C,s,u,_){Ua(C,s-u/2,0,u,C.transform.height,_)}function Ua(C,s,u,_,v,S){let O=C.context,z=O.gl;z.enable(z.SCISSOR_TEST),z.scissor(s*C.pixelRatio,u*C.pixelRatio,_*C.pixelRatio,v*C.pixelRatio),O.clear({color:S}),z.disable(z.SCISSOR_TEST)}function _h(C,s,u){let _=C.context,v=_.gl,S=C.useProgram("debug"),O=ti.disabled,z=bi.disabled,V=C.colorModeForRenderPass(),H="$debug",K=C.style.map.terrain&&C.style.map.terrain.getTerrainData(u);_.activeTexture.set(v.TEXTURE0);let ne=s.getTileByID(u.key).latestRawTileData,ie=Math.floor((ne&&ne.byteLength||0)/1024),fe=s.getTile(u).tileSize,Ae=512/Math.min(fe,512)*(u.overscaledZ/C.transform.zoom)*.5,Ie=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Ie+=` => ${u.overscaledZ}`),function(Pe,Fe){Pe.initDebugOverlayCanvas();let Ve=Pe.debugOverlayCanvas,Be=Pe.context.gl,qe=Pe.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,Ve.width,Ve.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(Fe,5,5),qe.strokeText(Fe,5,5),Pe.debugOverlayTexture.update(Ve),Pe.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(C,`${Ie} ${ie}kB`);let Ce=C.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(_,v.TRIANGLES,O,z,mn.alphaBlended,Di.disabled,Wn(o.b7.transparent,Ae),null,Ce,H,C.debugBuffer,C.quadTriangleIndexBuffer,C.debugSegments),S.draw(_,v.LINE_STRIP,O,z,V,Di.disabled,Wn(o.b7.red),K,Ce,H,C.debugBuffer,C.tileBorderIndexBuffer,C.debugSegments)}function dl(C,s,u,_){let{isRenderingGlobe:v}=_,S=C.context,O=S.gl,z=C.transform,V=C.colorModeForRenderPass(),H=C.getDepthModeFor3D(),K=C.useProgram("terrain");S.bindFramebuffer.set(null),S.viewport.set([0,0,C.width,C.height]);for(let ne of u){let ie=s.getTerrainMesh(ne.tileID),fe=C.renderToTexture.getTexture(ne),Ae=s.getTerrainData(ne.tileID);S.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,fe.texture);let Ie=s.getMeshFrameDelta(z.zoom),Ce=z.calculateFogMatrix(ne.tileID.toUnwrapped()),Pe=gt(Ie,Ce,C.style.sky,z.pitch,v),Fe=z.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(S,O.TRIANGLES,H,bi.disabled,V,Di.backCCW,Pe,Ae,Fe,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}}function lp(C,s){if(!s.mesh){let u=new o.aF;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);let _=new o.aH;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),s.mesh=new Zc(C.createVertexBuffer(u,ql.members),C.createIndexBuffer(_),o.aG.simpleSegment(0,0,u.length,_.length))}return s.mesh}class Of{constructor(s,u){this.context=new If(s),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.at(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=de.maxUnderzooming+de.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Hd}resize(s,u,_){if(this.width=Math.floor(s*_),this.height=Math.floor(u*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let v of this.style._order)this.style._layers[v].resize()}setup(){let s=this.context,u=new o.aF;u.emplaceBack(0,0),u.emplaceBack(o.Z,0),u.emplaceBack(0,o.Z),u.emplaceBack(o.Z,o.Z),this.tileExtentBuffer=s.createVertexBuffer(u,ql.members),this.tileExtentSegments=o.aG.simpleSegment(0,0,4,2);let _=new o.aF;_.emplaceBack(0,0),_.emplaceBack(o.Z,0),_.emplaceBack(0,o.Z),_.emplaceBack(o.Z,o.Z),this.debugBuffer=s.createVertexBuffer(_,ql.members),this.debugSegments=o.aG.simpleSegment(0,0,4,5);let v=new o.bW;v.emplaceBack(0,0,0,0),v.emplaceBack(o.Z,0,o.Z,0),v.emplaceBack(0,o.Z,0,o.Z),v.emplaceBack(o.Z,o.Z,o.Z,o.Z),this.rasterBoundsBuffer=s.createVertexBuffer(v,fh.members),this.rasterBoundsSegments=o.aG.simpleSegment(0,0,4,2);let S=new o.aF;S.emplaceBack(0,0),S.emplaceBack(o.Z,0),S.emplaceBack(0,o.Z),S.emplaceBack(o.Z,o.Z),this.rasterBoundsBufferPosOnly=s.createVertexBuffer(S,ql.members),this.rasterBoundsSegmentsPosOnly=o.aG.simpleSegment(0,0,4,5);let O=new o.aF;O.emplaceBack(0,0),O.emplaceBack(1,0),O.emplaceBack(0,1),O.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(O,ql.members),this.viewportSegments=o.aG.simpleSegment(0,0,4,2);let z=new o.bX;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(z);let V=new o.aH;V.emplaceBack(1,0,2),V.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(V);let H=this.context.gl;this.stencilClearMode=new bi({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.tileExtentMesh=new Zc(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let s=this.context,u=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let _=o.K();o.bO(_,0,this.width,this.height,0,0,1),o.M(_,_,[u.drawingBufferWidth,u.drawingBufferHeight,0]);let v={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(s,u.TRIANGLES,ti.disabled,this.stencilClearMode,mn.disabled,Di.disabled,null,null,v,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,u,_){if(this.currentStencilSource===s.source||!s.isTileClipped()||!u||!u.length)return;this.currentStencilSource=s.source,this.nextStencilID+u.length>256&&this.clearStencil();let v=this.context;v.setColorMode(mn.disabled),v.setDepthMode(ti.disabled);let S={};for(let O of u)S[O.key]=this.nextStencilID++;this._renderTileMasks(S,u,_,!0),this._renderTileMasks(S,u,_,!1),this._tileClippingMaskIDs=S}_renderTileMasks(s,u,_,v){let S=this.context,O=S.gl,z=this.style.projection,V=this.transform,H=this.useProgram("clippingMask");for(let K of u){let ne=s[K.key],ie=this.style.map.terrain&&this.style.map.terrain.getTerrainData(K),fe=z.getMeshFromTileID(this.context,K.canonical,v,!0,"stencil"),Ae=V.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!0,applyTerrainMatrix:!0});H.draw(S,O.TRIANGLES,ti.disabled,new bi({func:O.ALWAYS,mask:0},ne,255,O.KEEP,O.KEEP,O.REPLACE),mn.disabled,_?Di.disabled:Di.backCCW,null,ie,Ae,"$clipping",fe.vertexBuffer,fe.indexBuffer,fe.segments)}}_renderTilesDepthBuffer(){let s=this.context,u=s.gl,_=this.style.projection,v=this.transform,S=this.useProgram("depth"),O=this.getDepthModeFor3D(),z=st(v,{tileSize:v.tileSize});for(let V of z){let H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(V),K=_.getMeshFromTileID(this.context,V.canonical,!0,!0,"raster"),ne=v.getProjectionData({overscaledTileID:V,applyGlobeMatrix:!0,applyTerrainMatrix:!0});S.draw(s,u.TRIANGLES,O,bi.disabled,mn.disabled,Di.backCCW,null,H,ne,"$clipping",K.vertexBuffer,K.indexBuffer,K.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let s=this.nextStencilID++,u=this.context.gl;return new bi({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){let u=this.context.gl;return new bi({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(s){let u=this.context.gl,_=s.sort((O,z)=>z.overscaledZ-O.overscaledZ),v=_[_.length-1].overscaledZ,S=_[0].overscaledZ-v+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();let O={};for(let z=0;z<S;z++)O[z+v]=new bi({func:u.GEQUAL,mask:255},z+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=S,[O,_]}return[{[v]:bi.disabled},_]}stencilConfigForOverlapTwoPass(s){let u=this.context.gl,_=s.sort((O,z)=>z.overscaledZ-O.overscaledZ),v=_[_.length-1].overscaledZ,S=_[0].overscaledZ-v+1;if(this.clearStencil(),S>1){let O={},z={};for(let V=0;V<S;V++)O[V+v]=new bi({func:u.GREATER,mask:255},S+1+V,255,u.KEEP,u.KEEP,u.REPLACE),z[V+v]=new bi({func:u.GREATER,mask:255},1+V,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*S+1,[O,z,_]}return this.nextStencilID=3,[{[v]:new bi({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[v]:new bi({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},_]}colorModeForRenderPass(){let s=this.context.gl;return this._showOverdrawInspector?new mn([s.CONSTANT_COLOR,s.ONE],new o.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mn.unblended:mn.alphaBlended}getDepthModeForSublayer(s,u,_){if(!this.opaquePassEnabledForLayer())return ti.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new ti(_||this.context.gl.LEQUAL,u,[v,v])}getDepthModeFor3D(){return new ti(this.context.gl.LEQUAL,ti.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,u){var _,v;this.style=s,this.options=u,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(x.now()),this.imageManager.beginFrame();let S=this.style._order,O=this.style.sourceCaches,z={},V={},H={},K={isRenderingToTexture:!1,isRenderingGlobe:((_=s.projection)===null||_===void 0?void 0:_.transitionState)>0};for(let ie in O){let fe=O[ie];fe.used&&fe.prepare(this.context),z[ie]=fe.getVisibleCoordinates(!1),V[ie]=z[ie].slice().reverse(),H[ie]=fe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ie=0;ie<S.length;ie++)if(this.style._layers[S[ie]].is3D()){this.opaquePassCutoff=ie;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let ie of S){let fe=this.style._layers[ie];if(!fe.hasOffscreenPass()||fe.isHidden(this.transform.zoom))continue;let Ae=V[fe.source];(fe.type==="custom"||Ae.length)&&this.renderLayer(this,O[fe.source],fe,Ae,K)}if((v=this.style.projection)===null||v===void 0||v.updateGPUdependent({context:this.context,useProgram:ie=>this.useProgram(ie)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?o.b7.black:o.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(ie,fe){let Ae=ie.context,Ie=Ae.gl,Ce=((Ge,Ze,_t)=>{let At=Math.cos(Ze.rollInRadians),Pt=Math.sin(Ze.rollInRadians),Lt=sh(Ze),Tt=Ze.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ge.properties.get("sky-color"),u_horizon_color:Ge.properties.get("horizon-color"),u_horizon:[(Ze.width/2-Lt*Pt)*_t,(Ze.height/2+Lt*At)*_t],u_horizon_normal:[-Pt,At],u_sky_horizon_blend:Ge.properties.get("sky-horizon-blend")*Ze.height/2*_t,u_sky_blend:Tt}})(fe,ie.style.map.transform,ie.pixelRatio),Pe=new ti(Ie.LEQUAL,ti.ReadWrite,[0,1]),Fe=bi.disabled,Ve=ie.colorModeForRenderPass(),Be=ie.useProgram("sky"),qe=lp(Ae,fe);Be.draw(Ae,Ie.TRIANGLES,Pe,Fe,Ve,Di.disabled,Ce,null,void 0,"sky",qe.vertexBuffer,qe.indexBuffer,qe.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){let ie=this.style._layers[S[this.currentLayer]],fe=O[ie.source],Ae=z[ie.source];this._renderTileClippingMasks(ie,Ae,!1),this.renderLayer(this,fe,ie,Ae,K)}this.renderPass="translucent";let ne=!1;for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){let ie=this.style._layers[S[this.currentLayer]],fe=O[ie.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ie,K))continue;this.opaquePassEnabledForLayer()||ne||(ne=!0,K.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let Ae=(ie.type==="symbol"?H:V)[ie.source];this._renderTileClippingMasks(ie,z[ie.source],!1),this.renderLayer(this,fe,ie,Ae,K)}if(K.isRenderingGlobe&&function(ie,fe,Ae){let Ie=ie.context,Ce=Ie.gl,Pe=ie.useProgram("atmosphere"),Fe=new ti(Ce.LEQUAL,ti.ReadOnly,[0,1]),Ve=ie.transform,Be=function(Tt,er){let Kt=Tt.properties.get("position"),Ut=[-Kt.x,-Kt.y,-Kt.z],mt=o.at(new Float64Array(16));return Tt.properties.get("anchor")==="map"&&(o.a_(mt,mt,er.rollInRadians),o.a$(mt,mt,-er.pitchInRadians),o.a_(mt,mt,er.bearingInRadians),o.a$(mt,mt,er.center.lat*Math.PI/180),o.bm(mt,mt,-er.center.lng*Math.PI/180)),o.bV(Ut,Ut,mt),Ut}(Ae,ie.transform),qe=Ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ge=fe.properties.get("atmosphere-blend")*qe.projectionTransition;if(Ge===0)return;let Ze=Zd(Ve.worldSize,Ve.center.lat),_t=Ve.inverseProjectionMatrix,At=new Float64Array(4);At[3]=1,o.ap(At,At,Ve.modelViewProjectionMatrix),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1,o.ap(At,At,_t),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1;let Pt=((Tt,er,Kt,Ut,mt)=>({u_sun_pos:Tt,u_atmosphere_blend:er,u_globe_position:Kt,u_globe_radius:Ut,u_inv_proj_matrix:mt}))(Be,Ge,[At[0],At[1],At[2]],Ze,_t),Lt=lp(Ie,fe);Pe.draw(Ie,Ce.TRIANGLES,Fe,bi.disabled,mn.alphaBlended,Di.disabled,Pt,null,null,"atmosphere",Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let ie=function(fe,Ae){let Ie=null,Ce=Object.values(fe._layers).flatMap(Be=>Be.source&&!Be.isHidden(Ae)?[fe.sourceCaches[Be.source]]:[]),Pe=Ce.filter(Be=>Be.getSource().type==="vector"),Fe=Ce.filter(Be=>Be.getSource().type!=="vector"),Ve=Be=>{(!Ie||Ie.getSource().maxzoom<Be.getSource().maxzoom)&&(Ie=Be)};return Pe.forEach(Be=>Ve(Be)),Ie||Fe.forEach(Be=>Ve(Be)),Ie}(this.style,this.transform.zoom);ie&&function(fe,Ae,Ie){for(let Ce=0;Ce<Ie.length;Ce++)_h(fe,Ae,Ie[Ce])}(this,ie,ie.getVisibleCoordinates())}this.options.showPadding&&function(ie){let fe=ie.transform.padding;lc(ie,ie.transform.height-(fe.top||0),3,u0),lc(ie,fe.bottom||0,3,Un),ap(ie,fe.left||0,3,ac),ap(ie,ie.transform.width-(fe.right||0),3,zs);let Ae=ie.transform.centerPoint;(function(Ie,Ce,Pe,Fe){Ua(Ie,Ce-1,Pe-10,2,20,Fe),Ua(Ie,Ce-10,Pe-1,20,2,Fe)})(ie,Ae.x,ie.transform.height-Ae.y,sp)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;let u=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix,v=this.terrainFacilitator.dirty;v||(v=s?!o.bY(u,_):!o.bZ(u,_)),v||(v=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),v&&(o.b_(u,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(S,O){let z=S.context,V=z.gl,H=S.transform,K=mn.unblended,ne=new ti(V.LEQUAL,ti.ReadWrite,[0,1]),ie=O.sourceCache.getRenderableTiles(),fe=S.useProgram("terrainDepth");z.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:o.b7.transparent,depth:1});for(let Ae of ie){let Ie=O.getTerrainMesh(Ae.tileID),Ce=O.getTerrainData(Ae.tileID),Pe=H.getProjectionData({overscaledTileID:Ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Fe={u_ele_delta:O.getMeshFrameDelta(H.zoom)};fe.draw(z,V.TRIANGLES,ne,bi.disabled,K,Di.backCCW,Fe,Ce,Pe,"terrain",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain),function(S,O){let z=S.context,V=z.gl,H=S.transform,K=mn.unblended,ne=new ti(V.LEQUAL,ti.ReadWrite,[0,1]),ie=O.getCoordsTexture(),fe=O.sourceCache.getRenderableTiles(),Ae=S.useProgram("terrainCoords");z.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,S.width/devicePixelRatio,S.height/devicePixelRatio]),z.clear({color:o.b7.transparent,depth:1}),O.coordsIndex=[];for(let Ie of fe){let Ce=O.getTerrainMesh(Ie.tileID),Pe=O.getTerrainData(Ie.tileID);z.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,ie.texture);let Fe={u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0,u_ele_delta:O.getMeshFrameDelta(H.zoom)},Ve=H.getProjectionData({overscaledTileID:Ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Ae.draw(z,V.TRIANGLES,ne,bi.disabled,K,Di.backCCW,Fe,Pe,Ve,"terrain",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments),O.coordsIndex.push(Ie.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,S.width,S.height])}(this,this.style.map.terrain))}renderLayer(s,u,_,v,S){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(v||[]).length)&&(this.id=_.id,o.b$(_)?function(O,z,V,H,K,ne){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ie}=ne,fe=bi.disabled,Ae=O.colorModeForRenderPass();(V._unevaluatedLayout.hasValue("text-variable-anchor")||V._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Ie,Ce,Pe,Fe,Ve,Be,qe,Ge,Ze){let _t=Ce.transform,At=Ce.style.map.terrain,Pt=Ve==="map",Lt=Be==="map";for(let Tt of Ie){let er=Fe.getTile(Tt),Kt=er.getBucket(Pe);if(!Kt||!Kt.text||!Kt.text.segments.get().length)continue;let Ut=o.ag(Kt.textSizeData,_t.zoom),mt=o.aw(er,1,Ce.transform.zoom),Nt=dt(Pt,Ce.transform,mt),Ri=Pe.layout.get("icon-text-fit")!=="none"&&Kt.hasIconData();if(Ut){let Hr=Math.pow(2,_t.zoom-er.tileID.overscaledZ),zi=At?(Zi,Ui)=>At.getElevation(Tt,Zi,Ui):null;fl(Kt,Pt,Lt,Ze,_t,Nt,Hr,Ut,Ri,o.ax(_t,er,qe,Ge),Tt.toUnwrapped(),zi)}}}(H,O,V,z,V.layout.get("text-rotation-alignment"),V.layout.get("text-pitch-alignment"),V.paint.get("text-translate"),V.paint.get("text-translate-anchor"),K),V.paint.get("icon-opacity").constantOr(1)!==0&&iu(O,z,V,H,!1,V.paint.get("icon-translate"),V.paint.get("icon-translate-anchor"),V.layout.get("icon-rotation-alignment"),V.layout.get("icon-pitch-alignment"),V.layout.get("icon-keep-upright"),fe,Ae,ie),V.paint.get("text-opacity").constantOr(1)!==0&&iu(O,z,V,H,!0,V.paint.get("text-translate"),V.paint.get("text-translate-anchor"),V.layout.get("text-rotation-alignment"),V.layout.get("text-pitch-alignment"),V.layout.get("text-keep-upright"),fe,Ae,ie),z.map.showCollisionBoxes&&(Ah(O,z,V,H,!0),Ah(O,z,V,H,!1))}(s,u,_,v,this.style.placement.variableOffsets,S):o.c0(_)?function(O,z,V,H,K){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=K,ie=V.paint.get("circle-opacity"),fe=V.paint.get("circle-stroke-width"),Ae=V.paint.get("circle-stroke-opacity"),Ie=!V.layout.get("circle-sort-key").isConstant();if(ie.constantOr(1)===0&&(fe.constantOr(1)===0||Ae.constantOr(1)===0))return;let Ce=O.context,Pe=Ce.gl,Fe=O.transform,Ve=O.getDepthModeForSublayer(0,ti.ReadOnly),Be=bi.disabled,qe=O.colorModeForRenderPass(),Ge=[],Ze=Fe.getCircleRadiusCorrection();for(let _t=0;_t<H.length;_t++){let At=H[_t],Pt=z.getTile(At),Lt=Pt.getBucket(V);if(!Lt)continue;let Tt=V.paint.get("circle-translate"),er=V.paint.get("circle-translate-anchor"),Kt=o.ax(Fe,Pt,Tt,er),Ut=Lt.programConfigurations.get(V.id),mt=O.useProgram("circle",Ut),Nt=Lt.layoutVertexBuffer,Ri=Lt.indexBuffer,Hr=O.style.map.terrain&&O.style.map.terrain.getTerrainData(At),zi={programConfiguration:Ut,program:mt,layoutVertexBuffer:Nt,indexBuffer:Ri,uniformValues:to(O,Pt,V,Kt,Ze),terrainData:Hr,projectionData:Fe.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!ne,applyTerrainMatrix:!0})};if(Ie){let Zi=Lt.segments.get();for(let Ui of Zi)Ge.push({segments:new o.aG([Ui]),sortKey:Ui.sortKey,state:zi})}else Ge.push({segments:Lt.segments,sortKey:0,state:zi})}Ie&&Ge.sort((_t,At)=>_t.sortKey-At.sortKey);for(let _t of Ge){let{programConfiguration:At,program:Pt,layoutVertexBuffer:Lt,indexBuffer:Tt,uniformValues:er,terrainData:Kt,projectionData:Ut}=_t.state;Pt.draw(Ce,Pe.TRIANGLES,Ve,Be,qe,Di.backCCW,er,Kt,Ut,V.id,Lt,Tt,_t.segments,V.paint,O.transform.zoom,At)}}(s,u,_,v,S):o.c1(_)?function(O,z,V,H,K){if(V.paint.get("heatmap-opacity")===0)return;let ne=O.context,{isRenderingToTexture:ie,isRenderingGlobe:fe}=K;if(O.style.map.terrain){for(let Ae of H){let Ie=z.getTile(Ae);z.hasRenderableParent(Ae)||(O.renderPass==="offscreen"?oc(O,Ie,V,Ae,fe):O.renderPass==="translucent"&&Ta(O,V,Ae,ie,fe))}ne.viewport.set([0,0,O.width,O.height])}else O.renderPass==="offscreen"?function(Ae,Ie,Ce,Pe){let Fe=Ae.context,Ve=Fe.gl,Be=Ae.transform,qe=bi.disabled,Ge=new mn([Ve.ONE,Ve.ONE],o.b7.transparent,[!0,!0,!0,!0]);(function(Ze,_t,At){let Pt=Ze.gl;Ze.activeTexture.set(Pt.TEXTURE1),Ze.viewport.set([0,0,_t.width/4,_t.height/4]);let Lt=At.heatmapFbos.get(o.bS);Lt?(Pt.bindTexture(Pt.TEXTURE_2D,Lt.colorAttachment.get()),Ze.bindFramebuffer.set(Lt.framebuffer)):(Lt=op(Ze,_t.width/4,_t.height/4),At.heatmapFbos.set(o.bS,Lt))})(Fe,Ae,Ce),Fe.clear({color:o.b7.transparent});for(let Ze=0;Ze<Pe.length;Ze++){let _t=Pe[Ze];if(Ie.hasRenderableParent(_t))continue;let At=Ie.getTile(_t),Pt=At.getBucket(Ce);if(!Pt)continue;let Lt=Pt.programConfigurations.get(Ce.id),Tt=Ae.useProgram("heatmap",Lt),er=Be.getProjectionData({overscaledTileID:_t,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Kt=Be.getCircleRadiusCorrection();Tt.draw(Fe,Ve.TRIANGLES,ti.disabled,qe,Ge,Di.backCCW,Ei(At,Be.zoom,Ce.paint.get("heatmap-intensity"),Kt),null,er,Ce.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,Ce.paint,Be.zoom,Lt)}Fe.viewport.set([0,0,Ae.width,Ae.height])}(O,z,V,H):O.renderPass==="translucent"&&function(Ae,Ie){let Ce=Ae.context,Pe=Ce.gl;Ce.setColorMode(Ae.colorModeForRenderPass());let Fe=Ie.heatmapFbos.get(o.bS);Fe&&(Ce.activeTexture.set(Pe.TEXTURE0),Pe.bindTexture(Pe.TEXTURE_2D,Fe.colorAttachment.get()),Ce.activeTexture.set(Pe.TEXTURE1),Rf(Ce,Ie).bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),Ae.useProgram("heatmapTexture").draw(Ce,Pe.TRIANGLES,ti.disabled,bi.disabled,Ae.colorModeForRenderPass(),Di.disabled,Mi(Ae,Ie,0,1),null,null,Ie.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments,Ie.paint,Ae.transform.zoom))}(O,V)}(s,u,_,v,S):o.c2(_)?function(O,z,V,H,K){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=K,ie=V.paint.get("line-opacity"),fe=V.paint.get("line-width");if(ie.constantOr(1)===0||fe.constantOr(1)===0)return;let Ae=O.getDepthModeForSublayer(0,ti.ReadOnly),Ie=O.colorModeForRenderPass(),Ce=V.paint.get("line-dasharray"),Pe=V.paint.get("line-pattern"),Fe=Pe.constantOr(1),Ve=V.paint.get("line-gradient"),Be=V.getCrossfadeParameters(),qe=Fe?"linePattern":Ce?"lineSDF":Ve?"lineGradient":"line",Ge=O.context,Ze=Ge.gl,_t=O.transform,At=!0;for(let Pt of H){let Lt=z.getTile(Pt);if(Fe&&!Lt.patternsLoaded())continue;let Tt=Lt.getBucket(V);if(!Tt)continue;let er=Tt.programConfigurations.get(V.id),Kt=O.context.program.get(),Ut=O.useProgram(qe,er),mt=At||Ut.program!==Kt,Nt=O.style.map.terrain&&O.style.map.terrain.getTerrainData(Pt),Ri=Pe.constantOr(null);if(Ri&&Lt.imageAtlas){let Wi=Lt.imageAtlas,vi=Wi.patternPositions[Ri.to.toString()],m=Wi.patternPositions[Ri.from.toString()];vi&&m&&er.setConstantPatternPositions(vi,m)}let Hr=_t.getProjectionData({overscaledTileID:Pt,applyGlobeMatrix:!ne,applyTerrainMatrix:!0}),zi=_t.getPixelScale(),Zi=Fe?xa(O,Lt,V,zi,Be):Ce?ba(O,Lt,V,zi,Ce,Be):Ve?Ps(O,Lt,V,zi,Tt.lineClipsArray.length):Kc(O,Lt,V,zi);if(Fe)Ge.activeTexture.set(Ze.TEXTURE0),Lt.imageAtlasTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),er.updatePaintBuffers(Be);else if(Ce&&(mt||O.lineAtlas.dirty))Ge.activeTexture.set(Ze.TEXTURE0),O.lineAtlas.bind(Ge);else if(Ve){let Wi=Tt.gradients[V.id],vi=Wi.texture;if(V.gradientVersion!==Wi.version){let m=256;if(V.stepInterpolant){let A=z.getSource().maxzoom,b=Pt.canonical.z===A?Math.ceil(1<<O.transform.maxZoom-Pt.canonical.z):1;m=o.ae(o.bT(Tt.maxLineLength/o.Z*1024*b),256,Ge.maxTextureSize)}Wi.gradient=o.bU({expression:V.gradientExpression(),evaluationKey:"lineProgress",resolution:m,image:Wi.gradient||void 0,clips:Tt.lineClipsArray}),Wi.texture?Wi.texture.update(Wi.gradient):Wi.texture=new je(Ge,Wi.gradient,Ze.RGBA),Wi.version=V.gradientVersion,vi=Wi.texture}Ge.activeTexture.set(Ze.TEXTURE0),vi.bind(V.stepInterpolant?Ze.NEAREST:Ze.LINEAR,Ze.CLAMP_TO_EDGE)}let Ui;if(ne){let[Wi]=O.getStencilConfigForOverlapAndUpdateStencilID(H);Ui=Wi[Pt.overscaledZ]}else Ui=O.stencilModeForClipping(Pt);Ut.draw(Ge,Ze.TRIANGLES,Ae,Ui,Ie,Di.disabled,Zi,Nt,Hr,V.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,V.paint,O.transform.zoom,er,Tt.layoutVertexBuffer2),At=!1}}(s,u,_,v,S):o.c3(_)?function(O,z,V,H,K){let ne=V.paint.get("fill-color"),ie=V.paint.get("fill-opacity");if(ie.constantOr(1)===0)return;let{isRenderingToTexture:fe}=K,Ae=O.colorModeForRenderPass(),Ie=V.paint.get("fill-pattern"),Ce=O.opaquePassEnabledForLayer()&&!Ie.constantOr(1)&&ne.constantOr(o.b7.transparent).a===1&&ie.constantOr(0)===1?"opaque":"translucent";if(O.renderPass===Ce){let Pe=O.getDepthModeForSublayer(1,O.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);Bf(O,z,V,H,Pe,Ae,!1,fe)}if(O.renderPass==="translucent"&&V.paint.get("fill-antialias")){let Pe=O.getDepthModeForSublayer(V.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);Bf(O,z,V,H,Pe,Ae,!0,fe)}}(s,u,_,v,S):o.c4(_)?function(O,z,V,H,K){let ne=V.paint.get("fill-extrusion-opacity");if(ne===0)return;let{isRenderingToTexture:ie}=K;if(O.renderPass==="translucent"){let fe=new ti(O.context.gl.LEQUAL,ti.ReadWrite,O.depthRangeFor3D);if(ne!==1||V.paint.get("fill-extrusion-pattern").constantOr(1))Lf(O,z,V,H,fe,bi.disabled,mn.disabled,ie),Lf(O,z,V,H,fe,O.stencilModeFor3D(),O.colorModeForRenderPass(),ie);else{let Ae=O.colorModeForRenderPass();Lf(O,z,V,H,fe,bi.disabled,Ae,ie)}}}(s,u,_,v,S):o.c5(_)?function(O,z,V,H,K){if(O.renderPass!=="offscreen"&&O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=K,ie=O.context,fe=O.style.projection.useSubdivision,Ae=O.getDepthModeForSublayer(0,ti.ReadOnly),Ie=O.colorModeForRenderPass();if(O.renderPass==="offscreen")(function(Ce,Pe,Fe,Ve,Be,qe,Ge){let Ze=Ce.context,_t=Ze.gl;for(let At of Fe){let Pt=Pe.getTile(At),Lt=Pt.dem;if(!Lt||!Lt.data||!Pt.needsHillshadePrepare)continue;let Tt=Lt.dim,er=Lt.stride,Kt=Lt.getPixels();if(Ze.activeTexture.set(_t.TEXTURE1),Ze.pixelStoreUnpackPremultiplyAlpha.set(!1),Pt.demTexture=Pt.demTexture||Ce.getTileTexture(er),Pt.demTexture){let mt=Pt.demTexture;mt.update(Kt,{premultiply:!1}),mt.bind(_t.NEAREST,_t.CLAMP_TO_EDGE)}else Pt.demTexture=new je(Ze,Kt,_t.RGBA,{premultiply:!1}),Pt.demTexture.bind(_t.NEAREST,_t.CLAMP_TO_EDGE);Ze.activeTexture.set(_t.TEXTURE0);let Ut=Pt.fbo;if(!Ut){let mt=new je(Ze,{width:Tt,height:Tt,data:null},_t.RGBA);mt.bind(_t.LINEAR,_t.CLAMP_TO_EDGE),Ut=Pt.fbo=Ze.createFramebuffer(Tt,Tt,!0,!1),Ut.colorAttachment.set(mt.texture)}Ze.bindFramebuffer.set(Ut.framebuffer),Ze.viewport.set([0,0,Tt,Tt]),Ce.useProgram("hillshadePrepare").draw(Ze,_t.TRIANGLES,Be,qe,Ge,Di.disabled,r0(Pt.tileID,Lt),null,null,Ve.id,Ce.rasterBoundsBuffer,Ce.quadTriangleIndexBuffer,Ce.rasterBoundsSegments),Pt.needsHillshadePrepare=!1}})(O,z,H,V,Ae,bi.disabled,Ie),ie.viewport.set([0,0,O.width,O.height]);else if(O.renderPass==="translucent")if(fe){let[Ce,Pe,Fe]=O.stencilConfigForOverlapTwoPass(H);gh(O,z,V,Fe,Ce,Ae,Ie,!1,ne),gh(O,z,V,Fe,Pe,Ae,Ie,!0,ne)}else{let[Ce,Pe]=O.getStencilConfigForOverlapAndUpdateStencilID(H);gh(O,z,V,Pe,Ce,Ae,Ie,!1,ne)}}(s,u,_,v,S):o.c6(_)?function(O,z,V,H,K){if(O.renderPass!=="translucent"||V.paint.get("raster-opacity")===0||!H.length)return;let{isRenderingToTexture:ne}=K,ie=z.getSource(),fe=O.style.projection.useSubdivision;if(ie instanceof co)ou(O,z,V,H,null,!1,!1,ie.tileCoords,ie.flippedWindingOrder,ne);else if(fe){let[Ae,Ie,Ce]=O.stencilConfigForOverlapTwoPass(H);ou(O,z,V,Ce,Ae,!1,!0,nu,!1,ne),ou(O,z,V,Ce,Ie,!0,!0,nu,!1,ne)}else{let[Ae,Ie]=O.getStencilConfigForOverlapAndUpdateStencilID(H);ou(O,z,V,Ie,Ae,!1,!0,nu,!1,ne)}}(s,u,_,v,S):o.c7(_)?function(O,z,V,H,K){let ne=V.paint.get("background-color"),ie=V.paint.get("background-opacity");if(ie===0)return;let{isRenderingToTexture:fe}=K,Ae=O.context,Ie=Ae.gl,Ce=O.style.projection,Pe=O.transform,Fe=Pe.tileSize,Ve=V.paint.get("background-pattern");if(O.isPatternMissing(Ve))return;let Be=!Ve&&ne.a===1&&ie===1&&O.opaquePassEnabledForLayer()?"opaque":"translucent";if(O.renderPass!==Be)return;let qe=bi.disabled,Ge=O.getDepthModeForSublayer(0,Be==="opaque"?ti.ReadWrite:ti.ReadOnly),Ze=O.colorModeForRenderPass(),_t=O.useProgram(Ve?"backgroundPattern":"background"),At=H||st(Pe,{tileSize:Fe,terrain:O.style.map.terrain});Ve&&(Ae.activeTexture.set(Ie.TEXTURE0),O.imageManager.bind(O.context));let Pt=V.getCrossfadeParameters();for(let Lt of At){let Tt=Pe.getProjectionData({overscaledTileID:Lt,applyGlobeMatrix:!fe,applyTerrainMatrix:!0}),er=Ve?yf(ie,O,Ve,{tileID:Lt,tileSize:Fe},Pt):n0(ie,ne),Kt=O.style.map.terrain&&O.style.map.terrain.getTerrainData(Lt),Ut=Ce.getMeshFromTileID(Ae,Lt.canonical,!1,!0,"raster");_t.draw(Ae,Ie.TRIANGLES,Ge,qe,Ze,Di.backCCW,er,Kt,Tt,V.id,Ut.vertexBuffer,Ut.indexBuffer,Ut.segments)}}(s,0,_,v,S):o.c8(_)&&function(O,z,V,H){let{isRenderingGlobe:K}=H,ne=O.context,ie=V.implementation,fe=O.style.projection,Ae=O.transform,Ie=Ae.getProjectionDataForCustomLayer(K),Ce={farZ:Ae.farZ,nearZ:Ae.nearZ,fov:Ae.fov*Math.PI/180,modelViewProjectionMatrix:Ae.modelViewProjectionMatrix,projectionMatrix:Ae.projectionMatrix,shaderData:{variantName:fe.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${fe.shaderPreludeCode.vertexSource}`,define:fe.shaderDefine},defaultProjectionData:Ie},Pe=ie.renderingMode?ie.renderingMode:"2d";if(O.renderPass==="offscreen"){let Fe=ie.prerender;Fe&&(O.setCustomLayerDefaults(),ne.setColorMode(O.colorModeForRenderPass()),Fe.call(ie,ne.gl,Ce),ne.setDirty(),O.setBaseState())}else if(O.renderPass==="translucent"){O.setCustomLayerDefaults(),ne.setColorMode(O.colorModeForRenderPass()),ne.setStencilMode(bi.disabled);let Fe=Pe==="3d"?O.getDepthModeFor3D():O.getDepthModeForSublayer(0,ti.ReadOnly);ne.setDepthMode(Fe),ie.render(ne.gl,Ce),ne.setDirty(),O.setBaseState(),ne.bindFramebuffer.set(null)}}(s,0,_,S))}saveTileTexture(s){let u=this._tileTextures[s.size[0]];u?u.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){let u=this._tileTextures[s];return u&&u.length>0?u.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;let u=this.imageManager.getPattern(s.from.toString()),_=this.imageManager.getPattern(s.to.toString());return!u||!_}useProgram(s,u,_=!1){this.cache=this.cache||{};let v=!!this.style.map.terrain,S=this.style.projection,O=s+(u?u.cacheKey:"")+`/${_?oh:S.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"");return this.cache[O]||(this.cache[O]=new Lr(this.context,ga[s],u,Yd[s],this._showOverdrawInspector,v,_?ga.projectionMercator:S.shaderPreludeCode,_?cl:S.shaderDefine)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new je(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:s,drawingBufferHeight:u}=this.context.gl;return this.width!==s||this.height!==u}}function Df(C,s){let u,_=!1,v=null,S=null,O=()=>{v=null,_&&(C.apply(S,u),v=setTimeout(O,s),_=!1)};return(...z)=>(_=!0,S=this,u=z,v||O(),v)}class pl{constructor(s){this._getCurrentHash=()=>{let u=window.location.hash.replace("#","");if(this._hashName){let _;return u.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(_=v)}),(_&&_[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{let u=this._getCurrentHash();if(!this._isValidHash(u))return!1;let _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{let u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{let u=this._getCurrentHash();if(u.length===0)return;let _=u.join("/"),v=_;v.split("&").length>0&&(v=v.split("&")[0]),this._hashName&&(v=`${this._hashName}=${_}`);let S=window.location.hash.replace(v,"");S.startsWith("#&")?S=S.slice(0,1)+S.slice(2):S==="#"&&(S="");let O=window.location.href.replace(/(#.+)?$/,S);O=O.replace("&&","&"),window.history.replaceState(window.history.state,null,O)},this._updateHash=Df(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){let u=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,v),O=Math.round(u.lng*S)/S,z=Math.round(u.lat*S)/S,V=this._map.getBearing(),H=this._map.getPitch(),K="";if(K+=s?`/${O}/${z}/${_}`:`${_}/${z}/${O}`,(V||H)&&(K+="/"+Math.round(10*V)/10),H&&(K+=`/${Math.round(H)}`),this._hashName){let ne=this._hashName,ie=!1,fe=window.location.hash.slice(1).split("&").map(Ae=>{let Ie=Ae.split("=")[0];return Ie===ne?(ie=!0,`${Ie}=${K}`):Ae}).filter(Ae=>Ae);return ie||fe.push(`${ne}=${K}`),`#${fe.join("&")}`}return`#${K}`}_isValidHash(s){if(s.length<3||s.some(isNaN))return!1;try{new o.Q(+s[2],+s[1])}catch{return!1}let u=+s[0],_=+(s[3]||0),v=+(s[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&_>=-180&&_<=180&&v>=this._map.getMinPitch()&&v<=this._map.getMaxPitch()}}let su={linearity:.3,easing:o.c9(0,0,.3,1)},Va=o.e({deceleration:2500,maxSpeed:1400},su),cp=o.e({deceleration:20,maxSpeed:1400},su),h0=o.e({deceleration:1e3,maxSpeed:360},su),up=o.e({deceleration:1e3,maxSpeed:90},su),Ff=o.e({deceleration:1e3,maxSpeed:360},su);class kf{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:x.now(),settings:s})}_drainInertiaBuffer(){let s=this._inertiaBuffer,u=x.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let u={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:S}of this._inertiaBuffer)u.zoom+=S.zoomDelta||0,u.bearing+=S.bearingDelta||0,u.pitch+=S.pitchDelta||0,u.roll+=S.rollDelta||0,S.panDelta&&u.pan._add(S.panDelta),S.around&&(u.around=S.around),S.pinchAround&&(u.pinchAround=S.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){let S=Hi(u.pan.mag(),_,o.e({},Va,s||{})),O=u.pan.mult(S.amount/u.pan.mag()),z=this._map.cameraHelper.handlePanInertia(O,this._map.transform);v.center=z.easingCenter,v.offset=z.easingOffset,ja(v,S)}if(u.zoom){let S=Hi(u.zoom,_,cp);v.zoom=this._map.transform.zoom+S.amount,ja(v,S)}if(u.bearing){let S=Hi(u.bearing,_,h0);v.bearing=this._map.transform.bearing+o.ae(S.amount,-179,179),ja(v,S)}if(u.pitch){let S=Hi(u.pitch,_,up);v.pitch=this._map.transform.pitch+S.amount,ja(v,S)}if(u.roll){let S=Hi(u.roll,_,Ff);v.roll=this._map.transform.roll+o.ae(S.amount,-179,179),ja(v,S)}if(v.zoom||v.bearing){let S=u.pinchAround===void 0?u.around:u.pinchAround;v.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),o.e(v,{noMoveStart:!0})}}function ja(C,s){(!C.duration||C.duration<s.duration)&&(C.duration=s.duration,C.easing=s.easing)}function Hi(C,s,u){let{maxSpeed:_,linearity:v,deceleration:S}=u,O=o.ae(C*v/(s/1e3),-_,_),z=Math.abs(O)/(S*v);return{easing:u.easing,duration:1e3*z,amount:O*(z/2)}}class No extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,_,v={}){_=_ instanceof MouseEvent?_:new MouseEvent(s,_);let S=T.mousePos(u.getCanvas(),_),O=u.unproject(S);super(s,o.e({point:S,lngLat:O,originalEvent:_},v)),this._defaultPrevented=!1,this.target=u}}class au extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,_){let v=s==="touchend"?_.changedTouches:_.touches,S=T.touchPos(u.getCanvasContainer(),v),O=S.map(V=>u.unproject(V)),z=S.reduce((V,H,K,ne)=>V.add(H.div(ne.length)),new o.P(0,0));super(s,{points:S,point:z,lngLats:O,lngLat:u.unproject(z),originalEvent:_}),this._defaultPrevented=!1}}class Us extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,_){super(s,{originalEvent:_}),this._defaultPrevented=!1}}class Ea{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Us(s.type,this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new No(s.type,this._map,s))}mouseup(s){this._map.fire(new No(s.type,this._map,s))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new No(s.type,this._map,s))}dblclick(s){return this._firePreventable(new No(s.type,this._map,s))}mouseover(s){this._map.fire(new No(s.type,this._map,s))}mouseout(s){this._map.fire(new No(s.type,this._map,s))}touchstart(s){return this._firePreventable(new au(s.type,this._map,s))}touchmove(s){this._map.fire(new au(s.type,this._map,s))}touchend(s){this._map.fire(new au(s.type,this._map,s))}touchcancel(s){this._map.fire(new au(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class f0{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new No(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new No("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new No(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ds{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.screenPointToLocation(o.P.convert(s),this._map.terrain)}}class cc{constructor(s,u){this._map=s,this._tr=new ds(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(T.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;let _=u;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;let v=this._startPos;this._lastPos=_,this._box||(this._box=T.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));let S=Math.min(v.x,_.x),O=Math.max(v.x,_.x),z=Math.min(v.y,_.y),V=Math.max(v.y,_.y);T.setTransform(this._box,`translate(${S}px,${z}px)`),this._box.style.width=O-S+"px",this._box.style.height=V-z+"px"}mouseupWindow(s,u){if(!this._active||s.button!==0)return;let _=this._startPos,v=u;if(this.reset(),T.suppressClick(),_.x!==v.x||_.y!==v.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:s})),{cameraAnimation:S=>S.fitScreenCoordinates(_,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(T.remove(this._box),this._box=null),T.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new o.l(s,{originalEvent:u}))}}function zo(C,s){if(C.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${C.length}, points ${s.length}`);let u={};for(let _=0;_<C.length;_++)u[C[_].identifier]=s[_];return u}class hp{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){let S=new o.P(0,0);for(let O of v)S._add(O);return S.div(v.length)}(u),this.touches=zo(_,u)))}touchmove(s,u,_){if(this.aborted||!this.centroid)return;let v=zo(_,u);for(let S in this.touches){let O=v[S];(!O||O.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(s,u,_){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ga{constructor(s){this.singleTap=new hp(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,u,_){this.singleTap.touchstart(s,u,_)}touchmove(s,u,_){this.singleTap.touchmove(s,u,_)}touchend(s,u,_){let v=this.singleTap.touchend(s,u,_);if(v){let S=s.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(v)<30;if(S&&O||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class jg{constructor(s){this._tr=new ds(s),this._zoomIn=new Ga({numTouches:1,numTaps:2}),this._zoomOut=new Ga({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,_){this._zoomIn.touchstart(s,u,_),this._zoomOut.touchstart(s,u,_)}touchmove(s,u,_){this._zoomIn.touchmove(s,u,_),this._zoomOut.touchmove(s,u,_)}touchend(s,u,_){let v=this._zoomIn.touchend(s,u,_),S=this._zoomOut.touchend(s,u,_),O=this._tr;return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:O.zoom+1,around:O.unproject(v)},{originalEvent:s})}):S?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:z=>z.easeTo({duration:300,zoom:O.zoom-1,around:O.unproject(S)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Al{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){let u=this._moveFunction(...s);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(s,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,u){if(!this.isEnabled())return;let _=this._lastPoint;if(!_)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);let v=Array.isArray(u)?u[0]:u;return!this._moved&&v.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(_,v))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&T.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let yh={0:1,2:2};class wn{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){let u=T.mouseButton(s);this._eventButton=u}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(u,_){let v=yh[_];return u.buttons===void 0||(u.buttons&v)!==v}(s,this._eventButton)}isValidEndEvent(s){return T.mouseButton(s)===this._eventButton}}class ur{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}class Nf{constructor(s=new wn({checkCorrectEvent:()=>!0}),u=new ur){this.mouseMoveStateManager=s,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(s,u,_){return s instanceof MouseEvent?u(s):typeof TouchEvent<"u"&&s instanceof TouchEvent?_(s):void 0}startMove(s){this._executeRelevantHandler(s,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(s){this._executeRelevantHandler(s,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(s){return this._executeRelevantHandler(s,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(s){return this._executeRelevantHandler(s,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(s){return this._executeRelevantHandler(s,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}let ta=C=>{C.mousedown=C.dragStart,C.mousemoveWindow=C.dragMove,C.mouseup=C.dragEnd,C.contextmenu=s=>{s.preventDefault()}};class lu{constructor(s,u){this._clickTolerance=s.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,u,_){return this._calculateTransform(s,u,_)}touchmove(s,u,_){if(this._active){if(!this._shouldBePrevented(_.length))return s.preventDefault(),this._calculateTransform(s,u,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,u,_){this._calculateTransform(s,u,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,_){_.length>0&&(this._active=!0);let v=zo(_,u),S=new o.P(0,0),O=new o.P(0,0),z=0;for(let H in v){let K=v[H],ne=this._touches[H];ne&&(S._add(K),O._add(K.sub(ne)),z++,v[H]=K)}if(this._touches=v,this._shouldBePrevented(z)||!O.mag())return;let V=O.div(z);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(z),panDelta:V}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ra{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,_){if(!this._firstTwoTouches)return;s.preventDefault();let[v,S]=this._firstTwoTouches,O=ml(_,u,v),z=ml(_,u,S);if(!O||!z)return;let V=this._aroundCenter?null:O.add(z).div(2);return this._move([O,z],V,s)}touchend(s,u,_){if(!this._firstTwoTouches)return;let[v,S]=this._firstTwoTouches,O=ml(_,u,v),z=ml(_,u,S);O&&z||(this._active&&T.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ml(C,s,u){for(let _=0;_<C.length;_++)if(C[_].identifier===u)return s[_]}function zf(C,s){return Math.log(C/s)/Math.LN2}class li extends ra{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){let _=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(zf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zf(this._distance,_),pinchAround:u}}}function cu(C,s){return 180*C.angleWith(s)/Math.PI}class d0 extends ra{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u,_){let v=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:cu(this._vector,v),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());let u=25/(Math.PI*this._minDiameter)*360,_=cu(s,this._startVector);return Math.abs(_)<u}}function xh(C){return Math.abs(C.y)>Math.abs(C.x)}class fp extends ra{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,u,_){super.touchstart(s,u,_),this._currentTouchCount=_.length}_start(s){this._lastPoints=s,xh(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let v=s[0].sub(this._lastPoints[0]),S=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,S,_.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(s,u,_){if(this._valid!==void 0)return this._valid;let v=s.mag()>=2,S=u.mag()>=2;if(!v&&!S)return;if(!v||!S)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;let O=s.y>0==u.y>0;return xh(s)&&xh(u)&&O}}let p0={panStep:100,bearingStep:15,pitchStep:10};class uc{constructor(s){this._tr=new ds(s);let u=p0;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,_=0,v=0,S=0,O=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?_=-1:(s.preventDefault(),S=-1);break;case 39:s.shiftKey?_=1:(s.preventDefault(),S=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),O=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:z=>{let V=this._tr;z.easeTo({duration:300,easeId:"keyboardHandler",easing:gl,zoom:u?Math.round(V.zoom)+u*(s.shiftKey?2:1):V.zoom,bearing:V.bearing+_*this._bearingStep,pitch:V.pitch+v*this._pitchStep,offset:[-S*this._panStep,-O*this._panStep],center:V.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gl(C){return C*(2-C)}let dp=4.000244140625;class uu{constructor(s,u){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=s,this._tr=new ds(s),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,_=x.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%dp==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=T.mousePos(this._map.getCanvas(),s),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(o.Q.convert(_.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let s=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let z=s.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=z),typeof this._targetZoom=="number"&&(this._targetZoom+=z)}if(this._delta!==0){let z=this._type==="wheel"&&Math.abs(this._delta)>dp?this._wheelZoomRate:this._defaultZoomRate,V=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&V!==0&&(V=1/V);let H=typeof this._targetZoom!="number"?s.scale:o.aI(this._targetZoom);this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,o.ab(H*V))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let u=typeof this._targetZoom!="number"?s.zoom:this._targetZoom,_=this._startZoom,v=this._easing,S,O=!1;if(this._type==="wheel"&&_&&v){let z=x.now()-this._lastWheelEventTime,V=Math.min((z+5)/200,1),H=v(V);S=o.B.number(_,u,H),V<1?this._frameId||(this._frameId=!0):O=!0}else S=u,O=!0;return this._active=!0,O&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=S,{noInertia:!0,needsRenderFrame:!O,zoomDelta:S-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=o.cb;if(this._prevEase){let _=this._prevEase,v=(x.now()-_.start)/_.duration,S=_.easing(v+.01)-_.easing(v),O=.27/Math.sqrt(S*S+1e-4)*.01,z=Math.sqrt(.0729-O*O);u=o.c9(O,z,.25,1)}return this._prevEase={start:x.now(),duration:s,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class pp{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gg{constructor(s){this._tr=new ds(s),this.reset()}reset(){this._active=!1}dblclick(s,u){return s.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hg{constructor(){this._tap=new Ga({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,u,_){if(!this._swipePoint)if(this._tapTime){let v=u[0],S=s.timeStamp-this._tapTime<500,O=this._tapPoint.dist(v)<30;S&&O?_.length>0&&(this._swipePoint=v,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(s,u,_)}touchmove(s,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let v=u[0],S=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(s,u,_)}touchend(s,u,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{let v=this._tap.touchend(s,u,_);v&&(this._tapTime=s.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ha{constructor(s,u,_){this._el=s,this._mousePan=u,this._touchPan=_}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class hn{constructor(s,u,_,v){this._pitchWithRotate=s.pitchWithRotate,this._rollEnabled=s.rollEnabled,this._mouseRotate=u,this._mousePitch=_,this._mouseRoll=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class bh{constructor(s,u,_,v){this._el=s,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Uf{constructor(s,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=T.create("div","maplibregl-cooperative-gesture-screen",s);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=u,this._container.appendChild(v);let S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=_,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(T.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,u){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:s,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let hc=C=>C.zoom||C.drag||C.roll||C.pitch||C.rotate;class Ap extends o.l{}function hu(C){return C.panDelta&&C.panDelta.mag()||C.zoomDelta||C.bearingDelta||C.pitchDelta||C.rollDelta}class Wg{constructor(s,u){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,S)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let O=v.type==="renderFrame"?void 0:v,z={needsRenderFrame:!1},V={},H={};for(let{handlerName:ie,handler:fe,allowed:Ae}of this._handlers){if(!fe.isEnabled())continue;let Ie;if(this._blockedByActive(H,Ae,ie))fe.reset();else if(fe[S||v.type]){if(o.cc(v,S||v.type)){let Ce=T.mousePos(this._map.getCanvas(),v);Ie=fe[S||v.type](v,Ce)}else if(o.cd(v,S||v.type)){let Ce=this._getMapTouches(v.touches),Pe=T.touchPos(this._map.getCanvas(),Ce);Ie=fe[S||v.type](v,Pe,Ce)}else o.ce(S||v.type)||(Ie=fe[S||v.type](v));this.mergeHandlerResult(z,V,Ie,ie,O),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()}(Ie||fe.isActive())&&(H[ie]=fe)}let K={};for(let ie in this._previousActiveHandlers)H[ie]||(K[ie]=O);this._previousActiveHandlers=H,(Object.keys(K).length||hu(z))&&(this._changes.push([z,V,K]),this._triggerRenderFrame()),(Object.keys(H).length||hu(z))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:ne}=z;ne&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ne(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kf(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,S,O]of this._listeners)T.addEventListener(v,S,v===document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(let[s,u,_]of this._listeners)T.removeEventListener(s,u,s===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(s){let u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new Ea(u,s));let v=u.boxZoom=new cc(u,s);this._add("boxZoom",v),s.interactive&&s.boxZoom&&v.enable();let S=u.cooperativeGestures=new Uf(u,s.cooperativeGestures);this._add("cooperativeGestures",S),s.cooperativeGestures&&S.enable();let O=new jg(u),z=new Gg(u);u.doubleClickZoom=new pp(z,O),this._add("tapZoom",O),this._add("clickZoom",z),s.interactive&&s.doubleClickZoom&&u.doubleClickZoom.enable();let V=new Hg;this._add("tapDragZoom",V);let H=u.touchPitch=new fp(u);this._add("touchPitch",H),s.interactive&&s.touchPitch&&u.touchPitch.enable(s.touchPitch);let K=()=>u.project(u.getCenter()),ne=function({enable:Be,clickTolerance:qe,aroundCenter:Ge=!0,minPixelCenterThreshold:Ze=100,rotateDegreesPerPixelMoved:_t=.8},At){let Pt=new wn({checkCorrectEvent:Lt=>T.mouseButton(Lt)===0&&Lt.ctrlKey||T.mouseButton(Lt)===2&&!Lt.ctrlKey});return new Al({clickTolerance:qe,move:(Lt,Tt)=>{let er=At();if(Ge&&Math.abs(er.y-Lt.y)>Ze)return{bearingDelta:o.ca(new o.P(Lt.x,Tt.y),Tt,er)};let Kt=(Tt.x-Lt.x)*_t;return Ge&&Tt.y<er.y&&(Kt=-Kt),{bearingDelta:Kt}},moveStateManager:Pt,enable:Be,assignEvents:ta})}(s,K),ie=function({enable:Be,clickTolerance:qe,pitchDegreesPerPixelMoved:Ge=-.5}){let Ze=new wn({checkCorrectEvent:_t=>T.mouseButton(_t)===0&&_t.ctrlKey||T.mouseButton(_t)===2});return new Al({clickTolerance:qe,move:(_t,At)=>({pitchDelta:(At.y-_t.y)*Ge}),moveStateManager:Ze,enable:Be,assignEvents:ta})}(s),fe=function({enable:Be,clickTolerance:qe,rollDegreesPerPixelMoved:Ge=.3},Ze){let _t=new wn({checkCorrectEvent:At=>T.mouseButton(At)===2&&At.ctrlKey});return new Al({clickTolerance:qe,move:(At,Pt)=>{let Lt=Ze(),Tt=(Pt.x-At.x)*Ge;return Pt.y<Lt.y&&(Tt=-Tt),{rollDelta:Tt}},moveStateManager:_t,enable:Be,assignEvents:ta})}(s,K);u.dragRotate=new hn(s,ne,ie,fe),this._add("mouseRotate",ne,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate","mouseRoll"]),this._add("mouseRoll",fe,["mousePitch"]),s.interactive&&s.dragRotate&&u.dragRotate.enable();let Ae=function({enable:Be,clickTolerance:qe}){let Ge=new wn({checkCorrectEvent:Ze=>T.mouseButton(Ze)===0&&!Ze.ctrlKey});return new Al({clickTolerance:qe,move:(Ze,_t)=>({around:_t,panDelta:_t.sub(Ze)}),activateOnStart:!0,moveStateManager:Ge,enable:Be,assignEvents:ta})}(s),Ie=new lu(s,u);u.dragPan=new Ha(_,Ae,Ie),this._add("mousePan",Ae),this._add("touchPan",Ie,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&u.dragPan.enable(s.dragPan);let Ce=new d0,Pe=new li;u.touchZoomRotate=new bh(_,Pe,Ce,V),this._add("touchRotate",Ce,["touchPan","touchZoom"]),this._add("touchZoom",Pe,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&u.touchZoomRotate.enable(s.touchZoomRotate);let Fe=u.scrollZoom=new uu(u,()=>this._triggerRenderFrame());this._add("scrollZoom",Fe,["mousePan"]),s.interactive&&s.scrollZoom&&u.scrollZoom.enable(s.scrollZoom);let Ve=u.keyboard=new uc(u);this._add("keyboard",Ve),s.interactive&&s.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new f0(u))}_add(s,u,_){this._handlers.push({handlerName:s,handler:u,allowed:_}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(let{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hc(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,u,_){for(let v in s)if(v!==_&&(!u||u.indexOf(v)<0))return!0;return!1}_getMapTouches(s){let u=[];for(let _ of s)this._el.contains(_.target)&&u.push(_);return u}mergeHandlerResult(s,u,_,v,S){if(!_)return;o.e(s,_);let O={handlerName:v,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(u.zoom=O),_.panDelta!==void 0&&(u.drag=O),_.rollDelta!==void 0&&(u.roll=O),_.pitchDelta!==void 0&&(u.pitch=O),_.bearingDelta!==void 0&&(u.rotate=O)}_applyChanges(){let s={},u={},_={};for(let[v,S,O]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.rollDelta&&(s.rollDelta=(s.rollDelta||0)+v.rollDelta),v.around!==void 0&&(s.around=v.around),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),o.e(u,S),o.e(_,O);this._updateMapTransform(s,u,_),this._changes=[]}_updateMapTransform(s,u,_){let v=this._map,S=v._getTransformForUpdate(),O=v.terrain;if(!(hu(s)||O&&this._terrainMovement))return this._fireEvents(u,_,!0);v._stop(!0);let{panDelta:z,zoomDelta:V,bearingDelta:H,pitchDelta:K,rollDelta:ne,around:ie,pinchAround:fe}=s;fe!==void 0&&(ie=fe),ie=ie||v.transform.centerPoint,O&&!S.isPointOnMapSurface(ie)&&(ie=S.centerPoint);let Ae={panDelta:z,zoomDelta:V,rollDelta:ne,pitchDelta:K,bearingDelta:H,around:ie};this._map.cameraHelper.useGlobeControls&&!S.isPointOnMapSurface(ie)&&(ie=S.centerPoint);let Ie=ie.distSqr(S.centerPoint)<.01?S.center:S.screenPointToLocation(z?ie.sub(z):ie);O?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Ae,S),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?S.setCenter(S.screenPointToLocation(S.centerPoint.sub(z))):this._map.cameraHelper.handleMapControlsPan(Ae,S,Ie):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Ae,S,Ie))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Ae,S),this._map.cameraHelper.handleMapControlsPan(Ae,S,Ie)),v._applyUpdatedTransform(S),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,_,!0)}_fireEvents(s,u,_){let v=hc(this._eventsInProgress),S=hc(s),O={};for(let ne in s){let{originalEvent:ie}=s[ne];this._eventsInProgress[ne]||(O[`${ne}start`]=ie),this._eventsInProgress[ne]=s[ne]}!v&&S&&this._fireEvent("movestart",S.originalEvent);for(let ne in O)this._fireEvent(ne,O[ne]);S&&this._fireEvent("move",S.originalEvent);for(let ne in s){let{originalEvent:ie}=s[ne];this._fireEvent(ne,ie)}let z={},V;for(let ne in this._eventsInProgress){let{handlerName:ie,originalEvent:fe}=this._eventsInProgress[ne];this._handlersById[ie].isActive()||(delete this._eventsInProgress[ne],V=u[ie]||fe,z[`${ne}end`]=V)}for(let ne in z)this._fireEvent(ne,z[ne]);let H=hc(this._eventsInProgress),K=(v||S)&&!H;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let ne=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ne.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ne)}if(_&&K){this._updatingCamera=!0;let ne=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ie=fe=>fe!==0&&-this._bearingSnap<fe&&fe<this._bearingSnap;!ne||!ne.essential&&x.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:V})),ie(this._map.getBearing())&&this._map.resetNorth()):(ie(ne.bearing||this._map.getBearing())&&(ne.bearing=0),ne.freezeElevation=!0,this._map.easeTo(ne,{originalEvent:V})),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new o.l(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Ap("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ca extends o.E{constructor(s,u,_){super(),this._renderFrameCallback=()=>{let v=Math.min((x.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=_.bearingSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(s,u){s.apply(this.transform),this.transform=s,this.cameraHelper=u}getCenter(){return new o.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(s,u){return this.jumpTo({elevation:s},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(s){this._centerClampedToGround=s}panBy(s,u,_){return s=o.P.convert(s).mult(-1),this.panTo(this.transform.center,o.e({offset:s},u),_)}panTo(s,u,_){return this.easeTo(o.e({center:s},u),_)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,_){return this.easeTo(o.e({zoom:s},u),_)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(s,u){return s!=this.transform.fov&&(this.transform.setFov(s),this.fire(new o.l("movestart",u)).fire(new o.l("move",u)).fire(new o.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,_){return this.easeTo(o.e({bearing:s},u),_)}resetNorth(s,u){return this.rotateTo(0,o.e({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}getRoll(){return this.transform.roll}setRoll(s,u){return this.jumpTo({roll:s},u),this}cameraForBounds(s,u){s=ui.convert(s).adjustAntiMeridian();let _=u&&u.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),_,u)}_cameraForBoxAndBearing(s,u,_,v){let S={top:0,bottom:0,right:0,left:0};if(typeof(v=o.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){let H=v.padding;v.padding={top:H,bottom:H,right:H,left:H}}let O=o.e(S,v.padding);v.padding=O;let z=this.transform,V=new ui(s,u);return this.cameraHelper.cameraForBoxAndBearing(v,O,V,_,z)}fitBounds(s,u,_){return this._fitInternal(this.cameraForBounds(s,u),u,_)}fitScreenCoordinates(s,u,_,v,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(s)),this.transform.screenPointToLocation(o.P.convert(u)),_,v),v,S)}_fitInternal(s,u,_){return s?(delete(u=o.e(s,u)).padding,u.linear?this.easeTo(u,_):this.flyTo(u,_)):this}jumpTo(s,u){this.stop();let _=this._getTransformForUpdate(),v=!1,S=!1,O=!1,z=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,s);let V=_.zoom!==z;return"elevation"in s&&_.elevation!==+s.elevation&&_.setElevation(+s.elevation),"bearing"in s&&_.bearing!==+s.bearing&&(v=!0,_.setBearing(+s.bearing)),"pitch"in s&&_.pitch!==+s.pitch&&(S=!0,_.setPitch(+s.pitch)),"roll"in s&&_.roll!==+s.roll&&(O=!0,_.setRoll(+s.roll)),s.padding==null||_.isPaddingEqual(s.padding)||_.setPadding(s.padding),this._applyUpdatedTransform(_),this.fire(new o.l("movestart",u)).fire(new o.l("move",u)),V&&this.fire(new o.l("zoomstart",u)).fire(new o.l("zoom",u)).fire(new o.l("zoomend",u)),v&&this.fire(new o.l("rotatestart",u)).fire(new o.l("rotate",u)).fire(new o.l("rotateend",u)),S&&this.fire(new o.l("pitchstart",u)).fire(new o.l("pitch",u)).fire(new o.l("pitchend",u)),O&&this.fire(new o.l("rollstart",u)).fire(new o.l("roll",u)).fire(new o.l("rollend",u)),this.fire(new o.l("moveend",u))}calculateCameraOptionsFromTo(s,u,_,v=0){let S=o.$.fromLngLat(s,u),O=o.$.fromLngLat(_,v),z=O.x-S.x,V=O.y-S.y,H=O.z-S.z,K=Math.hypot(z,V,H);if(K===0)throw new Error("Can't calculate camera options with same From and To");let ne=Math.hypot(z,V),ie=o.ab(this.transform.cameraToCenterDistance/K/this.transform.tileSize),fe=180*Math.atan2(z,-V)/Math.PI,Ae=180*Math.acos(ne/K)/Math.PI;return Ae=H<0?90-Ae:90+Ae,{center:O.toLngLat(),elevation:v,zoom:ie,pitch:Ae,bearing:fe}}calculateCameraOptionsFromCameraLngLatAltRotation(s,u,_,v,S){let O=this.transform.calculateCenterFromCameraLngLatAlt(s,u,_,v);return{center:O.center,elevation:O.elevation,zoom:O.zoom,bearing:_,pitch:v,roll:S}}easeTo(s,u){this._stop(!1,s.easeId),((s=o.e({offset:[0,0],duration:500,easing:o.cb},s)).animate===!1||!s.essential&&x.prefersReducedMotion)&&(s.duration=0);let _=this._getTransformForUpdate(),v=this.getBearing(),S=_.pitch,O=_.roll,z="bearing"in s?this._normalizeBearing(s.bearing,v):v,V="pitch"in s?+s.pitch:S,H="roll"in s?this._normalizeBearing(s.roll,O):O,K="padding"in s?s.padding:_.padding,ne=o.P.convert(s.offset),ie,fe;s.around&&(ie=o.Q.convert(s.around),fe=_.locationToScreenPoint(ie));let Ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Ie=this.cameraHelper.handleEaseTo(_,{bearing:z,pitch:V,roll:H,padding:K,around:ie,aroundPoint:fe,offsetAsPoint:ne,offset:s.offset,zoom:s.zoom,center:s.center});return this._rotating=this._rotating||v!==z,this._pitching=this._pitching||V!==S,this._rolling=this._rolling||H!==O,this._padding=!_.isPaddingEqual(K),this._zooming=this._zooming||Ie.isZooming,this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,Ae),this.terrain&&this._prepareElevation(Ie.elevationCenter),this._ease(Ce=>{Ie.easeFunc(Ce),this.terrain&&!s.freezeElevation&&this._updateElevation(Ce),this._applyUpdatedTransform(_),this._fireMoveEvents(u)},Ce=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(u,Ce)},s),this}_prepareEase(s,u,_={}){this._moving=!0,u||_.moving||this.fire(new o.l("movestart",s)),this._zooming&&!_.zooming&&this.fire(new o.l("zoomstart",s)),this._rotating&&!_.rotating&&this.fire(new o.l("rotatestart",s)),this._pitching&&!_.pitching&&this.fire(new o.l("pitchstart",s)),this._rolling&&!_.rolling&&this.fire(new o.l("rollstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&u!==this._elevationTarget){let _=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(_-(u-(_*s+this._elevationStart))/(1-s)),this._elevationTarget=u}this.transform.setElevation(o.B.number(this._elevationStart,this._elevationTarget,s))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){if(!this.terrain&&s.elevation>=0&&s.pitch<=90)return{};let u=s.getCameraLngLat(),_=s.getCameraAltitude(),v=this.terrain?this.terrain.getElevationForLngLatZoom(u,s.zoom):0;if(_<v){let S=this.calculateCameraOptionsFromTo(u,v,s.center,s.elevation);return{pitch:S.pitch,zoom:S.zoom}}return{}}_applyUpdatedTransform(s){let u=[];if(u.push(v=>this._elevateCameraIfInsideTerrain(v)),this.transformCameraUpdate&&u.push(v=>this.transformCameraUpdate(v)),!u.length)return;let _=s.clone();for(let v of u){let S=_.clone(),{center:O,zoom:z,roll:V,pitch:H,bearing:K,elevation:ne}=v(S);O&&S.setCenter(O),ne!==void 0&&S.setElevation(ne),z!==void 0&&S.setZoom(z),V!==void 0&&S.setRoll(V),H!==void 0&&S.setPitch(H),K!==void 0&&S.setBearing(K),_.apply(S)}this.transform.apply(_)}_fireMoveEvents(s){this.fire(new o.l("move",s)),this._zooming&&this.fire(new o.l("zoom",s)),this._rotating&&this.fire(new o.l("rotate",s)),this._pitching&&this.fire(new o.l("pitch",s)),this._rolling&&this.fire(new o.l("roll",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;let _=this._zooming,v=this._rotating,S=this._pitching,O=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new o.l("zoomend",s)),v&&this.fire(new o.l("rotateend",s)),S&&this.fire(new o.l("pitchend",s)),O&&this.fire(new o.l("rollend",s)),this.fire(new o.l("moveend",s))}flyTo(s,u){if(!s.essential&&x.prefersReducedMotion){let Tt=o.O(s,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Tt,u)}this.stop(),s=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cb},s);let _=this._getTransformForUpdate(),v=_.bearing,S=_.pitch,O=_.roll,z=_.padding,V="bearing"in s?this._normalizeBearing(s.bearing,v):v,H="pitch"in s?+s.pitch:S,K="roll"in s?this._normalizeBearing(s.roll,O):O,ne="padding"in s?s.padding:_.padding,ie=o.P.convert(s.offset),fe=_.centerPoint.add(ie),Ae=_.screenPointToLocation(fe),Ie=this.cameraHelper.handleFlyTo(_,{bearing:V,pitch:H,roll:K,padding:ne,locationAtOffset:Ae,offsetAsPoint:ie,center:s.center,minZoom:s.minZoom,zoom:s.zoom}),Ce=s.curve,Pe=Math.max(_.width,_.height),Fe=Pe/Ie.scaleOfZoom,Ve=Ie.pixelPathLength;typeof Ie.scaleOfMinZoom=="number"&&(Ce=Math.sqrt(Pe/Ie.scaleOfMinZoom/Ve*2));let Be=Ce*Ce;function qe(Tt){let er=(Fe*Fe-Pe*Pe+(Tt?-1:1)*Be*Be*Ve*Ve)/(2*(Tt?Fe:Pe)*Be*Ve);return Math.log(Math.sqrt(er*er+1)-er)}function Ge(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function Ze(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}let _t=qe(!1),At=function(Tt){return Ze(_t)/Ze(_t+Ce*Tt)},Pt=function(Tt){return Pe*((Ze(_t)*(Ge(er=_t+Ce*Tt)/Ze(er))-Ge(_t))/Be)/Ve;var er},Lt=(qe(!0)-_t)/Ce;if(Math.abs(Ve)<2e-6||!isFinite(Lt)){if(Math.abs(Pe-Fe)<1e-6)return this.easeTo(s,u);let Tt=Fe<Pe?-1:1;Lt=Math.abs(Math.log(Fe/Pe))/Ce,Pt=()=>0,At=er=>Math.exp(Tt*Ce*er)}return s.duration="duration"in s?+s.duration:1e3*Lt/("screenSpeed"in s?+s.screenSpeed/Ce:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=v!==V,this._pitching=H!==S,this._rolling=K!==O,this._padding=!_.isPaddingEqual(ne),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Ie.targetCenter),this._ease(Tt=>{let er=Tt*Lt,Kt=1/At(er),Ut=Pt(er);this._rotating&&_.setBearing(o.B.number(v,V,Tt)),this._pitching&&_.setPitch(o.B.number(S,H,Tt)),this._rolling&&_.setRoll(o.B.number(O,K,Tt)),this._padding&&(_.interpolatePadding(z,ne,Tt),fe=_.centerPoint.add(ie)),Ie.easeFunc(Tt,Kt,Ut,fe),this.terrain&&!s.freezeElevation&&this._updateElevation(Tt),this._applyUpdatedTransform(_),this._fireMoveEvents(u)},()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,u){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,u)}return s||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(s,u,_){_.animate===!1||_.duration===0?(s(1),u()):(this._easeStart=x.now(),this._easeOptions=_,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,u){s=o.aL(s,-180,180);let _=Math.abs(s-u);return Math.abs(s-360-u)<_&&(s-=360),Math.abs(s+360-u)<_&&(s+=360),s}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(o.Q.convert(s),this.transform.tileZoom):null}}let vh={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xr{constructor(s=vh){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=T.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=T.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=T.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,u){let _=this._map._getUIString(`AttributionControl.${u}`);s.title=_,s.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let u=this._map.style.sourceCaches;for(let v in u){let S=u[v];if(S.used||S.usedForTerrain){let O=S.getSource();O.attribution&&s.indexOf(O.attribution)<0&&s.push(O.attribution)}}s=s.filter(v=>String(v).trim()),s.sort((v,S)=>v.length-S.length),s=s.filter((v,S)=>{for(let O=S+1;O<s.length;O++)if(s[O].indexOf(v)>=0)return!1;return!0});let _=s.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,s.length?(this._innerContainer.innerHTML=T.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Rr{constructor(s={}){this._updateCompact=()=>{let u=this._container.children;if(u.length){let _=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=T.create("div","maplibregl-ctrl");let u=T.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){T.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Vf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){let u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){let u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(let v of _)if(v.id===s)return void(v.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let u=this._currentlyRunning=this._queue;this._queue=[];for(let _ of u)if(!_.cancelled&&(_.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var mp=o.aD([{name:"a_pos3d",type:"Int16",components:3}]);class jf extends o.E{constructor(s){super(),this._lastTilesetChange=x.now(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=s._source.tileSize*2**this.deltaZoom,s.usedForTerrain=!0,s.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,u){this.sourceCache.update(s,u),this._renderableTilesKeys=[];let _={};for(let v of st(s,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))_[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.terrainRttPosMatrix32f=new Float64Array(16),o.bO(v.terrainRttPosMatrix32f,0,o.Z,o.Z,0,0,1),this._tiles[v.key]=new Er(v,this.tileSize),this._lastTilesetChange=x.now());for(let v in this._tiles)_[v]||delete this._tiles[v]}freeRtt(s){for(let u in this._tiles){let _=this._tiles[u];(!s||_.tileID.equals(s)||_.tileID.isChildOf(s)||s.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s,u){return u?this._getTerrainCoordsForTileRanges(s,u):this._getTerrainCoordsForRegularTile(s)}_getTerrainCoordsForRegularTile(s){let u={};for(let _ of this._renderableTilesKeys){let v=this._tiles[_].tileID,S=s.clone(),O=o.b2();if(v.canonical.equals(s.canonical))o.bO(O,0,o.Z,o.Z,0,0,1);else if(v.canonical.isChildOf(s.canonical)){let z=v.canonical.z-s.canonical.z,V=v.canonical.x-(v.canonical.x>>z<<z),H=v.canonical.y-(v.canonical.y>>z<<z),K=o.Z>>z;o.bO(O,0,K,K,0,0,1),o.L(O,O,[-V*K,-H*K,0])}else{if(!s.canonical.isChildOf(v.canonical))continue;{let z=s.canonical.z-v.canonical.z,V=s.canonical.x-(s.canonical.x>>z<<z),H=s.canonical.y-(s.canonical.y>>z<<z),K=o.Z>>z;o.bO(O,0,o.Z,o.Z,0,0,1),o.L(O,O,[V*K,H*K,0]),o.M(O,O,[1/2**z,1/2**z,0])}}S.terrainRttPosMatrix32f=new Float32Array(O),u[_]=S}return u}_getTerrainCoordsForTileRanges(s,u){let _={};for(let v of this._renderableTilesKeys){let S=this._tiles[v].tileID;if(!this._isWithinTileRanges(S,u))continue;let O=s.clone(),z=o.b2();if(S.canonical.z===s.canonical.z){let V=s.canonical.x-S.canonical.x,H=s.canonical.y-S.canonical.y;o.bO(z,0,o.Z,o.Z,0,0,1),o.L(z,z,[V*o.Z,H*o.Z,0])}else if(S.canonical.z>s.canonical.z){let V=S.canonical.z-s.canonical.z,H=S.canonical.x-(S.canonical.x>>V<<V),K=S.canonical.y-(S.canonical.y>>V<<V),ne=s.canonical.x-(S.canonical.x>>V),ie=s.canonical.y-(S.canonical.y>>V),fe=o.Z>>V;o.bO(z,0,fe,fe,0,0,1),o.L(z,z,[-H*fe+ne*o.Z,-K*fe+ie*o.Z,0])}else{let V=s.canonical.z-S.canonical.z,H=s.canonical.x-(s.canonical.x>>V<<V),K=s.canonical.y-(s.canonical.y>>V<<V),ne=(s.canonical.x>>V)-S.canonical.x,ie=(s.canonical.y>>V)-S.canonical.y,fe=o.Z<<V;o.bO(z,0,fe,fe,0,0,1),o.L(z,z,[H*o.Z+ne*fe,K*o.Z+ie*fe,0])}O.terrainRttPosMatrix32f=new Float32Array(z),_[v]=O}return _}getSourceTile(s,u){let _=this.sourceCache._source,v=s.overscaledZ-this.deltaZoom;if(v>_.maxzoom&&(v=_.maxzoom),v<_.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(v).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!S||!S.dem)&&u)for(;v>=_.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(s.scaledTo(v--).key);return S}anyTilesAfterTime(s=Date.now()){return this._lastTilesetChange>=s}_isWithinTileRanges(s,u){return u[s.canonical.z]&&s.canonical.x>=u[s.canonical.z].minTileX&&s.canonical.x<=u[s.canonical.z].maxTileX&&s.canonical.y>=u[s.canonical.z].minTileY&&s.canonical.y<=u[s.canonical.z].maxTileY}}class ps{constructor(s,u,_){this._meshCache={},this.painter=s,this.sourceCache=new jf(u),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,u,_,v=o.Z){var S;if(!(u>=0&&u<v&&_>=0&&_<v))return 0;let O=this.getTerrainData(s),z=(S=O.tile)===null||S===void 0?void 0:S.dem;if(!z)return 0;let V=o.cf([],[u/v*o.Z,_/v*o.Z],O.u_terrain_matrix),H=[V[0]*z.dim,V[1]*z.dim],K=Math.floor(H[0]),ne=Math.floor(H[1]),ie=H[0]-K,fe=H[1]-ne;return z.get(K,ne)*(1-ie)*(1-fe)+z.get(K+1,ne)*ie*(1-fe)+z.get(K,ne+1)*(1-ie)*fe+z.get(K+1,ne+1)*ie*fe}getElevationForLngLatZoom(s,u){if(!o.cg(u,s.wrap()))return 0;let{tileID:_,mercatorX:v,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(s,u);return this.getElevation(_,v%o.Z,S%o.Z,o.Z)}getElevation(s,u,_,v=o.Z){return this.getDEMElevation(s,u,_,v)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){let v=this.painter.context,S=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new je(v,S,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new je(v,new o.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.at([])}let u=this.sourceCache.getSourceTile(s,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){let v=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new je(v,u.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),u.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}let _=u&&u+u.tileID.key+s.key;if(_&&!this._demMatrixCache[_]){let v=this.sourceCache.sourceCache._source.maxzoom,S=s.canonical.z-u.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=v?S=s.canonical.z-v:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let O=s.canonical.x-(s.canonical.x>>S<<S),z=s.canonical.y-(s.canonical.y>>S<<S),V=o.ch(new Float64Array(16),[1/(o.Z<<S),1/(o.Z<<S),0]);o.L(V,V,[O*o.Z,z*o.Z,0]),this._demMatrixCache[s.key]={matrix:V,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(s){let u=this.painter,_=u.width/devicePixelRatio,v=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new je(u.context,{width:_,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new je(u.context,{width:_,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(_,v,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,_,v))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,O=0;S<this._coordsTextureSize;S++)for(let z=0;z<this._coordsTextureSize;z++,O+=4)u[O+0]=255&z,u[O+1]=255&S,u[O+2]=z>>8<<4|S>>8,u[O+3]=0;let _=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),v=new je(s,_,s.gl.RGBA,{premultiply:!1});return v.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);let u=new Uint8Array(4),_=this.painter.context,v=_.gl,S=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),O=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),z=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(S,z-O-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null);let V=u[0]+(u[2]>>4<<8),H=u[1]+((15&u[2])<<8),K=this.coordsIndex[255-u[3]],ne=K&&this.sourceCache.getTileByID(K);if(!ne)return null;let ie=this._coordsTextureSize,fe=(1<<ne.tileID.canonical.z)*ie;return new o.$((ne.tileID.canonical.x*ie+V)/fe+ne.tileID.wrap,(ne.tileID.canonical.y*ie+H)/fe,this.getElevation(ne.tileID,V,H,ie))}depthAtPoint(s){let u=new Uint8Array(4),_=this.painter.context,v=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(s){var u;let _=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,v=_&&s.canonical.y===0,S=_&&s.canonical.y===(1<<s.canonical.z)-1,O=`m_${v?"n":""}_${S?"s":""}`;if(this._meshCache[O])return this._meshCache[O];let z=this.painter.context,V=new o.ci,H=new o.aH,K=this.meshSize,ne=o.Z/K,ie=K*K;for(let Ze=0;Ze<=K;Ze++)for(let _t=0;_t<=K;_t++)V.emplaceBack(_t*ne,Ze*ne,0);for(let Ze=0;Ze<ie;Ze+=K+1)for(let _t=0;_t<K;_t++)H.emplaceBack(_t+Ze,K+_t+Ze+1,K+_t+Ze+2),H.emplaceBack(_t+Ze,K+_t+Ze+2,_t+Ze+1);let fe=V.length,Ae=fe+(K+1),Ie=(K+1)*K,Ce=v?o.b9:0,Pe=v?0:1,Fe=S?o.ba:o.Z,Ve=S?0:1;for(let Ze=0;Ze<=K;Ze++)V.emplaceBack(Ze*ne,Ce,Pe);for(let Ze=0;Ze<=K;Ze++)V.emplaceBack(Ze*ne,Fe,Ve);for(let Ze=0;Ze<K;Ze++)H.emplaceBack(Ie+Ze,Ae+Ze,Ae+Ze+1),H.emplaceBack(Ie+Ze,Ae+Ze+1,Ie+Ze+1),H.emplaceBack(0+Ze,fe+Ze+1,fe+Ze),H.emplaceBack(0+Ze,0+Ze+1,fe+Ze+1);let Be=V.length,qe=Be+2*(K+1);for(let Ze of[0,1])for(let _t=0;_t<=K;_t++)for(let At of[0,1])V.emplaceBack(Ze*o.Z,_t*ne,At);for(let Ze=0;Ze<2*K;Ze+=2)H.emplaceBack(Be+Ze,Be+Ze+1,Be+Ze+3),H.emplaceBack(Be+Ze,Be+Ze+3,Be+Ze+2),H.emplaceBack(qe+Ze,qe+Ze+3,qe+Ze+1),H.emplaceBack(qe+Ze,qe+Ze+2,qe+Ze+3);let Ge=new Zc(z.createVertexBuffer(V,mp.members),z.createIndexBuffer(H),o.aG.simpleSegment(0,0,V.length,H.length));return this._meshCache[O]=Ge,Ge}getMeshFrameDelta(s){return 2*Math.PI*o.br/Math.pow(2,Math.max(s,0))/5}getMinTileElevationForLngLatZoom(s,u){var _;let{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(s,u);return(_=this.getMinMaxElevation(v).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(s){let u=this.getTerrainData(s).tile,_={minElevation:null,maxElevation:null};return u&&u.dem&&(_.minElevation=u.dem.min*this.exaggeration,_.maxElevation=u.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(s,u){let _=o.$.fromLngLat(s.wrap()),v=(1<<u)*o.Z,S=_.x*v,O=_.y*v,z=Math.floor(S/o.Z),V=Math.floor(O/o.Z);return{tileID:new o.Y(u,0,u,z,V),mercatorX:S,mercatorY:O}}}class gp{constructor(s,u,_){this._context=s,this._size=u,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){let u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new je(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(_.texture),{id:s,fbo:u,texture:_,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>s.id!==u),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(let u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(let s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}let Bn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class A0{constructor(s,u){this.painter=s,this.terrain=u,this.pool=new gp(s.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(_=>!s._layers[_].isHidden(u)),this._coordsAscending={};for(let _ in s.sourceCaches){this._coordsAscending[_]={};let v=s.sourceCaches[_].getVisibleCoordinates(),S=s.sourceCaches[_].getSource(),O=S instanceof co?S.terrainTileRanges:null;for(let z of v){let V=this.terrain.sourceCache.getTerrainCoords(z,O);for(let H in V)this._coordsAscending[_][H]||(this._coordsAscending[_][H]=[]),this._coordsAscending[_][H].push(V[H])}}this._coordsAscendingStr={};for(let _ of s._order){let v=s._layers[_],S=v.source;if(Bn[v.type]&&!this._coordsAscendingStr[S]){this._coordsAscendingStr[S]={};for(let O in this._coordsAscending[S])this._coordsAscendingStr[S][O]=this._coordsAscending[S][O].map(z=>z.key).sort().join()}}for(let _ of this._renderableTiles)for(let v in this._coordsAscendingStr){let S=this._coordsAscendingStr[v][_.tileID.key];S&&S!==_.rttCoords[v]&&(_.rtt=[])}}renderLayer(s,u){if(s.isHidden(this.painter.transform.zoom))return!1;let _=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),v=s.type,S=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(Bn[v]&&(this._prevType&&Bn[this._prevType]||this._stacks.push([]),this._prevType=v,this._stacks[this._stacks.length-1].push(s.id),!O))return!0;if(Bn[this._prevType]||Bn[v]&&O){this._prevType=v;let z=this._stacks.length-1,V=this._stacks[z]||[];for(let H of this._renderableTiles){if(this.pool.isFull()&&(dl(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[z]){let ne=this.pool.getObjectForId(H.rtt[z].id);if(ne.stamp===H.rtt[z].stamp){this.pool.useObject(ne);continue}}let K=this.pool.getOrCreateFreeObject();this.pool.useObject(K),this.pool.stampObject(K),H.rtt[z]={id:K.id,stamp:K.stamp},S.context.bindFramebuffer.set(K.fbo.framebuffer),S.context.clear({color:o.b7.transparent,stencil:0}),S.currentStencilSource=void 0;for(let ne=0;ne<V.length;ne++){let ie=S.style._layers[V[ne]],fe=ie.source?this._coordsAscending[ie.source][H.tileID.key]:[H.tileID];S.context.viewport.set([0,0,K.fbo.width,K.fbo.height]),S._renderTileClippingMasks(ie,fe,!0),S.renderLayer(S,S.style.sourceCaches[ie.source],ie,fe,_),ie.source&&(H.rttCoords[ie.source]=this._coordsAscendingStr[ie.source][H.tileID.key])}}return dl(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),Bn[v]}return!1}}let wh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ln=a,Vn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:vh,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},m0={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Th{constructor(s,u,_=!1){this.mousedown=S=>{this.startMove(S,T.mousePos(this.element,S)),T.addEventListener(window,"mousemove",this.mousemove),T.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.move(S,T.mousePos(this.element,S))},this.mouseup=S=>{this._rotatePitchHanlder.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=T.touchPos(this.element,S.targetTouches)[0],this.startMove(S,this._startPos),T.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=T.touchPos(this.element,S.targetTouches)[0],this.move(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;let v=new Nf;this._rotatePitchHanlder=new Al({clickTolerance:3,move:(S,O)=>{let z=u.getBoundingClientRect(),V=new o.P((z.bottom-z.top)/2,(z.right-z.left)/2);return{bearingDelta:o.ca(new o.P(S.x,O.y),O,V),pitchDelta:_?-.5*(O.y-S.y):void 0}},moveStateManager:v,enable:!0,assignEvents:()=>{}}),this.map=s,T.addEventListener(u,"mousedown",this.mousedown),T.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),T.addEventListener(u,"touchcancel",this.reset)}startMove(s,u){this._rotatePitchHanlder.dragStart(s,u),T.disableDrag()}move(s,u){let _=this.map,{bearingDelta:v,pitchDelta:S}=this._rotatePitchHanlder.dragMove(s,u)||{};v&&_.setBearing(_.getBearing()+v),S&&_.setPitch(_.getPitch()+S)}off(){let s=this.element;T.removeEventListener(s,"mousedown",this.mousedown),T.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend),T.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){T.enableDrag(),T.removeEventListener(window,"mousemove",this.mousemove),T.removeEventListener(window,"mouseup",this.mouseup),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend)}}let wo;function Eh(C,s,u){let _=new o.Q(C.lng,C.lat);if(C=new o.Q(C.lng,C.lat),s){let v=new o.Q(C.lng-360,C.lat),S=new o.Q(C.lng+360,C.lat),O=u.locationToScreenPoint(C).distSqr(s);u.locationToScreenPoint(v).distSqr(s)<O?C=v:u.locationToScreenPoint(S).distSqr(s)<O&&(C=S)}for(;Math.abs(C.lng-u.center.lng)>180;){let v=u.locationToScreenPoint(C);if(v.x>=0&&v.y>=0&&v.x<=u.width&&v.y<=u.height)break;C.lng>u.center.lng?C.lng-=360:C.lng+=360}return C.lng!==_.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(C))?C:_}let fu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gf(C,s,u){let _=C.classList;for(let v in fu)_.remove(`maplibregl-${u}-anchor-${v}`);_.add(`maplibregl-${u}-anchor-${s}`)}class fc extends o.E{constructor(s){if(super(),this._onKeyPress=u=>{let _=u.code,v=u.charCode||u.keyCode;_!=="Space"&&_!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=u=>{let _=u.originalEvent.target,v=this._element;this._popup&&(_===v||v.contains(_))&&this.togglePopup()},this._update=u=>{var _;if(!this._map)return;let v=this._map.loaded()&&!this._map.isMoving();(u?.type==="terrain"||u?.type==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Eh(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let S="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?S=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(S=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let O="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?O="rotateX(0deg)":this._pitchAlignment==="map"&&(O=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),T.setTransform(this._element,`${fu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${O} ${S}`),x.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){let _=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(s?.opacity,s?.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=o.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=T.create("div");let u=T.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${_}px`),u.setAttributeNS(null,"width",`${v}px`),u.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);let S=T.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");let O=T.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");let z=T.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");let V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let Pe of V){let Fe=T.createNS("http://www.w3.org/2000/svg","ellipse");Fe.setAttributeNS(null,"opacity","0.04"),Fe.setAttributeNS(null,"cx","10.5"),Fe.setAttributeNS(null,"cy","5.80029008"),Fe.setAttributeNS(null,"rx",Pe.rx),Fe.setAttributeNS(null,"ry",Pe.ry),z.appendChild(Fe)}let H=T.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);let K=T.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(K);let ne=T.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"fill","#000000");let ie=T.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ne.appendChild(ie);let fe=T.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),fe.setAttributeNS(null,"fill","#FFFFFF");let Ae=T.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Ie=T.createNS("http://www.w3.org/2000/svg","circle");Ie.setAttributeNS(null,"fill","#000000"),Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"cx","5.5"),Ie.setAttributeNS(null,"cy","5.5"),Ie.setAttributeNS(null,"r","5.4999962");let Ce=T.createNS("http://www.w3.org/2000/svg","circle");Ce.setAttributeNS(null,"fill","#FFFFFF"),Ce.setAttributeNS(null,"cx","5.5"),Ce.setAttributeNS(null,"cy","5.5"),Ce.setAttributeNS(null,"r","5.4999962"),Ae.appendChild(Ie),Ae.appendChild(Ce),O.appendChild(z),O.appendChild(H),O.appendChild(ne),O.appendChild(fe),O.appendChild(Ae),u.appendChild(O),u.setAttributeNS(null,"height",_*this._scale+"px"),u.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(u),this._offset=o.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Gf(this._element,this._anchor,"marker"),s&&s.className)for(let u of s.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),s.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),T.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.Q.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){let v=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){let s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var u,_;if(!(!((u=this._map)===null||u===void 0)&&u.terrain)){let ne=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ne&&(this._element.style.opacity=ne))}if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let v=this._map,S=v.terrain.depthAtPoint(this._pos),O=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,O)-S<.006)return void(this._element.style.opacity=this._opacity);let z=-this._offset.y/v.transform.pixelsPerMeter,V=Math.sin(v.getPitch()*Math.PI/180)*z,H=v.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),K=v.transform.lngLatToCameraDepth(this._lngLat,O+V)-H>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&K&&this._popup.remove(),this._element.style.opacity=K?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=o.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,u){return(this._opacity===void 0||s===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}let _p={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},du=0,dc=!1,yp={maxWidth:100,unit:"metric"};function Hf(C,s,u){let _=u&&u.maxWidth||100,v=C._container.clientHeight/2,S=C._container.clientWidth/2,O=C.unproject([S-_/2,v]),z=C.unproject([S+_/2,v]),V=Math.round(C.project(z).x-C.project(O).x),H=Math.min(_,V,C._container.clientWidth),K=O.distanceTo(z);if(u&&u.unit==="imperial"){let ne=3.2808*K;ne>5280?pc(s,H,ne/5280,C._getUIString("ScaleControl.Miles")):pc(s,H,ne,C._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?pc(s,H,K/1852,C._getUIString("ScaleControl.NauticalMiles")):K>=1e3?pc(s,H,K/1e3,C._getUIString("ScaleControl.Kilometers")):pc(s,H,K,C._getUIString("ScaleControl.Meters"))}function pc(C,s,u,_){let v=function(S){let O=Math.pow(10,`${Math.floor(S)}`.length-1),z=S/O;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(V){let H=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*H)/H}(z),O*z}(u);C.style.width=s*(v/u)+"px",C.innerHTML=`${v}&nbsp;${_}`}let xp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},bp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ch(C){if(C){if(typeof C=="number"){let s=Math.round(Math.abs(C)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,C),"top-left":new o.P(s,s),"top-right":new o.P(-s,s),bottom:new o.P(0,-C),"bottom-left":new o.P(s,-s),"bottom-right":new o.P(-s,-s),left:new o.P(C,0),right:new o.P(-C,0)}}if(C instanceof o.P||Array.isArray(C)){let s=o.P.convert(C);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:o.P.convert(C.center||[0,0]),top:o.P.convert(C.top||[0,0]),"top-left":o.P.convert(C["top-left"]||[0,0]),"top-right":o.P.convert(C["top-right"]||[0,0]),bottom:o.P.convert(C.bottom||[0,0]),"bottom-left":o.P.convert(C["bottom-left"]||[0,0]),"bottom-right":o.P.convert(C["bottom-right"]||[0,0]),left:o.P.convert(C.left||[0,0]),right:o.P.convert(C.right||[0,0])}}return Ch(new o.P(0,0))}let Wf=a;n.AJAXError=o.cm,n.Event=o.l,n.Evented=o.E,n.LngLat=o.Q,n.MercatorCoordinate=o.$,n.Point=o.P,n.addProtocol=o.cn,n.config=o.a,n.removeProtocol=o.co,n.AttributionControl=xr,n.BoxZoomHandler=cc,n.CanvasSource=Aa,n.CooperativeGesturesHandler=Uf,n.DoubleClickZoomHandler=pp,n.DragPanHandler=Ha,n.DragRotateHandler=hn,n.EdgeInsets=bn,n.FullscreenControl=class extends o.E{constructor(C={}){super(),this._onFullscreenChange=()=>{var s;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=u?.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,C&&C.container&&(C.container instanceof HTMLElement?this._container=C.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(C){return this._map=C,this._container||(this._container=this._map.getContainer()),this._controlContainer=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){T.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let C=this._fullscreenButton=T.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);T.create("span","maplibregl-ctrl-icon",C).setAttribute("aria-hidden","true"),C.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let C=this._getTitle();this._fullscreenButton.setAttribute("aria-label",C),this._fullscreenButton.title=C}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},n.GeoJSONSource=Zo,n.GeolocateControl=class extends o.E{constructor(C){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",s)),this._finish()}},this._updateCamera=s=>{let u=new o.Q(s.coords.longitude,s.coords.latitude),_=s.coords.accuracy,v=this._map.getBearing(),S=o.e({bearing:v},this.options.fitBoundsOptions),O=ui.fromLngLat(u,_);this._map.fitBounds(O,S,{geolocateSource:!0})},this._updateMarker=s=>{if(s){let u=new o.Q(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&dc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=T.create("button","maplibregl-ctrl-geolocate",this._container),T.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{let u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=T.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new fc({element:this._dotElement}),this._circleElement=T.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},_p,C)}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(s=!1){if(wo!==void 0&&!s)return wo;if(window.navigator.permissions===void 0)return wo=!!window.navigator.geolocation,wo;try{wo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{wo=!!window.navigator.geolocation}return wo})}().then(s=>this._finishSetupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),T.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,du=0,dc=!1}_isOutOfMapMaxBounds(C){let s=this._map.getMaxBounds(),u=C.coords;return s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let C=this._map.getBounds(),s=C.getSouthEast(),u=C.getNorthEast(),_=s.distanceTo(u),v=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":du--,dc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let C;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),du++,du>1?(C={maximumAge:6e5,timeout:0},dc=!0):(C=this.options.positionOptions,dc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,C)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},n.GlobeControl=class{constructor(){this._toggleProjection=()=>{var C;let s=(C=this._map.getProjection())===null||C===void 0?void 0:C.type;this._map.setProjection(s!=="mercator"&&s?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var C;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((C=this._map.getProjection())===null||C===void 0?void 0:C.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=T.create("button","maplibregl-ctrl-globe",this._container),T.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},n.Hash=pl,n.ImageSource=co,n.KeyboardHandler=uc,n.LngLatBounds=ui,n.LogoControl=Rr,n.Map=class extends Ca{constructor(C){var s,u;o.cj.mark(o.ck.create);let _=Object.assign(Object.assign(Object.assign({},Vn),C),{canvasContextAttributes:Object.assign(Object.assign({},Vn.canvasContextAttributes),C.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let v=new vn,S=new Is;if(_.minZoom!==void 0&&v.setMinZoom(_.minZoom),_.maxZoom!==void 0&&v.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&v.setMinPitch(_.minPitch),_.maxPitch!==void 0&&v.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&v.setRenderWorldCopies(_.renderWorldCopies),super(v,S,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Vf,this._controls=[],this._mapId=o.a4(),this._contextLost=z=>{z.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:z}))},this._contextRestored=z=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:z}))},this._onMapScroll=z=>{if(z.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wh),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new se(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let z=!1,V=Df(H=>{this._trackResize&&!this._removed&&(this.resize(H),this.redraw())},50);this._resizeObserver=new ResizeObserver(H=>{z?V(H):z=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wg(this,_),this._hash=_.hash&&new pl(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,o.e({},_.fitBoundsOptions,{duration:0}))));let O=typeof _.style=="string"||((u=(s=_.style)===null||s===void 0?void 0:s.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,O),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new xr(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Rr,_.logoPosition),this.on("style.load",()=>{if(O||this._resizeTransform(),this.transform.unmodified){let z=o.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(z)}}),this.on("data",z=>{this._update(z.dataType==="style"),this.fire(new o.l(`${z.dataType}data`,z))}),this.on("dataloading",z=>{this.fire(new o.l(`${z.dataType}dataloading`,z))}),this.on("dataabort",z=>{this.fire(new o.l("sourcedataabort",z))})}_getMapId(){return this._mapId}addControl(C,s){if(s===void 0&&(s=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=C.onAdd(this);this._controls.push(C);let _=this._controlPositions[s];return s.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(C){if(!C||!C.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let s=this._controls.indexOf(C);return s>-1&&this._controls.splice(s,1),C.onRemove(this),this}hasControl(C){return this._controls.indexOf(C)>-1}calculateCameraOptionsFromTo(C,s,u,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(C,s,u,_)}resize(C,s=!0){let[u,_]=this._containerDimensions(),v=this._getClampedPixelRatio(u,_);if(this._resizeCanvas(u,_,v),this.painter.resize(u,_,v),this.painter.overLimit()){let O=this.painter.context.gl;this._maxCanvasSize=[O.drawingBufferWidth,O.drawingBufferHeight];let z=this._getClampedPixelRatio(u,_);this._resizeCanvas(u,_,z),this.painter.resize(u,_,z)}this._resizeTransform(s);let S=!this._moving;return S&&(this.stop(),this.fire(new o.l("movestart",C)).fire(new o.l("move",C))),this.fire(new o.l("resize",C)),S&&this.fire(new o.l("moveend",C)),this}_resizeTransform(C=!0){var s;let[u,_]=this._containerDimensions();this.transform.resize(u,_,C),(s=this._requestedCameraState)===null||s===void 0||s.resize(u,_,C)}_getClampedPixelRatio(C,s){let{0:u,1:_}=this._maxCanvasSize,v=this.getPixelRatio(),S=C*v,O=s*v;return Math.min(S>u?u/S:1,O>_?_/O:1)*v}getPixelRatio(){var C;return(C=this._overridePixelRatio)!==null&&C!==void 0?C:devicePixelRatio}setPixelRatio(C){this._overridePixelRatio=C,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(C){return this.transform.setMaxBounds(ui.convert(C)),this._update()}setMinZoom(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom)return this.transform.setMinZoom(C),this._update(),this.getZoom()<C&&this.setZoom(C),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(C){if((C=C??22)>=this.transform.minZoom)return this.transform.setMaxZoom(C),this._update(),this.getZoom()>C&&this.setZoom(C),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.setMinPitch(C),this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(C){if((C=C??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(C>=this.transform.minPitch)return this.transform.setMaxPitch(C),this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(C){return this.transform.setRenderWorldCopies(C),this._update()}project(C){return this.transform.locationToScreenPoint(o.Q.convert(C),this.style&&this.terrain)}unproject(C){return this.transform.screenPointToLocation(o.P.convert(C),this.terrain)}isMoving(){var C;return this._moving||((C=this.handlers)===null||C===void 0?void 0:C.isMoving())}isZooming(){var C;return this._zooming||((C=this.handlers)===null||C===void 0?void 0:C.isZooming())}isRotating(){var C;return this._rotating||((C=this.handlers)===null||C===void 0?void 0:C.isRotating())}_createDelegatedListener(C,s,u){if(C==="mouseenter"||C==="mouseover"){let _=!1;return{layers:s,listener:u,delegates:{mousemove:S=>{let O=s.filter(V=>this.getLayer(V)),z=O.length!==0?this.queryRenderedFeatures(S.point,{layers:O}):[];z.length?_||(_=!0,u.call(this,new No(C,this,S.originalEvent,{features:z}))):_=!1},mouseout:()=>{_=!1}}}}if(C==="mouseleave"||C==="mouseout"){let _=!1;return{layers:s,listener:u,delegates:{mousemove:O=>{let z=s.filter(V=>this.getLayer(V));(z.length!==0?this.queryRenderedFeatures(O.point,{layers:z}):[]).length?_=!0:_&&(_=!1,u.call(this,new No(C,this,O.originalEvent)))},mouseout:O=>{_&&(_=!1,u.call(this,new No(C,this,O.originalEvent)))}}}}{let _=v=>{let S=s.filter(z=>this.getLayer(z)),O=S.length!==0?this.queryRenderedFeatures(v.point,{layers:S}):[];O.length&&(v.features=O,u.call(this,v),delete v.features)};return{layers:s,listener:u,delegates:{[C]:_}}}}_saveDelegatedListener(C,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(s)}_removeDelegatedListener(C,s,u){if(!this._delegatedListeners||!this._delegatedListeners[C])return;let _=this._delegatedListeners[C];for(let v=0;v<_.length;v++){let S=_[v];if(S.listener===u&&S.layers.length===s.length&&S.layers.every(O=>s.includes(O))){for(let O in S.delegates)this.off(O,S.delegates[O]);return void _.splice(v,1)}}}on(C,s,u){if(u===void 0)return super.on(C,s);let _=typeof s=="string"?[s]:s,v=this._createDelegatedListener(C,_,u);this._saveDelegatedListener(C,v);for(let S in v.delegates)this.on(S,v.delegates[S]);return{unsubscribe:()=>{this._removeDelegatedListener(C,_,u)}}}once(C,s,u){if(u===void 0)return super.once(C,s);let _=typeof s=="string"?[s]:s,v=this._createDelegatedListener(C,_,u);for(let S in v.delegates){let O=v.delegates[S];v.delegates[S]=(...z)=>{this._removeDelegatedListener(C,_,u),O(...z)}}this._saveDelegatedListener(C,v);for(let S in v.delegates)this.once(S,v.delegates[S]);return this}off(C,s,u){return u===void 0?super.off(C,s):(this._removeDelegatedListener(C,typeof s=="string"?[s]:s,u),this)}queryRenderedFeatures(C,s){if(!this.style)return[];let u,_=C instanceof o.P||Array.isArray(C),v=_?C:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(_?{}:C)||{},v instanceof o.P||typeof v[0]=="number")u=[o.P.convert(v)];else{let S=o.P.convert(v[0]),O=o.P.convert(v[1]);u=[S,new o.P(O.x,S.y),O,new o.P(S.x,O.y),S]}return this.style.queryRenderedFeatures(u,s,this.transform)}querySourceFeatures(C,s){return this.style.querySourceFeatures(C,s)}setStyle(C,s){return(s=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(C,s))}setTransformRequest(C){return this._requestManager.setTransformRequest(C),this}_getUIString(C){let s=this._locale[C];if(s==null)throw new Error(`Missing UI string '${C}'`);return s}_updateStyle(C,s){var u,_;if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(C,s));let v=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!C)),C?(this.style=new Na(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C,s,v):this.style.loadJSON(C,s,v),this):((_=(u=this.style)===null||u===void 0?void 0:u.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(C,s){if(typeof C=="string"){let u=this._requestManager.transformRequest(C,"Style");o.j(u,new AbortController).then(_=>{this._updateDiff(_.data,s)}).catch(_=>{_&&this.fire(new o.k(_))})}else typeof C=="object"&&this._updateDiff(C,s)}_updateDiff(C,s){try{this.style.setState(C,s)&&this._update(!0)}catch(u){o.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(C,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(C,s){return this._lazyInitEmptyStyle(),this.style.addSource(C,s),this._update(!0)}isSourceLoaded(C){let s=this.style&&this.style.sourceCaches[C];if(s!==void 0)return s.loaded();this.fire(new o.k(new Error(`There is no source with ID '${C}'`)))}setTerrain(C){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),C){let s=this.style.sourceCaches[C.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${C.source}`);this.terrain===null&&s.reload();for(let u in this.style._layers){let _=this.style._layers[u];_.type==="hillshade"&&_.source===C.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ps(this.painter,s,C),this.painter.renderToTexture=new A0(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var _;u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==C.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=u.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:C})),this}getTerrain(){var C,s;return(s=(C=this.terrain)===null||C===void 0?void 0:C.options)!==null&&s!==void 0?s:null}areTilesLoaded(){let C=this.style&&this.style.sourceCaches;for(let s in C){let u=C[s]._tiles;for(let _ in u){let v=u[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(C){return this.style.removeSource(C),this._update(!0)}getSource(C){return this.style.getSource(C)}addImage(C,s,u={}){let{pixelRatio:_=1,sdf:v=!1,stretchX:S,stretchY:O,content:z,textFitWidth:V,textFitHeight:H}=u;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||o.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:K,height:ne,data:ie}=s,fe=s;return this.style.addImage(C,{data:new o.R({width:K,height:ne},new Uint8Array(ie)),pixelRatio:_,stretchX:S,stretchY:O,content:z,textFitWidth:V,textFitHeight:H,sdf:v,version:0,userImage:fe}),fe.onAdd&&fe.onAdd(this,C),this}}{let{width:K,height:ne,data:ie}=x.getImageData(s);this.style.addImage(C,{data:new o.R({width:K,height:ne},ie),pixelRatio:_,stretchX:S,stretchY:O,content:z,textFitWidth:V,textFitHeight:H,sdf:v,version:0})}}updateImage(C,s){let u=this.style.getImage(C);if(!u)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=s instanceof HTMLImageElement||o.b(s)?x.getImageData(s):s,{width:v,height:S,data:O}=_;if(v===void 0||S===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==u.data.width||S!==u.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let z=!(s instanceof HTMLImageElement||o.b(s));return u.data.replace(O,z),this.style.updateImage(C,u),this}getImage(C){return this.style.getImage(C)}hasImage(C){return C?!!this.style.getImage(C):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(C){this.style.removeImage(C)}loadImage(C){return ee.getImage(this._requestManager.transformRequest(C,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(C,s){return this._lazyInitEmptyStyle(),this.style.addLayer(C,s),this._update(!0)}moveLayer(C,s){return this.style.moveLayer(C,s),this._update(!0)}removeLayer(C){return this.style.removeLayer(C),this._update(!0)}getLayer(C){return this.style.getLayer(C)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(C,s,u){return this.style.setLayerZoomRange(C,s,u),this._update(!0)}setFilter(C,s,u={}){return this.style.setFilter(C,s,u),this._update(!0)}getFilter(C){return this.style.getFilter(C)}setPaintProperty(C,s,u,_={}){return this.style.setPaintProperty(C,s,u,_),this._update(!0)}getPaintProperty(C,s){return this.style.getPaintProperty(C,s)}setLayoutProperty(C,s,u,_={}){return this.style.setLayoutProperty(C,s,u,_),this._update(!0)}getLayoutProperty(C,s){return this.style.getLayoutProperty(C,s)}setGlyphs(C,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(C,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(C,s,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(C,s,u,_=>{_||this._update(!0)}),this}removeSprite(C){return this._lazyInitEmptyStyle(),this.style.removeSprite(C),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(C,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(C,s,u=>{u||this._update(!0)}),this}setLight(C,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(C,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(C,s={}){return this._lazyInitEmptyStyle(),this.style.setSky(C,s),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(C,s){return this.style.setFeatureState(C,s),this._update()}removeFeatureState(C,s){return this.style.removeFeatureState(C,s),this._update()}getFeatureState(C){return this.style.getFeatureState(C)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let C=0,s=0;return this._container&&(C=this._container.clientWidth||400,s=this._container.clientHeight||300),[C,s]}_setupContainer(){let C=this._container;C.classList.add("maplibregl-map");let s=this._canvasContainer=T.create("div","maplibregl-canvas-container",C);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=T.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let u=this._containerDimensions(),_=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],_);let v=this._controlContainer=T.create("div","maplibregl-control-container",C),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(O=>{S[O]=T.create("div",`maplibregl-ctrl-${O} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(C,s,u){this._canvas.width=Math.floor(u*C),this._canvas.height=Math.floor(u*s),this._canvas.style.width=`${C}px`,this._canvas.style.height=`${s}px`}_setupPainter(){let C=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),s=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{s={requestedAttributes:C},_&&(s.statusMessage=_.statusMessage,s.type=_.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,C):this._canvas.getContext("webgl2",C)||this._canvas.getContext("webgl",C),!u){let _="Failed to initialize WebGL";throw s?(s.message=_,new Error(JSON.stringify(s))):new Error(_)}this.painter=new Of(u,this.transform),R.testSupport(u)}migrateProjection(C,s){super.migrateProjection(C,s),this.painter.transform=C,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(C){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(C){return this._update(),this._renderTaskQueue.add(C)}_cancelRenderFrame(C){this._renderTaskQueue.remove(C)}_render(C){var s,u,_,v,S;let O=this._idleTriggered?this._fadeDuration:0,z=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),this._removed)return;let V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let ne=this.transform.zoom,ie=x.now();this.style.zoomHistory.update(ne,ie);let fe=new o.C(ne,{now:ie,fadeDuration:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ae=fe.crossFadingFactor();Ae===1&&Ae===this._crossFadingFactor||(V=!0,this._crossFadingFactor=Ae),this.style.update(fe)}let H=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==z;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((v=this.style.projection)===null||v===void 0?void 0:v.transitionState,(S=this.style.projection)===null||S===void 0?void 0:S.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||H)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,O,this._crossSourceCollisions,H),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:O,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cj.mark(o.ck.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let K=this._sourcesDirty||this._styleDirty||this._placementDirty;return K||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||K||(this._fullyLoaded=!0,o.cj.mark(o.ck.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var C;this._hash&&this._hash.remove();for(let u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ee.removeThrottleControl(this._imageQueueHandle),(C=this._resizeObserver)===null||C===void 0||C.disconnect();let s=this.painter.context.gl.getExtension("WEBGL_lose_context");s?.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),T.remove(this._canvasContainer),T.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cj.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,x.frame(this._frameRequest,C=>{o.cj.frame(C),this._frameRequest=null;try{this._render(C)}catch(s){if(!o.cl(s)&&!function(u){return u.message===Sf}(s))throw s}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())}get showPadding(){return!!this._showPadding}set showPadding(C){this._showPadding!==C&&(this._showPadding=C,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())}get repaint(){return!!this._repaint}set repaint(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(C){this._vertices=C,this._update()}get version(){return Ln}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(C){return this._lazyInitEmptyStyle(),this.style.setProjection(C),this._update(!0)}},n.MapMouseEvent=No,n.MapTouchEvent=au,n.MapWheelEvent=Us,n.Marker=fc,n.NavigationControl=class{constructor(C){this._updateZoomButtons=()=>{let s=this._map.getZoom(),u=s===this._map.getMaxZoom(),_=s===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(s,u)=>{let _=this._map._getUIString(`NavigationControl.${u}`);s.title=_,s.setAttribute("aria-label",_)},this.options=o.e({},m0,C),this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),T.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),T.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=T.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(C){return this._map=C,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Th(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){T.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(C,s){let u=T.create("button",C,this._container);return u.type="button",u.addEventListener("click",s),u}},n.Popup=class extends o.E{constructor(C){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&T.remove(this._content),this._container&&(T.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=T.create("div","maplibregl-popup",this._map.getContainer()),this._tip=T.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let z of this.options.className.split(" "))this._container.classList.add(z);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Eh(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!s)return;let _=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationToScreenPoint(this._lngLat));let v=this.options.anchor,S=Ch(this.options.offset);if(!v){let z=this._container.offsetWidth,V=this._container.offsetHeight,H;H=_.y+S.bottom.y<V?["top"]:_.y>this._map.transform.height-V?["bottom"]:[],_.x<z/2?H.push("left"):_.x>this._map.transform.width-z/2&&H.push("right"),v=H.length===0?"bottom":H.join("-")}let O=_.add(S[v]);this.options.subpixelPositioning||(O=O.round()),T.setTransform(this._container,`${fu[v]} translate(${O.x}px,${O.y}px)`),Gf(this._container,v,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(xp),C)}addTo(C){return this._map&&this.remove(),this._map=C,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(C){return this._lngLat=o.Q.convert(C),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(C){return this.setDOMContent(document.createTextNode(C))}setHTML(C){let s=document.createDocumentFragment(),u=document.createElement("body"),_;for(u.innerHTML=C;_=u.firstChild,_;)s.appendChild(_);return this.setDOMContent(s)}getMaxWidth(){var C;return(C=this._container)===null||C===void 0?void 0:C.style.maxWidth}setMaxWidth(C){return this.options.maxWidth=C,this._update(),this}setDOMContent(C){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=T.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(C),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(C){return this._container&&this._container.classList.add(C),this}removeClassName(C){return this._container&&this._container.classList.remove(C),this}setOffset(C){return this.options.offset=C,this._update(),this}toggleClassName(C){if(this._container)return this._container.classList.toggle(C)}setSubpixelPositioning(C){this.options.subpixelPositioning=C}_createCloseButton(){this.options.closeButton&&(this._closeButton=T.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let C=this._container.querySelector(bp);C&&C.focus()}},n.RasterDEMTileSource=Es,n.RasterTileSource=si,n.ScaleControl=class{constructor(C){this._onMove=()=>{Hf(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Hf(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},yp),C)}getDefaultPosition(){return"bottom-left"}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-scale",C.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){T.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},n.ScrollZoomHandler=uu,n.Style=Na,n.TerrainControl=class{constructor(C){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=C}onAdd(C){return this._map=C,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=T.create("button","maplibregl-ctrl-terrain",this._container),T.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){T.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},n.TwoFingersTouchPitchHandler=fp,n.TwoFingersTouchRotateHandler=d0,n.TwoFingersTouchZoomHandler=li,n.TwoFingersTouchZoomRotateHandler=bh,n.VectorTileSource=Ni,n.VideoSource=Xo,n.addSourceType=(C,s)=>o._(void 0,void 0,void 0,function*(){if(as(C))throw new Error(`A source type called "${C}" already exists.`);((u,_)=>{xo[u]=_})(C,s)}),n.clearPrewarmedResources=function(){let C=fr;C&&(C.isPreloaded()&&C.numActive()===1?(C.release(yt),fr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.createTileMesh=$d,n.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},n.getRTLTextPluginStatus=function(){return kt().getRTLTextPluginStatus()},n.getVersion=function(){return Wf},n.getWorkerCount=function(){return Xt.workerCount},n.getWorkerUrl=function(){return o.a.WORKER_URL},n.importScriptInWorkers=function(C){return Or().broadcast("IS",C)},n.prewarm=function(){Ot().acquire(yt)},n.setMaxParallelImageRequests=function(C){o.a.MAX_PARALLEL_IMAGE_REQUESTS=C},n.setRTLTextPlugin=function(C,s){return kt().setRTLTextPlugin(C,s)},n.setWorkerCount=function(C){Xt.workerCount=C},n.setWorkerUrl=function(C){o.a.WORKER_URL=C}});var i=t;return i})});var cN=io((Cy,Pw)=>{(function(t){"use strict";var e="Compound",r="Identifier",i="MemberExpression",n="Literal",o="ThisExpression",a="CallExpression",c="UnaryExpression",h="BinaryExpression",p="LogicalExpression",x="ConditionalExpression",T="ArrayExpression",R=46,k=44,j=39,q=34,Z=40,re=41,ee=91,se=93,me=63,Le=59,je=58,Je=function(qt,Ot){var Tr=new Error(qt+" at character "+Ot);throw Tr.index=Ot,Tr.description=qt,Tr},J=!0,te={"-":J,"!":J,"~":J,"+":J},X={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ye=function(qt){var Ot=0,Tr;for(var Or in qt)(Tr=Or.length)>Ot&&qt.hasOwnProperty(Or)&&(Ot=Tr);return Ot},_e=ye(te),Oe=ye(X),ve={true:!0,false:!1,null:null},De="this",Xe=function(qt){return X[qt]||0},rt=function(qt,Ot,Tr){var Or=qt==="||"||qt==="&&"?p:h;return{type:Or,operator:qt,left:Ot,right:Tr}},tt=function(qt){return qt>=48&&qt<=57},yt=function(qt){return qt===36||qt===95||qt>=65&&qt<=90||qt>=97&&qt<=122||qt>=128&&!X[String.fromCharCode(qt)]},Xt=function(qt){return qt===36||qt===95||qt>=65&&qt<=90||qt>=97&&qt<=122||qt>=48&&qt<=57||qt>=128&&!X[String.fromCharCode(qt)]},jt=function(qt){for(var Ot=0,Tr=qt.charAt,Or=qt.charCodeAt,Dr=function(Jt){return Tr.call(qt,Jt)},Xr=function(Jt){return Or.call(qt,Jt)},ki=qt.length,ei=function(){for(var Jt=Xr(Ot);Jt===32||Jt===9||Jt===10||Jt===13;)Jt=Xr(++Ot)},Oi=function(){var Jt=tn(),kt,Er;if(ei(),Xr(Ot)===me){if(Ot++,kt=Oi(),kt||Je("Expected expression",Ot),ei(),Xr(Ot)===je)return Ot++,Er=Oi(),Er||Je("Expected expression",Ot),{type:x,test:Jt,consequent:kt,alternate:Er};Je("Expected :",Ot)}else return Jt},ui=function(){ei();for(var Jt,kt=qt.substr(Ot,Oe),Er=kt.length;Er>0;){if(X.hasOwnProperty(kt)&&(!yt(Xr(Ot))||Ot+kt.length<qt.length&&!Xt(Xr(Ot+kt.length))))return Ot+=Er,kt;kt=kt.substr(0,--Er)}return!1},tn=function(){var Jt,kt,Er,ai,Mr,Xi,uo,zn,st,de;if(uo=Ni(),Er=ui(),!Er)return uo;for(Xi={value:Er,prec:Xe(Er)},zn=Ni(),zn||Je("Expected expression after "+Er,Ot),Mr=[uo,Xi,zn];(Er=ui())&&(ai=Xe(Er),ai!==0);){for(Xi={value:Er,prec:ai},de=Er;Mr.length>2&&ai<=Mr[Mr.length-2].prec;)zn=Mr.pop(),Er=Mr.pop().value,uo=Mr.pop(),kt=rt(Er,uo,zn),Mr.push(kt);kt=Ni(),kt||Je("Expected expression after "+de,Ot),Mr.push(Xi,kt)}for(st=Mr.length-1,kt=Mr[st];st>1;)kt=rt(Mr[st-1].value,Mr[st-2],kt),st-=2;return kt},Ni=function(){var Jt,kt,Er;if(ei(),Jt=Xr(Ot),tt(Jt)||Jt===R)return si();if(Jt===j||Jt===q)return Es();if(Jt===ee)return xo();for(kt=qt.substr(Ot,_e),Er=kt.length;Er>0;){if(te.hasOwnProperty(kt)&&(!yt(Xr(Ot))||Ot+kt.length<qt.length&&!Xt(Xr(Ot+kt.length))))return Ot+=Er,{type:c,operator:kt,argument:Ni(),prefix:!0};kt=kt.substr(0,--Er)}return yt(Jt)||Jt===Z?Xo():!1},si=function(){for(var Jt="",kt,Er;tt(Xr(Ot));)Jt+=Dr(Ot++);if(Xr(Ot)===R)for(Jt+=Dr(Ot++);tt(Xr(Ot));)Jt+=Dr(Ot++);if(kt=Dr(Ot),kt==="e"||kt==="E"){for(Jt+=Dr(Ot++),kt=Dr(Ot),(kt==="+"||kt==="-")&&(Jt+=Dr(Ot++));tt(Xr(Ot));)Jt+=Dr(Ot++);tt(Xr(Ot-1))||Je("Expected exponent ("+Jt+Dr(Ot)+")",Ot)}return Er=Xr(Ot),yt(Er)?Je("Variable names cannot start with a number ("+Jt+Dr(Ot)+")",Ot):Er===R&&Je("Unexpected period",Ot),{type:n,value:parseFloat(Jt),raw:Jt}},Es=function(){for(var Jt="",kt=Dr(Ot++),Er=!1,ai;Ot<ki;)if(ai=Dr(Ot++),ai===kt){Er=!0;break}else if(ai==="\\")switch(ai=Dr(Ot++),ai){case"n":Jt+=`
`;break;case"r":Jt+="\r";break;case"t":Jt+="	";break;case"b":Jt+="\b";break;case"f":Jt+="\f";break;case"v":Jt+="\v";break;default:Jt+=ai}else Jt+=ai;return Er||Je('Unclosed quote after "'+Jt+'"',Ot),{type:n,value:Jt,raw:kt+Jt+kt}},Zo=function(){var Jt=Xr(Ot),kt=Ot,Er;for(yt(Jt)?Ot++:Je("Unexpected "+Dr(Ot),Ot);Ot<ki&&(Jt=Xr(Ot),Xt(Jt));)Ot++;return Er=qt.slice(kt,Ot),ve.hasOwnProperty(Er)?{type:n,value:ve[Er],raw:Er}:Er===De?{type:o}:{type:r,name:Er}},co=function(Jt){for(var kt,Er=[],ai,Mr=!1,Xi=0;Ot<ki;)if(ei(),kt=Xr(Ot),kt===Jt){Mr=!0,Ot++,Jt===re&&Xi&&Xi>=Er.length&&Je("Unexpected token "+String.fromCharCode(Jt),Ot);break}else if(kt===k){if(Ot++,Xi++,Xi!==Er.length){if(Jt===re)Je("Unexpected token ,",Ot);else if(Jt===se)for(var uo=Er.length;uo<Xi;uo++)Er.push(null)}}else ai=Oi(),(!ai||ai.type===e)&&Je("Expected comma",Ot),Er.push(ai);return Mr||Je("Expected "+String.fromCharCode(Jt),Ot),Er},Xo=function(){var Jt,kt;for(Jt=Xr(Ot),Jt===Z?kt=Aa():kt=Zo(),ei(),Jt=Xr(Ot);Jt===R||Jt===ee||Jt===Z;)Ot++,Jt===R?(ei(),kt={type:i,computed:!1,object:kt,property:Zo()}):Jt===ee?(kt={type:i,computed:!0,object:kt,property:Oi()},ei(),Jt=Xr(Ot),Jt!==se&&Je("Unclosed [",Ot),Ot++):Jt===Z&&(kt={type:a,arguments:co(re),callee:kt}),ei(),Jt=Xr(Ot);return kt},Aa=function(){Ot++;var Jt=Oi();if(ei(),Xr(Ot)===re)return Ot++,Jt;Je("Unclosed (",Ot)},xo=function(){return Ot++,{type:T,elements:co(se)}},as=[],bo,jr;Ot<ki;)bo=Xr(Ot),bo===Le||bo===k?Ot++:(jr=Oi())?as.push(jr):Ot<ki&&Je('Unexpected "'+Dr(Ot)+'"',Ot);return as.length===1?as[0]:{type:e,body:as}};if(jt.version="0.3.5",jt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+jt.version},jt.addUnaryOp=function(qt){return _e=Math.max(qt.length,_e),te[qt]=J,this},jt.addBinaryOp=function(qt,Ot){return Oe=Math.max(qt.length,Oe),X[qt]=Ot,this},jt.addLiteral=function(qt,Ot){return ve[qt]=Ot,this},jt.removeUnaryOp=function(qt){return delete te[qt],qt.length===_e&&(_e=ye(te)),this},jt.removeAllUnaryOps=function(){return te={},_e=0,this},jt.removeBinaryOp=function(qt){return delete X[qt],qt.length===Oe&&(Oe=ye(X)),this},jt.removeAllBinaryOps=function(){return X={},Oe=0,this},jt.removeLiteral=function(qt){return delete ve[qt],this},jt.removeAllLiterals=function(){return ve={},this},typeof Cy>"u"){var fr=t.jsep;t.jsep=jt,jt.noConflict=function(){return t.jsep===jt&&(t.jsep=fr),jt}}else typeof Pw<"u"&&Pw.exports?Cy=Pw.exports=jt:Cy.parse=jt})(Cy)});var T7=io((QNe,p4)=>{"use strict";p4.exports=$w;p4.exports.default=$w;function $w(t,e,r){r=r||2;var i=e&&e.length,n=i?e[0]*r:t.length,o=b7(t,0,n,r,!0),a=[];if(!o||o.next===o.prev)return a;var c,h,p,x,T,R,k;if(i&&(o=Lae(t,e,o,r)),t.length>80*r){c=p=t[0],h=x=t[1];for(var j=r;j<n;j+=r)T=t[j],R=t[j+1],T<c&&(c=T),R<h&&(h=R),T>p&&(p=T),R>x&&(x=R);k=Math.max(p-c,x-h),k=k!==0?32767/k:0}return Yy(o,a,r,c,h,k,0),a}function b7(t,e,r,i,n){var o,a;if(n===d4(t,e,r,i)>0)for(o=e;o<r;o+=i)a=x7(o,t[o],t[o+1],a);else for(o=r-i;o>=e;o-=i)a=x7(o,t[o],t[o+1],a);return a&&qw(a,a.next)&&(Qy(a),a=a.next),a}function mA(t,e){if(!t)return t;e||(e=t);var r=t,i;do if(i=!1,!r.steiner&&(qw(r,r.next)||lo(r.prev,r,r.next)===0)){if(Qy(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Yy(t,e,r,i,n,o,a){if(t){!a&&o&&Nae(t,i,n,o);for(var c=t,h,p;t.prev!==t.next;){if(h=t.prev,p=t.next,o?Pae(t,i,n,o):Mae(t)){e.push(h.i/r|0),e.push(t.i/r|0),e.push(p.i/r|0),Qy(t),t=p.next,c=p.next;continue}if(t=p,t===c){a?a===1?(t=Rae(mA(t),e,r),Yy(t,e,r,i,n,o,2)):a===2&&Bae(t,e,r,i,n,o):Yy(mA(t),e,r,i,n,o,1);break}}}}function Mae(t){var e=t.prev,r=t,i=t.next;if(lo(e,r,i)>=0)return!1;for(var n=e.x,o=r.x,a=i.x,c=e.y,h=r.y,p=i.y,x=n<o?n<a?n:a:o<a?o:a,T=c<h?c<p?c:p:h<p?h:p,R=n>o?n>a?n:a:o>a?o:a,k=c>h?c>p?c:p:h>p?h:p,j=i.next;j!==e;){if(j.x>=x&&j.x<=R&&j.y>=T&&j.y<=k&&Bm(n,c,o,h,a,p,j.x,j.y)&&lo(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Pae(t,e,r,i){var n=t.prev,o=t,a=t.next;if(lo(n,o,a)>=0)return!1;for(var c=n.x,h=o.x,p=a.x,x=n.y,T=o.y,R=a.y,k=c<h?c<p?c:p:h<p?h:p,j=x<T?x<R?x:R:T<R?T:R,q=c>h?c>p?c:p:h>p?h:p,Z=x>T?x>R?x:R:T>R?T:R,re=h4(k,j,e,r,i),ee=h4(q,Z,e,r,i),se=t.prevZ,me=t.nextZ;se&&se.z>=re&&me&&me.z<=ee;){if(se.x>=k&&se.x<=q&&se.y>=j&&se.y<=Z&&se!==n&&se!==a&&Bm(c,x,h,T,p,R,se.x,se.y)&&lo(se.prev,se,se.next)>=0||(se=se.prevZ,me.x>=k&&me.x<=q&&me.y>=j&&me.y<=Z&&me!==n&&me!==a&&Bm(c,x,h,T,p,R,me.x,me.y)&&lo(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;se&&se.z>=re;){if(se.x>=k&&se.x<=q&&se.y>=j&&se.y<=Z&&se!==n&&se!==a&&Bm(c,x,h,T,p,R,se.x,se.y)&&lo(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;me&&me.z<=ee;){if(me.x>=k&&me.x<=q&&me.y>=j&&me.y<=Z&&me!==n&&me!==a&&Bm(c,x,h,T,p,R,me.x,me.y)&&lo(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function Rae(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!qw(n,o)&&v7(n,i,i.next,o)&&Ky(n,o)&&Ky(o,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(o.i/r|0),Qy(i),Qy(i.next),i=t=o),i=i.next}while(i!==t);return mA(i)}function Bae(t,e,r,i,n,o){var a=t;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&Vae(a,c)){var h=w7(a,c);a=mA(a,a.next),h=mA(h,h.next),Yy(a,e,r,i,n,o,0),Yy(h,e,r,i,n,o,0);return}c=c.next}a=a.next}while(a!==t)}function Lae(t,e,r,i){var n=[],o,a,c,h,p;for(o=0,a=e.length;o<a;o++)c=e[o]*i,h=o<a-1?e[o+1]*i:t.length,p=b7(t,c,h,i,!1),p===p.next&&(p.steiner=!0),n.push(Uae(p));for(n.sort(Oae),o=0;o<n.length;o++)r=Dae(n[o],r);return r}function Oae(t,e){return t.x-e.x}function Dae(t,e){var r=Fae(t,e);if(!r)return e;var i=w7(r,t);return mA(i,i.next),mA(r,r.next)}function Fae(t,e){var r=e,i=t.x,n=t.y,o=-1/0,a;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var c=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(c<=i&&c>o&&(o=c,a=r.x<r.next.x?r:r.next,c===i))return a}r=r.next}while(r!==e);if(!a)return null;var h=a,p=a.x,x=a.y,T=1/0,R;r=a;do i>=r.x&&r.x>=p&&i!==r.x&&Bm(n<x?i:o,n,p,x,n<x?o:i,n,r.x,r.y)&&(R=Math.abs(n-r.y)/(i-r.x),Ky(r,t)&&(R<T||R===T&&(r.x>a.x||r.x===a.x&&kae(a,r)))&&(a=r,T=R)),r=r.next;while(r!==h);return a}function kae(t,e){return lo(t.prev,t,e.prev)<0&&lo(e.next,t,t.next)<0}function Nae(t,e,r,i){var n=t;do n.z===0&&(n.z=h4(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,zae(n)}function zae(t){var e,r,i,n,o,a,c,h,p=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,i=r,c=0,e=0;e<p&&(c++,i=i.nextZ,!!i);e++);for(h=p;c>0||h>0&&i;)c!==0&&(h===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,c--):(n=i,i=i.nextZ,h--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,p*=2}while(a>1);return t}function h4(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function Uae(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Bm(t,e,r,i,n,o,a,c){return(n-a)*(e-c)>=(t-a)*(o-c)&&(t-a)*(i-c)>=(r-a)*(e-c)&&(r-a)*(o-c)>=(n-a)*(i-c)}function Vae(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!jae(t,e)&&(Ky(t,e)&&Ky(e,t)&&Gae(t,e)&&(lo(t.prev,t,e.prev)||lo(t,e.prev,e))||qw(t,e)&&lo(t.prev,t,t.next)>0&&lo(e.prev,e,e.next)>0)}function lo(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function qw(t,e){return t.x===e.x&&t.y===e.y}function v7(t,e,r,i){var n=Ww(lo(t,e,r)),o=Ww(lo(t,e,i)),a=Ww(lo(r,i,t)),c=Ww(lo(r,i,e));return!!(n!==o&&a!==c||n===0&&Hw(t,r,e)||o===0&&Hw(t,i,e)||a===0&&Hw(r,t,i)||c===0&&Hw(r,e,i))}function Hw(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ww(t){return t>0?1:t<0?-1:0}function jae(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&v7(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Ky(t,e){return lo(t.prev,t,t.next)<0?lo(t,e,t.next)>=0&&lo(t,t.prev,e)>=0:lo(t,e,t.prev)<0||lo(t,t.next,e)<0}function Gae(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function w7(t,e){var r=new f4(t.i,t.x,t.y),i=new f4(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function x7(t,e,r,i){var n=new f4(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Qy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function f4(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}$w.deviation=function(t,e,r,i){var n=e&&e.length,o=n?e[0]*r:t.length,a=Math.abs(d4(t,0,o,r));if(n)for(var c=0,h=e.length;c<h;c++){var p=e[c]*r,x=c<h-1?e[c+1]*r:t.length;a-=Math.abs(d4(t,p,x,r))}var T=0;for(c=0;c<i.length;c+=3){var R=i[c]*r,k=i[c+1]*r,j=i[c+2]*r;T+=Math.abs((t[R]-t[j])*(t[k+1]-t[R+1])-(t[R]-t[k])*(t[j+1]-t[R+1]))}return a===0&&T===0?0:Math.abs((T-a)/a)};function d4(t,e,r,i){for(var n=0,o=e,a=r-i;o<r;o+=i)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}$w.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[n][o][a]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r}});var T3=io(Xh=>{"use strict";var Gz=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",tce=Gz+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",Hz="["+Gz+"]["+tce+"]*",rce=new RegExp("^"+Hz+"$"),ice=function(t,e){let r=[],i=e.exec(t);for(;i;){let n=[];n.startIndex=e.lastIndex-i[0].length;let o=i.length;for(let a=0;a<o;a++)n.push(i[a]);r.push(n),i=e.exec(t)}return r},nce=function(t){let e=rce.exec(t);return!(e===null||typeof e>"u")};Xh.isExist=function(t){return typeof t<"u"};Xh.isEmptyObject=function(t){return Object.keys(t).length===0};Xh.merge=function(t,e,r){if(e){let i=Object.keys(e),n=i.length;for(let o=0;o<n;o++)r==="strict"?t[i[o]]=[e[i[o]]]:t[i[o]]=e[i[o]]}};Xh.getValue=function(t){return Xh.isExist(t)?t:""};Xh.isName=nce;Xh.getAllMatches=ice;Xh.nameRegexp=Hz});var P4=io(Xz=>{"use strict";var M4=T3(),oce={allowBooleanAttributes:!1,unpairedTags:[]};Xz.validate=function(t,e){e=Object.assign({},oce,e);let r=[],i=!1,n=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let o=0;o<t.length;o++)if(t[o]==="<"&&t[o+1]==="?"){if(o+=2,o=$z(t,o),o.err)return o}else if(t[o]==="<"){let a=o;if(o++,t[o]==="!"){o=qz(t,o);continue}else{let c=!1;t[o]==="/"&&(c=!0,o++);let h="";for(;o<t.length&&t[o]!==">"&&t[o]!==" "&&t[o]!=="	"&&t[o]!==`
`&&t[o]!=="\r";o++)h+=t[o];if(h=h.trim(),h[h.length-1]==="/"&&(h=h.substring(0,h.length-1),o--),!dce(h)){let T;return h.trim().length===0?T="Invalid space after '<'.":T="Tag '"+h+"' is an invalid name.",Lo("InvalidTag",T,ha(t,o))}let p=lce(t,o);if(p===!1)return Lo("InvalidAttr","Attributes for '"+h+"' have open quote.",ha(t,o));let x=p.value;if(o=p.index,x[x.length-1]==="/"){let T=o-x.length;x=x.substring(0,x.length-1);let R=Zz(x,e);if(R===!0)i=!0;else return Lo(R.err.code,R.err.msg,ha(t,T+R.err.line))}else if(c)if(p.tagClosed){if(x.trim().length>0)return Lo("InvalidTag","Closing tag '"+h+"' can't have attributes or invalid starting.",ha(t,a));if(r.length===0)return Lo("InvalidTag","Closing tag '"+h+"' has not been opened.",ha(t,a));{let T=r.pop();if(h!==T.tagName){let R=ha(t,T.tagStartPos);return Lo("InvalidTag","Expected closing tag '"+T.tagName+"' (opened in line "+R.line+", col "+R.col+") instead of closing tag '"+h+"'.",ha(t,a))}r.length==0&&(n=!0)}}else return Lo("InvalidTag","Closing tag '"+h+"' doesn't have proper closing.",ha(t,o));else{let T=Zz(x,e);if(T!==!0)return Lo(T.err.code,T.err.msg,ha(t,o-x.length+T.err.line));if(n===!0)return Lo("InvalidXml","Multiple possible root nodes found.",ha(t,o));e.unpairedTags.indexOf(h)!==-1||r.push({tagName:h,tagStartPos:a}),i=!0}for(o++;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="!"){o++,o=qz(t,o);continue}else if(t[o+1]==="?"){if(o=$z(t,++o),o.err)return o}else break;else if(t[o]==="&"){let T=hce(t,o);if(T==-1)return Lo("InvalidChar","char '&' is not expected.",ha(t,o));o=T}else if(n===!0&&!Wz(t[o]))return Lo("InvalidXml","Extra text at the end",ha(t,o));t[o]==="<"&&o--}}else{if(Wz(t[o]))continue;return Lo("InvalidChar","char '"+t[o]+"' is not expected.",ha(t,o))}if(i){if(r.length==1)return Lo("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",ha(t,r[0].tagStartPos));if(r.length>0)return Lo("InvalidXml","Invalid '"+JSON.stringify(r.map(o=>o.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Lo("InvalidXml","Start tag expected.",1);return!0};function Wz(t){return t===" "||t==="	"||t===`
`||t==="\r"}function $z(t,e){let r=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){let i=t.substr(r,e-r);if(e>5&&i==="xml")return Lo("InvalidXml","XML declaration allowed only at the start of the document.",ha(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function qz(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let r=1;for(e+=8;e<t.length;e++)if(t[e]==="<")r++;else if(t[e]===">"&&(r--,r===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}var sce='"',ace="'";function lce(t,e){let r="",i="",n=!1;for(;e<t.length;e++){if(t[e]===sce||t[e]===ace)i===""?i=t[e]:i!==t[e]||(i="");else if(t[e]===">"&&i===""){n=!0;break}r+=t[e]}return i!==""?!1:{value:r,index:e,tagClosed:n}}var cce=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function Zz(t,e){let r=M4.getAllMatches(t,cce),i={};for(let n=0;n<r.length;n++){if(r[n][1].length===0)return Lo("InvalidAttr","Attribute '"+r[n][2]+"' has no space in starting.",yx(r[n]));if(r[n][3]!==void 0&&r[n][4]===void 0)return Lo("InvalidAttr","Attribute '"+r[n][2]+"' is without value.",yx(r[n]));if(r[n][3]===void 0&&!e.allowBooleanAttributes)return Lo("InvalidAttr","boolean attribute '"+r[n][2]+"' is not allowed.",yx(r[n]));let o=r[n][2];if(!fce(o))return Lo("InvalidAttr","Attribute '"+o+"' is an invalid name.",yx(r[n]));if(!i.hasOwnProperty(o))i[o]=1;else return Lo("InvalidAttr","Attribute '"+o+"' is repeated.",yx(r[n]))}return!0}function uce(t,e){let r=/\d/;for(t[e]==="x"&&(e++,r=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(r))break}return-1}function hce(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,uce(t,e);let r=0;for(;e<t.length;e++,r++)if(!(t[e].match(/\w/)&&r<20)){if(t[e]===";")break;return-1}return e}function Lo(t,e,r){return{err:{code:t,msg:e,line:r.line||r,col:r.col}}}function fce(t){return M4.isName(t)}function dce(t){return M4.isName(t)}function ha(t,e){let r=t.substring(0,e).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function yx(t){return t.startIndex+t[1].length}});var Kz=io(R4=>{var Yz={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,r){return t}},pce=function(t){return Object.assign({},Yz,t)};R4.buildOptions=pce;R4.defaultOptions=Yz});var Jz=io((vVe,Qz)=>{"use strict";var B4=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,r){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:r})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};Qz.exports=B4});var tU=io((wVe,eU)=>{var Ace=T3();function mce(t,e){let r={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let i=1,n=!1,o=!1,a="";for(;e<t.length;e++)if(t[e]==="<"&&!o){if(n&&yce(t,e)){e+=7;let c,h;[c,h,e]=gce(t,e+1),h.indexOf("&")===-1&&(r[wce(c)]={regx:RegExp(`&${c};`,"g"),val:h})}else if(n&&xce(t,e))e+=8;else if(n&&bce(t,e))e+=8;else if(n&&vce(t,e))e+=9;else if(_ce)o=!0;else throw new Error("Invalid DOCTYPE");i++,a=""}else if(t[e]===">"){if(o?t[e-1]==="-"&&t[e-2]==="-"&&(o=!1,i--):i--,i===0)break}else t[e]==="["?n=!0:a+=t[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:e}}function gce(t,e){let r="";for(;e<t.length&&t[e]!=="'"&&t[e]!=='"';e++)r+=t[e];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");let i=t[e++],n="";for(;e<t.length&&t[e]!==i;e++)n+=t[e];return[r,n,e]}function _ce(t,e){return t[e+1]==="!"&&t[e+2]==="-"&&t[e+3]==="-"}function yce(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="N"&&t[e+4]==="T"&&t[e+5]==="I"&&t[e+6]==="T"&&t[e+7]==="Y"}function xce(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="L"&&t[e+4]==="E"&&t[e+5]==="M"&&t[e+6]==="E"&&t[e+7]==="N"&&t[e+8]==="T"}function bce(t,e){return t[e+1]==="!"&&t[e+2]==="A"&&t[e+3]==="T"&&t[e+4]==="T"&&t[e+5]==="L"&&t[e+6]==="I"&&t[e+7]==="S"&&t[e+8]==="T"}function vce(t,e){return t[e+1]==="!"&&t[e+2]==="N"&&t[e+3]==="O"&&t[e+4]==="T"&&t[e+5]==="A"&&t[e+6]==="T"&&t[e+7]==="I"&&t[e+8]==="O"&&t[e+9]==="N"}function wce(t){if(Ace.isName(t))return t;throw new Error(`Invalid entity name ${t}`)}eU.exports=mce});var iU=io((TVe,rU)=>{var Tce=/^[-+]?0x[a-fA-F0-9]+$/,Ece=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Cce={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Sce(t,e={}){if(e=Object.assign({},Cce,e),!t||typeof t!="string")return t;let r=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(r))return t;if(t==="0")return 0;if(e.hex&&Tce.test(r))return Mce(r,16);if(r.search(/[eE]/)!==-1){let i=r.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(i){if(e.leadingZeros)r=(i[1]||"")+i[3];else if(!(i[2]==="0"&&i[3][0]==="."))return t;return e.eNotation?Number(r):t}else return t}else{let i=Ece.exec(r);if(i){let n=i[1],o=i[2],a=Ice(i[3]);if(!e.leadingZeros&&o.length>0&&n&&r[2]!==".")return t;if(!e.leadingZeros&&o.length>0&&!n&&r[1]!==".")return t;if(e.leadingZeros&&o===t)return 0;{let c=Number(r),h=""+c;return h.search(/[eE]/)!==-1?e.eNotation?c:t:r.indexOf(".")!==-1?h==="0"&&a===""||h===a||n&&h==="-"+a?c:t:o?a===h||n+a===h?c:t:r===h||r===n+h?c:t}}else return t}}function Ice(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}function Mce(t,e){if(parseInt)return parseInt(t,e);if(Number.parseInt)return Number.parseInt(t,e);if(window&&window.parseInt)return window.parseInt(t,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}rU.exports=Sce});var L4=io((EVe,nU)=>{function Pce(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(let r of t)if(typeof r=="string"&&e===r||r instanceof RegExp&&r.test(e))return!0}:()=>!1}nU.exports=Pce});var aU=io((CVe,sU)=>{"use strict";var oU=T3(),xx=Jz(),Rce=tU(),Bce=iU(),Lce=L4(),O4=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=Oce,this.parseXml=zce,this.parseTextData=Dce,this.resolveNameSpace=Fce,this.buildAttributesMap=Nce,this.isItStopNode=Gce,this.replaceEntitiesValue=Vce,this.readStopNodeData=Wce,this.saveTextToParentTag=jce,this.addChild=Uce,this.ignoreAttributesFn=Lce(this.options.ignoreAttributes)}};function Oce(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:t[i]}}}function Dce(t,e,r,i,n,o,a){if(t!==void 0&&(this.options.trimValues&&!i&&(t=t.trim()),t.length>0)){a||(t=this.replaceEntitiesValue(t));let c=this.options.tagValueProcessor(e,t,r,n,o);return c==null?t:typeof c!=typeof t||c!==t?c:this.options.trimValues?F4(t,this.options.parseTagValue,this.options.numberParseOptions):t.trim()===t?F4(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function Fce(t){if(this.options.removeNSPrefix){let e=t.split(":"),r=t.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(t=r+e[1])}return t}var kce=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Nce(t,e,r){if(this.options.ignoreAttributes!==!0&&typeof t=="string"){let i=oU.getAllMatches(t,kce),n=i.length,o={};for(let a=0;a<n;a++){let c=this.resolveNameSpace(i[a][1]);if(this.ignoreAttributesFn(c,e))continue;let h=i[a][4],p=this.options.attributeNamePrefix+c;if(c.length)if(this.options.transformAttributeName&&(p=this.options.transformAttributeName(p)),p==="__proto__"&&(p="#__proto__"),h!==void 0){this.options.trimValues&&(h=h.trim()),h=this.replaceEntitiesValue(h);let x=this.options.attributeValueProcessor(c,h,e);x==null?o[p]=h:typeof x!=typeof h||x!==h?o[p]=x:o[p]=F4(h,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(o[p]=!0)}if(!Object.keys(o).length)return;if(this.options.attributesGroupName){let a={};return a[this.options.attributesGroupName]=o,a}return o}}var zce=function(t){t=t.replace(/\r\n?/g,`
`);let e=new xx("!xml"),r=e,i="",n="";for(let o=0;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="/"){let c=yA(t,">",o,"Closing Tag is not closed."),h=t.substring(o+2,c).trim();if(this.options.removeNSPrefix){let T=h.indexOf(":");T!==-1&&(h=h.substr(T+1))}this.options.transformTagName&&(h=this.options.transformTagName(h)),r&&(i=this.saveTextToParentTag(i,r,n));let p=n.substring(n.lastIndexOf(".")+1);if(h&&this.options.unpairedTags.indexOf(h)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${h}>`);let x=0;p&&this.options.unpairedTags.indexOf(p)!==-1?(x=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):x=n.lastIndexOf("."),n=n.substring(0,x),r=this.tagsNodeStack.pop(),i="",o=c}else if(t[o+1]==="?"){let c=D4(t,o,!1,"?>");if(!c)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,r,n),!(this.options.ignoreDeclaration&&c.tagName==="?xml"||this.options.ignorePiTags)){let h=new xx(c.tagName);h.add(this.options.textNodeName,""),c.tagName!==c.tagExp&&c.attrExpPresent&&(h[":@"]=this.buildAttributesMap(c.tagExp,n,c.tagName)),this.addChild(r,h,n)}o=c.closeIndex+1}else if(t.substr(o+1,3)==="!--"){let c=yA(t,"-->",o+4,"Comment is not closed.");if(this.options.commentPropName){let h=t.substring(o+4,c-2);i=this.saveTextToParentTag(i,r,n),r.add(this.options.commentPropName,[{[this.options.textNodeName]:h}])}o=c}else if(t.substr(o+1,2)==="!D"){let c=Rce(t,o);this.docTypeEntities=c.entities,o=c.i}else if(t.substr(o+1,2)==="!["){let c=yA(t,"]]>",o,"CDATA is not closed.")-2,h=t.substring(o+9,c);i=this.saveTextToParentTag(i,r,n);let p=this.parseTextData(h,r.tagname,n,!0,!1,!0,!0);p==null&&(p=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:h}]):r.add(this.options.textNodeName,p),o=c+2}else{let c=D4(t,o,this.options.removeNSPrefix),h=c.tagName,p=c.rawTagName,x=c.tagExp,T=c.attrExpPresent,R=c.closeIndex;this.options.transformTagName&&(h=this.options.transformTagName(h)),r&&i&&r.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,r,n,!1));let k=r;if(k&&this.options.unpairedTags.indexOf(k.tagname)!==-1&&(r=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),h!==e.tagname&&(n+=n?"."+h:h),this.isItStopNode(this.options.stopNodes,n,h)){let j="";if(x.length>0&&x.lastIndexOf("/")===x.length-1)h[h.length-1]==="/"?(h=h.substr(0,h.length-1),n=n.substr(0,n.length-1),x=h):x=x.substr(0,x.length-1),o=c.closeIndex;else if(this.options.unpairedTags.indexOf(h)!==-1)o=c.closeIndex;else{let Z=this.readStopNodeData(t,p,R+1);if(!Z)throw new Error(`Unexpected end of ${p}`);o=Z.i,j=Z.tagContent}let q=new xx(h);h!==x&&T&&(q[":@"]=this.buildAttributesMap(x,n,h)),j&&(j=this.parseTextData(j,h,n,!0,T,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),q.add(this.options.textNodeName,j),this.addChild(r,q,n)}else{if(x.length>0&&x.lastIndexOf("/")===x.length-1){h[h.length-1]==="/"?(h=h.substr(0,h.length-1),n=n.substr(0,n.length-1),x=h):x=x.substr(0,x.length-1),this.options.transformTagName&&(h=this.options.transformTagName(h));let j=new xx(h);h!==x&&T&&(j[":@"]=this.buildAttributesMap(x,n,h)),this.addChild(r,j,n),n=n.substr(0,n.lastIndexOf("."))}else{let j=new xx(h);this.tagsNodeStack.push(r),h!==x&&T&&(j[":@"]=this.buildAttributesMap(x,n,h)),this.addChild(r,j,n),r=j}i="",o=R}}else i+=t[o];return e.child};function Uce(t,e,r){let i=this.options.updateTag(e.tagname,r,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),t.addChild(e))}var Vce=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){let r=this.docTypeEntities[e];t=t.replace(r.regx,r.val)}for(let e in this.lastEntities){let r=this.lastEntities[e];t=t.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){let r=this.htmlEntities[e];t=t.replace(r.regex,r.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function jce(t,e,r,i){return t&&(i===void 0&&(i=e.child.length===0),t=this.parseTextData(t,e.tagname,r,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),t!==void 0&&t!==""&&e.add(this.options.textNodeName,t),t=""),t}function Gce(t,e,r){let i="*."+r;for(let n in t){let o=t[n];if(i===o||e===o)return!0}return!1}function Hce(t,e,r=">"){let i,n="";for(let o=e;o<t.length;o++){let a=t[o];if(i)a===i&&(i="");else if(a==='"'||a==="'")i=a;else if(a===r[0])if(r[1]){if(t[o+1]===r[1])return{data:n,index:o}}else return{data:n,index:o};else a==="	"&&(a=" ");n+=a}}function yA(t,e,r,i){let n=t.indexOf(e,r);if(n===-1)throw new Error(i);return n+e.length-1}function D4(t,e,r,i=">"){let n=Hce(t,e+1,i);if(!n)return;let o=n.data,a=n.index,c=o.search(/\s/),h=o,p=!0;c!==-1&&(h=o.substring(0,c),o=o.substring(c+1).trimStart());let x=h;if(r){let T=h.indexOf(":");T!==-1&&(h=h.substr(T+1),p=h!==n.data.substr(T+1))}return{tagName:h,tagExp:o,closeIndex:a,attrExpPresent:p,rawTagName:x}}function Wce(t,e,r){let i=r,n=1;for(;r<t.length;r++)if(t[r]==="<")if(t[r+1]==="/"){let o=yA(t,">",r,`${e} is not closed`);if(t.substring(r+2,o).trim()===e&&(n--,n===0))return{tagContent:t.substring(i,r),i:o};r=o}else if(t[r+1]==="?")r=yA(t,"?>",r+1,"StopNode is not closed.");else if(t.substr(r+1,3)==="!--")r=yA(t,"-->",r+3,"StopNode is not closed.");else if(t.substr(r+1,2)==="![")r=yA(t,"]]>",r,"StopNode is not closed.")-2;else{let o=D4(t,r,">");o&&((o&&o.tagName)===e&&o.tagExp[o.tagExp.length-1]!=="/"&&n++,r=o.closeIndex)}}function F4(t,e,r){if(e&&typeof t=="string"){let i=t.trim();return i==="true"?!0:i==="false"?!1:Bce(t,r)}else return oU.isExist(t)?t:""}sU.exports=O4});var uU=io(cU=>{"use strict";function $ce(t,e){return lU(t,e)}function lU(t,e,r){let i,n={};for(let o=0;o<t.length;o++){let a=t[o],c=qce(a),h="";if(r===void 0?h=c:h=r+"."+c,c===e.textNodeName)i===void 0?i=a[c]:i+=""+a[c];else{if(c===void 0)continue;if(a[c]){let p=lU(a[c],e,h),x=Xce(p,e);a[":@"]?Zce(p,a[":@"],h,e):Object.keys(p).length===1&&p[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?p=p[e.textNodeName]:Object.keys(p).length===0&&(e.alwaysCreateTextNode?p[e.textNodeName]="":p=""),n[c]!==void 0&&n.hasOwnProperty(c)?(Array.isArray(n[c])||(n[c]=[n[c]]),n[c].push(p)):e.isArray(c,h,x)?n[c]=[p]:n[c]=p}}}return typeof i=="string"?i.length>0&&(n[e.textNodeName]=i):i!==void 0&&(n[e.textNodeName]=i),n}function qce(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];if(i!==":@")return i}}function Zce(t,e,r,i){if(e){let n=Object.keys(e),o=n.length;for(let a=0;a<o;a++){let c=n[a];i.isArray(c,r+"."+c,!0,!0)?t[c]=[e[c]]:t[c]=e[c]}}}function Xce(t,e){let{textNodeName:r}=e,i=Object.keys(t).length;return!!(i===0||i===1&&(t[r]||typeof t[r]=="boolean"||t[r]===0))}cU.prettify=$ce});var fU=io((IVe,hU)=>{var{buildOptions:Yce}=Kz(),Kce=aU(),{prettify:Qce}=uU(),Jce=P4(),k4=class{constructor(e){this.externalEntities={},this.options=Yce(e)}parse(e,r){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});let o=Jce.validate(e,r);if(o!==!0)throw Error(`${o.err.msg}:${o.err.line}:${o.err.col}`)}let i=new Kce(this.options);i.addExternalEntities(this.externalEntities);let n=i.parseXml(e);return this.options.preserveOrder||n===void 0?n:Qce(n,this.options)}addEntity(e,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=r}};hU.exports=k4});var gU=io((MVe,mU)=>{var eue=`
`;function tue(t,e){let r="";return e.format&&e.indentBy.length>0&&(r=eue),pU(t,e,"",r)}function pU(t,e,r,i){let n="",o=!1;for(let a=0;a<t.length;a++){let c=t[a],h=rue(c);if(h===void 0)continue;let p="";if(r.length===0?p=h:p=`${r}.${h}`,h===e.textNodeName){let j=c[h];iue(p,e)||(j=e.tagValueProcessor(h,j),j=AU(j,e)),o&&(n+=i),n+=j,o=!1;continue}else if(h===e.cdataPropName){o&&(n+=i),n+=`<![CDATA[${c[h][0][e.textNodeName]}]]>`,o=!1;continue}else if(h===e.commentPropName){n+=i+`<!--${c[h][0][e.textNodeName]}-->`,o=!0;continue}else if(h[0]==="?"){let j=dU(c[":@"],e),q=h==="?xml"?"":i,Z=c[h][0][e.textNodeName];Z=Z.length!==0?" "+Z:"",n+=q+`<${h}${Z}${j}?>`,o=!0;continue}let x=i;x!==""&&(x+=e.indentBy);let T=dU(c[":@"],e),R=i+`<${h}${T}`,k=pU(c[h],e,p,x);e.unpairedTags.indexOf(h)!==-1?e.suppressUnpairedNode?n+=R+">":n+=R+"/>":(!k||k.length===0)&&e.suppressEmptyNode?n+=R+"/>":k&&k.endsWith(">")?n+=R+`>${k}${i}</${h}>`:(n+=R+">",k&&i!==""&&(k.includes("/>")||k.includes("</"))?n+=i+e.indentBy+k+i:n+=k,n+=`</${h}>`),o=!0}return n}function rue(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];if(t.hasOwnProperty(i)&&i!==":@")return i}}function dU(t,e){let r="";if(t&&!e.ignoreAttributes)for(let i in t){if(!t.hasOwnProperty(i))continue;let n=e.attributeValueProcessor(i,t[i]);n=AU(n,e),n===!0&&e.suppressBooleanAttributes?r+=` ${i.substr(e.attributeNamePrefix.length)}`:r+=` ${i.substr(e.attributeNamePrefix.length)}="${n}"`}return r}function iue(t,e){t=t.substr(0,t.length-e.textNodeName.length-1);let r=t.substr(t.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===t||e.stopNodes[i]==="*."+r)return!0;return!1}function AU(t,e){if(t&&t.length>0&&e.processEntities)for(let r=0;r<e.entities.length;r++){let i=e.entities[r];t=t.replace(i.regex,i.val)}return t}mU.exports=tue});var yU=io((PVe,_U)=>{"use strict";var nue=gU(),oue=L4(),sue={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Ld(t){this.options=Object.assign({},sue,t),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=oue(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=cue),this.processTextOrObjNode=aue,this.options.format?(this.indentate=lue,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Ld.prototype.build=function(t){return this.options.preserveOrder?nue(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t={[this.options.arrayNodeName]:t}),this.j2x(t,0,[]).val)};Ld.prototype.j2x=function(t,e,r){let i="",n="",o=r.join(".");for(let a in t)if(Object.prototype.hasOwnProperty.call(t,a))if(typeof t[a]>"u")this.isAttribute(a)&&(n+="");else if(t[a]===null)this.isAttribute(a)||a===this.options.cdataPropName?n+="":a[0]==="?"?n+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if(t[a]instanceof Date)n+=this.buildTextValNode(t[a],a,"",e);else if(typeof t[a]!="object"){let c=this.isAttribute(a);if(c&&!this.ignoreAttributesFn(c,o))i+=this.buildAttrPairStr(c,""+t[a]);else if(!c)if(a===this.options.textNodeName){let h=this.options.tagValueProcessor(a,""+t[a]);n+=this.replaceEntitiesValue(h)}else n+=this.buildTextValNode(t[a],a,"",e)}else if(Array.isArray(t[a])){let c=t[a].length,h="",p="";for(let x=0;x<c;x++){let T=t[a][x];if(!(typeof T>"u"))if(T===null)a[0]==="?"?n+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if(typeof T=="object")if(this.options.oneListGroup){let R=this.j2x(T,e+1,r.concat(a));h+=R.val,this.options.attributesGroupName&&T.hasOwnProperty(this.options.attributesGroupName)&&(p+=R.attrStr)}else h+=this.processTextOrObjNode(T,a,e,r);else if(this.options.oneListGroup){let R=this.options.tagValueProcessor(a,T);R=this.replaceEntitiesValue(R),h+=R}else h+=this.buildTextValNode(T,a,"",e)}this.options.oneListGroup&&(h=this.buildObjectNode(h,a,p,e)),n+=h}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){let c=Object.keys(t[a]),h=c.length;for(let p=0;p<h;p++)i+=this.buildAttrPairStr(c[p],""+t[a][c[p]])}else n+=this.processTextOrObjNode(t[a],a,e,r);return{attrStr:i,val:n}};Ld.prototype.buildAttrPairStr=function(t,e){return e=this.options.attributeValueProcessor(t,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+t:" "+t+'="'+e+'"'};function aue(t,e,r,i){let n=this.j2x(t,r+1,i.concat(e));return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextValNode(t[this.options.textNodeName],e,n.attrStr,r):this.buildObjectNode(n.val,e,n.attrStr,r)}Ld.prototype.buildObjectNode=function(t,e,r,i){if(t==="")return e[0]==="?"?this.indentate(i)+"<"+e+r+"?"+this.tagEndChar:this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar;{let n="</"+e+this.tagEndChar,o="";return e[0]==="?"&&(o="?",n=""),(r||r==="")&&t.indexOf("<")===-1?this.indentate(i)+"<"+e+r+o+">"+t+n:this.options.commentPropName!==!1&&e===this.options.commentPropName&&o.length===0?this.indentate(i)+`<!--${t}-->`+this.newLine:this.indentate(i)+"<"+e+r+o+this.tagEndChar+t+this.indentate(i)+n}};Ld.prototype.closeTag=function(t){let e="";return this.options.unpairedTags.indexOf(t)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${t}`,e};Ld.prototype.buildTextValNode=function(t,e,r,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${t}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${t}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+r+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(e,t);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+r+">"+n+"</"+e+this.tagEndChar}};Ld.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){let r=this.options.entities[e];t=t.replace(r.regex,r.val)}return t};function lue(t){return this.options.indentBy.repeat(t)}function cue(t){return t.startsWith(this.options.attributeNamePrefix)&&t!==this.options.textNodeName?t.substr(this.attrPrefixLen):!1}_U.exports=Ld});var bU=io((RVe,xU)=>{"use strict";var uue=P4(),hue=fU(),fue=yU();xU.exports={XMLParser:hue,XMLValidator:uue,XMLBuilder:fue}});var q4=io((BU,Cx)=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof zB=="function"&&typeof Cx=="object"&&Cx&&Cx.exports?Cx.exports=e():(t.dcodeIO=t.dcodeIO||{}).Long=e()})(BU,function(){"use strict";function t(te,X,ye){this.low=te|0,this.high=X|0,this.unsigned=!!ye}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function e(te){return(te&&te.__isLong__)===!0}t.isLong=e;var r={},i={};function n(te,X){var ye,_e,Oe;return X?(te>>>=0,(Oe=0<=te&&te<256)&&(_e=i[te],_e)?_e:(ye=a(te,(te|0)<0?-1:0,!0),Oe&&(i[te]=ye),ye)):(te|=0,(Oe=-128<=te&&te<128)&&(_e=r[te],_e)?_e:(ye=a(te,te<0?-1:0,!1),Oe&&(r[te]=ye),ye))}t.fromInt=n;function o(te,X){if(isNaN(te)||!isFinite(te))return X?re:Z;if(X){if(te<0)return re;if(te>=k)return je}else{if(te<=-j)return Je;if(te+1>=j)return Le}return te<0?o(-te,X).neg():a(te%R|0,te/R|0,X)}t.fromNumber=o;function a(te,X,ye){return new t(te,X,ye)}t.fromBits=a;var c=Math.pow;function h(te,X,ye){if(te.length===0)throw Error("empty string");if(te==="NaN"||te==="Infinity"||te==="+Infinity"||te==="-Infinity")return Z;if(typeof X=="number"?(ye=X,X=!1):X=!!X,ye=ye||10,ye<2||36<ye)throw RangeError("radix");var _e;if((_e=te.indexOf("-"))>0)throw Error("interior hyphen");if(_e===0)return h(te.substring(1),X,ye).neg();for(var Oe=o(c(ye,8)),ve=Z,De=0;De<te.length;De+=8){var Xe=Math.min(8,te.length-De),rt=parseInt(te.substring(De,De+Xe),ye);if(Xe<8){var tt=o(c(ye,Xe));ve=ve.mul(tt).add(o(rt))}else ve=ve.mul(Oe),ve=ve.add(o(rt))}return ve.unsigned=X,ve}t.fromString=h;function p(te){return te instanceof t?te:typeof te=="number"?o(te):typeof te=="string"?h(te):a(te.low,te.high,te.unsigned)}t.fromValue=p;var x=65536,T=1<<24,R=x*x,k=R*R,j=k/2,q=n(T),Z=n(0);t.ZERO=Z;var re=n(0,!0);t.UZERO=re;var ee=n(1);t.ONE=ee;var se=n(1,!0);t.UONE=se;var me=n(-1);t.NEG_ONE=me;var Le=a(-1,2147483647,!1);t.MAX_VALUE=Le;var je=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=je;var Je=a(0,-2147483648,!1);t.MIN_VALUE=Je;var J=t.prototype;return J.toInt=function(){return this.unsigned?this.low>>>0:this.low},J.toNumber=function(){return this.unsigned?(this.high>>>0)*R+(this.low>>>0):this.high*R+(this.low>>>0)},J.toString=function(X){if(X=X||10,X<2||36<X)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Je)){var ye=o(X),_e=this.div(ye),Oe=_e.mul(ye).sub(this);return _e.toString(X)+Oe.toInt().toString(X)}else return"-"+this.neg().toString(X);for(var ve=o(c(X,6),this.unsigned),De=this,Xe="";;){var rt=De.div(ve),tt=De.sub(rt.mul(ve)).toInt()>>>0,yt=tt.toString(X);if(De=rt,De.isZero())return yt+Xe;for(;yt.length<6;)yt="0"+yt;Xe=""+yt+Xe}},J.getHighBits=function(){return this.high},J.getHighBitsUnsigned=function(){return this.high>>>0},J.getLowBits=function(){return this.low},J.getLowBitsUnsigned=function(){return this.low>>>0},J.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Je)?64:this.neg().getNumBitsAbs();for(var X=this.high!=0?this.high:this.low,ye=31;ye>0&&!(X&1<<ye);ye--);return this.high!=0?ye+33:ye+1},J.isZero=function(){return this.high===0&&this.low===0},J.isNegative=function(){return!this.unsigned&&this.high<0},J.isPositive=function(){return this.unsigned||this.high>=0},J.isOdd=function(){return(this.low&1)===1},J.isEven=function(){return(this.low&1)===0},J.equals=function(X){return e(X)||(X=p(X)),this.unsigned!==X.unsigned&&this.high>>>31===1&&X.high>>>31===1?!1:this.high===X.high&&this.low===X.low},J.eq=J.equals,J.notEquals=function(X){return!this.eq(X)},J.neq=J.notEquals,J.lessThan=function(X){return this.comp(X)<0},J.lt=J.lessThan,J.lessThanOrEqual=function(X){return this.comp(X)<=0},J.lte=J.lessThanOrEqual,J.greaterThan=function(X){return this.comp(X)>0},J.gt=J.greaterThan,J.greaterThanOrEqual=function(X){return this.comp(X)>=0},J.gte=J.greaterThanOrEqual,J.compare=function(X){if(e(X)||(X=p(X)),this.eq(X))return 0;var ye=this.isNegative(),_e=X.isNegative();return ye&&!_e?-1:!ye&&_e?1:this.unsigned?X.high>>>0>this.high>>>0||X.high===this.high&&X.low>>>0>this.low>>>0?-1:1:this.sub(X).isNegative()?-1:1},J.comp=J.compare,J.negate=function(){return!this.unsigned&&this.eq(Je)?Je:this.not().add(ee)},J.neg=J.negate,J.add=function(X){e(X)||(X=p(X));var ye=this.high>>>16,_e=this.high&65535,Oe=this.low>>>16,ve=this.low&65535,De=X.high>>>16,Xe=X.high&65535,rt=X.low>>>16,tt=X.low&65535,yt=0,Xt=0,jt=0,fr=0;return fr+=ve+tt,jt+=fr>>>16,fr&=65535,jt+=Oe+rt,Xt+=jt>>>16,jt&=65535,Xt+=_e+Xe,yt+=Xt>>>16,Xt&=65535,yt+=ye+De,yt&=65535,a(jt<<16|fr,yt<<16|Xt,this.unsigned)},J.subtract=function(X){return e(X)||(X=p(X)),this.add(X.neg())},J.sub=J.subtract,J.multiply=function(X){if(this.isZero()||(e(X)||(X=p(X)),X.isZero()))return Z;if(this.eq(Je))return X.isOdd()?Je:Z;if(X.eq(Je))return this.isOdd()?Je:Z;if(this.isNegative())return X.isNegative()?this.neg().mul(X.neg()):this.neg().mul(X).neg();if(X.isNegative())return this.mul(X.neg()).neg();if(this.lt(q)&&X.lt(q))return o(this.toNumber()*X.toNumber(),this.unsigned);var ye=this.high>>>16,_e=this.high&65535,Oe=this.low>>>16,ve=this.low&65535,De=X.high>>>16,Xe=X.high&65535,rt=X.low>>>16,tt=X.low&65535,yt=0,Xt=0,jt=0,fr=0;return fr+=ve*tt,jt+=fr>>>16,fr&=65535,jt+=Oe*tt,Xt+=jt>>>16,jt&=65535,jt+=ve*rt,Xt+=jt>>>16,jt&=65535,Xt+=_e*tt,yt+=Xt>>>16,Xt&=65535,Xt+=Oe*rt,yt+=Xt>>>16,Xt&=65535,Xt+=ve*Xe,yt+=Xt>>>16,Xt&=65535,yt+=ye*tt+_e*rt+Oe*Xe+ve*De,yt&=65535,a(jt<<16|fr,yt<<16|Xt,this.unsigned)},J.mul=J.multiply,J.divide=function(X){if(e(X)||(X=p(X)),X.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?re:Z;var ye,_e,Oe;if(this.unsigned){if(X.unsigned||(X=X.toUnsigned()),X.gt(this))return re;if(X.gt(this.shru(1)))return se;Oe=re}else{if(this.eq(Je)){if(X.eq(ee)||X.eq(me))return Je;if(X.eq(Je))return ee;var ve=this.shr(1);return ye=ve.div(X).shl(1),ye.eq(Z)?X.isNegative()?ee:me:(_e=this.sub(X.mul(ye)),Oe=ye.add(_e.div(X)),Oe)}else if(X.eq(Je))return this.unsigned?re:Z;if(this.isNegative())return X.isNegative()?this.neg().div(X.neg()):this.neg().div(X).neg();if(X.isNegative())return this.div(X.neg()).neg();Oe=Z}for(_e=this;_e.gte(X);){ye=Math.max(1,Math.floor(_e.toNumber()/X.toNumber()));for(var De=Math.ceil(Math.log(ye)/Math.LN2),Xe=De<=48?1:c(2,De-48),rt=o(ye),tt=rt.mul(X);tt.isNegative()||tt.gt(_e);)ye-=Xe,rt=o(ye,this.unsigned),tt=rt.mul(X);rt.isZero()&&(rt=ee),Oe=Oe.add(rt),_e=_e.sub(tt)}return Oe},J.div=J.divide,J.modulo=function(X){return e(X)||(X=p(X)),this.sub(this.div(X).mul(X))},J.mod=J.modulo,J.not=function(){return a(~this.low,~this.high,this.unsigned)},J.and=function(X){return e(X)||(X=p(X)),a(this.low&X.low,this.high&X.high,this.unsigned)},J.or=function(X){return e(X)||(X=p(X)),a(this.low|X.low,this.high|X.high,this.unsigned)},J.xor=function(X){return e(X)||(X=p(X)),a(this.low^X.low,this.high^X.high,this.unsigned)},J.shiftLeft=function(X){return e(X)&&(X=X.toInt()),(X&=63)===0?this:X<32?a(this.low<<X,this.high<<X|this.low>>>32-X,this.unsigned):a(0,this.low<<X-32,this.unsigned)},J.shl=J.shiftLeft,J.shiftRight=function(X){return e(X)&&(X=X.toInt()),(X&=63)===0?this:X<32?a(this.low>>>X|this.high<<32-X,this.high>>X,this.unsigned):a(this.high>>X-32,this.high>=0?0:-1,this.unsigned)},J.shr=J.shiftRight,J.shiftRightUnsigned=function(X){if(e(X)&&(X=X.toInt()),X&=63,X===0)return this;var ye=this.high;if(X<32){var _e=this.low;return a(_e>>>X|ye<<32-X,ye>>>X,this.unsigned)}else return X===32?a(ye,0,this.unsigned):a(ye>>>X-32,0,this.unsigned)},J.shru=J.shiftRightUnsigned,J.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},J.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},J.toBytes=function(te){return te?this.toBytesLE():this.toBytesBE()},J.toBytesLE=function(){var te=this.high,X=this.low;return[X&255,X>>>8&255,X>>>16&255,X>>>24&255,te&255,te>>>8&255,te>>>16&255,te>>>24&255]},J.toBytesBE=function(){var te=this.high,X=this.low;return[te>>>24&255,te>>>16&255,te>>>8&255,te&255,X>>>24&255,X>>>16&255,X>>>8&255,X&255]},t})});var bH=io(k5=>{k5.read=function(t,e,r,i,n){var o,a,c=n*8-i-1,h=(1<<c)-1,p=h>>1,x=-7,T=r?n-1:0,R=r?-1:1,k=t[e+T];for(T+=R,o=k&(1<<-x)-1,k>>=-x,x+=c;x>0;o=o*256+t[e+T],T+=R,x-=8);for(a=o&(1<<-x)-1,o>>=-x,x+=i;x>0;a=a*256+t[e+T],T+=R,x-=8);if(o===0)o=1-p;else{if(o===h)return a?NaN:(k?-1:1)*(1/0);a=a+Math.pow(2,i),o=o-p}return(k?-1:1)*a*Math.pow(2,o-i)};k5.write=function(t,e,r,i,n,o){var a,c,h,p=o*8-n-1,x=(1<<p)-1,T=x>>1,R=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=i?0:o-1,j=i?1:-1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,a=x):(a=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-a))<1&&(a--,h*=2),a+T>=1?e+=R/h:e+=R*Math.pow(2,1-T),e*h>=2&&(a++,h/=2),a+T>=x?(c=0,a=x):a+T>=1?(c=(e*h-1)*Math.pow(2,n),a=a+T):(c=e*Math.pow(2,T-1)*Math.pow(2,n),a=0));n>=8;t[r+k]=c&255,k+=j,c/=256,n-=8);for(a=a<<n|c,p+=n;p>0;t[r+k]=a&255,k+=j,a/=256,p-=8);t[r+k-j]|=q*128}});var SH=io((NJe,CH)=>{"use strict";CH.exports=cn;var kT=bH();function cn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}cn.Varint=0;cn.Fixed64=1;cn.Bytes=2;cn.Fixed32=5;var N5=65536*65536,vH=1/N5,Bme=12,EH=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");cn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=i&7,t(n,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=NT(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=TH(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=NT(this.buf,this.pos)+NT(this.buf,this.pos+4)*N5;return this.pos+=8,t},readSFixed64:function(){var t=NT(this.buf,this.pos)+TH(this.buf,this.pos+4)*N5;return this.pos+=8,t},readFloat:function(){var t=kT.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=kT.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,r,i;return i=e[this.pos++],r=i&127,i<128||(i=e[this.pos++],r|=(i&127)<<7,i<128)||(i=e[this.pos++],r|=(i&127)<<14,i<128)||(i=e[this.pos++],r|=(i&127)<<21,i<128)?r:(i=e[this.pos],r|=(i&15)<<28,Lme(r,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=Bme&&EH?qme(this.buf,e,t):$me(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==cn.Bytes)return t.push(this.readVarint(e));var r=of(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==cn.Bytes)return t.push(this.readSVarint());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==cn.Bytes)return t.push(this.readBoolean());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==cn.Bytes)return t.push(this.readFloat());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==cn.Bytes)return t.push(this.readDouble());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==cn.Bytes)return t.push(this.readFixed32());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==cn.Bytes)return t.push(this.readSFixed32());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==cn.Bytes)return t.push(this.readFixed64());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==cn.Bytes)return t.push(this.readSFixed64());var e=of(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===cn.Varint)for(;this.buf[this.pos++]>127;);else if(e===cn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===cn.Fixed32)this.pos+=4;else if(e===cn.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),bg(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),bg(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),bg(this.buf,t&-1,this.pos),bg(this.buf,Math.floor(t*vH),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),bg(this.buf,t&-1,this.pos),bg(this.buf,Math.floor(t*vH),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){Ome(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=Zme(this.buf,t,this.pos);var r=this.pos-e;r>=128&&wH(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),kT.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),kT.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&wH(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,cn.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,kme,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Nme,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Vme,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,zme,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Ume,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,jme,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Gme,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Hme,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Wme,e)},writeBytesField:function(t,e){this.writeTag(t,cn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,cn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,cn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,cn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,cn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,cn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,cn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,cn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,cn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,cn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function Lme(t,e,r){var i=r.buf,n,o;if(o=i[r.pos++],n=(o&112)>>4,o<128||(o=i[r.pos++],n|=(o&127)<<3,o<128)||(o=i[r.pos++],n|=(o&127)<<10,o<128)||(o=i[r.pos++],n|=(o&127)<<17,o<128)||(o=i[r.pos++],n|=(o&127)<<24,o<128)||(o=i[r.pos++],n|=(o&1)<<31,o<128))return xg(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function of(t){return t.type===cn.Bytes?t.readVarint()+t.pos:t.pos+1}function xg(t,e,r){return r?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function Ome(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(r=~(-t%4294967296),i=~(-t/4294967296),r^4294967295?r=r+1|0:(r=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Dme(r,i,e),Fme(i,e)}function Dme(t,e,r){r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos]=t&127}function Fme(t,e){var r=(t&7)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function wH(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function kme(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Nme(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function zme(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Ume(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Vme(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function jme(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function Gme(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Hme(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Wme(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function NT(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function bg(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function TH(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function $me(t,e,r){for(var i="",n=e;n<r;){var o=t[n],a=null,c=o>239?4:o>223?3:o>191?2:1;if(n+c>r)break;var h,p,x;c===1?o<128&&(a=o):c===2?(h=t[n+1],(h&192)===128&&(a=(o&31)<<6|h&63,a<=127&&(a=null))):c===3?(h=t[n+1],p=t[n+2],(h&192)===128&&(p&192)===128&&(a=(o&15)<<12|(h&63)<<6|p&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):c===4&&(h=t[n+1],p=t[n+2],x=t[n+3],(h&192)===128&&(p&192)===128&&(x&192)===128&&(a=(o&15)<<18|(h&63)<<12|(p&63)<<6|x&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,c=1):a>65535&&(a-=65536,i+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),i+=String.fromCharCode(a),n+=c}return i}function qme(t,e,r){return EH.decode(t.subarray(e,r))}function Zme(t,e,r){for(var i=0,n,o;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(o)if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,o=n;continue}else n=o-55296<<10|n-56320|65536,o=null;else{n>56319||i+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):o=n;continue}else o&&(t[r++]=239,t[r++]=191,t[r++]=189,o=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=n&63|128)}return r}});var ZH=io((Vet,VT)=>{VT.exports.RADIUS=6378137;VT.exports.FLATTENING=1/298.257223563;VT.exports.POLAR_RADIUS=63567523142e-4});var QH=io((jet,K5)=>{var XH=ZH();K5.exports.geometry=KH;K5.exports.ring=Y5;function KH(t){var e=0,r;switch(t.type){case"Polygon":return YH(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)e+=YH(t.coordinates[r]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<t.geometries.length;r++)e+=KH(t.geometries[r]);return e}}function YH(t){var e=0;if(t&&t.length>0){e+=Math.abs(Y5(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(Y5(t[r]))}return e}function Y5(t){var e,r,i,n,o,a,c,h=0,p=t.length;if(p>2){for(c=0;c<p;c++)c===p-2?(n=p-2,o=p-1,a=0):c===p-1?(n=p-1,o=0,a=1):(n=c,o=c+1,a=c+2),e=t[n],r=t[o],i=t[a],h+=(X5(i[0])-X5(e[0]))*Math.sin(X5(r[1]));h=h*XH.RADIUS*XH.RADIUS/2}return h}function X5(t){return t*Math.PI/180}});var CW=io((Nrt,EW)=>{"use strict";EW.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var i,n,o;if(Array.isArray(e)){if(i=e.length,i!=r.length)return!1;for(n=i;n--!==0;)if(!t(e[n],r[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(o=Object.keys(e),i=o.length,i!==Object.keys(r).length)return!1;for(n=i;n--!==0;)if(!Object.prototype.hasOwnProperty.call(r,o[n]))return!1;for(n=i;n--!==0;){var a=o[n];if(!t(e[a],r[a]))return!1}return!0}return e!==e&&r!==r}});var IW=io((zrt,SW)=>{SW.exports=Jge;var Qge={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function Jge(t){if(!t||!t.type)return null;var e=Qge[t.type];if(!e)return null;if(e==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:t}]};if(e==="feature")return{type:"FeatureCollection",features:[t]};if(e==="featurecollection")return t}});var Og=yc(qE());var hC=yc(qE(),1),xq=Object.defineProperty,g6=t=>{throw TypeError(t)},bq=(t,e,r)=>e in t?xq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,br=(t,e,r)=>bq(t,typeof e!="symbol"?e+"":e,r),_6=(t,e,r)=>e.has(t)||g6("Cannot "+r),So=(t,e,r)=>(_6(t,e,"read from private field"),r?r.call(t):e.get(t)),ZE=(t,e,r)=>e.has(t)?g6("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),M2=(t,e,r,i)=>(_6(t,e,"write to private field"),i?i.call(t,r):e.set(t,r),r);function qn(){}function vq(t,e){for(let r in e)t[r]=e[r];return t}function y6(t){return t()}function VB(){return Object.create(null)}function Bh(t){t.forEach(y6)}function x6(t){return typeof t=="function"}function ed(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}var P2;function js(t,e){return t===e?!0:(P2||(P2=document.createElement("a")),P2.href=e,t===P2.href)}function wq(t){return Object.keys(t).length===0}function Tq(t,e,r,i){if(t){let n=b6(t,e,r,i);return t[0](n)}}function b6(t,e,r,i){return t[1]&&i?vq(r.ctx.slice(),t[1](i(e))):r.ctx}function Eq(t,e,r,i){return t[2],e.dirty}function Cq(t,e,r,i,n,o){if(n){let a=b6(e,r,i,o);t.p(a,n)}}function Sq(t){if(t.ctx.length>32){let e=[],r=t.ctx.length/32;for(let i=0;i<r;i++)e[i]=-1;return e}return-1}function U2(t){return t??""}function $i(t,e){t.appendChild(e)}function Zn(t,e,r){t.insertBefore(e,r||null)}function Gn(t){t.parentNode&&t.parentNode.removeChild(t)}function _n(t){return document.createElement(t)}function bc(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Qf(t){return document.createTextNode(t)}function Ka(){return Qf(" ")}function Iq(){return Qf("")}function rs(t,e,r,i){return t.addEventListener(e,r,i),()=>t.removeEventListener(e,r,i)}function Mq(t){return function(e){return e.preventDefault(),t.call(this,e)}}function Ft(t,e,r){r==null?t.removeAttribute(e):t.getAttribute(e)!==r&&t.setAttribute(e,r)}function Pq(t){return Array.from(t.childNodes)}function g_(t,e){e=""+e,t.data!==e&&(t.data=e)}function jB(t,e){t.value=e??""}function _u(t,e,r){t.classList.toggle(e,!!r)}function Rq(t,e,{bubbles:r=!1,cancelable:i=!1}={}){return new CustomEvent(t,{detail:e,bubbles:r,cancelable:i})}var __;function m_(t){__=t}function v6(){if(!__)throw new Error("Function called outside component initialization");return __}function Bq(t){v6().$$.on_destroy.push(t)}function w6(){let t=v6();return(e,r,{cancelable:i=!1}={})=>{let n=t.$$.callbacks[e];if(n){let o=Rq(e,r,{cancelable:i});return n.slice().forEach(a=>{a.call(t,o)}),!o.defaultPrevented}return!0}}function Lq(t,e){let r=t.$$.callbacks[e.type];r&&r.slice().forEach(i=>i.call(this,e))}var R0=[],QE=[],B0=[],GB=[],Oq=Promise.resolve(),JE=!1;function Dq(){JE||(JE=!0,Oq.then(T6))}function eC(t){B0.push(t)}var XE=new Set,P0=0;function T6(){if(P0!==0)return;let t=__;do{try{for(;P0<R0.length;){let e=R0[P0];P0++,m_(e),Fq(e.$$)}}catch(e){throw R0.length=0,P0=0,e}for(m_(null),R0.length=0,P0=0;QE.length;)QE.pop()();for(let e=0;e<B0.length;e+=1){let r=B0[e];XE.has(r)||(XE.add(r),r())}B0.length=0}while(R0.length);for(;GB.length;)GB.pop()();JE=!1,XE.clear(),m_(t)}function Fq(t){if(t.fragment!==null){t.update(),Bh(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(eC)}}function kq(t){let e=[],r=[];B0.forEach(i=>t.indexOf(i)===-1?e.push(i):r.push(i)),r.forEach(i=>i()),B0=e}var D2=new Set,Mp;function F2(){Mp={r:0,c:[],p:Mp}}function k2(){Mp.r||Bh(Mp.c),Mp=Mp.p}function Io(t,e){t&&t.i&&(D2.delete(t),t.i(e))}function gs(t,e,r,i){if(t&&t.o){if(D2.has(t))return;D2.add(t),Mp.c.push(()=>{D2.delete(t),i&&(r&&t.d(1),i())}),t.o(e)}else i&&i()}function HB(t){return t?.length!==void 0?t:Array.from(t)}function Nq(t,e){gs(t,1,1,()=>{e.delete(t.key)})}function zq(t,e,r,i,n,o,a,c,h,p,x,T){let R=t.length,k=o.length,j=R,q={};for(;j--;)q[t[j].key]=j;let Z=[],re=new Map,ee=new Map,se=[];for(j=k;j--;){let Je=T(n,o,j),J=r(Je),te=a.get(J);te?se.push(()=>te.p(Je,e)):(te=p(J,Je),te.c()),re.set(J,Z[j]=te),J in q&&ee.set(J,Math.abs(j-q[J]))}let me=new Set,Le=new Set;function je(Je){Io(Je,1),Je.m(c,x),a.set(Je.key,Je),x=Je.first,k--}for(;R&&k;){let Je=Z[k-1],J=t[R-1],te=Je.key,X=J.key;Je===J?(x=Je.first,R--,k--):re.has(X)?!a.has(te)||me.has(te)?je(Je):Le.has(X)?R--:ee.get(te)>ee.get(X)?(Le.add(te),je(Je)):(me.add(X),R--):(h(J,a),R--)}for(;R--;){let Je=t[R];re.has(Je.key)||h(Je,a)}for(;k;)je(Z[k-1]);return Bh(se),Z}function Jf(t){t&&t.c()}function Mh(t,e,r){let{fragment:i,after_update:n}=t.$$;i&&i.m(e,r),eC(()=>{let o=t.$$.on_mount.map(y6).filter(x6);t.$$.on_destroy?t.$$.on_destroy.push(...o):Bh(o),t.$$.on_mount=[]}),n.forEach(eC)}function Ph(t,e){let r=t.$$;r.fragment!==null&&(kq(r.after_update),Bh(r.on_destroy),r.fragment&&r.fragment.d(e),r.on_destroy=r.fragment=null,r.ctx=[])}function Uq(t,e){t.$$.dirty[0]===-1&&(R0.push(t),Dq(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function td(t,e,r,i,n,o,a=null,c=[-1]){let h=__;m_(t);let p=t.$$={fragment:null,ctx:[],props:o,update:qn,not_equal:n,bound:VB(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:VB(),dirty:c,skip_bound:!1,root:e.target||h.$$.root};a&&a(p.root);let x=!1;if(p.ctx=r?r(t,e.props||{},(T,R,...k)=>{let j=k.length?k[0]:R;return p.ctx&&n(p.ctx[T],p.ctx[T]=j)&&(!p.skip_bound&&p.bound[T]&&p.bound[T](j),x&&Uq(t,T)),R}):[],p.update(),x=!0,Bh(p.before_update),p.fragment=i?i(p.ctx):!1,e.target){if(e.hydrate){let T=Pq(e.target);p.fragment&&p.fragment.l(T),T.forEach(Gn)}else p.fragment&&p.fragment.c();e.intro&&Io(t.$$.fragment),Mh(t,e.target,e.anchor),T6()}m_(h)}var xu=class{constructor(){br(this,"$$"),br(this,"$$set")}$destroy(){Ph(this,1),this.$destroy=qn}$on(e,r){if(!x6(r))return qn;let i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(r),()=>{let n=i.indexOf(r);n!==-1&&i.splice(n,1)}}$set(e){this.$$set&&!wq(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}},Vq="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Vq);function jq(t){let e,r;return{c(){e=bc("svg"),r=bc("path"),Ft(r,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ft(e,"viewBox","0 0 14 14"),Ft(e,"width","13"),Ft(e,"height","13"),Ft(e,"class","svelte-en2qvf")},m(i,n){Zn(i,e,n),$i(e,r)},p:qn,i:qn,o:qn,d(i){i&&Gn(e)}}}var V2=class extends xu{constructor(e){super(),td(this,e,null,jq,ed,{})}};function Gq(t){let e,r;return{c(){e=bc("svg"),r=bc("path"),Ft(r,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ft(e,"viewBox","0 0 30 30"),Ft(e,"fill","none"),Ft(e,"xmlns","http://www.w3.org/2000/svg"),Ft(e,"class","svelte-d2loi5")},m(i,n){Zn(i,e,n),$i(e,r)},p:qn,i:qn,o:qn,d(i){i&&Gn(e)}}}var j2=class extends xu{constructor(e){super(),td(this,e,null,Gq,ed,{})}};function Hq(t){let e,r;return{c(){e=_n("img"),js(e.src,r=t[3]+"area.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!js(e.src,r=i[3]+"area.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function Wq(t){let e,r;return{c(){e=_n("img"),js(e.src,r=t[3]+"reverse.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!js(e.src,r=i[3]+"reverse.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function $q(t){let e,r;return{c(){e=_n("img"),js(e.src,r=t[3]+"poi.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!js(e.src,r=i[3]+"poi.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function qq(t){let e,r;return{c(){e=_n("img"),js(e.src,r=t[3]+"postal_code.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!js(e.src,r=i[3]+"postal_code.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function Zq(t){let e,r;return{c(){e=_n("img"),js(e.src,r=t[3]+"street.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!js(e.src,r=i[3]+"street.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function Xq(t){let e,r;return{c(){e=_n("img"),js(e.src,r=t[3]+"road.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!js(e.src,r=i[3]+"road.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function Yq(t){let e,r;return{c(){e=_n("img"),js(e.src,r=t[3]+"housenumber.svg")||Ft(e,"src",r),Ft(e,"alt",t[7]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(i,n){Zn(i,e,n)},p(i,n){n&8&&!js(e.src,r=i[3]+"housenumber.svg")&&Ft(e,"src",r),n&128&&Ft(e,"alt",i[7]),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function Kq(t){let e,r,i,n;return{c(){e=_n("img"),js(e.src,r=t[5])||Ft(e,"src",r),Ft(e,"alt",t[4]),Ft(e,"title",t[7]),Ft(e,"class","svelte-w9y5n9")},m(o,a){Zn(o,e,a),i||(n=rs(e,"error",t[14]),i=!0)},p(o,a){a&32&&!js(e.src,r=o[5])&&Ft(e,"src",r),a&16&&Ft(e,"alt",o[4]),a&128&&Ft(e,"title",o[7])},d(o){o&&Gn(e),i=!1,n()}}}function Qq(t){let e,r;return{c(){e=_n("div"),Ft(e,"class","sprite-icon svelte-w9y5n9"),Ft(e,"style",r=`
        width: ${t[6].width/_l}px;
        height: ${t[6].height/_l}px;
        background-image: url(${t[3]}sprite${tC}.png);
        background-position: -${t[6].x/_l}px -${t[6].y/_l}px;
        background-size: ${gu.width/_l}px ${gu.height/_l}px;
      `),Ft(e,"title",t[7])},m(i,n){Zn(i,e,n)},p(i,n){n&72&&r!==(r=`
        width: ${i[6].width/_l}px;
        height: ${i[6].height/_l}px;
        background-image: url(${i[3]}sprite${tC}.png);
        background-position: -${i[6].x/_l}px -${i[6].y/_l}px;
        background-size: ${gu.width/_l}px ${gu.height/_l}px;
      `)&&Ft(e,"style",r),n&128&&Ft(e,"title",i[7])},d(i){i&&Gn(e)}}}function WB(t){let e,r;return{c(){e=_n("span"),r=Qf(t[7]),Ft(e,"class","secondary svelte-w9y5n9")},m(i,n){Zn(i,e,n),$i(e,r)},p(i,n){n&128&&g_(r,i[7])},d(i){i&&Gn(e)}}}function Jq(t){let e,r,i,n,o,a,c,h,p,x=(t[8]?t[0].place_name:t[0].place_name.replace(/,.*/,""))+"",T,R,k=t[2]==="always"||t[2]!=="never"&&!t[0].address&&!t[0].id.startsWith("road.")&&!t[0].id.startsWith("address.")&&!t[0].id.startsWith("postal_code.")&&(!t[0].id.startsWith("poi.")||!t[5])&&!t[8],j,q,Z=(t[8]?"":t[0].place_name.replace(/[^,]*,?\s*/,""))+"",re,ee,se,me,Le,je;function Je(ye,_e){return _e&1&&(r=null),_e&1&&(i=null),_e&1&&(n=null),_e&1&&(o=null),gu&&ye[6]?Qq:ye[5]?Kq:ye[0].address?Yq:(r==null&&(r=!!ye[0].id.startsWith("road.")),r?Xq:(i==null&&(i=!!ye[0].id.startsWith("address.")),i?Zq:(n==null&&(n=!!ye[0].id.startsWith("postal_code.")),n?qq:(o==null&&(o=!!ye[0].id.startsWith("poi.")),o?$q:ye[8]?Wq:Hq))))}let J=Je(t,-1),te=J(t),X=k&&WB(t);return{c(){e=_n("li"),te.c(),a=Ka(),c=_n("span"),h=_n("span"),p=_n("span"),T=Qf(x),R=Ka(),X&&X.c(),j=Ka(),q=_n("span"),re=Qf(Z),Ft(p,"class","primary svelte-w9y5n9"),Ft(h,"class","svelte-w9y5n9"),Ft(q,"class","line2 svelte-w9y5n9"),Ft(c,"class","texts svelte-w9y5n9"),Ft(e,"tabindex","-1"),Ft(e,"role","option"),Ft(e,"aria-selected",ee=t[1]==="selected"),Ft(e,"aria-checked",se=t[1]==="picked"),Ft(e,"class",me=U2(t[1])+" svelte-w9y5n9")},m(ye,_e){Zn(ye,e,_e),te.m(e,null),$i(e,a),$i(e,c),$i(c,h),$i(h,p),$i(p,T),$i(h,R),X&&X.m(h,null),$i(c,j),$i(c,q),$i(q,re),Le||(je=[rs(e,"mouseenter",t[13]),rs(e,"focus",t[15]),rs(e,"click",t[16])],Le=!0)},p(ye,[_e]){J===(J=Je(ye,_e))&&te?te.p(ye,_e):(te.d(1),te=J(ye),te&&(te.c(),te.m(e,a))),_e&257&&x!==(x=(ye[8]?ye[0].place_name:ye[0].place_name.replace(/,.*/,""))+"")&&g_(T,x),_e&293&&(k=ye[2]==="always"||ye[2]!=="never"&&!ye[0].address&&!ye[0].id.startsWith("road.")&&!ye[0].id.startsWith("address.")&&!ye[0].id.startsWith("postal_code.")&&(!ye[0].id.startsWith("poi.")||!ye[5])&&!ye[8]),k?X?X.p(ye,_e):(X=WB(ye),X.c(),X.m(h,null)):X&&(X.d(1),X=null),_e&257&&Z!==(Z=(ye[8]?"":ye[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&g_(re,Z),_e&2&&ee!==(ee=ye[1]==="selected")&&Ft(e,"aria-selected",ee),_e&2&&se!==(se=ye[1]==="picked")&&Ft(e,"aria-checked",se),_e&2&&me!==(me=U2(ye[1])+" svelte-w9y5n9")&&Ft(e,"class",me)},i:qn,o:qn,d(ye){ye&&Gn(e),te.d(),X&&X.d(),Le=!1,Bh(je)}}}var E6=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,tC=E6?"@2x":"",_l=E6?2:1,gu,R2;function eZ(t,e,r){let i,n,o,{feature:a}=e,{style:c="default"}=e,{showPlaceType:h}=e,{missingIconsCache:p}=e,{iconsBaseUrl:x}=e,T=w6(),R,k,j,q;function Z(){R2??(R2=fetch(`${x}sprite${tC}.json`).then(J=>J.json()).then(J=>{gu=J}).catch(()=>{gu=null}))}function re(){k&&p.add(k),ee()}function ee(){gu!==void 0?se():(Z(),R2?.then(se))}function se(){do{if(q--,r(4,R=i?.[q]),r(6,j=R?gu?.icons[R]:void 0),j)break;r(5,k=R?x+R.replace(/ /g,"_")+".svg":void 0)}while(q>-1&&(!k||p.has(k)))}function me(J){Lq.call(this,t,J)}let Le=()=>re(),je=()=>T("select",void 0),Je=J=>{document.activeElement!==J.target&&T("select",void 0)};return t.$$set=J=>{"feature"in J&&r(0,a=J.feature),"style"in J&&r(1,c=J.style),"showPlaceType"in J&&r(2,h=J.showPlaceType),"missingIconsCache"in J&&r(11,p=J.missingIconsCache),"iconsBaseUrl"in J&&r(3,x=J.iconsBaseUrl)},t.$$.update=()=>{var J,te,X,ye,_e;t.$$.dirty&1&&r(12,i=(J=a.properties)==null?void 0:J.categories),t.$$.dirty&1&&r(8,n=a.place_type[0]==="reverse"),t.$$.dirty&1&&r(7,o=((X=(te=a.properties)==null?void 0:te.categories)==null?void 0:X.join(", "))??((_e=(ye=a.properties)==null?void 0:ye.place_type_name)==null?void 0:_e[0])??a.place_type[0]),t.$$.dirty&4096&&(q=i?.length??0,ee())},[a,c,h,x,R,k,j,o,n,T,re,p,i,me,Le,je,Je]}var rC=class extends xu{constructor(e){super(),td(this,e,eZ,Jq,ed,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}};function tZ(t){let e;return{c(){e=_n("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ft(e,"class","svelte-7cmwmc")},m(r,i){Zn(r,e,i)},p:qn,i:qn,o:qn,d(r){r&&Gn(e)}}}var iC=class extends xu{constructor(e){super(),td(this,e,null,tZ,ed,{})}};function rZ(t){let e,r,i;return{c(){e=bc("svg"),r=bc("path"),Ft(r,"stroke-width","4"),Ft(r,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Ft(r,"class","svelte-gzo3ar"),Ft(e,"width",i=t[0]==="list"?20:void 0),Ft(e,"viewBox","0 0 70 85"),Ft(e,"fill","none"),Ft(e,"class","svelte-gzo3ar"),_u(e,"in-map",t[0]!=="list"),_u(e,"list-icon",t[0]==="list")},m(n,o){Zn(n,e,o),$i(e,r)},p(n,[o]){o&1&&i!==(i=n[0]==="list"?20:void 0)&&Ft(e,"width",i),o&1&&_u(e,"in-map",n[0]!=="list"),o&1&&_u(e,"list-icon",n[0]==="list")},i:qn,o:qn,d(n){n&&Gn(e)}}}function iZ(t,e,r){let{displayIn:i}=e;return t.$$set=n=>{"displayIn"in n&&r(0,i=n.displayIn)},[i]}var nC=class extends xu{constructor(e){super(),td(this,e,iZ,rZ,ed,{displayIn:0})}};function nZ(t){let e,r;return{c(){e=bc("svg"),r=bc("path"),Ft(r,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ft(e,"viewBox","0 0 60.006 21.412"),Ft(e,"width","14"),Ft(e,"height","20"),Ft(e,"class","svelte-en2qvf")},m(i,n){Zn(i,e,n),$i(e,r)},p:qn,i:qn,o:qn,d(i){i&&Gn(e)}}}var oC=class extends xu{constructor(e){super(),td(this,e,null,nZ,ed,{})}};function oZ(t){let e,r,i;return{c(){e=bc("svg"),r=bc("circle"),i=bc("path"),Ft(r,"cx","4.789"),Ft(r,"cy","4.787"),Ft(r,"r","3.85"),Ft(r,"class","svelte-1aq105l"),Ft(i,"d","M12.063 12.063 7.635 7.635"),Ft(i,"class","svelte-1aq105l"),Ft(e,"xmlns","http://www.w3.org/2000/svg"),Ft(e,"width","13"),Ft(e,"height","13"),Ft(e,"viewBox","0 0 13 13"),Ft(e,"class","svelte-1aq105l")},m(n,o){Zn(n,e,o),$i(e,r),$i(e,i)},p:qn,i:qn,o:qn,d(n){n&&Gn(e)}}}var sC=class extends xu{constructor(e){super(),td(this,e,null,oZ,ed,{})}};function sZ(t,e,r){let i=e[1],n=e[0],o=i-n;return t===i&&r?t:((t-n)%o+o)%o+n}function G2(t){let e=[...t];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}var u_;async function aZ(t,e,r){let i=t?.getCenterAndZoom();for(let n of e??[])if(!(i&&(n.minZoom!=null&&n.minZoom>i[0]||n.maxZoom!=null&&n.maxZoom<i[0]))){if(n.type==="fixed")return n.coordinates.join(",");e:if(n.type==="client-geolocation"){if(u_&&n.cachedLocationExpiry&&u_.time+n.cachedLocationExpiry>Date.now()){if(!u_.coords)break e;return u_.coords}let o;try{return o=await new Promise((a,c)=>{r.signal.addEventListener("abort",()=>{c(Error("aborted"))}),navigator.geolocation.getCurrentPosition(h=>{a([h.coords.longitude,h.coords.latitude].map(p=>p.toFixed(6)).join(","))},h=>{c(h)},n)}),o}catch{}finally{n.cachedLocationExpiry&&(u_={time:Date.now(),coords:o})}if(r.signal.aborted)return}if(n.type==="server-geolocation")return"ip";if(i&&n.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}var lZ=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,$B=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,qB=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,ZB=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,XB=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,YB=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function cZ(t){if(!["DMS","DM","DD"].includes(t))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){let e=this.decimalCoordinates.split(",").map(k=>Number(k.trim())),r=Number(e[0]),i=Number(e[1]),n=Math.abs(r),o=Math.abs(i),a=r>0?"N":"S",c=i>0?"E":"W",h;t=="DD"&&(h=`${n}\xB0 ${a}, ${o}\xB0 ${c}`);let p=Math.floor(n),x=Math.floor(o),T=(n-p)*60,R=(o-x)*60;if(t=="DM"){let k=KB(T,3).toFixed(3).padStart(6,"0"),j=KB(R,3).toFixed(3).padStart(6,"0");k.endsWith(".000")&&j.endsWith(".000")&&(k=k.replace(/\.000$/,""),j=j.replace(/\.000$/,"")),h=`${p}\xB0 ${k}' ${a}, ${x}\xB0 ${j}' ${c}`}if(t=="DMS"){let k=Math.floor(T),j=Math.floor(R),q=((T-k)*60).toFixed(1).padStart(4,"0"),Z=((R-j)*60).toFixed(1).padStart(4,"0"),re=k.toString().padStart(2,"0"),ee=j.toString().padStart(2,"0");q.endsWith(".0")&&Z.endsWith(".0")&&(q=q.replace(/\.0$/,""),Z=Z.replace(/\.0$/,"")),h=`${p}\xB0 ${re}' ${q}" ${a}, ${x}\xB0 ${ee}' ${Z}" ${c}`}return h}else throw new Error("no decimal coordinates to convert")}function KB(t,e){let r=Math.pow(10,e);return Math.round((t+Number.EPSILON)*r)/r}function fC(t,e){e||(e=5),t=t.replace(/\s+/g," ").trim();let r=null,i=null,n="",o="",a=null,c=[],h=!1;if(lZ.test(t))throw new Error("invalid coordinate value");if($B.test(t))if(c=$B.exec(t),h=h_(c),h)r=Math.abs(c[1])+c[2]/60,Number(c[1])<0&&(r*=-1),i=Math.abs(c[3])+c[4]/60,Number(c[3])<0&&(i*=-1),a="DM";else throw new Error("invalid coordinate format");else if(qB.test(t))if(c=qB.exec(t),h=h_(c),h){if(r=c[2],i=c[6],r.includes(",")&&(r=r.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),a="DD",Number(Math.round(r))==Number(r))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");c[1]?(n=c[1],o=c[5]):c[4]&&(n=c[4],o=c[8])}else throw new Error("invalid decimal coordinate format");else if(ZB.test(t))if(c=ZB.exec(t),h=h_(c),h)r=Math.abs(parseInt(c[2])),c[4]&&(r+=c[4]/60,a="DM"),c[6]&&(r+=c[6].replace(",",".")/3600,a="DMS"),parseInt(c[2])<0&&(r=-1*r),i=Math.abs(parseInt(c[9])),c[11]&&(i+=c[11]/60),c[13]&&(i+=c[13].replace(",",".")/3600),parseInt(c[9])<0&&(i=-1*i),c[1]?(n=c[1],o=c[8]):c[7]&&(n=c[7],o=c[14]);else throw new Error("invalid DMS coordinates format");else if(XB.test(t))if(c=XB.exec(t),h=h_(c),h)r=Math.abs(parseInt(c[2])),c[4]&&(r+=c[4]/60,a="DM"),c[6]&&(r+=c[6]/3600,a="DMS"),parseInt(c[2])<0&&(r=-1*r),i=Math.abs(parseInt(c[10])),c[12]&&(i+=c[12]/60),c[14]&&(i+=c[14]/3600),parseInt(c[10])<0&&(i=-1*i),c[1]?(n=c[1],o=c[9]):c[8]&&(n=c[8],o=c[16]);else throw new Error("invalid DMS coordinates format");else if(YB.test(t)){if(c=YB.exec(t),h=h_(c),c.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(h)r=Math.abs(parseInt(c[2])),c[4]&&(r+=c[4].replace(",",".")/60,a="DM"),c[6]&&(r+=c[6].replace(",",".")/3600,a="DMS"),parseInt(c[2])<0&&(r=-1*r),i=Math.abs(parseInt(c[10])),c[12]&&(i+=c[12].replace(",",".")/60),c[14]&&(i+=c[14].replace(",",".")/3600),parseInt(c[10])<0&&(i=-1*i),c[1]?(n=c[1],o=c[9]):c[8]&&(n=c[8],o=c[16]);else throw new Error("invalid coordinates format")}if(h){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(r)>=90)throw new Error("invalid latitude value");if(n&&!o||!n&&o)throw new Error("invalid coordinates value");if(n&&n==o)throw new Error("invalid coordinates format");r.toString().includes(",")&&(r=r.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let p=/S|SOUTH/i;p.test(n)&&r>0&&(r=-1*r),p=/W|WEST/i,p.test(o)&&i>0&&(i=-1*i);let x=c[0].trim(),T,R,k=/[,/;\u0020]/g,j=x.match(k);if(j==null){let re=Math.floor(t.length/2);T=x.substring(0,re).trim(),R=x.substring(re).trim()}else{let re;j.length%2==1?re=Math.floor(j.length/2):re=j.length/2-1;let ee=0;if(re==0)ee=x.indexOf(j[0]),T=x.substring(0,ee).trim(),R=x.substring(ee+1).trim();else{let se=0,me=0;for(;se<=re;)ee=x.indexOf(j[se],me),me=ee+1,se++;T=x.substring(0,ee).trim(),R=x.substring(ee+1).trim()}}let q=T.split(".");if(q.length==2&&q[1]==0&&q[1].length!=2)throw new Error("invalid coordinates format");let Z=R.split(".");if(Z.length==2&&Z[1]==0&&Z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(T)||/^\d+$/.test(R))throw new Error("degree only coordinate/s provided");return r=Number(Number(r).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:x,verbatimLatitude:T,verbatimLongitude:R,decimalLatitude:r,decimalLongitude:i,decimalCoordinates:`${r},${i}`,originalFormat:a,closeEnough:uZ,toCoordinateFormat:cZ})}else throw new Error("coordinates pattern match failed")}function h_(t){if(!isNaN(t[0]))return!1;let e=[...t];if(e.shift(),e.length%2>0)return!1;let r=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,n=e.length/2;for(let o=0;o<n;o++){let a=e[o],c=e[o+n],h=r.test(a)&&r.test(c),p=i.test(a)&&i.test(c),x=a==c;if(!(a==null&&c==null)){if(a==null||c==null)return!1;if(h||p||x)continue;return!1}}return!0}function QB(t,e){let r=Math.abs(t-e);return Number(r.toFixed(6))<=1e-5}function uZ(t){if(!t)throw new Error("coords must be provided");if(t.includes(",")){let e=t.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return QB(this.decimalLatitude,Number(e[0]))&&QB(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}var hZ=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});fC.to=hZ;var fZ=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:'40\xB0 7\xB4 22.8" N 74\xB0 7\xB4 22.8" W',verbatimLatitude:'40\xB0 7\xB4 22.8" N',verbatimLongitude:'74\xB0 7\xB4 22.8" W'},{verbatimCoordinates:"40\xB0 7.38\u2019 , -74\xB0 7.38\u2019",verbatimLatitude:"40\xB0 7.38\u2019",verbatimLongitude:"-74\xB0 7.38\u2019"},{verbatimCoordinates:"N40\xB07\u201922.8\u2019\u2019, W74\xB07\u201922.8\u2019\u2019",verbatimLatitude:"N40\xB07\u201922.8\u2019\u2019",verbatimLongitude:"W74\xB07\u201922.8\u2019\u2019"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:`40\xB07'22.8"N, 74\xB07'22.8"W`,verbatimLatitude:`40\xB07'22.8"N`,verbatimLongitude:`74\xB07'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0,-74.123\xB0",verbatimLatitude:"40.123\xB0",verbatimLongitude:"-74.123\xB0"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40\xB07\u201923"N 74\xB07\u201923"W',verbatimLatitude:'40\xB07\u201923"N',verbatimLongitude:'74\xB07\u201923"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40\xB07\u201923"S 74\xB07\u201923"E',verbatimLatitude:'40\xB07\u201923"S',verbatimLongitude:'74\xB07\u201923"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40\xB07\u201923" -74\xB07\u201923"',verbatimLatitude:'40\xB07\u201923"',verbatimLongitude:'-74\xB07\u201923"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7\u2019 23" N 74d 7\u2019 23" W',verbatimLatitude:'40d 7\u2019 23" N',verbatimLongitude:'74d 7\u2019 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],dZ={decimalLatitude:40.123,decimalLongitude:-74.123},pZ=[{verbatimCoordinates:`50\xB04'17.698"south, 14\xB024'2.826"east`,verbatimLatitude:`50\xB04'17.698"south`,verbatimLongitude:`14\xB024'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40\xB026\u203247\u2033N 79\xB058\u203236\u2033W",verbatimLatitude:"40\xB026\u203247\u2033N",verbatimLongitude:"79\xB058\u203236\u2033W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26\u2032 47\u2033 N 79d 58\u2032 36\u2033 W",verbatimLatitude:"40d 26\u2032 47\u2033 N",verbatimLongitude:"79d 58\u2032 36\u2033 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195\xB0 79,948862\xB0",verbatimLatitude:"40,446195\xB0",verbatimLongitude:"79,948862\xB0",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40\xB0 26.7717, -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18\xB024S 22\xB045E",verbatimLatitude:"18\xB024S",verbatimLongitude:"22\xB045E",decimalLatitude:-18.4,decimalLongitude:22.75}],AZ=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245\xB0 S / 28.2344\xB0 E",verbatimLatitude:"-23.3245\xB0 S",verbatimLongitude:"28.2344\xB0 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40\xB0 26.7717 -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 \xB0  E22.45634 \xB0",verbatimLatitude:"S23.43563 \xB0",verbatimLongitude:"E22.45634 \xB0",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372\xB0 S 23,07771\xB0 E",verbatimLatitude:"27,71372\xB0 S",verbatimLongitude:"23,07771\xB0 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48\xB0 30,6410', E 18\xB0 57,4583'",verbatimLatitude:"N 48\xB0 30,6410'",verbatimLongitude:"E 18\xB0 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function mZ(){let t=[];return fZ.forEach(e=>{e.decimalLatitude?t.push(e):t.push({...e,...dZ})}),[...t,...pZ,...AZ]}var gZ=mZ();fC.formats=gZ.map(t=>t.verbatimCoordinates);var _Z=fC;function JB(t,e,r){let i=t.slice();return i[97]=e[r],i[99]=r,i}function e6(t){let e,r;return e=new iC({}),{c(){Jf(e.$$.fragment)},m(i,n){Mh(e,i,n),r=!0},i(i){r||(Io(e.$$.fragment,i),r=!0)},o(i){gs(e.$$.fragment,i),r=!1},d(i){Ph(e,i)}}}function t6(t){let e,r,i,n,o;return r=new oC({}),{c(){e=_n("button"),Jf(r.$$.fragment),Ft(e,"type","button"),Ft(e,"title",t[10]),Ft(e,"class","svelte-bz0zu3"),_u(e,"active",t[0])},m(a,c){Zn(a,e,c),Mh(r,e,null),i=!0,n||(o=rs(e,"click",t[79]),n=!0)},p(a,c){(!i||c[0]&1024)&&Ft(e,"title",a[10]),(!i||c[0]&1)&&_u(e,"active",a[0])},i(a){i||(Io(r.$$.fragment,a),i=!0)},o(a){gs(r.$$.fragment,a),i=!1},d(a){a&&Gn(e),Ph(r),n=!1,o()}}}function yZ(t){let e,r=[],i=new Map,n,o,a,c=HB(t[13]),h=p=>p[97].id+(p[97].address?","+p[97].address:"");for(let p=0;p<c.length;p+=1){let x=JB(t,c,p),T=h(x);i.set(T,r[p]=r6(T,x))}return{c(){e=_n("ul");for(let p=0;p<r.length;p+=1)r[p].c();Ft(e,"class","options svelte-bz0zu3"),Ft(e,"role","listbox")},m(p,x){Zn(p,e,x);for(let T=0;T<r.length;T+=1)r[T]&&r[T].m(e,null);n=!0,o||(a=[rs(e,"mouseleave",t[27]),rs(e,"blur",t[83]),rs(e,"keydown",t[23])],o=!0)},p(p,x){x[0]&102823936&&(c=HB(p[13]),F2(),r=zq(r,x,h,1,p,c,i,e,Nq,r6,null,JB),k2())},i(p){if(!n){for(let x=0;x<c.length;x+=1)Io(r[x]);n=!0}},o(p){for(let x=0;x<r.length;x+=1)gs(r[x]);n=!1},d(p){p&&Gn(e);for(let x=0;x<r.length;x+=1)r[x].d();o=!1,Bh(a)}}}function xZ(t){let e,r,i,n,o,a;return r=new j2({}),{c(){e=_n("div"),Jf(r.$$.fragment),i=Ka(),n=_n("div"),o=Qf(t[8]),Ft(n,"class","svelte-bz0zu3"),Ft(e,"class","no-results svelte-bz0zu3")},m(c,h){Zn(c,e,h),Mh(r,e,null),$i(e,i),$i(e,n),$i(n,o),a=!0},p(c,h){(!a||h[0]&256)&&g_(o,c[8])},i(c){a||(Io(r.$$.fragment,c),a=!0)},o(c){gs(r.$$.fragment,c),a=!1},d(c){c&&Gn(e),Ph(r)}}}function bZ(t){let e="",r;return{c(){r=Qf(e)},m(i,n){Zn(i,r,n)},p:qn,i:qn,o:qn,d(i){i&&Gn(r)}}}function vZ(t){let e,r,i,n,o,a,c,h,p,x,T;return r=new j2({}),h=new V2({}),{c(){e=_n("div"),Jf(r.$$.fragment),i=Ka(),n=_n("div"),o=Qf(t[7]),a=Ka(),c=_n("button"),Jf(h.$$.fragment),Ft(n,"class","svelte-bz0zu3"),Ft(c,"class","svelte-bz0zu3"),Ft(e,"class","error svelte-bz0zu3")},m(R,k){Zn(R,e,k),Mh(r,e,null),$i(e,i),$i(e,n),$i(n,o),$i(e,a),$i(e,c),Mh(h,c,null),p=!0,x||(T=rs(c,"click",t[80]),x=!0)},p(R,k){(!p||k[0]&128)&&g_(o,R[7])},i(R){p||(Io(r.$$.fragment,R),Io(h.$$.fragment,R),p=!0)},o(R){gs(r.$$.fragment,R),gs(h.$$.fragment,R),p=!1},d(R){R&&Gn(e),Ph(r),Ph(h),x=!1,T()}}}function r6(t,e){var r;let i,n,o;function a(){return e[81](e[99])}function c(){return e[82](e[97])}return n=new rC({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((r=e[14])==null?void 0:r.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),n.$on("mouseenter",a),n.$on("select",c),{key:t,first:null,c(){i=Iq(),Jf(n.$$.fragment),this.first=i},m(h,p){Zn(h,i,p),Mh(n,h,p),o=!0},p(h,p){var x;e=h;let T={};p[0]&8192&&(T.feature=e[97]),p[0]&2048&&(T.showPlaceType=e[11]),p[0]&57344&&(T.style=e[15]===e[99]?"selected":((x=e[14])==null?void 0:x.id)===e[97].id?"picked":"default"),p[0]&4096&&(T.iconsBaseUrl=e[12]),n.$set(T)},i(h){o||(Io(n.$$.fragment,h),o=!0)},o(h){gs(n.$$.fragment,h),o=!1},d(h){h&&Gn(i),Ph(n,h)}}}function wZ(t){let e,r,i,n,o,a,c,h,p,x,T,R,k,j,q,Z,re,ee,se,me,Le,je=!1;o=new sC({}),T=new V2({});let Je=t[20]&&e6(),J=t[6]==="button"&&t6(t),te=t[70].default,X=Tq(te,t,t[69],null),ye=[vZ,bZ,xZ,yZ],_e=[];function Oe(ve,De){var Xe,rt;return ve[19]?0:!ve[16]&&!ve[4]?1:((Xe=ve[13])==null?void 0:Xe.length)===0?2:(rt=ve[13])!=null&&rt.length&&(ve[16]||ve[4])?3:-1}return~(Z=Oe(t))&&(re=_e[Z]=ye[Z](t)),{c(){e=Ka(),r=_n("form"),i=_n("div"),n=_n("button"),Jf(o.$$.fragment),a=Ka(),c=_n("input"),h=Ka(),p=_n("div"),x=_n("button"),Jf(T.$$.fragment),R=Ka(),Je&&Je.c(),k=Ka(),J&&J.c(),j=Ka(),X&&X.c(),q=Ka(),re&&re.c(),Ft(n,"class","search-button svelte-bz0zu3"),Ft(n,"type","button"),Ft(c,"placeholder",t[9]),Ft(c,"aria-label",t[9]),Ft(c,"class","svelte-bz0zu3"),Ft(x,"type","button"),Ft(x,"title",t[3]),Ft(x,"class","svelte-bz0zu3"),Ft(p,"class","clear-button-container svelte-bz0zu3"),_u(p,"displayable",t[1]!==""),Ft(i,"class","input-group svelte-bz0zu3"),Ft(r,"class",ee=U2(t[2])+" svelte-bz0zu3"),_u(r,"can-collapse",t[5]&&t[1]==="")},m(ve,De){Zn(ve,e,De),Zn(ve,r,De),$i(r,i),$i(i,n),Mh(o,n,null),$i(i,a),$i(i,c),t[72](c),jB(c,t[1]),$i(i,h),$i(i,p),$i(p,x),Mh(T,x,null),$i(p,R),Je&&Je.m(p,null),$i(i,k),J&&J.m(i,null),$i(i,j),X&&X.m(i,null),$i(r,q),~Z&&_e[Z].m(r,null),se=!0,me||(Le=[rs(n,"click",t[71]),rs(c,"input",t[73]),rs(c,"focus",t[74]),rs(c,"blur",t[75]),rs(c,"click",t[76]),rs(c,"keydown",t[23]),rs(c,"input",t[24]),rs(c,"change",t[77]),rs(x,"click",t[78]),rs(r,"submit",Mq(t[22]))],me=!0)},p(ve,De){(!se||De[0]&512)&&Ft(c,"placeholder",ve[9]),(!se||De[0]&512)&&Ft(c,"aria-label",ve[9]),De[0]&2&&c.value!==ve[1]&&jB(c,ve[1]),(!se||De[0]&8)&&Ft(x,"title",ve[3]),ve[20]?Je?De[0]&1048576&&Io(Je,1):(Je=e6(),Je.c(),Io(Je,1),Je.m(p,null)):Je&&(F2(),gs(Je,1,1,()=>{Je=null}),k2()),(!se||De[0]&2)&&_u(p,"displayable",ve[1]!==""),ve[6]==="button"?J?(J.p(ve,De),De[0]&64&&Io(J,1)):(J=t6(ve),J.c(),Io(J,1),J.m(i,j)):J&&(F2(),gs(J,1,1,()=>{J=null}),k2()),X&&X.p&&(!se||De[2]&128)&&Cq(X,te,ve,ve[69],se?Eq(te,ve[69],De,null):Sq(ve[69]),null);let Xe=Z;Z=Oe(ve),Z===Xe?~Z&&_e[Z].p(ve,De):(re&&(F2(),gs(_e[Xe],1,1,()=>{_e[Xe]=null}),k2()),~Z?(re=_e[Z],re?re.p(ve,De):(re=_e[Z]=ye[Z](ve),re.c()),Io(re,1),re.m(r,null)):re=null),(!se||De[0]&4&&ee!==(ee=U2(ve[2])+" svelte-bz0zu3"))&&Ft(r,"class",ee),(!se||De[0]&38)&&_u(r,"can-collapse",ve[5]&&ve[1]==="")},i(ve){se||(Io(je),Io(o.$$.fragment,ve),Io(T.$$.fragment,ve),Io(Je),Io(J),Io(X,ve),Io(re),se=!0)},o(ve){gs(je),gs(o.$$.fragment,ve),gs(T.$$.fragment,ve),gs(Je),gs(J),gs(X,ve),gs(re),se=!1},d(ve){ve&&(Gn(e),Gn(r)),Ph(o),t[72](null),Ph(T),Je&&Je.d(),J&&J.d(),X&&X.d(ve),~Z&&_e[Z].d(),me=!1,Bh(Le)}}}function TZ(t,e,r){let i,n,o,{$$slots:a={},$$scope:c}=e,h={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13},{class:p=void 0}=e,{apiKey:x}=e,{bbox:T=void 0}=e,{clearButtonTitle:R="clear"}=e,{clearOnBlur:k=!1}=e,{clearListOnPick:j=!1}=e,{keepListOpen:q=!1}=e,{collapsed:Z=!1}=e,{country:re=void 0}=e,{debounceSearch:ee=200}=e,{enableReverse:se="never"}=e,{errorMessage:me="Something went wrong\u2026"}=e,{filter:Le=()=>!0}=e,{flyTo:je=!0}=e,{fuzzyMatch:Je=!0}=e,{language:J=void 0}=e,{limit:te=void 0}=e,X=41415112612,{reverseGeocodingLimit:ye=X}=e,{mapController:_e=void 0}=e,{minLength:Oe=2}=e,{noResultsMessage:ve="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:De="Search"}=e,{proximity:Xe=[{type:"server-geolocation"}]}=e,{reverseActive:rt=se==="always"}=e,{reverseButtonTitle:tt="toggle reverse geocoding"}=e,{searchValue:yt=""}=e,{pickedResultStyle:Xt="full-geometry"}=e,{showPlaceType:jt="if-needed"}=e,{showResultsWhileTyping:fr=!0}=e,{selectFirst:qt=!0}=e,{flyToSelected:Ot=!1}=e,{markerOnSelected:Tr=!0}=e,{types:Or=void 0}=e,Dr=[],{reverseGeocodingTypes:Xr=Dr}=e,{exhaustiveReverseGeocoding:ki=!1}=e,{excludeTypes:ei=!1}=e,Oi=void 0,{reverseGeocodingExcludeTypes:ui=Oi}=e,{zoom:tn=h}=e,{apiUrl:Ni="https://api.maptiler.com/geocoding"}=e,{fetchParameters:si={}}=e,{iconsBaseUrl:Es="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.6/icons/"}=e,{adjustUrlQuery:Zo=()=>{}}=e,{adjustUrl:co=()=>{}}=e;function Xo(Ct){ai.focus(Ct)}function Aa(){ai.blur()}function xo(Ct,Yr=!0,ii=!1){r(1,yt=Ct),Yr?(r(15,Mr=-1),Ke()):(nr(void 0,!ii,ii),setTimeout(()=>{ai.focus(),ai.select()}))}function as(){r(13,jr=void 0),r(14,kt=void 0),r(15,Mr=-1)}function bo(){r(64,Jt=[]),r(14,kt=void 0)}let jr,Jt,kt,Er="",ai,Mr=-1,Xi,uo=[],zn,st,de,ge,ce=!1,ze=new Set,Ye=w6();Bq(()=>{_e&&(_e.setEventHandler(void 0),_e.indicateReverse(!1),_e.setSelectedMarker(-1),_e.setFeatures(void 0,void 0,!1))});function Ke(Ct){if(r(17,ce=!1),st&&(clearTimeout(st),st=void 0),Mr>-1&&jr)r(14,kt=jr[Mr]),r(1,yt=kt.place_type[0]==="reverse"?kt.place_name:kt.place_name.replace(/,.*/,"")),r(19,Xi=void 0),r(64,Jt=void 0),r(15,Mr=-1);else if(yt){let Yr=Ct||!dt(yt);it(yt,{exact:!0}).then(()=>{r(64,Jt=jr),r(14,kt=void 0),Yr&&Bt()}).catch(ii=>r(19,Xi=ii))}}function dt(Ct){try{return _Z(Ct,6)}catch{return!1}}async function it(Ct,{byId:Yr=!1,exact:ii=!1}={}){var Yo,Qn,Cs;r(19,Xi=void 0),zn?.abort();let ho=new AbortController;r(20,zn=ho);try{let wi=dt(Ct),Wl=new URL(Ni+"/"+encodeURIComponent(wi?wi.decimalLongitude+","+wi.decimalLatitude:Ct)+".json"),ls=Wl.searchParams;J!==void 0&&ls.set("language",Array.isArray(J)?J.join(","):J??"");let[nh]=_e?.getCenterAndZoom()??[],cs=(Yo=!wi||Xr===Dr?Or:Xr)==null?void 0:Yo.map(Jn=>typeof Jn=="string"?Jn:nh===void 0||(Jn[0]??0)<=nh&&nh<(Jn[1]??1/0)?Jn[2]:void 0).filter(Jn=>Jn!==void 0);cs&&(cs=[...new Set(cs)],ls.set("types",cs.join(",")));let af=!wi||ui===Oi?ei:ui;if(af&&ls.set("excludeTypes",String(af)),T&&ls.set("bbox",T.map(Jn=>Jn.toFixed(6)).join(",")),re&&ls.set("country",Array.isArray(re)?re.join(","):re),!Yr&&!wi){let Jn=await aZ(_e,Xe,ho);Jn&&ls.set("proximity",Jn),(ii||!fr)&&ls.set("autocomplete","false"),ls.set("fuzzyMatch",String(Je))}let $c=ye===X?te:ye;$c!==void 0&&$c>1&&cs?.length!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),wi?($c===1||$c!==void 0&&(ki||cs?.length===1))&&ls.set("limit",String($c)):te!==void 0&&ls.set("limit",String(te)),x&&ls.set("key",x),Zo(ls),co(Wl);let Gd=Wl.searchParams.get("types")===""&&Wl.searchParams.get("excludeTypes")!=="true",Fa=Wl.toString();if(Fa===Er){Yr?(j&&r(13,jr=void 0),r(14,kt=uo[0])):(r(13,jr=uo),((Qn=jr[Mr])==null?void 0:Qn.id)!==n?.id&&r(15,Mr=-1));return}Er=Fa;let $l;if(Gd)$l={type:"FeatureCollection",features:[]};else{let Jn=await fetch(Fa,{signal:ho.signal,...si});if(!Jn.ok)throw new Error(await Jn.text());$l=await Jn.json()}Ye("response",{url:Fa,featureCollection:$l}),Yr?(j&&r(13,jr=void 0),r(14,kt=$l.features[0]),uo=[kt]):(r(13,jr=$l.features.filter(Le)),wi&&jr.unshift({type:"Feature",properties:{},id:"reverse_"+wi.decimalLongitude+"_"+wi.decimalLatitude,text:wi.decimalLatitude+", "+wi.decimalLongitude,place_name:wi.decimalLatitude+", "+wi.decimalLongitude,place_type:["reverse"],center:[wi.decimalLongitude,wi.decimalLatitude],bbox:[wi.decimalLongitude,wi.decimalLatitude,wi.decimalLongitude,wi.decimalLatitude],geometry:{type:"Point",coordinates:[wi.decimalLongitude,wi.decimalLatitude]}}),uo=jr,((Cs=jr[Mr])==null?void 0:Cs.id)!==n?.id&&r(15,Mr=-1),wi&&ai.focus())}catch(wi){if(wi&&typeof wi=="object"&&"name"in wi&&wi.name==="AbortError")return;throw wi}finally{ho===zn&&r(20,zn=void 0)}}function Bt(){var Ct;if(!(Jt!=null&&Jt.length)||!je)return;let Yr=[180,90,-180,-90],ii=!Jt.some(Qn=>!Qn.matching_text),Yo;for(let Qn of Jt){let Cs=ut(Qn);if(Yo=Yo===void 0?Cs:Cs===void 0?Yo:Math.max(Yo,Cs),ii||!Qn.matching_text)for(let ho of[0,1,2,3])Yr[ho]=Math[ho<2?"min":"max"](Yr[ho],((Ct=Qn.bbox)==null?void 0:Ct[ho])??Qn.center[ho%2])}_e&&Jt.length>0&&(kt&&Yr[0]===Yr[2]&&Yr[1]===Yr[3]?_e.flyTo(kt.center,ut(kt)):_e.fitBounds(G2(Yr),50,Yo))}function Mt(){!kt||!_e||(!kt.bbox||kt.bbox[0]===kt.bbox[2]&&kt.bbox[1]===kt.bbox[3]?_e.flyTo(kt.center,ut(kt)):_e.fitBounds(G2(kt.bbox),50,ut(kt)))}function ut(Ct){var Yr;if(!Ct.bbox||Ct.bbox[0]!==Ct.bbox[2]&&Ct.bbox[1]!==Ct.bbox[3])return;let ii=Ct.id.replace(/\..*/,"");return(Array.isArray((Yr=Ct.properties)==null?void 0:Yr.categories)?Ct.properties.categories.reduce((Yo,Qn)=>{let Cs=tn[ii+"."+Qn];return Yo===void 0?Cs:Cs===void 0?Yo:Math.max(Yo,Cs)},void 0):void 0)??tn[ii]}function zt(Ct){r(0,rt=se==="always"),r(13,jr=void 0),r(14,kt=void 0),r(15,Mr=-1),xo(Ct[1].toFixed(6)+", "+sZ(Ct[0],[-180,180],!0).toFixed(6),!1,!0)}function rr(Ct){if(!jr)return;let Yr=Ct.key==="ArrowDown"?1:Ct.key==="ArrowUp"?-1:0;Yr&&(ai.focus(),r(17,ce=!0),Ct.preventDefault(),kt&&Mr===-1&&r(15,Mr=jr.findIndex(ii=>ii.id===kt?.id)),Mr===(kt||qt?0:-1)&&Yr===-1&&r(15,Mr=jr.length),r(15,Mr+=Yr),Mr>=jr.length&&r(15,Mr=-1),Mr<0&&(kt||qt)&&r(15,Mr=0))}function nr(Ct,Yr=!0,ii=!1){if(r(19,Xi=void 0),r(14,kt=void 0),r(17,ce=!0),fr||ii){if(st&&clearTimeout(st),yt.length<Oe)return;let Yo=yt;st=window.setTimeout(()=>{it(Yo).catch(Qn=>r(19,Xi=Qn))},Yr?ee:0)}else r(13,jr=void 0),r(19,Xi=void 0)}function We(Ct){kt&&kt?.id===Ct?.id?Mt():(r(14,kt=Ct),r(1,yt=Ct.place_name))}function Fr(Ct){r(15,Mr=Ct)}function Cr(){(!qt||kt)&&r(15,Mr=-1),Ot&&Mt()}let kr=()=>ai.focus();function gi(Ct){QE[Ct?"unshift":"push"](()=>{ai=Ct,r(18,ai)})}function Gt(){yt=this.value,r(1,yt),r(17,ce),r(31,k),r(16,de)}let dr=()=>r(17,ce=!0),tr=()=>r(17,ce=!1),Ur=()=>r(17,ce=!0),xn=()=>r(14,kt=void 0),ma=()=>{r(1,yt=""),r(14,kt=void 0),ai.focus()},Pr=()=>r(0,rt=!rt),Kn=()=>r(19,Xi=void 0),rn=Ct=>Fr(Ct),ih=Ct=>We(Ct),Hl=()=>{};return t.$$set=Ct=>{"class"in Ct&&r(2,p=Ct.class),"apiKey"in Ct&&r(29,x=Ct.apiKey),"bbox"in Ct&&r(30,T=Ct.bbox),"clearButtonTitle"in Ct&&r(3,R=Ct.clearButtonTitle),"clearOnBlur"in Ct&&r(31,k=Ct.clearOnBlur),"clearListOnPick"in Ct&&r(32,j=Ct.clearListOnPick),"keepListOpen"in Ct&&r(4,q=Ct.keepListOpen),"collapsed"in Ct&&r(5,Z=Ct.collapsed),"country"in Ct&&r(33,re=Ct.country),"debounceSearch"in Ct&&r(34,ee=Ct.debounceSearch),"enableReverse"in Ct&&r(6,se=Ct.enableReverse),"errorMessage"in Ct&&r(7,me=Ct.errorMessage),"filter"in Ct&&r(35,Le=Ct.filter),"flyTo"in Ct&&r(36,je=Ct.flyTo),"fuzzyMatch"in Ct&&r(37,Je=Ct.fuzzyMatch),"language"in Ct&&r(38,J=Ct.language),"limit"in Ct&&r(39,te=Ct.limit),"reverseGeocodingLimit"in Ct&&r(40,ye=Ct.reverseGeocodingLimit),"mapController"in Ct&&r(41,_e=Ct.mapController),"minLength"in Ct&&r(42,Oe=Ct.minLength),"noResultsMessage"in Ct&&r(8,ve=Ct.noResultsMessage),"placeholder"in Ct&&r(9,De=Ct.placeholder),"proximity"in Ct&&r(43,Xe=Ct.proximity),"reverseActive"in Ct&&r(0,rt=Ct.reverseActive),"reverseButtonTitle"in Ct&&r(10,tt=Ct.reverseButtonTitle),"searchValue"in Ct&&r(1,yt=Ct.searchValue),"pickedResultStyle"in Ct&&r(44,Xt=Ct.pickedResultStyle),"showPlaceType"in Ct&&r(11,jt=Ct.showPlaceType),"showResultsWhileTyping"in Ct&&r(45,fr=Ct.showResultsWhileTyping),"selectFirst"in Ct&&r(46,qt=Ct.selectFirst),"flyToSelected"in Ct&&r(47,Ot=Ct.flyToSelected),"markerOnSelected"in Ct&&r(48,Tr=Ct.markerOnSelected),"types"in Ct&&r(49,Or=Ct.types),"reverseGeocodingTypes"in Ct&&r(50,Xr=Ct.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in Ct&&r(51,ki=Ct.exhaustiveReverseGeocoding),"excludeTypes"in Ct&&r(52,ei=Ct.excludeTypes),"reverseGeocodingExcludeTypes"in Ct&&r(53,ui=Ct.reverseGeocodingExcludeTypes),"zoom"in Ct&&r(54,tn=Ct.zoom),"apiUrl"in Ct&&r(55,Ni=Ct.apiUrl),"fetchParameters"in Ct&&r(56,si=Ct.fetchParameters),"iconsBaseUrl"in Ct&&r(12,Es=Ct.iconsBaseUrl),"adjustUrlQuery"in Ct&&r(57,Zo=Ct.adjustUrlQuery),"adjustUrl"in Ct&&r(58,co=Ct.adjustUrl),"$$scope"in Ct&&r(69,c=Ct.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&64&&r(0,rt=se==="always"),t.$$.dirty[0]&16384|t.$$.dirty[1]&8192&&Xt!=="marker-only"&&kt&&!kt.address&&kt.geometry.type==="Point"&&kt.place_type[0]!=="reverse"&&it(kt.id,{byId:!0}).catch(Ct=>r(19,Xi=Ct)),t.$$.dirty[0]&16384|t.$$.dirty[1]&1058|t.$$.dirty[2]&8&&(_e&&kt&&kt.id!==ge&&je&&(Mt(),j&&r(13,jr=void 0),r(64,Jt=void 0),r(15,Mr=-1)),r(65,ge=kt?.id)),t.$$.dirty[0]&196608|t.$$.dirty[1]&1&&setTimeout(()=>{r(16,de=ce),k&&!de&&r(1,yt="")}),t.$$.dirty[0]&8194|t.$$.dirty[1]&2048&&yt.length<Oe&&(r(13,jr=void 0),r(19,Xi=void 0),r(64,Jt=jr)),t.$$.dirty[0]&57344|t.$$.dirty[1]&32768&&qt&&jr!=null&&jr.length&&Mr==-1&&!kt&&r(15,Mr=0),t.$$.dirty[0]&8192|t.$$.dirty[2]&4&&Jt!==jr&&r(64,Jt=void 0),t.$$.dirty[0]&73729|t.$$.dirty[1]&1024|t.$$.dirty[2]&4&&_e&&_e.setEventHandler(Ct=>{switch(Ct.type){case"mapClick":rt&&zt(Ct.coordinates);break;case"markerClick":{let Yr=jr?.find(ii=>ii.id===Ct.id);Yr&&We(Yr)}break;case"markerMouseEnter":Jt&&r(15,Mr=de?jr?.findIndex(Yr=>Yr.id===Ct.id)??-1:-1);break;case"markerMouseLeave":Jt&&r(15,Mr=-1);break}}),t.$$.dirty[0]&40960&&r(66,n=jr?.[Mr]),t.$$.dirty[1]&66592|t.$$.dirty[2]&16&&_e&&n&&je&&Ot&&_e.flyTo(n.center,ut(n)),t.$$.dirty[1]&8192&&r(68,i=Xt==="full-geometry-including-polygon-center-marker"),t.$$.dirty[1]&132096|t.$$.dirty[2]&64&&(Tr||_e==null||_e.setFeatures(void 0,void 0,i)),t.$$.dirty[0]&16384|t.$$.dirty[1]&132096|t.$$.dirty[2]&84&&_e&&Tr&&!Jt&&(_e.setFeatures(n?[n]:void 0,kt,i),_e.setSelectedMarker(n?0:-1)),t.$$.dirty[0]&16384|t.$$.dirty[1]&1024|t.$$.dirty[2]&68&&_e&&_e.setFeatures(Jt,kt,i),t.$$.dirty[0]&32768|t.$$.dirty[1]&1024|t.$$.dirty[2]&4&&Jt&&_e&&_e.setSelectedMarker(Mr),t.$$.dirty[0]&2|t.$$.dirty[1]&1024&&_e){let Ct=dt(yt);_e.setReverseMarker(Ct?[Ct.decimalLongitude,Ct.decimalLatitude]:void 0)}t.$$.dirty[2]&16&&Ye("select",{feature:n}),t.$$.dirty[0]&16384&&Ye("pick",{feature:kt}),t.$$.dirty[0]&73744&&r(67,o=!!(jr!=null&&jr.length)&&(de||q)),t.$$.dirty[2]&32&&Ye("optionsvisibilitychange",{optionsVisible:o}),t.$$.dirty[0]&8192&&Ye("featureslisted",{features:jr}),t.$$.dirty[2]&4&&Ye("featuresmarked",{features:Jt}),t.$$.dirty[0]&1&&Ye("reversetoggle",{reverse:rt}),t.$$.dirty[0]&2&&Ye("querychange",{query:yt}),t.$$.dirty[0]&1|t.$$.dirty[1]&1024&&_e&&_e.indicateReverse(rt)},[rt,yt,p,R,q,Z,se,me,ve,De,tt,jt,Es,jr,kt,Mr,de,ce,ai,Xi,zn,ze,Ke,rr,nr,We,Fr,Cr,h,x,T,k,j,re,ee,Le,je,Je,J,te,ye,_e,Oe,Xe,Xt,fr,qt,Ot,Tr,Or,Xr,ki,ei,ui,tn,Ni,si,Zo,co,Xo,Aa,xo,as,bo,Jt,ge,n,o,i,c,a,kr,gi,Gt,dr,tr,Ur,xn,ma,Pr,Kn,rn,ih,Hl]}var EZ=class extends xu{constructor(t){super(),td(this,t,TZ,wZ,ed,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function y_(t,e,r={}){let i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=e||{},i.geometry=t,i}function dC(t,e,r={}){for(let i of t){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let n=0;n<i[i.length-1].length;n++)if(i[i.length-1][n]!==i[0][n])throw new Error("First and last Position are not equivalent.")}return y_({type:"Polygon",coordinates:t},e,r)}function x_(t,e={}){let r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}function C6(t,e,r={}){return y_({type:"MultiPolygon",coordinates:t},e,r)}var CZ=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,YE=Math.ceil,xl=Math.floor,Sa="[BigNumber Error] ",i6=Sa+"Number primitive has more than 15 significant digits: ",xc=1e14,fi=14,n6=9007199254740991,KE=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Kf=1e7,Ya=1e9;function S6(t){var e,r,i,n=ee.prototype={constructor:ee,toString:null,valueOf:null},o=new ee(1),a=20,c=4,h=-7,p=21,x=-1e7,T=1e7,R=!1,k=1,j=0,q={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},Z="0123456789abcdefghijklmnopqrstuvwxyz",re=!0;function ee(J,te){var X,ye,_e,Oe,ve,De,Xe,rt,tt=this;if(!(tt instanceof ee))return new ee(J,te);if(te==null){if(J&&J._isBigNumber===!0){tt.s=J.s,!J.c||J.e>T?tt.c=tt.e=null:J.e<x?tt.c=[tt.e=0]:(tt.e=J.e,tt.c=J.c.slice());return}if((De=typeof J=="number")&&J*0==0){if(tt.s=1/J<0?(J=-J,-1):1,J===~~J){for(Oe=0,ve=J;ve>=10;ve/=10,Oe++);Oe>T?tt.c=tt.e=null:(tt.e=Oe,tt.c=[J]);return}rt=String(J)}else{if(!CZ.test(rt=String(J)))return i(tt,rt,De);tt.s=rt.charCodeAt(0)==45?(rt=rt.slice(1),-1):1}(Oe=rt.indexOf("."))>-1&&(rt=rt.replace(".","")),(ve=rt.search(/e/i))>0?(Oe<0&&(Oe=ve),Oe+=+rt.slice(ve+1),rt=rt.substring(0,ve)):Oe<0&&(Oe=rt.length)}else{if(oo(te,2,Z.length,"Base"),te==10&&re)return tt=new ee(J),je(tt,a+tt.e+1,c);if(rt=String(J),De=typeof J=="number"){if(J*0!=0)return i(tt,rt,De,te);if(tt.s=1/J<0?(rt=rt.slice(1),-1):1,ee.DEBUG&&rt.replace(/^0\.0*|\./,"").length>15)throw Error(i6+J)}else tt.s=rt.charCodeAt(0)===45?(rt=rt.slice(1),-1):1;for(X=Z.slice(0,te),Oe=ve=0,Xe=rt.length;ve<Xe;ve++)if(X.indexOf(ye=rt.charAt(ve))<0){if(ye=="."){if(ve>Oe){Oe=Xe;continue}}else if(!_e&&(rt==rt.toUpperCase()&&(rt=rt.toLowerCase())||rt==rt.toLowerCase()&&(rt=rt.toUpperCase()))){_e=!0,ve=-1,Oe=0;continue}return i(tt,String(J),De,te)}De=!1,rt=r(rt,te,10,tt.s),(Oe=rt.indexOf("."))>-1?rt=rt.replace(".",""):Oe=rt.length}for(ve=0;rt.charCodeAt(ve)===48;ve++);for(Xe=rt.length;rt.charCodeAt(--Xe)===48;);if(rt=rt.slice(ve,++Xe)){if(Xe-=ve,De&&ee.DEBUG&&Xe>15&&(J>n6||J!==xl(J)))throw Error(i6+tt.s*J);if((Oe=Oe-ve-1)>T)tt.c=tt.e=null;else if(Oe<x)tt.c=[tt.e=0];else{if(tt.e=Oe,tt.c=[],ve=(Oe+1)%fi,Oe<0&&(ve+=fi),ve<Xe){for(ve&&tt.c.push(+rt.slice(0,ve)),Xe-=fi;ve<Xe;)tt.c.push(+rt.slice(ve,ve+=fi));ve=fi-(rt=rt.slice(ve)).length}else ve-=Xe;for(;ve--;rt+="0");tt.c.push(+rt)}}else tt.c=[tt.e=0]}ee.clone=S6,ee.ROUND_UP=0,ee.ROUND_DOWN=1,ee.ROUND_CEIL=2,ee.ROUND_FLOOR=3,ee.ROUND_HALF_UP=4,ee.ROUND_HALF_DOWN=5,ee.ROUND_HALF_EVEN=6,ee.ROUND_HALF_CEIL=7,ee.ROUND_HALF_FLOOR=8,ee.EUCLID=9,ee.config=ee.set=function(J){var te,X;if(J!=null)if(typeof J=="object"){if(J.hasOwnProperty(te="DECIMAL_PLACES")&&(X=J[te],oo(X,0,Ya,te),a=X),J.hasOwnProperty(te="ROUNDING_MODE")&&(X=J[te],oo(X,0,8,te),c=X),J.hasOwnProperty(te="EXPONENTIAL_AT")&&(X=J[te],X&&X.pop?(oo(X[0],-1e9,0,te),oo(X[1],0,Ya,te),h=X[0],p=X[1]):(oo(X,-1e9,Ya,te),h=-(p=X<0?-X:X))),J.hasOwnProperty(te="RANGE"))if(X=J[te],X&&X.pop)oo(X[0],-1e9,-1,te),oo(X[1],1,Ya,te),x=X[0],T=X[1];else if(oo(X,-1e9,Ya,te),X)x=-(T=X<0?-X:X);else throw Error(Sa+te+" cannot be zero: "+X);if(J.hasOwnProperty(te="CRYPTO"))if(X=J[te],X===!!X)if(X)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))R=X;else throw R=!X,Error(Sa+"crypto unavailable");else R=X;else throw Error(Sa+te+" not true or false: "+X);if(J.hasOwnProperty(te="MODULO_MODE")&&(X=J[te],oo(X,0,9,te),k=X),J.hasOwnProperty(te="POW_PRECISION")&&(X=J[te],oo(X,0,Ya,te),j=X),J.hasOwnProperty(te="FORMAT"))if(X=J[te],typeof X=="object")q=X;else throw Error(Sa+te+" not an object: "+X);if(J.hasOwnProperty(te="ALPHABET"))if(X=J[te],typeof X=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(X))re=X.slice(0,10)=="0123456789",Z=X;else throw Error(Sa+te+" invalid: "+X)}else throw Error(Sa+"Object expected: "+J);return{DECIMAL_PLACES:a,ROUNDING_MODE:c,EXPONENTIAL_AT:[h,p],RANGE:[x,T],CRYPTO:R,MODULO_MODE:k,POW_PRECISION:j,FORMAT:q,ALPHABET:Z}},ee.isBigNumber=function(J){if(!J||J._isBigNumber!==!0)return!1;if(!ee.DEBUG)return!0;var te,X,ye=J.c,_e=J.e,Oe=J.s;e:if({}.toString.call(ye)=="[object Array]"){if((Oe===1||Oe===-1)&&_e>=-1e9&&_e<=Ya&&_e===xl(_e)){if(ye[0]===0){if(_e===0&&ye.length===1)return!0;break e}if(te=(_e+1)%fi,te<1&&(te+=fi),String(ye[0]).length==te){for(te=0;te<ye.length;te++)if(X=ye[te],X<0||X>=xc||X!==xl(X))break e;if(X!==0)return!0}}}else if(ye===null&&_e===null&&(Oe===null||Oe===1||Oe===-1))return!0;throw Error(Sa+"Invalid BigNumber: "+J)},ee.maximum=ee.max=function(){return me(arguments,-1)},ee.minimum=ee.min=function(){return me(arguments,1)},ee.random=function(){var J=9007199254740992,te=Math.random()*J&2097151?function(){return xl(Math.random()*J)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(X){var ye,_e,Oe,ve,De,Xe=0,rt=[],tt=new ee(o);if(X==null?X=a:oo(X,0,Ya),ve=YE(X/fi),R)if(crypto.getRandomValues){for(ye=crypto.getRandomValues(new Uint32Array(ve*=2));Xe<ve;)De=ye[Xe]*131072+(ye[Xe+1]>>>11),De>=9e15?(_e=crypto.getRandomValues(new Uint32Array(2)),ye[Xe]=_e[0],ye[Xe+1]=_e[1]):(rt.push(De%1e14),Xe+=2);Xe=ve/2}else if(crypto.randomBytes){for(ye=crypto.randomBytes(ve*=7);Xe<ve;)De=(ye[Xe]&31)*281474976710656+ye[Xe+1]*1099511627776+ye[Xe+2]*4294967296+ye[Xe+3]*16777216+(ye[Xe+4]<<16)+(ye[Xe+5]<<8)+ye[Xe+6],De>=9e15?crypto.randomBytes(7).copy(ye,Xe):(rt.push(De%1e14),Xe+=7);Xe=ve/7}else throw R=!1,Error(Sa+"crypto unavailable");if(!R)for(;Xe<ve;)De=te(),De<9e15&&(rt[Xe++]=De%1e14);for(ve=rt[--Xe],X%=fi,ve&&X&&(De=KE[fi-X],rt[Xe]=xl(ve/De)*De);rt[Xe]===0;rt.pop(),Xe--);if(Xe<0)rt=[Oe=0];else{for(Oe=-1;rt[0]===0;rt.splice(0,1),Oe-=fi);for(Xe=1,De=rt[0];De>=10;De/=10,Xe++);Xe<fi&&(Oe-=fi-Xe)}return tt.e=Oe,tt.c=rt,tt}}(),ee.sum=function(){for(var J=1,te=arguments,X=new ee(te[0]);J<te.length;)X=X.plus(te[J++]);return X},r=function(){var J="0123456789";function te(X,ye,_e,Oe){for(var ve,De=[0],Xe,rt=0,tt=X.length;rt<tt;){for(Xe=De.length;Xe--;De[Xe]*=ye);for(De[0]+=Oe.indexOf(X.charAt(rt++)),ve=0;ve<De.length;ve++)De[ve]>_e-1&&(De[ve+1]==null&&(De[ve+1]=0),De[ve+1]+=De[ve]/_e|0,De[ve]%=_e)}return De.reverse()}return function(X,ye,_e,Oe,ve){var De,Xe,rt,tt,yt,Xt,jt,fr,qt=X.indexOf("."),Ot=a,Tr=c;for(qt>=0&&(tt=j,j=0,X=X.replace(".",""),fr=new ee(ye),Xt=fr.pow(X.length-qt),j=tt,fr.c=te(Ih(yl(Xt.c),Xt.e,"0"),10,_e,J),fr.e=fr.c.length),jt=te(X,ye,_e,ve?(De=Z,J):(De=J,Z)),rt=tt=jt.length;jt[--tt]==0;jt.pop());if(!jt[0])return De.charAt(0);if(qt<0?--rt:(Xt.c=jt,Xt.e=rt,Xt.s=Oe,Xt=e(Xt,fr,Ot,Tr,_e),jt=Xt.c,yt=Xt.r,rt=Xt.e),Xe=rt+Ot+1,qt=jt[Xe],tt=_e/2,yt=yt||Xe<0||jt[Xe+1]!=null,yt=Tr<4?(qt!=null||yt)&&(Tr==0||Tr==(Xt.s<0?3:2)):qt>tt||qt==tt&&(Tr==4||yt||Tr==6&&jt[Xe-1]&1||Tr==(Xt.s<0?8:7)),Xe<1||!jt[0])X=yt?Ih(De.charAt(1),-Ot,De.charAt(0)):De.charAt(0);else{if(jt.length=Xe,yt)for(--_e;++jt[--Xe]>_e;)jt[Xe]=0,Xe||(++rt,jt=[1].concat(jt));for(tt=jt.length;!jt[--tt];);for(qt=0,X="";qt<=tt;X+=De.charAt(jt[qt++]));X=Ih(X,rt,De.charAt(0))}return X}}(),e=function(){function J(ye,_e,Oe){var ve,De,Xe,rt,tt=0,yt=ye.length,Xt=_e%Kf,jt=_e/Kf|0;for(ye=ye.slice();yt--;)Xe=ye[yt]%Kf,rt=ye[yt]/Kf|0,ve=jt*Xe+rt*Xt,De=Xt*Xe+ve%Kf*Kf+tt,tt=(De/Oe|0)+(ve/Kf|0)+jt*rt,ye[yt]=De%Oe;return tt&&(ye=[tt].concat(ye)),ye}function te(ye,_e,Oe,ve){var De,Xe;if(Oe!=ve)Xe=Oe>ve?1:-1;else for(De=Xe=0;De<Oe;De++)if(ye[De]!=_e[De]){Xe=ye[De]>_e[De]?1:-1;break}return Xe}function X(ye,_e,Oe,ve){for(var De=0;Oe--;)ye[Oe]-=De,De=ye[Oe]<_e[Oe]?1:0,ye[Oe]=De*ve+ye[Oe]-_e[Oe];for(;!ye[0]&&ye.length>1;ye.splice(0,1));}return function(ye,_e,Oe,ve,De){var Xe,rt,tt,yt,Xt,jt,fr,qt,Ot,Tr,Or,Dr,Xr,ki,ei,Oi,ui,tn=ye.s==_e.s?1:-1,Ni=ye.c,si=_e.c;if(!Ni||!Ni[0]||!si||!si[0])return new ee(!ye.s||!_e.s||(Ni?si&&Ni[0]==si[0]:!si)?NaN:Ni&&Ni[0]==0||!si?tn*0:tn/0);for(qt=new ee(tn),Ot=qt.c=[],rt=ye.e-_e.e,tn=Oe+rt+1,De||(De=xc,rt=bl(ye.e/fi)-bl(_e.e/fi),tn=tn/fi|0),tt=0;si[tt]==(Ni[tt]||0);tt++);if(si[tt]>(Ni[tt]||0)&&rt--,tn<0)Ot.push(1),yt=!0;else{for(ki=Ni.length,Oi=si.length,tt=0,tn+=2,Xt=xl(De/(si[0]+1)),Xt>1&&(si=J(si,Xt,De),Ni=J(Ni,Xt,De),Oi=si.length,ki=Ni.length),Xr=Oi,Tr=Ni.slice(0,Oi),Or=Tr.length;Or<Oi;Tr[Or++]=0);ui=si.slice(),ui=[0].concat(ui),ei=si[0],si[1]>=De/2&&ei++;do{if(Xt=0,Xe=te(si,Tr,Oi,Or),Xe<0){if(Dr=Tr[0],Oi!=Or&&(Dr=Dr*De+(Tr[1]||0)),Xt=xl(Dr/ei),Xt>1)for(Xt>=De&&(Xt=De-1),jt=J(si,Xt,De),fr=jt.length,Or=Tr.length;te(jt,Tr,fr,Or)==1;)Xt--,X(jt,Oi<fr?ui:si,fr,De),fr=jt.length,Xe=1;else Xt==0&&(Xe=Xt=1),jt=si.slice(),fr=jt.length;if(fr<Or&&(jt=[0].concat(jt)),X(Tr,jt,Or,De),Or=Tr.length,Xe==-1)for(;te(si,Tr,Oi,Or)<1;)Xt++,X(Tr,Oi<Or?ui:si,Or,De),Or=Tr.length}else Xe===0&&(Xt++,Tr=[0]);Ot[tt++]=Xt,Tr[0]?Tr[Or++]=Ni[Xr]||0:(Tr=[Ni[Xr]],Or=1)}while((Xr++<ki||Tr[0]!=null)&&tn--);yt=Tr[0]!=null,Ot[0]||Ot.splice(0,1)}if(De==xc){for(tt=1,tn=Ot[0];tn>=10;tn/=10,tt++);je(qt,Oe+(qt.e=tt+rt*fi-1)+1,ve,yt)}else qt.e=rt,qt.r=+yt;return qt}}();function se(J,te,X,ye){var _e,Oe,ve,De,Xe;if(X==null?X=c:oo(X,0,8),!J.c)return J.toString();if(_e=J.c[0],ve=J.e,te==null)Xe=yl(J.c),Xe=ye==1||ye==2&&(ve<=h||ve>=p)?L2(Xe,ve):Ih(Xe,ve,"0");else if(J=je(new ee(J),te,X),Oe=J.e,Xe=yl(J.c),De=Xe.length,ye==1||ye==2&&(te<=Oe||Oe<=h)){for(;De<te;Xe+="0",De++);Xe=L2(Xe,Oe)}else if(te-=ve,Xe=Ih(Xe,Oe,"0"),Oe+1>De){if(--te>0)for(Xe+=".";te--;Xe+="0");}else if(te+=Oe-De,te>0)for(Oe+1==De&&(Xe+=".");te--;Xe+="0");return J.s<0&&_e?"-"+Xe:Xe}function me(J,te){for(var X,ye,_e=1,Oe=new ee(J[0]);_e<J.length;_e++)ye=new ee(J[_e]),(!ye.s||(X=Ip(Oe,ye))===te||X===0&&Oe.s===te)&&(Oe=ye);return Oe}function Le(J,te,X){for(var ye=1,_e=te.length;!te[--_e];te.pop());for(_e=te[0];_e>=10;_e/=10,ye++);return(X=ye+X*fi-1)>T?J.c=J.e=null:X<x?J.c=[J.e=0]:(J.e=X,J.c=te),J}i=function(){var J=/^(-?)0([xbo])(?=\w[\w.]*$)/i,te=/^([^.]+)\.$/,X=/^\.([^.]+)$/,ye=/^-?(Infinity|NaN)$/,_e=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Oe,ve,De,Xe){var rt,tt=De?ve:ve.replace(_e,"");if(ye.test(tt))Oe.s=isNaN(tt)?null:tt<0?-1:1;else{if(!De&&(tt=tt.replace(J,function(yt,Xt,jt){return rt=(jt=jt.toLowerCase())=="x"?16:jt=="b"?2:8,!Xe||Xe==rt?Xt:yt}),Xe&&(rt=Xe,tt=tt.replace(te,"$1").replace(X,"0.$1")),ve!=tt))return new ee(tt,rt);if(ee.DEBUG)throw Error(Sa+"Not a"+(Xe?" base "+Xe:"")+" number: "+ve);Oe.s=null}Oe.c=Oe.e=null}}();function je(J,te,X,ye){var _e,Oe,ve,De,Xe,rt,tt,yt=J.c,Xt=KE;if(yt){e:{for(_e=1,De=yt[0];De>=10;De/=10,_e++);if(Oe=te-_e,Oe<0)Oe+=fi,ve=te,Xe=yt[rt=0],tt=xl(Xe/Xt[_e-ve-1]%10);else if(rt=YE((Oe+1)/fi),rt>=yt.length)if(ye){for(;yt.length<=rt;yt.push(0));Xe=tt=0,_e=1,Oe%=fi,ve=Oe-fi+1}else break e;else{for(Xe=De=yt[rt],_e=1;De>=10;De/=10,_e++);Oe%=fi,ve=Oe-fi+_e,tt=ve<0?0:xl(Xe/Xt[_e-ve-1]%10)}if(ye=ye||te<0||yt[rt+1]!=null||(ve<0?Xe:Xe%Xt[_e-ve-1]),ye=X<4?(tt||ye)&&(X==0||X==(J.s<0?3:2)):tt>5||tt==5&&(X==4||ye||X==6&&(Oe>0?ve>0?Xe/Xt[_e-ve]:0:yt[rt-1])%10&1||X==(J.s<0?8:7)),te<1||!yt[0])return yt.length=0,ye?(te-=J.e+1,yt[0]=Xt[(fi-te%fi)%fi],J.e=-te||0):yt[0]=J.e=0,J;if(Oe==0?(yt.length=rt,De=1,rt--):(yt.length=rt+1,De=Xt[fi-Oe],yt[rt]=ve>0?xl(Xe/Xt[_e-ve]%Xt[ve])*De:0),ye)for(;;)if(rt==0){for(Oe=1,ve=yt[0];ve>=10;ve/=10,Oe++);for(ve=yt[0]+=De,De=1;ve>=10;ve/=10,De++);Oe!=De&&(J.e++,yt[0]==xc&&(yt[0]=1));break}else{if(yt[rt]+=De,yt[rt]!=xc)break;yt[rt--]=0,De=1}for(Oe=yt.length;yt[--Oe]===0;yt.pop());}J.e>T?J.c=J.e=null:J.e<x&&(J.c=[J.e=0])}return J}function Je(J){var te,X=J.e;return X===null?J.toString():(te=yl(J.c),te=X<=h||X>=p?L2(te,X):Ih(te,X,"0"),J.s<0?"-"+te:te)}return n.absoluteValue=n.abs=function(){var J=new ee(this);return J.s<0&&(J.s=1),J},n.comparedTo=function(J,te){return Ip(this,new ee(J,te))},n.decimalPlaces=n.dp=function(J,te){var X,ye,_e,Oe=this;if(J!=null)return oo(J,0,Ya),te==null?te=c:oo(te,0,8),je(new ee(Oe),J+Oe.e+1,te);if(!(X=Oe.c))return null;if(ye=((_e=X.length-1)-bl(this.e/fi))*fi,_e=X[_e])for(;_e%10==0;_e/=10,ye--);return ye<0&&(ye=0),ye},n.dividedBy=n.div=function(J,te){return e(this,new ee(J,te),a,c)},n.dividedToIntegerBy=n.idiv=function(J,te){return e(this,new ee(J,te),0,1)},n.exponentiatedBy=n.pow=function(J,te){var X,ye,_e,Oe,ve,De,Xe,rt,tt,yt=this;if(J=new ee(J),J.c&&!J.isInteger())throw Error(Sa+"Exponent not an integer: "+Je(J));if(te!=null&&(te=new ee(te)),De=J.e>14,!yt.c||!yt.c[0]||yt.c[0]==1&&!yt.e&&yt.c.length==1||!J.c||!J.c[0])return tt=new ee(Math.pow(+Je(yt),De?J.s*(2-B2(J)):+Je(J))),te?tt.mod(te):tt;if(Xe=J.s<0,te){if(te.c?!te.c[0]:!te.s)return new ee(NaN);ye=!Xe&&yt.isInteger()&&te.isInteger(),ye&&(yt=yt.mod(te))}else{if(J.e>9&&(yt.e>0||yt.e<-1||(yt.e==0?yt.c[0]>1||De&&yt.c[1]>=24e7:yt.c[0]<8e13||De&&yt.c[0]<=9999975e7)))return Oe=yt.s<0&&B2(J)?-0:0,yt.e>-1&&(Oe=1/Oe),new ee(Xe?1/Oe:Oe);j&&(Oe=YE(j/fi+2))}for(De?(X=new ee(.5),Xe&&(J.s=1),rt=B2(J)):(_e=Math.abs(+Je(J)),rt=_e%2),tt=new ee(o);;){if(rt){if(tt=tt.times(yt),!tt.c)break;Oe?tt.c.length>Oe&&(tt.c.length=Oe):ye&&(tt=tt.mod(te))}if(_e){if(_e=xl(_e/2),_e===0)break;rt=_e%2}else if(J=J.times(X),je(J,J.e+1,1),J.e>14)rt=B2(J);else{if(_e=+Je(J),_e===0)break;rt=_e%2}yt=yt.times(yt),Oe?yt.c&&yt.c.length>Oe&&(yt.c.length=Oe):ye&&(yt=yt.mod(te))}return ye?tt:(Xe&&(tt=o.div(tt)),te?tt.mod(te):Oe?je(tt,j,c,ve):tt)},n.integerValue=function(J){var te=new ee(this);return J==null?J=c:oo(J,0,8),je(te,te.e+1,J)},n.isEqualTo=n.eq=function(J,te){return Ip(this,new ee(J,te))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(J,te){return Ip(this,new ee(J,te))>0},n.isGreaterThanOrEqualTo=n.gte=function(J,te){return(te=Ip(this,new ee(J,te)))===1||te===0},n.isInteger=function(){return!!this.c&&bl(this.e/fi)>this.c.length-2},n.isLessThan=n.lt=function(J,te){return Ip(this,new ee(J,te))<0},n.isLessThanOrEqualTo=n.lte=function(J,te){return(te=Ip(this,new ee(J,te)))===-1||te===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(J,te){var X,ye,_e,Oe,ve=this,De=ve.s;if(J=new ee(J,te),te=J.s,!De||!te)return new ee(NaN);if(De!=te)return J.s=-te,ve.plus(J);var Xe=ve.e/fi,rt=J.e/fi,tt=ve.c,yt=J.c;if(!Xe||!rt){if(!tt||!yt)return tt?(J.s=-te,J):new ee(yt?ve:NaN);if(!tt[0]||!yt[0])return yt[0]?(J.s=-te,J):new ee(tt[0]?ve:c==3?-0:0)}if(Xe=bl(Xe),rt=bl(rt),tt=tt.slice(),De=Xe-rt){for((Oe=De<0)?(De=-De,_e=tt):(rt=Xe,_e=yt),_e.reverse(),te=De;te--;_e.push(0));_e.reverse()}else for(ye=(Oe=(De=tt.length)<(te=yt.length))?De:te,De=te=0;te<ye;te++)if(tt[te]!=yt[te]){Oe=tt[te]<yt[te];break}if(Oe&&(_e=tt,tt=yt,yt=_e,J.s=-J.s),te=(ye=yt.length)-(X=tt.length),te>0)for(;te--;tt[X++]=0);for(te=xc-1;ye>De;){if(tt[--ye]<yt[ye]){for(X=ye;X&&!tt[--X];tt[X]=te);--tt[X],tt[ye]+=xc}tt[ye]-=yt[ye]}for(;tt[0]==0;tt.splice(0,1),--rt);return tt[0]?Le(J,tt,rt):(J.s=c==3?-1:1,J.c=[J.e=0],J)},n.modulo=n.mod=function(J,te){var X,ye,_e=this;return J=new ee(J,te),!_e.c||!J.s||J.c&&!J.c[0]?new ee(NaN):!J.c||_e.c&&!_e.c[0]?new ee(_e):(k==9?(ye=J.s,J.s=1,X=e(_e,J,0,3),J.s=ye,X.s*=ye):X=e(_e,J,0,k),J=_e.minus(X.times(J)),!J.c[0]&&k==1&&(J.s=_e.s),J)},n.multipliedBy=n.times=function(J,te){var X,ye,_e,Oe,ve,De,Xe,rt,tt,yt,Xt,jt,fr,qt,Ot,Tr=this,Or=Tr.c,Dr=(J=new ee(J,te)).c;if(!Or||!Dr||!Or[0]||!Dr[0])return!Tr.s||!J.s||Or&&!Or[0]&&!Dr||Dr&&!Dr[0]&&!Or?J.c=J.e=J.s=null:(J.s*=Tr.s,!Or||!Dr?J.c=J.e=null:(J.c=[0],J.e=0)),J;for(ye=bl(Tr.e/fi)+bl(J.e/fi),J.s*=Tr.s,Xe=Or.length,yt=Dr.length,Xe<yt&&(fr=Or,Or=Dr,Dr=fr,_e=Xe,Xe=yt,yt=_e),_e=Xe+yt,fr=[];_e--;fr.push(0));for(qt=xc,Ot=Kf,_e=yt;--_e>=0;){for(X=0,Xt=Dr[_e]%Ot,jt=Dr[_e]/Ot|0,ve=Xe,Oe=_e+ve;Oe>_e;)rt=Or[--ve]%Ot,tt=Or[ve]/Ot|0,De=jt*rt+tt*Xt,rt=Xt*rt+De%Ot*Ot+fr[Oe]+X,X=(rt/qt|0)+(De/Ot|0)+jt*tt,fr[Oe--]=rt%qt;fr[Oe]=X}return X?++ye:fr.splice(0,1),Le(J,fr,ye)},n.negated=function(){var J=new ee(this);return J.s=-J.s||null,J},n.plus=function(J,te){var X,ye=this,_e=ye.s;if(J=new ee(J,te),te=J.s,!_e||!te)return new ee(NaN);if(_e!=te)return J.s=-te,ye.minus(J);var Oe=ye.e/fi,ve=J.e/fi,De=ye.c,Xe=J.c;if(!Oe||!ve){if(!De||!Xe)return new ee(_e/0);if(!De[0]||!Xe[0])return Xe[0]?J:new ee(De[0]?ye:_e*0)}if(Oe=bl(Oe),ve=bl(ve),De=De.slice(),_e=Oe-ve){for(_e>0?(ve=Oe,X=Xe):(_e=-_e,X=De),X.reverse();_e--;X.push(0));X.reverse()}for(_e=De.length,te=Xe.length,_e-te<0&&(X=Xe,Xe=De,De=X,te=_e),_e=0;te;)_e=(De[--te]=De[te]+Xe[te]+_e)/xc|0,De[te]=xc===De[te]?0:De[te]%xc;return _e&&(De=[_e].concat(De),++ve),Le(J,De,ve)},n.precision=n.sd=function(J,te){var X,ye,_e,Oe=this;if(J!=null&&J!==!!J)return oo(J,1,Ya),te==null?te=c:oo(te,0,8),je(new ee(Oe),J,te);if(!(X=Oe.c))return null;if(_e=X.length-1,ye=_e*fi+1,_e=X[_e]){for(;_e%10==0;_e/=10,ye--);for(_e=X[0];_e>=10;_e/=10,ye++);}return J&&Oe.e+1>ye&&(ye=Oe.e+1),ye},n.shiftedBy=function(J){return oo(J,-9007199254740991,n6),this.times("1e"+J)},n.squareRoot=n.sqrt=function(){var J,te,X,ye,_e,Oe=this,ve=Oe.c,De=Oe.s,Xe=Oe.e,rt=a+4,tt=new ee("0.5");if(De!==1||!ve||!ve[0])return new ee(!De||De<0&&(!ve||ve[0])?NaN:ve?Oe:1/0);if(De=Math.sqrt(+Je(Oe)),De==0||De==1/0?(te=yl(ve),(te.length+Xe)%2==0&&(te+="0"),De=Math.sqrt(+te),Xe=bl((Xe+1)/2)-(Xe<0||Xe%2),De==1/0?te="5e"+Xe:(te=De.toExponential(),te=te.slice(0,te.indexOf("e")+1)+Xe),X=new ee(te)):X=new ee(De+""),X.c[0]){for(Xe=X.e,De=Xe+rt,De<3&&(De=0);;)if(_e=X,X=tt.times(_e.plus(e(Oe,_e,rt,1))),yl(_e.c).slice(0,De)===(te=yl(X.c)).slice(0,De))if(X.e<Xe&&--De,te=te.slice(De-3,De+1),te=="9999"||!ye&&te=="4999"){if(!ye&&(je(_e,_e.e+a+2,0),_e.times(_e).eq(Oe))){X=_e;break}rt+=4,De+=4,ye=1}else{(!+te||!+te.slice(1)&&te.charAt(0)=="5")&&(je(X,X.e+a+2,1),J=!X.times(X).eq(Oe));break}}return je(X,X.e+a+1,c,J)},n.toExponential=function(J,te){return J!=null&&(oo(J,0,Ya),J++),se(this,J,te,1)},n.toFixed=function(J,te){return J!=null&&(oo(J,0,Ya),J=J+this.e+1),se(this,J,te)},n.toFormat=function(J,te,X){var ye,_e=this;if(X==null)J!=null&&te&&typeof te=="object"?(X=te,te=null):J&&typeof J=="object"?(X=J,J=te=null):X=q;else if(typeof X!="object")throw Error(Sa+"Argument not an object: "+X);if(ye=_e.toFixed(J,te),_e.c){var Oe,ve=ye.split("."),De=+X.groupSize,Xe=+X.secondaryGroupSize,rt=X.groupSeparator||"",tt=ve[0],yt=ve[1],Xt=_e.s<0,jt=Xt?tt.slice(1):tt,fr=jt.length;if(Xe&&(Oe=De,De=Xe,Xe=Oe,fr-=Oe),De>0&&fr>0){for(Oe=fr%De||De,tt=jt.substr(0,Oe);Oe<fr;Oe+=De)tt+=rt+jt.substr(Oe,De);Xe>0&&(tt+=rt+jt.slice(Oe)),Xt&&(tt="-"+tt)}ye=yt?tt+(X.decimalSeparator||"")+((Xe=+X.fractionGroupSize)?yt.replace(new RegExp("\\d{"+Xe+"}\\B","g"),"$&"+(X.fractionGroupSeparator||"")):yt):tt}return(X.prefix||"")+ye+(X.suffix||"")},n.toFraction=function(J){var te,X,ye,_e,Oe,ve,De,Xe,rt,tt,yt,Xt,jt=this,fr=jt.c;if(J!=null&&(De=new ee(J),!De.isInteger()&&(De.c||De.s!==1)||De.lt(o)))throw Error(Sa+"Argument "+(De.isInteger()?"out of range: ":"not an integer: ")+Je(De));if(!fr)return new ee(jt);for(te=new ee(o),rt=X=new ee(o),ye=Xe=new ee(o),Xt=yl(fr),Oe=te.e=Xt.length-jt.e-1,te.c[0]=KE[(ve=Oe%fi)<0?fi+ve:ve],J=!J||De.comparedTo(te)>0?Oe>0?te:rt:De,ve=T,T=1/0,De=new ee(Xt),Xe.c[0]=0;tt=e(De,te,0,1),_e=X.plus(tt.times(ye)),_e.comparedTo(J)!=1;)X=ye,ye=_e,rt=Xe.plus(tt.times(_e=rt)),Xe=_e,te=De.minus(tt.times(_e=te)),De=_e;return _e=e(J.minus(X),ye,0,1),Xe=Xe.plus(_e.times(rt)),X=X.plus(_e.times(ye)),Xe.s=rt.s=jt.s,Oe=Oe*2,yt=e(rt,ye,Oe,c).minus(jt).abs().comparedTo(e(Xe,X,Oe,c).minus(jt).abs())<1?[rt,ye]:[Xe,X],T=ve,yt},n.toNumber=function(){return+Je(this)},n.toPrecision=function(J,te){return J!=null&&oo(J,1,Ya),se(this,J,te,2)},n.toString=function(J){var te,X=this,ye=X.s,_e=X.e;return _e===null?ye?(te="Infinity",ye<0&&(te="-"+te)):te="NaN":(J==null?te=_e<=h||_e>=p?L2(yl(X.c),_e):Ih(yl(X.c),_e,"0"):J===10&&re?(X=je(new ee(X),a+_e+1,c),te=Ih(yl(X.c),X.e,"0")):(oo(J,2,Z.length,"Base"),te=r(Ih(yl(X.c),_e,"0"),10,J,ye,!0)),ye<0&&X.c[0]&&(te="-"+te)),te},n.valueOf=n.toJSON=function(){return Je(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,t!=null&&ee.set(t),ee}function bl(t){var e=t|0;return t>0||t===e?e:e-1}function yl(t){for(var e,r,i=1,n=t.length,o=t[0]+"";i<n;){for(e=t[i++]+"",r=fi-e.length;r--;e="0"+e);o+=e}for(n=o.length;o.charCodeAt(--n)===48;);return o.slice(0,n+1||1)}function Ip(t,e){var r,i,n=t.c,o=e.c,a=t.s,c=e.s,h=t.e,p=e.e;if(!a||!c)return null;if(r=n&&!n[0],i=o&&!o[0],r||i)return r?i?0:-c:a;if(a!=c)return a;if(r=a<0,i=h==p,!n||!o)return i?0:!n^r?1:-1;if(!i)return h>p^r?1:-1;for(c=(h=n.length)<(p=o.length)?h:p,a=0;a<c;a++)if(n[a]!=o[a])return n[a]>o[a]^r?1:-1;return h==p?0:h>p^r?1:-1}function oo(t,e,r,i){if(t<e||t>r||t!==xl(t))throw Error(Sa+(i||"Argument")+(typeof t=="number"?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function B2(t){var e=t.c.length-1;return bl(t.e/fi)==e&&t.c[e]%2!=0}function L2(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function Ih(t,e,r){var i,n;if(e<0){for(n=r+".";++e;n+=r);t=n+t}else if(i=t.length,++e>i){for(n=r,e-=i;--e;n+=r);t+=n}else e<i&&(t=t.slice(0,e)+"."+t.slice(e));return t}var yu=S6(),SZ=class{constructor(t){br(this,"key"),br(this,"left",null),br(this,"right",null),this.key=t}},f_=class extends SZ{constructor(t){super(t)}},IZ=class{constructor(){br(this,"size",0),br(this,"modificationCount",0),br(this,"splayCount",0)}splay(t){let e=this.root;if(e==null)return this.compare(t,t),-1;let r=null,i=null,n=null,o=null,a=e,c=this.compare,h;for(;;)if(h=c(a.key,t),h>0){let p=a.left;if(p==null||(h=c(p.key,t),h>0&&(a.left=p.right,p.right=a,a=p,p=a.left,p==null)))break;r==null?i=a:r.left=a,r=a,a=p}else if(h<0){let p=a.right;if(p==null||(h=c(p.key,t),h<0&&(a.right=p.left,p.left=a,a=p,p=a.right,p==null)))break;n==null?o=a:n.right=a,n=a,a=p}else break;return n!=null&&(n.right=a.left,a.left=o),r!=null&&(r.left=a.right,a.right=i),this.root!==a&&(this.root=a,this.splayCount++),h}splayMin(t){let e=t,r=e.left;for(;r!=null;){let i=r;e.left=i.right,i.right=e,e=i,r=e.left}return e}splayMax(t){let e=t,r=e.right;for(;r!=null;){let i=r;e.right=i.left,i.left=e,e=i,r=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let e=this.root,r=e,i=e.left;if(this.size--,i==null)this.root=e.right;else{let n=e.right;e=this.splayMax(i),e.right=n,this.root=e}return this.modificationCount++,r}addNewRoot(t,e){this.size++,this.modificationCount++;let r=this.root;if(r==null){this.root=t;return}e<0?(t.left=r,t.right=r.right,r.right=null):(t.right=r,t.left=r.left,r.left=null),this.root=t}_first(){let t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){let t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},o6,s6,H2=class p_ extends IZ{constructor(e,r){super(),br(this,"root",null),br(this,"compare"),br(this,"validKey"),br(this,o6,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=r??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(let r of e)this.delete(r)}forEach(e){let r=this[Symbol.iterator](),i;for(;i=r.next(),!i.done;)e(i.value,i.value,this)}add(e){let r=this.splay(e);return r!=0&&this.addNewRoot(new f_(e),r),this}addAndReturn(e){let r=this.splay(e);return r!=0&&this.addNewRoot(new f_(e),r),this.root.key}addAll(e){for(let r of e)this.add(r)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let i=r.right;for(;i!=null;)r=i,i=r.right;return r.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let i=r.left;for(;i!=null;)r=i,i=r.left;return r.key}retainAll(e){let r=new p_(this.compare,this.validKey),i=this.modificationCount;for(let n of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&r.add(this.root.key)}r.size!=this.size&&(this.root=r.root,this.size=r.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){let r=new p_(this.compare,this.validKey);for(let i of this)e.has(i)&&r.add(i);return r}difference(e){let r=new p_(this.compare,this.validKey);for(let i of this)e.has(i)||r.add(i);return r}union(e){let r=this.clone();return r.addAll(e),r}clone(){let e=new p_(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function r(n,o){let a,c;do{if(a=n.left,c=n.right,a!=null){let h=new f_(a.key);o.left=h,r(a,h)}if(c!=null){let h=new f_(c.key);o.right=h,n=c,o=h}}while(c!=null)}let i=new f_(e.key);return r(e,i),i}toSet(){return this.clone()}entries(){return new PZ(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(s6=Symbol.iterator,o6=Symbol.toStringTag,s6)](){return new MZ(this.wrap())}},I6=class{constructor(t){br(this,"tree"),br(this,"path",new Array),br(this,"modificationCount",null),br(this,"splayCount"),this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let r=this.tree.getRoot();for(;r!=null;)this.path.push(r),r=r.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},MZ=class extends I6{getValue(t){return t.key}},PZ=class extends I6{getValue(t){return[t.key,t.key]}},M6=t=>()=>t,aC=t=>{let e=t?(r,i)=>i.minus(r).abs().isLessThanOrEqualTo(t):M6(!1);return(r,i)=>e(r,i)?0:r.comparedTo(i)};function RZ(t){let e=t?(r,i,n,o,a)=>r.exponentiatedBy(2).isLessThanOrEqualTo(o.minus(i).exponentiatedBy(2).plus(a.minus(n).exponentiatedBy(2)).times(t)):M6(!1);return(r,i,n)=>{let o=r.x,a=r.y,c=n.x,h=n.y,p=a.minus(h).times(i.x.minus(c)).minus(o.minus(c).times(i.y.minus(h)));return e(p,o,a,c,h)?0:p.comparedTo(0)}}var BZ=t=>t,LZ=t=>{if(t){let e=new H2(aC(t)),r=new H2(aC(t)),i=(o,a)=>a.addAndReturn(o),n=o=>({x:i(o.x,e),y:i(o.y,r)});return n({x:new yu(0),y:new yu(0)}),n}return BZ},lC=t=>({set:e=>{Rh=lC(e)},reset:()=>lC(t),compare:aC(t),snap:LZ(t),orient:RZ(t)}),Rh=lC(),d_=(t,e)=>t.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(t.ur.y),cC=(t,e)=>{if(e.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(e.ll.y))return null;let r=t.ll.x.isLessThan(e.ll.x)?e.ll.x:t.ll.x,i=t.ur.x.isLessThan(e.ur.x)?t.ur.x:e.ur.x,n=t.ll.y.isLessThan(e.ll.y)?e.ll.y:t.ll.y,o=t.ur.y.isLessThan(e.ur.y)?t.ur.y:e.ur.y;return{ll:{x:r,y:n},ur:{x:i,y:o}}},N2=(t,e)=>t.x.times(e.y).minus(t.y.times(e.x)),P6=(t,e)=>t.x.times(e.x).plus(t.y.times(e.y)),W2=t=>P6(t,t).sqrt(),OZ=(t,e,r)=>{let i={x:e.x.minus(t.x),y:e.y.minus(t.y)},n={x:r.x.minus(t.x),y:r.y.minus(t.y)};return N2(n,i).div(W2(n)).div(W2(i))},DZ=(t,e,r)=>{let i={x:e.x.minus(t.x),y:e.y.minus(t.y)},n={x:r.x.minus(t.x),y:r.y.minus(t.y)};return P6(n,i).div(W2(n)).div(W2(i))},a6=(t,e,r)=>e.y.isZero()?null:{x:t.x.plus(e.x.div(e.y).times(r.minus(t.y))),y:r},l6=(t,e,r)=>e.x.isZero()?null:{x:r,y:t.y.plus(e.y.div(e.x).times(r.minus(t.x)))},FZ=(t,e,r,i)=>{if(e.x.isZero())return l6(r,i,t.x);if(i.x.isZero())return l6(t,e,r.x);if(e.y.isZero())return a6(r,i,t.y);if(i.y.isZero())return a6(t,e,r.y);let n=N2(e,i);if(n.isZero())return null;let o={x:r.x.minus(t.x),y:r.y.minus(t.y)},a=N2(o,e).div(n),c=N2(o,i).div(n),h=t.x.plus(c.times(e.x)),p=r.x.plus(a.times(i.x)),x=t.y.plus(c.times(e.y)),T=r.y.plus(a.times(i.y)),R=h.plus(p).div(2),k=x.plus(T).div(2);return{x:R,y:k}},mu=class R6{constructor(e,r){br(this,"point"),br(this,"isLeft"),br(this,"segment"),br(this,"otherSE"),br(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=r}static compare(e,r){let i=R6.comparePoints(e.point,r.point);return i!==0?i:(e.point!==r.point&&e.link(r),e.isLeft!==r.isLeft?e.isLeft?1:-1:q2.compare(e.segment,r.segment))}static comparePoints(e,r){return e.x.isLessThan(r.x)?-1:e.x.isGreaterThan(r.x)?1:e.y.isLessThan(r.y)?-1:e.y.isGreaterThan(r.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let r=e.point.events;for(let i=0,n=r.length;i<n;i++){let o=r[i];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let r=0;r<e;r++){let i=this.point.events[r];if(i.segment.consumedBy===void 0)for(let n=r+1;n<e;n++){let o=this.point.events[n];o.consumedBy===void 0&&i.otherSE.point.events===o.otherSE.point.events&&i.segment.consume(o.segment)}}}getAvailableLinkedEvents(){let e=[];for(let r=0,i=this.point.events.length;r<i;r++){let n=this.point.events[r];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){let r=new Map,i=n=>{let o=n.otherSE;r.set(n,{sine:OZ(this.point,e.point,o.point),cosine:DZ(this.point,e.point,o.point)})};return(n,o)=>{r.has(n)||i(n),r.has(o)||i(o);let{sine:a,cosine:c}=r.get(n),{sine:h,cosine:p}=r.get(o);return a.isGreaterThanOrEqualTo(0)&&h.isGreaterThanOrEqualTo(0)?c.isLessThan(p)?1:c.isGreaterThan(p)?-1:0:a.isLessThan(0)&&h.isLessThan(0)?c.isLessThan(p)?-1:c.isGreaterThan(p)?1:0:h.isLessThan(a)?-1:h.isGreaterThan(a)?1:0}}},kZ=class uC{constructor(e){br(this,"events"),br(this,"poly"),br(this,"_isExteriorRing"),br(this,"_enclosingRing"),this.events=e;for(let r=0,i=e.length;r<i;r++)e[r].segment.ringOut=this;this.poly=null}static factory(e){let r=[];for(let i=0,n=e.length;i<n;i++){let o=e[i];if(!o.isInResult()||o.ringOut)continue;let a=null,c=o.leftSE,h=o.rightSE,p=[c],x=c.point,T=[];for(;a=c,c=h,p.push(c),c.point!==x;)for(;;){let R=c.getAvailableLinkedEvents();if(R.length===0){let q=p[0].point,Z=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${q.x}, ${q.y}]. Last matching segment found ends at [${Z.x}, ${Z.y}].`)}if(R.length===1){h=R[0].otherSE;break}let k=null;for(let q=0,Z=T.length;q<Z;q++)if(T[q].point===c.point){k=q;break}if(k!==null){let q=T.splice(k)[0],Z=p.splice(q.index);Z.unshift(Z[0].otherSE),r.push(new uC(Z.reverse()));continue}T.push({index:p.length,point:c.point});let j=c.getLeftmostComparator(a);h=R.sort(j)[0].otherSE;break}r.push(new uC(p))}return r}getGeom(){let e=this.events[0].point,r=[e];for(let p=1,x=this.events.length-1;p<x;p++){let T=this.events[p].point,R=this.events[p+1].point;Rh.orient(T,e,R)!==0&&(r.push(T),e=T)}if(r.length===1)return null;let i=r[0],n=r[1];Rh.orient(i,e,n)===0&&r.shift(),r.push(r[0]);let o=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:r.length-1,c=this.isExteriorRing()?r.length:-1,h=[];for(let p=a;p!=c;p+=o)h.push([r[p].x.toNumber(),r[p].y.toNumber()]);return h}isExteriorRing(){if(this._isExteriorRing===void 0){let e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,r;let i=this.events[0];for(let a=1,c=this.events.length;a<c;a++){let h=this.events[a];mu.compare(i,h)>0&&(i=h)}let n=i.segment.prevInResult(),o=n?n.prevInResult():null;for(;;){if(!n)return null;if(!o)return n.ringOut;if(o.ringOut!==n.ringOut)return((e=o.ringOut)==null?void 0:e.enclosingRing())!==n.ringOut?n.ringOut:(r=n.ringOut)==null?void 0:r.enclosingRing();n=o.prevInResult(),o=n?n.prevInResult():null}}},c6=class{constructor(t){br(this,"exteriorRing"),br(this,"interiorRings"),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){let t=this.exteriorRing.getGeom();if(t===null)return null;let e=[t];for(let r=0,i=this.interiorRings.length;r<i;r++){let n=this.interiorRings[r].getGeom();n!==null&&e.push(n)}return e}},NZ=class{constructor(t){br(this,"rings"),br(this,"polys"),this.rings=t,this.polys=this._composePolys(t)}getGeom(){let t=[];for(let e=0,r=this.polys.length;e<r;e++){let i=this.polys[e].getGeom();i!==null&&t.push(i)}return t}_composePolys(t){var e;let r=[];for(let i=0,n=t.length;i<n;i++){let o=t[i];if(!o.poly)if(o.isExteriorRing())r.push(new c6(o));else{let a=o.enclosingRing();a!=null&&a.poly||r.push(new c6(a)),(e=a?.poly)==null||e.addInterior(o)}}return r}},zZ=class{constructor(t,e=q2.compare){br(this,"queue"),br(this,"tree"),br(this,"segments"),this.queue=t,this.tree=new H2(e),this.segments=[]}process(t){let e=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),r;t.isLeft&&this.tree.add(e);let i=e,n=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(t.isLeft){let o=null;if(i){let c=i.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(o=c),!i.isAnEndpoint(c))){let h=this._splitSafely(i,c);for(let p=0,x=h.length;p<x;p++)r.push(h[p])}}let a=null;if(n){let c=n.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(a=c),!n.isAnEndpoint(c))){let h=this._splitSafely(n,c);for(let p=0,x=h.length;p<x;p++)r.push(h[p])}}if(o!==null||a!==null){let c=null;o===null?c=a:a===null?c=o:c=mu.comparePoints(o,a)<=0?o:a,this.queue.delete(e.rightSE),r.push(e.rightSE);let h=e.split(c);for(let p=0,x=h.length;p<x;p++)r.push(h[p])}r.length>0?(this.tree.delete(e),r.push(t)):(this.segments.push(e),e.prev=i)}else{if(i&&n){let o=i.getIntersection(n);if(o!==null){if(!i.isAnEndpoint(o)){let a=this._splitSafely(i,o);for(let c=0,h=a.length;c<h;c++)r.push(a[c])}if(!n.isAnEndpoint(o)){let a=this._splitSafely(n,o);for(let c=0,h=a.length;c<h;c++)r.push(a[c])}}}this.tree.delete(e)}return r}_splitSafely(t,e){this.tree.delete(t);let r=t.rightSE;this.queue.delete(r);let i=t.split(e);return i.push(r),t.consumedBy===void 0&&this.tree.add(t),i}},UZ=class{constructor(){br(this,"type"),br(this,"numMultiPolys")}run(t,e,r){A_.type=t;let i=[new h6(e,!0)];for(let h=0,p=r.length;h<p;h++)i.push(new h6(r[h],!1));if(A_.numMultiPolys=i.length,A_.type==="difference"){let h=i[0],p=1;for(;p<i.length;)cC(i[p].bbox,h.bbox)!==null?p++:i.splice(p,1)}if(A_.type==="intersection")for(let h=0,p=i.length;h<p;h++){let x=i[h];for(let T=h+1,R=i.length;T<R;T++)if(cC(x.bbox,i[T].bbox)===null)return[]}let n=new H2(mu.compare);for(let h=0,p=i.length;h<p;h++){let x=i[h].getSweepEvents();for(let T=0,R=x.length;T<R;T++)n.add(x[T])}let o=new zZ(n),a=null;for(n.size!=0&&(a=n.first(),n.delete(a));a;){let h=o.process(a);for(let p=0,x=h.length;p<x;p++){let T=h[p];T.consumedBy===void 0&&n.add(T)}n.size!=0?(a=n.first(),n.delete(a)):a=null}Rh.reset();let c=kZ.factory(o.segments);return new NZ(c).getGeom()}},A_=new UZ,$2=A_,VZ=0,q2=class z2{constructor(e,r,i,n){br(this,"id"),br(this,"leftSE"),br(this,"rightSE"),br(this,"rings"),br(this,"windings"),br(this,"ringOut"),br(this,"consumedBy"),br(this,"prev"),br(this,"_prevInResult"),br(this,"_beforeState"),br(this,"_afterState"),br(this,"_isInResult"),this.id=++VZ,this.leftSE=e,e.segment=this,e.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=e,this.rings=i,this.windings=n}static compare(e,r){let i=e.leftSE.point.x,n=r.leftSE.point.x,o=e.rightSE.point.x,a=r.rightSE.point.x;if(a.isLessThan(i))return 1;if(o.isLessThan(n))return-1;let c=e.leftSE.point.y,h=r.leftSE.point.y,p=e.rightSE.point.y,x=r.rightSE.point.y;if(i.isLessThan(n)){if(h.isLessThan(c)&&h.isLessThan(p))return 1;if(h.isGreaterThan(c)&&h.isGreaterThan(p))return-1;let T=e.comparePoint(r.leftSE.point);if(T<0)return 1;if(T>0)return-1;let R=r.comparePoint(e.rightSE.point);return R!==0?R:-1}if(i.isGreaterThan(n)){if(c.isLessThan(h)&&c.isLessThan(x))return-1;if(c.isGreaterThan(h)&&c.isGreaterThan(x))return 1;let T=r.comparePoint(e.leftSE.point);if(T!==0)return T;let R=e.comparePoint(r.rightSE.point);return R<0?1:R>0?-1:1}if(c.isLessThan(h))return-1;if(c.isGreaterThan(h))return 1;if(o.isLessThan(a)){let T=r.comparePoint(e.rightSE.point);if(T!==0)return T}if(o.isGreaterThan(a)){let T=e.comparePoint(r.rightSE.point);if(T<0)return 1;if(T>0)return-1}if(!o.eq(a)){let T=p.minus(c),R=o.minus(i),k=x.minus(h),j=a.minus(n);if(T.isGreaterThan(R)&&k.isLessThan(j))return 1;if(T.isLessThan(R)&&k.isGreaterThan(j))return-1}return o.isGreaterThan(a)?1:o.isLessThan(a)||p.isLessThan(x)?-1:p.isGreaterThan(x)?1:e.id<r.id?-1:e.id>r.id?1:0}static fromRing(e,r,i){let n,o,a,c=mu.comparePoints(e,r);if(c<0)n=e,o=r,a=1;else if(c>0)n=r,o=e,a=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);let h=new mu(n,!0),p=new mu(o,!1);return new z2(h,p,[i],[a])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(r)?e:r},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(r)?e:r}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Rh.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){let r=this.bbox(),i=e.bbox(),n=cC(r,i);if(n===null)return null;let o=this.leftSE.point,a=this.rightSE.point,c=e.leftSE.point,h=e.rightSE.point,p=d_(r,c)&&this.comparePoint(c)===0,x=d_(i,o)&&e.comparePoint(o)===0,T=d_(r,h)&&this.comparePoint(h)===0,R=d_(i,a)&&e.comparePoint(a)===0;if(x&&p)return R&&!T?a:!R&&T?h:null;if(x)return T&&o.x.eq(h.x)&&o.y.eq(h.y)?null:o;if(p)return R&&a.x.eq(c.x)&&a.y.eq(c.y)?null:c;if(R&&T)return null;if(R)return a;if(T)return h;let k=FZ(o,this.vector(),c,e.vector());return k===null||!d_(n,k)?null:Rh.snap(k)}split(e){let r=[],i=e.events!==void 0,n=new mu(e,!0),o=new mu(e,!1),a=this.rightSE;this.replaceRightSE(o),r.push(o),r.push(n);let c=new z2(n,a,this.rings.slice(),this.windings.slice());return mu.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),mu.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),o.checkForConsuming()),r}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,i=this.windings.length;r<i;r++)this.windings[r]*=-1}consume(e){let r=this,i=e;for(;r.consumedBy;)r=r.consumedBy;for(;i.consumedBy;)i=i.consumedBy;let n=z2.compare(r,i);if(n!==0){if(n>0){let o=r;r=i,i=o}if(r.prev===i){let o=r;r=i,i=o}for(let o=0,a=i.rings.length;o<a;o++){let c=i.rings[o],h=i.windings[o],p=r.rings.indexOf(c);p===-1?(r.rings.push(c),r.windings.push(h)):r.windings[p]+=h}i.rings=null,i.windings=null,i.consumedBy=r,i.leftSE.consumedBy=r.leftSE,i.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let r=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let c=0,h=this.rings.length;c<h;c++){let p=this.rings[c],x=this.windings[c],T=r.indexOf(p);T===-1?(r.push(p),i.push(x)):i[T]+=x}let o=[],a=[];for(let c=0,h=r.length;c<h;c++){if(i[c]===0)continue;let p=r[c],x=p.poly;if(a.indexOf(x)===-1)if(p.isExterior)o.push(x);else{a.indexOf(x)===-1&&a.push(x);let T=o.indexOf(p.poly);T!==-1&&o.splice(T,1)}}for(let c=0,h=o.length;c<h;c++){let p=o[c].multiPoly;n.indexOf(p)===-1&&n.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let e=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch($2.type){case"union":{let i=e.length===0,n=r.length===0;this._isInResult=i!==n;break}case"intersection":{let i,n;e.length<r.length?(i=e.length,n=r.length):(i=r.length,n=e.length),this._isInResult=n===$2.numMultiPolys&&i<n;break}case"xor":{let i=Math.abs(e.length-r.length);this._isInResult=i%2===1;break}case"difference":{let i=n=>n.length===1&&n[0].isSubject;this._isInResult=i(e)!==i(r);break}}return this._isInResult}},u6=class{constructor(t,e,r){if(br(this,"poly"),br(this,"isExterior"),br(this,"segments"),br(this,"bbox"),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=Rh.snap({x:new yu(t[0][0]),y:new yu(t[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let n=i;for(let o=1,a=t.length;o<a;o++){if(typeof t[o][0]!="number"||typeof t[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let c=Rh.snap({x:new yu(t[o][0]),y:new yu(t[o][1])});c.x.eq(n.x)&&c.y.eq(n.y)||(this.segments.push(q2.fromRing(n,c,this)),c.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.x),c.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.y),c.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.x),c.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.y),n=c)}(!i.x.eq(n.x)||!i.y.eq(n.y))&&this.segments.push(q2.fromRing(n,i,this))}getSweepEvents(){let t=[];for(let e=0,r=this.segments.length;e<r;e++){let i=this.segments[e];t.push(i.leftSE),t.push(i.rightSE)}return t}},jZ=class{constructor(t,e){if(br(this,"multiPoly"),br(this,"exteriorRing"),br(this,"interiorRings"),br(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new u6(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let r=1,i=t.length;r<i;r++){let n=new u6(t[r],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=e}getSweepEvents(){let t=this.exteriorRing.getSweepEvents();for(let e=0,r=this.interiorRings.length;e<r;e++){let i=this.interiorRings[e].getSweepEvents();for(let n=0,o=i.length;n<o;n++)t.push(i[n])}return t}},h6=class{constructor(t,e){if(br(this,"isSubject"),br(this,"polys"),br(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new yu(Number.POSITIVE_INFINITY),y:new yu(Number.POSITIVE_INFINITY)},ur:{x:new yu(Number.NEGATIVE_INFINITY),y:new yu(Number.NEGATIVE_INFINITY)}};for(let r=0,i=t.length;r<i;r++){let n=new jZ(t[r],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=e}getSweepEvents(){let t=[];for(let e=0,r=this.polys.length;e<r;e++){let i=this.polys[e].getSweepEvents();for(let n=0,o=i.length;n<o;n++)t.push(i[n])}return t}},GZ=(t,...e)=>$2.run("union",t,e),HZ=(t,...e)=>$2.run("difference",t,e);Rh.set;function B6(t,e,r){if(t!==null)for(var i,n,o,a,c,h,p,x=0,T=0,R,k=t.type,j=k==="FeatureCollection",q=k==="Feature",Z=j?t.features.length:1,re=0;re<Z;re++){p=j?t.features[re].geometry:q?t.geometry:t,R=p?p.type==="GeometryCollection":!1,c=R?p.geometries.length:1;for(var ee=0;ee<c;ee++){var se=0,me=0;if(a=R?p.geometries[ee]:p,a!==null){h=a.coordinates;var Le=a.type;switch(x=0,Le){case null:break;case"Point":if(e(h,T,re,se,me)===!1)return!1;T++,se++;break;case"LineString":case"MultiPoint":for(i=0;i<h.length;i++){if(e(h[i],T,re,se,me)===!1)return!1;T++,Le==="MultiPoint"&&se++}Le==="LineString"&&se++;break;case"Polygon":case"MultiLineString":for(i=0;i<h.length;i++){for(n=0;n<h[i].length-x;n++){if(e(h[i][n],T,re,se,me)===!1)return!1;T++}Le==="MultiLineString"&&se++,Le==="Polygon"&&me++}Le==="Polygon"&&se++;break;case"MultiPolygon":for(i=0;i<h.length;i++){for(me=0,n=0;n<h[i].length;n++){for(o=0;o<h[i][n].length-x;o++){if(e(h[i][n][o],T,re,se,me)===!1)return!1;T++}me++}se++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(B6(a.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function pC(t,e){var r,i,n,o,a,c,h,p,x,T,R=0,k=t.type==="FeatureCollection",j=t.type==="Feature",q=k?t.features.length:1;for(r=0;r<q;r++){for(c=k?t.features[r].geometry:j?t.geometry:t,p=k?t.features[r].properties:j?t.properties:{},x=k?t.features[r].bbox:j?t.bbox:void 0,T=k?t.features[r].id:j?t.id:void 0,h=c?c.type==="GeometryCollection":!1,a=h?c.geometries.length:1,n=0;n<a;n++){if(o=h?c.geometries[n]:c,o===null){if(e(null,R,p,x,T)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,R,p,x,T)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(e(o.geometries[i],R,p,x,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function WZ(t,e){pC(t,function(r,i,n,o,a){var c=r===null?null:r.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return e(y_(r,n,{bbox:o,id:a}),i,0)===!1?!1:void 0}var h;switch(c){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var p=0;p<r.coordinates.length;p++){var x=r.coordinates[p],T={type:h,coordinates:x};if(e(y_(T,n),i,p)===!1)return!1}})}function $Z(t,e={}){let r=[];if(pC(t,n=>{r.push(n.coordinates)}),r.length<2)throw new Error("Must have at least 2 geometries");let i=GZ(r[0],...r.slice(1));return i.length===0?null:i.length===1?dC(i[0],e.properties):C6(i,e.properties)}var L6=$Z;function qZ(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;let r=[1/0,1/0,-1/0,-1/0];return B6(t,i=>{r[0]>i[0]&&(r[0]=i[0]),r[1]>i[1]&&(r[1]=i[1]),r[2]<i[0]&&(r[2]=i[0]),r[3]<i[1]&&(r[3]=i[1])}),r}var f6=qZ;function ZZ(t){let e=[];if(pC(t,n=>{e.push(n.coordinates)}),e.length<2)throw new Error("Must have at least two features");let r=t.features[0].properties||{},i=HZ(e[0],...e.slice(1));return i.length===0?null:i.length===1?dC(i[0],r):C6(i,r)}var XZ=ZZ;function YZ(t){if(!t)throw new Error("geojson is required");var e=[];return WZ(t,function(r){e.push(r)}),x_(e)}var KZ=YZ;function d6(t,e){let r=XZ(x_([dC([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),t]));if(!r)return;r.properties={isMask:!0};let i=G2(f6(t)),n=(i[2]-i[0])/360/1e3,o=i[0]<-180,a=i[2]>180,c=KZ(t);if(c.features.length>1&&(o||a))for(let h of c.features){let p=G2(f6(h));if(a&&p[0]<-180+n)for(let x of h.geometry.coordinates)for(let T of x)T[0]+=360-n;if(o&&p[2]>180-n)for(let x of h.geometry.coordinates)for(let T of x)T[0]-=360-n}e(x_([c.features.length<2?t:L6(c)??t,r]))}var p6={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},O2="mtlr-gc-full-geom",A6="mtlr-gc-full-geom-fill",m6="mtlr-gc-full-geom-line";function QZ(t,e,r=!0,i=!0,n={},o={},a=p6){let c,h=[],p,x,T;function R(){if(!t.loaded){t.once("load",R);return}let Z=a?a===!0?p6:a:void 0;if(!(Z!=null&&Z.fill)&&!(Z!=null&&Z.line))return;let re=t.getSource(O2);if(re)re.setData(T??x_([]));else if(T)t.addSource(O2,{type:"geojson",data:T});else return;!t.getLayer(A6)&&Z!=null&&Z.fill&&t.addLayer({...Z?.fill,id:A6,type:"fill",source:O2}),!t.getLayer(m6)&&Z!=null&&Z.line&&t.addLayer({...Z?.line,id:m6,type:"line",source:O2})}function k(Z){T=Z,R()}t.on("styledata",()=>{setTimeout(()=>{T&&R()})});let j=Z=>{c?.({type:"mapClick",coordinates:[Z.lngLat.lng,Z.lngLat.lat]})};function q(Z=!1){if(!e)throw new Error;let re=document.createElement("div");return Z&&re.classList.add("marker-interactive"),new nC({props:{displayIn:"maplibre"},target:re}),new e.Marker({element:re,offset:[1,-13]})}return{setEventHandler(Z){Z?(c=Z,t.on("click",j)):(c=void 0,t.off("click",j))},flyTo(Z,re){t.flyTo({center:Z,...re?{zoom:re}:{},...n})},fitBounds(Z,re,ee){t.fitBounds([[Z[0],Z[1]],[Z[2],Z[3]]],{padding:re,...ee?{maxZoom:ee}:{},...o})},indicateReverse(Z){t.getCanvasContainer().style.cursor=Z?"crosshair":""},setReverseMarker(Z){!e||!r||(x?Z?x.setLngLat(Z):(x.remove(),x=void 0):Z&&(r instanceof Function?x=r(t)??void 0:(x=(typeof r=="object"?new e.Marker(r):q()).setLngLat(Z).addTo(t),x.getElement().classList.add("marker-reverse"))))},setFeatures(Z,re,ee){for(let se of h)se.remove();if(h.length=0,k(void 0),!!e){e:if(re){let se=!1;if(re.geometry.type==="GeometryCollection"){let me=re.geometry.geometries.filter(Le=>Le.type==="Polygon"||Le.type==="MultiPolygon");t:if(me.length>0){let Le=L6(x_(me.map(je=>y_(je))));if(!Le)break t;d6({...re,geometry:Le.geometry},k),se=!0}else{let Le=re.geometry.geometries.filter(je=>je.type==="LineString"||je.type==="MultiLineString");Le.length>0&&(k({...re,geometry:{type:"GeometryCollection",geometries:Le}}),se=!0)}}if(!se){if(re.geometry.type==="Polygon"||re.geometry.type==="MultiPolygon")d6(re,k);else if(re.geometry.type==="LineString"||re.geometry.type==="MultiLineString"){k(re);break e}}if(!ee&&!re.geometry.type.endsWith("Point"))break e;if(r instanceof Function){let me=r(t,re);me&&h.push(me)}else r&&h.push(typeof r=="object"?new e.Marker(r):q().setLngLat(re.center).addTo(t))}if(i)for(let se of Z??[]){if(se===re)continue;let me;if(i instanceof Function){if(me=i(t,se),!me)continue}else me=(typeof i=="object"?new e.Marker(i):q(!0)).setLngLat(se.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(se.place_type[0]==="reverse"?se.place_name:se.place_name.replace(/,.*/,""))).addTo(t);let Le=me.getElement();Le.addEventListener("click",je=>{je.stopPropagation(),c?.({type:"markerClick",id:se.id})}),Le.addEventListener("mouseenter",()=>{c?.({type:"markerMouseEnter",id:se.id}),me.togglePopup()}),Le.addEventListener("mouseleave",()=>{c?.({type:"markerMouseLeave",id:se.id}),me.togglePopup()}),h.push(me)}}},setSelectedMarker(Z){p&&p.getElement().classList.toggle("marker-selected",!1),p=Z>-1?h[Z]:void 0,p?.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){let Z=t.getCenter();return[t.getZoom(),Z.lng,Z.lat]}}}function JZ(t,e,r){var i,n,o;class a{constructor(re,ee){br(this,"type"),br(this,"target"),this.type=ee,this.target=re}}class c extends a{constructor(re,ee){super(re,"select"),br(this,"feature"),Object.assign(this,ee)}}class h extends a{constructor(re,ee){super(re,"featureslisted"),br(this,"features"),this.features=ee}}class p extends a{constructor(re,ee){super(re,"featuresmarked"),br(this,"features"),this.features=ee}}class x extends a{constructor(re,ee){super(re,"optionsvisibilitychange"),br(this,"optionsVisible"),this.optionsVisible=ee}}class T extends a{constructor(re,ee){super(re,"pick"),br(this,"feature"),this.feature=ee}}class R extends a{constructor(re,ee){super(re,"querychange"),br(this,"query"),this.query=ee}}class k extends a{constructor(re,ee,se){super(re,"response"),br(this,"url"),br(this,"featureCollection"),this.url=ee,this.featureCollection=se}}class j extends a{constructor(re,ee){super(re,"reversetoggle"),br(this,"reverse"),this.reverse=ee}}class q extends t{constructor(re={}){super(),ZE(this,i),ZE(this,n),ZE(this,o),M2(this,n,re)}onAddInt(re){let ee=document.createElement("div");ee.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";let{marker:se,showResultMarkers:me,flyTo:Le,fullGeometryStyle:je,...Je}=So(this,n),J=typeof Le=="boolean"?{}:Le,te={mapController:QZ(re,e,se,me,J,J,je),flyTo:Le===void 0?!0:!!Le,apiKey:"",...r?.(re,ee),...Je};if(!te.apiKey)throw new Error("no apiKey provided");return M2(this,i,new EZ({target:ee,props:te})),So(this,i).$on("select",X=>{this.fire(new c(this,X.detail))}),So(this,i).$on("pick",X=>{this.fire(new T(this,X.detail.feature))}),So(this,i).$on("featureslisted",X=>{this.fire(new h(this,X.detail.features))}),So(this,i).$on("featuresmarked",X=>{this.fire(new p(this,X.detail.features))}),So(this,i).$on("response",X=>{this.fire(new k(this,X.detail.url,X.detail.featureCollection))}),So(this,i).$on("optionsvisibilitychange",X=>{this.fire(new x(this,X.detail.optionsVisible))}),So(this,i).$on("reversetoggle",X=>{this.fire(new j(this,X.detail.reverse))}),So(this,i).$on("querychange",X=>{this.fire(new R(this,X.detail.query))}),M2(this,o,ee),ee}on(re,ee){return super.on(re,ee)}once(re,ee){return super.once(re,ee)}off(re,ee){return super.off(re,ee)}listens(re){return super.listens(re)}setOptions(re){var ee;Object.assign(So(this,n),re);let{marker:se,showResultMarkers:me,flyTo:Le,fullGeometryStyle:je,...Je}=So(this,n);(ee=So(this,i))==null||ee.$set(Je)}setQuery(re,ee=!0){var se;(se=So(this,i))==null||se.setQuery(re,ee)}clearMap(){var re;(re=So(this,i))==null||re.clearMap()}clearList(){var re;(re=So(this,i))==null||re.clearList()}setReverseMode(re){var ee;(ee=So(this,i))==null||ee.$set({reverseActive:re})}focus(re){var ee;(ee=So(this,i))==null||ee.focus(re)}blur(){var re;(re=So(this,i))==null||re.blur()}onRemove(){var re,ee,se;(re=So(this,i))==null||re.$destroy(),M2(this,i,void 0),(se=(ee=So(this,o))==null?void 0:ee.parentNode)==null||se.removeChild(So(this,o))}}return i=new WeakMap,n=new WeakMap,o=new WeakMap,{MapLibreBasedGeocodingControl:q,events:{SelectEvent:c,FeaturesListedEvent:h,FeaturesMarkedEvent:p,OptionsVisibilityChangeEvent:x,PickEvent:T,QueryChangeEvent:R,ResponseEvent:k,ReverseToggleEvent:j}}}var{MapLibreBasedGeocodingControl:eX,events:rd}=JZ(hC.Evented,hC),Z2=class extends eX{onAdd(e){return super.onAddInt(e)}},M_e=rd.SelectEvent,P_e=rd.FeaturesListedEvent,R_e=rd.FeaturesMarkedEvent,B_e=rd.OptionsVisibilityChangeEvent,L_e=rd.PickEvent,O_e=rd.QueryChangeEvent,D_e=rd.ResponseEvent,F_e=rd.ReverseToggleEvent;var tX=Object.prototype.toString,O0=Array.isArray||function(e){return tX.call(e)==="[object Array]"};function mC(t){return typeof t=="function"}function rX(t){return O0(t)?"array":typeof t}function AC(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function O6(t,e){return t!=null&&typeof t=="object"&&e in t}function iX(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var nX=RegExp.prototype.test;function oX(t,e){return nX.call(t,e)}var sX=/\S/;function aX(t){return!oX(sX,t)}var lX={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function cX(t){return String(t).replace(/[&<>"'`=\/]/g,function(r){return lX[r]})}var uX=/\s*/,hX=/\s+/,D6=/\s*=/,fX=/\s*\}/,dX=/#|\^|\/|>|\{|&|=|!/;function pX(t,e){if(!t)return[];var r=!1,i=[],n=[],o=[],a=!1,c=!1,h="",p=0;function x(){if(a&&!c)for(;o.length;)delete n[o.pop()];else o=[];a=!1,c=!1}var T,R,k;function j(J){if(typeof J=="string"&&(J=J.split(hX,2)),!O0(J)||J.length!==2)throw new Error("Invalid tags: "+J);T=new RegExp(AC(J[0])+"\\s*"),R=new RegExp("\\s*"+AC(J[1])),k=new RegExp("\\s*"+AC("}"+J[1]))}j(e||vl.tags);for(var q=new v_(t),Z,re,ee,se,me,Le;!q.eos();){if(Z=q.pos,ee=q.scanUntil(T),ee)for(var je=0,Je=ee.length;je<Je;++je)se=ee.charAt(je),aX(se)?(o.push(n.length),h+=se):(c=!0,r=!0,h+=" "),n.push(["text",se,Z,Z+1]),Z+=1,se===`
`&&(x(),h="",p=0,r=!1);if(!q.scan(T))break;if(a=!0,re=q.scan(dX)||"name",q.scan(uX),re==="="?(ee=q.scanUntil(D6),q.scan(D6),q.scanUntil(R)):re==="{"?(ee=q.scanUntil(k),q.scan(fX),q.scanUntil(R),re="&"):ee=q.scanUntil(R),!q.scan(R))throw new Error("Unclosed tag at "+q.pos);if(re==">"?me=[re,ee,Z,q.pos,h,p,r]:me=[re,ee,Z,q.pos],p++,n.push(me),re==="#"||re==="^")i.push(me);else if(re==="/"){if(Le=i.pop(),!Le)throw new Error('Unopened section "'+ee+'" at '+Z);if(Le[1]!==ee)throw new Error('Unclosed section "'+Le[1]+'" at '+Z)}else re==="name"||re==="{"||re==="&"?c=!0:re==="="&&j(ee)}if(x(),Le=i.pop(),Le)throw new Error('Unclosed section "'+Le[1]+'" at '+q.pos);return mX(AX(n))}function AX(t){for(var e=[],r,i,n=0,o=t.length;n<o;++n)r=t[n],r&&(r[0]==="text"&&i&&i[0]==="text"?(i[1]+=r[1],i[3]=r[3]):(e.push(r),i=r));return e}function mX(t){for(var e=[],r=e,i=[],n,o,a=0,c=t.length;a<c;++a)switch(n=t[a],n[0]){case"#":case"^":r.push(n),i.push(n),r=n[4]=[];break;case"/":o=i.pop(),o[5]=n[2],r=i.length>0?i[i.length-1][4]:e;break;default:r.push(n)}return e}function v_(t){this.string=t,this.tail=t,this.pos=0}v_.prototype.eos=function(){return this.tail===""};v_.prototype.scan=function(e){var r=this.tail.match(e);if(!r||r.index!==0)return"";var i=r[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i};v_.prototype.scanUntil=function(e){var r=this.tail.search(e),i;switch(r){case-1:i=this.tail,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=i.length,i};function L0(t,e){this.view=t,this.cache={".":this.view},this.parent=e}L0.prototype.push=function(e){return new L0(e,this)};L0.prototype.lookup=function(e){var r=this.cache,i;if(r.hasOwnProperty(e))i=r[e];else{for(var n=this,o,a,c,h=!1;n;){if(e.indexOf(".")>0)for(o=n.view,a=e.split("."),c=0;o!=null&&c<a.length;)c===a.length-1&&(h=O6(o,a[c])||iX(o,a[c])),o=o[a[c++]];else o=n.view[e],h=O6(n.view,e);if(h){i=o;break}n=n.parent}r[e]=i}return mC(i)&&(i=i.call(this.view)),i};function sa(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}sa.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};sa.prototype.parse=function(e,r){var i=this.templateCache,n=e+":"+(r||vl.tags).join(":"),o=typeof i<"u",a=o?i.get(n):void 0;return a==null&&(a=pX(e,r),o&&i.set(n,a)),a};sa.prototype.render=function(e,r,i,n){var o=this.getConfigTags(n),a=this.parse(e,o),c=r instanceof L0?r:new L0(r,void 0);return this.renderTokens(a,c,i,e,n)};sa.prototype.renderTokens=function(e,r,i,n,o){for(var a="",c,h,p,x=0,T=e.length;x<T;++x)p=void 0,c=e[x],h=c[0],h==="#"?p=this.renderSection(c,r,i,n,o):h==="^"?p=this.renderInverted(c,r,i,n,o):h===">"?p=this.renderPartial(c,r,i,o):h==="&"?p=this.unescapedValue(c,r):h==="name"?p=this.escapedValue(c,r,o):h==="text"&&(p=this.rawValue(c)),p!==void 0&&(a+=p);return a};sa.prototype.renderSection=function(e,r,i,n,o){var a=this,c="",h=r.lookup(e[1]);function p(R){return a.render(R,r,i,o)}if(h){if(O0(h))for(var x=0,T=h.length;x<T;++x)c+=this.renderTokens(e[4],r.push(h[x]),i,n,o);else if(typeof h=="object"||typeof h=="string"||typeof h=="number")c+=this.renderTokens(e[4],r.push(h),i,n,o);else if(mC(h)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");h=h.call(r.view,n.slice(e[3],e[5]),p),h!=null&&(c+=h)}else c+=this.renderTokens(e[4],r,i,n,o);return c}};sa.prototype.renderInverted=function(e,r,i,n,o){var a=r.lookup(e[1]);if(!a||O0(a)&&a.length===0)return this.renderTokens(e[4],r,i,n,o)};sa.prototype.indentPartial=function(e,r,i){for(var n=r.replace(/[^ \t]/g,""),o=e.split(`
`),a=0;a<o.length;a++)o[a].length&&(a>0||!i)&&(o[a]=n+o[a]);return o.join(`
`)};sa.prototype.renderPartial=function(e,r,i,n){if(i){var o=this.getConfigTags(n),a=mC(i)?i(e[1]):i[e[1]];if(a!=null){var c=e[6],h=e[5],p=e[4],x=a;h==0&&p&&(x=this.indentPartial(a,p,c));var T=this.parse(x,o);return this.renderTokens(T,r,i,x,n)}}};sa.prototype.unescapedValue=function(e,r){var i=r.lookup(e[1]);if(i!=null)return i};sa.prototype.escapedValue=function(e,r,i){var n=this.getConfigEscape(i)||vl.escape,o=r.lookup(e[1]);if(o!=null)return typeof o=="number"&&n===vl.escape?String(o):n(o)};sa.prototype.rawValue=function(e){return e[1]};sa.prototype.getConfigTags=function(e){return O0(e)?e:e&&typeof e=="object"?e.tags:void 0};sa.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!O0(e))return e.escape};var vl={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){b_.templateCache=t},get templateCache(){return b_.templateCache}},b_=new sa;vl.clearCache=function(){return b_.clearCache()};vl.parse=function(e,r){return b_.parse(e,r)};vl.render=function(e,r,i,n){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+rX(e)+'" was given as the first argument for mustache#render(template, view, partials)');return b_.render(e,r,i,n)};vl.escape=cX;vl.Scanner=v_;vl.Context=L0;vl.Writer=sa;var F6=vl;var k0=Math.pow,Ls=(t,e,r)=>new Promise((i,n)=>{var o=h=>{try{c(r.next(h))}catch(p){n(p)}},a=h=>{try{c(r.throw(h))}catch(p){n(p)}},c=h=>h.done?i(h.value):Promise.resolve(h.value).then(o,a);c((r=r.apply(t,e)).next())}),Ja=Uint8Array,F0=Uint16Array,gX=Int32Array,z6=new Ja([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),U6=new Ja([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_X=new Ja([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),V6=function(t,e){for(var r=new F0(31),i=0;i<31;++i)r[i]=e+=1<<t[i-1];for(var n=new gX(r[30]),i=1;i<30;++i)for(var o=r[i];o<r[i+1];++o)n[o]=o-r[i]<<5|i;return{b:r,r:n}},j6=V6(z6,2),G6=j6.b,yX=j6.r;G6[28]=258,yX[258]=28;var H6=V6(U6,0),xX=H6.b,J_e=H6.r,yC=new F0(32768);for(nn=0;nn<32768;++nn)Lh=(nn&43690)>>1|(nn&21845)<<1,Lh=(Lh&52428)>>2|(Lh&13107)<<2,Lh=(Lh&61680)>>4|(Lh&3855)<<4,yC[nn]=((Lh&65280)>>8|(Lh&255)<<8)>>1;var Lh,nn,E_=function(t,e,r){for(var i=t.length,n=0,o=new F0(e);n<i;++n)t[n]&&++o[t[n]-1];var a=new F0(e);for(n=1;n<e;++n)a[n]=a[n-1]+o[n-1]<<1;var c;if(r){c=new F0(1<<e);var h=15-e;for(n=0;n<i;++n)if(t[n])for(var p=n<<4|t[n],x=e-t[n],T=a[t[n]-1]++<<x,R=T|(1<<x)-1;T<=R;++T)c[yC[T]>>h]=p}else for(c=new F0(i),n=0;n<i;++n)t[n]&&(c[n]=yC[a[t[n]-1]++]>>15-t[n]);return c},C_=new Ja(288);for(nn=0;nn<144;++nn)C_[nn]=8;var nn;for(nn=144;nn<256;++nn)C_[nn]=9;var nn;for(nn=256;nn<280;++nn)C_[nn]=7;var nn;for(nn=280;nn<288;++nn)C_[nn]=8;var nn,W6=new Ja(32);for(nn=0;nn<32;++nn)W6[nn]=5;var nn,bX=E_(C_,9,1),vX=E_(W6,5,1),gC=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},vc=function(t,e,r){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(e&7)&r},_C=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},wX=function(t){return(t+7)/8|0},TX=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var i=new Ja(r-e);return i.set(t.subarray(e,r)),i},EX=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qa=function(t,e,r){var i=new Error(e||EX[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,Qa),!r)throw i;return i},vC=function(t,e,r,i){var n=t.length,o=i?i.length:0;if(!n||e.f&&!e.l)return r||new Ja(0);var a=!r||e.i!=2,c=e.i;r||(r=new Ja(n*3));var h=function(ei){var Oi=r.length;if(ei>Oi){var ui=new Ja(Math.max(Oi*2,ei));ui.set(r),r=ui}},p=e.f||0,x=e.p||0,T=e.b||0,R=e.l,k=e.d,j=e.m,q=e.n,Z=n*8;do{if(!R){p=vc(t,x,1);var re=vc(t,x+1,3);if(x+=3,re)if(re==1)R=bX,k=vX,j=9,q=5;else if(re==2){var Le=vc(t,x,31)+257,je=vc(t,x+10,15)+4,Je=Le+vc(t,x+5,31)+1;x+=14;for(var J=new Ja(Je),te=new Ja(19),X=0;X<je;++X)te[_X[X]]=vc(t,x+X*3,7);x+=je*3;for(var ye=gC(te),_e=(1<<ye)-1,Oe=E_(te,ye,1),X=0;X<Je;){var ve=Oe[vc(t,x,_e)];x+=ve&15;var ee=ve>>4;if(ee<16)J[X++]=ee;else{var De=0,Xe=0;for(ee==16?(Xe=3+vc(t,x,3),x+=2,De=J[X-1]):ee==17?(Xe=3+vc(t,x,7),x+=3):ee==18&&(Xe=11+vc(t,x,127),x+=7);Xe--;)J[X++]=De}}var rt=J.subarray(0,Le),tt=J.subarray(Le);j=gC(rt),q=gC(tt),R=E_(rt,j,1),k=E_(tt,q,1)}else Qa(1);else{var ee=wX(x)+4,se=t[ee-4]|t[ee-3]<<8,me=ee+se;if(me>n){c&&Qa(0);break}a&&h(T+se),r.set(t.subarray(ee,me),T),e.b=T+=se,e.p=x=me*8,e.f=p;continue}if(x>Z){c&&Qa(0);break}}a&&h(T+131072);for(var yt=(1<<j)-1,Xt=(1<<q)-1,jt=x;;jt=x){var De=R[_C(t,x)&yt],fr=De>>4;if(x+=De&15,x>Z){c&&Qa(0);break}if(De||Qa(2),fr<256)r[T++]=fr;else if(fr==256){jt=x,R=null;break}else{var qt=fr-254;if(fr>264){var X=fr-257,Ot=z6[X];qt=vc(t,x,(1<<Ot)-1)+G6[X],x+=Ot}var Tr=k[_C(t,x)&Xt],Or=Tr>>4;Tr||Qa(3),x+=Tr&15;var tt=xX[Or];if(Or>3){var Ot=U6[Or];tt+=_C(t,x)&(1<<Ot)-1,x+=Ot}if(x>Z){c&&Qa(0);break}a&&h(T+131072);var Dr=T+qt;if(T<tt){var Xr=o-tt,ki=Math.min(tt,Dr);for(Xr+T<0&&Qa(3);T<ki;++T)r[T]=i[Xr+T]}for(;T<Dr;T+=4)r[T]=r[T-tt],r[T+1]=r[T+1-tt],r[T+2]=r[T+2-tt],r[T+3]=r[T+3-tt];T=Dr}}e.l=R,e.p=jt,e.b=T,e.f=p,R&&(p=1,e.m=j,e.d=k,e.n=q)}while(!p);return T==r.length?r:TX(r,0,T)},CX=new Ja(0),SX=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&Qa(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=(t[10]|t[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[r++]);return r+(e&2)},IX=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},MX=function(t,e){return((t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Qa(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&Qa(6,"invalid zlib data: "+(t[1]&32?"need":"unexpected")+" dictionary"),(t[1]>>3&4)+2};function PX(t,e){return vC(t,{i:2},e&&e.out,e&&e.dictionary)}function RX(t,e){var r=SX(t);return r+8>t.length&&Qa(6,"invalid gzip data"),vC(t.subarray(r,-8),{i:2},e&&e.out||new Ja(IX(t)),e&&e.dictionary)}function BX(t,e){return vC(t.subarray(MX(t,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function xC(t,e){return t[0]==31&&t[1]==139&&t[2]==8?RX(t,e):(t[0]&15)!=8||t[0]>>4>7||(t[0]<<8|t[1])%31?PX(t,e):BX(t,e)}var LX=typeof TextDecoder<"u"&&new TextDecoder,OX=0;try{LX.decode(CX,{stream:!0}),OX=1}catch{}var $6=(t,e)=>t*k0(2,e),w_=(t,e)=>Math.floor(t/k0(2,e)),X2=(t,e)=>$6(t.getUint16(e+1,!0),8)+t.getUint8(e),q6=(t,e)=>$6(t.getUint32(e+2,!0),16)+t.getUint16(e,!0),DX=(t,e,r,i,n)=>{if(t!==i.getUint8(n))return t-i.getUint8(n);let o=X2(i,n+1);if(e!==o)return e-o;let a=X2(i,n+4);return r!==a?r-a:0},FX=(t,e,r,i)=>{let n=Z6(t,e|128,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],isDir:!0}:null},k6=(t,e,r,i)=>{let n=Z6(t,e,r,i);return n?{z:e,x:r,y:i,offset:n[0],length:n[1],isDir:!1}:null},Z6=(t,e,r,i)=>{let n=0,o=t.byteLength/17-1;for(;n<=o;){let a=o+n>>1,c=DX(e,r,i,t,a*17);if(c>0)n=a+1;else if(c<0)o=a-1;else return[q6(t,a*17+7),t.getUint32(a*17+13,!0)]}return null},kX=(t,e)=>t.isDir&&!e.isDir?1:!t.isDir&&e.isDir?-1:t.z!==e.z?t.z-e.z:t.x!==e.x?t.x-e.x:t.y-e.y,X6=(t,e)=>{let r=t.getUint8(e*17);return{z:r&127,x:X2(t,e*17+1),y:X2(t,e*17+4),offset:q6(t,e*17+7),length:t.getUint32(e*17+13,!0),isDir:r>>7===1}},N6=t=>{let e=[],r=new DataView(t);for(let i=0;i<r.byteLength/17;i++)e.push(X6(r,i));return NX(e)},NX=t=>{t.sort(kX);let e=new ArrayBuffer(17*t.length),r=new Uint8Array(e);for(let i=0;i<t.length;i++){let n=t[i],o=n.z;n.isDir&&(o=o|128),r[i*17]=o,r[i*17+1]=n.x&255,r[i*17+2]=n.x>>8&255,r[i*17+3]=n.x>>16&255,r[i*17+4]=n.y&255,r[i*17+5]=n.y>>8&255,r[i*17+6]=n.y>>16&255,r[i*17+7]=n.offset&255,r[i*17+8]=w_(n.offset,8)&255,r[i*17+9]=w_(n.offset,16)&255,r[i*17+10]=w_(n.offset,24)&255,r[i*17+11]=w_(n.offset,32)&255,r[i*17+12]=w_(n.offset,48)&255,r[i*17+13]=n.length&255,r[i*17+14]=n.length>>8&255,r[i*17+15]=n.length>>16&255,r[i*17+16]=n.length>>24&255}return e},zX=(t,e)=>{if(t.byteLength<17)return null;let r=t.byteLength/17,i=X6(t,r-1);if(i.isDir){let n=i.z,o=e.z-n,a=Math.trunc(e.x/(1<<o)),c=Math.trunc(e.y/(1<<o));return{z:n,x:a,y:c}}return null};function UX(t){return Ls(this,null,function*(){let e=yield t.getBytes(0,512e3),r=new DataView(e.data),i=r.getUint32(4,!0),n=r.getUint16(8,!0),o=new TextDecoder("utf-8"),a=JSON.parse(o.decode(new DataView(e.data,10,i))),c=0;a.compression==="gzip"&&(c=2);let h=0;"minzoom"in a&&(h=+a.minzoom);let p=0;"maxzoom"in a&&(p=+a.maxzoom);let x=0,T=0,R=0,k=-180,j=-85,q=180,Z=85;if(a.bounds){let ee=a.bounds.split(",");k=+ee[0],j=+ee[1],q=+ee[2],Z=+ee[3]}if(a.center){let ee=a.center.split(",");x=+ee[0],T=+ee[1],R=+ee[2]}return{specVersion:r.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:c,tileType:1,minZoom:h,maxZoom:p,minLon:k,minLat:j,maxLon:q,maxLat:Z,centerZoom:R,centerLon:x,centerLat:T,etag:e.etag}})}function VX(t,e,r,i,n,o,a){return Ls(this,null,function*(){let c=yield r.getArrayBuffer(e,t.rootDirectoryOffset,t.rootDirectoryLength,t);t.specVersion===1&&(c=N6(c));let h=k6(new DataView(c),i,n,o);if(h){let T=(yield e.getBytes(h.offset,h.length,a)).data,R=new DataView(T);return R.getUint8(0)===31&&R.getUint8(1)===139&&(T=xC(new Uint8Array(T))),{data:T}}let p=zX(new DataView(c),{z:i,x:n,y:o});if(p){let x=FX(new DataView(c),p.z,p.x,p.y);if(x){let T=yield r.getArrayBuffer(e,x.offset,x.length,t);t.specVersion===1&&(T=N6(T));let R=k6(new DataView(T),i,n,o);if(R){let j=(yield e.getBytes(R.offset,R.length,a)).data,q=new DataView(j);return q.getUint8(0)===31&&q.getUint8(1)===139&&(j=xC(new Uint8Array(j))),{data:j}}}}})}var Y6={getHeader:UX,getZxy:VX};var jX=t=>(e,r)=>{if(r instanceof AbortController)return t(e,r);let i=new AbortController;return t(e,i).then(n=>r(void 0,n.data,n.cacheControl||"",n.expires||""),n=>r(n)).catch(n=>r(n)),{cancel:()=>i.abort()}},K6=class{constructor(t){this.tilev4=(e,r)=>Ls(this,null,function*(){if(e.type==="json"){let R=e.url.substr(10),k=this.tiles.get(R);if(k||(k=new N0(R),this.tiles.set(R,k)),this.metadata)return{data:yield k.getTileJson(e.url)};let j=yield k.getHeader();return{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:j.minZoom,maxzoom:j.maxZoom,bounds:[j.minLon,j.minLat,j.maxLon,j.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=e.url.match(i);if(!n)throw new Error("Invalid PMTiles protocol URL");let o=n[1],a=this.tiles.get(o);a||(a=new N0(o),this.tiles.set(o,a));let c=n[2],h=n[3],p=n[4],x=yield a.getHeader(),T=yield a?.getZxy(+c,+h,+p,r.signal);return T?{data:new Uint8Array(T.data),cacheControl:T.cacheControl,expires:T.expires}:x.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=jX(this.tilev4),this.tiles=new Map,this.metadata=t?.metadata||!1}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};function D0(t,e){return(e>>>0)*4294967296+(t>>>0)}function GX(t,e){let r=e.buf,i=r[e.pos++],n=(i&112)>>4;if(i<128||(i=r[e.pos++],n|=(i&127)<<3,i<128)||(i=r[e.pos++],n|=(i&127)<<10,i<128)||(i=r[e.pos++],n|=(i&127)<<17,i<128)||(i=r[e.pos++],n|=(i&127)<<24,i<128)||(i=r[e.pos++],n|=(i&1)<<31,i<128))return D0(t,n);throw new Error("Expected varint not more than 10 bytes")}function T_(t){let e=t.buf,r=e[t.pos++],i=r&127;return r<128||(r=e[t.pos++],i|=(r&127)<<7,r<128)||(r=e[t.pos++],i|=(r&127)<<14,r<128)||(r=e[t.pos++],i|=(r&127)<<21,r<128)?i:(r=e[t.pos],i|=(r&15)<<28,GX(i,t))}function HX(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}var WX=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function $X(t,e,r){if(t>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>k0(2,t)-1||r>k0(2,t)-1)throw Error("tile x/y outside zoom level bounds");let i=WX[t],n=k0(2,t),o=0,a=0,c=0,h=[e,r],p=n/2;for(;p>0;)o=(h[0]&p)>0?1:0,a=(h[1]&p)>0?1:0,c+=p*p*(3*o^a),HX(p,h,o,a),p=p/2;return i+c}function Q6(t,e){return Ls(this,null,function*(){if(e===1||e===0)return t;if(e===2){if(typeof globalThis.DecompressionStream>"u")return xC(new Uint8Array(t));let r=new Response(t).body;if(!r)throw Error("Failed to read response stream");let i=r.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}function qX(t){return t===1?".mvt":t===2?".png":t===3?".jpg":t===4?".webp":t===5?".avif":""}var ZX=127;function XX(t,e){let r=0,i=t.length-1;for(;r<=i;){let n=i+r>>1,o=e-t[n].tileId;if(o>0)r=n+1;else if(o<0)i=n-1;else return t[n]}return i>=0&&(t[i].runLength===0||e-t[i].tileId<t[i].runLength)?t[i]:null}var YX=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1;let r="";"navigator"in globalThis&&(r=globalThis.navigator.userAgent||"");let i=r.indexOf("Windows")>-1,n=/Chrome|Chromium|Edg|OPR|Brave/.test(r);this.chromeWindowsNoCache=!1,i&&n&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,r,i){return Ls(this,null,function*(){let n,o;r?o=r:(n=new AbortController,o=n.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${t}-${t+e-1}`);let c;this.mustReload?c="reload":this.chromeWindowsNoCache&&(c="no-store");let h=yield fetch(this.url,{signal:o,cache:c,headers:a});if(t===0&&h.status===416){let R=h.headers.get("Content-Range");if(!R||!R.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let k=+R.substr(8);h=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${k-1}`}})}let p=h.headers.get("Etag");if(p?.startsWith("W/")&&(p=null),h.status===416||i&&p&&p!==i)throw this.mustReload=!0,new bC(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(h.status>=300)throw Error(`Bad response code: ${h.status}`);let x=h.headers.get("Content-Length");if(h.status===200&&(!x||+x>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:p||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};function wc(t,e){let r=t.getUint32(e+4,!0),i=t.getUint32(e+0,!0);return r*k0(2,32)+i}function KX(t,e){let r=new DataView(t),i=r.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:wc(r,8),rootDirectoryLength:wc(r,16),jsonMetadataOffset:wc(r,24),jsonMetadataLength:wc(r,32),leafDirectoryOffset:wc(r,40),leafDirectoryLength:wc(r,48),tileDataOffset:wc(r,56),tileDataLength:wc(r,64),numAddressedTiles:wc(r,72),numTileEntries:wc(r,80),numTileContents:wc(r,88),clustered:r.getUint8(96)===1,internalCompression:r.getUint8(97),tileCompression:r.getUint8(98),tileType:r.getUint8(99),minZoom:r.getUint8(100),maxZoom:r.getUint8(101),minLon:r.getInt32(102,!0)/1e7,minLat:r.getInt32(106,!0)/1e7,maxLon:r.getInt32(110,!0)/1e7,maxLat:r.getInt32(114,!0)/1e7,centerZoom:r.getUint8(118),centerLon:r.getInt32(119,!0)/1e7,centerLat:r.getInt32(123,!0)/1e7,etag:e}}function J6(t){let e={buf:new Uint8Array(t),pos:0},r=T_(e),i=[],n=0;for(let o=0;o<r;o++){let a=T_(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let o=0;o<r;o++)i[o].runLength=T_(e);for(let o=0;o<r;o++)i[o].length=T_(e);for(let o=0;o<r;o++){let a=T_(e);a===0&&o>0?i[o].offset=i[o-1].offset+i[o-1].length:i[o].offset=a-1}return i}function QX(t){let e=new DataView(t);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var bC=class extends Error{};function JX(t,e){return Ls(this,null,function*(){let r=yield t.getBytes(0,16384);if(new DataView(r.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(QX(r.data)<3)return[yield Y6.getHeader(t)];let n=r.data.slice(0,ZX),o=KX(n,r.etag),a=r.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),c=`${t.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,h=J6(yield e(a,o.internalCompression));return[o,[c,h.length,h]]})}function eY(t,e,r,i,n){return Ls(this,null,function*(){let o=yield t.getBytes(r,i,void 0,n.etag),a=yield e(o.data,n.internalCompression),c=J6(a);if(c.length===0)throw new Error("Empty directory is invalid");return c})}var tY=class{constructor(t=100,e=!0,r=Q6){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=r}getHeader(t){return Ls(this,null,function*(){let e=t.getKey(),r=this.cache.get(e);if(r)return r.lastUsed=this.counter++,yield r.data;let i=new Promise((n,o)=>{JX(t,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{o(a)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(t,e,r,i){return Ls(this,null,function*(){let n=`${t.getKey()}|${i.etag||""}|${e}|${r}`,o=this.cache.get(n);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((c,h)=>{eY(t,this.decompress,e,r,i).then(p=>{c(p),this.prune()}).catch(p=>{h(p)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}getArrayBuffer(t,e,r,i){return Ls(this,null,function*(){let n=`${t.getKey()}|${i.etag||""}|${e}|${r}`,o=this.cache.get(n);if(o)return o.lastUsed=this.counter++,yield o.data;let a=new Promise((c,h)=>{t.getBytes(e,r,void 0,i.etag).then(p=>{c(p.data),this.cache.has(n),this.prune()}).catch(p=>{h(p)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((r,i)=>{r.lastUsed<t&&(t=r.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(t){return Ls(this,null,function*(){let e=t.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(t.getKey());let r=new Promise((i,n)=>{this.getHeader(t).then(o=>{i(),this.invalidations.delete(e)}).catch(o=>{n(o)})});this.invalidations.set(e,r)})}},N0=class{constructor(t,e,r){typeof t=="string"?this.source=new YX(t):this.source=t,r?this.decompress=r:this.decompress=Q6,e?this.cache=e:this.cache=new tY}getHeader(){return Ls(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,r,i){return Ls(this,null,function*(){let n=$X(t,e,r),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Y6.getZxy(o,this.source,this.cache,t,e,r,i);if(t<o.minZoom||t>o.maxZoom)return;let a=o.rootDirectoryOffset,c=o.rootDirectoryLength;for(let h=0;h<=3;h++){let p=yield this.cache.getDirectory(this.source,a,c,o),x=XX(p,n);if(x){if(x.runLength>0){let T=yield this.source.getBytes(o.tileDataOffset+x.offset,x.length,i,o.etag);return{data:yield this.decompress(T.data,o.tileCompression),cacheControl:T.cacheControl,expires:T.expires}}a=o.leafDirectoryOffset+x.offset,c=x.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(t,e,r,i){return Ls(this,null,function*(){try{return yield this.getZxyAttempt(t,e,r,i)}catch(n){if(n instanceof bC)return this.cache.invalidate(this.source),yield this.getZxyAttempt(t,e,r,i);throw n}})}getMetadataAttempt(){return Ls(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),r=yield this.decompress(e.data,t.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(r))})}getMetadata(){return Ls(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof bC)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw t}})}getTileJson(t){return Ls(this,null,function*(){let e=yield this.getHeader(),r=yield this.getMetadata(),i=qX(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${t}/{z}/{x}/{y}${i}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};async function el(t,e,r,i){return i._parse(t,e,r,i)}function Si(t,e){if(!t)throw new Error(e||"loader assertion failed.")}var bu={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},rY=bu.self||bu.window||bu.global||{},iY=bu.window||bu.self||bu.global||{},nY=bu.global||bu.self||bu.window||{},oY=bu.document||{};var Oh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var eL=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),sY=eL&&parseFloat(eL[1])||0;var Y2=globalThis,aY=globalThis.document||{},K2=globalThis.process||{},lY=globalThis.console,tL=globalThis.navigator||{};function Q2(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let e=typeof navigator<"u"&&navigator.userAgent,r=t||e;return!!(r&&r.indexOf("Electron")>=0)}function aa(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Q2()}function wC(t){return!t&&!aa()?"Node":Q2(t)?"Electron":(t||tL.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var TC="4.1.0";function uY(t){try{let e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}var J2=class{constructor(e,r,i="sessionStorage"){this.storage=uY(i),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){let r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}};function rL(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function iL(t,e=8){let r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var eb;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(eb||(eb={}));var hY=10;function nL(t){return typeof t!="string"?t:(t=t.toUpperCase(),eb[t]||eb.WHITE)}function oL(t,e,r){return!aa&&typeof t=="string"&&(e&&(t=`\x1B[${nL(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${nL(r)+hY}m${t}\x1B[49m`)),t}function sL(t,e=["constructor"]){let r=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(r),n=t;for(let o of i){let a=n[o];typeof a=="function"&&(e.find(c=>o===c)||(n[o]=a.bind(t)))}}function S_(t,e){if(!t)throw new Error(e||"Assertion failed")}function Pp(){let t;if(aa()&&Y2.performance)t=Y2?.performance?.now?.();else if("hrtime"in K2){let e=K2?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}var z0={debug:aa()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},fY={enabled:!0,level:0};function U0(){}var aL={},lL={once:!0},Ia=class{constructor({id:e}={id:""}){this.VERSION=TC,this._startTs=Pp(),this._deltaTs=Pp(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new J2(`__probe-${this.id}__`,fY),this.timeStamp(`${this.id} started`),sL(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Pp()-this._startTs).toPrecision(10))}getDelta(){return Number((Pp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,z0.warn,arguments,lL)}error(e){return this._getLogFunction(0,e,z0.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,z0.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,z0.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,z0.debug||z0.info,arguments,lL)}table(e,r,i){return r?this._getLogFunction(e,r,console.table||U0,i&&[i],{tag:pY(r)}):U0}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||U0)}group(e,r,i={collapsed:!1}){let n=cL({logLevel:e,message:r,opts:i}),{collapsed:o}=i;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,r,i={}){return this.group(e,r,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||U0)}withGroup(e,r,i){this.group(e,r)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=uL(e)}_getLogFunction(e,r,i,n,o){if(this._shouldLog(e)){o=cL({logLevel:e,message:r,args:n,opts:o}),i=i||o.method,S_(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Pp();let a=o.tag||o.message;if(o.once&&a)if(!aL[a])aL[a]=Pp();else return U0;return r=dY(this.id,o.message,o),i.bind(console,r,...o.args)}return U0}};Ia.VERSION=TC;function uL(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return S_(Number.isFinite(e)&&e>=0),e}function cL(t){let{logLevel:e,message:r}=t;t.logLevel=uL(e);let i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&i.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break;default:}typeof t.message=="function"&&(t.message=t.message());let n=typeof t.message;return S_(n==="string"||n==="object"),Object.assign(t,{args:i},t.opts)}function dY(t,e,r){if(typeof e=="string"){let i=r.time?iL(rL(r.total)):"";e=r.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=oL(e,r.color,r.background)}return e}function pY(t){for(let e in t)for(let r in t[e])return r||"untitled";return"empty"}globalThis.probe={};var EC=new Ia({id:"@probe.gl/log"});var CC="4.3.2",AY=CC[0]>="0"&&CC[0]<="9"?`v${CC}`:"";function mY(){let t=new Ia({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=AY,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}var I_=mY();function M_(t,e){return hL(t||{},e)}function hL(t,e,r=0){if(r>3)return e;let i={...t};for(let[n,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?i[n]=hL(i[n]||{},e[n],r+1):i[n]=e[n];return i}function SC(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function IC(t){return globalThis.loaders?.modules?.[t]||null}var fL="latest";function gY(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}var P_=gY();function Os(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}var vu={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Z1e=vu.self||vu.window||vu.global||{},X1e=vu.window||vu.self||vu.global||{},Y1e=vu.global||vu.self||vu.window||{},K1e=vu.document||{};var _s=typeof process!="object"||String(process)!=="[object process]"||process.browser,R_=typeof importScripts=="function",pL=typeof window<"u"&&typeof window.orientation<"u",dL=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Q1e=dL&&parseFloat(dL[1])||0;var B_=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){Os(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Os(this.isRunning),this.isRunning=!1,this._reject(e)}};var V0=class{terminate(){}};var MC=new Map;function AL(t){Os(t.source&&!t.url||!t.source&&t.url);let e=MC.get(t.source||t.url);return e||(t.url&&(e=_Y(t.url),MC.set(t.url,e)),t.source&&(e=mL(t.source),MC.set(t.source,e))),Os(e),e}function _Y(t){if(!t.startsWith("http"))return t;let e=yY(t);return mL(e)}function mL(t){let e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function yY(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function PC(t,e=!0,r){let i=r||new Set;if(t){if(gL(t))i.add(t);else if(gL(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(let n in t)PC(t[n],e,i)}}return r===void 0?Array.from(i):[]}function gL(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}var RC=()=>{},id=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&_s||typeof V0<"u"&&!_s}constructor(e){let{name:r,source:i,url:n}=e;Os(i||n),this.name=r,this.source=i,this.url=n,this.onMessage=RC,this.onError=o=>console.log(o),this.worker=_s?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=RC,this.onError=RC,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||PC(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=AL({source:this.source,url:this.url});let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){let i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new V0(i,{eval:!1})}else if(this.source)e=new V0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}};var L_=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return id.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(n,o,a)=>n.done(a),i=(n,o)=>n.error(o)){let n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:r,onError:i,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});let i=new B_(r.name,e);e.onMessage=n=>r.onMessage(i,n.type,n.payload),e.onError=n=>r.onError(i,n),r.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!_s||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new id({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return pL?this.maxMobileConcurrency:this.maxConcurrency}};var xY={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Rp=class t{props;workerPools=new Map;static _workerFarm;static isSupported(){return id.isSupported()}static getWorkerFarm(e={}){return t._workerFarm=t._workerFarm||new t({}),t._workerFarm.setProps(e),t._workerFarm}constructor(e){this.props={...xY},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:r,source:i,url:n}=e,o=this.workerPools.get(r);return o||(o=new L_({name:r,source:i,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function BC(t,e={}){let r=e[t.id]||{},i=_s?`${t.id}-worker.js`:`${t.id}-worker-node.js`,n=r.workerUrl;if(!n&&t.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(_s?n=`modules/${t.module}/dist/${i}`:n=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!n){let o=t.version;o==="latest"&&(o=fL);let a=o?`@${o}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${a}/dist/${i}`}return Os(n),n}function LC(t,e=P_){Os(t,"no worker provided");let r=t.version;return!(!e||!r)}var OC={};async function wu(t,e=null,r={},i=null){return e&&(t=_L(t,e,r,i)),OC[t]=OC[t]||bY(t),await OC[t]}function _L(t,e,r={},i=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;i=i||t;let n=r.modules||{};return n[i]?n[i]:_s?r.CDN?(Os(r.CDN.startsWith("http")),`${r.CDN}/${e}@${P_}/dist/libs/${i}`):R_?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function bY(t){if(t.endsWith("wasm"))return await wY(t);if(!_s)try{let{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(R_)return importScripts(t);let e=await TY(t);return vY(e,t)}function vY(t,e){if(!_s){let{requireFromString:i}=globalThis.loaders||{};return i?.(t,e)}if(R_)return eval.call(globalThis,t),null;let r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function wY(t){let{readFileAsArrayBuffer:e}=globalThis.loaders||{};return _s||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function TY(t){let{readFileAsText:e}=globalThis.loaders||{};return _s||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function DC(t,e){return!Rp.isSupported()||!_s&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function FC(t,e,r,i,n){let o=t.id,a=BC(t,r),h=Rp.getWorkerFarm(r).getWorkerPool({name:o,url:a});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));let p=await h.startJob("process-on-worker",EY.bind(null,n));return p.postMessage("process",{input:e,options:r,context:i}),await(await p.result).result}async function EY(t,e,r,i){switch(r){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":let{id:n,input:o,options:a}=i;try{let c=await t(o,a);e.postMessage("done",{id:n,result:c})}catch(c){let h=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:n,error:h})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function xL(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?yL(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?yL(t,0,e):""}function yL(t,e,r){if(t.byteLength<=e+r)return"";let i=new DataView(t),n="";for(let o=0;o<r;o++)n+=String.fromCharCode(i.getUint8(e+o));return n}function kC(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${xL(t)}"`)}}function NC(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;let i=new Uint8Array(t),n=new Uint8Array(e);for(let o=0;o<i.length;++o)if(i[o]!==n[o])return!1;return!0}function zC(...t){return bL(t)}function bL(t){let e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),r=e.reduce((o,a)=>o+a.byteLength,0),i=new Uint8Array(r),n=0;for(let o of e)i.set(o,n),n+=o.byteLength;return i.buffer}function O_(...t){let e=t,r=e&&e.length>1&&e[0].constructor||null;if(!r)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');let i=e.reduce((a,c)=>a+c.length,0),n=new r(i),o=0;for(let a of e)n.set(a,o),o+=a.length;return n}function Bp(t,e,r){let i=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function nd(t,e){return Si(t>=0),Si(e>0),t+(e-1)&~(e-1)}function UC(t,e,r){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{let n=t.byteOffset,o=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,n,o)}return e.set(i,r),r+nd(i.byteLength,4)}async function VC(t){let e=[];for await(let r of t)e.push(r);return zC(...e)}function D_(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){let e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}var Lp=class{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=D_(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(D_()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Gs=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let e of Object.values(this.stats))e.reset();return this}forEach(e){for(let r of Object.values(this.stats))e(r)}getTable(){let e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){let{name:r,type:i}=e,n=this.stats[r];return n||(e instanceof Lp?n=e:n=new Lp(r,i),this.stats[r]=n),n}};var CY="Queued Requests",SY="Active Requests",IY="Cancelled Requests",MY="Queued Requests Ever",PY="Active Requests Ever",RY={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},od=class{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...RY,...e},this.stats=new Gs({id:this.props.id}),this.stats.get(CY),this.stats.get(SY),this.stats.get(IY),this.stats.get(MY),this.stats.get(PY)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let i={handle:e,priority:0,getPriority:r},n=new Promise(o=>(i.resolve=o,i));return this.requestQueue.push(i),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){let{handle:r,resolve:i}=e,n=!1,o=()=>{n||(n=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){let i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){let e=this.requestQueue;for(let r=0;r<e.length;++r){let i=e[r];this._updateRequest(i)||(e.splice(r,1),this.requestMap.delete(i.handle),r--)}e.sort((r,i)=>r.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}};var BY="",vL={};function jC(t){for(let e in vL)if(t.startsWith(e)){let r=vL[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${BY}${t}`),t}function wL(t){return t&&typeof t=="object"&&t.isBuffer}function tb(t){if(wL(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){let e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}var tl={};no(tl,{dirname:()=>OY,filename:()=>LY,join:()=>DY,resolve:()=>FY});function TL(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function LY(t){let e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function OY(t){let e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function DY(...t){let e="/";return t=t.map((r,i)=>(i&&(r=r.replace(new RegExp(`^${e}`),"")),i!==t.length-1&&(r=r.replace(new RegExp(`${e}$`),"")),r)),t.join(e)}function FY(...t){let e=[];for(let o=0;o<t.length;o++)e[o]=t[o];let r="",i=!1,n;for(let o=e.length-1;o>=-1&&!i;o--){let a;o>=0?a=e[o]:(n===void 0&&(n=TL()),a=n),a.length!==0&&(r=`${a}/${r}`,i=a.charCodeAt(0)===F_)}return r=kY(r,!i),i?`/${r}`:r.length>0?r:"."}var F_=47,GC=46;function kY(t,e){let r="",i=-1,n=0,o,a=!1;for(let c=0;c<=t.length;++c){if(c<t.length)o=t.charCodeAt(c);else{if(o===F_)break;o=F_}if(o===F_){if(!(i===c-1||n===1))if(i!==c-1&&n===2){if(r.length<2||!a||r.charCodeAt(r.length-1)!==GC||r.charCodeAt(r.length-2)!==GC){if(r.length>2){let h=r.length-1,p=h;for(;p>=0&&r.charCodeAt(p)!==F_;--p);if(p!==h){r=p===-1?"":r.slice(0,p),i=c,n=0,a=!1;continue}}else if(r.length===2||r.length===1){r="",i=c,n=0,a=!1;continue}}e&&(r.length>0?r+="/..":r="..",a=!0)}else{let h=t.slice(i+1,c);r.length>0?r+=`/${h}`:r=h,a=!1}i=c,n=0}else o===GC&&n!==-1?++n:n=-1}return r}var rb=class{fetch;loadOptions;_needsRefresh=!0;props;constructor(e){this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=NY(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){let r=this._needsRefresh;return e&&(this._needsRefresh=!1),r}};function NY(t){let e=t?.fetch;if(e&&typeof e=="function")return(i,n)=>e(i,n);let r=t?.fetch;return r&&typeof r!="function"?i=>fetch(i,r):i=>fetch(i)}var Tu=class extends rb{static type="template";static testURL=e=>!1};var zY=t=>typeof t=="boolean",k_=t=>typeof t=="function",Op=t=>t!==null&&typeof t=="object",HC=t=>Op(t)&&t.constructor==={}.constructor;var EL=t=>!!t&&typeof t[Symbol.iterator]=="function",CL=t=>t&&typeof t[Symbol.asyncIterator]=="function";var wl=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json;var Tl=t=>typeof Blob<"u"&&t instanceof Blob,SL=t=>t&&typeof t=="object"&&t.isBuffer;var UY=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Op(t)&&k_(t.tee)&&k_(t.cancel)&&k_(t.getReader);var VY=t=>Op(t)&&k_(t.read)&&k_(t.pipe)&&zY(t.readable),ib=t=>UY(t)||VY(t);var nb=class extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};var jY=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,GY=/^([-\w.]+\/[-\w.+]+)/;function WC(t,e){return t.toLowerCase()===e.toLowerCase()}function IL(t){let e=GY.exec(t);return e?e[1]:t}function $C(t){let e=jY.exec(t);return e?e[1]:""}var ML=/\?.*/;function PL(t){let e=t.match(ML);return e&&e[0]}function j0(t){return t.replace(ML,"")}function RL(t){if(t.length<50)return t;let e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Dp(t){return wl(t)?t.url:Tl(t)?t.name||"":typeof t=="string"?t:""}function N_(t){if(wl(t)){let e=t,r=e.headers.get("content-type")||"",i=j0(e.url);return IL(r)||$C(i)}return Tl(t)?t.type||"":typeof t=="string"?$C(t):""}function BL(t){return wl(t)?t.headers["content-length"]||-1:Tl(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function ob(t){if(wl(t))return t;let e={},r=BL(t);r>=0&&(e["content-length"]=String(r));let i=Dp(t),n=N_(t);n&&(e["content-type"]=n);let o=await WY(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));let a=new Response(t,{headers:e});return Object.defineProperty(a,"url",{value:i}),a}async function LL(t){if(!t.ok)throw await HY(t)}async function HY(t){let e=RL(t.url),r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;let i={reason:t.statusText,url:t.url,response:t};try{let n=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&n?.includes("application/json")?await t.json():await t.text()}catch{}return new nb(r,i)}async function WY(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){let r=t.slice(0,5);return await new Promise(i=>{let n=new FileReader;n.onload=o=>i(o?.target?.result),n.readAsDataURL(r)})}if(t instanceof ArrayBuffer){let r=t.slice(0,5);return`data:base64,${$Y(r)}`}return null}function $Y(t){let e="",r=new Uint8Array(t);for(let i=0;i<r.byteLength;i++)e+=String.fromCharCode(r[i]);return btoa(e)}function qY(t){return!ZY(t)&&!XY(t)}function ZY(t){return t.startsWith("http:")||t.startsWith("https:")}function XY(t){return t.startsWith("data:")}async function qC(t,e){if(typeof t=="string"){let r=jC(t);return qY(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await ob(t)}var ZC=new Ia({id:"loaders.gl"}),sb=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},ab=class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};var XC={fetch:null,mimeType:void 0,nothrow:!1,log:new ab,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Oh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},OL={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function YC(){globalThis.loaders=globalThis.loaders||{};let{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function KC(){let t=YC();return t.globalOptions=t.globalOptions||{...XC},t.globalOptions}function kL(t,e,r,i){return r=r||[],r=Array.isArray(r)?r:[r],YY(t,r),QY(e,t,i)}function YY(t,e){DL(t,null,XC,OL,e);for(let r of e){let i=t&&t[r.id]||{},n=r.options&&r.options[r.id]||{},o=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};DL(i,r.id,n,o,e)}}function DL(t,e,r,i,n){let o=e||"Top level",a=e?`${e}.`:"";for(let c in t){let h=!e&&Op(t[c]),p=c==="baseUri"&&!e,x=c==="workerUrl"&&e;if(!(c in r)&&!p&&!x){if(c in i)ZC.warn(`${o} loader option '${a}${c}' no longer supported, use '${i[c]}'`)();else if(!h){let T=KY(c,n);ZC.warn(`${o} loader option '${a}${c}' not recognized. ${T}`)()}}}}function KY(t,e){let r=t.toLowerCase(),i="";for(let n of e)for(let o in n.options){if(t===o)return`Did you mean '${n.id}.${o}'?`;let a=o.toLowerCase();(r.startsWith(a)||a.startsWith(r))&&(i=i||`Did you mean '${n.id}.${o}'?`)}return i}function QY(t,e,r){let n={...t.options||{}};return JY(n,r),n.log===null&&(n.log=new sb),FL(n,KC()),FL(n,e),n}function FL(t,e){for(let r in e)if(r in e){let i=e[r];HC(i)&&HC(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function JY(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function z_(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function U_(t){Si(t,"null loader"),Si(z_(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}var NL=()=>{let t=YC();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function QC(t){let e=NL();t=Array.isArray(t)?t:[t];for(let r of t){let i=U_(r);e.find(n=>i===n)||e.unshift(i)}}function zL(){return NL()}var eK=/\.([^.]+)$/;async function jL(t,e=[],r,i){if(!HL(t))return null;let n=UL(t,e,{...r,nothrow:!0},i);if(n)return n;if(Tl(t)&&(t=await t.slice(0,10).arrayBuffer(),n=UL(t,e,r,i)),!n&&!r?.nothrow)throw new Error(WL(t));return n}function UL(t,e=[],r,i){if(!HL(t))return null;if(e&&!Array.isArray(e))return U_(e);let n=[];e&&(n=n.concat(e)),r?.ignoreRegisteredLoaders||n.push(...zL()),rK(n);let o=tK(t,n,r,i);if(!o&&!r?.nothrow)throw new Error(WL(t));return o}function tK(t,e,r,i){let n=Dp(t),o=N_(t),a=j0(n)||i?.url,c=null,h="";return r?.mimeType&&(c=JC(e,r?.mimeType),h=`match forced by supplied MIME type ${r?.mimeType}`),c=c||iK(e,a),h=h||(c?`matched url ${a}`:""),c=c||JC(e,o),h=h||(c?`matched MIME type ${o}`:""),c=c||oK(e,t),h=h||(c?`matched initial data ${$L(t)}`:""),r?.fallbackMimeType&&(c=c||JC(e,r?.fallbackMimeType),h=h||(c?`matched fallback MIME type ${o}`:"")),h&&I_.log(1,`selectLoader selected ${c?.name}: ${h}.`),c}function HL(t){return!(t instanceof Response&&t.status===204)}function WL(t){let e=Dp(t),r=N_(t),i="No valid loader found (";i+=e?`${tl.filename(e)}, `:"no url provided, ",i+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let n=t?$L(t):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function rK(t){for(let e of t)U_(e)}function iK(t,e){let r=e&&eK.exec(e),i=r&&r[1];return i?nK(t,i):null}function nK(t,e){e=e.toLowerCase();for(let r of t)for(let i of r.extensions)if(i.toLowerCase()===e)return r;return null}function JC(t,e){for(let r of t)if(r.mimeTypes?.some(i=>WC(e,i))||WC(e,`application/x.${r.id}`))return r;return null}function oK(t,e){if(!e)return null;for(let r of t)if(typeof e=="string"){if(sK(e,r))return r}else if(ArrayBuffer.isView(e)){if(VL(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&VL(e,0,r))return r;return null}function sK(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function VL(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>aK(t,e,r,n))}function aK(t,e,r,i){if(i instanceof ArrayBuffer)return NC(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":let n=eS(t,e,i.length);return i===n;default:return!1}}function $L(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?eS(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?eS(t,0,e):""}function eS(t,e,r){if(t.byteLength<e+r)return"";let i=new DataView(t),n="";for(let o=0;o<r;o++)n+=String.fromCharCode(i.getUint8(e+o));return n}function*qL(t,e){let r=e?.chunkSize||262144,i=0,n=new TextEncoder;for(;i<t.length;){let o=Math.min(t.length-i,r),a=t.slice(i,i+o);i+=o,yield n.encode(a)}}function*ZL(t,e={}){let{chunkSize:r=262144}=e,i=0;for(;i<t.byteLength;){let n=Math.min(t.byteLength-i,r),o=new ArrayBuffer(n),a=new Uint8Array(t,i,n);new Uint8Array(o).set(a),i+=n,yield o}}async function*XL(t,e){let r=e?.chunkSize||1048576,i=0;for(;i<t.size;){let n=i+r,o=await t.slice(i,n).arrayBuffer();i=n,yield o}}function tS(t,e){return Oh?lK(t,e):cK(t,e)}async function*lK(t,e){let r=t.getReader(),i;try{for(;;){let n=i||r.read();e?._streamReadAhead&&(i=r.read());let{done:o,value:a}=await n;if(o)return;yield tb(a)}}catch{r.releaseLock()}}async function*cK(t,e){for await(let r of t)yield tb(r)}function YL(t,e){if(typeof t=="string")return qL(t,e);if(t instanceof ArrayBuffer)return ZL(t,e);if(Tl(t))return XL(t,e);if(ib(t))return tS(t,e);if(wl(t))return tS(t.body,e);throw new Error("makeIterator")}var KL="Cannot convert supplied data type";function uK(t,e,r){if(e.text&&typeof t=="string")return t;if(SL(t)&&(t=t.buffer),t instanceof ArrayBuffer){let i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer,n=t.byteLength||t.length;return(t.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+n)),i}throw new Error(KL)}async function QL(t,e,r){let i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return uK(t,e,r);if(Tl(t)&&(t=await ob(t)),wl(t)){let n=t;return await LL(n),e.binary?await n.arrayBuffer():await n.text()}if(ib(t)&&(t=YL(t,r)),EL(t)||CL(t))return VC(t);throw new Error(KL)}function lb(t,e){let r=KC(),i=t||r;return typeof i.fetch=="function"?i.fetch:Op(i.fetch)?n=>qC(n,i.fetch):e?.fetch?e?.fetch:qC}function JL(t,e,r){if(r)return r;let i={fetch:lb(e,t),...t};if(i.url){let n=j0(i.url);i.baseUrl=n,i.queryString=PL(i.url),i.filename=tl.filename(n),i.baseUrl=tl.dirname(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function eO(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){let i=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...i]:i}return r&&r.length?r:void 0}async function V_(t,e,r,i){e&&!Array.isArray(e)&&!z_(e)&&(i=void 0,r=e,e=void 0),t=await t,r=r||{};let n=Dp(t),a=eO(e,i),c=await jL(t,a,r);return c?(r=kL(r,c,a,n),i=JL({url:n,_parse:V_,loaders:a},r,i||null),await hK(c,t,r,i)):null}async function hK(t,e,r,i){if(LC(t),r=M_(t.options,r),wl(e)){let o=e,{ok:a,redirected:c,status:h,statusText:p,type:x,url:T}=o,R=Object.fromEntries(o.headers.entries());i.response={headers:R,ok:a,redirected:c,status:h,statusText:p,type:x,url:T}}e=await QL(e,t,r);let n=t;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,r,i);if(DC(t,r))return await FC(t,e,r,i,V_);if(n.parseText&&typeof e=="string")return await n.parseText(e,r,i);if(n.parse)return await n.parse(e,r,i);throw Os(!n.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function tO(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Dh(t){let e=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0,c=t.POSITION?t.POSITION.value:[],h=c&&c.length;for(let p=0;p<h;p+=3){let x=c[p],T=c[p+1],R=c[p+2];e=x<e?x:e,r=T<r?T:r,i=R<i?R:i,n=x>n?x:n,o=T>o?T:o,a=R>a?R:a}return[[e,r,i],[n,o,a]]}function rS(t,e,r){let i=tO(e.value),n=r||rO(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:n}}function rO(t){let e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function ys(t,e,r,i){let n,o;!Array.isArray(e)&&!z_(e)?(n=[],o=e,i=void 0):(n=e,o=r);let a=lb(o),c=t;return typeof t=="string"&&(c=await a(t)),Tl(t)&&(c=await a(t)),Array.isArray(n)?await V_(c,n,o):await V_(c,n,o)}var iO="4.3.2";var fK=globalThis.loaders?.parseImageNode,iS=typeof Image<"u",nS=typeof ImageBitmap<"u",dK=!!fK,oS=Oh?!0:dK;function nO(t){switch(t){case"auto":return nS||iS||oS;case"imagebitmap":return nS;case"image":return iS;case"data":return oS;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function oO(){if(nS)return"imagebitmap";if(iS)return"image";if(oS)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function sO(t){let e=pK(t);if(!e)throw new Error("Not an image");return e}function j_(t){switch(sO(t)){case"data":return t;case"image":case"imagebitmap":let e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function pK(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}var AK=/^data:image\/svg\+xml/,mK=/\.svg((\?|#).*)?$/;function cb(t){return t&&(AK.test(t)||mK.test(t))}function aO(t,e){if(cb(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return sS(t,e)}function sS(t,e){if(cb(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function ub(t,e,r){let i=aO(t,r),n=self.URL||self.webkitURL,o=typeof i!="string"&&n.createObjectURL(i);try{return await gK(o||i,e)}finally{o&&n.revokeObjectURL(o)}}async function gK(t,e){let r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,n)=>{try{r.onload=()=>i(r),r.onerror=o=>{let a=o instanceof Error?o.message:"error";n(new Error(a))}}catch(o){n(o)}})}var _K={},lO=!0;async function cO(t,e,r){let i;cb(r)?i=await ub(t,e,r):i=sS(t,r);let n=e&&e.imagebitmap;return await yK(i,n)}async function yK(t,e=null){if((xK(e)||!lO)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),lO=!1}return await createImageBitmap(t)}function xK(t){for(let e in t||_K)return!1;return!0}function uO(t){return!TK(t,"ftyp",4)||!(t[8]&96)?null:bK(t)}function bK(t){switch(vK(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function vK(t,e,r){return String.fromCharCode(...t.slice(e,r))}function wK(t){return[...t].map(e=>e.charCodeAt(0))}function TK(t,e,r=0){let i=wK(e);for(let n=0;n<i.length;++n)if(i[n]!==t[n+r])return!1;return!0}var Eu=!1,G_=!0;function Fp(t){let e=H_(t);return CK(e)||MK(e)||SK(e)||IK(e)||EK(e)}function EK(t){let e=new Uint8Array(t instanceof DataView?t.buffer:t),r=uO(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function CK(t){let e=H_(t);return e.byteLength>=24&&e.getUint32(0,Eu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Eu),height:e.getUint32(20,Eu)}:null}function SK(t){let e=H_(t);return e.byteLength>=10&&e.getUint32(0,Eu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,G_),height:e.getUint16(8,G_)}:null}function IK(t){let e=H_(t);return e.byteLength>=14&&e.getUint16(0,Eu)===16973&&e.getUint32(2,G_)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,G_),height:e.getUint32(22,G_)}:null}function MK(t){let e=H_(t);if(!(e.byteLength>=3&&e.getUint16(0,Eu)===65496&&e.getUint8(2)===255))return null;let{tableMarkers:i,sofMarkers:n}=PK(),o=2;for(;o+9<e.byteLength;){let a=e.getUint16(o,Eu);if(n.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Eu),width:e.getUint16(o+7,Eu)};if(!i.has(a))return null;o+=2,o+=e.getUint16(o,Eu)}return null}function PK(){let t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function H_(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function hO(t,e){let{mimeType:r}=Fp(t)||{},i=globalThis.loaders?.parseImageNode;return Si(i),await i(t,r)}async function fO(t,e,r){e=e||{};let n=(e.image||{}).type||"auto",{url:o}=r||{},a=RK(n),c;switch(a){case"imagebitmap":c=await cO(t,e,o);break;case"image":c=await ub(t,e,o);break;case"data":c=await hO(t,e);break;default:Si(!1)}return n==="data"&&(c=j_(c)),c}function RK(t){switch(t){case"auto":case"data":return oO();default:return nO(t),t}}var BK=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],LK=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],OK={image:{type:"auto",decode:!0}},sd={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:iO,mimeTypes:LK,extensions:BK,parse:fO,tests:[t=>!!Fp(new DataView(t))],options:OK};var aS={};function lS(t){if(aS[t]===void 0){let e=Oh?FK(t):DK(t);aS[t]=e}return aS[t]}function DK(t){let e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function FK(t){switch(t){case"image/avif":case"image/webp":return kK(t);default:return!0}}function kK(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}var NK=new Ia({id:"deck"}),cr=NK;var cS={};function dO(t){cS=t}function mo(t,e,r,i){cr.level>0&&cS[t]&&cS[t].call(null,e,r,i)}function zK(t){let e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}var pO={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:zK,parseTextSync:JSON.parse};function UK(){let t="9.1.11",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(cr.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:cr,_registerLoggers:dO},QC([pO,[sd,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}var AO=UK();function hb(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}var uS={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function gO(t){let e={};for(let[r,i]of Object.entries(t))e[r]=VK(i);return e}function VK(t){let e=mO(t);if(e!=="object")return{value:t,...uS[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...uS[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=mO(t.value),{...t,...uS[e],type:e}):{type:"object",value:null};throw new Error("props")}function mO(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}var _O=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,yO=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var jK={vertex:_O,fragment:yO},xO=/void\s+main\s*\([^)]*\)\s*\{\n?/,bO=/}\n?[^{}]*$/,hS=[],W_="__LUMA_INJECT_DECLARATIONS__";function vO(t){let e={vertex:{},fragment:{}};for(let r in t){let i=t[r],n=GK(r);typeof i=="string"&&(i={order:0,injection:i}),e[n][r]=i}return e}function GK(t){let e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function $_(t,e,r,i=!1){let n=e==="vertex";for(let o in r){let a=r[o];a.sort((h,p)=>h.order-p.order),hS.length=a.length;for(let h=0,p=a.length;h<p;++h)hS[h]=a[h].injection;let c=`${hS.join(`
`)}
`;switch(o){case"vs:#decl":n&&(t=t.replace(W_,c));break;case"vs:#main-start":n&&(t=t.replace(xO,h=>h+c));break;case"vs:#main-end":n&&(t=t.replace(bO,h=>c+h));break;case"fs:#decl":n||(t=t.replace(W_,c));break;case"fs:#main-start":n||(t=t.replace(xO,h=>h+c));break;case"fs:#main-end":n||(t=t.replace(bO,h=>c+h));break;default:t=t.replace(o,h=>h+c)}}return t=t.replace(W_,""),i&&(t=t.replace(/\}\s*$/,o=>o+jK[e])),t}function G0(t){t.map(e=>HK(e))}function HK(t){if(t.instance)return;G0(t.dependencies||[]);let{propTypes:e={},deprecations:r=[],inject:i={}}=t,n={normalizedInjections:vO(i),parsedDeprecations:WK(r)};e&&(n.propValidators=gO(e)),t.instance=n;let o={};e&&(o=Object.entries(e).reduce((a,[c,h])=>{let p=h?.value;return p&&(a[c]=p),a},{})),t.defaultUniforms={...t.defaultUniforms,...o}}function fS(t,e,r){t.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}function WK(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function H0(t){G0(t);let e={},r={};wO({modules:t,level:0,moduleMap:e,moduleDepth:r});let i=Object.keys(r).sort((n,o)=>r[o]-r[n]).map(n=>e[n]);return G0(i),i}function wO(t){let{modules:e,level:r,moduleMap:i,moduleDepth:n}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let o of e)i[o.name]=o,(n[o.name]===void 0||n[o.name]<r)&&(n[o.name]=r);for(let o of e)o.dependencies&&wO({modules:o.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}function TO(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function CO(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=EO(t,$K),t;case"fragment":return t=EO(t,qK),t;default:throw new Error(e)}}var SO=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],$K=[...SO,[dS("attribute"),"in $1"],[dS("varying"),"out $1"]],qK=[...SO,[dS("varying"),"in $1"]];function EO(t,e){for(let[r,i]of e)t=t.replace(r,i);return t}function dS(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function pS(t,e){let r="";for(let i in t){let n=t[i];if(r+=`void ${n.signature} {
`,n.header&&(r+=`  ${n.header}`),e[i]){let o=e[i];o.sort((a,c)=>a.order-c.order);for(let a of o)r+=`  ${a.injection}
`}n.footer&&(r+=`  ${n.footer}`),r+=`}
`}return r}function AS(t){let e={vertex:{},fragment:{}};for(let r of t){let i,n;typeof r!="string"?(i=r,n=i.hook):(i={},n=r),n=n.trim();let[o,a]=n.split(":"),c=n.replace(/\(.+/,""),h=Object.assign(i,{signature:a});switch(o){case"vs":e.vertex[c]=h;break;case"fs":e.fragment[c]=h;break;default:throw new Error(o)}}return e}function IO(t,e){return{name:ZK(t,e),language:"glsl",version:XK(t)}}function ZK(t,e="unnamed"){let i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function XK(t){let e=100,r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}var PO=`

${W_}
`,YK=`precision highp float;
`;function RO(t){let e=H0(t.modules||[]);return{source:KK(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:LO(e)}}function BO(t){let{vs:e,fs:r}=t,i=H0(t.modules||[]);return{vs:MO(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:MO(t.platformInfo,{...t,source:r,stage:"fragment",modules:i}),getUniforms:LO(i)}}function KK(t,e){let{source:r,stage:i,modules:n,hookFunctions:o=[],inject:a={},log:c}=e;hb(typeof r=="string","shader source must be a string");let h=r,p="",x=AS(o),T={},R={},k={};for(let q in a){let Z=typeof a[q]=="string"?{injection:a[q],order:0}:a[q],re=/^(v|f)s:(#)?([\w-]+)$/.exec(q);if(re){let ee=re[2],se=re[3];ee?se==="decl"?R[q]=[Z]:k[q]=[Z]:T[q]=[Z]}else k[q]=[Z]}let j=n;for(let q of j){c&&fS(q,h,c);let Z=OO(q,"wgsl");p+=Z;let re=q.injections?.[i]||{};for(let ee in re){let se=/^(v|f)s:#([\w-]+)$/.exec(ee);if(se){let Le=se[2]==="decl"?R:k;Le[ee]=Le[ee]||[],Le[ee].push(re[ee])}else T[ee]=T[ee]||[],T[ee].push(re[ee])}}return p+=PO,p=$_(p,i,R),p+=pS(x[i],T),p+=h,p=$_(p,i,k),p}function MO(t,e){let{id:r,source:i,stage:n,language:o="glsl",modules:a,defines:c={},hookFunctions:h=[],inject:p={},prologue:x=!0,log:T}=e;hb(typeof i=="string","shader source must be a string");let R=o==="glsl"?IO(i).version:-1,k=t.shaderLanguageVersion,j=R===100?"#version 100":"#version 300 es",Z=i.split(`
`).slice(1).join(`
`),re={};a.forEach(Je=>{Object.assign(re,Je.defines)}),Object.assign(re,c);let ee="";switch(o){case"wgsl":break;case"glsl":ee=x?`${j}

// ----- PROLOGUE -------------------------
${QK({id:r,source:i,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${TO(t)}
${n==="fragment"?YK:""}

// ----- APPLICATION DEFINES -------------------------

${JK(re)}

`:`${j}
`;break}let se=AS(h),me={},Le={},je={};for(let Je in p){let J=typeof p[Je]=="string"?{injection:p[Je],order:0}:p[Je],te=/^(v|f)s:(#)?([\w-]+)$/.exec(Je);if(te){let X=te[2],ye=te[3];X?ye==="decl"?Le[Je]=[J]:je[Je]=[J]:me[Je]=[J]}else je[Je]=[J]}for(let Je of a){T&&fS(Je,Z,T);let J=OO(Je,n);ee+=J;let te=Je.instance?.normalizedInjections[n]||{};for(let X in te){let ye=/^(v|f)s:#([\w-]+)$/.exec(X);if(ye){let Oe=ye[2]==="decl"?Le:je;Oe[X]=Oe[X]||[],Oe[X].push(te[X])}else me[X]=me[X]||[],me[X].push(te[X])}}return ee+="// ----- MAIN SHADER SOURCE -------------------------",ee+=PO,ee=$_(ee,n,Le),ee+=pS(se[n],me),ee+=Z,ee=$_(ee,n,je),o==="glsl"&&R!==k&&(ee=CO(ee,n)),ee.trim()}function LO(t){return function(r){let i={};for(let n of t){let o=n.getUniforms?.(r,i);Object.assign(i,o)}return i}}function QK(t){let{id:e,source:r,stage:i}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function JK(t={}){let e="";for(let r in t){let i=t[r];(i||Number.isFinite(i))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function OO(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:hb(!1)}if(!t.name)throw new Error("Shader module must have a name");let i=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),n=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(n+=`#define MODULE_${i}
`),n+=`${r}
`,n}var eQ=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,tQ=/^\s*\#\s*endif\s*$/;function DO(t,e){let r=t.split(`
`),i=[],n=!0,o=null;for(let a of r){let c=a.match(eQ),h=a.match(tQ);c?(o=c[1],n=!!e?.defines?.[o]):h?n=!0:n&&i.push(a)}return i.join(`
`)}var kp=class t{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return t.defaultShaderAssembler=t.defaultShaderAssembler||new t,t.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){let r=this._getModuleList(e.modules),i=this._hookFunctions,{source:n,getUniforms:o}=RO({...e,source:e.source,modules:r,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?DO(n):n,getUniforms:o,modules:r}}assembleGLSLShaderPair(e){let r=this._getModuleList(e.modules),i=this._hookFunctions;return{...BO({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){let r=new Array(this._defaultModules.length+e.length),i={},n=0;for(let o=0,a=this._defaultModules.length;o<a;++o){let c=this._defaultModules[o],h=c.name;r[n++]=c,i[h]=!0}for(let o=0,a=e.length;o<a;++o){let c=e[o],h=c.name;i[h]||(r[n++]=c,i[h]=!0)}return r.length=n,G0(r),r}};var rQ=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,iQ=`#version 300 es
${rQ}`;function q_(t){let{input:e,inputChannels:r,output:i}=t||{};if(!e)return iQ;if(!r)throw new Error("inputChannels");let n=nQ(r),o=FO(e,r);return`#version 300 es
in ${n} ${e};
out vec4 ${i};
void main() {
  ${i} = ${o};
}`}function nQ(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function FO(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}var mS=class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Gs({id:e})),this.stats.get(e)}},fb=new mS;var Vt=new Ia({id:"luma.gl"});var gS={};function ad(t="id"){gS[t]=gS[t]||1;let e=gS[t]++;return`${t}-${e}`}var ci=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,r,i){if(!e)throw new Error("no device");this._device=e,this.props=oQ(r,i);let n=this.props.id!=="undefined"?this.props.id:ad(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(let e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){let i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}};function oQ(t,e){let r={...e};for(let i in t)t[i]!==void 0&&(r[i]=t[i]);return r}var qi=class t extends ci{static defaultProps={...ci.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){let i={...r};(r.usage||0)&t.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,t.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,i){let n=ArrayBuffer.isView(e)?e.buffer:e,o=Math.min(e?e.byteLength:i,t.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&i===n.byteLength?this.debugData=n.slice(0,o):this.debugData=n.slice(r,r+o)}};function db(t){let e=kO[t],r=sQ(e),i=t.includes("norm"),n=!i&&!t.startsWith("float"),o=t.startsWith("s");return{dataType:kO[t],byteLength:r,integer:n,signed:o,normalized:i}}function sQ(t){return aQ[t]}var kO={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},aQ={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var Hs="texture-compression-bc",En="texture-compression-astc",Cu="texture-compression-etc2",lQ="texture-compression-etc1-webgl",pb="texture-compression-pvrtc-webgl",_S="texture-compression-atc-webgl",Ab="float32-renderable-webgl",yS="float16-renderable-webgl",cQ="rgb9e5ufloat-renderable-webgl",xS="snorm8-renderable-webgl",Z_="norm16-renderable-webgl",bS="snorm16-renderable-webgl",mb="float32-filterable",NO="float16-filterable-webgl";function gb(t){let e=uQ[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}var uQ={r8unorm:{},r8snorm:{render:xS},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:xS},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:yS,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Z_},"r16snorm-webgl":{f:bS},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:xS},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:yS,filter:NO},"rg16unorm-webgl":{render:Z_},"rg16snorm-webgl":{render:bS},r32uint:{},r32sint:{},r32float:{render:Ab,filter:mb},rgb9e5ufloat:{channels:"rgb",packed:!0,render:cQ},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Ab},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Z_},"rgb16snorm-webgl":{f:Z_},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:mb},rgba16uint:{},rgba16sint:{},rgba16float:{render:yS,filter:NO},"rgba16unorm-webgl":{render:Z_},"rgba16snorm-webgl":{render:bS},"rgb32float-webgl":{render:Ab,filter:mb},rgba32uint:{},rgba32sint:{},rgba32float:{render:Ab,filter:mb},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Hs},"bc1-rgb-unorm-srgb-webgl":{f:Hs},"bc1-rgba-unorm":{f:Hs},"bc1-rgba-unorm-srgb":{f:Hs},"bc2-rgba-unorm":{f:Hs},"bc2-rgba-unorm-srgb":{f:Hs},"bc3-rgba-unorm":{f:Hs},"bc3-rgba-unorm-srgb":{f:Hs},"bc4-r-unorm":{f:Hs},"bc4-r-snorm":{f:Hs},"bc5-rg-unorm":{f:Hs},"bc5-rg-snorm":{f:Hs},"bc6h-rgb-ufloat":{f:Hs},"bc6h-rgb-float":{f:Hs},"bc7-rgba-unorm":{f:Hs},"bc7-rgba-unorm-srgb":{f:Hs},"etc2-rgb8unorm":{f:Cu},"etc2-rgb8unorm-srgb":{f:Cu},"etc2-rgb8a1unorm":{f:Cu},"etc2-rgb8a1unorm-srgb":{f:Cu},"etc2-rgba8unorm":{f:Cu},"etc2-rgba8unorm-srgb":{f:Cu},"eac-r11unorm":{f:Cu},"eac-r11snorm":{f:Cu},"eac-rg11unorm":{f:Cu},"eac-rg11snorm":{f:Cu},"astc-4x4-unorm":{f:En},"astc-4x4-unorm-srgb":{f:En},"astc-5x4-unorm":{f:En},"astc-5x4-unorm-srgb":{f:En},"astc-5x5-unorm":{f:En},"astc-5x5-unorm-srgb":{f:En},"astc-6x5-unorm":{f:En},"astc-6x5-unorm-srgb":{f:En},"astc-6x6-unorm":{f:En},"astc-6x6-unorm-srgb":{f:En},"astc-8x5-unorm":{f:En},"astc-8x5-unorm-srgb":{f:En},"astc-8x6-unorm":{f:En},"astc-8x6-unorm-srgb":{f:En},"astc-8x8-unorm":{f:En},"astc-8x8-unorm-srgb":{f:En},"astc-10x5-unorm":{f:En},"astc-10x5-unorm-srgb":{f:En},"astc-10x6-unorm":{f:En},"astc-10x6-unorm-srgb":{f:En},"astc-10x8-unorm":{f:En},"astc-10x8-unorm-srgb":{f:En},"astc-10x10-unorm":{f:En},"astc-10x10-unorm-srgb":{f:En},"astc-12x10-unorm":{f:En},"astc-12x10-unorm-srgb":{f:En},"astc-12x12-unorm":{f:En},"astc-12x12-unorm-srgb":{f:En},"pvrtc-rgb4unorm-webgl":{f:pb},"pvrtc-rgba4unorm-webgl":{f:pb},"pvrtc-rbg2unorm-webgl":{f:pb},"pvrtc-rgba2unorm-webgl":{f:pb},"etc1-rbg-unorm-webgl":{f:lQ},"atc-rgb-unorm-webgl":{f:_S},"atc-rgba-unorm-webgl":{f:_S},"atc-rgbai-unorm-webgl":{f:_S}};var hQ=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],fQ=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function vS(t){return hQ.some(e=>t.startsWith(e))}function W0(t){let e=dQ(t);if(vS(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;let i=pQ(t);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}let r=fQ.exec(t);if(r){let[,i,n,o,a,c]=r,h=`${o}${n}`,p=db(h),x=p.byteLength*8,T=i.length,R=[x,T>=2?x:0,T>=3?x:0,T>=4?x:0];e={format:t,attachment:e.attachment,dataType:p.dataType,components:T,channels:i,integer:p.integer,signed:p.signed,normalized:p.normalized,bitsPerChannel:R,bytesPerPixel:p.byteLength*i.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),a==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function dQ(t){let e=gb(t),r=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:r,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function pQ(t){let r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){let[,i,n]=r;return{blockWidth:Number(i),blockHeight:Number(n)}}return null}function zO(t){let e=gb(t),r={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=W0(t),n=t.startsWith("depth")||t.startsWith("stencil"),o=i?.signed,a=i?.integer,c=i?.webgl;return r.render&&=!o,r.filter&&=!n&&!o&&!a&&!c,r}var X_=class{},Y_=class{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}},El=class t{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Vt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Vt.get("debug")||void 0,debugShaders:Vt.get("debug-shaders")||void 0,debugFramebuffers:!!Vt.get("debug-framebuffers"),debugWebGL:!!Vt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...t.defaultProps,...e},this.id=this.props.id||ad(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=fb;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){let r=zO(e),i=a=>(typeof a=="string"?this.features.has(a):a)??!0,n=i(r.create),o={format:e,create:n,render:n&&i(r.render),filter:n&&i(r.filter),blend:n&&i(r.blend),store:n&&i(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(e,r){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return vS(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let r={...e};return(e.usage||0)&qi.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":Vt.warn("indices buffer content must be of integer type")()),r}};var AQ=aa()&&typeof document<"u",mQ=()=>AQ&&document.readyState==="complete",gQ="set luma.log.level=1 (or higher) to trace rendering",UO="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",wS=class t{static defaultProps={...El.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=_Q().then(()=>{Vt.probe(2,"DOM is loaded")()});stats=fb;log=Vt;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Vt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Vt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Vt.error("This version of luma.gl has already been initialized")()}Vt.log(1,`${this.VERSION} - ${gQ}`)(),globalThis.luma=this}registerAdapters(e){for(let r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){let r=this.getAdapterMap(e);return Array.from(r).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){let r=this.getAdapterMap(e);return r.get("webgpu")?.isSupported?.()?"webgpu":r.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(t.defaultProps,e)}async createDevice(e={}){e={...t.defaultProps,...e},e.waitForPageLoad&&await t.pageLoaded;let r=this.getAdapterMap(e.adapters),i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);let a=await(this.getAdapterMap(e.adapters)||r).get(i)?.create?.(e);if(a)return a;throw new Error(UO)}async attachDevice(e){let r=this.getAdapterMap(e.adapters),i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await t.pageLoaded,e.handle===null&&(i="unknown");let o=await r.get(i)?.attach?.(null);if(o)return o;throw new Error(UO)}enforceWebGL2(e=!0,r=[]){let n=this.getAdapterMap(r).get("webgl");n||Vt.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}getAdapterMap(e=[]){let r=new Map(this.preregisteredAdapters);for(let i of e)r.set(i.type,i);return r}registerDevices(e){Vt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(let r of e){let i=r.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}},$0=new wS;function _Q(){return mQ()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}var K_=class{};var Q_=class t{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...t.defaultProps,...e},e=this.props,!aa()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=xQ(e.canvas):this.canvas=e.canvas;else{let r=bQ(e),i=yQ(e?.container||null);i.insertBefore(r,i.firstChild),this.canvas=r,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(let i of r)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{let[e]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){let i=this.cssToDeviceRatio(),[n,o]=this.getDrawingBufferSize();return vQ(e,i,n,o,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let i="width"in r?r.width:this.htmlCanvas.clientWidth,n="height"in r?r.height:this.htmlCanvas.clientHeight;(!i||!n)&&(Vt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);let o=this._canvasSizeInfo;if(o.clientWidth!==i||o.clientHeight!==n||o.devicePixelRatio!==e){let a=e,c=Math.floor(i*a),h=Math.floor(n*a);if(this.htmlCanvas.width=c,this.htmlCanvas.height=h,this.device.gl){let[x,T]=this.getDrawingBufferSize();(x!==c||T!==h)&&(a=Math.min(x/i,T/n),this.htmlCanvas.width=Math.floor(i*a),this.htmlCanvas.height=Math.floor(n*a),Vt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){let e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};function yQ(t){if(typeof t=="string"){let e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function xQ(t){let e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function bQ(t){let{width:e,height:r}=t,i=document.createElement("canvas");return i.id=ad("lumagl-auto-created-canvas"),i.width=e||1,i.height=r||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",i}function vQ(t,e,r,i,n){let o=t,a=VO(o[0],e,r),c=jO(o[1],e,i,n),h=VO(o[0]+1,e,r),p=h===r-1?h:h-1;h=jO(o[1]+1,e,i,n);let x;return n?(h=h===0?h:h+1,x=c,c=h):x=h===i-1?h:h-1,{x:a,y:c,width:Math.max(p-a+1,1),height:Math.max(x-c+1,1)}}function VO(t,e,r){return Math.min(Math.round(t*e),r-1)}function jO(t,e,r,i){return i?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}var on=class t extends ci{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...ci.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,r){if(r=t.normalizeProps(e,r),super(e,r,t.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){let i=t.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?t.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){let r=e?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return t.getTextureDataSize(e[0]);if(t.isExternalImage(e))return t.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){let i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,r){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:r.width,height:r.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,r){return Math.floor(Math.log2(Math.max(e,r)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,r){let i={...r},n=e?.props?._resourceDefaults?.texture||{};Object.assign(i,n);let{width:o,height:a}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}};var Np=class t extends ci{static defaultProps={...ci.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,t.defaultProps)}};function HO(t,e,r){let i="",n=e.split(/\r?\n/),o=t.slice().sort((a,c)=>a.lineNum-c.lineNum);switch(r?.showSourceCode||"no"){case"all":let a=0;for(let c=1;c<=n.length;c++)for(i+=WO(n[c-1],c,r);o.length>a&&o[a].lineNum===c;){let h=o[a++];i+=GO(h,n,h.lineNum,{...r,inlineSource:!1})}return i;case"issues":case"no":for(let c of t)i+=GO(c,n,c.lineNum,{inlineSource:r?.showSourceCode!=="no"});return i}}function GO(t,e,r,i){if(i?.inlineSource){let o=wQ(e,r),a=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${o}${a}${t.type.toUpperCase()}: ${t.message}

`}let n=t.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${n};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function wQ(t,e,r){let i="";for(let n=e-2;n<=e;n++){let o=t[n-1];o!==void 0&&(i+=WO(o,e,r))}return i}function WO(t,e,r){let i=r?.html?EQ(t):t;return`${TQ(String(e),4)}: ${i}${r?.html?"<br/>":`
`}`}function TQ(t,e){let r="";for(let i=t.length;i<e;++i)r+=" ";return r+t}function EQ(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var zp=class t extends ci{static defaultProps={...ci.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){r={...r,debugShaders:r.debugShaders||e.props.debugShaders||"errors"},super(e,{id:CQ(r),...r},t.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();e==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;let r=$O(this.source),i=`${this.stage} ${r}`,n=HO(e,this.source,{showSourceCode:"all",html:!0}),o=this.getTranslatedSource();o&&(n+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);let a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${n}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),a.onclick=()=>{let h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};function CQ(t){return $O(t.source)||t.id||ad(`unnamed ${t.stage}-shader`)}function $O(t,e="unnamed"){let i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}var Up=class t extends ci{static defaultProps={...ci.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=t.normalizeProps(e,r),super(e,r,t.defaultProps)}static normalizeProps(e,r){let i=e?.props?._resourceDefaults?.sampler||{};return{...r,...i}}};var Vp=class t extends ci{static defaultProps={...ci.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,r={}){super(e,r,t.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){let r=this.colorAttachments.map(n=>n.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(e){let r=!e;if(e){let[i,n]=Array.isArray(e)?e:[e.width,e.height];r=r||n!==this.height||i!==this.width,this.width=i,this.height=n}r&&(Vt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){let n=this.createColorTexture(r,i);return this.attachResource(n),n.view}return r instanceof on?r.view:r});let e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){let r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof on?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:on.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:on.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){let n=this.colorAttachments[i].texture.clone({width:e,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){let i=this.depthStencilAttachment.texture.clone({width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};var Su=class t extends ci{static defaultProps={...ci.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,t.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}};var J_=class t extends ci{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...ci.defaultProps,framebuffer:null,parameters:void 0,clearColor:t.defaultClearColor,clearColors:void 0,clearDepth:t.defaultClearDepth,clearStencil:t.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=t.normalizeProps(e,r),super(e,r,t.defaultProps)}static normalizeProps(e,r){return{...e.props._resourceDefaults?.renderPass,...r}}};var q0=class t extends ci{static defaultProps={...ci.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,r){super(e,r,t.defaultProps),this.shaderLayout=r.shaderLayout}};var e1=class t extends ci{static defaultProps={...ci.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,t.defaultProps)}};var t1=class t extends ci{static defaultProps={...ci.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,t.defaultProps)}};function qO(t){let[e,r]=IQ[t],i=e==="i32"||e==="u32",n=e!=="u32",o=MQ[e]*r,a=SQ(e,r);return{dataType:e,components:r,defaultVertexFormat:a,byteLength:o,integer:i,signed:n}}function SQ(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}var IQ={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},MQ={f32:4,f16:2,i32:4,u32:4};function TS(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);let[r,i]=t.split("x"),n=r,o=i?parseInt(i):1,a=db(n),c={type:n,components:o,byteLength:a.byteLength*o,integer:a.integer,signed:a.signed,normalized:a.normalized};return e&&(c.webglOnly=!0),c}function _b(t,e){let r={};for(let i of t.attributes){let n=PQ(t,e,i.name);n&&(r[i.name]=n)}return r}function ZO(t,e,r=16){let i=_b(t,e),n=new Array(r).fill(null);for(let o of Object.values(i))n[o.location]=o;return n}function PQ(t,e,r){let i=RQ(t,r),n=BQ(e,r);if(!i)return null;let o=qO(i.type),a=n?.vertexFormat||o.defaultVertexFormat,c=TS(a);return{attributeName:n?.attributeName||i.name,bufferName:n?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:a,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:o.integer,stepMode:n?.stepMode||i.stepMode||"vertex",byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}function RQ(t,e){let r=t.attributes.find(i=>i.name===e);return r||Vt.warn(`shader layout attribute "${e}" not present in shader`),r||null}function BQ(t,e){LQ(t);let r=OQ(t,e);return r||(r=DQ(t,e),r)?r:(Vt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function LQ(t){for(let e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Vt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function OQ(t,e){for(let r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function DQ(t,e){for(let r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(let o of r.attributes||[]){let a=TS(o.format);i+=a.byteLength}let n=r.attributes?.find(o=>o.attribute===e);if(n)return{attributeName:n.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:i}}return null}var r1=class t extends ci{static defaultProps={...ci.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,t.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);let{shaderLayout:i,bufferLayout:n}=r.renderPipeline||{};if(!i||!n)throw new Error("VertexArray");this.attributeInfos=ZO(i,n,this.maxVertexAttributes)}setConstantWebGL(e,r){this.device.reportError(new Error("constant attributes not supported"))}};var i1=class t extends ci{static defaultProps={...ci.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,t.defaultProps)}};var n1=class t extends ci{static defaultProps={...ci.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,t.defaultProps)}};var FQ={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function XO(t){return FQ[t]}function YO(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}var yb;function ES(t){return(!yb||yb.byteLength<t)&&(yb=new ArrayBuffer(t)),yb}function CS(t,e){let r=ES(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function kQ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Z0(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":kQ(t)}var KO=1024,xb=class{layout={};byteLength;constructor(e){let r=0;for(let[n,o]of Object.entries(e)){let a=XO(o),{type:c,components:h}=a;r=YO(r,h);let p=r;r+=h,this.layout[n]={type:c,size:h,offset:p}}r+=(4-r%4)%4;let i=r*4;this.byteLength=Math.max(i,KO)}getData(e){let r=Math.max(this.byteLength,KO),i=ES(r),n={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(let[o,a]of Object.entries(e)){let c=this.layout[o];if(!c){Vt.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}let{type:h,size:p,offset:x}=c,T=n[h];if(p===1){if(typeof a!="number"&&typeof a!="boolean"){Vt.warn(`Supplied value for single component uniform ${o} is not a number: ${a}`)();continue}T[x]=Number(a)}else{if(!Z0(a)){Vt.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${a}`)();continue}T.set(a,x)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}};function QO(t,e,r=16){if(t!==e)return!1;let i=t,n=e;if(!Z0(i))return!1;if(Z0(n)&&i.length===n.length){for(let o=0;o<i.length;++o)if(n[o]!==i[o])return!1}return!0}function JO(t){return Z0(t)?t.slice():t}var bb=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){let r=e?.shaderLayout.bindings?.find(n=>n.type==="uniform"&&n.name===e?.name);if(!r)throw new Error(e?.name);let i=r;for(let n of i.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(let[r,i]of Object.entries(e))this._setUniform(r,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){QO(this.uniforms[e],r)||(this.uniforms[e]=JO(r),this.modifiedUniforms[e]=!0,this.modified=!0)}};var o1=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(let[r,i]of Object.entries(e)){let n=r,o=new xb(i.uniformTypes||{});this.uniformBufferLayouts.set(n,o);let a=new bb({name:r});a.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,a)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[r,i]of Object.entries(e))this.uniformBlocks.get(r)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let r=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(r)}createUniformBuffer(e,r,i){i&&this.setUniforms(i);let n=this.getUniformBufferByteLength(r),o=e.createBuffer({usage:qi.UNIFORM|qi.COPY_DST,byteLength:n}),a=this.getUniformBufferData(r);return o.write(a),o}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){let i=this.getUniformBufferByteLength(r),n=e.createBuffer({usage:qi.UNIFORM|qi.COPY_DST,byteLength:i});this.uniformBuffers.set(r,n)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(let r of this.uniformBlocks.keys()){let i=this.updateUniformBuffer(r);e||=i}return e&&Vt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let r=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e),n=!1;if(i&&r?.needsRedraw){n||=r.needsRedraw;let o=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(o);let a=this.uniformBlocks.get(e)?.getAllUniforms();Vt.log(4,`Writing to uniform buffer ${String(e)}`,o,a)()}return n}};function vb(t){let e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function s1(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function SS(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);let i=e,n=vb(t);if(n==="uint8"&&r&&i===1)return"unorm8-webgl";if(n==="uint8"&&r&&i===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}if(n==="uint16"||n==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}return i===1?n:`${n}x${i}`}var jp=class{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,r){let i=[...e];for(let n of r){let o=i.findIndex(a=>a.name===n.name);o<0?i.push(n):i[o]=n}return i}getBufferIndex(e){let r=this.bufferLayouts.findIndex(i=>i.name===e);return r===-1&&Vt.warn(`BufferLayout: Missing buffer for "${e}".`)(),r}};function IS(t,e){let r=Object.fromEntries(t.attributes.map(n=>[n.name,n.location])),i=e.slice();return i.sort((n,o)=>{let a=n.attributes?n.attributes.map(x=>x.attribute):[n.name],c=o.attributes?o.attributes.map(x=>x.attribute):[o.name],h=Math.min(...a.map(x=>r[x])),p=Math.min(...c.map(x=>r[x]));return h-p}),i}var Ma=class{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}},wb=class{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Iu=class extends Ma{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},Mu=class extends Ma{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}},kh=class extends Ma{constructor(e,r,i,n){super(e,i),this.format=r,this.access=n}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}},ld;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(ld||(ld={}));var X0=class{constructor(e,r,i,n,o,a,c){this.name=e,this.type=r,this.group=i,this.binding=n,this.attributes=o,this.resourceType=a,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},RS=class{constructor(e,r){this.name=e,this.type=r}},BS=class{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n,this.interpolation=null}},Tb=class{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n}},LS=class{constructor(e,r,i,n){this.name=e,this.type=r,this.attributes=i,this.id=n}},OS=class{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i}},DS=class{constructor(e,r=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r,this.attributes=i}},FS=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},r8=new Float32Array(1),NQ=new Int32Array(r8.buffer),Ws=new Uint16Array(1);function zQ(t){r8[0]=t;let e=NQ[0],r=e>>31&1,i=e>>23&255,n=8388607&e;if(i===255)return Ws[0]=r<<15|31744|(n!==0?512:0),Ws[0];if(i===0){if(n===0)return Ws[0]=r<<15,Ws[0];n|=8388608;let o=113;for(;!(8388608&n);)n<<=1,o--;return i=127-o,n&=8388607,i>0?(n=(n>>126-i)+(n>>127-i&1),Ws[0]=r<<15|i<<10|n>>13,Ws[0]):(Ws[0]=r<<15,Ws[0])}return i=i-127+15,i>=31?(Ws[0]=r<<15|31744,Ws[0]):i<=0?i<-10?(Ws[0]=r<<15,Ws[0]):(n=(8388608|n)>>1-i,Ws[0]=r<<15|n>>13,Ws[0]):(n>>=13,Ws[0]=r<<15|i<<10|n,Ws[0])}var KS=new Uint32Array(1),i8=new Float32Array(KS.buffer,0,1);function e8(t){let e=112+(t>>6&31)<<23|(63&t)<<17;return KS[0]=e,i8[0]}function UQ(t,e,r,i,n,o,a,c,h){let p=i*(a>>=n)*(o>>=n)+r*a+e*c;switch(h){case"r8unorm":return[sn(t,p,"8unorm",1)[0]];case"r8snorm":return[sn(t,p,"8snorm",1)[0]];case"r8uint":return[sn(t,p,"8uint",1)[0]];case"r8sint":return[sn(t,p,"8sint",1)[0]];case"rg8unorm":{let x=sn(t,p,"8unorm",2);return[x[0],x[1]]}case"rg8snorm":{let x=sn(t,p,"8snorm",2);return[x[0],x[1]]}case"rg8uint":{let x=sn(t,p,"8uint",2);return[x[0],x[1]]}case"rg8sint":{let x=sn(t,p,"8sint",2);return[x[0],x[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let x=sn(t,p,"8unorm",4);return[x[0],x[1],x[2],x[3]]}case"rgba8snorm":{let x=sn(t,p,"8snorm",4);return[x[0],x[1],x[2],x[3]]}case"rgba8uint":{let x=sn(t,p,"8uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba8sint":{let x=sn(t,p,"8sint",4);return[x[0],x[1],x[2],x[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let x=sn(t,p,"8unorm",4);return[x[2],x[1],x[0],x[3]]}case"r16uint":return[sn(t,p,"16uint",1)[0]];case"r16sint":return[sn(t,p,"16sint",1)[0]];case"r16float":return[sn(t,p,"16float",1)[0]];case"rg16uint":{let x=sn(t,p,"16uint",2);return[x[0],x[1]]}case"rg16sint":{let x=sn(t,p,"16sint",2);return[x[0],x[1]]}case"rg16float":{let x=sn(t,p,"16float",2);return[x[0],x[1]]}case"rgba16uint":{let x=sn(t,p,"16uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba16sint":{let x=sn(t,p,"16sint",4);return[x[0],x[1],x[2],x[3]]}case"rgba16float":{let x=sn(t,p,"16float",4);return[x[0],x[1],x[2],x[3]]}case"r32uint":return[sn(t,p,"32uint",1)[0]];case"r32sint":return[sn(t,p,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[sn(t,p,"32float",1)[0]];case"rg32uint":{let x=sn(t,p,"32uint",2);return[x[0],x[1]]}case"rg32sint":{let x=sn(t,p,"32sint",2);return[x[0],x[1]]}case"rg32float":{let x=sn(t,p,"32float",2);return[x[0],x[1]]}case"rgba32uint":{let x=sn(t,p,"32uint",4);return[x[0],x[1],x[2],x[3]]}case"rgba32sint":{let x=sn(t,p,"32sint",4);return[x[0],x[1],x[2],x[3]]}case"rgba32float":{let x=sn(t,p,"32float",4);return[x[0],x[1],x[2],x[3]]}case"rg11b10ufloat":{let x=new Uint32Array(t.buffer,p,1)[0],T=(4192256&x)>>11,R=(4290772992&x)>>22;return[e8(2047&x),e8(T),function(k){let j=112+(k>>5&31)<<23|(31&k)<<18;return KS[0]=j,i8[0]}(R),1]}}return null}function sn(t,e,r,i){let n=[0,0,0,0];for(let p=0;p<i;++p)switch(r){case"8unorm":n[p]=t[e]/255,e++;break;case"8snorm":n[p]=t[e]/255*2-1,e++;break;case"8uint":n[p]=t[e],e++;break;case"8sint":n[p]=t[e]-127,e++;break;case"16uint":n[p]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":n[p]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":n[p]=(o=t[e]|t[e+1]<<8,a=void 0,c=void 0,h=void 0,a=(32768&o)>>15,h=1023&o,(c=(31744&o)>>10)==0?(a?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):c==31?h?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,c-15)*(1+h/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":n[p]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":n[p]=new Float32Array(t.buffer,e,1)[0],e+=4}var o,a,c,h;return n}function dn(t,e,r,i,n){for(let o=0;o<i;++o)switch(r){case"8unorm":t[e]=255*n[o],e++;break;case"8snorm":t[e]=.5*(n[o]+1)*255,e++;break;case"8uint":t[e]=n[o],e++;break;case"8sint":t[e]=n[o]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=n[o],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=n[o],e+=2;break;case"16float":{let a=zQ(n[o]);new Uint16Array(t.buffer,e,1)[0]=a,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=n[o],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=n[o],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=n[o],e+=4}return n}var MS={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}},Sl=class t{constructor(){this.id=t._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,r){if(e){r(tm.instance);for(let i of e)i instanceof Array?this.searchBlock(i,r):i.search(r);r(rm.instance)}}constEvaluate(e,r){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}};Sl._id=0;var tm=class extends Sl{};tm.instance=new tm;var rm=class extends Sl{};rm.instance=new rm;var n8=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]),Hn=class extends Sl{constructor(){super()}},qp=class extends Hn{constructor(e,r,i,n,o,a){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=i,this.body=n,this.startLine=o,this.endLine=a}get astNodeType(){return"function"}search(e){if(this.attributes)for(let r of this.attributes)e(r);e(this);for(let r of this.args)e(r);this.searchBlock(this.body,e)}},kS=class extends Hn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},Eb=class extends Hn{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},c1=class extends Hn{constructor(e,r){super(),this.body=e,this.loopId=r}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}},Cb=class extends Hn{constructor(e,r,i,n){super(),this.init=e,this.condition=r,this.increment=i,this.body=n}get astNodeType(){return"for"}search(e){var r,i,n;(r=this.init)===null||r===void 0||r.search(e),(i=this.condition)===null||i===void 0||i.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}},Ec=class extends Hn{constructor(e,r,i,n,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=i,this.access=n,this.value=o}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},u1=class extends Hn{constructor(e,r,i){super(),this.attributes=null,this.name=e,this.type=r,this.value=i}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}},Hp=class extends Hn{constructor(e,r,i,n,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=i,this.access=n,this.value=o}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},Q0=class extends Hn{constructor(e,r,i,n,o){super(),this.attributes=null,this.name=e,this.type=r,this.storage=i,this.access=n,this.value=o}get astNodeType(){return"const"}constEvaluate(e,r){return this.value.constEvaluate(e,r)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},Y0,a1,vt,ct;(t=>{t.increment="++",t.decrement="--"})(Y0||(Y0={})),(t=>{t.parse=function(e){let r=e;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}})(Y0||(Y0={}));var Sb=class extends Hn{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(a1||(a1={})),(t=>{t.parse=function(e){let r=e;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}})(a1||(a1={}));var Ib=class extends Hn{constructor(e,r,i){super(),this.operator=e,this.variable=r,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},h1=class extends Hn{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}isBuiltin(){return n8.has(this.name)}search(e){for(let r of this.args)r.search(e);e(this)}},Mb=class extends Hn{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}},Pb=class extends Hn{constructor(e,r){super(),this.condition=e,this.cases=r}get astNodeType(){return"switch"}},Rb=class extends Hn{constructor(e,r,i,n){super(),this.condition=e,this.body=r,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},Bb=class extends Hn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}},NS=class extends Hn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},zS=class extends Hn{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},Lb=class extends Hn{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}},f1=class extends Hn{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}},US=class extends Hn{constructor(){super()}get astNodeType(){return"discard"}},Ob=class extends Hn{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}},Db=class extends Hn{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},Zt=class t extends Hn{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let r=e[0];if(r.name==="f32")return r;for(let i=1;i<e.length;++i){let n=t._priority.get(r.name);t._priority.get(e[i].name)<n&&(r=e[i])}return r.name==="x32"?t.i32:r}getTypeName(){return this.name}};Zt.x32=new Zt("x32"),Zt.f32=new Zt("f32"),Zt.i32=new Zt("i32"),Zt.u32=new Zt("u32"),Zt.f16=new Zt("f16"),Zt.bool=new Zt("bool"),Zt.void=new Zt("void"),Zt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var Fb=class extends Zt{constructor(e){super(e)}},Tc=class extends Zt{constructor(e,r,i,n){super(e),this.members=r,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}search(e){for(let r of this.members)e(r)}},pt=class extends Zt{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};pt.vec2f=new pt("vec2",Zt.f32,null),pt.vec3f=new pt("vec3",Zt.f32,null),pt.vec4f=new pt("vec4",Zt.f32,null),pt.vec2i=new pt("vec2",Zt.i32,null),pt.vec3i=new pt("vec3",Zt.i32,null),pt.vec4i=new pt("vec4",Zt.i32,null),pt.vec2u=new pt("vec2",Zt.u32,null),pt.vec3u=new pt("vec3",Zt.u32,null),pt.vec4u=new pt("vec4",Zt.u32,null),pt.vec2h=new pt("vec2",Zt.f16,null),pt.vec3h=new pt("vec3",Zt.f16,null),pt.vec4h=new pt("vec4",Zt.f16,null),pt.vec2b=new pt("vec2",Zt.bool,null),pt.vec3b=new pt("vec3",Zt.bool,null),pt.vec4b=new pt("vec4",Zt.bool,null),pt.mat2x2f=new pt("mat2x2",Zt.f32,null),pt.mat2x3f=new pt("mat2x3",Zt.f32,null),pt.mat2x4f=new pt("mat2x4",Zt.f32,null),pt.mat3x2f=new pt("mat3x2",Zt.f32,null),pt.mat3x3f=new pt("mat3x3",Zt.f32,null),pt.mat3x4f=new pt("mat3x4",Zt.f32,null),pt.mat4x2f=new pt("mat4x2",Zt.f32,null),pt.mat4x3f=new pt("mat4x3",Zt.f32,null),pt.mat4x4f=new pt("mat4x4",Zt.f32,null),pt.mat2x2h=new pt("mat2x2",Zt.f16,null),pt.mat2x3h=new pt("mat2x3",Zt.f16,null),pt.mat2x4h=new pt("mat2x4",Zt.f16,null),pt.mat3x2h=new pt("mat3x2",Zt.f16,null),pt.mat3x3h=new pt("mat3x3",Zt.f16,null),pt.mat3x4h=new pt("mat3x4",Zt.f16,null),pt.mat4x2h=new pt("mat4x2",Zt.f16,null),pt.mat4x3h=new pt("mat4x3",Zt.f16,null),pt.mat4x4h=new pt("mat4x4",Zt.f16,null),pt.mat2x2i=new pt("mat2x2",Zt.i32,null),pt.mat2x3i=new pt("mat2x3",Zt.i32,null),pt.mat2x4i=new pt("mat2x4",Zt.i32,null),pt.mat3x2i=new pt("mat3x2",Zt.i32,null),pt.mat3x3i=new pt("mat3x3",Zt.i32,null),pt.mat3x4i=new pt("mat3x4",Zt.i32,null),pt.mat4x2i=new pt("mat4x2",Zt.i32,null),pt.mat4x3i=new pt("mat4x3",Zt.i32,null),pt.mat4x4i=new pt("mat4x4",Zt.i32,null),pt.mat2x2u=new pt("mat2x2",Zt.u32,null),pt.mat2x3u=new pt("mat2x3",Zt.u32,null),pt.mat2x4u=new pt("mat2x4",Zt.u32,null),pt.mat3x2u=new pt("mat3x2",Zt.u32,null),pt.mat3x3u=new pt("mat3x3",Zt.u32,null),pt.mat3x4u=new pt("mat3x4",Zt.u32,null),pt.mat4x2u=new pt("mat4x2",Zt.u32,null),pt.mat4x3u=new pt("mat4x3",Zt.u32,null),pt.mat4x4u=new pt("mat4x4",Zt.u32,null);var l1=class extends Zt{constructor(e,r,i,n){super(e),this.storage=r,this.type=i,this.access=n}get astNodeType(){return"pointer"}},Wp=class extends Zt{constructor(e,r,i,n){super(e),this.attributes=r,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}},Gp=class extends Zt{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"sampler"}},Il=class extends Sl{constructor(){super(),this.postfix=null}},Nh=class extends Il{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},Cl=class extends Il{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let r of this.args)r.search(e)}constEvaluate(e,r){return r&&(r[0]=this.type),e.evalExpression(this,e.context)}},d1=class extends Il{constructor(e,r){super(),this.cachedReturnValue=null,this.name=e,this.args=r}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return n8.has(this.name)}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){for(let r of this.args)r.search(e);e(this)}},ca=class extends Il{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,r){return e.evalExpression(this,e.context)}},kb=class extends Il{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}constEvaluate(e,r){if(this.initializer){let i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}},Mo=class extends Il{constructor(e,r){super(),this.value=e,this.type=r}get astNodeType(){return"literalExpr"}constEvaluate(e,r){return r!==void 0&&(r[0]=this.type),this.value}get isScalar(){return this.value instanceof ht}get isVector(){return this.value instanceof ke||this.value instanceof qr}get scalarValue(){return this.value instanceof ht?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof ke||this.value instanceof qr?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}},Nb=class extends Il{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}};var ud=class extends Il{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},zb=class extends Il{constructor(){super()}},go=class extends zb{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}},rl=class extends zb{constructor(e,r,i){super(),this.operator=e,this.left=r,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,r){return e.name===r.name?e:e.name==="f32"||r.name==="f32"?Zt.f32:e.name==="u32"||r.name==="u32"?Zt.u32:Zt.i32}constEvaluate(e,r){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}},Ub=class extends Sl{constructor(e){super(),this.body=e}},J0=class extends Il{constructor(){super()}get astNodeType(){return"default"}},Vb=class extends Ub{constructor(e,r){super(r),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},jb=class extends Ub{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},Gb=class extends Sl{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"argument"}},VS=class extends Sl{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},Hb=class extends Sl{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"member"}},Wb=class extends Sl{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}},Ml=class t{constructor(e,r){this.parent=null,this.typeInfo=e,this.parent=r,this.id=t._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,r,i,n){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,r,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}};Ml._id=0;var p1=class extends Ml{constructor(){super(new Ma("void",null),null)}toString(){return"void"}};p1.void=new p1;var cd=class extends Ml{constructor(e){super(new Ma("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,r,i,n){this.reference.setDataValue(e,r,i,n)}getSubData(e,r,i){return r?this.reference.getSubData(e,r,i):this}},ht=class t extends Ml{constructor(e,r,i=null){super(r,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",r)}clone(){if(this.data instanceof Float32Array)return new t(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new t(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new t(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,r,i,n){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(r instanceof t))return void console.error("SetDataValue: Invalid value",r);let o=r.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,r,i){return r?(console.error("getSubData: Scalar data does not support postfix",r),null):this}toString(){return`${this.value}`}};function VQ(t,e,r){let i=e.length;return i===2?r==="f32"?new ke(new Float32Array(e),t.getTypeInfo("vec2f")):r==="i32"||r==="bool"?new ke(new Int32Array(e),t.getTypeInfo("vec2i")):r==="u32"?new ke(new Uint32Array(e),t.getTypeInfo("vec2u")):r==="f16"?new ke(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${r}`),null):i===3?r==="f32"?new ke(new Float32Array(e),t.getTypeInfo("vec3f")):r==="i32"||r==="bool"?new ke(new Int32Array(e),t.getTypeInfo("vec3i")):r==="u32"?new ke(new Uint32Array(e),t.getTypeInfo("vec3u")):r==="f16"?new ke(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${r}`),null):i===4?r==="f32"?new ke(new Float32Array(e),t.getTypeInfo("vec4f")):r==="i32"||r==="bool"?new ke(new Int32Array(e),t.getTypeInfo("vec4i")):r==="u32"?new ke(new Uint32Array(e),t.getTypeInfo("vec4u")):r==="f16"?new ke(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${r}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}var ke=class t extends Ml{constructor(e,r,i=null){if(super(r,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{let n=this.typeInfo.name;n==="vec2f"||n==="vec3f"||n==="vec4f"?this.data=new Float32Array(e):n==="vec2i"||n==="vec3i"||n==="vec4i"?this.data=new Int32Array(e):n==="vec2u"||n==="vec3u"||n==="vec4u"?this.data=new Uint32Array(e):n==="vec2h"||n==="vec3h"||n==="vec4h"?this.data=new Float32Array(e):n==="vec2b"||n==="vec3b"||n==="vec4b"?this.data=new Int32Array(e):n==="vec2"||n==="vec3"||n==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${n}`)}}clone(){if(this.data instanceof Float32Array)return new t(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new t(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new t(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,r,i,n){i instanceof Nh?console.error("TODO: Set vector postfix"):r instanceof t?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,i){if(r===null)return this;let n=e.getTypeInfo("f32");if(this.typeInfo instanceof kh)n=this.typeInfo.format||n;else{let a=this.typeInfo.name;a==="vec2f"||a==="vec3f"||a==="vec4f"?n=e.getTypeInfo("f32"):a==="vec2i"||a==="vec3i"||a==="vec4i"?n=e.getTypeInfo("i32"):a==="vec2b"||a==="vec3b"||a==="vec4b"?n=e.getTypeInfo("bool"):a==="vec2u"||a==="vec3u"||a==="vec4u"?n=e.getTypeInfo("u32"):a==="vec2h"||a==="vec3h"||a==="vec4h"?n=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${a}`)}let o=this;for(;r!==null&&o!==null;){if(r instanceof ud){let a=r.index,c=-1;if(a instanceof Mo){if(!(a.value instanceof ht))return console.error(`GetSubData: Invalid array index ${a.value}`),null;c=a.value.value}else{let h=e.evalExpression(a,i);if(!(h instanceof ht))return console.error("GetSubData: Unknown index type",a),null;c=h.value}if(c<0||c>=o.data.length)return console.error("GetSubData: Index out of range",c),null;if(o.data instanceof Float32Array){let h=new Float32Array(o.data.buffer,o.data.byteOffset+4*c,1);return new ht(h,n)}if(o.data instanceof Int32Array){let h=new Int32Array(o.data.buffer,o.data.byteOffset+4*c,1);return new ht(h,n)}if(o.data instanceof Uint32Array){let h=new Uint32Array(o.data.buffer,o.data.byteOffset+4*c,1);return new ht(h,n)}throw"GetSubData: Invalid data type"}if(!(r instanceof Nh))return console.error("GetSubData: Unknown postfix",r),null;{let a=r.value.toLowerCase();if(a.length===1){let h=0;if(a==="x"||a==="r")h=0;else if(a==="y"||a==="g")h=1;else if(a==="z"||a==="b")h=2;else{if(a!=="w"&&a!=="a")return console.error(`GetSubData: Unknown member ${a}`),null;h=3}if(this.data instanceof Float32Array){let p=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ht(p,n,this)}if(this.data instanceof Int32Array){let p=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ht(p,n,this)}if(this.data instanceof Uint32Array){let p=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ht(p,n,this)}}let c=[];for(let h of a)h==="x"||h==="r"?c.push(this.data[0]):h==="y"||h==="g"?c.push(this.data[1]):h==="z"||h==="b"?c.push(this.data[2]):h==="w"||h==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);o=VQ(e,c,n.name)}r=r.postfix}return o}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}},qr=class t extends Ml{constructor(e,r,i=null){super(r,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new t(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,r,i,n){i instanceof Nh?console.error("TODO: Set matrix postfix"):r instanceof t?this.data=r.data:console.error("SetDataValue: Invalid value",r)}getSubData(e,r,i){if(r===null)return this;let n=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof kh)this.typeInfo.format;else if(n.endsWith("f"))e.getTypeInfo("f32");else if(n.endsWith("i"))e.getTypeInfo("i32");else if(n.endsWith("u"))e.getTypeInfo("u32");else{if(!n.endsWith("h"))return console.error(`GetDataValue: Unknown type ${n}`),null;e.getTypeInfo("f16")}if(r instanceof ud){let o=r.index,a=-1;if(o instanceof Mo){if(!(o.value instanceof ht))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;a=o.value.value}else{let p=e.evalExpression(o,i);if(!(p instanceof ht))return console.error("GetDataValue: Unknown index type",o),null;a=p.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;let c=n.endsWith("h")?"h":"f",h;if(n==="mat2x2"||n==="mat2x2f"||n==="mat2x2h"||n==="mat3x2"||n==="mat3x2f"||n==="mat3x2h"||n==="mat4x2"||n==="mat4x2f"||n==="mat4x2h")h=new ke(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),e.getTypeInfo(`vec2${c}`));else if(n==="mat2x3"||n==="mat2x3f"||n==="mat2x3h"||n==="mat3x3"||n==="mat3x3f"||n==="mat3x3h"||n==="mat4x3"||n==="mat4x3f"||n==="mat4x3h")h=new ke(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),e.getTypeInfo(`vec3${c}`));else{if(n!=="mat2x4"&&n!=="mat2x4f"&&n!=="mat2x4h"&&n!=="mat3x4"&&n!=="mat3x4f"&&n!=="mat3x4h"&&n!=="mat4x4"&&n!=="mat4x4f"&&n!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${n}`),null;h=new ke(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),e.getTypeInfo(`vec4${c}`))}return r.postfix?h.getSubData(e,r.postfix,i):h}return console.error("GetDataValue: Invalid postfix",r),null}toString(){let e=`${this.data[0]}`;for(let r=1;r<this.data.length;++r)e+=`, ${this.data[r]}`;return e}},Ho=class t extends Ml{constructor(e,r,i=0,n=null){super(r,n),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){let e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new t(e.buffer,this.typeInfo,0,null)}setDataValue(e,r,i,n){if(r===null)return void console.log("setDataValue: NULL data.");let o=this.offset,a=this.typeInfo;for(;i;){if(i instanceof ud)if(a instanceof Mu){let c=i.index;if(c instanceof Mo){if(!(c.value instanceof ht))return void console.error(`SetDataValue: Invalid index type ${c.value}`);o+=c.value.value*a.stride}else{let h=e.evalExpression(c,n);if(!(h instanceof ht))return void console.error("SetDataValue: Unknown index type",c);o+=h.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${a.getTypeName()} is not an array`);else{if(!(i instanceof Nh))return void console.error("SetDataValue: Unknown postfix type",i);{let c=i.value;if(a instanceof Iu){let h=!1;for(let p of a.members)if(p.name===c){o+=p.offset,a=p.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${c} not found`)}else if(a instanceof Ma){let h=a.getTypeName(),p=0;if(c==="x"||c==="r")p=0;else if(c==="y"||c==="g")p=1;else if(c==="z"||c==="b")p=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);p=3}if(!(r instanceof ht))return void console.error("SetDataValue: Invalid value",r);let x=r.value;return h==="vec2f"?void(new Float32Array(this.buffer,o,2)[p]=x):h==="vec3f"?void(new Float32Array(this.buffer,o,3)[p]=x):h==="vec4f"?void(new Float32Array(this.buffer,o,4)[p]=x):h==="vec2i"?void(new Int32Array(this.buffer,o,2)[p]=x):h==="vec3i"?void(new Int32Array(this.buffer,o,3)[p]=x):h==="vec4i"?void(new Int32Array(this.buffer,o,4)[p]=x):h==="vec2u"?void(new Uint32Array(this.buffer,o,2)[p]=x):h==="vec3u"?void(new Uint32Array(this.buffer,o,3)[p]=x):h==="vec4u"?void(new Uint32Array(this.buffer,o,4)[p]=x):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}i=i.postfix}this.setData(e,r,a,o,n)}setData(e,r,i,n,o){let a=i.getTypeName();if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool")if(a!=="vec2f"&&a!=="vec2h")if(a!=="vec3f"&&a!=="vec3h")if(a!=="vec4f"&&a!=="vec4h")if(a!=="vec2i")if(a!=="vec3i")if(a!=="vec4i")if(a!=="vec2u")if(a!=="vec3u")if(a!=="vec4u")if(a!=="vec2b")if(a!=="vec3b")if(a!=="vec4b")if(a!=="mat2x2f"&&a!=="mat2x2h")if(a!=="mat2x3f"&&a!=="mat2x3h")if(a!=="mat2x4f"&&a!=="mat2x4h")if(a!=="mat3x2f"&&a!=="mat3x2h")if(a!=="mat3x3f"&&a!=="mat3x3h")if(a!=="mat3x4f"&&a!=="mat3x4h")if(a!=="mat4x2f"&&a!=="mat4x2h")if(a!=="mat4x3f"&&a!=="mat4x3h")if(a!=="mat4x4f"&&a!=="mat4x4h")if(r instanceof t){if(i===r.typeInfo)return void new Uint8Array(this.buffer,n,r.buffer.byteLength).set(new Uint8Array(r.buffer));console.error("SetDataValue: Type mismatch",a,r.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${a}`);else{let c=new Float32Array(this.buffer,n,16);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8],c[9]=r.data[9],c[10]=r.data[10],c[11]=r.data[11],c[12]=r.data[12],c[13]=r.data[13],c[14]=r.data[14],c[15]=r.data[15]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11],c[12]=r[12],c[13]=r[13],c[14]=r[14],c[15]=r[15])}else{let c=new Float32Array(this.buffer,n,12);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8],c[9]=r.data[9],c[10]=r.data[10],c[11]=r.data[11]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11])}else{let c=new Float32Array(this.buffer,n,8);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7])}else{let c=new Float32Array(this.buffer,n,12);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8],c[9]=r.data[9],c[10]=r.data[10],c[11]=r.data[11]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8],c[9]=r[9],c[10]=r[10],c[11]=r[11])}else{let c=new Float32Array(this.buffer,n,9);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7],c[8]=r.data[8]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7],c[8]=r[8])}else{let c=new Float32Array(this.buffer,n,6);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5])}else{let c=new Float32Array(this.buffer,n,8);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5],c[6]=r.data[6],c[7]=r.data[7]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5],c[6]=r[6],c[7]=r[7])}else{let c=new Float32Array(this.buffer,n,6);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3],c[4]=r.data[4],c[5]=r.data[5]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3],c[4]=r[4],c[5]=r[5])}else{let c=new Float32Array(this.buffer,n,4);r instanceof qr?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Uint32Array(this.buffer,n,4);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Uint32Array(this.buffer,n,3);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Uint32Array(this.buffer,n,2);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else{let c=new Uint32Array(this.buffer,n,4);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Uint32Array(this.buffer,n,3);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Uint32Array(this.buffer,n,2);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else{let c=new Int32Array(this.buffer,n,4);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Int32Array(this.buffer,n,3);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Int32Array(this.buffer,n,2);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else{let c=new Float32Array(this.buffer,n,4);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2],c[3]=r.data[3]):(c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3])}else{let c=new Float32Array(this.buffer,n,3);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1],c[2]=r.data[2]):(c[0]=r[0],c[1]=r[1],c[2]=r[2])}else{let c=new Float32Array(this.buffer,n,2);r instanceof ke?(c[0]=r.data[0],c[1]=r.data[1]):(c[0]=r[0],c[1]=r[1])}else r instanceof ht&&(new Int32Array(this.buffer,n,1)[0]=r.value);else r instanceof ht&&(new Uint32Array(this.buffer,n,1)[0]=r.value);else r instanceof ht&&(new Int32Array(this.buffer,n,1)[0]=r.value);else r instanceof ht&&(new Float32Array(this.buffer,n,1)[0]=r.value)}getSubData(e,r,i){var n,o,a;if(r===null)return this;let c=this.offset,h=this.typeInfo;for(;r;){if(r instanceof ud){let x=r.index,T=e.evalExpression(x,i),R=0;if(T instanceof ht?R=T.value:console.error("GetDataValue: Invalid index type",x),h instanceof Mu)c+=R*h.stride,h=h.format;else{let k=h.getTypeName();k==="mat4x4"||k==="mat4x4f"||k==="mat4x4h"?(c+=16*R,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(r instanceof Nh))return console.error("GetDataValue: Unknown postfix type",r),null;{let x=r.value;if(h instanceof Iu){let T=!1;for(let R of h.members)if(R.name===x){c+=R.offset,h=R.type,T=!0;break}if(!T)return console.error(`GetDataValue: Member ${x} not found`),null}else if(h instanceof Ma){let T=h.getTypeName();if(T==="vec2f"||T==="vec3f"||T==="vec4f"||T==="vec2i"||T==="vec3i"||T==="vec4i"||T==="vec2u"||T==="vec3u"||T==="vec4u"||T==="vec2b"||T==="vec3b"||T==="vec4b"||T==="vec2h"||T==="vec3h"||T==="vec4h"||T==="vec2"||T==="vec3"||T==="vec4"){if(x.length>0&&x.length<5){let R="f",k=[];for(let j=0;j<x.length;++j){let q=x[j].toLowerCase(),Z=0;if(q==="x"||q==="r")Z=0;else if(q==="y"||q==="g")Z=1;else if(q==="z"||q==="b")Z=2;else{if(q!=="w"&&q!=="a")return console.error(`Unknown member ${x}`),null;Z=3}if(x.length===1){if(T.endsWith("f"))return this.buffer.byteLength<c+4*Z+4?(console.log("Insufficient buffer data"),null):new ht(new Float32Array(this.buffer,c+4*Z,1),e.getTypeInfo("f32"),this);if(T.endsWith("h"))return new ht(new Float32Array(this.buffer,c+4*Z,1),e.getTypeInfo("f16"),this);if(T.endsWith("i"))return new ht(new Int32Array(this.buffer,c+4*Z,1),e.getTypeInfo("i32"),this);if(T.endsWith("b"))return new ht(new Int32Array(this.buffer,c+4*Z,1),e.getTypeInfo("bool"),this);if(T.endsWith("u"))return new ht(new Uint32Array(this.buffer,c+4*Z,1),e.getTypeInfo("i32"),this)}if(T==="vec2f")k.push(new Float32Array(this.buffer,c,2)[Z]);else if(T==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let re=new Float32Array(this.buffer,c,3);k.push(re[Z])}else if(T==="vec4f")k.push(new Float32Array(this.buffer,c,4)[Z]);else if(T==="vec2i")R="i",k.push(new Int32Array(this.buffer,c,2)[Z]);else if(T==="vec3i")R="i",k.push(new Int32Array(this.buffer,c,3)[Z]);else if(T==="vec4i")R="i",k.push(new Int32Array(this.buffer,c,4)[Z]);else if(T==="vec2u"){R="u";let re=new Uint32Array(this.buffer,c,2);k.push(re[Z])}else T==="vec3u"?(R="u",k.push(new Uint32Array(this.buffer,c,3)[Z])):T==="vec4u"&&(R="u",k.push(new Uint32Array(this.buffer,c,4)[Z]))}return k.length===2?h=e.getTypeInfo(`vec2${R}`):k.length===3?h=e.getTypeInfo(`vec3${R}`):k.length===4?h=e.getTypeInfo(`vec4${R}`):console.error(`GetDataValue: Invalid vector length ${k.length}`),new ke(k,h,null)}return console.error(`GetDataValue: Unknown member ${x}`),null}return console.error(`GetDataValue: Type ${T} is not a struct`),null}}}r=r.postfix}let p=h.getTypeName();return p==="f32"?new ht(new Float32Array(this.buffer,c,1),h,this):p==="i32"?new ht(new Int32Array(this.buffer,c,1),h,this):p==="u32"?new ht(new Uint32Array(this.buffer,c,1),h,this):p==="vec2f"?new ke(new Float32Array(this.buffer,c,2),h,this):p==="vec3f"?new ke(new Float32Array(this.buffer,c,3),h,this):p==="vec4f"?new ke(new Float32Array(this.buffer,c,4),h,this):p==="vec2i"?new ke(new Int32Array(this.buffer,c,2),h,this):p==="vec3i"?new ke(new Int32Array(this.buffer,c,3),h,this):p==="vec4i"?new ke(new Int32Array(this.buffer,c,4),h,this):p==="vec2u"?new ke(new Uint32Array(this.buffer,c,2),h,this):p==="vec3u"?new ke(new Uint32Array(this.buffer,c,3),h,this):p==="vec4u"?new ke(new Uint32Array(this.buffer,c,4),h,this):h instanceof kh&&h.name==="atomic"?((n=h.format)===null||n===void 0?void 0:n.name)==="u32"?new ht(new Uint32Array(this.buffer,c,1)[0],h.format,this):((o=h.format)===null||o===void 0?void 0:o.name)==="i32"?new ht(new Int32Array(this.buffer,c,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(a=h.format)===null||a===void 0?void 0:a.name}`),null):new t(this.buffer,h,c,this)}toString(){let e="";if(this.typeInfo instanceof Mu)if(this.typeInfo.format.name==="f32"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let i=1;i<r.length;++i)e+=`, ${r[i]}`}else if(this.typeInfo.format.name==="i32"){let r=new Int32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let i=1;i<r.length;++i)e+=`, ${r[i]}`}else if(this.typeInfo.format.name==="u32"){let r=new Uint32Array(this.buffer,this.offset);e=`[${r[0]}`;for(let i=1;i<r.length;++i)e+=`, ${r[i]}`}else if(this.typeInfo.format.name==="vec2f"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}]`;for(let i=1;i<r.length/2;++i)e+=`, [${r[2*i]}, ${r[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}]`;for(let i=4;i<r.length;i+=4)e+=`, [${r[i]}, ${r[i+1]}, ${r[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){let r=new Float32Array(this.buffer,this.offset);e=`[${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}]`;for(let i=4;i<r.length;i+=4)e+=`, [${r[i]}, ${r[i+1]}, ${r[i+2]}, ${r[i+3]}]`}else e="[...]";else this.typeInfo instanceof Iu?e+="{...}":e="[...]";return e}},Fh=class t extends Ml{constructor(e,r,i,n){super(r,null),this.data=e,this.descriptor=i,this.view=n}clone(){return new t(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,r;let i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(r=i.width)!==null&&r!==void 0?r:0}get height(){var e,r;let i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(r=i.height)!==null&&r!==void 0?r:0}get depthOrArrayLayers(){var e,r;let i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(r=i.depthOrArrayLayers)!==null&&r!==void 0?r:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];let r=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<r.length;++i)r[i]=Math.max(1,r[i]>>e);return r}get texelByteSize(){let e=this.format,r=MS[e];return r?r.isDepthStencil?4:r.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let e=this.format,r=MS[e];return!!r&&r.isDepthStencil}getGpuSize(){let e=this.format,r=MS[e],i=this.width;if(!e||i<=0||!r)return-1;let n=this.height,o=this.depthOrArrayLayers,a=this.dimension;return i/r.blockWidth*(a==="1d"?1:n/r.blockHeight)*r.bytesPerBlock*o}getPixel(e,r,i=0,n=0){let o=this.texelByteSize,a=this.bytesPerRow,c=this.height,h=this.data[n];return UQ(new Uint8Array(h),e,r,i,n,c,a,o,this.format)}setPixel(e,r,i,n,o){let a=this.texelByteSize,c=this.bytesPerRow,h=this.height,p=this.data[n];(function(x,T,R,k,j,q,Z,re,ee,se){let me=k*(Z>>=j)*(q>>=j)+R*Z+T*re;switch(ee){case"r8unorm":return void dn(x,me,"8unorm",1,se);case"r8snorm":return void dn(x,me,"8snorm",1,se);case"r8uint":return void dn(x,me,"8uint",1,se);case"r8sint":return void dn(x,me,"8sint",1,se);case"rg8unorm":return void dn(x,me,"8unorm",2,se);case"rg8snorm":return void dn(x,me,"8snorm",2,se);case"rg8uint":return void dn(x,me,"8uint",2,se);case"rg8sint":return void dn(x,me,"8sint",2,se);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void dn(x,me,"8unorm",4,se);case"rgba8snorm":return void dn(x,me,"8snorm",4,se);case"rgba8uint":return void dn(x,me,"8uint",4,se);case"rgba8sint":return void dn(x,me,"8sint",4,se);case"r16uint":return void dn(x,me,"16uint",1,se);case"r16sint":return void dn(x,me,"16sint",1,se);case"r16float":return void dn(x,me,"16float",1,se);case"rg16uint":return void dn(x,me,"16uint",2,se);case"rg16sint":return void dn(x,me,"16sint",2,se);case"rg16float":return void dn(x,me,"16float",2,se);case"rgba16uint":return void dn(x,me,"16uint",4,se);case"rgba16sint":return void dn(x,me,"16sint",4,se);case"rgba16float":return void dn(x,me,"16float",4,se);case"r32uint":return void dn(x,me,"32uint",1,se);case"r32sint":return void dn(x,me,"32sint",1,se);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void dn(x,me,"32float",1,se);case"rg32uint":return void dn(x,me,"32uint",2,se);case"rg32sint":return void dn(x,me,"32sint",2,se);case"rg32float":return void dn(x,me,"32float",2,se);case"rgba32uint":return void dn(x,me,"32uint",4,se);case"rgba32sint":return void dn(x,me,"32sint",4,se);case"rgba32float":return void dn(x,me,"32float",4,se);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(p),e,r,i,n,h,c,a,this.format,o)}};(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(ct||(ct={}));var lt=class{constructor(e,r,i){this.name=e,this.type=r,this.rule=i}toString(){return this.name}},Se=class{};vt=Se,Se.none=new lt("",ct.reserved,""),Se.eof=new lt("EOF",ct.token,""),Se.reserved={asm:new lt("asm",ct.reserved,"asm"),bf16:new lt("bf16",ct.reserved,"bf16"),do:new lt("do",ct.reserved,"do"),enum:new lt("enum",ct.reserved,"enum"),f16:new lt("f16",ct.reserved,"f16"),f64:new lt("f64",ct.reserved,"f64"),handle:new lt("handle",ct.reserved,"handle"),i8:new lt("i8",ct.reserved,"i8"),i16:new lt("i16",ct.reserved,"i16"),i64:new lt("i64",ct.reserved,"i64"),mat:new lt("mat",ct.reserved,"mat"),premerge:new lt("premerge",ct.reserved,"premerge"),regardless:new lt("regardless",ct.reserved,"regardless"),typedef:new lt("typedef",ct.reserved,"typedef"),u8:new lt("u8",ct.reserved,"u8"),u16:new lt("u16",ct.reserved,"u16"),u64:new lt("u64",ct.reserved,"u64"),unless:new lt("unless",ct.reserved,"unless"),using:new lt("using",ct.reserved,"using"),vec:new lt("vec",ct.reserved,"vec"),void:new lt("void",ct.reserved,"void")},Se.keywords={array:new lt("array",ct.keyword,"array"),atomic:new lt("atomic",ct.keyword,"atomic"),bool:new lt("bool",ct.keyword,"bool"),f32:new lt("f32",ct.keyword,"f32"),i32:new lt("i32",ct.keyword,"i32"),mat2x2:new lt("mat2x2",ct.keyword,"mat2x2"),mat2x3:new lt("mat2x3",ct.keyword,"mat2x3"),mat2x4:new lt("mat2x4",ct.keyword,"mat2x4"),mat3x2:new lt("mat3x2",ct.keyword,"mat3x2"),mat3x3:new lt("mat3x3",ct.keyword,"mat3x3"),mat3x4:new lt("mat3x4",ct.keyword,"mat3x4"),mat4x2:new lt("mat4x2",ct.keyword,"mat4x2"),mat4x3:new lt("mat4x3",ct.keyword,"mat4x3"),mat4x4:new lt("mat4x4",ct.keyword,"mat4x4"),ptr:new lt("ptr",ct.keyword,"ptr"),sampler:new lt("sampler",ct.keyword,"sampler"),sampler_comparison:new lt("sampler_comparison",ct.keyword,"sampler_comparison"),struct:new lt("struct",ct.keyword,"struct"),texture_1d:new lt("texture_1d",ct.keyword,"texture_1d"),texture_2d:new lt("texture_2d",ct.keyword,"texture_2d"),texture_2d_array:new lt("texture_2d_array",ct.keyword,"texture_2d_array"),texture_3d:new lt("texture_3d",ct.keyword,"texture_3d"),texture_cube:new lt("texture_cube",ct.keyword,"texture_cube"),texture_cube_array:new lt("texture_cube_array",ct.keyword,"texture_cube_array"),texture_multisampled_2d:new lt("texture_multisampled_2d",ct.keyword,"texture_multisampled_2d"),texture_storage_1d:new lt("texture_storage_1d",ct.keyword,"texture_storage_1d"),texture_storage_2d:new lt("texture_storage_2d",ct.keyword,"texture_storage_2d"),texture_storage_2d_array:new lt("texture_storage_2d_array",ct.keyword,"texture_storage_2d_array"),texture_storage_3d:new lt("texture_storage_3d",ct.keyword,"texture_storage_3d"),texture_depth_2d:new lt("texture_depth_2d",ct.keyword,"texture_depth_2d"),texture_depth_2d_array:new lt("texture_depth_2d_array",ct.keyword,"texture_depth_2d_array"),texture_depth_cube:new lt("texture_depth_cube",ct.keyword,"texture_depth_cube"),texture_depth_cube_array:new lt("texture_depth_cube_array",ct.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new lt("texture_depth_multisampled_2d",ct.keyword,"texture_depth_multisampled_2d"),texture_external:new lt("texture_external",ct.keyword,"texture_external"),u32:new lt("u32",ct.keyword,"u32"),vec2:new lt("vec2",ct.keyword,"vec2"),vec3:new lt("vec3",ct.keyword,"vec3"),vec4:new lt("vec4",ct.keyword,"vec4"),bitcast:new lt("bitcast",ct.keyword,"bitcast"),block:new lt("block",ct.keyword,"block"),break:new lt("break",ct.keyword,"break"),case:new lt("case",ct.keyword,"case"),continue:new lt("continue",ct.keyword,"continue"),continuing:new lt("continuing",ct.keyword,"continuing"),default:new lt("default",ct.keyword,"default"),diagnostic:new lt("diagnostic",ct.keyword,"diagnostic"),discard:new lt("discard",ct.keyword,"discard"),else:new lt("else",ct.keyword,"else"),enable:new lt("enable",ct.keyword,"enable"),fallthrough:new lt("fallthrough",ct.keyword,"fallthrough"),false:new lt("false",ct.keyword,"false"),fn:new lt("fn",ct.keyword,"fn"),for:new lt("for",ct.keyword,"for"),function:new lt("function",ct.keyword,"function"),if:new lt("if",ct.keyword,"if"),let:new lt("let",ct.keyword,"let"),const:new lt("const",ct.keyword,"const"),loop:new lt("loop",ct.keyword,"loop"),while:new lt("while",ct.keyword,"while"),private:new lt("private",ct.keyword,"private"),read:new lt("read",ct.keyword,"read"),read_write:new lt("read_write",ct.keyword,"read_write"),return:new lt("return",ct.keyword,"return"),requires:new lt("requires",ct.keyword,"requires"),storage:new lt("storage",ct.keyword,"storage"),switch:new lt("switch",ct.keyword,"switch"),true:new lt("true",ct.keyword,"true"),alias:new lt("alias",ct.keyword,"alias"),type:new lt("type",ct.keyword,"type"),uniform:new lt("uniform",ct.keyword,"uniform"),var:new lt("var",ct.keyword,"var"),override:new lt("override",ct.keyword,"override"),workgroup:new lt("workgroup",ct.keyword,"workgroup"),write:new lt("write",ct.keyword,"write"),r8unorm:new lt("r8unorm",ct.keyword,"r8unorm"),r8snorm:new lt("r8snorm",ct.keyword,"r8snorm"),r8uint:new lt("r8uint",ct.keyword,"r8uint"),r8sint:new lt("r8sint",ct.keyword,"r8sint"),r16uint:new lt("r16uint",ct.keyword,"r16uint"),r16sint:new lt("r16sint",ct.keyword,"r16sint"),r16float:new lt("r16float",ct.keyword,"r16float"),rg8unorm:new lt("rg8unorm",ct.keyword,"rg8unorm"),rg8snorm:new lt("rg8snorm",ct.keyword,"rg8snorm"),rg8uint:new lt("rg8uint",ct.keyword,"rg8uint"),rg8sint:new lt("rg8sint",ct.keyword,"rg8sint"),r32uint:new lt("r32uint",ct.keyword,"r32uint"),r32sint:new lt("r32sint",ct.keyword,"r32sint"),r32float:new lt("r32float",ct.keyword,"r32float"),rg16uint:new lt("rg16uint",ct.keyword,"rg16uint"),rg16sint:new lt("rg16sint",ct.keyword,"rg16sint"),rg16float:new lt("rg16float",ct.keyword,"rg16float"),rgba8unorm:new lt("rgba8unorm",ct.keyword,"rgba8unorm"),rgba8unorm_srgb:new lt("rgba8unorm_srgb",ct.keyword,"rgba8unorm_srgb"),rgba8snorm:new lt("rgba8snorm",ct.keyword,"rgba8snorm"),rgba8uint:new lt("rgba8uint",ct.keyword,"rgba8uint"),rgba8sint:new lt("rgba8sint",ct.keyword,"rgba8sint"),bgra8unorm:new lt("bgra8unorm",ct.keyword,"bgra8unorm"),bgra8unorm_srgb:new lt("bgra8unorm_srgb",ct.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new lt("rgb10a2unorm",ct.keyword,"rgb10a2unorm"),rg11b10float:new lt("rg11b10float",ct.keyword,"rg11b10float"),rg32uint:new lt("rg32uint",ct.keyword,"rg32uint"),rg32sint:new lt("rg32sint",ct.keyword,"rg32sint"),rg32float:new lt("rg32float",ct.keyword,"rg32float"),rgba16uint:new lt("rgba16uint",ct.keyword,"rgba16uint"),rgba16sint:new lt("rgba16sint",ct.keyword,"rgba16sint"),rgba16float:new lt("rgba16float",ct.keyword,"rgba16float"),rgba32uint:new lt("rgba32uint",ct.keyword,"rgba32uint"),rgba32sint:new lt("rgba32sint",ct.keyword,"rgba32sint"),rgba32float:new lt("rgba32float",ct.keyword,"rgba32float"),static_assert:new lt("static_assert",ct.keyword,"static_assert")},Se.tokens={decimal_float_literal:new lt("decimal_float_literal",ct.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new lt("hex_float_literal",ct.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new lt("int_literal",ct.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new lt("uint_literal",ct.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new lt("name",ct.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new lt("ident",ct.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new lt("and",ct.token,"&"),and_and:new lt("and_and",ct.token,"&&"),arrow:new lt("arrow ",ct.token,"->"),attr:new lt("attr",ct.token,"@"),forward_slash:new lt("forward_slash",ct.token,"/"),bang:new lt("bang",ct.token,"!"),bracket_left:new lt("bracket_left",ct.token,"["),bracket_right:new lt("bracket_right",ct.token,"]"),brace_left:new lt("brace_left",ct.token,"{"),brace_right:new lt("brace_right",ct.token,"}"),colon:new lt("colon",ct.token,":"),comma:new lt("comma",ct.token,","),equal:new lt("equal",ct.token,"="),equal_equal:new lt("equal_equal",ct.token,"=="),not_equal:new lt("not_equal",ct.token,"!="),greater_than:new lt("greater_than",ct.token,">"),greater_than_equal:new lt("greater_than_equal",ct.token,">="),shift_right:new lt("shift_right",ct.token,">>"),less_than:new lt("less_than",ct.token,"<"),less_than_equal:new lt("less_than_equal",ct.token,"<="),shift_left:new lt("shift_left",ct.token,"<<"),modulo:new lt("modulo",ct.token,"%"),minus:new lt("minus",ct.token,"-"),minus_minus:new lt("minus_minus",ct.token,"--"),period:new lt("period",ct.token,"."),plus:new lt("plus",ct.token,"+"),plus_plus:new lt("plus_plus",ct.token,"++"),or:new lt("or",ct.token,"|"),or_or:new lt("or_or",ct.token,"||"),paren_left:new lt("paren_left",ct.token,"("),paren_right:new lt("paren_right",ct.token,")"),semicolon:new lt("semicolon",ct.token,";"),star:new lt("star",ct.token,"*"),tilde:new lt("tilde",ct.token,"~"),underscore:new lt("underscore",ct.token,"_"),xor:new lt("xor",ct.token,"^"),plus_equal:new lt("plus_equal",ct.token,"+="),minus_equal:new lt("minus_equal",ct.token,"-="),times_equal:new lt("times_equal",ct.token,"*="),division_equal:new lt("division_equal",ct.token,"/="),modulo_equal:new lt("modulo_equal",ct.token,"%="),and_equal:new lt("and_equal",ct.token,"&="),or_equal:new lt("or_equal",ct.token,"|="),xor_equal:new lt("xor_equal",ct.token,"^="),shift_right_equal:new lt("shift_right_equal",ct.token,">>="),shift_left_equal:new lt("shift_left_equal",ct.token,"<<=")},Se.simpleTokens={"@":vt.tokens.attr,"{":vt.tokens.brace_left,"}":vt.tokens.brace_right,":":vt.tokens.colon,",":vt.tokens.comma,"(":vt.tokens.paren_left,")":vt.tokens.paren_right,";":vt.tokens.semicolon},Se.literalTokens={"&":vt.tokens.and,"&&":vt.tokens.and_and,"->":vt.tokens.arrow,"/":vt.tokens.forward_slash,"!":vt.tokens.bang,"[":vt.tokens.bracket_left,"]":vt.tokens.bracket_right,"=":vt.tokens.equal,"==":vt.tokens.equal_equal,"!=":vt.tokens.not_equal,">":vt.tokens.greater_than,">=":vt.tokens.greater_than_equal,">>":vt.tokens.shift_right,"<":vt.tokens.less_than,"<=":vt.tokens.less_than_equal,"<<":vt.tokens.shift_left,"%":vt.tokens.modulo,"-":vt.tokens.minus,"--":vt.tokens.minus_minus,".":vt.tokens.period,"+":vt.tokens.plus,"++":vt.tokens.plus_plus,"|":vt.tokens.or,"||":vt.tokens.or_or,"*":vt.tokens.star,"~":vt.tokens.tilde,_:vt.tokens.underscore,"^":vt.tokens.xor,"+=":vt.tokens.plus_equal,"-=":vt.tokens.minus_equal,"*=":vt.tokens.times_equal,"/=":vt.tokens.division_equal,"%=":vt.tokens.modulo_equal,"&=":vt.tokens.and_equal,"|=":vt.tokens.or_equal,"^=":vt.tokens.xor_equal,">>=":vt.tokens.shift_right_equal,"<<=":vt.tokens.shift_left_equal},Se.regexTokens={decimal_float_literal:vt.tokens.decimal_float_literal,hex_float_literal:vt.tokens.hex_float_literal,int_literal:vt.tokens.int_literal,uint_literal:vt.tokens.uint_literal,ident:vt.tokens.ident},Se.storage_class=[vt.keywords.function,vt.keywords.private,vt.keywords.workgroup,vt.keywords.uniform,vt.keywords.storage],Se.access_mode=[vt.keywords.read,vt.keywords.write,vt.keywords.read_write],Se.sampler_type=[vt.keywords.sampler,vt.keywords.sampler_comparison],Se.sampled_texture_type=[vt.keywords.texture_1d,vt.keywords.texture_2d,vt.keywords.texture_2d_array,vt.keywords.texture_3d,vt.keywords.texture_cube,vt.keywords.texture_cube_array],Se.multisampled_texture_type=[vt.keywords.texture_multisampled_2d],Se.storage_texture_type=[vt.keywords.texture_storage_1d,vt.keywords.texture_storage_2d,vt.keywords.texture_storage_2d_array,vt.keywords.texture_storage_3d],Se.depth_texture_type=[vt.keywords.texture_depth_2d,vt.keywords.texture_depth_2d_array,vt.keywords.texture_depth_cube,vt.keywords.texture_depth_cube_array,vt.keywords.texture_depth_multisampled_2d],Se.texture_external_type=[vt.keywords.texture_external],Se.any_texture_type=[...vt.sampled_texture_type,...vt.multisampled_texture_type,...vt.storage_texture_type,...vt.depth_texture_type,...vt.texture_external_type],Se.texel_format=[vt.keywords.r8unorm,vt.keywords.r8snorm,vt.keywords.r8uint,vt.keywords.r8sint,vt.keywords.r16uint,vt.keywords.r16sint,vt.keywords.r16float,vt.keywords.rg8unorm,vt.keywords.rg8snorm,vt.keywords.rg8uint,vt.keywords.rg8sint,vt.keywords.r32uint,vt.keywords.r32sint,vt.keywords.r32float,vt.keywords.rg16uint,vt.keywords.rg16sint,vt.keywords.rg16float,vt.keywords.rgba8unorm,vt.keywords.rgba8unorm_srgb,vt.keywords.rgba8snorm,vt.keywords.rgba8uint,vt.keywords.rgba8sint,vt.keywords.bgra8unorm,vt.keywords.bgra8unorm_srgb,vt.keywords.rgb10a2unorm,vt.keywords.rg11b10float,vt.keywords.rg32uint,vt.keywords.rg32sint,vt.keywords.rg32float,vt.keywords.rgba16uint,vt.keywords.rgba16sint,vt.keywords.rgba16float,vt.keywords.rgba32uint,vt.keywords.rgba32sint,vt.keywords.rgba32float],Se.const_literal=[vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.decimal_float_literal,vt.tokens.hex_float_literal,vt.keywords.true,vt.keywords.false],Se.literal_or_ident=[vt.tokens.ident,vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.decimal_float_literal,vt.tokens.hex_float_literal,vt.tokens.name],Se.element_count_expression=[vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.ident],Se.template_types=[vt.keywords.vec2,vt.keywords.vec3,vt.keywords.vec4,vt.keywords.mat2x2,vt.keywords.mat2x3,vt.keywords.mat2x4,vt.keywords.mat3x2,vt.keywords.mat3x3,vt.keywords.mat3x4,vt.keywords.mat4x2,vt.keywords.mat4x3,vt.keywords.mat4x4,vt.keywords.atomic,vt.keywords.bitcast,...vt.any_texture_type],Se.attribute_name=[vt.tokens.ident,vt.keywords.block,vt.keywords.diagnostic],Se.assignment_operators=[vt.tokens.equal,vt.tokens.plus_equal,vt.tokens.minus_equal,vt.tokens.times_equal,vt.tokens.division_equal,vt.tokens.modulo_equal,vt.tokens.and_equal,vt.tokens.or_equal,vt.tokens.xor_equal,vt.tokens.shift_right_equal,vt.tokens.shift_left_equal],Se.increment_operators=[vt.tokens.plus_plus,vt.tokens.minus_minus];var $b=class{constructor(e,r,i,n,o){this.type=e,this.lexeme=r,this.line=i,this.start=n,this.end=o}toString(){return this.lexeme}isTemplateType(){return Se.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Se.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},jS=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new $b(Se.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}let r=Se.simpleTokens[e];if(r)return this._addToken(r),!0;let i=Se.none,n=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)e+=this._advance(),a=this._peekAhead()}if(n){let a=Se.keywords[e];if(a)return this._addToken(a),!0}if(n||o)return this._addToken(Se.tokens.ident),!0;for(;;){let a=this._findType(e),c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(Se.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(Se.tokens.minus_minus),!0;let h=this._tokens.length-1;if((Se.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==Se.tokens.paren_right)&&c!=">")return this._addToken(a),!0}if(e==">"&&(c==">"||c=="=")){let h=!1,p=this._tokens.length-1;for(let x=0;x<5&&p>=0&&Se.assignment_operators.indexOf(this._tokens[p].type)===-1;++x,--p)if(this._tokens[p].type===Se.tokens.less_than){p>0&&this._tokens[p-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(a),!0}if(a===Se.none){let h=e,p=0,x=2;for(let T=0;T<x;++T)if(h+=this._peekAhead(T),a=this._findType(h),a!==Se.none){p=T;break}if(a===Se.none)return i!==Se.none&&(this._current--,this._addToken(i),!0);e=h,this._current+=p+1}if(i=a,this._isAtEnd())break;e+=this._advance()}return i!==Se.none&&(this._addToken(i),!0)}_findType(e){for(let i in Se.regexTokens){let n=Se.regexTokens[i];if(this._match(e,n.rule))return n}return Se.literalTokens[e]||Se.none}_match(e,r){let i=r.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let r=this._source.substring(this._start,this._current);this._tokens.push(new $b(e,r,this._line,this._start,this._current))}};function pr(t){return Array.isArray(t)||t?.buffer instanceof ArrayBuffer}var qb=new Float32Array(1),jQ=new Uint32Array(qb.buffer),GQ=new Uint32Array(qb.buffer),Zb=new Int32Array(1),HQ=new Float32Array(Zb.buffer),WQ=new Uint32Array(Zb.buffer),Xb=new Uint32Array(1),$Q=new Float32Array(Xb.buffer),qQ=new Int32Array(Xb.buffer);function t8(t,e,r){if(e===r)return t;if(e==="f32"){if(r==="i32"||r==="x32")return qb[0]=t,jQ[0];if(r==="u32")return qb[0]=t,GQ[0]}else if(e==="i32"||e==="x32"){if(r==="f32")return Zb[0]=t,HQ[0];if(r==="u32")return Zb[0]=t,WQ[0]}else if(e==="u32"){if(r==="f32")return Xb[0]=t,$Q[0];if(r==="i32"||r==="x32")return Xb[0]=t,qQ[0]}return console.error(`Unsupported cast from ${e} to ${r}`),t}var GS=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},K0=class{constructor(e,r){this.align=e,this.size=r}},$p=class t{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new FS,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(let r of e)r instanceof qp&&this._functions.set(r.name,new GS(r));for(let r of e)if(r instanceof Tc){let i=this.getTypeInfo(r,null);i instanceof Iu&&this.structs.push(i)}for(let r of e)if(r instanceof f1)this.aliases.push(this._getAliasInfo(r));else if(r instanceof u1){let i=r,n=this._getAttributeNum(i.attributes,"id",0),o=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new LS(i.name,o,i.attributes,n))}else if(this._isUniformVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=new X0(i.name,a,n,o,i.attributes,ld.Uniform,i.access);c.access||(c.access="read"),this.uniforms.push(c)}else if(this._isStorageVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(a),h=new X0(i.name,a,n,o,i.attributes,c?ld.StorageTexture:ld.Storage,i.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(a),h=new X0(i.name,a,n,o,i.attributes,c?ld.StorageTexture:ld.Texture,i.access);h.access||(h.access="read"),c?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(r)){let i=r,n=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=new X0(i.name,a,n,o,i.attributes,ld.Sampler,i.access);this.samplers.push(c)}else if(r instanceof qp){let i=this._getAttribute(r,"vertex"),n=this._getAttribute(r,"fragment"),o=this._getAttribute(r,"compute"),a=i||n||o,c=new DS(r.name,a?.name,r.attributes);c.attributes=r.attributes,c.startLine=r.startLine,c.endLine=r.endLine,this.functions.push(c),this._functions.get(r.name).info=c,a&&(this._functions.get(r.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(r,!!a),c.inputs=this._getInputs(r.args),c.outputs=this._getOutputs(r.returnType),this.entry[a.name].push(c)),c.arguments=r.args.map(h=>new OS(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),c.returnType=r.returnType?this.getTypeInfo(r.returnType,r.attributes):null}for(let r of this._functions.values())r.info&&(r.info.inUse=r.inUse,this._addCalls(r.node,r.info.calls));for(let r of this._functions.values())r.node.search(i=>{var n,o,a;if(i instanceof Wb){if(i.value)if(pr(i.value))for(let c of i.value)for(let h of this.overrides)c===h.name&&((n=r.info)===null||n===void 0||n.overrides.push(h));else for(let c of this.overrides)i.value===c.name&&((o=r.info)===null||o===void 0||o.overrides.push(c))}else if(i instanceof ca)for(let c of this.overrides)i.name===c.name&&((a=r.info)===null||a===void 0||a.overrides.push(c))});for(let r of this.uniforms)this._markStructsInUse(r.type);for(let r of this.storage)this._markStructsInUse(r.type)}getStructInfo(e){for(let r of this.structs)if(r.name==e)return r;return null}getOverrideInfo(e){for(let r of this.overrides)if(r.name==e)return r;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var i;for(let n of e.calls){let o=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;o&&r.add(o)}}findResource(e,r,i){if(i){for(let n of this.entry.compute)if(n.name===i){for(let o of n.resources)if(o.group==e&&o.binding==r)return o}for(let n of this.entry.vertex)if(n.name===i){for(let o of n.resources)if(o.group==e&&o.binding==r)return o}for(let n of this.entry.fragment)if(n.name===i){for(let o of n.resources)if(o.group==e&&o.binding==r)return o}}for(let n of this.uniforms)if(n.group==e&&n.binding==r)return n;for(let n of this.storage)if(n.group==e&&n.binding==r)return n;for(let n of this.textures)if(n.group==e&&n.binding==r)return n;for(let n of this.samplers)if(n.group==e&&n.binding==r)return n;return null}_findResource(e){for(let r of this.uniforms)if(r.name==e)return r;for(let r of this.storage)if(r.name==e)return r;for(let r of this.textures)if(r.name==e)return r;for(let r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){let r=this.getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){let i=[],n=this,o=[];return e.search(a=>{if(a instanceof tm)o.push({});else if(a instanceof rm)o.pop();else if(a instanceof Ec){let c=a;r&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(a instanceof Cl){let c=a;r&&c.type!==null&&this._markStructsFromAST(c.type)}else if(a instanceof Hp){let c=a;r&&c.type!==null&&this._markStructsFromAST(c.type),o.length>0&&(o[o.length-1][c.name]=c)}else if(a instanceof ca){let c=a;if(o.length>0&&o[o.length-1][c.name])return;let h=n._findResource(c.name);h&&i.push(h)}else if(a instanceof d1){let c=a,h=n._functions.get(c.name);h&&(r&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=n._findResources(h.node,r)),i.push(...h.resources))}else if(a instanceof h1){let c=a,h=n._functions.get(c.name);h&&(r&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=n._findResources(h.node,r)),i.push(...h.resources))}}),[...new Map(i.map(a=>[a.name,a])).values()]}getBindGroups(){let e=[];function r(i,n){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),n>=e[i].length&&(e[i].length=n+1)}for(let i of this.uniforms)r(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.storage)r(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.textures)r(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.samplers)r(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Tc)this._getStructOutputs(e,r);else{let i=this._getOutputInfo(e);i!==null&&r.push(i)}return r}_getStructOutputs(e,r){for(let i of e.members)if(i.type instanceof Tc)this._getStructOutputs(i.type,r);else{let n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){let o=this.getTypeInfo(i.type,i.type.attributes),a=this._parseInt(n.value),c=new Tb(i.name,o,n.name,a);r.push(c)}}}_getOutputInfo(e){let r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){let i=this.getTypeInfo(e,e.attributes),n=this._parseInt(r.value);return new Tb("",i,r.name,n)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(let i of e)if(i.type instanceof Tc)this._getStructInputs(i.type,r);else{let n=this._getInputInfo(i);n!==null&&r.push(n)}return r}_getStructInputs(e,r){for(let i of e.members)if(i.type instanceof Tc)this._getStructInputs(i.type,r);else{let n=this._getInputInfo(i);n!==null&&r.push(n)}}_getInputInfo(e){let r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){let i=this._getAttribute(e,"interpolation"),n=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(r.value),a=new BS(e.name,n,r.name,o);return i!==null&&(a.interpolation=this._parseString(i.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(let r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new RS(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(let r of this.structs)if(r.name==e)return r;for(let r of this.aliases)if(r.name==e)return r.type;return null}getTypeInfo(e,r=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Wp){let n=e,o=n.format?this.getTypeInfo(n.format,n.attributes):null,a=new Mu(n.name,r);return a.format=o,a.count=n.count,this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Tc){let n=e,o=new Iu(n.name,r);o.startLine=n.startLine,o.endLine=n.endLine;for(let a of n.members){let c=this.getTypeInfo(a.type,a.attributes);o.members.push(new wb(a.name,c,a.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Gp){let n=e,o=n.format instanceof Zt,a=n.format?o?this.getTypeInfo(n.format,null):new Ma(n.format,null):null,c=new kh(n.name,a,r,n.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof pt){let n=e,o=n.format?this.getTypeInfo(n.format,null):null,a=new kh(n.name,o,r,n.access);return this._types.set(e,a),this._updateTypeInfo(a),a}let i=new Ma(e.name,r);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var r,i,n;let o=this._getTypeSize(e);if(e.size=(r=o?.size)!==null&&r!==void 0?r:0,e instanceof Mu&&e.format){let a=this._getTypeSize(e.format);e.stride=Math.max((i=a?.size)!==null&&i!==void 0?i:0,(n=a?.align)!==null&&n!==void 0?n:0),this._updateTypeInfo(e.format)}e instanceof Iu&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let i=0,n=0,o=0,a=0;for(let c=0,h=e.members.length;c<h;++c){let p=e.members[c],x=this._getTypeSize(p);if(!x)continue;(r=this._getAlias(p.type.name))!==null&&r!==void 0||p.type;let T=x.align,R=x.size;i=this._roundUp(T,i+n),n=R,o=i,a=Math.max(a,T),p.offset=i,p.size=R,this._updateTypeInfo(p.type)}e.size=this._roundUp(a,o+n),e.align=a}_getTypeSize(e){var r,i;if(e==null)return null;let n=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof wb&&(e=e.type),e instanceof Ma){let a=this._getAlias(e.name);a!==null&&(e=a)}{let a=t._typeInfo[e.name];if(a!==void 0){let c=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new K0(Math.max(o,a.align/c),Math.max(n,a.size/c))}}{let a=t._typeInfo[e.name.substring(0,e.name.length-1)];if(a){let c=e.name[e.name.length-1]==="h"?2:1;return new K0(Math.max(o,a.align/c),Math.max(n,a.size/c))}}if(e instanceof Mu){let a=e,c=8,h=8,p=this._getTypeSize(a.format);return p!==null&&(h=p.size,c=p.align),h=a.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(c,h)),n&&(h=n),new K0(Math.max(o,c),Math.max(n,h))}if(e instanceof Iu){let a=0,c=0,h=0,p=0,x=0;for(let T of e.members){let R=this._getTypeSize(T.type);R!==null&&(a=Math.max(R.align,a),h=this._roundUp(R.align,h+p),p=R.size,x=h)}return c=this._roundUp(a,x+p),new K0(Math.max(o,a),Math.max(n,c))}return null}_isUniformVar(e){return e instanceof Ec&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ec&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ec&&e.type!==null&&t._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ec&&e.type!==null&&t._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){let i=e;if(!i||!i.attributes)return null;let n=i.attributes;for(let o of n)if(o.name==r)return o;return null}_getAttributeNum(e,r,i){if(e===null)return i;for(let n of e)if(n.name==r){let o=n!==null&&n.value!==null?n.value:i;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):i}return i}_roundUp(e,r){return Math.ceil(r/e)*e}};$p._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},$p._textureTypes=Se.any_texture_type.map(t=>t.name),$p._samplerTypes=Se.sampler_type.map(t=>t.name);var HS=class t{constructor(e,r,i){this.name=e,this.value=r,this.node=i}clone(){return new t(this.name,this.value,this.node)}},WS=class t{constructor(e){this.name=e.name,this.node=e}clone(){return new t(this.node)}},$S=class t{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var r;return this.variables.has(e)?(r=this.variables.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var r;return this.functions.has(e)?(r=this.functions.get(e))!==null&&r!==void 0?r:null:this.parent?this.parent.getFunction(e):null}createVariable(e,r,i){this.variables.set(e,new HS(e,r,i??null))}setVariable(e,r,i){let n=this.getVariable(e);n!==null?n.value=r:this.createVariable(e,r,i)}getVariableValue(e){var r;let i=this.getVariable(e);return(r=i?.value)!==null&&r!==void 0?r:null}clone(){return new t(this)}},qS=class{evalExpression(e,r){return null}getTypeInfo(e){return null}getVariableName(e,r){return""}},ZS=class{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,r){let i=this.exec.evalExpression(e.args[0],r),n=!0;if(i instanceof ke)return i.data.forEach(o=>{o||(n=!1)}),new ht(n?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke){let n=i.data.some(o=>o);return new ht(n?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,r){let i=this.exec.evalExpression(e.args[2],r);if(!(i instanceof ht))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],r):this.exec.evalExpression(e.args[0],r)}ArrayLength(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.evalExpression(i,r);if(n instanceof Ho&&n.typeInfo.size===0){let o=n.typeInfo,a=n.buffer.byteLength/o.stride;return new ht(a,this.getTypeInfo("u32"))}return new ht(n.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.abs(o)),i.typeInfo);let n=i;return new ht(Math.abs(n.value),n.typeInfo)}Acos(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.acos(o)),i.typeInfo);let n=i;return new ht(Math.acos(n.value),i.typeInfo)}Acosh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.acosh(o)),i.typeInfo);let n=i;return new ht(Math.acosh(n.value),i.typeInfo)}Asin(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.asin(o)),i.typeInfo);let n=i;return new ht(Math.asin(n.value),i.typeInfo)}Asinh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.asinh(o)),i.typeInfo);let n=i;return new ht(Math.asinh(n.value),i.typeInfo)}Atan(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.atan(o)),i.typeInfo);let n=i;return new ht(Math.atan(n.value),i.typeInfo)}Atanh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.atanh(o)),i.typeInfo);let n=i;return new ht(Math.atanh(n.value),i.typeInfo)}Atan2(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke)return new ke(i.data.map((c,h)=>Math.atan2(c,n.data[h])),i.typeInfo);let o=i,a=n;return new ht(Math.atan2(o.value,a.value),i.typeInfo)}Ceil(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.ceil(o)),i.typeInfo);let n=i;return new ht(Math.ceil(n.value),i.typeInfo)}_clamp(e,r,i){return Math.min(Math.max(e,r),i)}Clamp(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(i instanceof ke&&n instanceof ke&&o instanceof ke)return new ke(i.data.map((p,x)=>this._clamp(p,n.data[x],o.data[x])),i.typeInfo);let a=i,c=n,h=o;return new ht(this._clamp(a.value,c.value,h.value),i.typeInfo)}Cos(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.cos(o)),i.typeInfo);let n=i;return new ht(Math.cos(n.value),i.typeInfo)}Cosh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.cosh(o)),i.typeInfo);let n=i;return new ht(Math.cos(n.value),i.typeInfo)}CountLeadingZeros(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.clz32(o)),i.typeInfo);let n=i;return new ht(Math.clz32(n.value),i.typeInfo)}_countOneBits(e){let r=0;for(;e!==0;)1&e&&r++,e>>=1;return r}CountOneBits(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>this._countOneBits(o)),i.typeInfo);let n=i;return new ht(this._countOneBits(n.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let r=0;for(;!(1&e);)e>>=1,r++;return r}CountTrailingZeros(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>this._countTrailingZeros(o)),i.typeInfo);let n=i;return new ht(this._countTrailingZeros(n.value),i.typeInfo)}Cross(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke){if(i.data.length!==3||n.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;let o=i.data,a=n.data;return new ke([o[1]*a[2]-a[1]*o[2],o[2]*a[0]-a[2]*o[0],o[0]*a[1]-a[0]*o[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,r){let i=this.exec.evalExpression(e.args[0],r),n=180/Math.PI;return i instanceof ke?new ke(i.data.map(o=>o*n),i.typeInfo):new ht(i.value*n,this.getTypeInfo("f32"))}Determinant(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof qr){let n=i.data,o=i.typeInfo.getTypeName(),a=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new ht(n[0]*n[3]-n[1]*n[2],a);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new ht(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),a);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new ht(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),a);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke){let c=0;for(let h=0;h<i.data.length;++h)c+=(i.data[h]-n.data[h])*(i.data[h]-n.data[h]);return new ht(Math.sqrt(c),this.getTypeInfo("f32"))}let o=i,a=n;return new ht(Math.abs(o.value-a.value),i.typeInfo)}_dot(e,r){let i=0;for(let n=0;n<e.length;++n)i+=r[n]*e[n];return i}Dot(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);return i instanceof ke&&n instanceof ke?new ht(this._dot(i.data,n.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,r){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,r){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.exp(o)),i.typeInfo);let n=i;return new ht(Math.exp(n.value),i.typeInfo)}Exp2(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.pow(2,o)),i.typeInfo);let n=i;return new ht(Math.pow(2,n.value),i.typeInfo)}ExtractBits(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(n.typeInfo.name!=="u32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;let a=n.value,c=o.value;if(i instanceof ke)return new ke(i.data.map(p=>p>>a&(1<<c)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;let h=i.value;return new ht(h>>a&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(i instanceof ke&&n instanceof ke&&o instanceof ke){let a=this._dot(n.data,o.data);return new ke(a<0?Array.from(i.data):i.data.map(c=>-c),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>this._firstLeadingBit(o)),i.typeInfo);let n=i;return new ht(this._firstLeadingBit(n.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>this._firstTrailingBit(o)),i.typeInfo);let n=i;return new ht(this._firstTrailingBit(n.value),i.typeInfo)}Floor(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.floor(o)),i.typeInfo);let n=i;return new ht(Math.floor(n.value),i.typeInfo)}Fma(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(i instanceof ke&&n instanceof ke&&o instanceof ke)return i.data.length!==n.data.length||i.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new ke(i.data.map((p,x)=>p*n.data[x]+o.data[x]),i.typeInfo);let a=i,c=n,h=o;return new ht(a.value*c.value+h.value,a.typeInfo)}Fract(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>o-Math.floor(o)),i.typeInfo);let n=i;return new ht(n.value-Math.floor(n.value),i.typeInfo)}Frexp(e,r){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r),a=this.exec.evalExpression(e.args[3],r);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;let c=o.value,h=(1<<a.value)-1<<c,p=~h;if(i instanceof ke&&n instanceof ke)return new ke(i.data.map((R,k)=>R&p|n.data[k]<<c&h),i.typeInfo);let x=i.value,T=n.value;return new ht(x&p|T<<c&h,i.typeInfo)}InverseSqrt(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>1/Math.sqrt(o)),i.typeInfo);let n=i;return new ht(1/Math.sqrt(n.value),i.typeInfo)}Ldexp(e,r){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke){let o=0;return i.data.forEach(a=>{o+=a*a}),new ht(Math.sqrt(o),this.getTypeInfo("f32"))}let n=i;return new ht(Math.abs(n.value),i.typeInfo)}Log(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.log(o)),i.typeInfo);let n=i;return new ht(Math.log(n.value),i.typeInfo)}Log2(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.log2(o)),i.typeInfo);let n=i;return new ht(Math.log2(n.value),i.typeInfo)}Max(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke)return new ke(i.data.map((c,h)=>Math.max(c,n.data[h])),i.typeInfo);let o=i,a=n;return new ht(Math.max(o.value,a.value),i.typeInfo)}Min(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke)return new ke(i.data.map((c,h)=>Math.min(c,n.data[h])),i.typeInfo);let o=i,a=n;return new ht(Math.min(o.value,a.value),i.typeInfo)}Mix(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(i instanceof ke&&n instanceof ke&&o instanceof ke)return new ke(i.data.map((h,p)=>i.data[p]*(1-o.data[p])+n.data[p]*o.data[p]),i.typeInfo);let a=n,c=o;return new ht(i.value*(1-c.value)+a.value*c.value,i.typeInfo)}Modf(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke)return new ke(i.data.map((a,c)=>a%n.data[c]),i.typeInfo);let o=n;return new ht(i.value%o.value,i.typeInfo)}Normalize(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke){let n=this.Length(e,r).value;return new ke(i.data.map(o=>o/n),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke)return new ke(i.data.map((c,h)=>Math.pow(c,n.data[h])),i.typeInfo);let o=i,a=n;return new ht(Math.pow(o.value,a.value),i.typeInfo)}QuantizeToF16(e,r){let i=this.exec.evalExpression(e.args[0],r);return i instanceof ke?new ke(i.data.map(n=>n),i.typeInfo):new ht(i.value,i.typeInfo)}Radians(e,r){let i=this.exec.evalExpression(e.args[0],r);return i instanceof ke?new ke(i.data.map(n=>n*Math.PI/180),i.typeInfo):new ht(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(i instanceof ke&&n instanceof ke){let o=this._dot(i.data,n.data);return new ke(i.data.map((a,c)=>a-2*o*n.data[c]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(i instanceof ke&&n instanceof ke&&o instanceof ht){let a=this._dot(n.data,i.data);return new ke(i.data.map((c,h)=>{let p=1-o.value*o.value*(1-a*a);if(p<0)return 0;let x=Math.sqrt(p);return o.value*c-(o.value*a+x)*n.data[h]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,r){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.round(o)),i.typeInfo);let n=i;return new ht(Math.round(n.value),i.typeInfo)}Saturate(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.min(Math.max(o,0),1)),i.typeInfo);let n=i;return new ht(Math.min(Math.max(n.value,0),1),i.typeInfo)}Sign(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.sign(o)),i.typeInfo);let n=i;return new ht(Math.sign(n.value),i.typeInfo)}Sin(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.sin(o)),i.typeInfo);let n=i;return new ht(Math.sin(n.value),i.typeInfo)}Sinh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.sinh(o)),i.typeInfo);let n=i;return new ht(Math.sinh(n.value),i.typeInfo)}_smoothstep(e,r,i){let n=Math.min(Math.max((i-e)/(r-e),0),1);return n*n*(3-2*n)}SmoothStep(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r),o=this.exec.evalExpression(e.args[2],r);if(o instanceof ke&&i instanceof ke&&n instanceof ke)return new ke(o.data.map((p,x)=>this._smoothstep(i.data[x],n.data[x],p)),o.typeInfo);let a=i,c=n,h=o;return new ht(this._smoothstep(a.value,c.value,h.value),o.typeInfo)}Sqrt(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.sqrt(o)),i.typeInfo);let n=i;return new ht(Math.sqrt(n.value),i.typeInfo)}Step(e,r){let i=this.exec.evalExpression(e.args[0],r),n=this.exec.evalExpression(e.args[1],r);if(n instanceof ke&&i instanceof ke)return new ke(n.data.map((a,c)=>a<i.data[c]?0:1),n.typeInfo);let o=i;return new ht(n.value<o.value?0:1,o.typeInfo)}Tan(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.tan(o)),i.typeInfo);let n=i;return new ht(Math.tan(n.value),i.typeInfo)}Tanh(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.tanh(o)),i.typeInfo);let n=i;return new ht(Math.tanh(n.value),i.typeInfo)}_getTransposeType(e){let r=e.getTypeName();return r==="mat2x2f"||r==="mat2x2h"?e:r==="mat2x3f"?this.getTypeInfo("mat3x2f"):r==="mat2x3h"?this.getTypeInfo("mat3x2h"):r==="mat2x4f"?this.getTypeInfo("mat4x2f"):r==="mat2x4h"?this.getTypeInfo("mat4x2h"):r==="mat3x2f"?this.getTypeInfo("mat2x3f"):r==="mat3x2h"?this.getTypeInfo("mat2x3h"):r==="mat3x3f"||r==="mat3x3h"?e:r==="mat3x4f"?this.getTypeInfo("mat4x3f"):r==="mat3x4h"?this.getTypeInfo("mat4x3h"):r==="mat4x2f"?this.getTypeInfo("mat2x4f"):r==="mat4x2h"?this.getTypeInfo("mat2x4h"):r==="mat4x3f"?this.getTypeInfo("mat3x4f"):r==="mat4x3h"?this.getTypeInfo("mat3x4h"):(r==="mat4x4f"||r==="mat4x4h"||console.error(`Invalid matrix type ${r}`),e)}Transpose(e,r){let i=this.exec.evalExpression(e.args[0],r);if(!(i instanceof qr))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;let n=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){let o=i.data;return new qr([o[0],o[2],o[1],o[3]],n)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){let o=i.data;return new qr([o[0],o[3],o[6],o[1],o[4],o[7]],n)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){let o=i.data;return new qr([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],n)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){let o=i.data;return new qr([o[0],o[3],o[1],o[4],o[2],o[5]],n)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){let o=i.data;return new qr([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],n)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){let o=i.data;return new qr([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],n)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){let o=i.data;return new qr([o[0],o[4],o[1],o[5],o[2],o[6]],n)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){let o=i.data;return new qr([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],n)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){let o=i.data;return new qr([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],n)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,r){let i=this.exec.evalExpression(e.args[0],r);if(i instanceof ke)return new ke(i.data.map(o=>Math.trunc(o)),i.typeInfo);let n=i;return new ht(Math.trunc(n.value),i.typeInfo)}Dpdx(e,r){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,r){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,r){return console.error("TODO: dpdxFine"),null}Dpdy(e,r){return console.error("TODO: dpdy"),null}DpdyCoarse(e,r){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,r){return console.error("TODO: dpdyFine"),null}Fwidth(e,r){return console.error("TODO: fwidth"),null}FwidthCoarse(e,r){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,r){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,r){let i=e.args[0],n=e.args.length>1?this.exec.evalExpression(e.args[1],r).value:0;if(i instanceof ca){let o=i.name,a=r.getVariableValue(o);if(a instanceof Fh){if(n<0||n>=a.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;let c=a.getMipLevelSize(n),h=a.dimension;return h==="1d"?new ht(c[0],this.getTypeInfo("u32")):h==="3d"?new ke(c,this.getTypeInfo("vec3u")):h==="2d"?new ke(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,r){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,r){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,r){let i=e.args[0],n=this.exec.evalExpression(e.args[1],r),o=e.args.length>2?this.exec.evalExpression(e.args[2],r).value:0;if(!(n instanceof ke)||n.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof ca){let a=i.name,c=r.getVariableValue(a);if(c instanceof Fh){let h=Math.floor(n.data[0]),p=Math.floor(n.data[1]);if(h<0||h>=c.width||p<0||p>=c.height)return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;let x=c.getPixel(h,p,0,o);return x===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new ke(x,this.getTypeInfo("vec4f"))}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,r){let i=e.args[0];if(i instanceof ca){let n=i.name,o=r.getVariableValue(n);return o instanceof Fh?new ht(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,r){let i=e.args[0];if(i instanceof ca){let n=i.name,o=r.getVariableValue(n);return o instanceof Fh?new ht(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,r){let i=e.args[0];if(i instanceof ca){let n=i.name,o=r.getVariableValue(n);return o instanceof Fh?new ht(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,r){return console.error("TODO: textureSample"),null}TextureSampleBias(e,r){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,r){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,r){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,r){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,r){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,r){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,r){let i=e.args[0],n=this.exec.evalExpression(e.args[1],r),o=e.args.length===4?this.exec.evalExpression(e.args[2],r).value:0,a=e.args.length===4?this.exec.evalExpression(e.args[3],r).data:this.exec.evalExpression(e.args[2],r).data;if(a.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(n instanceof ke)||n.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof ca){let c=i.name,h=r.getVariableValue(c);if(h instanceof Fh){let p=h.getMipLevelSize(0),x=Math.floor(n.data[0]),T=Math.floor(n.data[1]);return x<0||x>=p[0]||T<0||T>=p[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(h.setPixel(x,T,0,o,Array.from(a)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r);return r.getVariable(n).value.getSubData(this.exec,i.postfix,r)}AtomicStore(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r);return h instanceof ht&&c instanceof ht&&(h.value=c.value),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),null}AtomicAdd(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value+=c.value),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicSub(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value-=c.value),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicMax(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=Math.max(h.value,c.value)),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicMin(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=Math.min(h.value,c.value)),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicAnd(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=h.value&c.value),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicOr(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=h.value|c.value),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicXor(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=h.value^c.value),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicExchange(e,r){let i=e.args[0];i instanceof go&&(i=i.right);let n=this.exec.getVariableName(i,r),o=r.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,r),h=o.value.getSubData(this.exec,i.postfix,r),p=new ht(h.value,h.typeInfo);return h instanceof ht&&c instanceof ht&&(h.value=c.value),o.value instanceof Ho&&o.value.setDataValue(this.exec,h,i.postfix,r),p}AtomicCompareExchangeWeak(e,r){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,r){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,r){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,r){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,r){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,r){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,r){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,r){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,r){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,r){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,r){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,r){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,r){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,r){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,r){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,r){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,r){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,r){return null}TextureBarrier(e,r){return null}WorkgroupBarrier(e,r){return null}WorkgroupUniformLoad(e,r){return null}SubgroupAdd(e,r){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,r){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,r){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,r){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,r){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,r){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,r){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,r){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,r){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,r){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,r){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,r){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,r){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,r){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,r){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,r){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,r){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,r){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,r){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,r){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,r){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,r){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,r){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,r){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,r){return console.error("TODO: quadSwapY"),null}},PS={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},la={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]},em=class t extends qS{constructor(e,r){var i;super(),this.ast=e??[],this.reflection=new $p,this.reflection.updateAST(this.ast),this.context=(i=r?.clone())!==null&&i!==void 0?i:new $S,this.builtins=new ZS(this),this.typeInfo={bool:this.getTypeInfo(Zt.bool),i32:this.getTypeInfo(Zt.i32),u32:this.getTypeInfo(Zt.u32),f32:this.getTypeInfo(Zt.f32),f16:this.getTypeInfo(Zt.f16),vec2f:this.getTypeInfo(pt.vec2f),vec2u:this.getTypeInfo(pt.vec2u),vec2i:this.getTypeInfo(pt.vec2i),vec2h:this.getTypeInfo(pt.vec2h),vec3f:this.getTypeInfo(pt.vec3f),vec3u:this.getTypeInfo(pt.vec3u),vec3i:this.getTypeInfo(pt.vec3i),vec3h:this.getTypeInfo(pt.vec3h),vec4f:this.getTypeInfo(pt.vec4f),vec4u:this.getTypeInfo(pt.vec4u),vec4i:this.getTypeInfo(pt.vec4i),vec4h:this.getTypeInfo(pt.vec4h),mat2x2f:this.getTypeInfo(pt.mat2x2f),mat2x3f:this.getTypeInfo(pt.mat2x3f),mat2x4f:this.getTypeInfo(pt.mat2x4f),mat3x2f:this.getTypeInfo(pt.mat3x2f),mat3x3f:this.getTypeInfo(pt.mat3x3f),mat3x4f:this.getTypeInfo(pt.mat3x4f),mat4x2f:this.getTypeInfo(pt.mat4x2f),mat4x3f:this.getTypeInfo(pt.mat4x3f),mat4x4f:this.getTypeInfo(pt.mat4x4f)}}getVariableValue(e){var r,i;let n=(i=(r=this.context.getVariable(e))===null||r===void 0?void 0:r.value)!==null&&i!==void 0?i:null;if(n===null)return null;if(n instanceof ht)return n.value;if(n instanceof ke||n instanceof qr)return Array.from(n.data);if(n instanceof Ho&&n.typeInfo instanceof Mu){if(n.typeInfo.format.name==="u32")return Array.from(new Uint32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="i32")return Array.from(new Int32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="f32")return Array.from(new Float32Array(n.buffer,n.offset,n.typeInfo.count))}return console.error(`Unsupported return variable type ${n.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,r,i,n){let o=this.context.clone();(n=n??{}).constants&&this._setOverrides(n.constants,o),this._execStatements(this.ast,o);let a=o.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if(typeof r=="number")r=[r,1,1];else{if(r.length===0)return void console.error("Invalid dispatch count");r.length===1?r=[r[0],1,1]:r.length===2?r=[r[0],r[1],1]:r.length>3&&(r=[r[0],r[1],r[2]])}let c=r[0],h=r[1],p=r[2],x=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new ke(r,x));for(let T in i)for(let R in i[T]){let k=i[T][R];o.variables.forEach(j=>{var q;let Z=j.node;if(Z?.attributes){let re=null,ee=null;for(let se of Z.attributes)se.name==="binding"?re=se.value:se.name==="group"&&(ee=se.value);if(R==re&&T==ee)if(k.texture!==void 0&&k.descriptor!==void 0){let se=new Fh(k.texture,this.getTypeInfo(Z.type),k.descriptor,(q=k.texture.view)!==null&&q!==void 0?q:null);j.value=se}else k.uniform!==void 0?j.value=new Ho(k.uniform,this.getTypeInfo(Z.type)):j.value=new Ho(k,this.getTypeInfo(Z.type))}})}for(let T=0;T<p;++T)for(let R=0;R<h;++R)for(let k=0;k<c;++k)o.setVariable("@workgroup_id",new ke([k,R,T],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[k,R,T],o)}execStatement(e,r){if(e instanceof Bb)return this.evalExpression(e.value,r);if(e instanceof Ob){if(e.condition){let i=this.evalExpression(e.condition,r);if(!(i instanceof ht))throw new Error("Invalid break-if condition");if(!i.value)return null}return t._breakObj}if(e instanceof Db)return t._continueObj;if(e instanceof Hp)this._let(e,r);else if(e instanceof Ec)this._var(e,r);else if(e instanceof Q0)this._const(e,r);else if(e instanceof qp)this._function(e,r);else{if(e instanceof Rb)return this._if(e,r);if(e instanceof Pb)return this._switch(e,r);if(e instanceof Cb)return this._for(e,r);if(e instanceof Eb)return this._while(e,r);if(e instanceof Mb)return this._loop(e,r);if(e instanceof c1){let i=r.clone();return i.currentFunctionName=r.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof Ib)this._assign(e,r);else if(e instanceof Sb)this._increment(e,r);else{if(e instanceof Tc)return null;if(e instanceof u1){let i=e.name;r.getVariable(i)===null&&r.setVariable(i,new ht(0,this.getTypeInfo("u32")))}else if(e instanceof h1)this._call(e,r);else{if(e instanceof Lb||e instanceof f1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,r){return e instanceof rl?this._evalBinaryOp(e,r):e instanceof Mo?this._evalLiteral(e,r):e instanceof ca?this._evalVariable(e,r):e instanceof d1?this._evalCall(e,r):e instanceof Cl?this._evalCreate(e,r):e instanceof kb?this._evalConst(e,r):e instanceof Nb?this._evalBitcast(e,r):e instanceof go?this._evalUnaryOp(e,r):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var r;if(e instanceof Zt){let n=this.reflection.getTypeInfo(e);if(n!==null)return n}let i=(r=this.typeInfo[e])!==null&&r!==void 0?r:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,r){for(let i in e){let n=e[i],o=this.reflection.getOverrideInfo(i);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?r.setVariable(i,new ht(n,o.type)):o.type.name==="bool"?r.setVariable(i,new ht(n?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?r.setVariable(i,new ke(n,o.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,r,i){let n=[1,1,1];for(let x of e.node.attributes)if(x.name==="workgroup_size"){if(x.value.length>0){let T=i.getVariableValue(x.value[0]);n[0]=T instanceof ht?T.value:parseInt(x.value[0])}if(x.value.length>1){let T=i.getVariableValue(x.value[1]);n[1]=T instanceof ht?T.value:parseInt(x.value[1])}if(x.value.length>2){let T=i.getVariableValue(x.value[2]);n[2]=T instanceof ht?T.value:parseInt(x.value[2])}}let o=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new ke(n,o));let c=n[0],h=n[1],p=n[2];for(let x=0,T=0;x<p;++x)for(let R=0;R<h;++R)for(let k=0;k<c;++k,++T){let j=[k,R,x],q=[k+r[0]*n[0],R+r[1]*n[1],x+r[2]*n[2]];i.setVariable("@local_invocation_id",new ke(j,o)),i.setVariable("@global_invocation_id",new ke(q,o)),i.setVariable("@local_invocation_index",new ht(T,a)),this._dispatchExec(e,i)}}_dispatchExec(e,r){for(let i of e.node.args)for(let n of i.attributes)if(n.name==="builtin"){let o=`@${n.value}`,a=r.getVariable(o);a!==void 0&&r.variables.set(i.name,a)}this._execStatements(e.node.body,r)}getVariableName(e,r){for(;e instanceof go;)e=e.right;return e instanceof ca?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,r){for(let i of e){if(i instanceof Array){let o=r.clone(),a=this._execStatements(i,o);if(a)return a;continue}let n=this.execStatement(i,r);if(n)return n}return null}_call(e,r){let i=r.clone();i.currentFunctionName=e.name;let n=r.getFunction(e.name);if(n){for(let o=0;o<n.node.args.length;++o){let a=n.node.args[o],c=this.evalExpression(e.args[o],i);i.setVariable(a.name,c,a)}this._execStatements(n.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,r)}_increment(e,r){let i=this.getVariableName(e.variable,r),n=r.getVariable(i);n?e.operator==="++"?n.value instanceof ht?n.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?n.value instanceof ht?n.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,r){if(e instanceof ca){let i=this.getVariableName(e,r),n=r.getVariable(i);return n===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):n.value.getSubData(this,e.postfix,r)}if(e instanceof go){if(e.operator==="*"){let i=this._getVariableData(e.right,r);return i instanceof cd?i.reference.getSubData(this,e.postfix,r):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){let i=this._getVariableData(e.right,r);return new cd(i)}}return null}_assign(e,r){let i=null,n="<var>",o=null;if(e.variable instanceof go){let h=this._getVariableData(e.variable,r),p=this.evalExpression(e.value,r),x=e.operator;if(x==="="){if(h instanceof ht||h instanceof ke||h instanceof qr){if(p instanceof ht||p instanceof ke||p instanceof qr&&h.data.length===p.data.length)return void h.data.set(p.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof Ho&&p instanceof Ho&&h.buffer.byteLength-h.offset>=p.buffer.byteLength-p.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(p.buffer,p.offset,p.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(p.buffer,p.offset,p.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(x==="+=")return h instanceof ht||h instanceof ke||h instanceof qr?p instanceof ht||p instanceof ke||p instanceof qr?void h.data.set(p.data.map((T,R)=>h.data[R]+T)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(x==="-=")return(h instanceof ht||h instanceof ke||h instanceof qr)&&(p instanceof ht||p instanceof ke||p instanceof qr)?void h.data.set(p.data.map((T,R)=>h.data[R]-T)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof go){if(e.variable.operator==="*"){n=this.getVariableName(e.variable.right,r);let h=r.getVariable(n);if(!(h&&h.value instanceof cd))return void console.error(`Variable ${n} is not a pointer. Line ${e.line}`);i=h.value.reference;let p=e.variable.postfix;if(!p){let x=e.variable.right;for(;x instanceof go;){if(x.postfix){p=x.postfix;break}x=x.right}}p&&(i=i.getSubData(this,p,r))}}else{o=e.variable.postfix,n=this.getVariableName(e.variable,r);let h=r.getVariable(n);if(h===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);i=h.value}if(i instanceof cd&&(i=i.reference),i===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);let a=this.evalExpression(e.value,r),c=e.operator;if(c==="=")if(i instanceof Ho)i.setDataValue(this,a,o,r);else if(o){if(!(i instanceof ke||i instanceof qr))return void console.error(`Variable ${n} is not a vector or matrix. Line ${e.line}`);if(o instanceof ud){let h=this.evalExpression(o.index,r).value;if(i instanceof ke){if(!(a instanceof ht))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[h]=a.value}else{if(!(i instanceof qr))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let p=this.evalExpression(o.index,r).value;if(p<0)return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(a instanceof ke))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let x=i.typeInfo.getTypeName();if(x==="mat2x2"||x==="mat2x2f"||x==="mat2x2h"){if(!(p<2&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(x==="mat2x3"||x==="mat2x3f"||x==="mat2x3h"){if(!(p<2&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else if(x==="mat2x4"||x==="mat2x4f"||x==="mat2x4h"){if(!(p<2&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}else if(x==="mat3x2"||x==="mat3x2f"||x==="mat3x2h"){if(!(p<3&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(x==="mat3x3"||x==="mat3x3f"||x==="mat3x3h"){if(!(p<3&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else if(x==="mat3x4"||x==="mat3x4f"||x==="mat3x4h"){if(!(p<3&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}else if(x==="mat4x2"||x==="mat4x2f"||x==="mat4x2h"){if(!(p<4&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(x==="mat4x3"||x==="mat4x3f"||x==="mat4x3h"){if(!(p<4&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else{if(x!=="mat4x4"&&x!=="mat4x4f"&&x!=="mat4x4h")return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(p<4&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}}}}}else if(o instanceof Nh){let h=o.value;if(!(i instanceof ke))return void console.error(`Invalid assignment to ${h}. Variable ${n} is not a vector. Line ${e.line}`);if(a instanceof ht){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);if(h==="x")i.data[0]=a.value;else if(h==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);i.data[1]=a.value}else if(h==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);i.data[2]=a.value}else if(h==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);i.data[3]=a.value}}else{if(!(a instanceof ke))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(h.length!==a.data.length)return void console.error(`Invalid assignment to ${h} for variable ${n}. Line ${e.line}`);for(let p=0;p<h.length;++p){let x=h[p];if(x==="x"||x==="r")i.data[0]=a.data[p];else if(x==="y"||x==="g"){if(a.data.length<2)return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);i.data[1]=a.data[p]}else if(x==="z"||x==="b"){if(a.data.length<3)return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);i.data[2]=a.data[p]}else{if(x!=="w"&&x!=="a")return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);if(a.data.length<4)return void console.error(`Invalid assignment to ${x} for variable ${n}. Line ${e.line}`);i.data[3]=a.data[p]}}}}}else i instanceof ht&&a instanceof ht?i.value=a.value:i instanceof ke&&a instanceof ke||i instanceof qr&&a instanceof qr?i.data.set(a.data):console.error(`Invalid assignment to ${n}. Line ${e.line}`);else{let h=i.getSubData(this,o,r);if(h instanceof ke&&a instanceof ht){let p=h.data,x=a.value;if(c==="+=")for(let T=0;T<p.length;++T)p[T]+=x;else if(c==="-=")for(let T=0;T<p.length;++T)p[T]-=x;else if(c==="*=")for(let T=0;T<p.length;++T)p[T]*=x;else if(c==="/=")for(let T=0;T<p.length;++T)p[T]/=x;else if(c==="%=")for(let T=0;T<p.length;++T)p[T]%=x;else if(c==="&=")for(let T=0;T<p.length;++T)p[T]&=x;else if(c==="|=")for(let T=0;T<p.length;++T)p[T]|=x;else if(c==="^=")for(let T=0;T<p.length;++T)p[T]^=x;else if(c==="<<=")for(let T=0;T<p.length;++T)p[T]<<=x;else if(c===">>=")for(let T=0;T<p.length;++T)p[T]>>=x;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(h instanceof ke&&a instanceof ke){let p=h.data,x=a.data;if(p.length!==x.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let T=0;T<p.length;++T)p[T]+=x[T];else if(c==="-=")for(let T=0;T<p.length;++T)p[T]-=x[T];else if(c==="*=")for(let T=0;T<p.length;++T)p[T]*=x[T];else if(c==="/=")for(let T=0;T<p.length;++T)p[T]/=x[T];else if(c==="%=")for(let T=0;T<p.length;++T)p[T]%=x[T];else if(c==="&=")for(let T=0;T<p.length;++T)p[T]&=x[T];else if(c==="|=")for(let T=0;T<p.length;++T)p[T]|=x[T];else if(c==="^=")for(let T=0;T<p.length;++T)p[T]^=x[T];else if(c==="<<=")for(let T=0;T<p.length;++T)p[T]<<=x[T];else if(c===">>=")for(let T=0;T<p.length;++T)p[T]>>=x[T];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(h instanceof ht&&a instanceof ht))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?h.value+=a.value:c==="-="?h.value-=a.value:c==="*="?h.value*=a.value:c==="/="?h.value/=a.value:c==="%="?h.value%=a.value:c==="&="?h.value&=a.value:c==="|="?h.value|=a.value:c==="^="?h.value^=a.value:c==="<<="?h.value<<=a.value:c===">>="?h.value>>=a.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}i instanceof Ho&&i.setDataValue(this,h,o,r)}}_function(e,r){let i=new WS(e);r.functions.set(e.name,i)}_const(e,r){let i=null;e.value!==null&&(i=this.evalExpression(e.value,r)),r.createVariable(e.name,i,e)}_let(e,r){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,r),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof go||(i=i.clone())}else{let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||n==="array"){let o=new Cl(e.type,[]);i=this._evalCreate(o,r)}}r.createVariable(e.name,i,e)}_var(e,r){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,r),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof go||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||e.type instanceof Wp||e.type instanceof Tc||e.type instanceof pt){let o=new Cl(e.type,[]);i=this._evalCreate(o,r)}}r.createVariable(e.name,i,e)}_switch(e,r){r=r.clone();let i=this.evalExpression(e.condition,r);if(!(i instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;let n=null;for(let o of e.cases)if(o instanceof Vb)for(let a of o.selectors){if(a instanceof J0){n=o;continue}let c=this.evalExpression(a,r);if(!(c instanceof ht))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===i.value)return this._execStatements(o.body,r)}else o instanceof jb&&(n=o);return n?this._execStatements(n.body,r):null}_if(e,r){r=r.clone();let i=this.evalExpression(e.condition,r);if(!(i instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,r);for(let n of e.elseif){let o=this.evalExpression(n.condition,r);if(!(o instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(n.body,r)}return e.else?this._execStatements(e.else,r):null}_getScalarValue(e){return e instanceof ht?e.value:(console.error("Expected scalar value.",e),0)}_for(e,r){for(r=r.clone(),this.execStatement(e.init,r);this._getScalarValue(this.evalExpression(e.condition,r));){let i=this._execStatements(e.body,r);if(i===t._breakObj)break;if(i!==null&&i!==t._continueObj)return i;this.execStatement(e.increment,r)}return null}_loop(e,r){for(r=r.clone();;){let i=this._execStatements(e.body,r);if(i===t._breakObj)break;if(i===t._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,r)===t._breakObj)break}else if(i!==null)return i}return null}_while(e,r){for(r=r.clone();this._getScalarValue(this.evalExpression(e.condition,r));){let i=this._execStatements(e.body,r);if(i===t._breakObj)break;if(i!==t._continueObj&&i!==null)return i}return null}_evalBitcast(e,r){let i=this.evalExpression(e.value,r),n=e.type;if(i instanceof ht){let o=t8(i.value,i.typeInfo.name,n.name);return new ht(o,this.getTypeInfo(n))}if(i instanceof ke){let o=i.typeInfo.getTypeName(),a="";if(o.endsWith("f"))a="f32";else if(o.endsWith("i"))a="i32";else if(o.endsWith("u"))a="u32";else if(o.endsWith("b"))a="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;a="f16"}let c=n.getTypeName(),h="";if(c.endsWith("f"))h="f32";else if(c.endsWith("i"))h="i32";else if(c.endsWith("u"))h="u32";else if(c.endsWith("b"))h="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}let p=function(x,T,R){if(T===R)return x;let k=new Array(x.length);for(let j=0;j<x.length;j++)k[j]=t8(x[j],T,R);return k}(Array.from(i.data),a,h);return new ke(p,this.getTypeInfo(n))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,r){return r.getVariableValue(e.name).clone().getSubData(this,e.postfix,r)}_evalCreate(e,r){var i;if(e instanceof Cl){if(e.type===null)return p1.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,r);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,r);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,r)}}let n=e instanceof Cl?e.type.name:e.name,o=e instanceof Cl?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${n}. Line ${e.line}`),null;if(o.size===0)return null;let a=new Ho(new ArrayBuffer(o.size),o,0);if(o instanceof Iu){if(e.args)for(let c=0;c<e.args.length;++c){let h=o.members[c],p=e.args[c],x=this.evalExpression(p,r);a.setData(this,x,h.type,h.offset,r)}}else if(o instanceof Mu){let c=0;if(e.args)for(let h=0;h<e.args.length;++h){let p=e.args[h],x=this.evalExpression(p,r);o.format===null&&(((i=x.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=x.typeInfo),a.setData(this,x,o.format,c,r),c+=o.stride}}else console.error(`Unknown type "${n}". Line ${e.line}`);return e instanceof Cl?a.getSubData(this,e.postfix,r):a}_evalLiteral(e,r){let i=this.getTypeInfo(e.type),n=i.name;return n==="x32"||n==="u32"||n==="f32"||n==="f16"||n==="i32"||n==="bool"?new ht(e.scalarValue,i):n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"?this._callConstructorVec(e,r):n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"?this._callConstructorMatrix(e,r):e.value}_evalVariable(e,r){let i=r.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,r)}_maxFormatTypeInfo(e){let r=e[0];if(r.name==="f32")return r;for(let i=1;i<e.length;++i){let n=t._priority.get(r.name);t._priority.get(e[i].name)<n&&(r=e[i])}return r.name==="x32"?this.getTypeInfo("i32"):r}_evalUnaryOp(e,r){let i=this.evalExpression(e.right,r);if(e.operator==="&")return new cd(i);if(e.operator==="*")return i instanceof cd?i.reference.getSubData(this,e.postfix,r):(console.error(`Invalid dereference. Line ${e.line}`),null);let n=i instanceof ht?i.value:i instanceof ke?Array.from(i.data):null;switch(e.operator){case"+":{if(pr(n)){let c=n.map((h,p)=>+h);return new ke(c,i.typeInfo)}let o=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(+o,a)}case"-":{if(pr(n)){let c=n.map((h,p)=>-h);return new ke(c,i.typeInfo)}let o=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(-o,a)}case"!":{if(pr(n)){let c=n.map((h,p)=>h?0:1);return new ke(c,i.typeInfo)}let o=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(o?0:1,a)}case"~":{if(pr(n)){let c=n.map((h,p)=>~h);return new ke(c,i.typeInfo)}let o=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(~o,a)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,r){let i=this.evalExpression(e.left,r),n=this.evalExpression(e.right,r),o=i instanceof ht?i.value:i instanceof ke||i instanceof qr?Array.from(i.data):null,a=n instanceof ht?n.value:n instanceof ke||n instanceof qr?Array.from(n.data):null;switch(e.operator){case"+":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k+T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R+x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x+R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c+h,p)}case"-":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k-T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R-x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x-R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c-h,p)}case"*":{if(pr(o)&&pr(a)){let x=o,T=a;if(i instanceof qr&&n instanceof qr){let R=function(Z,re,ee,se){if(la[re.name]===void 0||la[se.name]===void 0)return null;let me=la[re.name][0],Le=la[re.name][1],je=la[se.name][0];if(me!==la[se.name][1])return null;let Je=new Array(je*Le);for(let J=0;J<Le;J++)for(let te=0;te<je;te++){let X=0;for(let ye=0;ye<me;ye++)X+=Z[ye*Le+J]*ee[te*me+ye];Je[J*je+te]=X}return Je}(x,i.typeInfo,T,n.typeInfo);if(R===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;let k=la[n.typeInfo.name][0],j=la[i.typeInfo.name][1],q=this.getTypeInfo(`mat${k}x${j}f`);return new qr(R,q)}if(i instanceof qr&&n instanceof ke){let R=function(k,j,q,Z){if(la[j.name]===void 0||PS[Z.name]===void 0)return null;let re=la[j.name][0],ee=la[j.name][1];if(re!==q.length)return null;let se=new Array(ee);for(let me=0;me<ee;me++){let Le=0;for(let je=0;je<re;je++)Le+=k[je*ee+me]*q[je];se[me]=Le}return se}(x,i.typeInfo,T,n.typeInfo);return R===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ke(R,n.typeInfo)}if(i instanceof ke&&n instanceof qr){let R=function(k,j,q,Z){if(PS[j.name]===void 0||la[Z.name]===void 0)return null;let re=la[Z.name][0],ee=la[Z.name][1];if(ee!==k.length)return null;let se=[];for(let me=0;me<re;me++){let Le=0;for(let je=0;je<ee;je++)Le+=k[je]*q[je*re+me];se[me]=Le}return se}(x,i.typeInfo,T,n.typeInfo);return R===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ke(R,i.typeInfo)}{if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k*T[j]);return new ke(R,i.typeInfo)}}if(pr(o)){let x=a,T=o.map((R,k)=>R*x);return i instanceof qr?new qr(T,i.typeInfo):new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x*R);return n instanceof qr?new qr(T,n.typeInfo):new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c*h,p)}case"%":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k%T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R%x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x%R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c%h,p)}case"/":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k/T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R/x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x/R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c/h,p)}case"&":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k&T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R&x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x&R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c&h,p)}case"|":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k|T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R|x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x|R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c|h,p)}case"^":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k^T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R^x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x^R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c^h,p)}case"<<":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k<<T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R<<x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x<<R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c<<h,p)}case">>":{if(pr(o)&&pr(a)){let x=o,T=a;if(x.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let R=x.map((k,j)=>k>>T[j]);return new ke(R,i.typeInfo)}if(pr(o)){let x=a,T=o.map((R,k)=>R>>x);return new ke(T,i.typeInfo)}if(pr(a)){let x=o,T=a.map((R,k)=>x>>R);return new ke(T,n.typeInfo)}let c=o,h=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c>>h,p)}case">":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x>h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p>c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c>p?1:0);return new ke(h,n.typeInfo)}return new ht(o>a?1:0,this.getTypeInfo("bool"));case"<":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x<h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p<c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c<p?1:0);return new ke(h,n.typeInfo)}return new ht(o<a?1:0,this.getTypeInfo("bool"));case"==":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x===h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p==c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c==p?1:0);return new ke(h,n.typeInfo)}return new ht(o===a?1:0,this.getTypeInfo("bool"));case"!=":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x!==h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p!==c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c!==p?1:0);return new ke(h,n.typeInfo)}return new ht(o!==a?1:0,this.getTypeInfo("bool"));case">=":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x>=h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p>=c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c>=p?1:0);return new ke(h,n.typeInfo)}return new ht(o>=a?1:0,this.getTypeInfo("bool"));case"<=":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x<=h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p<=c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c<=p?1:0);return new ke(h,n.typeInfo)}return new ht(o<=a?1:0,this.getTypeInfo("bool"));case"&&":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x&&h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p&&c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c&&p?1:0);return new ke(h,n.typeInfo)}return new ht(o&&a?1:0,this.getTypeInfo("bool"));case"||":if(pr(o)&&pr(a)){let c=o,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((x,T)=>x||h[T]?1:0);return new ke(p,i.typeInfo)}if(pr(o)){let c=a,h=o.map((p,x)=>p||c?1:0);return new ke(h,i.typeInfo)}if(pr(a)){let c=o,h=a.map((p,x)=>c||p?1:0);return new ke(h,n.typeInfo)}return new ht(o||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,r){if(e.cachedReturnValue!==null)return e.cachedReturnValue;let i=r.clone();i.currentFunctionName=e.name;let n=r.getFunction(e.name);if(!n)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,r):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<n.node.args.length;++o){let a=n.node.args[o],c=this.evalExpression(e.args[o],i);i.createVariable(a.name,c,a)}return this._execStatements(n.node.body,i)}_callBuiltinFunction(e,r){switch(e.name){case"all":return this.builtins.All(e,r);case"any":return this.builtins.Any(e,r);case"select":return this.builtins.Select(e,r);case"arrayLength":return this.builtins.ArrayLength(e,r);case"abs":return this.builtins.Abs(e,r);case"acos":return this.builtins.Acos(e,r);case"acosh":return this.builtins.Acosh(e,r);case"asin":return this.builtins.Asin(e,r);case"asinh":return this.builtins.Asinh(e,r);case"atan":return this.builtins.Atan(e,r);case"atanh":return this.builtins.Atanh(e,r);case"atan2":return this.builtins.Atan2(e,r);case"ceil":return this.builtins.Ceil(e,r);case"clamp":return this.builtins.Clamp(e,r);case"cos":return this.builtins.Cos(e,r);case"cosh":return this.builtins.Cosh(e,r);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,r);case"countOneBits":return this.builtins.CountOneBits(e,r);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,r);case"cross":return this.builtins.Cross(e,r);case"degrees":return this.builtins.Degrees(e,r);case"determinant":return this.builtins.Determinant(e,r);case"distance":return this.builtins.Distance(e,r);case"dot":return this.builtins.Dot(e,r);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,r);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,r);case"exp":return this.builtins.Exp(e,r);case"exp2":return this.builtins.Exp2(e,r);case"extractBits":return this.builtins.ExtractBits(e,r);case"faceForward":return this.builtins.FaceForward(e,r);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,r);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,r);case"floor":return this.builtins.Floor(e,r);case"fma":return this.builtins.Fma(e,r);case"fract":return this.builtins.Fract(e,r);case"frexp":return this.builtins.Frexp(e,r);case"insertBits":return this.builtins.InsertBits(e,r);case"inverseSqrt":return this.builtins.InverseSqrt(e,r);case"ldexp":return this.builtins.Ldexp(e,r);case"length":return this.builtins.Length(e,r);case"log":return this.builtins.Log(e,r);case"log2":return this.builtins.Log2(e,r);case"max":return this.builtins.Max(e,r);case"min":return this.builtins.Min(e,r);case"mix":return this.builtins.Mix(e,r);case"modf":return this.builtins.Modf(e,r);case"normalize":return this.builtins.Normalize(e,r);case"pow":return this.builtins.Pow(e,r);case"quantizeToF16":return this.builtins.QuantizeToF16(e,r);case"radians":return this.builtins.Radians(e,r);case"reflect":return this.builtins.Reflect(e,r);case"refract":return this.builtins.Refract(e,r);case"reverseBits":return this.builtins.ReverseBits(e,r);case"round":return this.builtins.Round(e,r);case"saturate":return this.builtins.Saturate(e,r);case"sign":return this.builtins.Sign(e,r);case"sin":return this.builtins.Sin(e,r);case"sinh":return this.builtins.Sinh(e,r);case"smoothStep":return this.builtins.SmoothStep(e,r);case"sqrt":return this.builtins.Sqrt(e,r);case"step":return this.builtins.Step(e,r);case"tan":return this.builtins.Tan(e,r);case"tanh":return this.builtins.Tanh(e,r);case"transpose":return this.builtins.Transpose(e,r);case"trunc":return this.builtins.Trunc(e,r);case"dpdx":return this.builtins.Dpdx(e,r);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,r);case"dpdxFine":return this.builtins.DpdxFine(e,r);case"dpdy":return this.builtins.Dpdy(e,r);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,r);case"dpdyFine":return this.builtins.DpdyFine(e,r);case"fwidth":return this.builtins.Fwidth(e,r);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,r);case"fwidthFine":return this.builtins.FwidthFine(e,r);case"textureDimensions":return this.builtins.TextureDimensions(e,r);case"textureGather":return this.builtins.TextureGather(e,r);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,r);case"textureLoad":return this.builtins.TextureLoad(e,r);case"textureNumLayers":return this.builtins.TextureNumLayers(e,r);case"textureNumLevels":return this.builtins.TextureNumLevels(e,r);case"textureNumSamples":return this.builtins.TextureNumSamples(e,r);case"textureSample":return this.builtins.TextureSample(e,r);case"textureSampleBias":return this.builtins.TextureSampleBias(e,r);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,r);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,r);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,r);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,r);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,r);case"textureStore":return this.builtins.TextureStore(e,r);case"atomicLoad":return this.builtins.AtomicLoad(e,r);case"atomicStore":return this.builtins.AtomicStore(e,r);case"atomicAdd":return this.builtins.AtomicAdd(e,r);case"atomicSub":return this.builtins.AtomicSub(e,r);case"atomicMax":return this.builtins.AtomicMax(e,r);case"atomicMin":return this.builtins.AtomicMin(e,r);case"atomicAnd":return this.builtins.AtomicAnd(e,r);case"atomicOr":return this.builtins.AtomicOr(e,r);case"atomicXor":return this.builtins.AtomicXor(e,r);case"atomicExchange":return this.builtins.AtomicExchange(e,r);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,r);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,r);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,r);case"pack4xI8":return this.builtins.Pack4xI8(e,r);case"pack4xU8":return this.builtins.Pack4xU8(e,r);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,r);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,r);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,r);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,r);case"pack2x16float":return this.builtins.Pack2x16float(e,r);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,r);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,r);case"unpack4xI8":return this.builtins.Unpack4xI8(e,r);case"unpack4xU8":return this.builtins.Unpack4xU8(e,r);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,r);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,r);case"unpack2x16float":return this.builtins.Unpack2x16float(e,r);case"storageBarrier":return this.builtins.StorageBarrier(e,r);case"textureBarrier":return this.builtins.TextureBarrier(e,r);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,r);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,r);case"subgroupAdd":return this.builtins.SubgroupAdd(e,r);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,r);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,r);case"subgroupAll":return this.builtins.SubgroupAll(e,r);case"subgroupAnd":return this.builtins.SubgroupAnd(e,r);case"subgroupAny":return this.builtins.SubgroupAny(e,r);case"subgroupBallot":return this.builtins.SubgroupBallot(e,r);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,r);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,r);case"subgroupElect":return this.builtins.SubgroupElect(e,r);case"subgroupMax":return this.builtins.SubgroupMax(e,r);case"subgroupMin":return this.builtins.SubgroupMin(e,r);case"subgroupMul":return this.builtins.SubgroupMul(e,r);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,r);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,r);case"subgroupOr":return this.builtins.SubgroupOr(e,r);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,r);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,r);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,r);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,r);case"subgroupXor":return this.builtins.SubgroupXor(e,r);case"quadBroadcast":return this.builtins.QuadBroadcast(e,r);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,r);case"quadSwapX":return this.builtins.QuadSwapX(e,r);case"quadSwapY":return this.builtins.QuadSwapY(e,r)}let i=r.getFunction(e.name);if(i){let n=r.clone();for(let o=0;o<i.node.args.length;++o){let a=i.node.args[o],c=this.evalExpression(e.args[o],n);n.setVariable(a.name,c,a)}return this._execStatements(i.node.body,n)}return null}_callConstructorValue(e,r){if(!e.args||e.args.length===0)return new ht(0,this.getTypeInfo(e.type));let i=this.evalExpression(e.args[0],r);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,r).clone()}_callConstructorVec(e,r){let i=this.getTypeInfo(e.type),n=e.type.getTypeName(),o=PS[n];if(o===void 0)return console.error(`Invalid vec constructor ${n}. Line ${e.line}`),null;let a=[];if(e instanceof Mo)if(e.isVector){let c=e.vectorValue;for(let h of c)a.push(h)}else a.push(e.scalarValue);else if(e.args)for(let c of e.args){let h=this.evalExpression(c,r);if(h instanceof ke){let p=h.data;for(let x=0;x<p.length;++x){let T=p[x];a.push(T)}}else if(h instanceof ht){let p=h.value;a.push(p)}}if(e.type instanceof pt&&e.type.format===null&&(e.type.format=pt.f32),a.length===0){let c=new Array(o).fill(0);return new ke(c,i).getSubData(this,e.postfix,r)}if(a.length===1)for(;a.length<o;)a.push(a[0]);return a.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new ke(a.length>o?a.slice(0,o):a,i).getSubData(this,e.postfix,r)}_callConstructorMatrix(e,r){let i=this.getTypeInfo(e.type),n=e.type.getTypeName(),o=la[n];if(o===void 0)return console.error(`Invalid matrix constructor ${n}. Line ${e.line}`),null;let a=[];if(e instanceof Mo)if(e.isVector){let c=e.vectorValue;for(let h of c)a.push(h)}else a.push(e.scalarValue);else if(e.args)for(let c of e.args){let h=this.evalExpression(c,r);h instanceof ke?a.push(...h.data):h instanceof ht?a.push(h.value):h instanceof qr&&a.push(...h.data)}if(i instanceof kh&&i.format===null&&(i.format=this.getTypeInfo("f32")),a.length===0){let c=new Array(o[2]).fill(0);return new qr(c,i).getSubData(this,e.postfix,r)}return a.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new qr(a,i).getSubData(this,e.postfix,r)}};em._breakObj=new Ml(new Ma("BREAK",null),null),em._continueObj=new Ml(new Ma("CONTINUE",null),null),em._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var XS=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},YS=class{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new XS,this._exec=new em,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let r=[];for(;!this._isAtEnd();){let i=this._global_decl_or_directive();if(!i)break;r.push(i)}if(this._deferArrayCountEval.length>0){for(let i of this._deferArrayCountEval){let n=i.arrayType,o=i.countNode;if(o instanceof ca){let a=o.name,c=this._context.constants.get(a);if(c)try{let h=c.constEvaluate(this._exec);n.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let i of r)i.search(n=>{n instanceof Hb||n instanceof l1?n.type=this._forwardType(n.type):n instanceof Wp?n.format=this._forwardType(n.format):n instanceof Ec||n instanceof Hp||n instanceof Q0?n.type=this._forwardType(n.type):n instanceof qp?n.returnType=this._forwardType(n.returnType):n instanceof Gb&&(n.type=this._forwardType(n.type))});return r}_forwardType(e){if(e instanceof Fb){let r=this._getType(e.name);if(r)return r}else e instanceof l1?e.type=this._forwardType(e.type):e instanceof Wp&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){let r=new jS(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,r){return e.line=r??this._currentLine,e}_error(e,r){return{token:e,message:r,toString:()=>`${r}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Se.eof}_match(e){if(e instanceof lt)return!!this._check(e)&&(this._advance(),!0);for(let r=0,i=e.length;r<i;++r){let n=e[r];if(this._check(n))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),`${r}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;let r=this._peek();if(e instanceof Array){let i=r.type,n=!1;for(let o of e){if(i===o)return!0;o===Se.tokens.name&&(n=!0)}if(n){let o=Se.tokens.name.rule.exec(r.lexeme);if(o&&o.index==0&&o[0]==r.lexeme)return!0}return!1}if(r.type===e)return!0;if(e===Se.tokens.name){let i=Se.tokens.name.rule.exec(r.lexeme);return i&&i.index==0&&i[0]==r.lexeme}return!1}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Se.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Se.keywords.alias)){let r=this._type_alias();return this._consume(Se.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Se.keywords.diagnostic)){let r=this._diagnostic();return this._consume(Se.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Se.keywords.requires)){let r=this._requires_directive();return this._consume(Se.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}if(this._match(Se.keywords.enable)){let r=this._enable_directive();return this._consume(Se.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([r]),r}let e=this._attribute();if(this._check(Se.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(Se.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Se.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(Se.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Se.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(Se.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Se.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(Se.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([r]),r}if(this._check(Se.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}if(this._check(Se.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=e),this._exec.reflection.updateAST([r]),r}return null}_function_decl(){if(!this._match(Se.keywords.fn))return null;let e=this._currentLine,r=this._consume(Se.tokens.ident,"Expected function name.").toString();this._consume(Se.tokens.paren_left,"Expected '(' for function arguments.");let i=[];if(!this._check(Se.tokens.paren_right))do{if(this._check(Se.tokens.paren_right))break;let c=this._attribute(),h=this._consume(Se.tokens.name,"Expected argument name.").toString();this._consume(Se.tokens.colon,"Expected ':' for argument type.");let p=this._attribute(),x=this._type_decl();x!=null&&(x.attributes=p,i.push(this._updateNode(new Gb(h,x,c))))}while(this._match(Se.tokens.comma));this._consume(Se.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(Se.tokens.arrow)){let c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}let o=this._compound_statement(),a=this._currentLine;return this._updateNode(new qp(r,i,n,o,e,a),e)}_compound_statement(){let e=[];for(this._consume(Se.tokens.brace_left,"Expected '{' for block.");!this._check(Se.tokens.brace_right);){let r=this._statement();r!==null&&e.push(r)}return this._consume(Se.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Se.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Se.tokens.attr)&&this._attribute(),this._check(Se.keywords.if))return this._if_statement();if(this._check(Se.keywords.switch))return this._switch_statement();if(this._check(Se.keywords.loop))return this._loop_statement();if(this._check(Se.keywords.for))return this._for_statement();if(this._check(Se.keywords.while))return this._while_statement();if(this._check(Se.keywords.continuing))return this._continuing_statement();if(this._check(Se.keywords.static_assert))return this._static_assert_statement();if(this._check(Se.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Se.keywords.return))e=this._return_statement();else if(this._check([Se.keywords.var,Se.keywords.let,Se.keywords.const]))e=this._variable_statement();else if(this._match(Se.keywords.discard))e=this._updateNode(new US);else if(this._match(Se.keywords.break)){let r=this._updateNode(new Ob);if(this._currentLoop.length>0){let i=this._currentLoop[this._currentLoop.length-1];r.loopId=i.id}e=r,this._check(Se.keywords.if)&&(this._advance(),r.condition=this._optional_paren_expression())}else if(this._match(Se.keywords.continue)){let r=this._updateNode(new Db);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${r.line}`);{let i=this._currentLoop[this._currentLoop.length-1];r.loopId=i.id}e=r}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Se.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Se.keywords.static_assert))return null;let e=this._currentLine,r=this._optional_paren_expression();return this._updateNode(new kS(r),e)}_while_statement(){if(!this._match(Se.keywords.while))return null;let e=this._updateNode(new Eb(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Se.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){let e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Se.keywords.continuing))return null;let r=this._currentLine,i=this._compound_statement();return this._updateNode(new c1(i,e),r)}_for_statement(){if(!this._match(Se.keywords.for))return null;this._consume(Se.tokens.paren_left,"Expected '('.");let e=this._updateNode(new Cb(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Se.tokens.semicolon)?null:this._for_init(),this._consume(Se.tokens.semicolon,"Expected ';'."),e.condition=this._check(Se.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Se.tokens.semicolon,"Expected ';'."),e.increment=this._check(Se.tokens.paren_right)?null:this._for_increment(),this._consume(Se.tokens.paren_right,"Expected ')'."),this._check(Se.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Se.keywords.var)){let e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(Se.tokens.equal)&&(r=this._short_circuit_or_expression()),this._updateNode(new Ec(e.name,e.type,e.storage,e.access,r),e.line)}if(this._match(Se.keywords.let)){let e=this._currentLine,r=this._consume(Se.tokens.name,"Expected name for let.").toString(),i=null;if(this._match(Se.tokens.colon)){let o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(Se.tokens.equal,"Expected '=' for let.");let n=this._short_circuit_or_expression();return this._updateNode(new Hp(r,i,null,null,n),e)}if(this._match(Se.keywords.const)){let e=this._currentLine,r=this._consume(Se.tokens.name,"Expected name for const.").toString(),i=null;if(this._match(Se.tokens.colon)){let o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(Se.tokens.equal,"Expected '=' for const.");let n=this._short_circuit_or_expression();return i===null&&n instanceof Mo&&(i=n.type),this._updateNode(new Q0(r,i,null,null,n),e)}return null}_increment_decrement_statement(){let e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(Se.increment_operators))return this._current=e,null;let i=this._consume(Se.increment_operators,"Expected increment operator");return this._updateNode(new Sb(i.type===Se.tokens.plus_plus?Y0.increment:Y0.decrement,r))}_assignment_statement(){let e=null,r=this._currentLine;if(this._check(Se.tokens.brace_right))return null;let i=this._match(Se.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;let n=this._consume(Se.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new Ib(a1.parse(n.lexeme),e,o),r)}_func_call_statement(){if(!this._check(Se.tokens.ident))return null;let e=this._currentLine,r=this._current,i=this._consume(Se.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=r,null):this._updateNode(new h1(i.lexeme,n),e)}_loop_statement(){if(!this._match(Se.keywords.loop))return null;this._check(Se.tokens.attr)&&this._attribute(),this._consume(Se.tokens.brace_left,"Expected '{' for loop.");let e=this._updateNode(new Mb([],null));this._currentLoop.push(e);let r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let i of r)e.body.push(i);else e.body.push(r);if(r instanceof c1){e.continuing=r;break}r=this._statement()}return this._currentLoop.pop(),this._consume(Se.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Se.keywords.switch))return null;let e=this._updateNode(new Pb(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Se.tokens.attr)&&this._attribute(),this._consume(Se.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Se.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){let e=[],r=!1;for(;this._check([Se.keywords.default,Se.keywords.case]);){if(this._match(Se.keywords.case)){let i=this._case_selectors();for(let o of i)if(o instanceof J0){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");r=!0;break}this._match(Se.tokens.colon),this._check(Se.tokens.attr)&&this._attribute(),this._consume(Se.tokens.brace_left,"Exected '{' for switch case.");let n=this._case_body();this._consume(Se.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Vb(i,n)))}if(this._match(Se.keywords.default)){if(r)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Se.tokens.colon),this._check(Se.tokens.attr)&&this._attribute(),this._consume(Se.tokens.brace_left,"Exected '{' for switch default.");let i=this._case_body();this._consume(Se.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new jb(i)))}}return e}_case_selectors(){let e=[];for(this._match(Se.keywords.default)?e.push(this._updateNode(new J0)):e.push(this._shift_expression());this._match(Se.tokens.comma);)this._match(Se.keywords.default)?e.push(this._updateNode(new J0)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Se.keywords.fallthrough))return this._consume(Se.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);let r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(Se.keywords.if))return null;let e=this._currentLine,r=this._optional_paren_expression();this._check(Se.tokens.attr)&&this._attribute();let i=this._compound_statement(),n=[];this._match_elseif()&&(this._check(Se.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let o=null;return this._match(Se.keywords.else)&&(this._check(Se.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new Rb(r,i,n,o),e)}_match_elseif(){return this._tokens[this._current].type===Se.keywords.else&&this._tokens[this._current+1].type===Se.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let r=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new VS(r,i))),this._match_elseif()&&(this._check(Se.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Se.keywords.return))return null;let e=this._short_circuit_or_expression();return this._updateNode(new Bb(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Se.tokens.or_or);)e=this._updateNode(new rl(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Se.tokens.and_and);)e=this._updateNode(new rl(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Se.tokens.or);)e=this._updateNode(new rl(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Se.tokens.xor);)e=this._updateNode(new rl(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Se.tokens.and);)e=this._updateNode(new rl(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){let e=this._relational_expression();return this._match([Se.tokens.equal_equal,Se.tokens.not_equal])?this._updateNode(new rl(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Se.tokens.less_than,Se.tokens.greater_than,Se.tokens.less_than_equal,Se.tokens.greater_than_equal]);)e=this._updateNode(new rl(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Se.tokens.shift_left,Se.tokens.shift_right]);)e=this._updateNode(new rl(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Se.tokens.plus,Se.tokens.minus]);)e=this._updateNode(new rl(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Se.tokens.star,Se.tokens.forward_slash,Se.tokens.modulo]);)e=this._updateNode(new rl(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Se.tokens.minus,Se.tokens.bang,Se.tokens.tilde,Se.tokens.star,Se.tokens.and])?this._updateNode(new go(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(Se.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(Se.tokens.bracket_right,"Expected ']'.");let r=this._updateNode(new ud(e)),i=this._postfix_expression();return i&&(r.postfix=i),r}if(this._match(Se.tokens.period)){let e=this._consume(Se.tokens.name,"Expected member name."),r=this._postfix_expression(),i=this._updateNode(new Nh(e.lexeme));return r&&(i.postfix=r),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){let r=this._getStruct(e);if(r!==null)return r;switch(e){case"void":return Zt.void;case"bool":return Zt.bool;case"i32":return Zt.i32;case"u32":return Zt.u32;case"f32":return Zt.f32;case"f16":return Zt.f16;case"vec2f":return pt.vec2f;case"vec3f":return pt.vec3f;case"vec4f":return pt.vec4f;case"vec2i":return pt.vec2i;case"vec3i":return pt.vec3i;case"vec4i":return pt.vec4i;case"vec2u":return pt.vec2u;case"vec3u":return pt.vec3u;case"vec4u":return pt.vec4u;case"vec2h":return pt.vec2h;case"vec3h":return pt.vec3h;case"vec4h":return pt.vec4h;case"mat2x2f":return pt.mat2x2f;case"mat2x3f":return pt.mat2x3f;case"mat2x4f":return pt.mat2x4f;case"mat3x2f":return pt.mat3x2f;case"mat3x3f":return pt.mat3x3f;case"mat3x4f":return pt.mat3x4f;case"mat4x2f":return pt.mat4x2f;case"mat4x3f":return pt.mat4x3f;case"mat4x4f":return pt.mat4x4f;case"mat2x2h":return pt.mat2x2h;case"mat2x3h":return pt.mat2x3h;case"mat2x4h":return pt.mat2x4h;case"mat3x2h":return pt.mat3x2h;case"mat3x3h":return pt.mat3x3h;case"mat3x4h":return pt.mat3x4h;case"mat4x2h":return pt.mat4x2h;case"mat4x3h":return pt.mat4x3h;case"mat4x4h":return pt.mat4x4h;case"mat2x2i":return pt.mat2x2i;case"mat2x3i":return pt.mat2x3i;case"mat2x4i":return pt.mat2x4i;case"mat3x2i":return pt.mat3x2i;case"mat3x3i":return pt.mat3x3i;case"mat3x4i":return pt.mat3x4i;case"mat4x2i":return pt.mat4x2i;case"mat4x3i":return pt.mat4x3i;case"mat4x4i":return pt.mat4x4i;case"mat2x2u":return pt.mat2x2u;case"mat2x3u":return pt.mat2x3u;case"mat2x4u":return pt.mat2x4u;case"mat3x2u":return pt.mat3x2u;case"mat3x3u":return pt.mat3x3u;case"mat3x4u":return pt.mat3x4u;case"mat4x2u":return pt.mat4x2u;case"mat4x3u":return pt.mat4x3u;case"mat4x4u":return pt.mat4x4u}return null}_validateTypeRange(e,r){if(r.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(r.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Se.tokens.ident)){let i=this._previous().toString();if(this._check(Se.tokens.paren_left)){let n=this._argument_expression_list(),o=this._getType(i);return o!==null?this._updateNode(new Cl(o,n)):this._updateNode(new d1(i,n))}if(this._context.constants.has(i)){let n=this._context.constants.get(i);return this._updateNode(new kb(i,n.value))}return this._updateNode(new ca(i))}if(this._match(Se.tokens.int_literal)){let i=this._previous().toString(),n=i.endsWith("i")||i.endsWith("i")?Zt.i32:i.endsWith("u")||i.endsWith("U")?Zt.u32:Zt.x32,o=parseInt(i);return this._validateTypeRange(o,n),this._updateNode(new Mo(new ht(o,this._exec.getTypeInfo(n)),n))}if(this._match(Se.tokens.uint_literal)){let i=parseInt(this._previous().toString());return this._validateTypeRange(i,Zt.u32),this._updateNode(new Mo(new ht(i,this._exec.getTypeInfo(Zt.u32)),Zt.u32))}if(this._match([Se.tokens.decimal_float_literal,Se.tokens.hex_float_literal])){let i=this._previous().toString(),n=i.endsWith("h");n&&(i=i.substring(0,i.length-1));let o=parseFloat(i);this._validateTypeRange(o,n?Zt.f16:Zt.f32);let a=n?Zt.f16:Zt.f32;return this._updateNode(new Mo(new ht(o,this._exec.getTypeInfo(a)),a))}if(this._match([Se.keywords.true,Se.keywords.false])){let i=this._previous().toString()===Se.keywords.true.rule;return this._updateNode(new Mo(new ht(i?1:0,this._exec.getTypeInfo(Zt.bool)),Zt.bool))}if(this._check(Se.tokens.paren_left))return this._paren_expression();if(this._match(Se.keywords.bitcast)){this._consume(Se.tokens.less_than,"Expected '<'.");let i=this._type_decl();this._consume(Se.tokens.greater_than,"Expected '>'.");let n=this._paren_expression();return this._updateNode(new Nb(i,n))}let e=this._type_decl(),r=this._argument_expression_list();return this._updateNode(new Cl(e,r))}_argument_expression_list(){if(!this._match(Se.tokens.paren_left))return null;let e=[];do{if(this._check(Se.tokens.paren_right))break;let r=this._short_circuit_or_expression();e.push(r)}while(this._match(Se.tokens.comma));return this._consume(Se.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Se.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(Se.tokens.paren_right),e}_paren_expression(){this._consume(Se.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(Se.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Se.keywords.struct))return null;let e=this._currentLine,r=this._consume(Se.tokens.ident,"Expected name for struct.").toString();this._consume(Se.tokens.brace_left,"Expected '{' for struct body.");let i=[];for(;!this._check(Se.tokens.brace_right);){let a=this._attribute(),c=this._consume(Se.tokens.name,"Expected variable name.").toString();this._consume(Se.tokens.colon,"Expected ':' for struct member type.");let h=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=h),this._check(Se.tokens.brace_right)?this._match(Se.tokens.comma):this._consume(Se.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new Hb(c,p,a)))}this._consume(Se.tokens.brace_right,"Expected '}' after struct body.");let n=this._currentLine,o=this._updateNode(new Tc(r,i,e,n),e);return this._context.structs.set(r,o),o}_global_variable_decl(){let e=this._variable_decl();if(!e)return null;if(this._match(Se.tokens.equal)){let r=this._const_expression();e.value=r}if(e.type!==null&&e.value instanceof Mo){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Mo&&(e.type=e.value.type.name==="x32"?Zt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(Se.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Se.keywords.const))return null;let r=this._consume(Se.tokens.name,"Expected variable name"),i=this._currentLine,n=null;if(this._match(Se.tokens.colon)){let h=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=h)}let o=null;this._consume(Se.tokens.equal,"const declarations require an assignment");let a=this._short_circuit_or_expression();try{let h=[Zt.f32],p=a.constEvaluate(this._exec,h);p instanceof ht&&this._validateTypeRange(p.value,h[0]),h[0]instanceof pt&&h[0].format===null&&p.typeInfo instanceof kh&&p.typeInfo.format!==null&&(p.typeInfo.format.name==="f16"?h[0].format=Zt.f16:p.typeInfo.format.name==="f32"?h[0].format=Zt.f32:p.typeInfo.format.name==="i32"?h[0].format=Zt.i32:p.typeInfo.format.name==="u32"?h[0].format=Zt.u32:p.typeInfo.format.name==="bool"?h[0].format=Zt.bool:console.error(`TODO: impelement template format type ${p.typeInfo.format.name}`)),o=this._updateNode(new Mo(p,h[0])),this._exec.context.setVariable(r.toString(),p)}catch{o=a}if(n!==null&&o instanceof Mo){if(o.type.name!=="x32"&&n.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${n.name}. Line:${this._currentLine}`);o.type=n,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else n===null&&o instanceof Mo&&(n=(e=o?.type)!==null&&e!==void 0?e:Zt.f32,n===Zt.x32&&(n=Zt.i32));let c=this._updateNode(new Q0(r.toString(),n,"","",o),i);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(Se.keywords.let))return null;let e=this._currentLine,r=this._consume(Se.tokens.name,"Expected variable name"),i=null;if(this._match(Se.tokens.colon)){let o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}let n=null;if(this._match(Se.tokens.equal)&&(n=this._const_expression()),i!==null&&n instanceof Mo){if(n.type.name!=="x32"&&i.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${i.name}. Line:${this._currentLine}`);n.type=i}else i===null&&n instanceof Mo&&(i=n.type.name==="x32"?Zt.i32:n.type);return n instanceof Mo&&n.isScalar&&this._validateTypeRange(n.scalarValue,i),this._updateNode(new Hp(r.toString(),i,"","",n),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Se.keywords.var))return null;let e=this._currentLine,r="",i="";this._match(Se.tokens.less_than)&&(r=this._consume(Se.storage_class,"Expected storage_class.").toString(),this._match(Se.tokens.comma)&&(i=this._consume(Se.access_mode,"Expected access_mode.").toString()),this._consume(Se.tokens.greater_than,"Expected '>'."));let n=this._consume(Se.tokens.name,"Expected variable name"),o=null;if(this._match(Se.tokens.colon)){let a=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=a)}return this._updateNode(new Ec(n.toString(),o,r,i,null),e)}_override_decl(){if(!this._match(Se.keywords.override))return null;let e=this._consume(Se.tokens.name,"Expected variable name"),r=null;if(this._match(Se.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}return this._updateNode(new u1(e.toString(),r,null))}_diagnostic(){this._consume(Se.tokens.paren_left,"Expected '('");let e=this._consume(Se.tokens.ident,"Expected severity control name.");this._consume(Se.tokens.comma,"Expected ','");let r=this._consume(Se.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Se.tokens.period)&&(r+=`.${this._consume(Se.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Se.tokens.paren_right,"Expected ')'"),this._updateNode(new Lb(e.toString(),r))}_enable_directive(){let e=this._consume(Se.tokens.ident,"identity expected.");return this._updateNode(new NS(e.toString()))}_requires_directive(){let e=[this._consume(Se.tokens.ident,"identity expected.").toString()];for(;this._match(Se.tokens.comma);){let r=this._consume(Se.tokens.ident,"identity expected.");e.push(r.toString())}return this._updateNode(new zS(e))}_type_alias(){let e=this._consume(Se.tokens.ident,"identity expected.");this._consume(Se.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let i=this._updateNode(new f1(e.toString(),r));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([Se.tokens.ident,...Se.texel_format,Se.keywords.bool,Se.keywords.f32,Se.keywords.i32,Se.keywords.u32])){let i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){let n=this._updateNode(new Fb(i));return this._forwardTypeCount++,n}return this._updateNode(new Zt(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Se.template_types)){let i=this._advance().toString(),n=null,o=null;return this._match(Se.tokens.less_than)&&(n=this._type_decl(),o=null,this._match(Se.tokens.comma)&&(o=this._consume(Se.access_mode,"Expected access_mode for pointer").toString()),this._consume(Se.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new pt(i,n,o))}if(this._match(Se.keywords.ptr)){let i=this._previous().toString();this._consume(Se.tokens.less_than,"Expected '<' for pointer.");let n=this._consume(Se.storage_class,"Expected storage_class for pointer");this._consume(Se.tokens.comma,"Expected ',' for pointer.");let o=this._type_decl(),a=null;return this._match(Se.tokens.comma)&&(a=this._consume(Se.access_mode,"Expected access_mode for pointer").toString()),this._consume(Se.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new l1(i,n.toString(),o,a))}let r=this._attribute();if(this._match(Se.keywords.array)){let i=null,n=-1,o=this._previous(),a=null;if(this._match(Se.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let h="";if(this._match(Se.tokens.comma)){a=this._shift_expression();try{h=a.constEvaluate(this._exec).toString(),a=null}catch{h="1"}}this._consume(Se.tokens.greater_than,"Expected '>' for array."),n=h?parseInt(h):0}let c=this._updateNode(new Wp(o.toString(),r,i,n));return a&&this._deferArrayCountEval.push({arrayType:c,countNode:a}),c}return null}_texture_sampler_types(){if(this._match(Se.sampler_type))return this._updateNode(new Gp(this._previous().toString(),null,null));if(this._match(Se.depth_texture_type))return this._updateNode(new Gp(this._previous().toString(),null,null));if(this._match(Se.sampled_texture_type)||this._match(Se.multisampled_texture_type)){let e=this._previous();this._consume(Se.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(Se.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Gp(e.toString(),r,null))}if(this._match(Se.storage_texture_type)){let e=this._previous();this._consume(Se.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(Se.texel_format,"Invalid texel format.").toString();this._consume(Se.tokens.comma,"Expected ',' after texel format.");let i=this._consume(Se.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Se.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Gp(e.toString(),r,i))}return null}_attribute(){let e=[];for(;this._match(Se.tokens.attr);){let r=this._consume(Se.attribute_name,"Expected attribute name"),i=this._updateNode(new Wb(r.toString(),null));if(this._match(Se.tokens.paren_left)){if(i.value=this._consume(Se.literal_or_ident,"Expected attribute value").toString(),this._check(Se.tokens.comma)){this._advance();do{let n=this._consume(Se.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(Se.tokens.comma))}this._consume(Se.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}},Yb=class extends $p{constructor(e){super(),e&&this.update(e)}update(e){let r=new YS().parse(e);this.updateAST(r)}};function QS(t){let e={attributes:[],bindings:[]},r;try{r=ZQ(t)}catch(o){return Vt.error(o.message)(),e}for(let o of r.uniforms){let a=[];for(let c of o.type?.members||[])a.push({name:c.name,type:o8(c.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:a})}for(let o of r.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(let o of r.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});let i=r.entry.vertex[0],n=i?.inputs.length||0;for(let o=0;o<n;o++){let a=i.inputs[o];if(a.locationType==="location"){let c=o8(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:c})}}return e}function o8(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function ZQ(t){try{return new Yb(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}var XQ=1/Math.PI*180,YQ=1/180*Math.PI,KQ={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...KQ}};var On=globalThis.mathgl.config;function JS(t,{precision:e=On.precision}={}){return t=QQ(t),`${parseFloat(t.toPrecision(e))}`}function il(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function eI(t){return s8(t)}function tI(t){return nl(t)}function s8(t,e){return rI(t,r=>r*YQ,e)}function nl(t,e){return rI(t,r=>r*XQ,e)}function xs(t,e,r){return rI(t,i=>Math.max(e,Math.min(r,i)))}function Ds(t,e,r){return il(t)?t.map((i,n)=>Ds(i,e[n],r)):r*e+(1-r)*t}function Wo(t,e,r){let i=On.EPSILON;r&&(On.EPSILON=r);try{if(t===e)return!0;if(il(t)&&il(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Wo(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=On.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{On.EPSILON=i}}function QQ(t){return Math.round(t/On.EPSILON)*On.EPSILON}function JQ(t){return t.clone?t.clone():new Array(t.length)}function rI(t,e,r){if(il(t)){let i=t;r=r||JQ(i);for(let n=0;n<r.length&&n<i.length;++n){let o=typeof t=="number"?t:t[n];r[n]=e(o,n,r)}return r}return e(t)}var hd=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+r];return this.check()}toArray(e=[],r=0){for(let i=0;i<this.ELEMENTS;++i)e[r+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:il(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(On)}formatString(e){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+JS(this[i],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!Wo(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,i){if(i===void 0)return this.lerp(this,e,r);for(let n=0;n<this.ELEMENTS;++n){let o=e[n],a=typeof r=="number"?r:r[n];this[n]=o+i*(a-o)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),r[i]);return this.check()}add(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=r[i];return this.check()}subtract(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=r[i];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(On.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),r);return this.check()}get elements(){return this}};function eJ(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function Fi(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function fd(t,e,r=""){if(On.debug&&!eJ(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function bs(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}var dd=class extends hd{get x(){return this[0]}set x(e){this[0]=Fi(e)}get y(){return this[1]}set y(e){this[1]=Fi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let i=0;i<this.ELEMENTS;++i){let n=this[i]-e[i];r+=n*n}return Fi(r)}dot(e){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*e[i];return Fi(r)}normalize(){let e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=r[i];return this.check()}divide(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=r[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return bs(e>=0&&e<this.ELEMENTS,"index is out of range"),Fi(this[e])}setComponent(e,r){return bs(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}};var Ru={};no(Ru,{add:()=>oJ,angle:()=>bJ,ceil:()=>sJ,clone:()=>tJ,copy:()=>iJ,create:()=>a8,cross:()=>gJ,dist:()=>PJ,distance:()=>h8,div:()=>MJ,divide:()=>u8,dot:()=>mJ,equals:()=>EJ,exactEquals:()=>TJ,floor:()=>aJ,forEach:()=>LJ,fromValues:()=>rJ,inverse:()=>pJ,len:()=>CJ,length:()=>d8,lerp:()=>_J,max:()=>cJ,min:()=>lJ,mul:()=>IJ,multiply:()=>c8,negate:()=>dJ,normalize:()=>AJ,random:()=>yJ,rotate:()=>xJ,round:()=>uJ,scale:()=>hJ,scaleAndAdd:()=>fJ,set:()=>nJ,sqrDist:()=>RJ,sqrLen:()=>BJ,squaredDistance:()=>f8,squaredLength:()=>p8,str:()=>wJ,sub:()=>SJ,subtract:()=>l8,transformMat2:()=>iI,transformMat2d:()=>nI,transformMat3:()=>A1,transformMat4:()=>m1,zero:()=>vJ});var Cn=typeof Float32Array<"u"?Float32Array:Array,Pu=Math.random;function Pl(t){return t>=0?Math.round(t):t%.5===0?Math.floor(t):Math.round(t)}var _Te=Math.PI/180;function a8(){let t=new Cn(2);return Cn!=Float32Array&&(t[0]=0,t[1]=0),t}function tJ(t){let e=new Cn(2);return e[0]=t[0],e[1]=t[1],e}function rJ(t,e){let r=new Cn(2);return r[0]=t,r[1]=e,r}function iJ(t,e){return t[0]=e[0],t[1]=e[1],t}function nJ(t,e,r){return t[0]=e,t[1]=r,t}function oJ(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function l8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function c8(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function u8(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function sJ(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function aJ(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function lJ(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function cJ(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function uJ(t,e){return t[0]=Pl(e[0]),t[1]=Pl(e[1]),t}function hJ(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function fJ(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function h8(t,e){let r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function f8(t,e){let r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function d8(t){let e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function p8(t){let e=t[0],r=t[1];return e*e+r*r}function dJ(t,e){return t[0]=-e[0],t[1]=-e[1],t}function pJ(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function AJ(t,e){let r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function mJ(t,e){return t[0]*e[0]+t[1]*e[1]}function gJ(t,e,r){let i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function _J(t,e,r,i){let n=e[0],o=e[1];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t}function yJ(t,e){e=e===void 0?1:e;let r=Pu()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function iI(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function nI(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function A1(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function m1(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function xJ(t,e,r,i){let n=e[0]-r[0],o=e[1]-r[1],a=Math.sin(i),c=Math.cos(i);return t[0]=n*c-o*a+r[0],t[1]=n*a+o*c+r[1],t}function bJ(t,e){let r=t[0],i=t[1],n=e[0],o=e[1],a=Math.sqrt((r*r+i*i)*(n*n+o*o)),c=a&&(r*n+i*o)/a;return Math.acos(Math.min(Math.max(c,-1),1))}function vJ(t){return t[0]=0,t[1]=0,t}function wJ(t){return`vec2(${t[0]}, ${t[1]})`}function TJ(t,e){return t[0]===e[0]&&t[1]===e[1]}function EJ(t,e){let r=t[0],i=t[1],n=e[0],o=e[1];return Math.abs(r-n)<=1e-6*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=1e-6*Math.max(1,Math.abs(i),Math.abs(o))}var CJ=d8,SJ=l8,IJ=c8,MJ=u8,PJ=h8,RJ=f8,BJ=p8,LJ=function(){let t=a8();return function(e,r,i,n,o,a){let c,h;for(r||(r=2),i||(i=0),n?h=Math.min(n*r+i,e.length):h=e.length,c=i;c<h;c+=r)t[0]=e[c],t[1]=e[c+1],o(t,t,a),e[c]=t[0],e[c+1]=t[1];return e}}();function Kb(t,e,r){let i=e[0],n=e[1],o=r[3]*i+r[7]*n||1;return t[0]=(r[0]*i+r[4]*n)/o,t[1]=(r[1]*i+r[5]*n)/o,t}function Qb(t,e,r){let i=e[0],n=e[1],o=e[2],a=r[3]*i+r[7]*n+r[11]*o||1;return t[0]=(r[0]*i+r[4]*n+r[8]*o)/a,t[1]=(r[1]*i+r[5]*n+r[9]*o)/a,t[2]=(r[2]*i+r[6]*n+r[10]*o)/a,t}function A8(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t}function m8(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t[3]=e[3],t}function Jb(t,e,r){let i=e[0],n=e[1],o=e[2];return t[0]=r[0]*i+r[3]*n+r[6]*o,t[1]=r[1]*i+r[4]*n+r[7]*o,t[2]=r[2]*i+r[5]*n+r[8]*o,t[3]=e[3],t}var Zp=class extends dd{constructor(e=0,r=0){super(2),il(e)&&arguments.length===1?this.copy(e):(On.debug&&(Fi(e),Fi(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return On.debug&&(Fi(e.x),Fi(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return m1(this,this,e),this.check()}transformAsVector(e){return Kb(this,this,e),this.check()}transformByMatrix3(e){return A1(this,this,e),this.check()}transformByMatrix2x3(e){return nI(this,this,e),this.check()}transformByMatrix2(e){return iI(this,this,e),this.check()}};var Fs={};no(Fs,{add:()=>kJ,angle:()=>cI,bezier:()=>YJ,ceil:()=>NJ,clone:()=>OJ,copy:()=>DJ,create:()=>ev,cross:()=>Xp,dist:()=>oee,distance:()=>b8,div:()=>nee,divide:()=>x8,dot:()=>g1,equals:()=>tee,exactEquals:()=>eee,floor:()=>zJ,forEach:()=>lee,fromValues:()=>tv,hermite:()=>XJ,inverse:()=>$J,len:()=>uI,length:()=>g8,lerp:()=>qJ,max:()=>VJ,min:()=>UJ,mul:()=>iee,multiply:()=>y8,negate:()=>WJ,normalize:()=>oI,random:()=>KJ,rotateX:()=>sI,rotateY:()=>aI,rotateZ:()=>lI,round:()=>jJ,scale:()=>GJ,scaleAndAdd:()=>HJ,set:()=>FJ,slerp:()=>ZJ,sqrDist:()=>see,sqrLen:()=>aee,squaredDistance:()=>v8,squaredLength:()=>w8,str:()=>JJ,sub:()=>ree,subtract:()=>_8,transformMat3:()=>_1,transformMat4:()=>Yp,transformQuat:()=>y1,zero:()=>QJ});function ev(){let t=new Cn(3);return Cn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function OJ(t){let e=new Cn(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function g8(t){let e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function tv(t,e,r){let i=new Cn(3);return i[0]=t,i[1]=e,i[2]=r,i}function DJ(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function FJ(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function kJ(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function _8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function y8(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function x8(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function NJ(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function zJ(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function UJ(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function VJ(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function jJ(t,e){return t[0]=Pl(e[0]),t[1]=Pl(e[1]),t[2]=Pl(e[2]),t}function GJ(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function HJ(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function b8(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function v8(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function w8(t){let e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function WJ(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function $J(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function oI(t,e){let r=e[0],i=e[1],n=e[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function g1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Xp(t,e,r){let i=e[0],n=e[1],o=e[2],a=r[0],c=r[1],h=r[2];return t[0]=n*h-o*c,t[1]=o*a-i*h,t[2]=i*c-n*a,t}function qJ(t,e,r,i){let n=e[0],o=e[1],a=e[2];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=a+i*(r[2]-a),t}function ZJ(t,e,r,i){let n=Math.acos(Math.min(Math.max(g1(e,r),-1),1)),o=Math.sin(n),a=Math.sin((1-i)*n)/o,c=Math.sin(i*n)/o;return t[0]=a*e[0]+c*r[0],t[1]=a*e[1]+c*r[1],t[2]=a*e[2]+c*r[2],t}function XJ(t,e,r,i,n,o){let a=o*o,c=a*(2*o-3)+1,h=a*(o-2)+o,p=a*(o-1),x=a*(3-2*o);return t[0]=e[0]*c+r[0]*h+i[0]*p+n[0]*x,t[1]=e[1]*c+r[1]*h+i[1]*p+n[1]*x,t[2]=e[2]*c+r[2]*h+i[2]*p+n[2]*x,t}function YJ(t,e,r,i,n,o){let a=1-o,c=a*a,h=o*o,p=c*a,x=3*o*c,T=3*h*a,R=h*o;return t[0]=e[0]*p+r[0]*x+i[0]*T+n[0]*R,t[1]=e[1]*p+r[1]*x+i[1]*T+n[1]*R,t[2]=e[2]*p+r[2]*x+i[2]*T+n[2]*R,t}function KJ(t,e){e=e===void 0?1:e;let r=Pu()*2*Math.PI,i=Pu()*2-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function Yp(t,e,r){let i=e[0],n=e[1],o=e[2],a=r[3]*i+r[7]*n+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/a,t}function _1(t,e,r){let i=e[0],n=e[1],o=e[2];return t[0]=i*r[0]+n*r[3]+o*r[6],t[1]=i*r[1]+n*r[4]+o*r[7],t[2]=i*r[2]+n*r[5]+o*r[8],t}function y1(t,e,r){let i=r[0],n=r[1],o=r[2],a=r[3],c=e[0],h=e[1],p=e[2],x=n*p-o*h,T=o*c-i*p,R=i*h-n*c,k=n*R-o*T,j=o*x-i*R,q=i*T-n*x,Z=a*2;return x*=Z,T*=Z,R*=Z,k*=2,j*=2,q*=2,t[0]=c+x+k,t[1]=h+T+j,t[2]=p+R+q,t}function sI(t,e,r,i){let n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function aI(t,e,r,i){let n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function lI(t,e,r,i){let n=[],o=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function cI(t,e){let r=t[0],i=t[1],n=t[2],o=e[0],a=e[1],c=e[2],h=Math.sqrt((r*r+i*i+n*n)*(o*o+a*a+c*c)),p=h&&g1(t,e)/h;return Math.acos(Math.min(Math.max(p,-1),1))}function QJ(t){return t[0]=0,t[1]=0,t[2]=0,t}function JJ(t){return`vec3(${t[0]}, ${t[1]}, ${t[2]})`}function eee(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function tee(t,e){let r=t[0],i=t[1],n=t[2],o=e[0],a=e[1],c=e[2];return Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-c)<=1e-6*Math.max(1,Math.abs(n),Math.abs(c))}var ree=_8,iee=y8,nee=x8,oee=b8,see=v8,uI=g8,aee=w8,lee=function(){let t=ev();return function(e,r,i,n,o,a){let c,h;for(r||(r=3),i||(i=0),n?h=Math.min(n*r+i,e.length):h=e.length,c=i;c<h;c+=r)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],o(t,t,a),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2];return e}}();var hI=[0,0,0],rv,ot=class t extends dd{static get ZERO(){return rv||(rv=new t(0,0,0),Object.freeze(rv)),rv}constructor(e=0,r=0,i=0){super(-0,-0,-0),arguments.length===1&&il(e)?this.copy(e):(On.debug&&(Fi(e),Fi(r),Fi(i)),this[0]=e,this[1]=r,this[2]=i)}set(e,r,i){return this[0]=e,this[1]=r,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return On.debug&&(Fi(e.x),Fi(e.y),Fi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Fi(e)}angle(e){return cI(this,e)}cross(e){return Xp(this,this,e),this.check()}rotateX({radians:e,origin:r=hI}){return sI(this,this,r,e),this.check()}rotateY({radians:e,origin:r=hI}){return aI(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=hI}){return lI(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Yp(this,this,e),this.check()}transformAsVector(e){return Qb(this,this,e),this.check()}transformByMatrix3(e){return _1(this,this,e),this.check()}transformByMatrix2(e){return A8(this,this,e),this.check()}transformByQuaternion(e){return y1(this,this,e),this.check()}};var iv,nv=class t extends dd{static get ZERO(){return iv||(iv=new t(0,0,0,0),Object.freeze(iv)),iv}constructor(e=0,r=0,i=0,n=0){super(-0,-0,-0,-0),il(e)&&arguments.length===1?this.copy(e):(On.debug&&(Fi(e),Fi(r),Fi(i),Fi(n)),this[0]=e,this[1]=r,this[2]=i,this[3]=n)}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return On.debug&&(Fi(e.x),Fi(e.y),Fi(e.z),Fi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Fi(e)}get w(){return this[3]}set w(e){this[3]=Fi(e)}transform(e){return Yp(this,this,e),this.check()}transformByMatrix3(e){return Jb(this,this,e),this.check()}transformByMatrix2(e){return m8(this,this,e),this.check()}transformByQuaternion(e){return y1(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}};var nm=class extends hd{toString(){let e="[";if(On.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,i){return this[r*this.RANK+e]=Fi(i),this}getColumn(e,r=new Array(this.RANK).fill(-0)){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)r[n]=this[i+n];return r}setColumn(e,r){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=r[n];return this}};function T8(){let t=new Cn(9);return Cn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function E8(t,e){if(t===e){let r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function C8(t,e){let r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],p=e[7],x=e[8],T=x*a-c*p,R=-x*o+c*h,k=p*o-a*h,j=r*T+i*R+n*k;return j?(j=1/j,t[0]=T*j,t[1]=(-x*i+n*p)*j,t[2]=(c*i-n*a)*j,t[3]=R*j,t[4]=(x*r-n*h)*j,t[5]=(-c*r+n*o)*j,t[6]=k*j,t[7]=(-p*r+i*h)*j,t[8]=(a*r-i*o)*j,t):null}function S8(t){let e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],a=t[5],c=t[6],h=t[7],p=t[8];return e*(p*o-a*h)+r*(-p*n+a*c)+i*(h*n-o*c)}function fI(t,e,r){let i=e[0],n=e[1],o=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=r[0],k=r[1],j=r[2],q=r[3],Z=r[4],re=r[5],ee=r[6],se=r[7],me=r[8];return t[0]=R*i+k*a+j*p,t[1]=R*n+k*c+j*x,t[2]=R*o+k*h+j*T,t[3]=q*i+Z*a+re*p,t[4]=q*n+Z*c+re*x,t[5]=q*o+Z*h+re*T,t[6]=ee*i+se*a+me*p,t[7]=ee*n+se*c+me*x,t[8]=ee*o+se*h+me*T,t}function I8(t,e,r){let i=e[0],n=e[1],o=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=r[0],k=r[1];return t[0]=i,t[1]=n,t[2]=o,t[3]=a,t[4]=c,t[5]=h,t[6]=R*i+k*a+p,t[7]=R*n+k*c+x,t[8]=R*o+k*h+T,t}function M8(t,e,r){let i=e[0],n=e[1],o=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=Math.sin(r),k=Math.cos(r);return t[0]=k*i+R*a,t[1]=k*n+R*c,t[2]=k*o+R*h,t[3]=k*a-R*i,t[4]=k*c-R*n,t[5]=k*h-R*o,t[6]=p,t[7]=x,t[8]=T,t}function dI(t,e,r){let i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function P8(t,e){let r=e[0],i=e[1],n=e[2],o=e[3],a=r+r,c=i+i,h=n+n,p=r*a,x=i*a,T=i*c,R=n*a,k=n*c,j=n*h,q=o*a,Z=o*c,re=o*h;return t[0]=1-T-j,t[3]=x-re,t[6]=R+Z,t[1]=x+re,t[4]=1-p-j,t[7]=k-q,t[2]=R-Z,t[5]=k+q,t[8]=1-p-T,t}var pI;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(pI||(pI={}));var cee=Object.freeze([1,0,0,0,1,0,0,0,1]),an=class extends nm{static get IDENTITY(){return hee()}static get ZERO(){return uee()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return pI}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(cee)}fromObject(e){return this.check()}fromQuaternion(e){return P8(this,e),this.check()}set(e,r,i,n,o,a,c,h,p){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=o,this[5]=a,this[6]=c,this[7]=h,this[8]=p,this.check()}setRowMajor(e,r,i,n,o,a,c,h,p){return this[0]=e,this[1]=n,this[2]=c,this[3]=r,this[4]=o,this[5]=h,this[6]=i,this[7]=a,this[8]=p,this.check()}determinant(){return S8(this)}transpose(){return E8(this,this),this.check()}invert(){return C8(this,this),this.check()}multiplyLeft(e){return fI(this,e,this),this.check()}multiplyRight(e){return fI(this,this,e),this.check()}rotate(e){return M8(this,this,e),this.check()}scale(e){return Array.isArray(e)?dI(this,this,e):dI(this,this,[e,e]),this.check()}translate(e){return I8(this,this,e),this.check()}transform(e,r){let i;switch(e.length){case 2:i=A1(r||[-0,-0],e,this);break;case 3:i=_1(r||[-0,-0,-0],e,this);break;case 4:i=Jb(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fd(i,e.length),i}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}},ov,sv=null;function uee(){return ov||(ov=new an([0,0,0,0,0,0,0,0,0]),Object.freeze(ov)),ov}function hee(){return sv||(sv=new an,Object.freeze(sv)),sv}var Po={};no(Po,{add:()=>Fee,adjoint:()=>gee,clone:()=>dee,copy:()=>pee,create:()=>fee,decompose:()=>See,determinant:()=>gI,equals:()=>Uee,exactEquals:()=>zee,frob:()=>Dee,fromQuat:()=>TI,fromQuat2:()=>Tee,fromRotation:()=>xee,fromRotationTranslation:()=>L8,fromRotationTranslationScale:()=>Iee,fromRotationTranslationScaleOrigin:()=>Mee,fromScaling:()=>yee,fromTranslation:()=>_ee,fromValues:()=>Aee,fromXRotation:()=>bee,fromYRotation:()=>vee,fromZRotation:()=>wee,frustum:()=>EI,getRotation:()=>Cee,getScaling:()=>O8,getTranslation:()=>Eee,identity:()=>B8,invert:()=>mI,lookAt:()=>II,mul:()=>Vee,multiply:()=>x1,multiplyScalar:()=>kee,multiplyScalarAndAdd:()=>Nee,ortho:()=>SI,orthoNO:()=>F8,orthoZO:()=>Bee,perspective:()=>CI,perspectiveFromFieldOfView:()=>Ree,perspectiveNO:()=>D8,perspectiveZO:()=>Pee,rotate:()=>xI,rotateX:()=>bI,rotateY:()=>vI,rotateZ:()=>wI,scale:()=>yI,set:()=>mee,str:()=>Oee,sub:()=>jee,subtract:()=>k8,targetTo:()=>Lee,translate:()=>_I,transpose:()=>AI});function fee(){let t=new Cn(16);return Cn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function dee(t){let e=new Cn(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pee(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Aee(t,e,r,i,n,o,a,c,h,p,x,T,R,k,j,q){let Z=new Cn(16);return Z[0]=t,Z[1]=e,Z[2]=r,Z[3]=i,Z[4]=n,Z[5]=o,Z[6]=a,Z[7]=c,Z[8]=h,Z[9]=p,Z[10]=x,Z[11]=T,Z[12]=R,Z[13]=k,Z[14]=j,Z[15]=q,Z}function mee(t,e,r,i,n,o,a,c,h,p,x,T,R,k,j,q,Z){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=o,t[5]=a,t[6]=c,t[7]=h,t[8]=p,t[9]=x,t[10]=T,t[11]=R,t[12]=k,t[13]=j,t[14]=q,t[15]=Z,t}function B8(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function AI(t,e){if(t===e){let r=e[1],i=e[2],n=e[3],o=e[6],a=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=n,t[13]=a,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function mI(t,e){let r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],p=e[7],x=e[8],T=e[9],R=e[10],k=e[11],j=e[12],q=e[13],Z=e[14],re=e[15],ee=r*c-i*a,se=r*h-n*a,me=r*p-o*a,Le=i*h-n*c,je=i*p-o*c,Je=n*p-o*h,J=x*q-T*j,te=x*Z-R*j,X=x*re-k*j,ye=T*Z-R*q,_e=T*re-k*q,Oe=R*re-k*Z,ve=ee*Oe-se*_e+me*ye+Le*X-je*te+Je*J;return ve?(ve=1/ve,t[0]=(c*Oe-h*_e+p*ye)*ve,t[1]=(n*_e-i*Oe-o*ye)*ve,t[2]=(q*Je-Z*je+re*Le)*ve,t[3]=(R*je-T*Je-k*Le)*ve,t[4]=(h*X-a*Oe-p*te)*ve,t[5]=(r*Oe-n*X+o*te)*ve,t[6]=(Z*me-j*Je-re*se)*ve,t[7]=(x*Je-R*me+k*se)*ve,t[8]=(a*_e-c*X+p*J)*ve,t[9]=(i*X-r*_e-o*J)*ve,t[10]=(j*je-q*me+re*ee)*ve,t[11]=(T*me-x*je-k*ee)*ve,t[12]=(c*te-a*ye-h*J)*ve,t[13]=(r*ye-i*te+n*J)*ve,t[14]=(q*se-j*Le-Z*ee)*ve,t[15]=(x*Le-T*se+R*ee)*ve,t):null}function gee(t,e){let r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],c=e[5],h=e[6],p=e[7],x=e[8],T=e[9],R=e[10],k=e[11],j=e[12],q=e[13],Z=e[14],re=e[15],ee=r*c-i*a,se=r*h-n*a,me=r*p-o*a,Le=i*h-n*c,je=i*p-o*c,Je=n*p-o*h,J=x*q-T*j,te=x*Z-R*j,X=x*re-k*j,ye=T*Z-R*q,_e=T*re-k*q,Oe=R*re-k*Z;return t[0]=c*Oe-h*_e+p*ye,t[1]=n*_e-i*Oe-o*ye,t[2]=q*Je-Z*je+re*Le,t[3]=R*je-T*Je-k*Le,t[4]=h*X-a*Oe-p*te,t[5]=r*Oe-n*X+o*te,t[6]=Z*me-j*Je-re*se,t[7]=x*Je-R*me+k*se,t[8]=a*_e-c*X+p*J,t[9]=i*X-r*_e-o*J,t[10]=j*je-q*me+re*ee,t[11]=T*me-x*je-k*ee,t[12]=c*te-a*ye-h*J,t[13]=r*ye-i*te+n*J,t[14]=q*se-j*Le-Z*ee,t[15]=x*Le-T*se+R*ee,t}function gI(t){let e=t[0],r=t[1],i=t[2],n=t[3],o=t[4],a=t[5],c=t[6],h=t[7],p=t[8],x=t[9],T=t[10],R=t[11],k=t[12],j=t[13],q=t[14],Z=t[15],re=e*a-r*o,ee=e*c-i*o,se=r*c-i*a,me=p*j-x*k,Le=p*q-T*k,je=x*q-T*j,Je=e*je-r*Le+i*me,J=o*je-a*Le+c*me,te=p*se-x*ee+T*re,X=k*se-j*ee+q*re;return h*Je-n*J+Z*te-R*X}function x1(t,e,r){let i=e[0],n=e[1],o=e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=e[8],R=e[9],k=e[10],j=e[11],q=e[12],Z=e[13],re=e[14],ee=e[15],se=r[0],me=r[1],Le=r[2],je=r[3];return t[0]=se*i+me*c+Le*T+je*q,t[1]=se*n+me*h+Le*R+je*Z,t[2]=se*o+me*p+Le*k+je*re,t[3]=se*a+me*x+Le*j+je*ee,se=r[4],me=r[5],Le=r[6],je=r[7],t[4]=se*i+me*c+Le*T+je*q,t[5]=se*n+me*h+Le*R+je*Z,t[6]=se*o+me*p+Le*k+je*re,t[7]=se*a+me*x+Le*j+je*ee,se=r[8],me=r[9],Le=r[10],je=r[11],t[8]=se*i+me*c+Le*T+je*q,t[9]=se*n+me*h+Le*R+je*Z,t[10]=se*o+me*p+Le*k+je*re,t[11]=se*a+me*x+Le*j+je*ee,se=r[12],me=r[13],Le=r[14],je=r[15],t[12]=se*i+me*c+Le*T+je*q,t[13]=se*n+me*h+Le*R+je*Z,t[14]=se*o+me*p+Le*k+je*re,t[15]=se*a+me*x+Le*j+je*ee,t}function _I(t,e,r){let i=r[0],n=r[1],o=r[2],a,c,h,p,x,T,R,k,j,q,Z,re;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*o+e[12],t[13]=e[1]*i+e[5]*n+e[9]*o+e[13],t[14]=e[2]*i+e[6]*n+e[10]*o+e[14],t[15]=e[3]*i+e[7]*n+e[11]*o+e[15]):(a=e[0],c=e[1],h=e[2],p=e[3],x=e[4],T=e[5],R=e[6],k=e[7],j=e[8],q=e[9],Z=e[10],re=e[11],t[0]=a,t[1]=c,t[2]=h,t[3]=p,t[4]=x,t[5]=T,t[6]=R,t[7]=k,t[8]=j,t[9]=q,t[10]=Z,t[11]=re,t[12]=a*i+x*n+j*o+e[12],t[13]=c*i+T*n+q*o+e[13],t[14]=h*i+R*n+Z*o+e[14],t[15]=p*i+k*n+re*o+e[15]),t}function yI(t,e,r){let i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function xI(t,e,r,i){let n=i[0],o=i[1],a=i[2],c=Math.sqrt(n*n+o*o+a*a),h,p,x,T,R,k,j,q,Z,re,ee,se,me,Le,je,Je,J,te,X,ye,_e,Oe,ve,De;return c<1e-6?null:(c=1/c,n*=c,o*=c,a*=c,p=Math.sin(r),h=Math.cos(r),x=1-h,T=e[0],R=e[1],k=e[2],j=e[3],q=e[4],Z=e[5],re=e[6],ee=e[7],se=e[8],me=e[9],Le=e[10],je=e[11],Je=n*n*x+h,J=o*n*x+a*p,te=a*n*x-o*p,X=n*o*x-a*p,ye=o*o*x+h,_e=a*o*x+n*p,Oe=n*a*x+o*p,ve=o*a*x-n*p,De=a*a*x+h,t[0]=T*Je+q*J+se*te,t[1]=R*Je+Z*J+me*te,t[2]=k*Je+re*J+Le*te,t[3]=j*Je+ee*J+je*te,t[4]=T*X+q*ye+se*_e,t[5]=R*X+Z*ye+me*_e,t[6]=k*X+re*ye+Le*_e,t[7]=j*X+ee*ye+je*_e,t[8]=T*Oe+q*ve+se*De,t[9]=R*Oe+Z*ve+me*De,t[10]=k*Oe+re*ve+Le*De,t[11]=j*Oe+ee*ve+je*De,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function bI(t,e,r){let i=Math.sin(r),n=Math.cos(r),o=e[4],a=e[5],c=e[6],h=e[7],p=e[8],x=e[9],T=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*n+p*i,t[5]=a*n+x*i,t[6]=c*n+T*i,t[7]=h*n+R*i,t[8]=p*n-o*i,t[9]=x*n-a*i,t[10]=T*n-c*i,t[11]=R*n-h*i,t}function vI(t,e,r){let i=Math.sin(r),n=Math.cos(r),o=e[0],a=e[1],c=e[2],h=e[3],p=e[8],x=e[9],T=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n-p*i,t[1]=a*n-x*i,t[2]=c*n-T*i,t[3]=h*n-R*i,t[8]=o*i+p*n,t[9]=a*i+x*n,t[10]=c*i+T*n,t[11]=h*i+R*n,t}function wI(t,e,r){let i=Math.sin(r),n=Math.cos(r),o=e[0],a=e[1],c=e[2],h=e[3],p=e[4],x=e[5],T=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*n+p*i,t[1]=a*n+x*i,t[2]=c*n+T*i,t[3]=h*n+R*i,t[4]=p*n-o*i,t[5]=x*n-a*i,t[6]=T*n-c*i,t[7]=R*n-h*i,t}function _ee(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function yee(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xee(t,e,r){let i=r[0],n=r[1],o=r[2],a=Math.sqrt(i*i+n*n+o*o),c,h,p;return a<1e-6?null:(a=1/a,i*=a,n*=a,o*=a,h=Math.sin(e),c=Math.cos(e),p=1-c,t[0]=i*i*p+c,t[1]=n*i*p+o*h,t[2]=o*i*p-n*h,t[3]=0,t[4]=i*n*p-o*h,t[5]=n*n*p+c,t[6]=o*n*p+i*h,t[7]=0,t[8]=i*o*p+n*h,t[9]=n*o*p-i*h,t[10]=o*o*p+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function bee(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vee(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wee(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L8(t,e,r){let i=e[0],n=e[1],o=e[2],a=e[3],c=i+i,h=n+n,p=o+o,x=i*c,T=i*h,R=i*p,k=n*h,j=n*p,q=o*p,Z=a*c,re=a*h,ee=a*p;return t[0]=1-(k+q),t[1]=T+ee,t[2]=R-re,t[3]=0,t[4]=T-ee,t[5]=1-(x+q),t[6]=j+Z,t[7]=0,t[8]=R+re,t[9]=j-Z,t[10]=1-(x+k),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Tee(t,e){let r=new Cn(3),i=-e[0],n=-e[1],o=-e[2],a=e[3],c=e[4],h=e[5],p=e[6],x=e[7],T=i*i+n*n+o*o+a*a;return T>0?(r[0]=(c*a+x*i+h*o-p*n)*2/T,r[1]=(h*a+x*n+p*i-c*o)*2/T,r[2]=(p*a+x*o+c*n-h*i)*2/T):(r[0]=(c*a+x*i+h*o-p*n)*2,r[1]=(h*a+x*n+p*i-c*o)*2,r[2]=(p*a+x*o+c*n-h*i)*2),L8(t,e,r),t}function Eee(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function O8(t,e){let r=e[0],i=e[1],n=e[2],o=e[4],a=e[5],c=e[6],h=e[8],p=e[9],x=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(o*o+a*a+c*c),t[2]=Math.sqrt(h*h+p*p+x*x),t}function Cee(t,e){let r=new Cn(3);O8(r,e);let i=1/r[0],n=1/r[1],o=1/r[2],a=e[0]*i,c=e[1]*n,h=e[2]*o,p=e[4]*i,x=e[5]*n,T=e[6]*o,R=e[8]*i,k=e[9]*n,j=e[10]*o,q=a+x+j,Z=0;return q>0?(Z=Math.sqrt(q+1)*2,t[3]=.25*Z,t[0]=(T-k)/Z,t[1]=(R-h)/Z,t[2]=(c-p)/Z):a>x&&a>j?(Z=Math.sqrt(1+a-x-j)*2,t[3]=(T-k)/Z,t[0]=.25*Z,t[1]=(c+p)/Z,t[2]=(R+h)/Z):x>j?(Z=Math.sqrt(1+x-a-j)*2,t[3]=(R-h)/Z,t[0]=(c+p)/Z,t[1]=.25*Z,t[2]=(T+k)/Z):(Z=Math.sqrt(1+j-a-x)*2,t[3]=(c-p)/Z,t[0]=(R+h)/Z,t[1]=(T+k)/Z,t[2]=.25*Z),t}function See(t,e,r,i){e[0]=i[12],e[1]=i[13],e[2]=i[14];let n=i[0],o=i[1],a=i[2],c=i[4],h=i[5],p=i[6],x=i[8],T=i[9],R=i[10];r[0]=Math.sqrt(n*n+o*o+a*a),r[1]=Math.sqrt(c*c+h*h+p*p),r[2]=Math.sqrt(x*x+T*T+R*R);let k=1/r[0],j=1/r[1],q=1/r[2],Z=n*k,re=o*j,ee=a*q,se=c*k,me=h*j,Le=p*q,je=x*k,Je=T*j,J=R*q,te=Z+me+J,X=0;return te>0?(X=Math.sqrt(te+1)*2,t[3]=.25*X,t[0]=(Le-Je)/X,t[1]=(je-ee)/X,t[2]=(re-se)/X):Z>me&&Z>J?(X=Math.sqrt(1+Z-me-J)*2,t[3]=(Le-Je)/X,t[0]=.25*X,t[1]=(re+se)/X,t[2]=(je+ee)/X):me>J?(X=Math.sqrt(1+me-Z-J)*2,t[3]=(je-ee)/X,t[0]=(re+se)/X,t[1]=.25*X,t[2]=(Le+Je)/X):(X=Math.sqrt(1+J-Z-me)*2,t[3]=(re-se)/X,t[0]=(je+ee)/X,t[1]=(Le+Je)/X,t[2]=.25*X),t}function Iee(t,e,r,i){let n=e[0],o=e[1],a=e[2],c=e[3],h=n+n,p=o+o,x=a+a,T=n*h,R=n*p,k=n*x,j=o*p,q=o*x,Z=a*x,re=c*h,ee=c*p,se=c*x,me=i[0],Le=i[1],je=i[2];return t[0]=(1-(j+Z))*me,t[1]=(R+se)*me,t[2]=(k-ee)*me,t[3]=0,t[4]=(R-se)*Le,t[5]=(1-(T+Z))*Le,t[6]=(q+re)*Le,t[7]=0,t[8]=(k+ee)*je,t[9]=(q-re)*je,t[10]=(1-(T+j))*je,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Mee(t,e,r,i,n){let o=e[0],a=e[1],c=e[2],h=e[3],p=o+o,x=a+a,T=c+c,R=o*p,k=o*x,j=o*T,q=a*x,Z=a*T,re=c*T,ee=h*p,se=h*x,me=h*T,Le=i[0],je=i[1],Je=i[2],J=n[0],te=n[1],X=n[2],ye=(1-(q+re))*Le,_e=(k+me)*Le,Oe=(j-se)*Le,ve=(k-me)*je,De=(1-(R+re))*je,Xe=(Z+ee)*je,rt=(j+se)*Je,tt=(Z-ee)*Je,yt=(1-(R+q))*Je;return t[0]=ye,t[1]=_e,t[2]=Oe,t[3]=0,t[4]=ve,t[5]=De,t[6]=Xe,t[7]=0,t[8]=rt,t[9]=tt,t[10]=yt,t[11]=0,t[12]=r[0]+J-(ye*J+ve*te+rt*X),t[13]=r[1]+te-(_e*J+De*te+tt*X),t[14]=r[2]+X-(Oe*J+Xe*te+yt*X),t[15]=1,t}function TI(t,e){let r=e[0],i=e[1],n=e[2],o=e[3],a=r+r,c=i+i,h=n+n,p=r*a,x=i*a,T=i*c,R=n*a,k=n*c,j=n*h,q=o*a,Z=o*c,re=o*h;return t[0]=1-T-j,t[1]=x+re,t[2]=R-Z,t[3]=0,t[4]=x-re,t[5]=1-p-j,t[6]=k+q,t[7]=0,t[8]=R+Z,t[9]=k-q,t[10]=1-p-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function EI(t,e,r,i,n,o,a){let c=1/(r-e),h=1/(n-i),p=1/(o-a);return t[0]=o*2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*h,t[6]=0,t[7]=0,t[8]=(r+e)*c,t[9]=(n+i)*h,t[10]=(a+o)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*p,t[15]=0,t}function D8(t,e,r,i,n){let o=1/Math.tan(e/2);if(t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){let a=1/(i-n);t[10]=(n+i)*a,t[14]=2*n*i*a}else t[10]=-1,t[14]=-2*i;return t}var CI=D8;function Pee(t,e,r,i,n){let o=1/Math.tan(e/2);if(t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){let a=1/(i-n);t[10]=n*a,t[14]=n*i*a}else t[10]=-1,t[14]=-i;return t}function Ree(t,e,r,i){let n=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),h=2/(a+c),p=2/(n+o);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=-((a-c)*h*.5),t[9]=(n-o)*p*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function F8(t,e,r,i,n,o,a){let c=1/(e-r),h=1/(i-n),p=1/(o-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+r)*c,t[13]=(n+i)*h,t[14]=(a+o)*p,t[15]=1,t}var SI=F8;function Bee(t,e,r,i,n,o,a){let c=1/(e-r),h=1/(i-n),p=1/(o-a);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=p,t[11]=0,t[12]=(e+r)*c,t[13]=(n+i)*h,t[14]=o*p,t[15]=1,t}function II(t,e,r,i){let n,o,a,c,h,p,x,T,R,k,j=e[0],q=e[1],Z=e[2],re=i[0],ee=i[1],se=i[2],me=r[0],Le=r[1],je=r[2];return Math.abs(j-me)<1e-6&&Math.abs(q-Le)<1e-6&&Math.abs(Z-je)<1e-6?B8(t):(T=j-me,R=q-Le,k=Z-je,n=1/Math.sqrt(T*T+R*R+k*k),T*=n,R*=n,k*=n,o=ee*k-se*R,a=se*T-re*k,c=re*R-ee*T,n=Math.sqrt(o*o+a*a+c*c),n?(n=1/n,o*=n,a*=n,c*=n):(o=0,a=0,c=0),h=R*c-k*a,p=k*o-T*c,x=T*a-R*o,n=Math.sqrt(h*h+p*p+x*x),n?(n=1/n,h*=n,p*=n,x*=n):(h=0,p=0,x=0),t[0]=o,t[1]=h,t[2]=T,t[3]=0,t[4]=a,t[5]=p,t[6]=R,t[7]=0,t[8]=c,t[9]=x,t[10]=k,t[11]=0,t[12]=-(o*j+a*q+c*Z),t[13]=-(h*j+p*q+x*Z),t[14]=-(T*j+R*q+k*Z),t[15]=1,t)}function Lee(t,e,r,i){let n=e[0],o=e[1],a=e[2],c=i[0],h=i[1],p=i[2],x=n-r[0],T=o-r[1],R=a-r[2],k=x*x+T*T+R*R;k>0&&(k=1/Math.sqrt(k),x*=k,T*=k,R*=k);let j=h*R-p*T,q=p*x-c*R,Z=c*T-h*x;return k=j*j+q*q+Z*Z,k>0&&(k=1/Math.sqrt(k),j*=k,q*=k,Z*=k),t[0]=j,t[1]=q,t[2]=Z,t[3]=0,t[4]=T*Z-R*q,t[5]=R*j-x*Z,t[6]=x*q-T*j,t[7]=0,t[8]=x,t[9]=T,t[10]=R,t[11]=0,t[12]=n,t[13]=o,t[14]=a,t[15]=1,t}function Oee(t){return`mat4(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}, ${t[4]}, ${t[5]}, ${t[6]}, ${t[7]}, ${t[8]}, ${t[9]}, ${t[10]}, ${t[11]}, ${t[12]}, ${t[13]}, ${t[14]}, ${t[15]})`}function Dee(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8]+t[9]*t[9]+t[10]*t[10]+t[11]*t[11]+t[12]*t[12]+t[13]*t[13]+t[14]*t[14]+t[15]*t[15])}function Fee(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function k8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function kee(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Nee(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function zee(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Uee(t,e){let r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],c=t[5],h=t[6],p=t[7],x=t[8],T=t[9],R=t[10],k=t[11],j=t[12],q=t[13],Z=t[14],re=t[15],ee=e[0],se=e[1],me=e[2],Le=e[3],je=e[4],Je=e[5],J=e[6],te=e[7],X=e[8],ye=e[9],_e=e[10],Oe=e[11],ve=e[12],De=e[13],Xe=e[14],rt=e[15];return Math.abs(r-ee)<=1e-6*Math.max(1,Math.abs(r),Math.abs(ee))&&Math.abs(i-se)<=1e-6*Math.max(1,Math.abs(i),Math.abs(se))&&Math.abs(n-me)<=1e-6*Math.max(1,Math.abs(n),Math.abs(me))&&Math.abs(o-Le)<=1e-6*Math.max(1,Math.abs(o),Math.abs(Le))&&Math.abs(a-je)<=1e-6*Math.max(1,Math.abs(a),Math.abs(je))&&Math.abs(c-Je)<=1e-6*Math.max(1,Math.abs(c),Math.abs(Je))&&Math.abs(h-J)<=1e-6*Math.max(1,Math.abs(h),Math.abs(J))&&Math.abs(p-te)<=1e-6*Math.max(1,Math.abs(p),Math.abs(te))&&Math.abs(x-X)<=1e-6*Math.max(1,Math.abs(x),Math.abs(X))&&Math.abs(T-ye)<=1e-6*Math.max(1,Math.abs(T),Math.abs(ye))&&Math.abs(R-_e)<=1e-6*Math.max(1,Math.abs(R),Math.abs(_e))&&Math.abs(k-Oe)<=1e-6*Math.max(1,Math.abs(k),Math.abs(Oe))&&Math.abs(j-ve)<=1e-6*Math.max(1,Math.abs(j),Math.abs(ve))&&Math.abs(q-De)<=1e-6*Math.max(1,Math.abs(q),Math.abs(De))&&Math.abs(Z-Xe)<=1e-6*Math.max(1,Math.abs(Z),Math.abs(Xe))&&Math.abs(re-rt)<=1e-6*Math.max(1,Math.abs(re),Math.abs(rt))}var Vee=x1,jee=k8;var Pa={};no(Pa,{add:()=>MI,ceil:()=>Gee,clone:()=>z8,copy:()=>V8,create:()=>N8,cross:()=>Kee,dist:()=>ote,distance:()=>$8,div:()=>nte,divide:()=>W8,dot:()=>BI,equals:()=>tte,exactEquals:()=>Z8,floor:()=>Hee,forEach:()=>cte,fromValues:()=>U8,inverse:()=>Yee,len:()=>ate,length:()=>av,lerp:()=>LI,max:()=>$ee,min:()=>Wee,mul:()=>ite,multiply:()=>H8,negate:()=>Xee,normalize:()=>RI,random:()=>Qee,round:()=>qee,scale:()=>PI,scaleAndAdd:()=>Zee,set:()=>j8,sqrDist:()=>ste,sqrLen:()=>lte,squaredDistance:()=>q8,squaredLength:()=>lv,str:()=>ete,sub:()=>rte,subtract:()=>G8,transformMat4:()=>OI,transformQuat:()=>DI,zero:()=>Jee});function N8(){let t=new Cn(4);return Cn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function z8(t){let e=new Cn(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function U8(t,e,r,i){let n=new Cn(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function V8(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function j8(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function MI(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function G8(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function H8(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function W8(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Gee(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Hee(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Wee(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function $ee(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function qee(t,e){return t[0]=Pl(e[0]),t[1]=Pl(e[1]),t[2]=Pl(e[2]),t[3]=Pl(e[3]),t}function PI(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Zee(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function $8(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+o*o)}function q8(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=e[3]-t[3];return r*r+i*i+n*n+o*o}function av(t){let e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function lv(t){let e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Xee(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Yee(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function RI(t,e){let r=e[0],i=e[1],n=e[2],o=e[3],a=r*r+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=o*a,t}function BI(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Kee(t,e,r,i){let n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],c=r[1]*i[2]-r[2]*i[1],h=r[1]*i[3]-r[3]*i[1],p=r[2]*i[3]-r[3]*i[2],x=e[0],T=e[1],R=e[2],k=e[3];return t[0]=T*p-R*h+k*c,t[1]=-(x*p)+R*a-k*o,t[2]=x*h-T*a+k*n,t[3]=-(x*c)+T*o-R*n,t}function LI(t,e,r,i){let n=e[0],o=e[1],a=e[2],c=e[3];return t[0]=n+i*(r[0]-n),t[1]=o+i*(r[1]-o),t[2]=a+i*(r[2]-a),t[3]=c+i*(r[3]-c),t}function Qee(t,e){e=e===void 0?1:e;let r,i,n,o,a,c;do r=Pu()*2-1,i=Pu()*2-1,a=r*r+i*i;while(a>=1);do n=Pu()*2-1,o=Pu()*2-1,c=n*n+o*o;while(c>=1);let h=Math.sqrt((1-a)/c);return t[0]=e*r,t[1]=e*i,t[2]=e*n*h,t[3]=e*o*h,t}function OI(t,e,r){let i=e[0],n=e[1],o=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,t}function DI(t,e,r){let i=e[0],n=e[1],o=e[2],a=r[0],c=r[1],h=r[2],p=r[3],x=p*i+c*o-h*n,T=p*n+h*i-a*o,R=p*o+a*n-c*i,k=-a*i-c*n-h*o;return t[0]=x*p+k*-a+T*-h-R*-c,t[1]=T*p+k*-c+R*-a-x*-h,t[2]=R*p+k*-h+x*-c-T*-a,t[3]=e[3],t}function Jee(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function ete(t){return`vec4(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}function Z8(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function tte(t,e){let r=t[0],i=t[1],n=t[2],o=t[3],a=e[0],c=e[1],h=e[2],p=e[3];return Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-c)<=1e-6*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-h)<=1e-6*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-p)<=1e-6*Math.max(1,Math.abs(o),Math.abs(p))}var rte=G8,ite=H8,nte=W8,ote=$8,ste=q8,ate=av,lte=lv,cte=function(){let t=N8();return function(e,r,i,n,o,a){let c,h;for(r||(r=4),i||(i=0),n?h=Math.min(n*r+i,e.length):h=e.length,c=i;c<h;c+=r)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],o(t,t,a),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}}();var NI;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(NI||(NI={}));var ute=45*Math.PI/180,hte=1,FI=.1,kI=500,fte=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),wr=class extends nm{static get IDENTITY(){return pte()}static get ZERO(){return dte()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return NI}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,i,n,o,a,c,h,p,x,T,R,k,j,q,Z){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=o,this[5]=a,this[6]=c,this[7]=h,this[8]=p,this[9]=x,this[10]=T,this[11]=R,this[12]=k,this[13]=j,this[14]=q,this[15]=Z,this.check()}setRowMajor(e,r,i,n,o,a,c,h,p,x,T,R,k,j,q,Z){return this[0]=e,this[1]=o,this[2]=p,this[3]=k,this[4]=r,this[5]=a,this[6]=x,this[7]=j,this[8]=i,this[9]=c,this[10]=T,this[11]=q,this[12]=n,this[13]=h,this[14]=R,this[15]=Z,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(fte)}fromObject(e){return this.check()}fromQuaternion(e){return TI(this,e),this.check()}frustum(e){let{left:r,right:i,bottom:n,top:o,near:a=FI,far:c=kI}=e;return c===1/0?Ate(this,r,i,n,o,a):EI(this,r,i,n,o,a,c),this.check()}lookAt(e){let{eye:r,center:i=[0,0,0],up:n=[0,1,0]}=e;return II(this,r,i,n),this.check()}ortho(e){let{left:r,right:i,bottom:n,top:o,near:a=FI,far:c=kI}=e;return SI(this,r,i,n,o,a,c),this.check()}orthographic(e){let{fovy:r=ute,aspect:i=hte,focalDistance:n=1,near:o=FI,far:a=kI}=e;X8(r);let c=r/2,h=n*Math.tan(c),p=h*i;return this.ortho({left:-p,right:p,bottom:-h,top:h,near:o,far:a})}perspective(e){let{fovy:r=45*Math.PI/180,aspect:i=1,near:n=.1,far:o=500}=e;return X8(r),CI(this,r,i,n,o),this.check()}determinant(){return gI(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let i=this.getScale(r),n=1/i[0],o=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*o,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*o,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let i=this.getScale(r),n=1/i[0],o=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=this[4]*n,e[4]=this[5]*o,e[5]=this[6]*a,e[6]=this[8]*n,e[7]=this[9]*o,e[8]=this[10]*a,e}transpose(){return AI(this,this),this.check()}invert(){return mI(this,this),this.check()}multiplyLeft(e){return x1(this,e,this),this.check()}multiplyRight(e){return x1(this,this,e),this.check()}rotateX(e){return bI(this,this,e),this.check()}rotateY(e){return vI(this,this,e),this.check()}rotateZ(e){return wI(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return xI(this,this,e,r),this.check()}scale(e){return yI(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return _I(this,this,e),this.check()}transform(e,r){return e.length===4?(r=OI(r||[-0,-0,-0,-0],e,this),fd(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){let{length:i}=e,n;switch(i){case 2:n=m1(r||[-0,-0],e,this);break;case 3:n=Yp(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fd(n,e.length),n}transformAsVector(e,r){let i;switch(e.length){case 2:i=Kb(r||[-0,-0],e,this);break;case 3:i=Qb(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fd(i,e.length),i}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,i){return this.identity().translate([e,r,i])}},cv,uv;function dte(){return cv||(cv=new wr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(cv)),cv}function pte(){return uv||(uv=new wr,Object.freeze(uv)),uv}function X8(t){if(t>Math.PI*2)throw Error("expected radians")}function Ate(t,e,r,i,n,o){let a=2*o/(r-e),c=2*o/(n-i),h=(r+e)/(r-e),p=(n+i)/(n-i),x=-1,T=-1,R=-2*o;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=h,t[9]=p,t[10]=x,t[11]=T,t[12]=0,t[13]=0,t[14]=R,t[15]=0,t}function Y8(){let t=new Cn(4);return Cn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function K8(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function zI(t,e,r){r=r*.5;let i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function UI(t,e,r){let i=e[0],n=e[1],o=e[2],a=e[3],c=r[0],h=r[1],p=r[2],x=r[3];return t[0]=i*x+a*c+n*p-o*h,t[1]=n*x+a*h+o*c-i*p,t[2]=o*x+a*p+i*h-n*c,t[3]=a*x-i*c-n*h-o*p,t}function Q8(t,e,r){r*=.5;let i=e[0],n=e[1],o=e[2],a=e[3],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+a*c,t[1]=n*h+o*c,t[2]=o*h-n*c,t[3]=a*h-i*c,t}function J8(t,e,r){r*=.5;let i=e[0],n=e[1],o=e[2],a=e[3],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h-o*c,t[1]=n*h+a*c,t[2]=o*h+i*c,t[3]=a*h-n*c,t}function eD(t,e,r){r*=.5;let i=e[0],n=e[1],o=e[2],a=e[3],c=Math.sin(r),h=Math.cos(r);return t[0]=i*h+n*c,t[1]=n*h-i*c,t[2]=o*h+a*c,t[3]=a*h-o*c,t}function tD(t,e){let r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function b1(t,e,r,i){let n=e[0],o=e[1],a=e[2],c=e[3],h=r[0],p=r[1],x=r[2],T=r[3],R,k,j,q,Z;return R=n*h+o*p+a*x+c*T,R<0&&(R=-R,h=-h,p=-p,x=-x,T=-T),1-R>1e-6?(k=Math.acos(R),Z=Math.sin(k),j=Math.sin((1-i)*k)/Z,q=Math.sin(i*k)/Z):(j=1-i,q=i),t[0]=j*n+q*h,t[1]=j*o+q*p,t[2]=j*a+q*x,t[3]=j*c+q*T,t}function rD(t,e){let r=e[0],i=e[1],n=e[2],o=e[3],a=r*r+i*i+n*n+o*o,c=a?1/a:0;return t[0]=-r*c,t[1]=-i*c,t[2]=-n*c,t[3]=o*c,t}function iD(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function VI(t,e){let r=e[0]+e[4]+e[8],i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);let o=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[o*3+o]-e[a*3+a]+1),t[n]=.5*i,i=.5/i,t[3]=(e[o*3+a]-e[a*3+o])*i,t[o]=(e[o*3+n]+e[n*3+o])*i,t[a]=(e[a*3+n]+e[n*3+a])*i}return t}var nD=MI;var oD=PI,sD=BI,aD=LI,lD=av;var cD=lv;var uD=RI;var hD=function(){let t=ev(),e=tv(1,0,0),r=tv(0,1,0);return function(i,n,o){let a=g1(n,o);return a<-.999999?(Xp(t,e,n),uI(t)<1e-6&&Xp(t,r,n),oI(t,t),zI(i,t,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Xp(t,n,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+a,uD(i,i))}}(),iEe=function(){let t=Y8(),e=Y8();return function(r,i,n,o,a,c){return b1(t,i,a,c),b1(e,n,o,c),b1(r,t,e,2*c*(1-c)),r}}(),nEe=function(){let t=T8();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],uD(e,VI(e,t))}}();var gte=[0,0,0,1],Rl=class extends hd{constructor(e=0,r=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,i,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return VI(this,e),this.check()}fromAxisRotation(e,r){return zI(this,e,r),this.check()}identity(){return K8(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Fi(e)}get y(){return this[1]}set y(e){this[1]=Fi(e)}get z(){return this[2]}set z(e){this[2]=Fi(e)}get w(){return this[3]}set w(e){this[3]=Fi(e)}len(){return lD(this)}lengthSquared(){return cD(this)}dot(e){return sD(this,e)}rotationTo(e,r){return hD(this,e,r),this.check()}add(e){return nD(this,this,e),this.check()}calculateW(){return tD(this,this),this.check()}conjugate(){return iD(this,this),this.check()}invert(){return rD(this,this),this.check()}lerp(e,r,i){return i===void 0?this.lerp(this,e,r):(aD(this,e,r,i),this.check())}multiplyRight(e){return UI(this,this,e),this.check()}multiplyLeft(e){return UI(this,e,this),this.check()}normalize(){let e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return Q8(this,this,e),this.check()}rotateY(e){return J8(this,this,e),this.check()}rotateZ(e){return eD(this,this,e),this.check()}scale(e){return oD(this,this,e),this.check()}slerp(e,r,i){let n,o,a;switch(arguments.length){case 1:({start:n=gte,target:o,ratio:a}=e);break;case 2:n=this,o=e,a=r;break;default:n=e,o=r,a=i}return b1(this,n,o,a),this.check()}transformVector4(e,r=new nv){return DI(r,e,this),fd(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}};var Cc={};no(Cc,{EPSILON1:()=>_te,EPSILON10:()=>Ste,EPSILON11:()=>Ite,EPSILON12:()=>Mte,EPSILON13:()=>Pte,EPSILON14:()=>Rte,EPSILON15:()=>Bte,EPSILON16:()=>Lte,EPSILON17:()=>Ote,EPSILON18:()=>Dte,EPSILON19:()=>Fte,EPSILON2:()=>yte,EPSILON20:()=>kte,EPSILON3:()=>xte,EPSILON4:()=>bte,EPSILON5:()=>vte,EPSILON6:()=>wte,EPSILON7:()=>Tte,EPSILON8:()=>Ete,EPSILON9:()=>Cte,PI_OVER_FOUR:()=>zte,PI_OVER_SIX:()=>Ute,PI_OVER_TWO:()=>Nte,TWO_PI:()=>Vte});var _te=.1,yte=.01,xte=.001,bte=1e-4,vte=1e-5,wte=1e-6,Tte=1e-7,Ete=1e-8,Cte=1e-9,Ste=1e-10,Ite=1e-11,Mte=1e-12,Pte=1e-13,Rte=1e-14,Bte=1e-15,Lte=1e-16,Ote=1e-17,Dte=1e-18,Fte=1e-19,kte=1e-20,Nte=Math.PI/2,zte=Math.PI/4,Ute=Math.PI/6,Vte=Math.PI*2;function jI(t,e=[],r=0){let i=Math.fround(t),n=t-i;return e[r]=i,e[r+1]=n,e}function fD(t){return t-Math.fround(t)}function dD(t){let e=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){let n=r*4+i;jI(t[i*4+r],e,n*2)}return e}var jte=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,GI={name:"fp32",vs:jte};var pD=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var Gte={ONE:1},HI={name:"fp64arithmetic",vs:pD,defaultUniforms:Gte,uniformTypes:{ONE:"f32"},fp64ify:jI,fp64LowPart:fD,fp64ifyMatrix4:dD};var Hte=[0,1,1,1],Wte=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,$te=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,hv={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Hte},vs:Wte,fs:$te,getUniforms:qte};function qte(t={},e){let r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let i=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=i}if(t.highlightColor){let i=Array.from(t.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),r.highlightColor=i}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}var WI=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`;var AD=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;var mD=3,Zte=255,v1;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(v1||(v1={}));var zh={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:mD},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:v1.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:AD,vs:WI,fs:WI,getUniforms:Xte};function Xte(t,e={}){if(t=t&&{...t},!t)return{...zh.defaultUniforms};t.lights&&(t={...t,...Kte(t.lights),lights:void 0});let{ambientLight:r,pointLights:i,directionalLights:n}=t||{};if(!(r||i&&i.length>0||n&&n.length>0))return{...zh.defaultUniforms,enabled:0};let a={...zh.defaultUniforms,...e,...Yte({ambientLight:r,pointLights:i,directionalLights:n})};return t.enabled!==void 0&&(a.enabled=t.enabled?1:0),a}function Yte({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){let i={};i.ambientLightColor=$I(t);let n=0;for(let o of e){i.lightType=v1.POINT;let a=n;i[`lightColor${a}`]=$I(o),i[`lightPosition${a}`]=o.position,i[`lightAttenuation${a}`]=o.attenuation||[1,0,0],n++}for(let o of r){i.lightType=v1.DIRECTIONAL;let a=n;i[`lightColor${a}`]=$I(o),i[`lightDirection${a}`]=o.direction,n++}return n>mD&&Vt.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=r.length,i.pointLightCount=e.length,i}function Kte(t){let e={pointLights:[],directionalLights:[]};for(let r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break;default:}return e}function $I(t={}){let{color:e=[0,0,0],intensity:r=1}=t;return e.map(i=>i*r/Zte)}var fv=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,dv=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`;var pv=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`;var pd={props:{},name:"gouraudMaterial",vs:dv.replace("phongMaterial","gouraudMaterial"),fs:fv.replace("phongMaterial","gouraudMaterial"),source:pv.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[zh],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){let e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...pd.defaultUniforms,...e}}};var om={name:"phongMaterial",dependencies:[zh],source:pv,vs:fv,fs:dv,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){let e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...om.defaultUniforms,...e}}};var gD=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`;var _D=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`;var yD=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,xD={name:"pbrProjection",vs:yD,fs:yD,getUniforms:t=>t,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}};var Kp={props:{},uniforms:{},name:"pbrMaterial",dependencies:[zh,xD],vs:gD,fs:_D,defines:{LIGHTING_FRAGMENT:1},getUniforms:t=>t,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}};var bD=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,qI={name:"layer",vs:bD,fs:bD,getUniforms:t=>({opacity:Math.pow(t.opacity,.45454545454545453)}),uniformTypes:{opacity:"f32"}};var Qte=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,vD="#define SMOOTH_EDGE_RADIUS 0.5",Jte=`${vD}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,ere=`${vD}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Av={name:"geometry",source:Qte,vs:Jte,fs:ere};var pn;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(pn||(pn={}));var Xn;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Xn||(Xn={}));var zr;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(zr||(zr={}));var wD="compute",ZI="auto",w1="manipulation",Qp="none",T1="pan-x",E1="pan-y";function XI(t){if(t.includes(Qp))return Qp;let e=t.includes(T1),r=t.includes(E1);return e&&r?Qp:e||r?e?T1:E1:t.includes(w1)?w1:ZI}var C1=class{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===wD&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return XI(e.join(" "))}};function sm(t){return t.trim().split(/\s+/g)}function mv(t,e,r){if(t)for(let i of sm(e))t.addEventListener(i,r,!1)}function gv(t,e,r){if(t)for(let i of sm(e))t.removeEventListener(i,r,!1)}function YI(t){return(t.ownerDocument||t).defaultView}function KI(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function _v(t){let e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,i=0,n=0;for(;n<e;)r+=t[n].clientX,i+=t[n].clientY,n++;return{x:Math.round(r/e),y:Math.round(i/e)}}function QI(t){let e=[],r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:_v(e),deltaX:t.deltaX,deltaY:t.deltaY}}function yv(t,e){let r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function JI(t,e){let r=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(r*r+i*i)}function TD(t,e){let r=e.x-t.x,i=e.y-t.y;return Math.atan2(i,r)*180/Math.PI}function eM(t,e){let r=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.atan2(i,r)*180/Math.PI}function xv(t,e){return t===e?Xn.None:Math.abs(t)>=Math.abs(e)?t<0?Xn.Left:Xn.Right:e<0?Xn.Up:Xn.Down}function ED(t,e){let r=e.center,i=t.offsetDelta,n=t.prevDelta,o=t.prevInput;return(e.eventType===pn.Start||o?.eventType===pn.End)&&(n=t.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},i=t.offsetDelta={x:r.x,y:r.y}),{deltaX:n.x+(r.x-i.x),deltaY:n.y+(r.y-i.y)}}function bv(t,e,r){return{x:e/t||0,y:r/t||0}}function CD(t,e){return JI(e[0],e[1])/JI(t[0],t[1])}function SD(t,e){return eM(e[1],e[0])-eM(t[1],t[0])}function ID(t,e){let r=t.lastInterval||e,i=e.timeStamp-r.timeStamp,n,o,a,c;if(e.eventType!==pn.Cancel&&(i>25||r.velocity===void 0)){let h=e.deltaX-r.deltaX,p=e.deltaY-r.deltaY,x=bv(i,h,p);o=x.x,a=x.y,n=Math.abs(x.x)>Math.abs(x.y)?x.x:x.y,c=xv(h,p),t.lastInterval=e}else n=r.velocity,o=r.velocityX,a=r.velocityY,c=r.direction;e.velocity=n,e.velocityX=o,e.velocityY=a,e.direction=c}function MD(t,e){let{session:r}=t,{pointers:i}=e,{length:n}=i;r.firstInput||(r.firstInput=QI(e)),n>1&&!r.firstMultiple?r.firstMultiple=QI(e):n===1&&(r.firstMultiple=!1);let{firstInput:o,firstMultiple:a}=r,c=a?a.center:o.center,h=e.center=_v(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=TD(c,h),e.distance=yv(c,h);let{deltaX:p,deltaY:x}=ED(r,e);e.deltaX=p,e.deltaY=x,e.offsetDirection=xv(e.deltaX,e.deltaY);let T=bv(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=T.x,e.overallVelocityY=T.y,e.overallVelocity=Math.abs(T.x)>Math.abs(T.y)?T.x:T.y,e.scale=a?CD(a.pointers,i):1,e.rotation=a?SD(a.pointers,i):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let R=t.element;return KI(e.srcEvent.target,R)&&(R=e.srcEvent.target),e.target=R,ID(r,e),e}function PD(t,e,r){let i=r.pointers.length,n=r.changedPointers.length,o=e&pn.Start&&i-n===0,a=e&(pn.End|pn.Cancel)&&i-n===0;r.isFirst=!!o,r.isFinal=!!a,o&&(t.session={}),r.eventType=e;let c=MD(t,r);t.emit("hammer.input",c),t.recognize(c),t.session.prevInput=c}var S1=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){PD(this.manager,e,r)}init(){mv(this.element,this.evEl,this.domHandler),mv(this.target,this.evTarget,this.domHandler),mv(YI(this.element),this.evWin,this.domHandler)}destroy(){gv(this.element,this.evEl,this.domHandler),gv(this.target,this.evTarget,this.domHandler),gv(YI(this.element),this.evWin,this.domHandler)}};var rre={pointerdown:pn.Start,pointermove:pn.Move,pointerup:pn.End,pointercancel:pn.Cancel,pointerout:pn.Cancel},ire="pointerdown",nre="pointermove pointerup pointercancel",I1=class extends S1{constructor(e){super(e),this.evEl=ire,this.evWin=nre,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:r}=this,i=!1,n=rre[e.type],o=e.pointerType,a=o==="touch",c=r.findIndex(h=>h.pointerId===e.pointerId);n&pn.Start&&(e.buttons||a)?c<0&&(r.push(e),c=r.length-1):n&(pn.End|pn.Cancel)&&(i=!0),!(c<0)&&(r[c]=e,this.callback(n,{pointers:r,changedPointers:[e],eventType:n,pointerType:o,srcEvent:e}),i&&r.splice(c,1))}};var ore=["","webkit","Moz","MS","ms","o"];function RD(t,e){let r=e[0].toUpperCase()+e.slice(1);for(let i of ore){let n=i?i+r:e;if(n in t)return n}}var sre=1,BD=2,LD={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}},M1=class{constructor(e,r){this.options={...LD,...r,cssProps:{...LD.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new I1(this),this.touchAction=new C1(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?BD:sre}recognize(e){let{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i,{recognizers:n}=this,{curRecognizer:o}=r;(!o||o&&o.state&zr.Recognized)&&(o=r.curRecognizer=null);let a=0;for(;a<n.length;)i=n[a],r.stopped!==BD&&(!o||i===o||i.canRecognizeWith(o))?i.recognize(e):i.reset(),!o&&i.state&(zr.Began|zr.Changed|zr.Ended)&&(o=r.curRecognizer=i),a++}get(e){let{recognizers:r}=this;for(let i=0;i<r.length;i++)if(r[i].options.event===e)return r[i];return null}add(e){if(Array.isArray(e)){for(let i of e)this.add(i);return this}let r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let i of e)this.remove(i);return this}let r=typeof e=="string"?this.get(e):e;if(r){let{recognizers:i}=this,n=i.indexOf(r);n!==-1&&(i.splice(n,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;let{handlers:i}=this;for(let n of sm(e))i[n]=i[n]||[],i[n].push(r)}off(e,r){if(!e)return;let{handlers:i}=this;for(let n of sm(e))r?i[n]&&i[n].splice(i[n].indexOf(r),1):delete i[n]}emit(e,r){let i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;let n=r;n.type=e,n.preventDefault=function(){r.srcEvent.preventDefault()};let o=0;for(;o<i.length;)i[o](n),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:r}=this;if(r){for(let[i,n]of Object.entries(this.options.cssProps)){let o=RD(r.style,i);e?(this.oldCssProps[o]=r.style[o],r.style[o]=n):r.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}};var are=1;function OD(){return are++}function tM(t){return t&zr.Cancelled?"cancel":t&zr.Ended?"end":t&zr.Changed?"move":t&zr.Began?"start":""}var Uh=class{constructor(e){this.options=e,this.id=OD(),this.state=zr.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(let n of e)this.recognizeWith(n);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;let{simultaneous:i}=this;return i[r.id]||(i[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(let i of e)this.dropRecognizeWith(i);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(let n of e)this.requireFailure(n);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;let{requireFail:i}=this;return i.indexOf(r)===-1&&(i.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(let i of e)this.dropRequireFailure(i);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){let i=this.requireFail.indexOf(r);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:r}=this;r<zr.Ended&&this.manager.emit(this.options.event+tM(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=zr.Ended&&this.manager.emit(this.options.event+tM(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=zr.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(zr.Failed|zr.Possible)))return!1;e++}return!0}recognize(e){let r={...e};if(!this.options.enable){this.reset(),this.state=zr.Failed;return}this.state&(zr.Recognized|zr.Cancelled|zr.Failed)&&(this.state=zr.Possible),this.state=this.process(r),this.state&(zr.Began|zr.Changed|zr.Ended|zr.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}};var Vh=class extends Uh{attrTest(e){let r=this.options.pointers;return r===0||e.pointers.length===r}process(e){let{state:r}=this,{eventType:i}=e,n=r&(zr.Began|zr.Changed),o=this.attrTest(e);return n&&(i&pn.Cancel||!o)?r|zr.Cancelled:n||o?i&pn.End?r|zr.Ended:r&zr.Began?r|zr.Changed:zr.Began:zr.Failed}};var Jp=class extends Uh{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[w1]}process(e){let{options:r}=this,i=e.pointers.length===r.pointers,n=e.distance<r.threshold,o=e.deltaTime<r.time;if(this.reset(),e.eventType&pn.Start&&this.count===0)return this.failTimeout();if(n&&o&&i){if(e.eventType!==pn.End)return this.failTimeout();let a=this.pTime?e.timeStamp-this.pTime<r.interval:!0,c=!this.pCenter||yv(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!a?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=zr.Recognized,this.tryEmit(this._input)},r.interval),zr.Began):zr.Recognized}return zr.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=zr.Failed},this.options.interval),zr.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===zr.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}};var lre=["","start","move","end","cancel","up","down","left","right"],Ad=class extends Vh{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Xn.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,r=[];return e&Xn.Horizontal&&r.push(E1),e&Xn.Vertical&&r.push(T1),r}getEventNames(){return lre.map(e=>this.options.event+e)}directionTest(e){let{options:r}=this,i=!0,{distance:n}=e,{direction:o}=e,a=e.deltaX,c=e.deltaY;return o&r.direction||(r.direction&Xn.Horizontal?(o=a===0?Xn.None:a<0?Xn.Left:Xn.Right,i=a!==this.pX,n=Math.abs(e.deltaX)):(o=c===0?Xn.None:c<0?Xn.Up:Xn.Down,i=c!==this.pY,n=Math.abs(e.deltaY))),e.direction=o,i&&n>r.threshold&&!!(o&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&zr.Began)||!(this.state&zr.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let r=Xn[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}};var cre=["","start","move","end","cancel","in","out"],am=class extends Vh{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Qp]}getEventNames(){return cre.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&zr.Began))}emit(e){if(e.scale!==1){let r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}};var Bu=class{constructor(e,r,i){this.element=e,this.callback=r,this.options=i}};var DD=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",RIe=typeof window<"u"?window:global;var dre=DD.indexOf("firefox")!==-1,FD=4.000244140625,pre=40,Are=.25,vv=class extends Bu{constructor(e,r,i){super(e,r,{enable:!0,...i}),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;globalThis.WheelEvent&&(dre&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=pre)),o!==0&&o%FD===0&&(o=Math.floor(o/FD)),n.shiftKey&&o&&(o=o*Are),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}};var kD=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],wv=class extends Bu{constructor(e,r,i){super(e,r,{enable:!0,...i}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;let{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,kD.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){kD.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break;default:}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break;default:}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var ND=["keydown","keyup"],Tv=class extends Bu{constructor(e,r,i){super(e,r,{enable:!0,tabIndex:0,...i}),this.handleEvent=n=>{let o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",ND.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){ND.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}};var Ev=class extends Bu{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}};var mre={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},gre=0,_re=1,yre=2,xre=1,bre=2,vre=4;function zD(t){let e=mre[t.srcEvent.type];if(!e)return null;let{buttons:r,button:i}=t.srcEvent,n=!1,o=!1,a=!1;return e===2?(n=!!(r&xre),o=!!(r&vre),a=!!(r&bre)):(n=i===gre,o=i===_re,a=i===yre),{leftButton:n,middleButton:o,rightButton:a}}function UD(t,e){let r=t.center;if(!r)return null;let i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1,a={x:(r.x-i.left-e.clientLeft)/n,y:(r.y-i.top-e.clientTop)/o};return{center:r,offsetCenter:a}}var wre={srcElement:"root",priority:0},Cv=class{constructor(e,r){this.handleEvent=i=>{if(this.isEmpty())return;let n=this._normalizeEvent(i),o=i.srcEvent.target;for(;o&&o!==n.rootElement;){if(this._emit(n,o),n.handled)return;o=o.parentNode}this._emit(n,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,i,n=!1,o=!1){let{handlers:a,handlersByElement:c}=this,h={...wre,...i},p=c.get(h.srcElement);p||(p=[],c.set(h.srcElement,p));let x={type:e,handler:r,srcElement:h.srcElement,priority:h.priority};n&&(x.once=!0),o&&(x.passive=!0),a.push(x),this._active=this._active||!x.passive;let T=p.length-1;for(;T>=0&&!(p[T].priority>=x.priority);)T--;p.splice(T+1,0,x)}remove(e,r){let{handlers:i,handlersByElement:n}=this;for(let o=i.length-1;o>=0;o--){let a=i[o];if(a.type===e&&a.handler===r){i.splice(o,1);let c=n.get(a.srcElement);c.splice(c.indexOf(a),1),c.length===0&&n.delete(a.srcElement)}}this._active=i.some(o=>!o.passive)}_emit(e,r){let i=this.handlersByElement.get(r);if(i){let n=!1,o=()=>{e.handled=!0},a=()=>{e.handled=!0,n=!0},c=[];for(let h=0;h<i.length;h++){let{type:p,handler:x,once:T}=i[h];if(x({...e,type:p,stopPropagation:o,stopImmediatePropagation:a}),T&&c.push(i[h]),n)break}for(let h=0;h<c.length;h++){let{type:p,handler:x}=c[h];this.remove(p,x)}}}_normalizeEvent(e){let r=this.eventManager.getElement();return{...e,...zD(e),...UD(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};function Tre(t){if("recognizer"in t)return t;let e,r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){let i=r.shift(),n=r.shift()||{};e=new i(n)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}var P1=class{constructor(e=null,r={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new M1(e,this.options);for(let i of this.options.recognizers){let{recognizer:n,recognizeWith:o,requireFailure:a}=Tre(i);this.manager.add(n),o&&n.recognizeWith(o),a&&n.requireFailure(a)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new vv(e,this._onOtherEvent,{enable:!1}),this.moveInput=new wv(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Tv(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new Ev(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,i){this._addEventHandler(e,r,i,!1)}once(e,r,i){this._addEventHandler(e,r,i,!0)}watch(e,r,i){this._addEventHandler(e,r,i,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){let{manager:i}=this;if(!i)return;let n=i.get(e);n&&(n.set({enable:r}),i.touchAction.update()),this.wheelInput?.enableEventType(e,r),this.moveInput?.enableEventType(e,r),this.keyInput?.enableEventType(e,r),this.contextmenuInput?.enableEventType(e,r)}_addEventHandler(e,r,i,n,o){if(typeof e!="string"){i=r;for(let[p,x]of Object.entries(e))this._addEventHandler(p,x,i,n,o);return}let{manager:a,events:c}=this;if(!a)return;let h=c.get(e);if(!h){let p=this._getRecognizerName(e)||e;h=new Cv(this,p),c.set(e,h),a&&a.on(e,h.handleEvent)}h.add(e,r,i,n,o),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(let[o,a]of Object.entries(e))this._removeEventHandler(o,a);return}let{events:i}=this,n=i.get(e);if(n&&(n.remove(e,r),n.isEmpty())){let{recognizerName:o}=n,a=!1;for(let c of i.values())if(c.recognizerName===o&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(r=>r.getEventNames().includes(e))?.options.event}};var vr={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(vr,"IDENTITY",{get:()=>(cr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var is={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Dn={common:0,meters:1,pixels:2},R1={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},rM={multipan:[Ad,{threshold:10,direction:Xn.Vertical,pointers:2}],pinch:[am,{},null,["multipan"]],pan:[Ad,{threshold:1},["pinch"],["multipan"]],dblclick:[Jp,{event:"dblclick",taps:2}],click:[Jp,{event:"click"},null,["dblclick"]]};function Ere(t,e){if(t===e)return!0;if(Array.isArray(t)){let r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Lu(t){let e={},r;return i=>{for(let n in i)if(!Ere(i[n],e[n])){r=t(i),e=i;break}return r}}var VD=[0,0,0,0],Cre=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],jD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Sre=[0,0,0],GD=[0,0,0],Ire=Lu(Pre);function iM(t,e,r=GD){r.length<3&&(r=[r[0],r[1],0]);let i=r,n,o=!0;switch(e===vr.LNGLAT_OFFSETS||e===vr.METER_OFFSETS?n=r:n=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case is.WEB_MERCATOR:(e===vr.LNGLAT||e===vr.CARTESIAN)&&(n=[0,0,0],o=!1);break;case is.WEB_MERCATOR_AUTO_OFFSET:e===vr.LNGLAT?i=n:e===vr.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case is.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case is.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:o}}function Mre(t,e,r){let{viewMatrixUncentered:i,projectionMatrix:n}=t,{viewMatrix:o,viewProjectionMatrix:a}=t,c=VD,h=VD,p=t.cameraPosition,{geospatialOrigin:x,shaderCoordinateOrigin:T,offsetMode:R}=iM(t,e,r);return R&&(h=t.projectPosition(x||T),p=[p[0]-h[0],p[1]-h[1],p[2]-h[2]],h[3]=1,c=Pa.transformMat4([],h,a),o=i||o,a=Po.multiply([],n,o),a=Po.multiply([],a,Cre)),{viewMatrix:o,viewProjectionMatrix:a,projectionCenter:c,originCommon:h,cameraPosCommon:p,shaderCoordinateOrigin:T,geospatialOrigin:x}}function HD({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:i=vr.DEFAULT,coordinateOrigin:n=GD,autoWrapLongitude:o=!1}){i===vr.DEFAULT&&(i=t.isGeospatial?vr.LNGLAT:vr.CARTESIAN);let a=Ire({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n});return a.wrapLongitude=o,a.modelMatrix=r||jD,a}function Pre({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i}){let{projectionCenter:n,viewProjectionMatrix:o,originCommon:a,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:p}=Mre(t,r,i),x=t.getDistanceScales(),T=[t.width*e,t.height*e],R=Pa.transformMat4([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,k={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:h,commonOrigin:a.slice(0,3),center:n,pseudoMeters:!!t._pseudoMeters,viewportSize:T,devicePixelRatio:e,focalDistance:R,commonUnitsPerMeter:x.unitsPerMeter,commonUnitsPerWorldUnit:x.unitsPerMeter,commonUnitsPerWorldUnit2:Sre,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:jD,cameraPosition:c};if(p){let j=t.getDistanceScales(p);switch(r){case vr.METER_OFFSETS:k.commonUnitsPerWorldUnit=j.unitsPerMeter,k.commonUnitsPerWorldUnit2=j.unitsPerMeter2;break;case vr.LNGLAT:case vr.LNGLAT_OFFSETS:t._pseudoMeters||(k.commonUnitsPerMeter=j.unitsPerMeter),k.commonUnitsPerWorldUnit=j.unitsPerDegree,k.commonUnitsPerWorldUnit2=j.unitsPerDegree2;break;case vr.CARTESIAN:k.commonUnitsPerWorldUnit=[1,1,j.unitsPerMeter[2]],k.commonUnitsPerWorldUnit2=[0,0,j.unitsPerMeter2[2]];break;default:break}}return k}var Rre=Object.keys(vr).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${vr[t]};`).join(""),Bre=Object.keys(is).map(t=>`const PROJECTION_MODE_${t}: i32 = ${is[t]};`).join(""),Lre=Object.keys(Dn).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${Dn[t]};`).join(""),Ore=`${Rre}
${Bre}
${Lre}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,WD=`${Ore}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z\u2011axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`;var Dre=Object.keys(vr).map(t=>`const int COORDINATE_SYSTEM_${t} = ${vr[t]};`).join(""),Fre=Object.keys(is).map(t=>`const int PROJECTION_MODE_${t} = ${is[t]};`).join(""),kre=Object.keys(Dn).map(t=>`const int UNIT_${t.toUpperCase()} = ${Dn[t]};`).join(""),$D=`${Dre}
${Fre}
${kre}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;var Nre={};function zre(t=Nre){return"viewport"in t?HD(t):{}}var lm={name:"project",dependencies:[GI,Av],source:WD,vs:$D,getUniforms:zre,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};var Ure=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Vre=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Bi={name:"project32",dependencies:[lm],source:Ure,vs:Vre};function nM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function md(t,e){let r=Pa.transformMat4([],e,t);return Pa.scale(r,r,1/r[3]),r}function oM(t,e){let r=t%e;return r<0?e+r:r}function B1(t,e,r){return t<e?e:t>r?r:t}function jre(t){return Math.log(t)*Math.LOG2E}var cm=Math.log2||jre;function Sc(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var Ic=Math.PI,qD=Ic/4,Bl=Ic/180,sM=180/Ic,um=512,Sv=4003e4,Ll=85.051129,ZD=1.5;function aM(t){return cm(t)}function ns(t){let[e,r]=t;Sc(Number.isFinite(e)),Sc(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let i=e*Bl,n=r*Bl,o=um*(i+Ic)/(2*Ic),a=um*(Ic+Math.log(Math.tan(qD+n*.5)))/(2*Ic);return[o,a]}function $s(t){let[e,r]=t,i=e/um*(2*Ic)-Ic,n=2*(Math.atan(Math.exp(r/um*(2*Ic)-Ic))-qD);return[i*sM,n*sM]}function lM(t){let{latitude:e}=t;Sc(Number.isFinite(e));let r=Math.cos(e*Bl);return aM(Sv*r)-9}function eA(t){let e=Math.cos(t*Bl);return um/Sv/e}function hm(t){let{latitude:e,longitude:r,highPrecision:i=!1}=t;Sc(Number.isFinite(e)&&Number.isFinite(r));let n=um,o=Math.cos(e*Bl),a=n/360,c=a/o,h=n/Sv/o,p={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[a,c,h],degreesPerUnit:[1/a,1/c,1/h]};if(i){let x=Bl*Math.tan(e*Bl)/o,T=a*x/2,R=n/Sv*x,k=R/c*h;p.unitsPerDegree2=[0,T,R],p.unitsPerMeter2=[k,0,k]}return p}function L1(t,e){let[r,i,n]=t,[o,a,c]=e,{unitsPerMeter:h,unitsPerMeter2:p}=hm({longitude:r,latitude:i,highPrecision:!0}),x=ns(t);x[0]+=o*(h[0]+p[0]*a),x[1]+=a*(h[1]+p[1]*a);let T=$s(x),R=(n||0)+(c||0);return Number.isFinite(n)||Number.isFinite(c)?[T[0],T[1],R]:T}function Iv(t){let{height:e,pitch:r,bearing:i,altitude:n,scale:o,center:a}=t,c=nM();Po.translate(c,c,[0,0,-n]),Po.rotateX(c,c,-r*Bl),Po.rotateZ(c,c,i*Bl);let h=o/e;return Po.scale(c,c,[h,h,h]),a&&Po.translate(c,c,Fs.negate([],a)),c}function cM(t){let{width:e,height:r,altitude:i,pitch:n=0,offset:o,center:a,scale:c,nearZMultiplier:h=1,farZMultiplier:p=1}=t,{fovy:x=jh(ZD)}=t;i!==void 0&&(x=jh(i));let T=x*Bl,R=n*Bl,k=tA(x),j=k;a&&(j+=a[2]*c/Math.cos(R)/r);let q=T*(.5+(o?o[1]:0)/r),Z=Math.sin(q)*j/Math.sin(B1(Math.PI/2-R-q,.01,Math.PI-.01)),re=Math.sin(R)*Z+j,ee=j*10,se=Math.min(re*p,ee);return{fov:T,aspect:e/r,focalDistance:k,near:h,far:se}}function jh(t){return 2*Math.atan(.5/t)*sM}function tA(t){return .5/Math.tan(.5*t*Bl)}function fm(t,e){let[r,i,n=0]=t;return Sc(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),md(e,[r,i,n,1])}function gd(t,e,r=0){let[i,n,o]=t;if(Sc(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return md(e,[i,n,o,1]);let a=md(e,[i,n,0,1]),c=md(e,[i,n,1,1]),h=a[2],p=c[2],x=h===p?0:((r||0)-h)/(p-h);return Ru.lerp([],a,c,x)}function Mv(t){let{width:e,height:r,bounds:i,minExtent:n=0,maxZoom:o=24,offset:a=[0,0]}=t,[[c,h],[p,x]]=i,T=Gre(t.padding),R=ns([c,B1(x,-Ll,Ll)]),k=ns([p,B1(h,-Ll,Ll)]),j=[Math.max(Math.abs(k[0]-R[0]),n),Math.max(Math.abs(k[1]-R[1]),n)],q=[e-T.left-T.right-Math.abs(a[0])*2,r-T.top-T.bottom-Math.abs(a[1])*2];Sc(q[0]>0&&q[1]>0);let Z=q[0]/j[0],re=q[1]/j[1],ee=(T.right-T.left)/2/Z,se=(T.top-T.bottom)/2/re,me=[(k[0]+R[0])/2+ee,(k[1]+R[1])/2+se],Le=$s(me),je=Math.min(o,cm(Math.abs(Math.min(Z,re))));return Sc(Number.isFinite(je)),{longitude:Le[0],latitude:Le[1],zoom:je}}function Gre(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Sc(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}var XD=Math.PI/180;function Pv(t,e=0){let{width:r,height:i,unproject:n}=t,o={targetZ:e},a=n([0,i],o),c=n([r,i],o),h,p,x=t.fovy?.5*t.fovy*XD:Math.atan(.5/t.altitude),T=(90-t.pitch)*XD;return x>T-.01?(h=YD(t,0,e),p=YD(t,r,e)):(h=n([0,0],o),p=n([r,0],o)),[a,c,p,h]}function YD(t,e,r){let{pixelUnprojectionMatrix:i}=t,n=md(i,[e,0,1,1]),o=md(i,[e,t.height,1,1]),c=(r*t.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),h=Ru.lerp([],n,o,c),p=$s(h);return p.push(r),p}var QD=512;function uM(t){let{width:e,height:r,pitch:i=0}=t,{longitude:n,latitude:o,zoom:a,bearing:c=0}=t;(n<-180||n>180)&&(n=oM(n+180,360)-180),(c<-180||c>180)&&(c=oM(c+180,360)-180);let h=cm(r/QD);if(a<=h)a=h,o=0;else{let p=r/2/Math.pow(2,a),x=$s([0,p])[1];if(o<x)o=x;else{let T=$s([0,QD-p])[1];o>T&&(o=T)}}return{width:e,height:r,longitude:n,latitude:o,zoom:a,pitch:i,bearing:c}}var JD=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,$re=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,qre=`
${JD}
${$re}
`,Zre=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Xre=`
${JD}
${Zre}
`,Yre=Lu(tie),Kre=Lu(rie),Qre=[0,0,0,1],Jre=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function eie(t,e){let[r,i,n]=t,o=gd([r,i,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function tie({viewport:t,center:e}){return new wr(t.viewProjectionMatrix).invert().transform(e)}function rie({viewport:t,shadowMatrices:e}){let r=[],i=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,o=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(a=>eie(a,i));for(let a of e){let c=a.clone().translate(new ot(t.center).negate()),h=o.map(x=>c.transform(x)),p=new wr().ortho({left:Math.min(...h.map(x=>x[0])),right:Math.max(...h.map(x=>x[0])),bottom:Math.min(...h.map(x=>x[1])),top:Math.max(...h.map(x=>x[1])),near:Math.min(...h.map(x=>-x[2])),far:Math.max(...h.map(x=>-x[2]))});r.push(p.multiplyRight(a))}return r}function iie(t){let{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};let i=lm.getUniforms(r),n=Yre({viewport:r.viewport,center:i.center}),o=[],a=Kre({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let h=0;h<t.shadowMatrices.length;h++){let p=a[h],x=p.clone().translate(new ot(r.viewport.center).negate());i.coordinateSystem===vr.LNGLAT&&i.projectionMode===is.WEB_MERCATOR?(a[h]=x,o[h]=n):(a[h]=p.clone().multiplyRight(Jre),o[h]=x.transform(n))}let c={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||Qre,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let h=0;h<a.length;h++)c[`viewProjectionMatrix${h}`]=a[h],c[`projectCenter${h}`]=o[h];for(let h=0;h<2;h++)c[`shadow_uShadowMap${h}`]=t.shadowMaps&&t.shadowMaps[h]||t.dummyShadowMap;return c}var Rv={name:"shadow",dependencies:[lm],vs:qre,fs:Xre,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:iie,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}};var Sn={...hv,defaultUniforms:{...hv.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var nie=[Av],oie=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],sie=[];function eF(t){let e=kp.getDefaultShaderAssembler();for(let i of nie)e.addDefaultModule(i);let r=t==="glsl"?oie:sie;for(let i of r)e.addShaderHook(i);return e}var aie=[255,255,255],lie=1,cie=0,Bv=class{constructor(e={}){this.type="ambient";let{color:r=aie}=e,{intensity:i=lie}=e;this.id=e.id||`ambient-${cie++}`,this.color=r,this.intensity=i}};var uie=[255,255,255],hie=1,fie=[0,0,-1],die=0,O1=class{constructor(e={}){this.type="directional";let{color:r=uie}=e,{intensity:i=hie}=e,{direction:n=fie}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${die++}`,this.color=r,this.intensity=i,this.type="directional",this.direction=new ot(n).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}};var D1=class{constructor(e,r={id:"pass"}){let{id:i}=r;this.id=i,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}};var Gh=class extends D1{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[r,i]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,o=e.clearColor??(n?[0,0,0,0]:!1),a=n?1:!1,c=n?0:!1,h=e.colorMask??15,p={viewport:[0,0,r,i]};e.colorMask&&(p.colorMask=h),e.scissorRect&&(p.scissorRect=e.scissorRect);let x=this.device.beginRenderPass({framebuffer:e.target,parameters:p,clearColor:o,clearDepth:a,clearStencil:c});try{return this._drawLayers(x,e)}finally{x.end(),this.device.submit()}}_drawLayers(e,r){let{target:i,shaderModuleProps:n,viewports:o,views:a,onViewportActive:c,clearStack:h=!0}=r;r.pass=r.pass||"unknown",h&&(this._lastRenderIndex=-1);let p=[];for(let x of o){let T=a&&a[x.id];c?.(x);let R=this._getDrawLayerParams(x,r),k=x.subViewports||[x];for(let j of k){let q=this._drawLayersInViewport(e,{target:i,shaderModuleProps:n,viewport:j,view:T,pass:r.pass,layers:r.layers},R);p.push(q)}}return p}_getDrawLayerParams(e,{layers:r,pass:i,isPicking:n=!1,layerFilter:o,cullRect:a,effects:c,shaderModuleProps:h},p=!1){let x=[],T=rF(this._lastRenderIndex+1),R={layer:r[0],viewport:e,isPicking:n,renderPass:i,cullRect:a},k={};for(let j=0;j<r.length;j++){let q=r[j],Z=this._shouldDrawLayer(q,R,o,k),re={shouldDrawLayer:Z};Z&&!p&&(re.shouldDrawLayer=!0,re.layerRenderIndex=T(q,Z),re.shaderModuleProps=this._getShaderModuleProps(q,c,i,h),re.layerParameters={...q.context.deck?.props.parameters,...this.getLayerParameters(q,j,e)}),x[j]=re}return x}_drawLayersInViewport(e,{layers:r,shaderModuleProps:i,pass:n,target:o,viewport:a,view:c},h){let p=pie(this.device,{shaderModuleProps:i,target:o,viewport:a});if(c&&c.props.clear){let T=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:p,scissorRect:p},clearColor:T.color?[0,0,0,0]:!1,clearDepth:T.depth?1:!1}).end()}let x={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:p});for(let T=0;T<r.length;T++){let R=r[T],k=h[T],{shouldDrawLayer:j}=k;if(j&&R.props.pickable&&x.pickableCount++,R.isComposite&&x.compositeCount++,R.isDrawable&&k.shouldDrawLayer){let{layerRenderIndex:q,shaderModuleProps:Z,layerParameters:re}=k;x.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,q),Z.project&&(Z.project.viewport=a),R.context.renderPass=e;try{R._drawLayer({renderPass:e,shaderModuleProps:Z,uniforms:{layerIndex:q},parameters:re})}catch(ee){R.raiseError(ee,`drawing ${R} to ${n}`)}}}return x}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,i){return null}getLayerParameters(e,r,i){return e.props.parameters}_shouldDrawLayer(e,r,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(r))return!1;r.layer=a,a=a.parent}if(i){let c=r.layer.id;if(c in n||(n[c]=i(r)),!n[c])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,i,n){let o=this.device.canvasContext.cssToDeviceRatio(),a=e.internalState?.propsInTransition||e.props,c={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(let h of r)tF(c,h.getShaderModuleProps?.(e,c));return tF(c,this.getShaderModuleProps(e,r,c),n)}};function rF(t=0,e={}){let r={},i=(n,o)=>{let a=n.props._offset,c=n.id,h=n.parent&&n.parent.id,p;if(h&&!(h in e)&&i(n.parent,!1),h in r){let x=r[h]=r[h]||rF(e[h],e);p=x(n,o),r[c]=x}else Number.isFinite(a)?(p=a+(e[h]||0),r[c]=null):p=t;return o&&p>=t&&(t=p+1),e[c]=p,p};return i}function pie(t,{shaderModuleProps:e,target:r,viewport:i}){let n=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,o]=t.canvasContext.getDrawingBufferSize(),a=r?r.height:o,c=i;return[c.x*n,a-(c.y+c.height)*n,c.width*n,c.height*n]}function tF(t,...e){for(let r of e)if(r)for(let i in r)t[i]?Object.assign(t[i],r[i]):t[i]=r[i];return t}var F1=class extends Gh{constructor(e,r){super(e,r);let i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),n=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:n})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let r=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],o=n.width*i,a=n.height*i,c=[1,1,1,1];(o!==r.width||a!==r.height)&&r.resize({width:o,height:a}),super.render({...e,clearColor:c,target:r,pass:"shadow"})}getLayerParameters(e,r,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}};var Aie={color:[255,255,255],intensity:1},iF=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],mie=[0,0,0,200/255],dm=class{constructor(e={}){this.id="lighting-effect",this.shadowColor=mie,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:r,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),i._addDefaultShaderModule(Rv),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(let r in e){let i=e[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:o,shaderModuleProps:{shadow:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){let i=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},n={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(a=>a.getProjectedLight({layer:e})),pointLights:this.pointLights.map(a=>a.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:i,lighting:n,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Rv))}_calculateMatrices(){let e=[];for(let r of this.directionalLights){let i=new wr().lookAt({eye:new ot(r.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){let i=new F1(e);this.shadowPasses[r]=i}}_applyDefaultLights(){let{ambientLight:e,pointLights:r,directionalLights:i}=this;!e&&r.length===0&&i.length===0&&(this.ambientLight=new Bv(Aie),this.directionalLights.push(new O1(iF[0]),new O1(iF[1])))}};var hM=class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:i=1,type:n,padding:o=0,copy:a=!1,initialize:c=!1,maxCount:h}){let p=n||e&&e.constructor||Float32Array,x=r*i+o;if(ArrayBuffer.isView(e)){if(x<=e.length)return e;if(x*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,x)}let T=1/0;h&&(T=h*i+o);let R=this._allocate(p,x,c,T);return e&&a?R.set(e):c||R.fill(0,0,4),this._release(e),R}release(e){this._release(e)}_allocate(e,r,i,n){let o=Math.max(Math.ceil(r*this.opts.overAlloc),1);o>n&&(o=n);let a=this._pool,c=e.BYTES_PER_ELEMENT*o,h=a.findIndex(p=>p.byteLength>=c);if(h>=0){let p=new e(a.splice(h,1)[0],0,o);return i&&p.fill(0),p}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;let r=this._pool,{buffer:i}=e,{byteLength:n}=i,o=r.findIndex(a=>a.byteLength>=n);o<0?r.push(i):(o>0||r.length<this.opts.poolSize)&&r.splice(o,0,i),r.length>this.opts.poolSize&&r.shift()}},Mc=new hM;function Am(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function oF(t,e){let r=t%e;return r<0?e+r:r}function sF(t){return[t[12],t[13],t[14]]}function aF(t){return{left:pm(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:pm(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:pm(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:pm(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:pm(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:pm(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}var nF=new ot;function pm(t,e,r,i){nF.set(t,e,r);let n=nF.len();return{distance:i/n,normal:new ot(-t/n,-e/n,-r/n)}}function gie(t){return t-Math.fround(t)}var k1;function Lv(t,e){let{size:r=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:t.length,o=(n-i)/r;k1=Mc.allocate(k1,o,{type:Float32Array,size:r*2});let a=i,c=0;for(;a<n;){for(let h=0;h<r;h++){let p=t[a++];k1[c+h]=p,k1[c+h+r]=gie(p)}c+=r*2}return k1.subarray(0,o*r*2)}function lF(t){let e=null,r=!1;for(let i of t)i&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}var _ie=Math.PI/180,yie=Am(),cF=[0,0,0],xie={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function bie({width:t,height:e,orthographic:r,fovyRadians:i,focalDistance:n,padding:o,near:a,far:c}){let h=t/e,p=r?new wr().orthographic({fovy:i,aspect:h,focalDistance:n,near:a,far:c}):new wr().perspective({fovy:i,aspect:h,near:a,far:c});if(o){let{left:x=0,right:T=0,top:R=0,bottom:k=0}=o,j=xs((x+t-T)/2,0,t)-t/2,q=xs((R+e-k)/2,0,e)-e/2;p[8]-=j*2/t,p[9]+=q*2/e}return p}var Ov=class t{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||xie,this.focalDistance=e.focalDistance||1,this.position=e.position||cF,this.modelMatrix=e.modelMatrix||null;let{longitude:r,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?is.WEB_MERCATOR:is.WEB_MERCATOR_AUTO_OFFSET:is.IDENTITY}equals(e){return e instanceof t?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Wo(e.projectionMatrix,this.projectionMatrix)&&Wo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){let i=this.projectPosition(e),n=fm(i,this.pixelProjectionMatrix),[o,a]=n,c=r?a:this.height-a;return e.length===2?[o,c]:[o,c,n[2]]}unproject(e,{topLeft:r=!0,targetZ:i}={}){let[n,o,a]=e,c=r?o:this.height-o,h=i&&i*this.distanceScales.unitsPerMeter[2],p=gd([n,c,a],this.pixelUnprojectionMatrix,h),[x,T,R]=this.unprojectPosition(p);return Number.isFinite(a)?[x,T,R]:Number.isFinite(i)?[x,T,i]:[x,T]}projectPosition(e){let[r,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,n]}unprojectPosition(e){let[r,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,n]}projectFlat(e){if(this.isGeospatial){let r=ns(e);return r[1]=xs(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?$s(e):e}getBounds(e={}){let r={targetZ:e.z||0},i=this.unproject([0,0],r),n=this.unproject([this.width,0],r),o=this.unproject([0,this.height],r),a=this.unproject([this.width,this.height],r);return[Math.min(i[0],n[0],o[0],a[0]),Math.min(i[1],n[1],o[1],a[1]),Math.max(i[0],n[0],o[0],a[0]),Math.max(i[1],n[1],o[1],a[1])]}getDistanceScales(e){return e&&this.isGeospatial?hm({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:i=1,height:n=1}){return e<this.x+this.width&&this.x<e+i&&r<this.y+this.height&&this.y<r+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,aF(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){let r=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=lM({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||hm({latitude:i,longitude:r}));let n=Math.pow(2,this.zoom);this.scale=n;let{position:o,modelMatrix:a}=e,c=cF;if(o&&(c=a?new wr(a).transformAsVector(o,[]):o),this.isGeospatial){let h=this.projectPosition([r,i,0]);this.center=new ot(c).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(c)}_initMatrices(e){let{viewMatrix:r=yie,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:o,fovy:a=75,near:c=.1,far:h=1e3,padding:p=null,focalDistance:x=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new wr().multiplyRight(r).translate(new ot(this.center).negate()),this.projectionMatrix=i||bie({width:this.width,height:this.height,orthographic:n,fovyRadians:o||a*_ie,focalDistance:x,padding:p,near:c,far:h});let T=Am();Po.multiply(T,T,this.projectionMatrix),Po.multiply(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=Po.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=sF(this.viewMatrixInverse);let R=Am(),k=Am();Po.scale(R,R,[this.width/2,-this.height/2,1]),Po.translate(R,R,[1,-1,0]),Po.multiply(k,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=Po.invert(Am(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||cr.warn("Pixel project matrix not invertible")()}};Ov.displayName="Viewport";var ol=Ov;var Dv=class t extends ol{constructor(e={}){let{latitude:r=0,longitude:i=0,zoom:n=0,pitch:o=0,bearing:a=0,nearZMultiplier:c=.1,farZMultiplier:h=1.01,nearZ:p,farZ:x,orthographic:T=!1,projectionMatrix:R,repeat:k=!1,worldOffset:j=0,position:q,padding:Z,legacyMeterSizes:re=!1}=e,{width:ee,height:se,altitude:me=1.5}=e,Le=Math.pow(2,n);ee=ee||1,se=se||1;let je,Je=null;if(R)me=R[5]/2,je=jh(me);else{e.fovy?(je=e.fovy,me=tA(je)):je=jh(me);let te;if(Z){let{top:X=0,bottom:ye=0}=Z;te=[0,xs((X+se-ye)/2,0,se)-se/2]}Je=cM({width:ee,height:se,scale:Le,center:q&&[0,0,q[2]*eA(r)],offset:te,pitch:o,fovy:je,nearZMultiplier:c,farZMultiplier:h}),Number.isFinite(p)&&(Je.near=p),Number.isFinite(x)&&(Je.far=x)}let J=Iv({height:se,pitch:o,bearing:a,scale:Le,altitude:me});j&&(J=new wr().translate([512*j,0,0]).multiplyLeft(J)),super({...e,width:ee,height:se,viewMatrix:J,longitude:i,latitude:r,zoom:n,...Je,fovy:je,focalDistance:me}),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=o,this.bearing=a,this.altitude=me,this.fovy=je,this.orthographic=T,this._subViewports=k?[]:null,this._pseudoMeters=re,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),r=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=r;n<=i;n++){let o=n?new t({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[r,i]=this.projectFlat(e),n=(e[2]||0)*eA(e[1]);return[r,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[r,i]=this.unprojectFlat(e),n=(e[2]||0)/eA(i);return[r,i,n]}addMetersToLngLat(e,r){return L1(e,r)}panByPosition(e,r){let i=gd(r,this.pixelUnprojectionMatrix),n=this.projectFlat(e),o=Ru.add([],n,Ru.negate([],i)),a=Ru.add([],this.center,o),[c,h]=this.unprojectFlat(a);return{longitude:c,latitude:h}}getBounds(e={}){let r=Pv(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){let{width:i,height:n}=this,{longitude:o,latitude:a,zoom:c}=Mv({width:i,height:n,bounds:e,...r});return new t({width:i,height:n,longitude:o,latitude:a,zoom:c})}};Dv.displayName="WebMercatorViewport";var Ou=Dv;var uF=[0,0,0];function fM(t,e,r=!1){let i=e.projectPosition(t);if(r&&e instanceof Ou){let[n,o,a=0]=t,c=e.getDistanceScales([n,o]);i[2]=a*c.unitsPerMeter[2]}return i}function vie(t){let{viewport:e,modelMatrix:r,coordinateOrigin:i}=t,{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:a}=t;return n===vr.DEFAULT&&(n=e.isGeospatial?vr.LNGLAT:vr.CARTESIAN),o===void 0&&(o=n),a===void 0&&(a=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:o,fromCoordinateOrigin:a}}function dM(t,{viewport:e,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:o}){let[a,c,h=0]=t;switch(r&&([a,c,h]=Pa.transformMat4([],[a,c,h,1],r)),i){case vr.LNGLAT:return fM([a,c,h],e,o);case vr.LNGLAT_OFFSETS:return fM([a+n[0],c+n[1],h+(n[2]||0)],e,o);case vr.METER_OFFSETS:return fM(L1(n,[a,c,h]),e,o);case vr.CARTESIAN:default:return e.isGeospatial?[a+n[0],c+n[1],h+n[2]]:e.projectPosition([a,c,h])}}function hF(t,e){let{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:a,fromCoordinateOrigin:c}=vie(e),{autoOffset:h=!0}=e,{geospatialOrigin:p=uF,shaderCoordinateOrigin:x=uF,offsetMode:T=!1}=h?iM(r,i,n):{},R=dM(t,{viewport:r,modelMatrix:o,coordinateSystem:a,coordinateOrigin:c,offsetMode:T});if(T){let k=r.projectPosition(p||x);Fs.sub(R,R,k)}return R}var wie=1,Tie=1,rA=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=e,a=wie++,c={time:0,delay:r,duration:i,rate:n,repeat:o};return this._setChannelTime(c,this.time),this.channels.set(a,c),a}removeChannel(e){this.channels.delete(e);for(let[r,i]of this.animations)i.channel===e&&this.detachAnimation(r)}isFinished(e){let r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;let r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);let r=this.channels.values();for(let n of r)this._setChannelTime(n,this.time);let i=this.animations.values();for(let n of i){let{animation:o,channel:a}=n;o.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){let i=Tie++;return this.animations.set(i,{animation:e,channel:r}),e.setTime(this.getTime(r)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){let i=r-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}};function fF(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function dF(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var Eie=0,Cie={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:$0.stats.get(`animation-loop-${Eie++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},N1=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Cie,...e},e=this.props,!e.device)throw new Error("No device provided");let{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new Gs({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){let i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){let r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=fF(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(dF(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:r,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);let i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,r]=this.device?.canvasContext?.getPixelSize()||[1,1],i=1,n=this.device?.canvasContext?.canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&r>0&&(i=e/r),{width:e,height:r,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};var pM={};function Ol(t="id"){pM[t]=pM[t]||1;let e=pM[t]++;return`${t}-${e}`}var Fv=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Ol("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&qi.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(let e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}};function pF(t,e){if(e instanceof Fv)return e;let r=Sie(t,e),{attributes:i,bufferLayout:n}=Iie(t,e);return new Fv({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:r,attributes:i})}function Sie(t,e){if(!e.indices)return;let r=e.indices.value;return t.createBuffer({usage:qi.INDEX,data:r})}function Iie(t,e){let r=[],i={};for(let[o,a]of Object.entries(e.attributes)){let c=o;switch(o){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(a){i[c]=t.createBuffer({data:a.value,id:`${o}-buffer`});let{value:h,size:p,normalized:x}=a;r.push({name:c,format:SS(h,p,x)})}}let n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:r,vertexCount:n}}var kv=class t{static defaultProps={...Su.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new t(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){let r={...Su.defaultProps,...e},i=this._hashRenderPipeline(r);if(!this._renderPipelineCache[i]){let n=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._renderPipelineCache[i]={pipeline:n,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){let r={...q0.defaultProps,...e},i=this._hashComputePipeline(r);if(!this._computePipelineCache[i]){let n=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._computePipelineCache[i]={pipeline:n,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){let r=e.hash,i=e instanceof q0?this._computePipelineCache:this._renderPipelineCache;i[r].useCount--,i[r].useCount===0&&this.destroyPolicy==="unused"&&(i[r].pipeline.destroy(),delete i[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){let r=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,n="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${i}V${n}BL${o}`;default:let a=this._getHash(JSON.stringify(e.parameters));return`${r}/${i}V${n}T${e.topology}P${a}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};var Nv=class t{static defaultProps={...zp.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new t(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){let r=this._hashShader(e),i=this._cache[r];if(!i){let n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=i={shader:n,useCount:0}}return i.useCount++,i.shader}release(e){let r=this._hashShader(e),i=this._cache[r];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};function AF(t,e){let r={},i="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(let n of t.attributes)if(n){let o=`${n.location} ${n.name}: ${n.type}`;r[`in ${o}`]={[i]:n.stepMode||"vertex"}}for(let n of t.varyings||[]){let o=`${n.location} ${n.name}`;r[`out ${o}`]={[i]:JSON.stringify(n)}}return r}var vs=null,AM=null;function mF(t,{id:e,minimap:r,opaque:i,top:n="0",left:o="0",rgbaScale:a=1}){vs||(vs=document.createElement("canvas"),vs.id=e,vs.title=e,vs.style.zIndex="100",vs.style.position="absolute",vs.style.top=n,vs.style.left=o,vs.style.border="blue 5px solid",vs.style.transform="scaleY(-1)",document.body.appendChild(vs),AM=vs.getContext("2d")),(vs.width!==t.width||vs.height!==t.height)&&(vs.width=t.width/2,vs.height=t.height/2,vs.style.width="400px",vs.style.height="400px");let c=t.device.readPixelsToArrayWebGL(t),h=AM?.createImageData(t.width,t.height);if(h){for(let x=0;x<c.length;x+=4)h.data[0+x+0]=c[x+0]*a,h.data[0+x+1]=c[x+1]*a,h.data[0+x+2]=c[x+2]*a,h.data[0+x+3]=i?255:c[x+3]*a;AM?.putImageData(h,0,0)}}function zv(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!zv(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let o of i)if(!e.hasOwnProperty(o)||!zv(t[o],e[o],r-1))return!1;return!0}return!1}function gF(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function _F(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function z1(t){return gF(t)||_F(t)}function Mie(t){return z1(t)||typeof t=="number"||typeof t=="boolean"}function Uv(t){let e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{let i=t[r];Mie(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}var Vv=class{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,r){Object.assign(this.options,r);let i=H0(Object.values(e).filter(n=>n.dependencies));for(let n of i)e[n.name]=n;Vt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(let[n,o]of Object.entries(e))this._addModule(o),o.name&&n!==o.name&&!this.options.disableWarnings&&Vt.warn(`Module name: ${n} vs ${o.name}`)()}destroy(){}setProps(e){for(let r of Object.keys(e)){let i=r,n=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||Vt.warn(`Module ${r} not found`)();continue}let a=this.moduleUniforms[i],c=this.moduleBindings[i],h=o.getUniforms?.(n,a)||n,{uniforms:p,bindings:x}=Uv(h);this.moduleUniforms[i]={...a,...p},this.moduleBindings[i]={...c,...x}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){let e={};for(let[r,i]of Object.entries(this.moduleUniforms))for(let[n,o]of Object.entries(i))e[`${r}.${n}`]={type:this.modules[r].uniformTypes?.[n],value:String(o)};return e}_addModule(e){let r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}};var Pie="";async function yF(t,e){let r=new Image;return r.crossOrigin=e?.crossOrigin||"anonymous",r.src=t.startsWith("http")?t:Pie+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}var mm=class{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,r){this.device=e,this.id=r.id||Ol("async-texture"),typeof r?.data=="string"&&r.dimension==="2d"&&(r={...r,data:yF(r.data)}),this.ready=new Promise((i,n)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=n}),this.initAsync(r)}async initAsync(e){let r=e.data,i;try{i=await xF(r)}catch(o){this.rejectReady(o)}if(this.destroyed)return;let n={...e,data:i};this.texture=this.device.createTexture(n),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}};async function xF(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(xF));if(t&&typeof t=="object"&&t.constructor===Object){let e=t,r=await Promise.all(Object.values(e)),i=Object.keys(e),n={};for(let o=0;o<i.length;o++)n[i[o]]=r[o];return n}return t}var iA=2,Rie=1e4,di=class t{static defaultProps={...Su.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:kp.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,r){this.props={...t.defaultProps,...r},r=this.props,this.id=r.id||Ol("model"),this.device=e,Object.assign(this.userData,r.userData);let i=Object.fromEntries(this.props.modules?.map(h=>[h.name,h])||[]),n=r.shaderInputs||new Vv(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(n);let o=Lie(e),a=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){let{source:h,getUniforms:p}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:a});this.source=h,this._getModuleUniforms=p,this.props.shaderLayout||=QS(this.source)}else{let{vs:h,fs:p,getUniforms:x}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:a});this.vs=h,this.fs=p,this._getModuleUniforms=x}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||kv.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||Nv.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let r=this._areBindingsLoading();if(r)return Vt.info(iA,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let n=this._getBindings();this.pipeline.setBindings(n,{disableWarnings:this.props.disableWarnings}),mM(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:o}=this.vertexArray,a=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();let r=e&&pF(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");let i=new jp(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let r=new jp(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){zv(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new o1(this.shaderInputs.modules);for(let[r,i]of Object.entries(this.shaderInputs.modules))if(Bie(i)){let n=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){let i=r?.disableWarnings??this.props.disableWarnings;e.indices&&Vt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=IS(this.pipeline.shaderLayout,this.bufferLayout);let n=new jp(this.bufferLayout);for(let[o,a]of Object.entries(e)){let c=n.getBufferLayout(o);if(!c){i||Vt.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}let h=n.getAttributeNamesForBuffer(c),p=!1;for(let x of h){let T=this._attributeInfos[x];if(T){let R=this.device.type==="webgpu"?n.getBufferIndex(T.bufferName):T.location;this.vertexArray.setBuffer(R,a),p=!0}}!p&&!i&&Vt.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(let[i,n]of Object.entries(e)){let o=this._attributeInfos[i];o?this.vertexArray.setConstantWebGL(o.location,n):(r?.disableWarnings??this.props.disableWarnings)||Vt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){mM(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){let{bindings:r,uniforms:i}=Uv(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof mm&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[r,i]of Object.entries(this.bindings))i instanceof mm?i.isReady&&(e[r]=i.texture):e[r]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(let r of Object.values(this.bindings))r instanceof Np?e=Math.max(e,r.texture.updateTimestamp):r instanceof qi||r instanceof on?e=Math.max(e,r.updateTimestamp):r instanceof mm?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof Up||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let r={...e.attributes};for(let[i]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete r[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(Vt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:n}),this._attributeInfos=_b(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=Vt.level>3?0:Rie;Vt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Vt.group(iA,`>>> DRAWING MODEL ${this.id}`,{collapsed:Vt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=AF(this.pipeline.shaderLayout,this.id);Vt.table(iA,e)();let r=this.shaderInputs.getDebugTable();for(let[n,o]of Object.entries(this.uniforms))r[n]={value:o};Vt.table(iA,r)();let i=this._getAttributeDebugTable();Vt.table(iA,this._attributeInfos)(),Vt.table(iA,i)(),Vt.groupEnd(iA)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;let i=e.props.framebuffer;i&&mF(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[r,i]of Object.entries(this._attributeInfos)){let n=this.vertexArray.attributes[i.location];e[i.location]={name:r,type:i.shaderType,values:n?this._getBufferOrConstantValues(n,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,i=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,r){let i=s1(r);return(e instanceof qi?new i(e.debugData):e).toString()}};function Bie(t){return!!(t.uniformTypes&&!mM(t.uniformTypes))}function Lie(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function mM(t){for(let e in t)return!1;return!0}var Du=class t{device;model;transformFeedback;static defaultProps={...di.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=t.defaultProps){if(!t.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new di(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||q_(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof qi)return r.readAsync();let{buffer:i,byteOffset:n=0,byteLength:o=i.byteLength}=r;return i.readAsync(n,o)}};var Oie="transform_output",gm=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,r){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new di(this.device,{id:r.id||"texture-transform-model",fs:r.fs||q_({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:Oie}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(let e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){let{framebuffer:r}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:r,...e});this.model.draw(i),i.end()}getTargetTexture(){let{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:r,sourceTextures:i,targetTexture:n}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),n){e.targetTexture=n;let{width:o,height:a}=n;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:a,colorAttachments:[n]}),e.framebuffer.resize({width:o,height:a})}return e}_setSourceTextureParameters(){let e=this.currentIndex,{sourceTextures:r}=this.bindings[e];for(let i in r)r[i].sampler=this.sampler}};var Qi=class{id;topology;vertexCount;indices;attributes;userData={};constructor(e){let{attributes:r={},indices:i=null,vertexCount:n=null}=e;this.id=e.id||Ol("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(let[o,a]of Object.entries(r)){let c=ArrayBuffer.isView(a)?{value:a}:a;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!c.size&&(c.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[o]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let i=1/0;for(let n of Object.values(e)){let{value:o,size:a,constant:c}=n;!c&&o&&a!==void 0&&a>=1&&(i=Math.min(i,o.length/a))}return i}};var Fu=class{id;matrix=new wr;display=!0;position=new ot;rotation=new ot;scale=new ot(1,1,1);userData={};props={};constructor(e={}){let{id:r}=e;this.id=r||Ol(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:r,rotation:i,scale:n,update:o=!0}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){let e=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(e={}){let{position:r,rotation:i,scale:n}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,r){r=r||this.matrix;let i=new wr(e).multiplyRight(r),n=i.invert(),o=n.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}};var Hh=class t extends Fu{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;let{children:r=[]}=e;Vt.assert(r.every(i=>i instanceof Fu),"every child must an instance of ScenegraphNode"),super(e),this.children=r}getBounds(){let e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:i})=>{let n=r.getBounds();if(!n)return;let[o,a]=n,c=new ot(o).add(a).divide([2,2,2]);i.transformAsPoint(c,c);let h=new ot(a).subtract(o).divide([2,2,2]);i.transformAsVector(h,h);for(let p=0;p<8;p++){let x=new ot(p&1?-1:1,p&2?-1:1,p&4?-1:1).multiply(h).add(c);for(let T=0;T<3;T++)e[0][T]=Math.min(e[0][T],x[T]),e[1][T]=Math.max(e[1][T],x[T])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(let r of e)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){let r=this.children,i=r.indexOf(e);return i>-1&&r.splice(i,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:r=new wr}={}){let i=new wr(r).multiplyRight(this.matrix);for(let n of this.children)n instanceof t?n.traverse(e,{worldMatrix:i}):e(n,{worldMatrix:i})}};var _d=class extends Fu{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}};var nA=class extends Qi{constructor(e={}){let{id:r=Ol("cube-geometry"),indices:i=!0}=e;super(i?{...e,id:r,topology:"triangle-list",indices:{size:1,value:Die},attributes:{...jie,...e.attributes}}:{...e,id:r,topology:"triangle-list",indices:void 0,attributes:{...Gie,...e.attributes}})}},Die=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Fie=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),kie=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Nie=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),zie=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),Uie=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),Vie=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),jie={POSITION:{size:3,value:Fie},NORMAL:{size:3,value:kie},TEXCOORD_0:{size:2,value:Nie}},Gie={POSITION:{size:3,value:zie},TEXCOORD_0:{size:2,value:Uie},COLOR_0:{size:3,value:Vie}};var Hie={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},oA=class extends Gh{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:o,pickingFBO:a,deviceRect:{x:c,y:h,width:p,height:x},cullRect:T,effects:R,pass:k="picking",pickZ:j,shaderModuleProps:q}){this.pickZ=j;let Z=this._resetColorEncoder(j),re=[c,h,p,x],ee=super.render({target:a,layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:o,cullRect:T,effects:R?.filter(me=>me.useInPicking),pass:k,isPicking:!0,shaderModuleProps:q,clearColor:[0,0,0,0],colorMask:15,scissorRect:re});return this._colorEncoderState=null,{decodePickingColor:Z&&$ie.bind(null,Z),stats:ee}}shouldDrawLayer(e){let{pickable:r,operation:i}=e.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,r,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,i){let n={...e.props.parameters},{pickable:o,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?n.blend=!1:o&&a.includes("draw")&&(Object.assign(n,Hie),n.blend=!0,n.blendColor=Wie(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function Wie(t,e,r){let{byLayer:i,byAlpha:n}=t,o,a=i.get(e);return a?(a.viewports.push(r),o=a.a):(o=i.size+1,o<=255?(a={a:o,layer:e,viewports:[r]},i.set(e,a),n[o]=a):(cr.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function $ie(t,e){let r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}var yd={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},_m=Symbol.for("component"),Dl=Symbol.for("propTypes"),jv=Symbol.for("deprecatedProps"),Wh=Symbol.for("asyncPropDefaults"),ku=Symbol.for("asyncPropOriginal"),Pc=Symbol.for("asyncPropResolved");function Ra(t,e=()=>!0){return Array.isArray(t)?bF(t,e,[]):e(t)?[t]:[]}function bF(t,e,r){let i=-1;for(;++i<t.length;){let n=t[i];Array.isArray(n)?bF(n,e,r):e(n)&&r.push(n)}return r}function gM({target:t,source:e,start:r=0,count:i=1}){let n=e.length,o=i*n,a=0;for(let c=r;a<n;a++)t[c++]=e[a];for(;a<o;)a<o-a?(t.copyWithin(r+a,r,r+a),a*=2):(t.copyWithin(r+a,r,r+o-a),a=o);return t}var U1=class{constructor(e,r,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;let i=++this._loadCount,n=e;typeof e=="string"&&(n=ys(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(let o of this._subscribers)o.onChange(this.getData())}};var V1=class{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:i=!1,persistent:n=!0}){let o=this._resources[e];o?o.setData(r,i):(o=new U1(e,r,this._context),this._resources[e]=o),o.persistent=n}remove(e){let r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let r=this._consumers[e];if(r){for(let i in r){let n=r[i],o=this._resources[n.resourceId];o&&o.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:i,requestId:n="default"}){let{_resources:o,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));let c=o[e];if(this._track(i,n,c,r),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,r,i,n){let o=this._consumers,a=o[e]=o[e]||{},c=a[r],h=c&&c.resourceId&&this._resources[c.resourceId];h&&(h.unsubscribe(c),this.prune()),i&&(c?(c.onChange=n,c.resourceId=i.id):c={onChange:n,resourceId:i.id},a[r]=c,i.subscribe(c))}_prune(){this._pruneRequest=null;for(let e of Object.keys(this._resources)){let r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}};var qie="layerManager.setLayers",Zie="layerManager.activateViewport",j1=class{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{mo(Zie,this,c),c&&(this.context.viewport=c)};let{deck:i,stats:n,viewport:o,timeline:a}=r||{};this.layers=[],this.resourceManager=new V1({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:eF(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[qI],renderPass:void 0,stats:n||new Gs({id:"deck.gl"}),viewport:o||new ol({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new rA,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(let i of this.layers){let n=i.getNeedsRedraw(e);r=r||n}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){mo(qie,this,r,e),this._lastRenderedLayers=e;let i=Ra(e,Boolean);for(let n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:r}=this.context;r.find(i=>i.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:r}=this.context,i=r.findIndex(n=>n.name===e.name);i>=0&&(r.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,i){i.raiseError(r,`${e} of ${i}`)}_updateLayers(e,r){let i={};for(let a of e)i[a.id]?cr.warn(`Multiple old layers with same id ${a.id}`)():i[a.id]=a;if(this._defaultShaderModulesChanged){for(let a of e)a.setNeedsUpdate(),a.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let n=[];this._updateSublayersRecursively(r,i,n),this._finalizeOldLayers(i);let o=!1;for(let a of n)if(a.hasUniformTransition()){o=`Uniform transition in ${a}`;break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,r,i){for(let n of e){n.context=this.context;let o=r[n.id];o===null&&cr.warn(`Multiple new layers with same id ${n.id}`)(),r[n.id]=null;let a=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),a=n.isComposite?n.getSubLayers():null}catch(c){this._handleError("matching",c,n)}a&&this._updateSublayersRecursively(a,r,i)}}_finalizeOldLayers(e){for(let r in e){let i=e[r];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=yd.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=yd.MATCHED,r!==e&&(e.lifecycle=yd.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=yd.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=yd.FINALIZED}catch(r){this._handleError("finalization",r,e)}}};function An(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!An(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let o of i)if(!e.hasOwnProperty(o)||!An(t[o],e[o],r-1))return!1;return!0}return!1}var G1=class{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){let r=typeof e=="string"?this.getView(e):e,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,r){let i=this.getViewports(),n={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){let a=i[o];if(a.containsPixel(n)){let c=e.slice();return c[0]-=a.x,c[1]-=a.y,a.unproject(c,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Ra(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!An(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):cr.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){let i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(e.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(e,r,i,n){let o=e.controller;if(o&&i){let a={...r,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==o.type)&&(n=this._createController(e,a)),n&&n.setProps(a),n}return null}_rebuildViewports(){let{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){let o=e[n],a=this.getViewState(o),c=o.makeViewport({viewState:a,width:this.width,height:this.height}),h=r[o.id],p=!!o.controller;p&&!h&&(i=!0),(i||!p)&&h&&(h.finalize(),h=null),this.controllers[o.id]=this._updateController(o,a,c,h),c&&this._viewports.unshift(c)}for(let n in r){let o=r[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((i,n)=>!e[n].equals(r[n]))}};var Xie=/([0-9]+\.?[0-9]*)(%|px)/;function $h(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":let e=Xie.exec(t);if(e&&e.length>=3){let r=e[2]==="%",i=parseFloat(e[1]);return{position:r?i/100:i,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function qh(t,e){return t.relative?Math.round(t.position*e):t.position}var sA=class{constructor(e){let{id:r,x:i=0,y:n=0,width:o="100%",height:a="100%",padding:c=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=$h(i),this._y=$h(n),this._width=$h(o),this._height=$h(a),this._padding=c&&{left:$h(c.left||0),right:$h(c.right||0),top:$h(c.top||0),bottom:$h(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&An(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:i}){i=this.filterViewState(i);let n=this.getDimensions({width:e,height:r});if(!n.height||!n.width)return null;let o=this.getViewportType(i);return new o({...i,...this.props,...n})}getViewStateId(){let{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...e};for(let i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return e}getDimensions({width:e,height:r}){let i={x:qh(this._x,e),y:qh(this._y,r),width:qh(this._width,e),height:qh(this._height,r)};return this._padding&&(i.padding={left:qh(this._padding.left,e),top:qh(this._padding.top,r),right:qh(this._padding.right,e),bottom:qh(this._padding.bottom,r)}),i}get controller(){let e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}};var Rc=class{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var vF=()=>{},_M={BREAK:1,SNAP_TO_END:2,IGNORE:3},Yie=t=>t,Kie=_M.BREAK,H1=class{constructor(e){this._onTransitionUpdate=r=>{let{time:i,settings:{interpolator:n,startProps:o,endProps:a,duration:c,easing:h}}=r,p=h(i/c),x=n.interpolateProps(o,a,p);this.propsInTransition=this.getControllerState({...this.props,...x}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Rc(e.timeline),this.onViewStateChange=e.onViewStateChange||vF,this.onStateChange=e.onStateChange||vF}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){let{interruption:o,endProps:a}=this.transition.settings;n={...i,...o===_M.SNAP_TO_END?a:this.propsInTransition||i}}this._triggerTransition(n,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:r,transitionInterpolator:i}=e;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===_M.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){let i=this.getControllerState(e),n=this.getControllerState(r).shortestPathFrom(i),o=r.transitionInterpolator,a=o.getDuration?o.getDuration(e,r):r.transitionDuration;if(a===0)return;let c=o.initializeProps(e,n);this.propsInTransition={};let h={duration:a,easing:r.transitionEasing||Yie,interpolator:o,interruption:r.transitionInterruption||Kie,startProps:c.start,endProps:c.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}};function yn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}var W1=class{constructor(e){let{compare:r,extract:i,required:n}=e;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=n}arePropsEqual(e,r){for(let i of this._propsToCompare)if(!(i in e)||!(i in r)||!Wo(e[i],r[i]))return!1;return!0}initializeProps(e,r){let i={},n={};for(let o of this._propsToExtract)(o in e||o in r)&&(i[o]=e[o],n[o]=r[o]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{let i=e[r];yn(Number.isFinite(i)||Array.isArray(i),`${r} is required for transition`)})}};var Qie=["longitude","latitude","zoom","bearing","pitch"],Jie=["longitude","latitude","zoom"],Zh=class extends W1{constructor(e={}){let r=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:Qie,required:Jie},super(i.transitionProps),this.opts=i}initializeProps(e,r){let i=super.initializeProps(e,r),{makeViewport:n,around:o}=this.opts;if(n&&o){let a=n(e),c=n(r),h=a.unproject(o);i.start.around=o,Object.assign(i.end,{around:c.project(h),aroundPosition:h,width:r.width,height:r.height})}return i}interpolateProps(e,r,i){let n={};for(let o of this._propsToExtract)n[o]=Ds(e[o]||0,r[o]||0,i);if(r.aroundPosition&&this.opts.makeViewport){let o=this.opts.makeViewport({...r,...n});Object.assign(n,o.panByPosition(r.aroundPosition,Ds(e.around,r.around,i)))}return n}};var xd={transitionDuration:0},ene=300,Gv=t=>1-(1-t)*(1-t),ym={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},aA={},lA=class{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new H1({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:r,y:i}=this.props,{offsetCenter:n}=e;return[n.x-r,n.y-i]}isPointInBounds(e,r){let{width:i,height:n}=this.props;if(r&&r.handled)return!1;let o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return o&&r&&r.stopPropagation(),o}isFunctionKeyPressed(e){let{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?ene:0;let{scrollZoom:i=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:a=!0,touchZoom:c=!0,touchRotate:h=!1,keyboard:p=!0}=e,x=!!this.onViewStateChange;this.toggleEvents(ym.WHEEL,x&&i),this.toggleEvents(ym.PAN,x),this.toggleEvents(ym.PINCH,x&&(c||h)),this.toggleEvents(ym.MULTI_PAN,x&&h),this.toggleEvents(ym.DOUBLE_CLICK,x&&a),this.toggleEvents(ym.KEYBOARD,x&&p),this.scrollZoom=i,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=a,this.touchZoom=c,this.touchRotate=h,this.keyboard=p}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,r=null,i={}){let n={...e.getViewportProps(),...r},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){let a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);let n=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(n,xd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;let r=this.getCenter(e),i=this.controllerState.pan({pos:r});return this.updateViewport(i,xd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:r}=this;if(this.dragPan&&r&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Gv},{isDragging:!1,isPanning:!0})}else{let i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let r=this.getCenter(e),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,xd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Gv},{isDragging:!1,isRotating:!0})}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();let{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e,a=2/(1+Math.exp(-Math.abs(o*i)));o<0&&a!==0&&(a=1/a);let c=this.controllerState.zoom({pos:r,scale:a});return this.updateViewport(c,{...this._getTransitionProps({around:r}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,xd,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(e);r[0]-=e.deltaX;let i=this.controllerState.rotate({pos:r});return this.updateViewport(i,xd,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){let i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*r/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:Gv},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return aA._startPinchRotation=e.rotation,aA._lastPinchEvent=e,this.updateViewport(i,xd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:i}=e,n=this.getCenter(e);r=r.zoom({pos:n,scale:i})}if(this.touchRotate){let{rotation:i}=e;r=r.rotate({deltaAngleX:aA._startPinchRotation-i})}return this.updateViewport(r,xd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),aA._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:i}=aA;if(this.touchZoom&&r&&i&&e.scale!==i.scale){let n=this.getCenter(e),o=this.controllerState.rotateEnd(),a=Math.log2(e.scale),c=(a-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),h=Math.pow(2,a+c*r/2);o=o.zoom({pos:n,scale:h}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:Gv},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return aA._startPinchRotation=null,aA._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this,h,p={};switch(e.srcEvent.code){case"Minus":h=r?c.zoomOut(i).zoomOut(i):c.zoomOut(i),p.isZooming=!0;break;case"Equal":h=r?c.zoomIn(i).zoomIn(i):c.zoomIn(i),p.isZooming=!0;break;case"ArrowLeft":r?(h=c.rotateLeft(o),p.isRotating=!0):(h=c.moveLeft(n),p.isPanning=!0);break;case"ArrowRight":r?(h=c.rotateRight(o),p.isRotating=!0):(h=c.moveRight(n),p.isPanning=!0);break;case"ArrowUp":r?(h=c.rotateUp(a),p.isRotating=!0):(h=c.moveUp(n),p.isPanning=!0);break;case"ArrowDown":r?(h=c.rotateDown(a),p.isRotating=!0):(h=c.moveDown(n),p.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),p),!0}_getTransitionProps(e){let{transition:r}=this;return!r||!r.transitionInterpolator?xd:e?{...r,transitionInterpolator:new Zh({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var $1=class{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var wF=5,tne=1.2,q1=class extends $1{constructor(e){let{width:r,height:i,latitude:n,longitude:o,zoom:a,bearing:c=0,pitch:h=0,altitude:p=1.5,position:x=[0,0,0],maxZoom:T=20,minZoom:R=0,maxPitch:k=60,minPitch:j=0,startPanLngLat:q,startZoomLngLat:Z,startRotatePos:re,startBearing:ee,startPitch:se,startZoom:me,normalize:Le=!0}=e;yn(Number.isFinite(o)),yn(Number.isFinite(n)),yn(Number.isFinite(a)),super({width:r,height:i,latitude:n,longitude:o,zoom:a,bearing:c,pitch:h,altitude:p,maxZoom:T,minZoom:R,maxPitch:k,minPitch:j,normalize:Le,position:x},{startPanLngLat:q,startZoomLngLat:Z,startRotatePos:re,startBearing:ee,startPitch:se,startZoom:me}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){let i=this.getState().startPanLngLat||this._unproject(r);if(!i)return this;let o=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:i=0}){let{startRotatePos:n,startBearing:o,startPitch:a}=this.getState();if(!n||o===void 0||a===void 0)return this;let c;return e?c=this._getNewRotation(e,n,a,o):c={bearing:o+r,pitch:a+i},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:i}){let{startZoom:n,startZoomLngLat:o}=this.getState();if(o||(n=this.getViewportProps().zoom,o=this._unproject(r)||this._unproject(e)),!o)return this;let{maxZoom:a,minZoom:c}=this.getViewportProps(),h=n+Math.log2(i);h=xs(h,c,a);let p=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...p.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let r=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:o}=i;return Math.abs(n-r.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(o-r.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){let{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=xs(n,i,r);let{maxPitch:o,minPitch:a,pitch:c}=e;e.pitch=xs(c,a,o);let{normalize:h=!0}=e;return h&&Object.assign(e,uM(e)),e}_zoomFromCenter(e){let{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:e})}_panFromCenter(e){let{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,i,n){let o=e[0]-r[0],a=e[1]-r[1],c=e[1],h=r[1],{width:p,height:x}=this.getViewportProps(),T=o/p,R=0;a>0?Math.abs(x-h)>wF&&(R=a/(h-x)*tne):a<0&&h>wF&&(R=1-c/h),R=xs(R,-1,1);let{minPitch:k,maxPitch:j}=this.getViewportProps(),q=n+180*T,Z=i;return R>0?Z=i+R*(j-i):R<0&&(Z=i-R*(k-i)),{pitch:Z,bearing:q}}},Z1=class extends lA{constructor(){super(...arguments),this.ControllerState=q1,this.transition={transitionDuration:300,transitionInterpolator:new Zh({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};var Hv=class extends sA{constructor(e={}){super(e)}getViewportType(){return Ou}get ControllerType(){return Z1}};Hv.displayName="MapView";var X1=Hv;var rne=new dm;function ine(t,e){let r=t.order??1/0,i=e.order??1/0;return r-i}var Y1=class{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let r=this._defaultEffects;if(!r.find(i=>i.id===e.id)){let i=r.findIndex(n=>ine(n,e)>0);i<0?r.push(e):r.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(An(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){let r={};for(let n of this.effects)r[n.id]=n;let i=[];for(let n of e){let o=r[n.id],a=n;o&&o!==n?o.setProps?(o.setProps(n.props),a=o):o.cleanup(this._context):o||n.setup(this._context),i.push(a),delete r[n.id]}for(let n in r)r[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof dm)||this._resolvedEffects.push(rne),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var K1=class extends Gh{shouldDrawLayer(e){let{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}};var nne="deckRenderer.renderLayers",Q1=class{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new K1(e),this.pickLayersPass=new oA(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);let n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);let o=r.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,mo(nne,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:e}=this;for(let r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let i of e)r.preRenderStats[i.id]=i.preRender(r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{let n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[n]}))});for(let i of e)i.resize(r)}_postRender(e,r){let{renderBuffers:i}=this,n={...r,inputBuffer:i[0],swapBuffer:i[1]};for(let o of e)if(o.postRender){n.target=o.id===this.lastPostProcessEffect?r.target:void 0;let a=o.postRender(n);n.inputBuffer=a,n.swapBuffer=a===i[0]?i[1]:i[0]}}};var one={pickedColor:null,pickedObjectIndex:-1};function TF({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:i,deviceRadius:n,deviceRect:o}){let{x:a,y:c,width:h,height:p}=o,x=n*n,T=-1,R=0;for(let k=0;k<p;k++){let j=k+c-i,q=j*j;if(q>x)R+=4*h;else for(let Z=0;Z<h;Z++){if(t[R+3]-1>=0){let ee=Z+a-r,se=ee*ee+q;se<=x&&(x=se,T=R)}R+=4}}if(T>=0){let k=t.slice(T,T+4),j=e(k);if(j){let q=Math.floor(T/4/h),Z=T/4-q*h;return{...j,pickedColor:k,pickedX:a+Z,pickedY:c+q}}cr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return one}function EF({pickedColors:t,decodePickingColor:e}){let r=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){let o=t.slice(i,i+4),a=o.join(",");if(!r.has(a)){let c=e(o);c?r.set(a,{...c,color:o}):cr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function yM({pickInfo:t,viewports:e,pixelRatio:r,x:i,y:n,z:o}){let a=e[0];e.length>1&&(a=sne(t?.pickedViewports||e,{x:i,y:n}));let c;if(a){let h=[i-a.x,n-a.y];o!==void 0&&(h[2]=o),c=a.unproject(h)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:c,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function CF(t){let{pickInfo:e,lastPickedInfo:r,mode:i,layers:n}=t,{pickedColor:o,pickedLayer:a,pickedObjectIndex:c}=e,h=a?[a]:[];if(i==="hover"){let T=r.index,R=r.layerId,k=a?a.props.id:null;if(k!==R||c!==T){if(k!==R){let j=n.find(q=>q.props.id===R);j&&h.unshift(j)}r.layerId=k,r.index=c,r.info=null}}let p=yM(t),x=new Map;return x.set(null,p),h.forEach(T=>{let R={...p};T===a&&(R.color=o,R.index=c,R.picked=!0),R=xM({layer:T,info:R,mode:i});let k=R.layer;T===a&&i==="hover"&&(r.info=R),x.set(k.id,R),i==="hover"&&k.updateAutoHighlight(R)}),x}function xM({layer:t,info:e,mode:r}){for(;t&&e;){let i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:i}),t=t.parent}return e}function sne(t,e){for(let r=t.length-1;r>=0;r--){let i=t[r];if(i.containsPixel(e))return i}return t[0]}var J1=class{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new oA(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:i,viewports:n},o=this.lastPickedInfo.info){let a=o&&o.layer&&o.layer.id,c=o&&o.viewport&&o.viewport.id,h=a?i.find(R=>R.id===a):null,p=c&&n.find(R=>R.id===c)||n[0],x=p&&p.unproject([e-p.x,r-p.y]);return{...o,...{x:e,y:r,viewport:p,coordinate:x,layer:h}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;let r=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:i,x:n,y:o,radius:a=0,depth:c=1,mode:h="query",unproject3D:p,onViewportActive:x,effects:T}){let R=this.device.canvasContext.cssToDeviceRatio(),k=this._getPickable(e);if(!k||i.length===0)return{result:[],emptyInfo:yM({viewports:i,x:n,y:o,pixelRatio:R})};this._resizeBuffer();let j=this.device.canvasContext.cssToDevicePixels([n,o],!0),q=[j.x+Math.floor(j.width/2),j.y+Math.floor(j.height/2)],Z=Math.round(a*R),{width:re,height:ee}=this.pickingFBO,se=this._getPickingRect({deviceX:q[0],deviceY:q[1],deviceRadius:Z,deviceWidth:re,deviceHeight:ee}),me={x:n-a,y:o-a,width:a*2+1,height:a*2+1},Le,je=[],Je=new Set;for(let J=0;J<c;J++){let te;if(se){let ye=this._drawAndSample({layers:k,views:r,viewports:i,onViewportActive:x,deviceRect:se,cullRect:me,effects:T,pass:`picking:${h}`});te=TF({...ye,deviceX:q[0],deviceY:q[1],deviceRadius:Z,deviceRect:se})}else te={pickedColor:null,pickedObjectIndex:-1};let X;if(te.pickedLayer&&p&&this.depthFBO){let{pickedColors:ye}=this._drawAndSample({layers:[te.pickedLayer],views:r,viewports:i,onViewportActive:x,deviceRect:{x:te.pickedX,y:te.pickedY,width:1,height:1},cullRect:me,effects:T,pass:`picking:${h}:z`},!0);ye[3]&&(X=ye[0])}te.pickedLayer&&J+1<c&&(Je.add(te.pickedLayer),te.pickedLayer.disablePickingIndex(te.pickedObjectIndex)),Le=CF({pickInfo:te,lastPickedInfo:this.lastPickedInfo,mode:h,layers:k,viewports:i,x:n,y:o,z:X,pixelRatio:R});for(let ye of Le.values())ye.layer&&je.push(ye);if(!te.pickedColor)break}for(let J of Je)J.restorePickingColors();return{result:je,emptyInfo:Le.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:i,x:n,y:o,width:a=1,height:c=1,mode:h="query",maxObjects:p=null,onViewportActive:x,effects:T}){let R=this._getPickable(e);if(!R||i.length===0)return[];this._resizeBuffer();let k=this.device.canvasContext.cssToDeviceRatio(),j=this.device.canvasContext.cssToDevicePixels([n,o],!0),q=j.x,Z=j.y+j.height,re=this.device.canvasContext.cssToDevicePixels([n+a,o+c],!0),ee=re.x+re.width,se=re.y,me={x:q,y:se,width:ee-q,height:Z-se},Le=this._drawAndSample({layers:R,views:r,viewports:i,onViewportActive:x,deviceRect:me,cullRect:{x:n,y:o,width:a,height:c},effects:T,pass:`picking:${h}`}),je=EF(Le),Je=new Map,J=[],te=Number.isFinite(p);for(let X=0;X<je.length&&!(te&&J.length>=p);X++){let ye=je[X],_e={color:ye.pickedColor,layer:null,index:ye.pickedObjectIndex,picked:!0,x:n,y:o,pixelRatio:k};_e=xM({layer:ye.pickedLayer,info:_e,mode:h});let Oe=_e.layer.id;Je.has(Oe)||Je.set(Oe,new Set);let ve=Je.get(Oe),De=_e.object??_e.index;ve.has(De)||(ve.add(De),J.push(_e))}return J}_drawAndSample({layers:e,views:r,viewports:i,onViewportActive:n,deviceRect:o,cullRect:a,effects:c,pass:h},p=!1){let x=p?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:r,viewports:i,onViewportActive:n,pickingFBO:x,deviceRect:o,cullRect:a,effects:c,pass:h,pickZ:p,preRenderStats:{},isPicking:!0};for(let ee of c)ee.useInPicking&&(T.preRenderStats[ee.id]=ee.preRender(T));let{decodePickingColor:R}=this.pickLayersPass.render(T),{x:k,y:j,width:q,height:Z}=o,re=new(p?Float32Array:Uint8Array)(q*Z*4);return this.device.readPixelsToArrayWebGL(x,{sourceX:k,sourceY:j,sourceWidth:q,sourceHeight:Z,target:re}),{pickedColors:re,decodePickingColor:R}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:i,deviceWidth:n,deviceHeight:o}){let a=Math.max(0,e-i),c=Math.max(0,r-i),h=Math.min(n,e+i+1)-a,p=Math.min(o,r+i+1)-c;return h<=0||p<=0?null:{x:a,y:c,width:h,height:p}}};var ane={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},lne="top-left",SF="__root",Wv=class{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!An(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(let e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){let r={};for(let i of this.resolvedWidgets)r[i.id]=i;this.resolvedWidgets.length=0;for(let i of this.defaultWidgets)r[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){let n=r[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._remove(n),this._add(i)):i!==n&&(n.setProps(i.props),i=n):this._add(i),r[i.id]=null,this.resolvedWidgets.push(i)}for(let i in r){let n=r[i];n&&this._remove(n)}this.widgets=e}_add(e){let{viewId:r=null,placement:i=lne}=e,n=e.onAdd({deck:this.deck,viewId:r});n&&this._getContainer(r,i).append(n),e._element=n}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){let i=e||SF,n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",this.parentElement?.append(n),this.containers[i]=n);let o=n.querySelector(`.${r}`);return o||(o=document.createElement("div"),o.className=r,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,ane[r]),n.append(o)),o}_updateContainers(){let e=this.deck.width,r=this.deck.height;for(let i in this.containers){let n=this.lastViewports[i]||null,o=i===SF||n,a=this.containers[i];o?(a.style.display="block",a.style.left=`${n?n.x:0}px`,a.style.top=`${n?n.y:0}px`,a.style.width=`${n?n.width:e}px`,a.style.height=`${n?n.height:r}px`):a.style.display="none"}}onRedraw({viewports:e,layers:r}){let i=e.reduce((n,o)=>(n[o.id]=o,n),{});for(let n of this.getWidgets()){let{viewId:o}=n;if(o){let a=i[o];a&&(n.onViewportChange&&n.onViewportChange(a),n.onRedraw?.({viewports:[a],layers:r}))}else{if(n.onViewportChange)for(let a of e)n.onViewportChange(a);n.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=i,this._updateContainers()}onHover(e,r){for(let i of this.getWidgets()){let{viewId:n}=i;(!n||n===e.viewport?.id)&&i.onHover?.(e,r)}}onEvent(e,r){let i=R1[r.type];if(i)for(let n of this.getWidgets()){let{viewId:o}=n;(!o||o===e.viewport?.id)&&n[i]?.(e,r)}}};var cne={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},ey=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){let r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,cne),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:r}=this,i=r&&r.props.getTooltip;if(!i)return;let n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,r,i){let n=this.element;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${r}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}};var bd;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(bd||(bd={}));var ry={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},$o=(t,e,r)=>e?t.enable(r):t.disable(r),IF=(t,e,r)=>t.hint(r,e),sl=(t,e,r)=>t.pixelStorei(r,e),MF=(t,e,r)=>{let i=r===36006?36009:36008;return t.bindFramebuffer(i,e)},ty=(t,e,r)=>{let n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(n,e)};function bM(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}var PF={3042:$o,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:$o,2885:(t,e)=>t.cullFace(e),2929:$o,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:$o,35723:IF,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:MF,36010:MF,34964:ty,36662:ty,36663:ty,35053:ty,35055:ty,2886:(t,e)=>t.frontFace(e),33170:IF,2849:(t,e)=>t.lineWidth(e),32823:$o,32824:"polygonOffset",10752:"polygonOffset",35977:$o,32926:$o,32928:$o,32938:"sampleCoverage",32939:"sampleCoverage",3089:$o,3088:(t,e)=>t.scissor(...e),2960:$o,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:$o,10754:$o,12288:$o,12289:$o,12290:$o,12291:$o,12292:$o,12293:$o,12294:$o,12295:$o,3333:sl,3317:sl,37440:sl,37441:sl,37443:sl,3330:sl,3332:sl,3331:sl,3314:sl,32878:sl,3316:sl,3315:sl,32877:sl,framebuffer:(t,e)=>{let r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{let r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{let r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=bM(e)?e:[e,e];let[r,i]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=bM(e)&&e.length===3?[...e,...e]:e;let[r,i,n,o,a,c]=e;t.stencilFuncSeparate(1028,r,i,n),t.stencilFuncSeparate(1029,o,a,c)},stencilOp:(t,e)=>{e=bM(e)&&e.length===3?[...e,...e]:e;let[r,i,n,o,a,c]=e;t.stencilOpSeparate(1028,r,i,n),t.stencilOpSeparate(1029,o,a,c)},viewport:(t,e)=>t.viewport(...e)};function _o(t,e,r){return e[t]!==void 0?e[t]:r[t]}var RF={blendEquation:(t,e,r)=>t.blendEquationSeparate(_o(32777,e,r),_o(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(_o(32969,e,r),_o(32968,e,r),_o(32971,e,r),_o(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(_o(32824,e,r),_o(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(_o(32938,e,r),_o(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,_o(2962,e,r),_o(2967,e,r),_o(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,_o(34816,e,r),_o(36003,e,r),_o(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,_o(2964,e,r),_o(2965,e,r),_o(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,_o(34817,e,r),_o(34818,e,r),_o(34819,e,r))},vM={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{let i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:r}):{valueChanged:!0}},blendColor:(t,e,r,i,n)=>t({32773:new Float32Array([e,r,i,n])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,i,n)=>t({32969:e,32968:r,32971:i,32970:n}),clearColor:(t,e,r,i,n)=>t({3106:new Float32Array([e,r,i,n])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,i,n)=>t({3107:[e,r,i,n]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,i,n)=>t({3088:new Int32Array([e,r,i,n])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,i)=>t({2962:e,2967:r,2963:i,34816:e,36003:r,36004:i}),stencilFuncSeparate:(t,e,r,i,n)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(t,e,r,i)=>t({2964:e,2965:r,2966:i,34817:e,34818:r,34819:i}),stencilOpSeparate:(t,e,r,i,n)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(t,e,r,i,n)=>t({2978:[e,r,i,n]})},Nu=(t,e)=>t.isEnabled(e),wM={3042:Nu,2884:Nu,2929:Nu,3024:Nu,32823:Nu,32926:Nu,32928:Nu,3089:Nu,2960:Nu,35977:Nu},BF=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Bc(t,e){if(une(e))return;let r={};for(let n in e){let o=Number(n),a=PF[n];a&&(typeof a=="string"?r[a]=!0:a(t,e[n],o))}let i=t.state&&t.state.cache;if(i)for(let n in r){let o=RF[n];o(t,e,i)}}function $v(t,e=ry){if(typeof e=="number"){let n=e,o=wM[n];return o?o(t,n):t.getParameter(n)}let r=Array.isArray(e)?e:Object.keys(e),i={};for(let n of r){let o=wM[n];i[n]=o?o(t,Number(n)):t.getParameter(Number(n))}return i}function LF(t){Bc(t,ry)}function une(t){for(let e in t)return!1;return!0}function OF(t,e){if(t===e)return!0;let r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}var Lc=class{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,r){this.gl=e,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){let e=this.stateStack[this.stateStack.length-1];Bc(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r.copyState?$v(e):Object.assign({},ry),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,fne(e);for(let i in vM){let n=vM[i];hne(e,i,n)}DF(e,"getParameter"),DF(e,"isEnabled")}_updateCache(e){let r=!1,i,n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let o in e){let a=e[o],c=this.cache[o];OF(a,c)||(r=!0,i=c,n&&!(o in n)&&(n[o]=c),this.cache[o]=a)}return{valueChanged:r,oldValue:i}}};function DF(t,e){let r=t[e].bind(t);t[e]=function(n){if(n===void 0||BF.has(n))return r(n);let o=Lc.get(t);return n in o.cache||(o.cache[n]=r(n)),o.enable?o.cache[n]:r(n)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function hne(t,e,r){if(!t[e])return;let i=t[e].bind(t);t[e]=function(...o){let a=Lc.get(t),{valueChanged:c,oldValue:h}=r(a._updateCache,...o);return c&&i(...o),h},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function fne(t){let e=t.useProgram.bind(t);t.useProgram=function(i){let n=Lc.get(t);n.program!==i&&(e(i),n.program=i)}}function FF(t,e,r){let i="",n={preserveDrawingBuffer:!0,...r},o=null;if(o||=t.getContext("webgl2",n),n.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!r.failIfMajorPerformanceCaveat&&(n.failIfMajorPerformanceCaveat=!1,o=t.getContext("webgl2",n),o.luma||={},o.luma.softwareRenderer=!0),o||(o=t.getContext("webgl",{}),o&&(o=null,i||="Your browser only supports WebGL1")),!o)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);let{onContextLost:a,onContextRestored:c}=e;return t.addEventListener("webglcontextlost",h=>a(h),!1),t.addEventListener("webglcontextrestored",h=>c(h),!1),o.luma||={},o}function zu(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function kF(t,e){let r=t.getParameter(7936),i=t.getParameter(7937);zu(t,"WEBGL_debug_renderer_info",e);let n=e.WEBGL_debug_renderer_info,o=t.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),a=t.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),c=o||r,h=a||i,p=t.getParameter(7938),x=NF(c,h),T=dne(c,h),R=pne(c,h);return{type:"webgl",gpu:x,gpuType:R,gpuBackend:T,vendor:c,renderer:h,version:p,shadingLanguage:"glsl",shadingLanguageVersion:300}}function NF(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function dne(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function pne(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(NF(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function qv(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}var iy="WEBGL_compressed_texture_s3tc",ny="WEBGL_compressed_texture_s3tc_srgb",xm="EXT_texture_compression_rgtc",bm="EXT_texture_compression_bptc",Ane="WEBGL_compressed_texture_etc",mne="WEBGL_compressed_texture_astc",gne="WEBGL_compressed_texture_etc1",_ne="WEBGL_compressed_texture_pvrtc",yne="WEBGL_compressed_texture_atc",zF="EXT_texture_norm16",UF="EXT_render_snorm",xne="EXT_color_buffer_float",Zv={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[UF],"norm16-renderable-webgl":[zF],"snorm16-renderable-webgl":[zF,UF],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[iy,ny,xm,bm],"texture-compression-bc5-webgl":[xm],"texture-compression-bc7-webgl":[bm],"texture-compression-etc2":[Ane],"texture-compression-astc":[mne],"texture-compression-etc1-webgl":[gne],"texture-compression-pvrtc-webgl":[_ne],"texture-compression-atc-webgl":[yne]};function VF(t){return t in Zv}function jF(t,e,r){return(Zv[e]||[]).every(n=>zu(t,n,r))}var TM={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:xne,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:iy},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ny},"bc1-rgba-unorm":{gl:33777,x:iy},"bc1-rgba-unorm-srgb":{gl:35916,x:ny},"bc2-rgba-unorm":{gl:33778,x:iy},"bc2-rgba-unorm-srgb":{gl:35918,x:ny},"bc3-rgba-unorm":{gl:33779,x:iy},"bc3-rgba-unorm-srgb":{gl:35919,x:ny},"bc4-r-unorm":{gl:36283,x:xm},"bc4-r-snorm":{gl:36284,x:xm},"bc5-rg-unorm":{gl:36285,x:xm},"bc5-rg-snorm":{gl:36286,x:xm},"bc6h-rgb-ufloat":{gl:36495,x:bm},"bc6h-rgb-float":{gl:36494,x:bm},"bc7-rgba-unorm":{gl:36492,x:bm},"bc7-rgba-unorm-srgb":{gl:36493,x:bm},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function GF(t,e,r){let i=e.create,n=TM[e.format];return n?.gl===void 0&&(i=!1),n?.x&&(i=i&&!!zu(t,n.x,r)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function Xv(t){let e=TM[t],r=vne(t),i=W0(t);return{internalFormat:r,format:e?.dataFormat||bne(i.channels,i.integer,i.normalized,r),type:i.dataType?qv(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function HF(t){switch(W0(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function bne(t,e,r,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function vne(t){let r=TM[t]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}var WF={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},Yv=class extends Y_{gl;extensions;testedFeatures=new Set;constructor(e,r,i){super([],i),this.gl=e,this.extensions=r,zu(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let e=this.getFeatures();for(let r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),VF(e)&&jF(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){let e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of e)this.has(r)}getFeatures(){return[...Object.keys(WF),...Object.keys(Zv)]}getWebGLFeature(e){let r=WF[e];return typeof r=="string"?!!zu(this.gl,r,this.extensions):!!r}};var Kv=class extends X_{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}};var Uu=class extends Vp{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,r){super(e,r);let i=r.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let e=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){let i=this.colorAttachments[r];if(i){let n=36064+r;this._attachTextureView(n,i)}}if(this.depthStencilAttachment){let r=HF(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){let r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${Tne(r)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,r){let{gl:i}=this.device,{texture:n}=r,o=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(i.bindTexture(n.glTarget,n.handle),n.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,n.handle,o,a);break;case 34067:let c=wne(a);i.framebufferTexture2D(36160,e,c,n.handle,o);break;case 3553:i.framebufferTexture2D(36160,e,3553,n.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(n.glTarget,null)}};function wne(t){return t<34069?t+34069:t}function Tne(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}var Qv=class extends Q_{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,r){super(r),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Uu(this.device,{handle:null}),this._framebuffer}update(){let e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){let r=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(r,e);return}}commit(){}};async function Jv(t,e){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),e&&(i.id=e),new Promise((n,o)=>{i.onload=n,i.onerror=a=>o(new Error(`Unable to load script '${t}': ${a}`)),r.appendChild(i)})}var Ene=1,al=null,$F=!1,ew={debugSpectorJS:Vt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function qF(t){if(!globalThis.SPECTOR)try{await Jv(t.debugSpectorJSUrl||ew.debugSpectorJSUrl)}catch(e){Vt.warn(String(e))}}function ZF(t){if(t={...ew,...t},!t.debugSpectorJS)return null;if(!al&&globalThis.SPECTOR&&!globalThis.luma?.spector){Vt.probe(Ene,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:e}=globalThis.SPECTOR;al=new e,globalThis.luma&&(globalThis.luma.spector=al)}if(!al)return null;if($F||($F=!0,al.spyCanvases(),al?.onCaptureStarted.add(e=>Vt.info("Spector capture started:",e)()),al?.onCapture.add(e=>{Vt.info("Spector capture complete:",e)(),al?.getResultUI(),al?.resultView.display(),al?.resultView.addCapture(e)})),t.gl){let e=t.gl,r=e.device;al?.startCapture(t.gl,500),e.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{Vt.info("Spector capture stopped after 2 seconds")(),al?.stopCapture()})}return al}var Cne="https://unpkg.com/webgl-debug@2.0.1/index.js";function YF(t){return t.luma=t.luma||{},t.luma}async function KF(){aa()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Jv(Cne))}function QF(t,e={}){return e.debugWebGL||e.traceWebGL?Ine(t,e):Sne(t)}function Sne(t){let e=YF(t);return e.realContext?e.realContext:t}function Ine(t,e){if(!globalThis.WebGLDebugUtils)return Vt.warn("webgl-debug not loaded")(),t;let r=YF(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...bd,...t});let i=globalThis.WebGLDebugUtils.makeDebugContext(t,Mne.bind(null,e),Pne.bind(null,e));for(let a in bd)!(a in i)&&typeof bd[a]=="number"&&(i[a]=bd[a]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(n,i);let o=Object.create(n);return r.realContext=t,r.debugContext=o,o.debug=!0,o}function XF(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function Mne(t,e,r,i){i=Array.from(i).map(c=>c===void 0?"undefined":c);let n=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,i),a=`${n} in gl.${r}(${o})`;Vt.error(a)();debugger}function Pne(t,e,r){let i="";Vt.level>=1&&(i=XF(e,r),t.traceWebGL&&Vt.log(1,i)());for(let n of r)if(n===void 0){i=i||XF(e,r);debugger}}var EM={};function JF(t="id"){EM[t]=EM[t]||1;let e=EM[t]++;return`${t}-${e}`}var Oc=class extends qi{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;let i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=Rne(this.props.usage),this.glUsage=Bne(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(e,r=0,i=e.byteLength+r){let n=this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bufferSubData(n,r,e),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let r=e;e===0&&(r=new Float32Array(0));let i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,r,e.byteLength)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}readSyncWebGL(e=0,r){r=r??this.byteLength-e;let i=new Uint8Array(r),n=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,n,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,r),i}};function Rne(t){return t&qi.INDEX?34963:t&qi.VERTEX?34962:t&qi.UNIFORM?35345:34962}function Bne(t){return t&qi.INDEX||t&qi.VERTEX?35044:t&qi.UNIFORM?35048:35044}function tk(t){let e=t.split(/\r?\n/),r=[];for(let i of e){if(i.length<=1)continue;let n=i.split(":");if(n.length===2){let[T,R]=n;r.push({message:R.trim(),type:ek(T),lineNum:0,linePos:0});continue}let[o,a,c,...h]=n,p=parseInt(c,10);isNaN(p)&&(p=0);let x=parseInt(a,10);isNaN(x)&&(x=0),r.push({message:h.join(":").trim(),type:ek(o),lineNum:p,linePos:x})}return r}function ek(t){let e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}var tw=class extends zp{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let e=this.device.gl.getShaderInfoLog(this.handle);return e?tk(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;let{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Vt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Vt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let e=async n=>await new Promise(o=>setTimeout(o,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};function ik(t,e,r,i){if(Fne(e))return i(t);let n=t;n.pushState();try{return Lne(t,e),Bc(n.gl,r),i(t)}finally{n.popState()}}function Lne(t,e){let r=t,{gl:i}=r;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(cA("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){let o=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=cA("provokingVertex",e.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(a)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){let o=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,a=cA("polygonMode",e.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,a),o?.polygonModeWEBGL(1029,a)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(Dne("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(iw("depthCompare",e.depthCompare))),e.stencilWriteMask){let n=e.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&Vt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){let n=e.stencilReadMask||4294967295,o=iw("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,o,0,n),i.stencilFuncSeparate(1029,o,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){let n=CM("stencilPassOperation",e.stencilPassOperation),o=CM("stencilFailOperation",e.stencilFailOperation),a=CM("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,o,a,n),i.stencilOpSeparate(1029,o,a,n)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break;default:}if(e.blendColorOperation||e.blendAlphaOperation){let n=rk("blendColorOperation",e.blendColorOperation||"add"),o=rk("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(n,o);let a=rw("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=rw("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=rw("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),p=rw("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(a,c,h,p)}}function iw(t,e){return cA(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function CM(t,e){return cA(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function rk(t,e){return cA(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function rw(t,e){return cA(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function One(t,e){return`Illegal parameter ${e} for ${t}`}function cA(t,e,r){if(!(e in r))throw new Error(One(t,e));return r[e]}function Dne(t,e){return e}function Fne(t){let e=!0;for(let r in t){e=!1;break}return e}function nw(t){let e={};return t.addressModeU&&(e[10242]=SM(t.addressModeU)),t.addressModeV&&(e[10243]=SM(t.addressModeV)),t.addressModeW&&(e[32882]=SM(t.addressModeW)),t.magFilter&&(e[10240]=IM(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=kne(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=iw("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function SM(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function IM(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function kne(t,e="none"){if(!e)return IM(t);switch(e){case"none":return IM(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}var uA=class extends Up{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=nw(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(let[r,i]of Object.entries(e)){let n=Number(r);switch(n){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,n,i);break;default:this.device.gl.samplerParameteri(this.handle,n,i);break}}}};var Vu=class extends Np{device;gl;handle;texture;constructor(e,r){super(e,{...on.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}};var Nne="Failed to deduce GL constant from typed array";function nk(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Nne)}}function ok(t,e){let{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function MM(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function sk(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function hA(t,e,r){if(zne(e))return r(t);let{nocatch:i=!0}=e,n=Lc.get(t);n.push(),Bc(t,e);let o;if(i)o=r(t),n.pop();else try{o=r(t)}finally{n.pop()}return o}function zne(t){for(let e in t)return!1;return!0}function ak(t,e,r){let{dimension:i,width:n,height:o,depth:a=0}=r,{glInternalFormat:c}=r,h=r.glTarget;switch(i){case"2d-array":case"3d":t.texStorage3D(h,e,c,n,o,a);break;default:t.texStorage2D(h,e,c,n,o)}}function PM(t,e,r,i){let{width:n,height:o}=i,{dimension:a,depth:c=0,mipLevel:h=0}=i,{x:p=0,y:x=0,z:T=0}=i,{glFormat:R,glType:k}=i,j=ck(i.glTarget,a,c),q=i.flipY?{37440:!0}:{};hA(t,q,()=>{switch(a){case"2d-array":case"3d":t.bindTexture(j,e),t.texSubImage3D(j,h,p,x,T,n,o,c,R,k,r),t.bindTexture(j,null);break;case"2d":case"cube":t.bindTexture(j,e),t.texSubImage2D(j,h,p,x,n,o,R,k,r),t.bindTexture(j,null);break;default:throw new Error(a)}})}function RM(t,e,r){let{dimension:i,width:n,height:o,depth:a=0,mipLevel:c=0,byteOffset:h=0}=r,{x:p=0,y:x=0,z:T=0}=r,{glFormat:R,glType:k,compressed:j}=r,q=ck(r.glTarget,i,a);switch(i){case"2d-array":case"3d":j?t.compressedTexSubImage3D(q,c,p,x,T,n,o,a,R,e,h):t.texSubImage3D(q,c,p,x,T,n,o,a,R,k,e,h);break;case"2d":case"cube":j?t.compressedTexSubImage2D(q,c,p,x,n,o,R,e,h):t.texSubImage2D(q,c,p,x,n,o,R,k,e,h);break;default:throw new Error(i)}}function lk(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866;case"cube-array":break}throw new Error(t)}function ck(t,e,r){return e==="cube"?34069+r:t}function uk(t,e){let{sourceX:r=0,sourceY:i=0,sourceAttachment:n=0}=e||{},{target:o=null,sourceWidth:a,sourceHeight:c,sourceDepth:h,sourceFormat:p,sourceType:x}=e||{},{framebuffer:T,deleteFramebuffer:R}=fk(t),{gl:k,handle:j}=T;a||=T.width,c||=T.height;let q=T.colorAttachments[n]?.texture;if(!q)throw new Error(`Invalid framebuffer attachment ${n}`);h=q?.depth||1,p||=q?.glFormat||6408,x||=q?.glType||5121,o=Vne(o,x,p,a,c,h),x=x||nk(o);let Z=k.bindFramebuffer(36160,j);return k.readBuffer(36064+n),k.readPixels(r,i,a,c,p,x,o),k.readBuffer(36064),k.bindFramebuffer(36160,Z||null),R&&T.destroy(),o}function hk(t,e){let{target:r,sourceX:i=0,sourceY:n=0,sourceFormat:o=6408,targetByteOffset:a=0}=e||{},{sourceWidth:c,sourceHeight:h,sourceType:p}=e||{},{framebuffer:x,deleteFramebuffer:T}=fk(t);c=c||x.width,h=h||x.height;let R=x;p=p||5121;let k=r;if(!k){let q=MM(o),Z=sk(p),re=a+c*h*q*Z;k=R.device.createBuffer({byteLength:re})}let j=t.device.createCommandEncoder();return j.copyTextureToBuffer({sourceTexture:t,width:c,height:h,origin:[i,n],destinationBuffer:k,byteOffset:a}),j.destroy(),T&&x.destroy(),k}function fk(t){return t instanceof Vp?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Une(t),deleteFramebuffer:!0}}function Une(t,e){let{device:r,width:i,height:n,id:o}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:i,height:n,colorAttachments:[t]})}function Vne(t,e,r,i,n,o){if(t)return t;e||=5121;let a=ok(e,{clamped:!1}),c=MM(r);return new a(i*n*c)}var ju=class extends on{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,r){super(e,r);let i={...this.props};i.data=r.data,this.device=e,this.gl=this.device.gl,this.glTarget=lk(this.props.dimension);let n=Xv(this.props.format);this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:r,height:i}=e;if(!r||!i){let n=on.getTextureDataSize(e.data);r=n?.width||1,i=n?.height||1}if(this.width=r,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new Vu(this.device,{...this.props,texture:this}),this.bind(),ak(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Vu(this.device,{...e,texture:this})}setSampler(e={}){let r;e instanceof uA?(this.sampler=e,r=e.props):(this.sampler=new uA(this.device,e),r=e);let i=nw(r);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Vt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){Vt.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){let r=on.getExternalImageSize(e.image),i={...on.defaultCopyExternalImageOptions,...r,...e},{image:n,depth:o,mipLevel:a,x:c,y:h,z:p,flipY:x}=i,{width:T,height:R}=i,{dimension:k,glTarget:j,glFormat:q,glInternalFormat:Z,glType:re}=this;if(T=Math.min(T,this.width-c),R=Math.min(R,this.height-h),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return PM(this.device.gl,this.handle,n,{dimension:k,mipLevel:a,x:c,y:h,z:p,width:T,height:R,depth:o,glFormat:q,glInternalFormat:Z,glType:re,glTarget:j,flipY:x}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,r=0){this.bind();let i=on.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&Vt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let n=0;n<i.length;n++){let o=i[n];this._setMipLevel(r,n,o)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),RM(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(let i of on.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,r,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Vt.warn(`${this.id} has mipmap and multiple LODs.`)();let n=on.CubeFaces.indexOf(r);this.setTexture2DData(e,n)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){let{face:r,width:i,height:n,pixels:o,data:a,format:c=6408,type:h=5121}=e,{gl:p}=this,x=o||a;this.bind(),x instanceof Promise?x.then(T=>this.setImageDataForFace(Object.assign({},e,{face:r,data:T,pixels:T}))):this.width||this.height?p.texImage2D(r,0,c,i,n,0,c,h,x):p.texImage2D(r,0,c,c,h,x)}_getImageDataMap(e){for(let r=0;r<on.CubeFaces.length;++r){let i=on.CubeFaces[r];e[i]&&(e[34069+r]=e[i],delete e[i])}return e}_setSamplerParameters(e){Vt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(let[r,i]of Object.entries(e)){let n=Number(r),o=i;switch(n){case 33082:case 33083:this.gl.texParameterf(this.glTarget,n,o);break;case 10241:this.gl.texParameteri(this.glTarget,n,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,n,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,n,o);break;default:this.gl.texParameteri(this.glTarget,n,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,r,i,n=this.glTarget){if(on.isExternalImage(i)){PM(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:r,glTarget:n,flipY:this.props.flipY});return}if(on.isTextureLevelData(i)){RM(this.device.gl,i.data,{...this,depth:e,mipLevel:r,glTarget:n});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){let{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,this.handle),e}unbind(e){let{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,null),e}};var jne=[1,2,4,8],ow=class extends J_{device;glParameters;constructor(e,r){super(e,r),this.device=e;let i;if(!r?.parameters?.viewport)if(r?.framebuffer){let{width:o,height:a}=r.framebuffer;i=[0,0,o,a]}else{let[o,a]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,o,a]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){let o=this.props.framebuffer.colorAttachments.map((a,c)=>36064+c);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){let r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(r.colorMask=jne.map(i=>!!(i&e.colorMask))),this.glParameters=r,Bc(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let e={...this.glParameters},r=0;this.props.clearColors&&this.props.clearColors.forEach((i,n)=>{i&&this.clearColorBuffer(n,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,e.clearStencil=this.props.clearStencil),r!==0&&hA(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){hA(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}};function dk(t){return Gne.includes(t)}var Gne=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],pk={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function BM(t){let e=pk[t];if(!e)throw new Error("uniform");let[r,i,,n]=e;return{format:n,components:i,glType:r}}function Ak(t){let e=pk[t];if(!e)throw new Error("attribute");let[,r,,i,n]=e;return{attributeType:i,vertexFormat:n,components:r}}function mk(t,e){let r={attributes:[],bindings:[]};r.attributes=Hne(t,e);let i=qne(t,e);for(let c of i){let h=c.uniforms.map(p=>({name:p.name,format:p.format,byteOffset:p.byteOffset,byteStride:p.byteStride,arrayLength:p.arrayLength}));r.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:h})}let n=$ne(t,e),o=0;for(let c of n)if(dk(c.type)){let{viewDimension:h,sampleType:p}=Xne(c.type);r.bindings.push({type:"texture",name:c.name,group:0,location:o,viewDimension:h,sampleType:p}),c.textureUnit=o,o+=1}n.length&&(r.uniforms=n);let a=Wne(t,e);return a?.length&&(r.varyings=a),r}function Hne(t,e){let r=[],i=t.getProgramParameter(e,35721);for(let n=0;n<i;n++){let o=t.getActiveAttrib(e,n);if(!o)throw new Error("activeInfo");let{name:a,type:c}=o,h=t.getAttribLocation(e,a);if(h>=0){let{attributeType:p}=Ak(c),x=/instance/i.test(a)?"instance":"vertex";r.push({name:a,location:h,stepMode:x,type:p})}}return r.sort((n,o)=>n.location-o.location),r}function Wne(t,e){let r=[],i=t.getProgramParameter(e,35971);for(let n=0;n<i;n++){let o=t.getTransformFeedbackVarying(e,n);if(!o)throw new Error("activeInfo");let{name:a,type:c,size:h}=o,{glType:p,components:x}=BM(c),T={location:n,name:a,type:p,size:h*x};r.push(T)}return r.sort((n,o)=>n.location-o.location),r}function $ne(t,e){let r=[],i=t.getProgramParameter(e,35718);for(let n=0;n<i;n++){let o=t.getActiveUniform(e,n);if(!o)throw new Error("activeInfo");let{name:a,size:c,type:h}=o,{name:p,isArray:x}=Yne(a),T=t.getUniformLocation(e,p),R={location:T,name:p,size:c,type:h,isArray:x};if(r.push(R),R.size>1)for(let k=0;k<R.size;k++){let j=`${p}[${k}]`;T=t.getUniformLocation(e,j);let q={...R,name:j,location:T};r.push(q)}}return r}function qne(t,e){let r=(o,a)=>t.getActiveUniformBlockParameter(e,o,a),i=[],n=t.getProgramParameter(e,35382);for(let o=0;o<n;o++){let a={name:t.getActiveUniformBlockName(e,o)||"",location:r(o,35391),byteLength:r(o,35392),vertex:r(o,35396),fragment:r(o,35398),uniformCount:r(o,35394),uniforms:[]},c=r(o,35395)||[],h=t.getActiveUniforms(e,c,35383),p=t.getActiveUniforms(e,c,35384),x=t.getActiveUniforms(e,c,35387),T=t.getActiveUniforms(e,c,35388);for(let R=0;R<a.uniformCount;++R){let k=t.getActiveUniform(e,c[R]);if(!k)throw new Error("activeInfo");a.uniforms.push({name:k.name,format:BM(h[R]).format,type:h[R],arrayLength:p[R],byteOffset:x[R],byteStride:T[R]})}i.push(a)}return i.sort((o,a)=>o.location-a.location),i}var Zne={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Xne(t){let e=Zne[t];if(!e)throw new Error("sampler");let[r,i]=e;return{viewDimension:r,sampleType:i}}function Yne(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function gk(t,e,r,i){let n=t,o=i;o===!0&&(o=1),o===!1&&(o=0);let a=typeof o=="number"?[o]:o;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,a);case 35664:return t.uniform2fv(e,a);case 35665:return t.uniform3fv(e,a);case 35666:return t.uniform4fv(e,a);case 5124:return t.uniform1iv(e,a);case 35667:return t.uniform2iv(e,a);case 35668:return t.uniform3iv(e,a);case 35669:return t.uniform4iv(e,a);case 35670:return t.uniform1iv(e,a);case 35671:return t.uniform2iv(e,a);case 35672:return t.uniform3iv(e,a);case 35673:return t.uniform4iv(e,a);case 5125:return n.uniform1uiv(e,a,1);case 36294:return n.uniform2uiv(e,a,2);case 36295:return n.uniform3uiv(e,a,3);case 36296:return n.uniform4uiv(e,a,4);case 35674:return t.uniformMatrix2fv(e,!1,a);case 35675:return t.uniformMatrix3fv(e,!1,a);case 35676:return t.uniformMatrix4fv(e,!1,a);case 35685:return n.uniformMatrix2x3fv(e,!1,a);case 35686:return n.uniformMatrix2x4fv(e,!1,a);case 35687:return n.uniformMatrix3x2fv(e,!1,a);case 35688:return n.uniformMatrix3x4fv(e,!1,a);case 35689:return n.uniformMatrix4x2fv(e,!1,a);case 35690:return n.uniformMatrix4x3fv(e,!1,a)}throw new Error("Illegal uniform")}function Kne(t){return z1(t)!==null||typeof t=="number"||typeof t=="boolean"}function _k(t){let e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{let i=t[r];Kne(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}function yk(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function xk(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}var bk=4,sw=class extends Su{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;let{varyings:i,bufferMode:n=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,n)),this._linkShaders(),Vt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=mk(this.device.gl,this.handle),Vt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Qne(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,r){for(let[i,n]of Object.entries(e)){let o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){let a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");r?.disableWarnings||Vt.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${a}`,n)();continue}switch(n||Vt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(n instanceof Oc)&&!(n.buffer instanceof Oc))throw new Error("buffer value");break;case"texture":if(!(n instanceof Vu||n instanceof ju||n instanceof Uu))throw new Error("texture value");break;case"sampler":Vt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=n}}draw(e){let{renderPass:r,parameters:i=this.props.parameters,topology:n=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:c,isInstanced:h=!1,firstVertex:p=0,transformFeedback:x}=e,T=yk(n),R=!!o.indexBuffer,k=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Vt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Vt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),x&&x.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let j=r;return ik(this.device,i,j.glParameters,()=>{R&&h?this.device.gl.drawElementsInstanced(T,a||0,k,p,c||0):R?this.device.gl.drawElements(T,a||0,k,p):h?this.device.gl.drawArraysInstanced(T,p,a||0,c||0):this.device.gl.drawArrays(T,p,a||0),x&&x.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(e){let{bindings:r}=_k(e);Object.keys(r).forEach(i=>{Vt.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){let{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Vt.time(bk,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Vt.timeEnd(bk,`linkProgram for ${this.id}`)(),Vt.level,!this.device.features.has("compilation-status-async-webgl")){let i=this._getLinkStatus();this._reportLinkStatus(i);return}Vt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Vt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break;case"success":break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break;case"success":break}let r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${r}`)}}_getLinkStatus(){let{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let e=async n=>await new Promise(o=>setTimeout(o,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(let r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Vt.warn(`Binding ${r.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:e}=this.device;e.useProgram(this.handle);let r=0,i=0;for(let n of this.shaderLayout.bindings){let o=this.bindings[n.name]||this.bindings[n.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${n.name} in ${this.id}`);switch(n.type){case"uniform":let{name:a}=n,c=e.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);e.uniformBlockBinding(this.handle,i,c),o instanceof Oc?e.bindBufferBase(35345,i,o.handle):e.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Vu||o instanceof ju||o instanceof Uu))throw new Error("texture");let h;if(o instanceof Vu)h=o.texture;else if(o instanceof ju)h=o;else if(o instanceof Uu&&o.colorAttachments[0]instanceof Vu)Vt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=o.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(h.glTarget,h.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${n.type}' not supported in WebGL`)}}}_applyUniforms(){for(let e of this.shaderLayout.uniforms||[]){let{name:r,location:i,type:n,textureUnit:o}=e,a=this.uniforms[r]??o;a!==void 0&&gk(this.device.gl,i,n,a)}}};function Qne(t,e){let r={...t,attributes:t.attributes.map(i=>({...i}))};for(let i of e?.attributes||[]){let n=r.attributes.find(o=>o.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):Vt.warn(`shader layout attribute ${i.name} not present in shader`)}return r}var aw=class extends t1{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(let r of e)switch(r.name){case"copy-buffer-to-buffer":Jne(this.device,r.options);break;case"copy-buffer-to-texture":eoe(this.device,r.options);break;case"copy-texture-to-buffer":toe(this.device,r.options);break;case"copy-texture-to-texture":roe(this.device,r.options);break;default:throw new Error(r.name)}}};function Jne(t,e){let r=e.sourceBuffer,i=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function eoe(t,e){throw new Error("Not implemented")}function toe(t,e){let{sourceTexture:r,mipLevel:i=0,aspect:n="all",width:o=e.sourceTexture.width,height:a=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:h=[0,0],destinationBuffer:p,byteOffset:x=0,bytesPerRow:T,rowsPerImage:R}=e;if(n!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||c!==0||T||R)throw new Error("not implemented");let{framebuffer:k,destroyFramebuffer:j}=vk(r),q;try{let Z=p,re=o||k.width,ee=a||k.height,se=Xv(k.colorAttachments[0].texture.props.format),me=se.format,Le=se.type;t.gl.bindBuffer(35051,Z.handle),q=t.gl.bindFramebuffer(36160,k.handle),t.gl.readPixels(h[0],h[1],re,ee,me,Le,x)}finally{t.gl.bindBuffer(35051,null),q!==void 0&&t.gl.bindFramebuffer(36160,q),j&&k.destroy()}}function roe(t,e){let{sourceTexture:r,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:o=[0,0],destinationTexture:a}=e,{width:c=e.destinationTexture.width,height:h=e.destinationTexture.height}=e,{framebuffer:p,destroyFramebuffer:x}=vk(r),[T,R]=n,[k,j,q]=o,Z=t.gl.bindFramebuffer(36160,p.handle),re=null,ee;if(a instanceof ju)re=a,c=Number.isFinite(c)?c:re.width,h=Number.isFinite(h)?h:re.height,re.bind(0),ee=re.glTarget;else throw new Error("invalid destination");switch(ee){case 3553:case 34067:t.gl.copyTexSubImage2D(ee,i,k,j,T,R,c,h);break;case 35866:case 32879:t.gl.copyTexSubImage3D(ee,i,k,j,q,T,R,c,h);break;default:}re&&re.unbind(),t.gl.bindFramebuffer(36160,Z),x&&p.destroy()}function vk(t){if(t instanceof on){let{width:e,height:r,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}var lw=class extends e1{device;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new aw(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,i){}};function wk(t){let{target:e,source:r,start:i=0,count:n=1}=t,o=r.length,a=n*o,c=0;for(let h=i;c<o;c++)e[h++]=r[c];for(;c<a;)c<a-c?(e.copyWithin(i+c,i,i+c),c*=2):(e.copyWithin(i+c,i,i+a-c),c=a);return t.target}var cw=class t extends r1{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return wC()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){let r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){let i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:n,type:o,stride:a,offset:c,normalized:h,integer:p,divisor:x}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),p?this.device.gl.vertexAttribIPointer(e,n,o,a,c):this.device.gl.vertexAttribPointer(e,n,o,h,a,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,x||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){let r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){let r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);let i=qv(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){let n=t.isConstantAttributeZeroSupported(this.device)||e!==0;(r||n)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){let i=ioe(r),n=i.byteLength*e,o=i.length*e;if(this.buffer&&n!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${n} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:n}),a=a||!noe(i,this.bufferValue),a){let c=CS(r.constructor,o);wk({target:c,source:i,start:0,count:o}),this.buffer.write(c),this.bufferValue=r}return this.buffer}};function ioe(t){return Array.isArray(t)?new Float32Array(t):t}function noe(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var uw=class extends i1{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(xk(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){let i=this._getVaryingIndex(e),{buffer:n,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[e]=n,Vt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:n,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,n,a,o)}getBuffer(e){if(Tk(e))return this.buffers[e]||null;let r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Oc)return{buffer:e,byteOffset:0,byteLength:e.byteLength};let{buffer:r,byteOffset:i=0,byteLength:n=e.buffer.byteLength}=e;return{buffer:r,byteOffset:i,byteLength:n}}_getVaryingIndex(e){if(Tk(e))return Number(e);for(let r of this.layout.varyings)if(e===r.name)return r.location;return-1}_bindBuffers(){for(let e in this.buffers){let{buffer:r,byteLength:i,byteOffset:n}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,n,i)}}_unbindBuffers(){for(let e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,i=0,n){let o=r&&r.handle;!o||n===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,i,n)}};function Tk(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}var hw=class extends n1{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,n)=>{let o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}};var Dc=class extends El{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||JF("webgl-device")});let r=El._getCanvasContextProps(e);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=r.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new Qv(this,r),this.lost=new Promise(x=>{this._resolveContextLost=x});let n={...e.webgl};r.alphaMode==="premultiplied"&&(n.premultipliedAlpha=!0),e.powerPreference!==void 0&&(n.powerPreference=e.powerPreference);let a=this.props._handle||FF(this.canvasContext.canvas,{onContextLost:x=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:x=>console.log("WebGL context restored")},n);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(e._reuseDevices)return Vt.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=ZF({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=kF(this.gl,this._extensions),this.limits=new Kv(this.gl),this.features=new Yv(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Lc(this.gl,{log:(...x)=>Vt.log(1,...x)()}).trackState(this.gl,{copyState:!1});let h=e.debugWebGL||e.debug,p=e.debugWebGL;h&&(this.gl=QF(this.gl,{debugWebGL:h,traceWebGL:p}),Vt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Vt.level=Math.max(Vt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){let r=this._normalizeBufferProps(e);return new Oc(this,r)}createTexture(e){return new ju(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new uA(this,e)}createShader(e){return new tw(this,e)}createFramebuffer(e){return new Uu(this,e)}createVertexArray(e){return new cw(this,e)}createTransformFeedback(e){return new uw(this,e)}createQuerySet(e){return new hw(this,e)}createRenderPipeline(e){return new sw(this,e)}beginRenderPass(e){return new ow(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new lw(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,r){return uk(e,r)}readPixelsToBufferWebGL(e,r){return hk(e,r)}setParametersWebGL(e){Bc(this.gl,e)}getParametersWebGL(e){return $v(this.gl,e)}withParametersWebGL(e,r){return hA(this.gl,e,r)}resetWebGL(){Vt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),LF(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return GF(this.gl,e,this._extensions)}loseDevice(){let e=!1,i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Lc.get(this.gl).push()}popState(){Lc.get(this.gl).pop()}setSpectorMetadata(e,r){e.__SPECTOR_Metadata=r}getGLKey(e,r){let i=Number(e);for(let n in this.gl)if(this.gl[n]===i)return`GL.${n}`;return r?.emptyIfUnknown?"":String(e)}getGLKeys(e){let r={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[n,o])=>(i[`${n}:${this.getGLKey(n,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}_constants;setConstantAttributeWebGL(e,r){let i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);let n=this._constants[e];switch(n&&loe(n,r)&&Vt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:ooe(this,e,r);break;case Int32Array:soe(this,e,r);break;case Uint32Array:aoe(this,e,r);break;default:throw new Error("constant")}}getExtension(e){return zu(this.gl,e,this._extensions),this._extensions}};function ooe(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break;default:}}function soe(t,e,r){t.gl.vertexAttribI4iv(e,r)}function aoe(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function loe(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var coe={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},uoe=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),hoe=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),foe=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function Ek(t=!0){let e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,i){if(r==="webgl"||r==="experimental-webgl"){let n=this.originalGetContext("webgl2",i);return n instanceof HTMLElement&&doe(n),n}return this.originalGetContext(r,i)}}function doe(t){t.getExtension("EXT_color_buffer_float");let e={...coe,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:uoe(t),OES_vertex_array_object:hoe(t),ANGLE_instanced_arrays:foe(t)},r=t.getExtension;t.getExtension=function(n){let o=r.call(t,n);return o||(n in e?e[n]:null)};let i=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(i.apply(t)||[])?.concat(Object.keys(e))}}var fw=1,LM=class extends K_{type="webgl";constructor(){super(),El.defaultProps={...El.defaultProps,...ew},Dc.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){Ek(e)}async attach(e){if(e instanceof Dc)return e;if(e?.device instanceof El)return e.device;if(!poe(e))throw new Error("Invalid WebGL2RenderingContext");return new Dc({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){Vt.groupCollapsed(fw,"WebGLDevice created")();let r=[];(e.debugWebGL||e.debug)&&r.push(KF()),e.debugSpectorJS&&r.push(qF(e));let i=await Promise.allSettled(r);for(let a of i)a.status==="rejected"&&Vt.error(`Failed to initialize debug libraries ${a.reason}`)();let n=new Dc(e),o=`${n._reused?"Reusing":"Created"} device with WebGL2 ${n.debug?"debug ":""}context: ${n.info.vendor}, ${n.info.renderer} for canvas: ${n.canvasContext.id}`;return Vt.probe(fw,o)(),Vt.table(fw,n.info)(),Vt.groupEnd(fw)(),n}};function poe(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}var dw=new LM;function vd(){}var Aoe=({isDragging:t})=>t?"grabbing":"grab",Ck={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:vd,onWebGLInitialized:vd,onResize:vd,onViewStateChange:vd,onInteractionStateChange:vd,onBeforeRender:vd,onAfterRender:vd,onLoad:vd,onError:t=>cr.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Aoe,getTooltip:null,debug:!1,drawPickingColors:!1},oy=class{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Gs({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{let{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{let o=i.offsetCenter;if(!o)return;n.x=o.x,n.y=o.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{let n=R1[i.type],o=i.offsetCenter;if(!n||!o||!this.layerManager)return;let a=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:a,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:h}=c,p=h&&(h[n]||h.props[n]),x=this.props[n],T=!1;p&&(T=p.call(h,c,i)),T||(x?.(c,i),this.widgetManager.onEvent(c,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;let n=i.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...Ck,...e},e=this.props,e.viewState&&e.initialViewState&&cr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&cr.error("WebGL1 context not supported.")(),r=dw.attach(e.gl)),r||(r=$0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[dw],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Mc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&cr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&cr.removed("onLayerClick","onClick")(),e.initialViewState&&!An(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return r=r||i||n||o||a,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return yn(this.viewManager),this.viewManager.views}getViewports(e){return yn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(let i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:r})}_removeResources(e){for(let r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,i){yn(this.deckPicker);let{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(r).timeStart();let o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(r).timeEnd(),o}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),yn(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;let{width:r,height:i}=e;if(r||r===0){let n=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=n}if(i||i===0){let n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let r=e.clientWidth??e.width,i=e.clientHeight??e.height;(r!==this.width||i!==this.height)&&(this.width=r,this.height=i,this.viewManager?.setProps({width:r,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:i}))}_createAnimationLoop(e,r){let{gl:i,onError:n,useDevicePixels:o}=r;return new N1({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new X1({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:e}=this;if(e.event){let{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let n=i,o=!1;for(let a of r)n=a,o=a.layer?.onHover(a,e.event)||o;o||(this.props.onHover?.(n,e.event),this.widgetManager.onHover(n,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);let r=new rA;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new P1(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(rM).map(n=>{let[o,a,c,h]=rM[n],p=this.props.eventRecognizerOptions?.[n],x={...a,...p,event:n};return{recognizer:new o(x),recognizeWith:c,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let n in R1)this.eventManager.on(n,this._onEvent);this.viewManager=new G1({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let i=this.viewManager.getViewports()[0];this.layerManager=new j1(this.device,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new Y1({deck:this,device:this.device}),this.deckRenderer=new Q1(this.device),this.deckPicker=new J1(this.device),this.widgetManager=new Wv({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new ey),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){let{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});let o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),cr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let i=$0.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}};oy.defaultProps=Ck;oy.VERSION=AO;var vm=oy;function Sk(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return s1(t)}}var Ik=vb;function sy(t,e,r){let i=r==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function wd(t){return t.stride||t.size*t.bytesPerElement}function Mk(t,e){return t.type===e.type&&t.size===e.size&&wd(t)===wd(e)&&(t.offset||0)===(e.offset||0)}function OM(t,e){e.offset&&cr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=wd(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,n=e.elementOffset||0,o=i*r+n*t.bytesPerElement+(t.offset||0);return{...e,offset:o,stride:r}}function moe(t,e){let r=OM(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}var ay=class{constructor(e,r,i){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;let n=r.logicalType||r.type,o=n==="float64",{defaultValue:a}=r;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let c;o?c="float32":!n&&r.isIndexed?c="uint32":c=n||"float32";let h=Sk(n||c);this.doublePrecision=o,o&&r.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...r,defaultType:h,defaultValue:a,logicalType:n,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*wd(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Mc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){let i={};if(this.state.constant){let n=this.value;if(r){let o=OM(this.getAccessor(),r),a=o.offset/n.BYTES_PER_ELEMENT,c=o.size||this.size;i[e]=n.subarray(a,a+c)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,r=null){let i=this.getAccessor(),n=[],o={name:this.id,byteStride:wd(i),attributes:n};if(this.doublePrecision){let a=moe(i,r||{});n.push(sy(e,{...i,...a.high},this.device.type),sy(`${e}64Low`,{...i,...a.low},this.device.type))}else if(r){let a=OM(i,r);n.push(sy(e,{...i,...a},this.device.type))}else n.push(sy(e,i,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let r=Array.from(this.value);e=[r,r]}else{let{value:r,numInstances:i,size:n}=this,o=i*n;if(r&&o&&r.length>=o){let a=new Array(n).fill(1/0),c=new Array(n).fill(-1/0);for(let h=0;h<o;)for(let p=0;p<n;p++){let x=r[h++];x<a[p]&&(a[p]=x),x>c[p]&&(c[p]=x)}e=[a,c]}}return this.state.bounds=e,e}setData(e){let{state:r}=this,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof qi?i={buffer:e}:i=e;let n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{let a=Ik(i.value);n.type=n.normalized?a.replace("int","norm"):a}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=wd(n)}if(r.bounds=null,i.constant){let o=i.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!r.constant||!this._areValuesEqual(o,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(i.buffer){let o=i.buffer;r.externalBuffer=o,r.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let o=i.value;r.externalBuffer=null,r.constant=!1,this.value=o;let{buffer:a}=this,c=wd(n),h=(n.vertexOffset||0)*c;if(this.doublePrecision&&o instanceof Float64Array&&(o=Lv(o,n)),this.settings.isIndexed){let x=this.settings.defaultType;o.constructor!==x&&(o=new x(o))}let p=o.byteLength+h+c*2;(!a||a.byteLength<p)&&(a=this._createBuffer(p)),a.write(o,h)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;let r=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?Lv(r,{size:this.size,startIndex:i,endIndex:n}):r.subarray(i,n),i*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){let{state:i}=this,n=i.allocatedValue,o=Mc.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=o;let{byteOffset:a}=this,{buffer:c}=this;return(!c||c.byteLength<o.byteLength+a)&&(c=this._createBuffer(o.byteLength+a),r&&n&&c.write(n instanceof Float64Array?Lv(n,this):n,a)),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let i=this.settings.defaultType,n=!1;if(this.doublePrecision&&(n=r.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof i)&&this.settings.normalized&&!("normalized"in e)&&cr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,i){let{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return r[i]=e,r;if(!e){let a=o;for(;--a>=0;)r[i+a]=n[a];return r}switch(o){case 4:r[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:r[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:r[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:r[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let a=o;for(;--a>=0;)r[i+a]=Number.isFinite(e[a])?e[a]:n[a]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;let{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==r[n])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(r?qi.INDEX:qi.VERTEX)|qi.COPY_DST,indexType:r?i:void 0,byteLength:e}),this._buffer}};var Pk=[],Rk=[];function Ro(t,e=0,r=1/0){let i=Pk,n={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(Rk.length=t.length,i=Rk):i=Pk,(e>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,r),n.index=e-1),{iterable:i,objectInfo:n}}function pw(t){return t&&t[Symbol.asyncIterator]}function Aw(t,e){let{size:r,stride:i,offset:n,startIndices:o,nested:a}=e,c=t.BYTES_PER_ELEMENT,h=i?i/c:r,p=n?n/c:0,x=Math.floor((t.length-p)/h);return(T,{index:R,target:k})=>{if(!o){let re=R*h+p;for(let ee=0;ee<r;ee++)k[ee]=t[re+ee];return k}let j=o[R],q=o[R+1]||x,Z;if(a){Z=new Array(q-j);for(let re=j;re<q;re++){let ee=re*h+p;k=new Array(r);for(let se=0;se<r;se++)k[se]=t[ee+se];Z[re-j]=k}}else if(h===r)Z=t.subarray(j*r+p,q*r+p);else{Z=new t.constructor((q-j)*r);let re=0;for(let ee=j;ee<q;ee++){let se=ee*h+p;for(let me=0;me<r;me++)Z[re++]=t[se+me]}}return Z}}var Bk=[],ly=[[0,1/0]];function Lk(t,e){if(t===ly||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;let r=[],i=t.length,n=0;for(let o=0;o<i;o++){let a=t[o];a[1]<e[0]?(r.push(a),n=o+1):a[0]>e[1]?r.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return r.splice(n,0,e),r}var _oe={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function mw(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});let r=t.type||"interpolation";return{..._oe[r],...e,...t,type:r}}var fA=class extends ay{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:ly}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!Mk(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:r}=this.settings,i=this.settings.transition,n=Array.isArray(r)?e[r.find(o=>e[o])]:e[r];return mw(n,i)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){let{startRow:i=0,endRow:n=1/0}=r;this.state.updateRanges=Lk(this.state.updateRanges,[i,n])}else this.state.updateRanges=ly}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Bk}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,r.updateRanges!==ly),!0):!1}updateBuffer({numInstances:e,data:r,props:i,context:n}){if(!this.needsUpdate())return!1;let{state:{updateRanges:o},settings:{update:a,noAlloc:c}}=this,h=!0;if(a){for(let[p,x]of o)a.call(n,this,{data:r,startRow:p,endRow:x,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[p,x]of o){let T=Number.isFinite(p)?this.getVertexOffset(p):0,R=Number.isFinite(x)?this.getVertexOffset(x):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:R})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){let{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){let{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let a=e;yn(ArrayBuffer.isView(a.value),`invalid ${n.accessor}`);let c=!!a.size&&a.size!==this.size;return i.binaryAccessor=Aw(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:r,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(let i in e)Object.assign(r,super.getValue(i,e[i]));return r}getBufferLayout(e){this.state.layoutChanged=!1;let r=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!r)return i;for(let o in r){let a=super._getBufferLayout(o,r[o]);i.attributes.push(...a.attributes)}return i}_autoUpdater(e,{data:r,startRow:i,endRow:n,props:o,numInstances:a}){if(e.constant&&this.context.device.type!=="webgpu")return;let{settings:c,state:h,value:p,size:x,startIndices:T}=e,{accessor:R,transform:k}=c,j=h.binaryAccessor||(typeof R=="function"?R:o[R]);typeof j!="function"&&(j=()=>j),yn(typeof j=="function",`accessor "${R}" is not a function`);let q=e.getVertexOffset(i),{iterable:Z,objectInfo:re}=Ro(r,i,n);for(let ee of Z){re.index++;let se=j(ee,re);if(k&&(se=k.call(this,se)),T){let me=(re.index<T.length-1?T[re.index+1]:a)-T[re.index];if(se&&Array.isArray(se[0])){let Le=q;for(let je of se)e._normalizeValue(je,p,Le),Le+=x}else se&&se.length>x?p.set(se,q):(e._normalizeValue(se,re.target,0),gM({target:p,source:re.target,start:q,count:me}));q+=me*x}else e._normalizeValue(se,p,q),q+=x}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function DM(t){let{source:e,target:r,start:i=0,size:n,getData:o}=t,a=t.end||r.length,c=e.length,h=a-i;if(c>h){r.set(e.subarray(0,h),i);return}if(r.set(e,i),!o)return;let p=c;for(;p<h;){let x=o(p,e);for(let T=0;T<n;T++)r[i+p]=x[T]||0,p++}}function Ok({source:t,target:e,size:r,getData:i,sourceStartIndices:n,targetStartIndices:o}){if(!n||!o)return DM({source:t,target:e,size:r,getData:i}),e;let a=0,c=0,h=i&&((x,T)=>i(x+c,T)),p=Math.min(n.length,o.length);for(let x=1;x<p;x++){let T=n[x]*r,R=o[x]*r;DM({source:t.subarray(a,T),target:e,start:c,end:R,size:r,getData:h}),a=T,c=R}return c<e.length&&DM({source:[],target:e,start:c,size:r,getData:h}),e}function Dk(t){let{device:e,settings:r,value:i}=t,n=new fA(e,r);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),n}function gw(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function _w(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function yw(t){t.push(t.shift())}function Fk(t,e){let{doublePrecision:r,settings:i,value:n,size:o}=t,a=r&&n instanceof Float64Array?2:1,c=0,{shaderAttributes:h}=t.settings;if(h)for(let p of Object.values(h))c=Math.max(c,p.vertexOffset??0);return(i.noAlloc?n.length:(e+c)*o)*a}function xw({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function bw({device:t,buffer:e,attribute:r,fromLength:i,toLength:n,fromStartIndices:o,getData:a=c=>c}){let c=r.doublePrecision&&r.value instanceof Float64Array?2:1,h=r.size*c,p=r.byteOffset,x=r.settings.bytesPerElement<4?p/r.settings.bytesPerElement*4:p,T=r.startIndices,R=o&&T,k=r.isConstant;if(!R&&e&&i>=n)return e;let j=r.value instanceof Float64Array?Float32Array:r.value.constructor,q=k?r.value:new j(r.getBuffer().readSyncWebGL(p,n*j.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!k){let se=a;a=(me,Le)=>r.normalizeConstant(se(me,Le))}let Z=k?(se,me)=>a(q,me):(se,me)=>a(q.subarray(se+p,se+p+h),me),re=e?new Float32Array(e.readSyncWebGL(x,i*4).buffer):new Float32Array(0),ee=new Float32Array(n);return Ok({source:re,target:ee,sourceStartIndices:o,targetStartIndices:T,size:h,getData:Z}),(!e||e.byteLength<ee.byteLength+x)&&(e?.destroy(),e=t.createBuffer({byteLength:ee.byteLength+x,usage:35050})),e.write(ee,x),e}var wm=class{constructor({device:e,attribute:r,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Rc(i),this.attribute=r,this.attributeInTransition=Dk(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Fk(this.attribute,r),this.transition.start({...e,duration:i})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let e of this.buffers)e.destroy();this.buffers.length=0}};var cy=class extends wm{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="interpolation",this.transform=voe(e,r)}start(e,r){let i=this.currentLength,n=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}let{buffers:o,attribute:a}=this;yw(o),o[0]=bw({device:this.device,buffer:o[0],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),o[1]=xw({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);let{transform:c}=this,h=c.model,p=Math.floor(this.currentLength/a.size);Nk(a)&&(p/=2),h.setVertexCount(p),a.isConstant?(h.setAttributes({aFrom:o[0]}),h.setConstantAttributes({aTo:a.value})):h.setAttributes({aFrom:o[0],aTo:a.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){let{duration:e,easing:r}=this.settings,{time:i}=this.transition,n=i/e;r&&(n=r(n));let{model:o}=this.transform,a={time:n};o.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},yoe=`uniform interpolationUniforms {
  float time;
} interpolation;
`,kk={name:"interpolation",vs:yoe,uniformTypes:{time:"f32"}},xoe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,boe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Nk(t){return t.doublePrecision&&t.value instanceof Float64Array}function voe(t,e){let r=e.size,i=gw(r),n=_w(r),o=e.getBufferLayout();return Nk(e)?new Du(t,{vs:boe,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*r}]}],modules:[HI,kk],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Du(t,{vs:xoe,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:o.attributes[0].format}],modules:[kk],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}var uy=class extends wm{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="spring",this.texture=Ioe(e),this.framebuffer=Moe(e,this.texture),this.transform=Soe(e,r)}start(e,r){let i=this.currentLength,n=this.currentStartIndices;super.start(e,r);let{buffers:o,attribute:a}=this;for(let h=0;h<2;h++)o[h]=bw({device:this.device,buffer:o[h],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});o[2]=xw({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);let{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?c.setConstantAttributes({aTo:a.value}):c.setAttributes({aTo:a.getBuffer()})}onUpdate(){let{buffers:e,transform:r,framebuffer:i,transition:n}=this,o=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});let a={stiffness:o.stiffness,damping:o.damping};r.model.shaderInputs.setProps({spring:a}),r.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),yw(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},woe=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Toe={name:"spring",vs:woe,uniformTypes:{damping:"f32",stiffness:"f32"}},Eoe=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Coe=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function Soe(t,e){let r=gw(e.size),i=_w(e.size);return new Du(t,{vs:Eoe,fs:Coe,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Toe],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Ioe(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Moe(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}var Poe={interpolation:cy,spring:uy},hy=class{constructor(e,{id:r,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:i}){this.numInstances=i||1;for(let n in e){let o=e[n],a=o.getTransitionSetting(r);a&&this._updateAttribute(n,o,a)}for(let n in this.transitions){let o=e[n];(!o||!o.getTransitionSetting(r))&&this._removeTransition(n)}}hasAttribute(e){let r=this.transitions[e];return r&&r.inProgress}getAttributes(){let e={};for(let r in this.transitions){let i=this.transitions[r];i.inProgress&&(e[r]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,i){let n=this.transitions[e],o=!n||n.type!==i.type;if(o){n&&this._removeTransition(e);let a=Poe[i.type];a?this.transitions[e]=new a({attribute:r,timeline:this.timeline,device:this.device}):(cr.error(`unsupported transition type '${i.type}'`)(),o=!1)}(o||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}};var zk="attributeManager.invalidate",Roe="attributeManager.updateStart",Boe="attributeManager.updateEnd",Loe="attribute.updateStart",Ooe="attribute.allocate",Doe="attribute.updateEnd",Fl=class{constructor(e,{id:r="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=Lu(lF),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new hy(e,{id:`${r}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){let i=this._invalidateTrigger(e,r);mo(zk,this,e,i)}invalidateAll(e){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);mo(zk,this,"all")}update({data:e,numInstances:r,startIndices:i=null,transitions:n,props:o={},buffers:a={},context:c={}}){let h=!1;mo(Roe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let p in this.attributes){let x=this.attributes[p],T=x.settings.accessor;x.startIndices=i,x.numInstances=r,o[p]&&cr.removed(`props.${p}`,`data.attributes.${p}`)(),x.setExternalBuffer(a[p])||x.setBinaryValue(typeof T=="string"?a[T]:void 0,e.startIndices)||typeof T=="string"&&!a[T]&&x.setConstantValue(o[T])||x.needsUpdate()&&(h=!0,this._updateAttribute({attribute:x,numInstances:r,data:e,props:o,context:c})),this.needsRedraw=this.needsRedraw||x.needsRedraw()}h&&mo(Boe,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:n})}updateTransition(){let{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let r=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(let o in r){let a=r[o];a.needsRedraw(e)&&!i.hasAttribute(o)&&(n[o]=a)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(let i in e){let n=e[i],o={...n,id:i,size:n.isIndexed&&1||n.size||1,...r};this.attributes[i]=new fA(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){let{attributes:i,updateTriggers:n}=this,o=n[e];return o&&o.forEach(a=>{let c=i[a];c&&c.setNeedsUpdate(c.id,r)}),o}_updateAttribute(e){let{attribute:r,numInstances:i}=e;if(mo(Loe,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&mo(Ooe,r,i),r.updateBuffer(e)&&(this.needsRedraw=!0,mo(Doe,r,i))}};var fy=class extends Rc{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:r,toValue:i,duration:n,easing:o}}=this,a=o(e/n);this._value=Ds(r,i,a)}};var Uk=1e-5;function Vk(t,e,r,i,n){let o=e-t,c=(r-e)*n,h=-o*i;return c+h+o+e}function Foe(t,e,r,i,n){if(Array.isArray(r)){let o=[];for(let a=0;a<r.length;a++)o[a]=Vk(t[a],e[a],r[a],i,n);return o}return Vk(t,e,r,i,n)}function jk(t,e){if(Array.isArray(t)){let r=0;for(let i=0;i<t.length;i++){let n=t[i]-e[i];r+=n*n}return Math.sqrt(r)}return Math.abs(t-e)}var dy=class extends Rc{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:r,damping:i,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:a=e}=this,c=Foe(o,a,r,i,n),h=jk(c,r),p=jk(c,a);h<Uk&&p<Uk&&(c=r,this.end()),this._prevValue=a,this._currValue=c}};var koe={interpolation:fy,spring:dy},py=class{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,i,n){let{transitions:o}=this;if(o.has(e)){let h=o.get(e),{value:p=h.settings.fromValue}=h;r=p,this.remove(e)}if(n=mw(n),!n)return;let a=koe[n.type];if(!a){cr.error(`unsupported transition type '${n.type}'`)();return}let c=new a(this.timeline);c.start({...n,fromValue:r,toValue:i}),o.set(e,c)}remove(e){let{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){let e={};for(let[r,i]of this.transitions)i.update(),e[r]=i.value,i.inProgress||this.remove(r);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}};function Hk(t){let e=t[Dl];for(let r in e){let i=e[r],{validate:n}=i;if(n&&!n(t[r],i))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function Wk(t,e){let r=Ay({newProps:t,oldProps:e,propTypes:t[Dl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=zoe(t,e),n=!1;return i||(n=Uoe(t,e)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:Voe(t,e),transitionsChanged:Noe(t,e)}}function Noe(t,e){if(!t.transitions)return!1;let r={},i=t[Dl],n=!1;for(let o in t.transitions){let a=i[o],c=a&&a.type;(c==="number"||c==="color"||c==="array")&&FM(t[o],e[o],a)&&(r[o]=!0,n=!0)}return n?r:!1}function Ay({newProps:t,oldProps:e,ignoreProps:r={},propTypes:i={},triggerName:n="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(let o of Object.keys(t))if(!(o in r)){if(!(o in e))return`${n}.${o} added`;let a=FM(t[o],e[o],i[o]);if(a)return`${n}.${o} ${a}`}for(let o of Object.keys(e))if(!(o in r)){if(!(o in t))return`${n}.${o} dropped`;if(!Object.hasOwnProperty.call(t,o)){let a=FM(t[o],e[o],i[o]);if(a)return`${n}.${o} ${a}`}}return!1}function FM(t,e,r){let i=r&&r.equal;return i&&!i(t,e,r)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function zoe(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:i,_dataDiff:n}=t;return i?i(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&n&&(r=n(t.data,e.data)||r),r}function Uoe(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Gk(t,e,"all"))return{all:!0};let r={},i=!1;for(let n in t.updateTriggers)n!=="all"&&Gk(t,e,n)&&(r[n]=!0,i=!0);return i?r:!1}function Voe(t,e){if(e===null)return!0;let r=e.extensions,{extensions:i}=t;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!0;return!1}function Gk(t,e,r){let i=t.updateTriggers[r];i=i??{};let n=e.updateTriggers[r];return n=n??{},Ay({oldProps:n,newProps:i,triggerName:r})}var joe="count(): argument not an object",Goe="count(): argument not a container";function $k(t){if(!Woe(t))throw new Error(joe);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(Hoe(t))return Object.keys(t).length;throw new Error(Goe)}function Hoe(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Woe(t){return t!==null&&typeof t=="object"}function kM(t,e){if(!e)return t;let r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){let i=r.modules.findIndex(n=>n.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{let i={...t.inject};for(let n in e.inject)i[n]=(i[n]||"")+e.inject[n];r.inject=i}return r}var $oe={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},NM={};function qk(t,e,r,i){if(r instanceof on)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let n=null;r.compressed&&(n={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let o=e.createTexture({...r,sampler:{...$oe,...n,...i},mipmaps:!0});return NM[o.id]=t,o}function Zk(t,e){!e||!(e instanceof on)||NM[e.id]===t&&(e.delete(),delete NM[e.id])}var qoe={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||zM(t)&&(t.length===3||t.length===4)},equal(t,e,r){return An(t,e,1)}},accessor:{validate(t,e){let r=vw(t);return r==="function"||r===vw(e.value)},equal(t,e,r){return typeof e=="function"?!0:An(t,e,1)}},array:{validate(t,e){return e.optional&&!t||zM(t)},equal(t,e,r){let{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?An(t,e,n):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;let{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?An(t,e,n):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;let{dataTransform:i}=r.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{let i=r.context;return!i||!i.device?null:qk(r.id,i.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{Zk(r.id,t)}}};function Xk(t){let e={},r={},i={};for(let[n,o]of Object.entries(t)){let a=o?.deprecatedFor;if(a)i[n]=Array.isArray(a)?a:[a];else{let c=Zoe(n,o);e[n]=c,r[n]=c.value}}return{propTypes:e,defaultProps:r,deprecatedProps:i}}function Zoe(t,e){switch(vw(e)){case"object":return my(t,e);case"array":return my(t,{type:"array",value:e,compare:!1});case"boolean":return my(t,{type:"boolean",value:e});case"number":return my(t,{type:"number",value:e});case"function":return my(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function my(t,e){return"type"in e?{name:t,...qoe[e.type],...e}:"value"in e?{name:t,type:vw(e.value),...e}:{name:t,type:"object",value:e}}function zM(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function vw(t){return zM(t)?"array":t===null?"null":typeof t}function Yk(t,e){let r;for(let o=e.length-1;o>=0;o--){let a=e[o];"extensions"in a&&(r=a.extensions)}let i=UM(t.constructor,r),n=Object.create(i);n[_m]=t,n[ku]={},n[Pc]={};for(let o=0;o<e.length;++o){let a=e[o];for(let c in a)n[c]=a[c]}return Object.freeze(n),n}var Xoe="_mergedDefaultProps";function UM(t,e){if(!(t instanceof ww.constructor))return{};let r=Xoe;if(e)for(let n of e){let o=n.constructor;o&&(r+=`:${o.extensionName||o.name}`)}let i=Kk(t,r);return i||(t[r]=Yoe(t,e||[]))}function Yoe(t,e){if(!t.prototype)return null;let i=Object.getPrototypeOf(t),n=UM(i),o=Kk(t,"defaultProps")||{},a=Xk(o),c=Object.assign(Object.create(null),n,a.defaultProps),h=Object.assign(Object.create(null),n?.[Dl],a.propTypes),p=Object.assign(Object.create(null),n?.[jv],a.deprecatedProps);for(let x of e){let T=UM(x.constructor);T&&(Object.assign(c,T),Object.assign(h,T[Dl]),Object.assign(p,T[jv]))}return Koe(c,t),Joe(c,h),Qoe(c,p),c[Dl]=h,c[jv]=p,e.length===0&&!VM(t,"_propTypes")&&(t._propTypes=h),c}function Koe(t,e){let r=tse(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function Qoe(t,e){for(let r in e)Object.defineProperty(t,r,{enumerable:!1,set(i){let n=`${this.id}: ${r}`;for(let o of e[r])VM(this,o)||(this[o]=i);cr.deprecated(n,e[r].join("/"))()}})}function Joe(t,e){let r={},i={};for(let n in e){let o=e[n],{name:a,value:c}=o;o.async&&(r[a]=c,i[a]=ese(a))}t[Wh]=r,t[ku]={},Object.defineProperties(t,i)}function ese(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||pw(e)?this[ku][t]=e:this[Pc][t]=e},get(){if(this[Pc]){if(t in this[Pc])return this[Pc][t]||this[Wh][t];if(t in this[ku]){let e=this[_m]&&this[_m].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Wh][t]}}return this[Wh][t]}}}function VM(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Kk(t,e){return VM(t,e)&&t[e]}function tse(t){let e=t.componentName;return e||cr.warn(`${t.name}.componentName not specified`)(),e||t.name}var rse=0,gy=class{constructor(...e){this.props=Yk(this,e),this.id=this.props.id,this.count=rse++}clone(e){let{props:r}=this,i={};for(let n in r[Wh])n in r[Pc]?i[n]=r[Pc][n]:n in r[ku]&&(i[n]=r[ku][n]);return new this.constructor({...r,...i,...e})}};gy.componentName="Component";gy.defaultProps={};var ww=gy;var ise=Object.freeze({}),_y=class{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||ise}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){let r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[_m]||this.component;let r=e[Pc]||{},i=e[ku]||e,n=e[Wh]||{};for(let o in r){let a=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,a),r[o]=this.getAsyncProp(o)}for(let o in i){let a=i[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,a)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(pw(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){let i=this.asyncProps[e];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();let i=this.asyncProps[e];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,r,i){let n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=r,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){let i=this.asyncProps[e];if(i){i.pendingLoadCount++;let n=i.pendingLoadCount;r.then(o=>{this.component&&(o=this._postProcessValue(i,o),this._setAsyncPropValue(e,o,n),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}let i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;let n=i.pendingLoadCount,o=[],a=0;for await(let c of r){if(!this.component)return;let{dataTransform:h}=this.component.props;h?o=h(c,o):o=o.concat(c),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:a,endRow:o.length}]}),a=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,r){let i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){let n=this.component&&this.component.props[Dl];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var yy=class extends _y{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){let i=this.layer,n=i?.props.fetch;return n?n(r,{propName:e,layer:i}):super._fetch(e,r)}_onResolve(e,r){let i=this.layer;if(i){let n=i.props.onDataLoad;e==="data"&&n&&n(r,{propName:e,layer:i})}}_onError(e,r){let i=this.layer;i&&i.raiseError(r,`loading ${e} of ${this.layer}`)}};var nse="layer.changeFlag",ose="layer.initialize",sse="layer.update",ase="layer.finalize",lse="layer.matched",Qk=2**24-1,cse=Object.freeze([]),use=Lu(({oldViewport:t,viewport:e})=>t.equals(e)),Fc=new Uint8ClampedArray(0),hse={data:{type:"data",value:cse,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:i,loadOptions:n,signal:o})=>{let{resourceManager:a}=r.context;n=n||r.getLoadOptions(),i=i||r.props.loaders,o&&(n={...n,fetch:{...n?.fetch,signal:o}});let c=a.contains(t);return!c&&!n&&(a.add({resourceId:t,data:ys(t,i),persistent:!1}),c=!0),c?a.subscribe({resourceId:t,onChange:h=>r.internalState?.reloadAsyncProp(e,h),consumerId:r.id,requestId:e}):ys(t,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:vr.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},xy=class extends ww{constructor(){super(...arguments),this.internalState=null,this.lifecycle=yd.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){yn(this.internalState);let r=this.internalState.viewport||this.context.viewport,i=dM(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,a]=fm(i,r.pixelProjectionMatrix);return e.length===2?[n,o]:[n,o,a]}unproject(e){return yn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){yn(this.internalState);let i=this.internalState.viewport||this.context.viewport;return hF(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===vr.DEFAULT||e===vr.LNGLAT||e===vr.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){yn(e instanceof Uint8Array);let[r,i,n]=e;return r+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:$k(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=kM(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let r of this.props.extensions)e=kM(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let r=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&r)if(Array.isArray(i))for(let n of i)r.invalidateAll(n);else r.invalidateAll();if(r){let{props:n}=e,o=this.internalState.hasPickingBuffer,a=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(o!==a){this.internalState.hasPickingBuffer=a;let{pickingColors:c,instancePickingColors:h}=r.attributes,p=c||h;p&&(a&&p.constant&&(p.constant=!1,r.invalidate(p.id)),!p.value&&!a&&(p.constant=!0,p.value=[0,0,0]))}}}finalizeState(e){for(let i of this.getModels())i.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:i}){let{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=e,(!r||!use({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(let i in e)e[i].layoutChanged()&&(r=!0);for(let i of this.getModels())this._setModelAttributes(i,e,r)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let r=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:r.data,numInstances:i,startIndices:n,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let r=e.update(),i=Object.create(this.props);for(let n in r)Object.defineProperty(i,n,{value:r[n]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;let i=Math.floor(Fc.length/4);if(this.internalState.usesPickingColorCache=!0,i<r){r>Qk&&cr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Fc=Mc.allocate(Fc,r,{size:4,copy:!0,maxCount:Math.max(r,Qk)});let n=Math.floor(Fc.length/4),o=[0,0,0];for(let a=i;a<n;a++)this.encodePickingColor(a,o),Fc[a*4+0]=o[0],Fc[a*4+1]=o[1],Fc[a*4+2]=o[2],Fc[a*4+3]=0}e.value=Fc.subarray(0,r*4)}_setModelAttributes(e,r,i=!1){if(!Object.keys(r).length)return;if(i){let c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),r=c.getAttributes()}let n=e.userData?.excludeAttributes||{},o={},a={};for(let c in r){if(n[c])continue;let h=r[c].getValue();for(let p in h){let x=h[p];x instanceof qi?r[c].settings.isIndexed?e.setIndexBuffer(x):o[p]=x:x&&(a[p]=x)}}e.setAttributes(o),e.setConstantAttributes(a)}disablePickingIndex(e){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}let{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,o=i||n,a=o&&r.attributes&&r.attributes[o.id];if(a&&a.value){let c=a.value,h=this.encodePickingColor(e);for(let p=0;p<r.length;p++){let x=o.getVertexOffset(p);c[x]===h[0]&&c[x+1]===h[1]&&c[x+2]===h[2]&&this._disablePickingIndex(p)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i;if(!n)return;let o=n.getVertexOffset(e),a=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(a-o),o)}restorePickingColors(){let{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,i=e||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Fc.buffer&&(i.value=Fc.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){yn(!this.internalState),yn(Number.isFinite(this.props.coordinateSystem)),mo(ose,this);let e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new yy({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(cr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new py(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){mo(lse,this,this===e);let{state:r,internalState:i}=e;this!==e&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(mo(sse,this,e),!e)return;let r=this.props,i=this.context,n=this.internalState,o=i.viewport,a=this._updateUniformTransition();n.propsInTransition=a,i.viewport=n.viewport||o,this.props=a;try{let c=this._getUpdateParams(),h=this.getModels();if(i.device)this.updateState(c);else try{this.updateState(c)}catch{}for(let x of this.props.extensions)x.updateState.call(this,c,x);this.setNeedsRedraw(),this._updateAttributes();let p=this.getModels()[0]!==h[0];this._postUpdate(c,p)}finally{i.viewport=o,this.props=r,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){mo(ase,this),this.finalizeState(this.context);for(let e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();let o=this.props,a=this.context;this.props=this.internalState.propsInTransition||o;try{r&&this.setShaderModuleProps(r);let{getPolygonOffset:c}=this.props,h=c&&c(i)||[0,0];a.device instanceof Dc&&a.device.setParametersWebGL({polygonOffset:h});for(let p of this.getModels())p.device.type==="webgpu"?p.setParameters({...p.parameters,...n}):p.setParameters(n);if(a.device instanceof Dc)a.device.withParametersWebGL(n,()=>{let p={renderPass:e,shaderModuleProps:r,uniforms:i,parameters:n,context:a};for(let x of this.props.extensions)x.draw.call(this,p,x);this.draw(p)});else{let p={renderPass:e,shaderModuleProps:r,uniforms:i,parameters:n,context:a};for(let x of this.props.extensions)x.draw.call(this,p,x);this.draw(p)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let n in e)if(e[n]){let o=!1;switch(n){case"dataChanged":let a=e[n],c=r[n];a&&Array.isArray(c)&&(r.dataChanged=Array.isArray(a)?c.concat(a):a,o=!0);default:r[n]||(r[n]=e[n],o=!0)}o&&mo(nse,this,n,e)}let i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){let i=Wk(e,r);if(i.updateTriggersChanged)for(let n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(i.transitionsChanged)for(let n in i.transitionsChanged)this.internalState.uniformTransitions.add(n,r[n],e[n],e.transitions?.[n]);return this.setChangeFlags(i)}validateProps(){Hk(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(r.highlightColor=i(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new Fl(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){let{props:i,oldProps:n}=e,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());let{autoHighlight:a,highlightedObjectIndex:c,highlightColor:h}=i;if(r||n.autoHighlight!==a||n.highlightedObjectIndex!==c||n.highlightColor!==h){let p={};Array.isArray(h)&&(p.highlightColor=h),(r||n.autoHighlight!==a||c!==n.highlightedObjectIndex)&&(p.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:p})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(r=r||n,r)for(let o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};xy.defaultProps=hse;xy.layerName="Layer";var ln=xy;var fse="compositeLayer.renderLayers",Tw=class extends ln{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){let{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||r}getSubLayerRow(e,r,i){return e.__source={parent:this,object:r,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){let r={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(r.index=i.__source.index,e(i.__source.object,r)):e(i,n)}return e}getSubLayerProps(e={}){let{opacity:r,pickable:i,visible:n,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:h,highlightColor:p,coordinateSystem:x,coordinateOrigin:T,wrapLongitude:R,positionFormat:k,modelMatrix:j,extensions:q,fetch:Z,operation:re,_subLayerProps:ee}=this.props,se={id:"",updateTriggers:{},opacity:r,pickable:i,visible:n,parameters:o,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:h,highlightColor:p,coordinateSystem:x,coordinateOrigin:T,wrapLongitude:R,positionFormat:k,modelMatrix:j,extensions:q,fetch:Z,operation:re},me=ee&&e.id&&ee[e.id],Le=me&&me.updateTriggers,je=e.id||"sublayer";if(me){let Je=this.props[Dl],J=e.type?e.type._propTypes:{};for(let te in me){let X=J[te]||Je[te];X&&X.type==="accessor"&&(me[te]=this.getSubLayerAccessor(me[te]))}}Object.assign(se,e,me),se.id=`${this.props.id}-${je}`,se.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...Le};for(let Je of q){let J=Je.getSubLayerProps.call(this,Je);J&&Object.assign(se,J,{updateTriggers:Object.assign(se.updateTriggers,J.updateTriggers)})}return se}_updateAutoHighlight(e){for(let r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let i=this.internalState.subLayers,n=!i||this.needsUpdate();if(n){let o=this.renderLayers();i=Ra(o,Boolean),this.internalState.subLayers=i}mo(fse,this,n,i);for(let o of i)o.parent=this}};Tw.layerName="CompositeLayer";var so=Tw;var Ew=Math.PI/180,Jk=180/Math.PI,Cw=6370972,Tm=256;function dse(){let t=Tm/Cw,e=Math.PI/180*Tm;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}var Td=class extends ol{constructor(e={}){let{longitude:r=0,zoom:i=0,nearZMultiplier:n=.5,farZMultiplier:o=1,resolution:a=10}=e,{latitude:c=0,height:h,altitude:p=1.5,fovy:x}=e;c=Math.max(Math.min(c,Ll),-Ll),h=h||1,x?p=tA(x):x=jh(p);let T=1/Math.PI/Math.cos(c*Math.PI/180),R=Math.pow(2,i)*T,k=e.nearZ??n,j=e.farZ??(p+Tm*2*R/h)*o,q=new wr().lookAt({eye:[0,-p,0],up:[0,0,1]});q.rotateX(c*Ew),q.rotateZ(-r*Ew),q.scale(R/h),super({...e,height:h,viewMatrix:q,longitude:r,latitude:c,zoom:i,distanceScales:dse(),fovy:x,focalDistance:p,near:k,far:j}),this.scale=R,this.latitude=c,this.longitude=r,this.resolution=a}get projectionMode(){return is.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let r={targetZ:e.z||0},i=this.unproject([0,this.height/2],r),n=this.unproject([this.width/2,0],r),o=this.unproject([this.width,this.height/2],r),a=this.unproject([this.width/2,this.height],r);return o[0]<this.longitude&&(o[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],o[0],n[0],a[0]),Math.min(i[1],o[1],n[1],a[1]),Math.max(i[0],o[0],n[0],a[0]),Math.max(i[1],o[1],n[1],a[1])]}unproject(e,{topLeft:r=!0,targetZ:i}={}){let[n,o,a]=e,c=r?o:this.height-o,{pixelUnprojectionMatrix:h}=this,p;if(Number.isFinite(a))p=jM(h,[n,c,a,1]);else{let k=jM(h,[n,c,-1,1]),j=jM(h,[n,c,1,1]),q=((i||0)/Cw+1)*Tm,Z=Fs.sqrLen(Fs.sub([],k,j)),re=Fs.sqrLen(k),ee=Fs.sqrLen(j),me=4*((4*re*ee-(Z-re-ee)**2)/16)/Z,Le=Math.sqrt(re-me),je=Math.sqrt(Math.max(0,q*q-me)),Je=(Le-je)/Math.sqrt(Z);p=Fs.lerp([],k,j,Je)}let[x,T,R]=this.unprojectPosition(p);return Number.isFinite(a)?[x,T,R]:Number.isFinite(i)?[x,T,i]:[x,T]}projectPosition(e){let[r,i,n=0]=e,o=r*Ew,a=i*Ew,c=Math.cos(a),h=(n/Cw+1)*Tm;return[Math.sin(o)*c*h,-Math.cos(o)*c*h,Math.sin(a)*h]}unprojectPosition(e){let[r,i,n]=e,o=Fs.len(e),a=Math.asin(n/o),h=Math.atan2(r,-i)*Jk,p=a*Jk,x=(o/Tm-1)*Cw;return[h,p,x]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,r){let i=this.unproject(r);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}};function jM(t,e){let r=Pa.transformMat4([],e,t);return Pa.scale(r,r,1/r[3]),r}var GM=class extends q1{applyConstraints(e){let{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=xs(n,i,r);let{longitude:o,latitude:a}=e;return(o<-180||o>180)&&(e.longitude=oF(o+180,360)-180),e.latitude=xs(a,-Ll,Ll),e}},by=class extends lA{constructor(){super(...arguments),this.ControllerState=GM,this.transition={transitionDuration:300,transitionInterpolator:new Zh(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}};var Sw=class extends sA{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Ou:Td}get ControllerType(){return by}};Sw.displayName="GlobeView";var HM=Sw;var vy=class{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&An(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){let{defaultProps:r}=e.constructor,i={updateTriggers:{}};for(let n in r)if(n in this.props){let o=r[n],a=this.props[n];i[n]=a,o&&o.type==="accessor"&&(i.updateTriggers[n]=this.props.updateTriggers[n],typeof a=="function"&&(i[n]=this.getSubLayerAccessor(a)))}return i}initializeState(e,r){}updateState(e,r){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,r){}finalizeState(e,r){}};vy.defaultProps={};vy.extensionName="LayerExtension";var WM=vy;var Ed=class{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;let{attributes:r={}}=e;this.typedArrayManager=Mc,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:r,buffers:i={},getGeometry:n,geometryBuffer:o,positionFormat:a,dataChanged:c,normalize:h=!0}=this.opts;if(this.data=r,this.getGeometry=n,this.positionSize=o&&o.size||(a==="XY"?2:3),this.buffers=i,this.normalize=h,o&&(yn(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),h||(i.vertexPositions=o)),this.geometryBuffer=i.vertexPositions,Array.isArray(c))for(let p of c)this._rebuildGeometry(p);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){let r=e.value||e;return ArrayBuffer.isView(r)?Aw(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){let{attributes:i,buffers:n,_attributeDefs:o,typedArrayManager:a}=this;for(let c in o)if(c in n)a.release(i[c]),i[c]=null;else{let h=o[c];h.copy=r,i[c]=a.allocate(i[c],e,h)}}_forEachGeometry(e,r,i){let{data:n,getGeometry:o}=this,{iterable:a,objectInfo:c}=Ro(n,r,i);for(let h of a){c.index++;let p=o?o(h,c):null;e(p,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:i,instanceCount:n}=this,{data:o,geometryBuffer:a}=this,{startRow:c=0,endRow:h=1/0}=e||{},p={};if(e||(r=[0],i=[0]),this.normalize||!a)this._forEachGeometry((T,R)=>{let k=T&&this.normalizeGeometry(T);p[R]=k,i[R+1]=i[R]+(k?this.getGeometrySize(k):0)},c,h),n=i[i.length-1];else if(i=o.startIndices,n=i[o.length]||0,ArrayBuffer.isView(a))n=n||a.length/this.positionSize;else if(a instanceof qi){let T=this.positionSize*4;n=n||a.byteLength/T}else if(a.buffer){let T=a.stride||this.positionSize*4;n=n||a.buffer.byteLength/T}else if(a.value){let T=a.value,R=a.stride/T.BYTES_PER_ELEMENT||this.positionSize;n=n||T.length/R}this._allocate(n,!!e),this.indexStarts=r,this.vertexStarts=i,this.instanceCount=n;let x={};this._forEachGeometry((T,R)=>{let k=p[R]||T;x.vertexStart=i[R],x.indexStart=r[R];let j=R<i.length-1?i[R+1]:n;x.geometrySize=j-i[R],x.geometryIndex=R,this.updateGeometryAttributes(k,x)},c,h),this.vertexCount=r[r.length-1]}};var $M=512,pse=Math.PI/180;function Iw({map:t,gl:e,deck:r}){if(t.__deck)return t.__deck;let i=r?.props._customRender,n=r?.props.onLoad,o={...r?.props,_customRender:()=>{t.triggerRepaint(),i?.("")}};o.parameters={...Mw(t,!0),...o.parameters},o.views||(o.views=wy(t));let a;return(!r||r.props.gl===e)&&(Object.assign(o,{gl:e,width:null,height:null,touchAction:"unset",viewState:Em(t)}),r?.isInitialized?eN(r,t):o.onLoad=()=>{n?.(),eN(a,t)}),r?(a=r,r.setProps(o),r.userData.isExternal=!0):(a=new vm(o),t.on("remove",()=>{qM(t)})),a.userData.mapboxLayers=new Set,t.__deck=a,t.on("render",()=>{a.isInitialized&&mse(a,t)}),a}function eN(t,e){let r=()=>{t.isInitialized?gse(t,e):e.off("move",r)};e.on("move",r)}function qM(t){t.__deck?.finalize(),t.__deck=null}function Mw(t,e){let r=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return oN(t)==="globe"&&(r.cullMode="back"),r}function tN(t,e){t.userData.mapboxLayers.add(e),ZM(t)}function rN(t,e){t.userData.mapboxLayers.delete(e),ZM(t)}function iN(t,e){ZM(t)}function nN(t,e,r,i){let{currentViewport:n}=t.userData,o=!1;n||(n=sN(t,e,i),t.userData.currentViewport=n,o=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:a})=>r.id===a.id||a.props.operation.includes("terrain"),clearStack:o,clearCanvas:!1})}function oN(t){let e=t.getProjection?.(),r=e?.type||e?.name;if(r==="globe")return"globe";if(r&&r!=="mercator")throw new Error("Unsupported projection");return"mercator"}function wy(t){return oN(t)==="globe"?new HM({id:"mapbox"}):new X1({id:"mapbox"})}function Em(t){let{lng:e,lat:r}=t.getCenter(),i={longitude:(e+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&Ase(t,i),i}function Ase(t,e){if(t.getFreeCameraOptions){let{position:r}=t.getFreeCameraOptions();if(!r||r.z===void 0)return;let i=t.transform.height,{longitude:n,latitude:o,pitch:a}=e,c=r.x*$M,h=(1-r.y)*$M,p=r.z*$M,x=ns([n,o]),T=c-x[0],R=h-x[1],k=Math.sqrt(T*T+R*R),j=a*pse,q=1.5*i,Z=j<.001?q*Math.cos(j)/p:q*Math.sin(j)/k;e.zoom=Math.log2(Z);let re=q*Math.cos(j)/Z,ee=p-re;e.position=[0,0,ee/eA(o)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function sN(t,e,r){let i=Em(e),n=wy(e);r&&(n.props.nearZMultiplier=.2);let o=r?.nearZ??e.transform._nearZ,a=r?.farZ??e.transform._farZ;return Number.isFinite(o)&&(i.nearZ=o/e.transform.height,i.farZ=a/e.transform.height),n.makeViewport({width:t.width,height:t.height,viewState:i})}function mse(t,e){let{mapboxLayers:r,isExternal:i}=t.userData;if(i){let n=Array.from(r,x=>x.id),a=Ra(t.props.layers,Boolean).some(x=>x&&!n.includes(x.id)),c=t.getViewports(),h=c.findIndex(x=>x.id==="mapbox"),p=c.length>1||h<0;(a||p)&&(h>=0&&(c=c.slice(),c[h]=sN(t,e)),t._drawLayers("mapbox-repaint",{viewports:c,layerFilter:x=>(!t.props.layerFilter||t.props.layerFilter(x))&&(x.viewport.id!=="mapbox"||!n.includes(x.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function gse(t,e){t.setProps({viewState:Em(e)}),t.needsRedraw({clearRedrawFlags:!0})}function ZM(t){if(t.userData.isExternal)return;let e=[];t.userData.mapboxLayers.forEach(r=>{let i=r.props.type,n=new i(r.props);e.push(n)}),t.setProps({layers:e})}var Ty=class{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,r){this.map=e,this.deck=Iw({map:e,gl:r,deck:this.props.deck}),tN(this.deck,this)}onRemove(){this.deck&&rN(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&iN(this.deck,this)}render(e,r){nN(this.deck,this.map,this,r)}};var XM="__UNDEFINED__";function Ey(t,e,r,i){if(!t||!e||!t.style||!t.style._loaded)return;let n=Ra(i,Boolean);if(r!==i){let c=Ra(r,Boolean),h=new Set(c.map(p=>p.id));for(let p of n)h.delete(p.id);for(let p of h)t.getLayer(p)&&t.removeLayer(p)}for(let c of n){let h=t.getLayer(c.id);h?(h.implementation||h).setProps(c.props):t.addLayer(new Ty({id:c.id,deck:e,slot:c.props.slot}),c.props.beforeId)}let o=t.style._order,a={};for(let c of n){let{beforeId:h}=c.props;(!h||!o.includes(h))&&(h=XM),a[h]=a[h]||[],a[h].push(c.id)}for(let c in a){let h=a[c],p=c===XM?o.length:o.indexOf(c),x=c===XM?void 0:c;for(let T=h.length-1;T>=0;T--){let R=h[T],k=o.indexOf(R);k!==p-1&&(t.moveLayer(R,x),k>p&&p++),p--,x=R}}}var dA=class{constructor(e){this._handleStyleChange=()=>{Ey(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:n,clientHeight:o}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${o}px`})}},this._updateViewState=()=>{let n=this._deck,o=this._map;n&&o&&(n.setProps({views:this._props.views||wy(o),viewState:Em(o)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{let o=this._deck;if(!o||!o.isInitialized)return;let a={type:n.type,offsetCenter:n.point,srcEvent:n},c=this._lastMouseDownPoint;switch(!n.point&&c&&(a.deltaX=n.originalEvent.clientX-c.clientX,a.deltaY=n.originalEvent.clientY-c.clientY,a.offsetCenter={x:c.x+a.deltaX,y:c.y+a.deltaY}),a.type){case"mousedown":o._onPointerDown(a),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":a.type="panstart",o._onEvent(a);break;case"drag":a.type="panmove",o._onEvent(a);break;case"dragend":a.type="panend",o._onEvent(a);break;case"click":a.tapCount=1,o._onEvent(a);break;case"dblclick":a.type="click",a.tapCount=2,o._onEvent(a);break;case"mousemove":a.type="pointermove",o._onPointerMove(a);break;case"mouseout":a.type="pointerleave",o._onPointerMove(a);break;default:return}};let{interleaved:r=!1,...i}=e;this._interleaved=r,this._props=i}setProps(e){this._interleaved&&e.layers&&Ey(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...Mw(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new vm({...this._props,parent:r,parameters:{...Mw(e,!1),...this._props.parameters},views:this._props.views||wy(e),viewState:Em(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(e){let r=e.painter.context.gl;return r instanceof WebGLRenderingContext&&cr.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Iw({map:e,gl:r,deck:new vm({...this._props,gl:r})}),e.on("styledata",this._handleStyleChange),Ey(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Ey(e,this._deck,this._props.layers,[]),qM(e)}getDefaultPosition(){return"top-left"}pickObject(e){return yn(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return yn(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return yn(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};function Cm(t,e=""){if(!t)throw new Error(`JSON conversion error ${e}`)}function lN(t,e){let r=yse(e),i=t;for(let n of r)i=_se(i)?i[n]:void 0;return i}function _se(t){return t!==null&&typeof t=="object"}var aN={};function yse(t){if(typeof t=="string"){let e=aN[t];return e||(e=t.split("."),aN[t]=e),e}return Array.isArray(t)?t:[t]}var YM=yc(cN(),1);var uN={"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"&":(t,e)=>t&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},xse={"-":t=>-t,"+":t=>+t,"~":t=>~t,"!":t=>!t};function hN(t,e){return t.map(function(r){return ws(r,e)})}function fN(t,e){let r=ws(t.object,e),i;if(t.computed?i=ws(t.property,e):i=t.property.name,/^__proto__|prototype|constructor$/.test(i))throw Error(`Access to member "${i}" disallowed.`);return[r,r[i]]}function ws(t,e){let r=t;switch(r.type){case"ArrayExpression":return hN(r.elements,e);case"BinaryExpression":return uN[r.operator](ws(r.left,e),ws(r.right,e));case"CallExpression":let i,n,o;return r.callee.type==="MemberExpression"?(o=fN(r.callee,e),i=o[0],n=o[1]):n=ws(r.callee,e),typeof n!="function"?void 0:n.apply(i,hN(r.arguments,e));case"ConditionalExpression":return ws(r.test,e)?ws(r.consequent,e):ws(r.alternate,e);case"Identifier":return e[r.name];case"Literal":return r.value;case"LogicalExpression":return r.operator==="||"?ws(r.left,e)||ws(r.right,e):r.operator==="&&"?ws(r.left,e)&&ws(r.right,e):uN[r.operator](ws(r.left,e),ws(r.right,e));case"MemberExpression":return fN(r,e)[1];case"ThisExpression":return e;case"UnaryExpression":return xse[r.operator](ws(r.argument,e));default:return}}var KM={"-":t=>t};function Sy(t,e){if(t in KM)return KM[t];let r,i=(0,YM.default)(t);return i.type==="Identifier"?r=n=>lN(n,t):(QM(i,n=>{if(n.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),r=n=>ws(i,n)),KM[t]=r,r}function QM(t,e){if(Array.isArray(t))t.forEach(r=>QM(r,e));else if(t&&typeof t=="object"){t.type&&e(t);for(let r in t)QM(t[r],e)}}var Sm="@@=",JM="@@#",dN="@@type",Rw="@@function";var pN=t=>t&&typeof t=="object",Gu=class{constructor(...e){this.typeKey=dN,this.functionKey=Rw,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=Sy,this.preProcessClassProps=(r,i)=>i,this.postProcessConvertedJson=r=>r;for(let r of e)this.merge(r)}merge(e){for(let r in e)switch(r){case"layers":case"views":Object.assign(this.classes,e[r]);break;default:if(r in this){let i=e[r];this[r]=pN(this[r])?Object.assign(this[r],i):i}}}validate(e){return Cm(!this.typeKey||typeof this.typeKey=="string"),Cm(pN(this.classes)),!0}};function bse(t){return typeof t=="string"&&t.startsWith(Sm)}function vse(t){return t.replace(Sm,"")}function Bw(t,e){let r={};for(let i in t){let n=t[i];bse(n)&&(n=vse(n),n=Sy(n,e)),r[i]=n}return r}function AN(t,e,r){let i=r.classes[t],n=r.reactComponents[t];if(!i&&!n){let{log:o}=r;if(o){let a=JSON.stringify(e,null,0).slice(0,40);o.warn(`JSON converter: No registered class of type ${t}(${a}...)  `)}return null}return i?wse(i,e,r):Tse(n,e,r)}function wse(t,e,r){return r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Bw(e,r),new t(e)}function Tse(t,e,r){let{React:i}=r,{children:n=[]}=e;return delete e.children,r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Bw(e,r),i.createElement(t,e,n)}function mN(t,e,r){let i=r.functions[t];if(!i){let{log:n}=r;if(n){let o=JSON.stringify(e,null,0).slice(0,40);n.warn(`JSON converter: No registered function ${t}(${o}...)  `)}return null}return i(e)}function e4(t){return typeof t=="string"?JSON.parse(t):t}var t4=t=>t&&typeof t=="object",Im=class{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof Gu?e.configuration:new Gu(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;let r=e4(e),i=Ese(r,this.configuration);return i=this.configuration.postProcessConvertedJson(i),this.convertedJson=i,i}convertJson(e){return this.convert(e)}};function Ese(t,e){return e=new Gu(e),r4(t,"",e)}function r4(t,e,r){return Array.isArray(t)?t.map((i,n)=>r4(i,String(n),r)):Cse(t,r)?Sse(t,r):t4(t)?Rw in t?Ise(t,r):i4(t,r):typeof t=="string"?Mse(t,e,r):t}function Cse(t,e){let{typeKey:r}=e;return t4(t)&&!!t[r]}function Sse(t,e){let{typeKey:r}=e,i=t[r],n={...t};return delete n[r],n=i4(n,e),AN(i,n,e)}function Ise(t,e){let{functionKey:r}=e,i=t[r],n={...t};return delete n[r],n=i4(n,e),mN(i,n,e)}function i4(t,e){Cm(t4(t));let r={};for(let i in t){let n=t[i];r[i]=r4(n,i,e)}return r}function Mse(t,e,r){if(t.startsWith(Sm)&&r.convertFunction)return t=t.replace(Sm,""),r.convertFunction(t,r);if(t.startsWith(JM)){if(t=t.replace(JM,""),r.constants[t])return r.constants[t];let[i,n]=t.split(".");return r.enumerations[i][n]}return t}var y4={};no(y4,{ArcLayer:()=>Ow,BitmapLayer:()=>Dw,ColumnLayer:()=>Hu,GeoJsonLayer:()=>_A,GridCellLayer:()=>f7,IconLayer:()=>Mm,LineLayer:()=>zN,PathLayer:()=>Wu,PointCloudLayer:()=>Fw,PolygonLayer:()=>Pd,ScatterplotLayer:()=>kw,SolidPolygonLayer:()=>Md,TextLayer:()=>i3,_MultiIconLayer:()=>e3,_TextBackgroundLayer:()=>r3});var gN=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,_N={name:"arc",vs:gN,fs:gN,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}};var yN=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var xN=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Lw=[0,0,0,255],Pse={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:Lw},getTargetColor:{type:"accessor",value:Lw},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Iy=class extends ln{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:yN,fs:xN,modules:[Bi,Sn,_N]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Lw},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Lw},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:o,greatCircle:a,wrapLongitude:c,numSegments:h}=this.props,p={numSegments:h,widthUnits:Dn[r],widthScale:i,widthMinPixels:n,widthMaxPixels:o,greatCircle:a,useShortestPath:c},x=this.state.model;x.shaderInputs.setProps({arc:p}),x.setVertexCount(h*2),x.draw(this.context.renderPass)}_getModel(){return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}};Iy.layerName="ArcLayer";Iy.defaultProps=Pse;var Ow=Iy;var Rse=new Uint32Array([0,2,1,0,3,2]),Bse=new Float32Array([0,1,0,0,1,0,1,1]);function n4(t,e){if(!e)return Lse(t);let r=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),n=Math.ceil(r/e)+1,o=Math.ceil(i/e)+1,a=(n-1)*(o-1)*6,c=new Uint32Array(a),h=new Float32Array(n*o*2),p=new Float64Array(n*o*3),x=0,T=0;for(let R=0;R<n;R++){let k=R/(n-1);for(let j=0;j<o;j++){let q=j/(o-1),Z=Ose(t,k,q);p[x*3+0]=Z[0],p[x*3+1]=Z[1],p[x*3+2]=Z[2]||0,h[x*2+0]=k,h[x*2+1]=1-q,R>0&&j>0&&(c[T++]=x-o,c[T++]=x-o-1,c[T++]=x-1,c[T++]=x-o,c[T++]=x-1,c[T++]=x),x++}}return{vertexCount:a,positions:p,indices:c,texCoords:h}}function Lse(t){let e=new Float64Array(12);for(let r=0;r<t.length;r++)e[r*3+0]=t[r][0],e[r*3+1]=t[r][1],e[r*3+2]=t[r][2]||0;return{vertexCount:6,positions:e,indices:Rse,texCoords:Bse}}function Ose(t,e,r){return Ds(Ds(t[0],t[1],r),Ds(t[3],t[2],r),e)}var bN=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,vN={name:"bitmap",vs:bN,fs:bN,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}};var wN=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var Dse=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,TN=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${Dse}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`;var Fse={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:vr.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},My=class extends ln{getShaders(){return super.getShaders({vs:wN,fs:TN,modules:[Bi,Sn,vN]})}initializeState(){let e=this.getAttributeManager();e.remove(["instancePickingColors"]);let r=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:e,oldProps:r,changeFlags:i}){let n=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll()),e.bounds!==r.bounds){let o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(let c in a)o&&o[c]!==a[c]&&n.invalidate(c);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{image:r}=this.props,i=e.info;if(!i.color||!r)return i.bitmap=null,i;let{width:n,height:o}=r;i.index=0;let a=kse(i.color);return i.bitmap={size:{width:n,height:o},uv:a,pixel:[Math.floor(a[0]*n),Math.floor(a[1]*o)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:e}=this.props,r=e;return EN(e)&&(r=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),n4(r,this.context.viewport.resolution)}_getModel(){return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){let{shaderModuleProps:r}=e,{model:i,coordinateConversion:n,bounds:o,disablePicking:a}=this.state,{image:c,desaturate:h,transparentColor:p,tintColor:x}=this.props;if(!(r.picking.isActive&&a)&&c&&i){let T={bitmapTexture:c,bounds:o,coordinateConversion:n,desaturate:h,tintColor:x.slice(0,3).map(R=>R/255),transparentColor:p.map(R=>R/255)};i.shaderInputs.setProps({bitmap:T}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){let{LNGLAT:e,CARTESIAN:r,DEFAULT:i}=vr,{_imageCoordinateSystem:n}=this.props;if(n!==i){let{bounds:o}=this.props;if(!EN(o))throw new Error("_imageCoordinateSystem only supports rectangular bounds");let a=this.context.viewport.resolution?e:r;if(n=n===e?e:r,n===e&&a===r)return{coordinateConversion:-1,bounds:o};if(n===r&&a===e){let c=ns([o[0],o[1]]),h=ns([o[2],o[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],h[0],h[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};My.layerName="BitmapLayer";My.defaultProps=Fse;var Dw=My;function kse(t){let[e,r,i]=t,n=(i&240)/256,o=(i&15)/16;return[(e+o)/256,(r+n)/256]}function EN(t){return Number.isFinite(t[0])}var CN=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,SN={name:"icon",vs:CN,fs:CN,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}};var IN=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`;var MN=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Nse=1024,zse=4,PN=()=>{},RN={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Use={x:0,y:0,width:0,height:0};function Vse(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function jse(t,e,r,i){let n=Math.min(r/e.width,i/e.height),o=Math.floor(e.width*n),a=Math.floor(e.height*n);return n===1?{image:e,width:o,height:a}:(t.canvas.height=a,t.canvas.width=o,t.clearRect(0,0,o,a),t.drawImage(e,0,0,e.width,e.height,0,0,o,a),{image:t.canvas,width:o,height:a})}function Py(t){return t&&(t.id||t.url)}function Gse(t,e,r,i){let{width:n,height:o,device:a}=t,c=a.createTexture({format:"rgba8unorm",width:e,height:r,sampler:i,mipmaps:!0}),h=a.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:t,destinationTexture:c,width:n,height:o}),h.finish(),t.destroy(),c}function BN(t,e,r){for(let i=0;i<e.length;i++){let{icon:n,xOffset:o}=e[i],a=Py(n);t[a]={...n,x:o,y:r}}}function Hse({icons:t,buffer:e,mapping:r={},xOffset:i=0,yOffset:n=0,rowHeight:o=0,canvasWidth:a}){let c=[];for(let h=0;h<t.length;h++){let p=t[h],x=Py(p);if(!r[x]){let{height:T,width:R}=p;i+R+e>a&&(BN(r,c,n),i=0,n=o+n+e,o=0,c=[]),c.push({icon:p,xOffset:i}),i=i+R+e,o=Math.max(o,T)}}return c.length>0&&BN(r,c,n),{mapping:r,rowHeight:o,xOffset:i,yOffset:n,canvasWidth:a,canvasHeight:Vse(o+n+e)}}function Wse(t,e,r){if(!t||!e)return null;r=r||{};let i={},{iterable:n,objectInfo:o}=Ro(t);for(let a of n){o.index++;let c=e(a,o),h=Py(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!i[h]&&(!r[h]||c.url!==r[h].url)&&(i[h]={...c,source:a,sourceIndex:o.index})}return i}var Ry=class{constructor(e,{onUpdate:r=PN,onError:i=PN}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=zse,this._canvasWidth=Nse,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let r=this._autoPacking?Py(e):e;return this._mapping[r]||Use}setProps({loadOptions:e,autoPacking:r,iconAtlas:i,iconMapping:n,textureParameters:o}){e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),n&&(this._mapping=n),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),o&&(this._samplerParameters=o)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;let i=Object.values(Wse(e,r,this._mapping)||{});if(i.length>0){let{mapping:n,xOffset:o,yOffset:a,rowHeight:c,canvasHeight:h}=Hse({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=n,this._xOffset=o,this._yOffset=a,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||RN,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Gse(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||RN)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){let r=this._canvas.getContext("2d",{willReadFrequently:!0});for(let i of e)this._pendingCount++,ys(i.url,this._loadOptions).then(n=>{let o=Py(i),a=this._mapping[o],{x:c,y:h,width:p,height:x}=a,{image:T,width:R,height:k}=jse(r,n,p,x);this._texture?.copyExternalImage({image:T,x:c+(p-R)/2,y:h+(x-k)/2,width:R,height:k}),a.width=R,a.height=k,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}};var LN=[0,0,0,255],$se={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:LN},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},By=class extends ln{getShaders(){return super.getShaders({vs:IN,fs:MN,modules:[Bi,Sn,SN]})}initializeState(){this.state={iconManager:new Ry(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:LN},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,o=this.getAttributeManager(),{iconAtlas:a,iconMapping:c,data:h,getIcon:p,textureParameters:x}=r,{iconManager:T}=this.state;if(typeof a=="string")return;let R=a||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:r.loadOptions,autoPacking:!R,iconAtlas:a,iconMapping:R?c:null,textureParameters:x}),R?i.iconMapping!==r.iconMapping&&o.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&T.packIcons(h,p),n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),o.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:o,billboard:a,alphaCutoff:c}=this.props,{iconManager:h}=this.state,p=h.getTexture();if(p){let x=this.state.model,T={iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Dn[o],sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,billboard:a,alphaCutoff:c};x.shaderInputs.setProps({icon:T}),x.draw(this.context.renderPass)}}_getModel(){let e=[-1,-1,1,-1,-1,1,1,1];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){let r=this.getCurrentLayer()?.props.onIconError;r?r(e):cr.error(e.error.message)()}getInstanceOffset(e){let{width:r,height:i,anchorX:n=r/2,anchorY:o=i/2}=this.state.iconManager.getIconMapping(e);return[r/2-n,i/2-o]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){let{x:r,y:i,width:n,height:o}=this.state.iconManager.getIconMapping(e);return[r,i,n,o]}};By.defaultProps=$se;By.layerName="IconLayer";var Mm=By;var qse=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,ON=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,DN={name:"line",source:qse,vs:ON,fs:ON,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}};var FN=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90\xB0: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`;var kN=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var NN=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Zse=[0,0,0,255],Xse={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:Zse},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Ly=class extends ln{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:kN,fs:NN,source:FN,modules:[Bi,Sn,DN]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:o,wrapLongitude:a}=this.props,c=this.state.model,h={widthUnits:Dn[r],widthScale:i,widthMinPixels:n,widthMaxPixels:o,useShortestPath:a?1:0};c.shaderInputs.setProps({line:h}),c.draw(this.context.renderPass),a&&(c.shaderInputs.setProps({line:{...h,useShortestPath:-1}}),c.draw(this.context.renderPass))}_getModel(){let e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};Ly.layerName="LineLayer";Ly.defaultProps=Xse;var zN=Ly;var UN=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,VN={name:"pointCloud",vs:UN,fs:UN,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}};var jN=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var GN=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var HN=[0,0,0,255],WN=[0,0,1],Yse={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:WN},getColor:{type:"accessor",value:HN},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Kse(t){let{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){let{size:i,value:n}=r.COLOR_0;r.instanceColors={size:i,type:"unorm8",value:n}}}var Oy=class extends ln{getShaders(){return super.getShaders({vs:jN,fs:GN,modules:[Bi,pd,Sn,VN]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:WN},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:HN}})}updateState(e){let{changeFlags:r,props:i}=e;super.updateState(e),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&Kse(i.data)}draw({uniforms:e}){let{pointSize:r,sizeUnits:i}=this.props,n=this.state.model,o={sizeUnits:Dn[i],radiusPixels:r};n.shaderInputs.setProps({pointCloud:o}),n.draw(this.context.renderPass)}_getModel(){let e=[];for(let r=0;r<3;r++){let i=r/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}};Oy.layerName="PointCloudLayer";Oy.defaultProps=Yse;var Fw=Oy;var $N=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,qN={name:"scatterplot",vs:$N,fs:$N,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}};var ZN=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var XN=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var YN=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`;var KN=[0,0,0,255],Qse={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:KN},getLineColor:{type:"accessor",value:KN},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Dy=class extends ln{getShaders(){return super.getShaders({vs:ZN,fs:XN,source:YN,modules:[Bi,Sn,qN]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:r,radiusScale:i,radiusMinPixels:n,radiusMaxPixels:o,stroked:a,filled:c,billboard:h,antialiasing:p,lineWidthUnits:x,lineWidthScale:T,lineWidthMinPixels:R,lineWidthMaxPixels:k}=this.props,j={stroked:a,filled:c,billboard:h,antialiasing:p,radiusUnits:Dn[r],radiusScale:i,radiusMinPixels:n,radiusMaxPixels:o,lineWidthUnits:Dn[x],lineWidthScale:T,lineWidthMinPixels:R,lineWidthMaxPixels:k},q=this.state.model;q.shaderInputs.setProps({scatterplot:j}),q.draw(this.context.renderPass)}_getModel(){let e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};Dy.defaultProps=Qse;Dy.layerName="ScatterplotLayer";var kw=Dy;var Pm={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function pA(t,e,r={}){return QN(t,r)!==e?(Jse(t,r),!0):!1}function QN(t,e={}){return Math.sign(Cd(t,e))}var Fy={x:0,y:1,z:2};function Cd(t,e={}){let{start:r=0,end:i=t.length,plane:n="xy"}=e,o=e.size||2,a=0,c=Fy[n[0]],h=Fy[n[1]];for(let p=r,x=i-o;p<i;p+=o)a+=(t[p+c]-t[x+c])*(t[p+h]+t[x+h]),x=p;return a/2}function Jse(t,e){let{start:r=0,end:i=t.length,size:n=2}=e,o=(i-r)/n,a=Math.floor(o/2);for(let c=0;c<a;++c){let h=r+c*n,p=r+(o-1-c)*n;for(let x=0;x<n;++x){let T=t[h+x];t[h+x]=t[p+x],t[p+x]=T}}}function s4(t,e,r=2,i,n="xy"){let o=e&&e.length,a=o?e[0]*r:t.length,c=e7(t,0,a,r,!0,i&&i[0],n),h=[];if(!c||c.next===c.prev)return h;let p,x,T,R,k,j,q;if(o&&(c=oae(t,e,c,r,i,n)),t.length>80*r){R=x=t[0],k=T=t[1];for(let Z=r;Z<a;Z+=r)j=t[Z],q=t[Z+1],j<R&&(R=j),q<k&&(k=q),j>x&&(x=j),q>T&&(T=q);p=Math.max(x-R,T-k),p=p!==0?32767/p:0}return ky(c,h,r,R,k,p,0),h}function e7(t,e,r,i,n,o,a){let c,h;o===void 0&&(o=Cd(t,{start:e,end:r,size:i,plane:a}));let p=Fy[a[0]],x=Fy[a[1]];if(n===o<0)for(c=e;c<r;c+=i)h=JN(c,t[c+p],t[c+x],h);else for(c=r-i;c>=e;c-=i)h=JN(c,t[c+p],t[c+x],h);return h&&Uw(h,h.next)&&(zy(h),h=h.next),h}function AA(t,e){if(!t)return t;e||(e=t);let r=t,i;do if(i=!1,!r.steiner&&(Uw(r,r.next)||ao(r.prev,r,r.next)===0)){if(zy(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function ky(t,e,r,i,n,o,a){if(!t)return;!a&&o&&uae(t,i,n,o);let c=t,h,p;for(;t.prev!==t.next;){if(h=t.prev,p=t.next,o?rae(t,i,n,o):tae(t)){e.push(h.i/r|0),e.push(t.i/r|0),e.push(p.i/r|0),zy(t),t=p.next,c=p.next;continue}if(t=p,t===c){a?a===1?(t=iae(AA(t),e,r),ky(t,e,r,i,n,o,2)):a===2&&nae(t,e,r,i,n,o):ky(AA(t),e,r,i,n,o,1);break}}}function tae(t){let e=t.prev,r=t,i=t.next;if(ao(e,r,i)>=0)return!1;let n=e.x,o=r.x,a=i.x,c=e.y,h=r.y,p=i.y,x=n<o?n<a?n:a:o<a?o:a,T=c<h?c<p?c:p:h<p?h:p,R=n>o?n>a?n:a:o>a?o:a,k=c>h?c>p?c:p:h>p?h:p,j=i.next;for(;j!==e;){if(j.x>=x&&j.x<=R&&j.y>=T&&j.y<=k&&Rm(n,c,o,h,a,p,j.x,j.y)&&ao(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function rae(t,e,r,i){let n=t.prev,o=t,a=t.next;if(ao(n,o,a)>=0)return!1;let c=n.x,h=o.x,p=a.x,x=n.y,T=o.y,R=a.y,k=c<h?c<p?c:p:h<p?h:p,j=x<T?x<R?x:R:T<R?T:R,q=c>h?c>p?c:p:h>p?h:p,Z=x>T?x>R?x:R:T>R?T:R,re=o4(k,j,e,r,i),ee=o4(q,Z,e,r,i),se=t.prevZ,me=t.nextZ;for(;se&&se.z>=re&&me&&me.z<=ee;){if(se.x>=k&&se.x<=q&&se.y>=j&&se.y<=Z&&se!==n&&se!==a&&Rm(c,x,h,T,p,R,se.x,se.y)&&ao(se.prev,se,se.next)>=0||(se=se.prevZ,me.x>=k&&me.x<=q&&me.y>=j&&me.y<=Z&&me!==n&&me!==a&&Rm(c,x,h,T,p,R,me.x,me.y)&&ao(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;se&&se.z>=re;){if(se.x>=k&&se.x<=q&&se.y>=j&&se.y<=Z&&se!==n&&se!==a&&Rm(c,x,h,T,p,R,se.x,se.y)&&ao(se.prev,se,se.next)>=0)return!1;se=se.prevZ}for(;me&&me.z<=ee;){if(me.x>=k&&me.x<=q&&me.y>=j&&me.y<=Z&&me!==n&&me!==a&&Rm(c,x,h,T,p,R,me.x,me.y)&&ao(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function iae(t,e,r){let i=t;do{let n=i.prev,o=i.next.next;!Uw(n,o)&&t7(n,i,i.next,o)&&Ny(n,o)&&Ny(o,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(o.i/r|0),zy(i),zy(i.next),i=t=o),i=i.next}while(i!==t);return AA(i)}function nae(t,e,r,i,n,o){let a=t;do{let c=a.next.next;for(;c!==a.prev;){if(a.i!==c.i&&dae(a,c)){let h=r7(a,c);a=AA(a,a.next),h=AA(h,h.next),ky(a,e,r,i,n,o,0),ky(h,e,r,i,n,o,0);return}c=c.next}a=a.next}while(a!==t)}function oae(t,e,r,i,n,o){let a=[],c,h,p,x,T;for(c=0,h=e.length;c<h;c++)p=e[c]*i,x=c<h-1?e[c+1]*i:t.length,T=e7(t,p,x,i,!1,n&&n[c+1],o),T===T.next&&(T.steiner=!0),a.push(fae(T));for(a.sort(sae),c=0;c<a.length;c++)r=aae(a[c],r);return r}function sae(t,e){return t.x-e.x}function aae(t,e){let r=lae(t,e);if(!r)return e;let i=r7(r,t);return AA(i,i.next),AA(r,r.next)}function lae(t,e){let r=e,i=t.x,n=t.y,o=-1/0,a;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){let R=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(R<=i&&R>o&&(o=R,a=r.x<r.next.x?r:r.next,R===i))return a}r=r.next}while(r!==e);if(!a)return null;let c=a,h=a.x,p=a.y,x=1/0,T;r=a;do i>=r.x&&r.x>=h&&i!==r.x&&Rm(n<p?i:o,n,h,p,n<p?o:i,n,r.x,r.y)&&(T=Math.abs(n-r.y)/(i-r.x),Ny(r,t)&&(T<x||T===x&&(r.x>a.x||r.x===a.x&&cae(a,r)))&&(a=r,x=T)),r=r.next;while(r!==c);return a}function cae(t,e){return ao(t.prev,t,e.prev)<0&&ao(e.next,t,t.next)<0}function uae(t,e,r,i){let n=t;do n.z===0&&(n.z=o4(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,hae(n)}function hae(t){let e,r,i=1,n,o,a,c,h,p;do{for(o=t,t=null,p=null,n=0;o;){for(n++,c=o,a=0,r=0;r<i&&(a++,c=c.nextZ,!!c);r++);for(h=i;a>0||h>0&&c;)a!==0&&(h===0||!c||o.z<=c.z)?(e=o,o=o.nextZ,a--):(e=c,c=c.nextZ,h--),p?p.nextZ=e:t=e,e.prevZ=p,p=e;o=c}p.nextZ=null,i*=2}while(n>1);return t}function o4(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function fae(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Rm(t,e,r,i,n,o,a,c){return(n-a)*(e-c)>=(t-a)*(o-c)&&(t-a)*(i-c)>=(r-a)*(e-c)&&(r-a)*(o-c)>=(n-a)*(i-c)}function dae(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!pae(t,e)&&(Ny(t,e)&&Ny(e,t)&&Aae(t,e)&&(ao(t.prev,t,e.prev)||ao(t,e.prev,e))||Uw(t,e)&&ao(t.prev,t,t.next)>0&&ao(e.prev,e,e.next)>0)}function ao(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Uw(t,e){return t.x===e.x&&t.y===e.y}function t7(t,e,r,i){let n=zw(ao(t,e,r)),o=zw(ao(t,e,i)),a=zw(ao(r,i,t)),c=zw(ao(r,i,e));return!!(n!==o&&a!==c||n===0&&Nw(t,r,e)||o===0&&Nw(t,i,e)||a===0&&Nw(r,t,i)||c===0&&Nw(r,e,i))}function Nw(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function zw(t){return t>0?1:t<0?-1:0}function pae(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&t7(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Ny(t,e){return ao(t.prev,t,t.next)<0?ao(t,e,t.next)>=0&&ao(t,t.prev,e)>=0:ao(t,e,t.prev)<0||ao(t,t.next,e)<0}function Aae(t,e){let r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function r7(t,e){let r=new Uy(t.i,t.x,t.y),i=new Uy(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function JN(t,e,r,i){let n=new Uy(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function zy(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}var Uy=class{constructor(e,r,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=r,this.y=i}};function Ba(t,e){let r=e.length,i=t.length;if(i>0){let n=!0;for(let o=0;o<r;o++)if(t[i-r+o]!==e[o]){n=!1;break}if(n)return!1}for(let n=0;n<r;n++)t[i+n]=e[n];return!0}function Vy(t,e){let r=e.length;for(let i=0;i<r;i++)t[i]=e[i]}function Sd(t,e,r,i,n=[]){let o=i+e*r;for(let a=0;a<r;a++)n[a]=t[o+a];return n}function Vw(t,e,r,i,n=[]){let o,a;if(r&8)o=(i[3]-t[1])/(e[1]-t[1]),a=3;else if(r&4)o=(i[1]-t[1])/(e[1]-t[1]),a=1;else if(r&2)o=(i[2]-t[0])/(e[0]-t[0]),a=2;else if(r&1)o=(i[0]-t[0])/(e[0]-t[0]),a=0;else return null;for(let c=0;c<t.length;c++)n[c]=(a&1)===c?i[a]:o*(e[c]-t[c])+t[c];return n}function jy(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Gy(t,e){let{size:r=2,broken:i=!1,gridResolution:n=10,gridOffset:o=[0,0],startIndex:a=0,endIndex:c=t.length}=e||{},h=(c-a)/r,p=[],x=[p],T=Sd(t,0,r,a),R,k,j=o7(T,n,o,[]),q=[];Ba(p,T);for(let Z=1;Z<h;Z++){for(R=Sd(t,Z,r,a,R),k=jy(R,j);k;){Vw(T,R,k,j,q);let re=jy(q,j);re&&(Vw(T,q,re,j,q),k=re),Ba(p,q),Vy(T,q),gae(j,n,k),i&&p.length>r&&(p=[],x.push(p),Ba(p,T)),k=jy(R,j)}Ba(p,R),Vy(T,R)}return i?x:x[0]}var i7=0,mae=1;function Hy(t,e=null,r){if(!t.length)return[];let{size:i=2,gridResolution:n=10,gridOffset:o=[0,0],edgeTypes:a=!1}=r||{},c=[],h=[{pos:t,types:a?new Array(t.length/i).fill(mae):null,holes:e||[]}],p=[[],[]],x=[];for(;h.length;){let{pos:T,types:R,holes:k}=h.shift();_ae(T,i,k[0]||T.length,p),x=o7(p[0],n,o,x);let j=jy(p[1],x);if(j){let q=n7(T,R,i,0,k[0]||T.length,x,j),Z={pos:q[0].pos,types:q[0].types,holes:[]},re={pos:q[1].pos,types:q[1].types,holes:[]};h.push(Z,re);for(let ee=0;ee<k.length;ee++)q=n7(T,R,i,k[ee],k[ee+1]||T.length,x,j),q[0]&&(Z.holes.push(Z.pos.length),Z.pos=jw(Z.pos,q[0].pos),a&&(Z.types=jw(Z.types,q[0].types))),q[1]&&(re.holes.push(re.pos.length),re.pos=jw(re.pos,q[1].pos),a&&(re.types=jw(re.types,q[1].types)))}else{let q={positions:T};a&&(q.edgeTypes=R),k.length&&(q.holeIndices=k),c.push(q)}}return c}function n7(t,e,r,i,n,o,a){let c=(n-i)/r,h=[],p=[],x=[],T=[],R=[],k,j,q,Z=Sd(t,c-1,r,i),re=Math.sign(a&8?Z[1]-o[3]:Z[0]-o[2]),ee=e&&e[c-1],se=0,me=0;for(let Le=0;Le<c;Le++)k=Sd(t,Le,r,i,k),j=Math.sign(a&8?k[1]-o[3]:k[0]-o[2]),q=e&&e[i/r+Le],j&&re&&re!==j&&(Vw(Z,k,a,o,R),Ba(h,R)&&x.push(ee),Ba(p,R)&&T.push(ee)),j<=0?(Ba(h,k)&&x.push(q),se-=j):x.length&&(x[x.length-1]=i7),j>=0?(Ba(p,k)&&T.push(q),me+=j):T.length&&(T[T.length-1]=i7),Vy(Z,k),re=j,ee=q;return[se?{pos:h,types:e&&x}:null,me?{pos:p,types:e&&T}:null]}function o7(t,e,r,i){let n=Math.floor((t[0]-r[0])/e)*e+r[0],o=Math.floor((t[1]-r[1])/e)*e+r[1];return i[0]=n,i[1]=o,i[2]=n+e,i[3]=o+e,i}function gae(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function _ae(t,e,r,i){let n=1/0,o=-1/0,a=1/0,c=-1/0;for(let h=0;h<r;h+=e){let p=t[h],x=t[h+1];n=p<n?p:n,o=p>o?p:o,a=x<a?x:a,c=x>c?x:c}return i[0][0]=n,i[0][1]=a,i[1][0]=o,i[1][1]=c,i}function jw(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}var yae=85.051129;function a4(t,e){let{size:r=2,startIndex:i=0,endIndex:n=t.length,normalize:o=!0}=e||{},a=t.slice(i,n);s7(a,r,0,n-i);let c=Gy(a,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(let h of c)a7(h,r);return c}function l4(t,e=null,r){let{size:i=2,normalize:n=!0,edgeTypes:o=!1}=r||{};e=e||[];let a=[],c=[],h=0,p=0;for(let T=0;T<=e.length;T++){let R=e[T]||t.length,k=p,j=xae(t,i,h,R);for(let q=j;q<R;q++)a[p++]=t[q];for(let q=h;q<j;q++)a[p++]=t[q];s7(a,i,k,p),bae(a,i,k,p,r?.maxLatitude),h=R,c[T]=p}c.pop();let x=Hy(a,c,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(n)for(let T of x)a7(T.positions,i);return x}function xae(t,e,r,i){let n=-1,o=-1;for(let a=r+1;a<i;a+=e){let c=Math.abs(t[a]);c>n&&(n=c,o=a-1)}return o}function bae(t,e,r,i,n=yae){let o=t[r],a=t[i-e];if(Math.abs(o-a)>180){let c=Sd(t,0,e,r);c[0]+=Math.round((a-o)/360)*360,Ba(t,c),c[1]=Math.sign(c[1])*n,Ba(t,c),c[0]=o,Ba(t,c)}}function s7(t,e,r,i){let n=t[0],o;for(let a=r;a<i;a+=e){o=t[a];let c=o-n;(c>180||c<-180)&&(o-=Math.round(c/360)*360),t[a]=n=o}}function a7(t,e){let r,i=t.length/e;for(let o=0;o<i&&(r=t[o*e],(r+180)%360===0);o++);let n=-Math.round(r/360)*360;if(n!==0)for(let o=0;o<i;o++)t[o*e]+=n}var Wy=class extends Qi{constructor(e){let{indices:r,attributes:i}=wae(e);super({...e,indices:r,attributes:i})}};function wae(t){let{radius:e,height:r=1,nradial:i=10}=t,{vertices:n}=t;n&&(cr.assert(n.length>=i),n=n.flatMap(k=>[k[0],k[1]]),pA(n,Pm.COUNTER_CLOCKWISE));let o=r>0,a=i+1,c=o?a*3+1:i,h=Math.PI*2/i,p=new Uint16Array(o?i*3*2:0),x=new Float32Array(c*3),T=new Float32Array(c*3),R=0;if(o){for(let k=0;k<a;k++){let j=k*h,q=k%i,Z=Math.sin(j),re=Math.cos(j);for(let ee=0;ee<2;ee++)x[R+0]=n?n[q*2]:re*e,x[R+1]=n?n[q*2+1]:Z*e,x[R+2]=(1/2-ee)*r,T[R+0]=n?n[q*2]:re,T[R+1]=n?n[q*2+1]:Z,R+=3}x[R+0]=x[R-3],x[R+1]=x[R-2],x[R+2]=x[R-1],R+=3}for(let k=o?0:1;k<a;k++){let j=Math.floor(k/2)*Math.sign(.5-k%2),q=j*h,Z=(j+i)%i,re=Math.sin(q),ee=Math.cos(q);x[R+0]=n?n[Z*2]:ee*e,x[R+1]=n?n[Z*2+1]:re*e,x[R+2]=r/2,T[R+2]=1,R+=3}if(o){let k=0;for(let j=0;j<i;j++)p[k++]=j*2+0,p[k++]=j*2+2,p[k++]=j*2+0,p[k++]=j*2+1,p[k++]=j*2+1,p[k++]=j*2+3}return{indices:p,attributes:{POSITION:{size:3,value:x},NORMAL:{size:3,value:T}}}}var l7=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,c7={name:"column",vs:l7,fs:l7,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}};var u7=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var h7=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Gw=[0,0,0,255],Tae={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:Gw},getLineColor:{type:"accessor",value:Gw},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},$y=class extends ln{getShaders(){let e={},{flatShading:r}=this.props;return r&&(e.FLAT_SHADING=1),super.getShaders({vs:u7,fs:h7,defines:e,modules:[Bi,r?om:pd,Sn,c7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Gw},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Gw},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,o=n.extensionsChanged||r.flatShading!==i.flatShading;o&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let a=this.getNumInstances();this.state.fillModel.setInstanceCount(a),this.state.wireframeModel.setInstanceCount(a),(o||r.diskResolution!==i.diskResolution||r.vertices!==i.vertices||(r.extruded||r.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(r)}getGeometry(e,r,i){let n=new Wy({radius:1,height:i?2:0,vertices:r,nradial:e}),o=0;if(r)for(let a=0;a<e;a++){let c=r[a],h=Math.sqrt(c[0]*c[0]+c[1]*c[1]);o+=h/e}else o=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*o}),n}_getModels(){let e=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),i=new di(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),n=new di(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:i,wireframeModel:n,models:[n,i]}}_updateGeometry({diskResolution:e,vertices:r,extruded:i,stroked:n}){let o=this.getGeometry(e,r,i||n);this.setState({fillVertexCount:o.attributes.POSITION.value.length/3});let a=this.state.fillModel,c=this.state.wireframeModel;a.setGeometry(o),a.setTopology("triangle-strip"),a.setIndexBuffer(null),c.setGeometry(o),c.setTopology("line-list")}draw({uniforms:e}){let{lineWidthUnits:r,lineWidthScale:i,lineWidthMinPixels:n,lineWidthMaxPixels:o,radiusUnits:a,elevationScale:c,extruded:h,filled:p,stroked:x,wireframe:T,offset:R,coverage:k,radius:j,angle:q}=this.props,Z=this.state.fillModel,re=this.state.wireframeModel,{fillVertexCount:ee,edgeDistance:se}=this.state,me={radius:j,angle:q/180*Math.PI,offset:R,extruded:h,stroked:x,coverage:k,elevationScale:c,edgeDistance:se,radiusUnits:Dn[a],widthUnits:Dn[r],widthScale:i,widthMinPixels:n,widthMaxPixels:o};h&&T&&(re.shaderInputs.setProps({column:{...me,isStroke:!0}}),re.draw(this.context.renderPass)),p&&(Z.setVertexCount(ee),Z.shaderInputs.setProps({column:{...me,isStroke:!1}}),Z.draw(this.context.renderPass)),!h&&x&&(Z.setVertexCount(ee*2/3),Z.shaderInputs.setProps({column:{...me,isStroke:!0}}),Z.draw(this.context.renderPass))}};$y.layerName="ColumnLayer";$y.defaultProps=Tae;var Hu=$y;var Eae={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},qy=class extends Hu{_updateGeometry(){let e=new nA;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{elevationScale:r,extruded:i,offset:n,coverage:o,cellSize:a,angle:c,radiusUnits:h}=this.props,p=this.state.fillModel,x={radius:a/2,radiusUnits:Dn[h],angle:c,offset:n,extruded:i,stroked:!1,coverage:o,elevationScale:r,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};p.shaderInputs.setProps({column:x}),p.draw(this.context.renderPass)}};qy.layerName="GridCellLayer";qy.defaultProps=Eae;var f7=qy;function d7(t,e,r,i){let n;if(Array.isArray(t[0])){let o=t.length*e;n=new Array(o);for(let a=0;a<t.length;a++)for(let c=0;c<e;c++)n[a*e+c]=t[a][c]||0}else n=t;return r?Gy(n,{size:e,gridResolution:r}):i?a4(n,{size:e}):n}var Cae=1,Sae=2,c4=4,Zy=class extends Ed{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?d7(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(p7(e)){let i=0;for(let n of e)i+=this.getGeometrySize(n);return i}let r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&p7(e))for(let i of e){let n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){let i=this.attributes.segmentTypes,n=e?this.isClosed(e):!1,{vertexStart:o,geometrySize:a}=r;i.fill(0,o,o+a),n?(i[o]=c4,i[o+a-2]=c4):(i[o]+=Cae,i[o+a-2]+=Sae),i[o+a-1]=c4}_updatePositions(e,r){let{positions:i}=this.attributes;if(!i||!e)return;let{vertexStart:n,geometrySize:o}=r,a=new Array(3);for(let c=n,h=0;h<o;c++,h++)this.getPointOnPath(e,h,a),i[c*3]=a[0],i[c*3+1]=a[1],i[c*3+2]=a[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,i=[]){let{positionSize:n}=this;r*n>=e.length&&(r+=1-e.length/n);let o=r*n;return i[0]=e[o],i[1]=e[o+1],i[2]=n===3&&e[o+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;let{positionSize:r}=this,i=e.length-r;return e[0]===e[i]&&e[1]===e[i+1]&&(r===2||e[2]===e[i+2])}};function p7(t){return Array.isArray(t[0])}var A7=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,m7={name:"path",vs:A7,fs:A7,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}};var g7=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var _7=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var y7=[0,0,0,255],Iae={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:y7},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},u4={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Xy=class extends ln{getShaders(){return super.getShaders({vs:g7,fs:_7,modules:[Bi,Sn,m7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:u4,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:u4,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:u4,defaultValue:y7},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:n,target:o})=>this.encodePickingColor(i&&i.__source?i.__source.index:n,o)}}),this.setState({pathTesselator:new Zy({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:r,changeFlags:i}=e,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){let{pathTesselator:a}=this.state,c=r.data.attributes||{};a.updateGeometry({data:r.data,geometryBuffer:c.getPath,buffers:c,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||n.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(o=>o.__source.index===i)),r}disablePickingIndex(e){let r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:r,capRounded:i,billboard:n,miterLimit:o,widthUnits:a,widthScale:c,widthMinPixels:h,widthMaxPixels:p}=this.props,x=this.state.model,T={jointType:Number(r),capType:Number(i),billboard:n,widthUnits:Dn[a],widthScale:c,miterLimit:o,widthMinPixels:h,widthMaxPixels:p};x.shaderInputs.setProps({path:T}),x.draw(this.context.renderPass)}_getModel(){let e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){let{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}};Xy.defaultProps=Iae;Xy.layerName="PathLayer";var Wu=Xy;var M7=yc(T7(),1);var Zw=Pm.CLOCKWISE,E7=Pm.COUNTER_CLOCKWISE,Id={isClosed:!0};function Hae(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Lm(t){return"positions"in t?t.positions:t}function Jy(t){return"holeIndices"in t?t.holeIndices:null}function Wae(t){return Array.isArray(t[0])}function $ae(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function qae(t){let e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Zae(t,e,r,i){for(let n=0;n<e;n++)if(t[r+n]!==t[i-e+n])return!1;return!0}function C7(t,e,r,i,n){let o=e,a=r.length;for(let c=0;c<a;c++)for(let h=0;h<i;h++)t[o++]=r[c][h]||0;if(!qae(r))for(let c=0;c<i;c++)t[o++]=r[0][c]||0;return Id.start=e,Id.end=o,Id.size=i,pA(t,n,Id),o}function S7(t,e,r,i,n=0,o,a){o=o||r.length;let c=o-n;if(c<=0)return e;let h=e;for(let p=0;p<c;p++)t[h++]=r[n+p];if(!Zae(r,i,n,o))for(let p=0;p<i;p++)t[h++]=r[n+p];return Id.start=e,Id.end=h,Id.size=i,pA(t,a,Id),h}function Xw(t,e){Hae(t);let r=[],i=[];if("positions"in t){let{positions:n,holeIndices:o}=t;if(o){let a=0;for(let c=0;c<=o.length;c++)a=S7(r,a,n,e,o[c-1],o[c],c===0?Zw:E7),i.push(a);return i.pop(),{positions:r,holeIndices:i}}t=n}if(!Wae(t))return S7(r,0,t,e,0,r.length,Zw),r;if(!$ae(t)){let n=0;for(let[o,a]of t.entries())n=C7(r,n,a,e,o===0?Zw:E7),i.push(n);return i.pop(),{positions:r,holeIndices:i}}return C7(r,0,t,e,Zw),r}function A4(t,e,r){let i=t.length/3,n=0;for(let o=0;o<i;o++){let a=(o+1)%i;n+=t[o*3+e]*t[a*3+r],n-=t[a*3+e]*t[o*3+r]}return Math.abs(n/2)}function I7(t,e,r,i){let n=t.length/3;for(let o=0;o<n;o++){let a=o*3,c=t[a+0],h=t[a+1],p=t[a+2];t[a+e]=c,t[a+r]=h,t[a+i]=p}}function P7(t,e,r,i){let n=Jy(t);n&&(n=n.map(c=>c/e));let o=Lm(t),a=i&&e===3;if(r){let c=o.length;o=o.slice();let h=[];for(let p=0;p<c;p+=e){h[0]=o[p],h[1]=o[p+1],a&&(h[2]=o[p+2]);let x=r(h);o[p]=x[0],o[p+1]=x[1],a&&(o[p+2]=x[2])}}if(a){let c=A4(o,0,1),h=A4(o,0,2),p=A4(o,1,2);if(!c&&!h&&!p)return[];c>h&&c>p||(h>p?(r||(o=o.slice()),I7(o,0,2,1)):(r||(o=o.slice()),I7(o,2,0,1)))}return(0,M7.default)(o,n,e)}var ex=class extends Ed{constructor(e){let{fp64:r,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){let{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);let r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let r=Xw(e,this.positionSize);return this.opts.resolution?Hy(Lm(r),Jy(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?l4(Lm(r),Jy(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(B7(e)){let r=0;for(let i of e)r+=this.getGeometrySize(i);return r}return Lm(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&B7(e))for(let i of e){let n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{let i=e;this._updateIndices(i,r),this._updatePositions(i,r),this._updateVertexValid(i,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:i,indexStart:n}){let{attributes:o,indexStarts:a,typedArrayManager:c}=this,h=o.indices;if(!h||!e)return;let p=n,x=P7(e,this.positionSize,this.opts.preproject,this.opts.full3d);h=c.allocate(h,n+x.length,{copy:!0});for(let T=0;T<x.length;T++)h[p++]=x[T]+i;a[r+1]=n+x.length,o.indices=h}_updatePositions(e,{vertexStart:r,geometrySize:i}){let{attributes:{positions:n},positionSize:o}=this;if(!n||!e)return;let a=Lm(e);for(let c=r,h=0;h<i;c++,h++){let p=a[h*o],x=a[h*o+1],T=o>2?a[h*o+2]:0;n[c*3]=p,n[c*3+1]=x,n[c*3+2]=T}}_updateVertexValid(e,{vertexStart:r,geometrySize:i}){let{positionSize:n}=this,o=this.attributes.vertexValid,a=e&&Jy(e);if(e&&e.edgeTypes?o.set(e.edgeTypes,r):o.fill(1,r,r+i),a)for(let c=0;c<a.length;c++)o[r+a[c]/n-1]=0;o[r+i-1]=0}};function B7(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}var L7=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,O7={name:"solidPolygon",vs:L7,fs:L7,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}};var Yw=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var D7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${Yw}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`;var F7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${Yw}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`;var k7=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Qw=[0,0,0,255],Xae={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Qw},getLineColor:{type:"accessor",value:Qw},material:!0},Kw={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},tx=class extends ln{getShaders(e){return super.getShaders({vs:e==="top"?D7:F7,fs:k7,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Bi,pd,Sn,O7]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let{viewport:e}=this.context,{coordinateSystem:r}=this.props,{_full3d:i}=this.props;e.isGeospatial&&r===vr.DEFAULT&&(r=vr.LNGLAT);let n;r===vr.LNGLAT&&(i?n=e.projectPosition.bind(e):n=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new ex({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let o=this.getAttributeManager(),a=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:a},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Kw,accessor:"getPolygon",update:this.calculatePositions,noAlloc:a,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:a},elevations:{size:1,stepMode:"dynamic",transition:Kw,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Kw,accessor:"getFillColor",defaultValue:Qw},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Kw,accessor:"getLineColor",defaultValue:Qw},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:h,target:p})=>this.encodePickingColor(c&&c.__source?c.__source.index:h,p)}})}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(o=>o.__source.index===i)),r}disablePickingIndex(e){let r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{extruded:r,filled:i,wireframe:n,elevationScale:o}=this.props,{topModel:a,sideModel:c,wireframeModel:h,polygonTesselator:p}=this.state,x={extruded:!!r,elevationScale:o,isWireframe:!1};h&&n&&(h.setInstanceCount(p.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{...x,isWireframe:!0}}),h.draw(this.context.renderPass)),c&&i&&(c.setInstanceCount(p.instanceCount-1),c.shaderInputs.setProps({solidPolygon:x}),c.draw(this.context.renderPass)),a&&i&&(a.setVertexCount(p.vertexCount),a.shaderInputs.setProps({solidPolygon:x}),a.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:r,oldProps:i,changeFlags:n}=e,o=this.getAttributeManager();(n.extensionsChanged||r.filled!==i.filled||r.extruded!==i.extruded)&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),o.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){let{polygonTesselator:o}=this.state,a=e.data.attributes||{};o.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:a.getPolygon,buffers:a,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let{id:e,filled:r,extruded:i}=this.props,n,o,a;if(r){let c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;let h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new di(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){let c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});o=new di(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new Qi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),a=new di(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new Qi({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[o,a,n].filter(Boolean),topModel:n,sideModel:o,wireframeModel:a}}calculateIndices(e){let{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){let{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};tx.defaultProps=Xae;tx.layerName="SolidPolygonLayer";var Md=tx;function Jw({data:t,getIndex:e,dataRange:r,replace:i}){let{startRow:n=0,endRow:o=1/0}=r,a=t.length,c=a,h=a;for(let R=0;R<a;R++){let k=e(t[R]);if(c>R&&k>=n&&(c=R),k>=o){h=R;break}}let p=c,T=h-c!==i.length?t.slice(h):void 0;for(let R=0;R<i.length;R++)t[p++]=i[R];if(T){for(let R=0;R<T.length;R++)t[p++]=T[R];t.length=p}return{startRow:c,endRow:c+i.length}}var N7=[0,0,0,255],Yae=[0,0,0,255],Kae={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:Yae},getLineColor:{type:"accessor",value:N7},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},rx=class extends so{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&cr.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){let r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(r&&Array.isArray(e.dataChanged)){let i=this.state.paths.slice(),n=e.dataChanged.map(o=>Jw({data:i,getIndex:a=>a.__source.index,dataRange:o,replace:this._getPaths(o)}));this.setState({paths:i,pathsDiff:n})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){let{data:r,getPolygon:i,positionFormat:n,_normalize:o}=this.props,a=[],c=n==="XY"?2:3,{startRow:h,endRow:p}=e,{iterable:x,objectInfo:T}=Ro(r,h,p);for(let R of x){T.index++;let k=i(R,T);o&&(k=Xw(k,c));let{holeIndices:j}=k,q=k.positions||k;if(j)for(let Z=0;Z<=j.length;Z++){let re=q.slice(j[Z-1]||0,j[Z]||q.length);a.push(this.getSubLayerRow({path:re},R,T.index))}else a.push(this.getSubLayerRow({path:q},R,T.index))}return a}renderLayers(){let{data:e,_dataDiff:r,stroked:i,filled:n,extruded:o,wireframe:a,_normalize:c,_windingOrder:h,elevationScale:p,transitions:x,positionFormat:T}=this.props,{lineWidthUnits:R,lineWidthScale:k,lineWidthMinPixels:j,lineWidthMaxPixels:q,lineJointRounded:Z,lineMiterLimit:re,lineDashJustified:ee}=this.props,{getFillColor:se,getLineColor:me,getLineWidth:Le,getLineDashArray:je,getElevation:Je,getPolygon:J,updateTriggers:te,material:X}=this.props,{paths:ye,pathsDiff:_e}=this.state,Oe=this.getSubLayerClass("fill",Md),ve=this.getSubLayerClass("stroke",Wu),De=this.shouldRenderSubLayer("fill",ye)&&new Oe({_dataDiff:r,extruded:o,elevationScale:p,filled:n,wireframe:a,_normalize:c,_windingOrder:h,getElevation:Je,getFillColor:se,getLineColor:o&&a?me:N7,material:X,transitions:x},this.getSubLayerProps({id:"fill",updateTriggers:te&&{getPolygon:te.getPolygon,getElevation:te.getElevation,getFillColor:te.getFillColor,lineColors:o&&a,getLineColor:te.getLineColor}}),{data:e,positionFormat:T,getPolygon:J}),Xe=!o&&i&&this.shouldRenderSubLayer("stroke",ye)&&new ve({_dataDiff:_e&&(()=>_e),widthUnits:R,widthScale:k,widthMinPixels:j,widthMaxPixels:q,jointRounded:Z,miterLimit:re,dashJustified:ee,_pathType:"loop",transitions:x&&{getWidth:x.getLineWidth,getColor:x.getLineColor,getPath:x.getPolygon},getColor:this.getSubLayerAccessor(me),getWidth:this.getSubLayerAccessor(Le),getDashArray:this.getSubLayerAccessor(je)},this.getSubLayerProps({id:"stroke",updateTriggers:te&&{getWidth:te.getLineWidth,getColor:te.getLineColor,getDashArray:te.getLineDashArray}}),{data:ye,positionFormat:T,getPath:rt=>rt.path});return[!o&&De,Xe,o&&De]}};rx.layerName="PolygonLayer";rx.defaultProps=Kae;var Pd=rx;function z7(t,e){if(!t)return null;let r="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[r];return r!==-1?Qae(t,i,r):null}function Qae(t,e,r){let i={properties:{...t.properties[e]}};for(let n in t.numericProps)i.properties[n]=t.numericProps[n].value[r];return i}function U7(t,e){let r={points:null,lines:null,polygons:null};for(let i in r){let n=t[i].globalFeatureIds.value;r[i]=new Uint8ClampedArray(n.length*4);let o=[];for(let a=0;a<n.length;a++)e(n[a],o),r[i][a*4+0]=o[0],r[i][a*4+1]=o[1],r[i][a*4+2]=o[2],r[i][a*4+3]=255}return r}var V7=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,j7={name:"sdf",vs:V7,fs:V7,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}};var G7=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var m4=192/256,H7=[],Jae={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},ix=class extends Mm{getShaders(){let e=super.getShaders();return{...e,modules:[...e.modules,j7],fs:G7}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,{outlineColor:n}=r;n!==i.outlineColor&&(n=n.map(o=>o/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!r.sdf&&r.outlineWidth&&cr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){let{sdf:r,smoothing:i,outlineWidth:n}=this.props,{outlineColor:o}=this.state,a=n?Math.max(i,m4*(1-n)):-1,c=this.state.model,h={buffer:m4,outlineBuffer:a,gamma:i,enabled:!!r,outlineColor:o};if(c.shaderInputs.setProps({sdf:h}),super.draw(e),r&&n){let{iconManager:p}=this.state;p.getTexture()&&(c.shaderInputs.setProps({sdf:{...h,outlineBuffer:m4}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):H7}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):H7}};ix.defaultProps=Jae;ix.layerName="MultiIconLayer";var e3=ix;var nx=class{constructor({fontSize:e=24,buffer:r=3,radius:i=8,cutoff:n=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:c="normal"}={}){this.buffer=r,this.cutoff=n,this.radius=i;let h=this.size=e+r*4,p=this._createCanvas(h),x=this.ctx=p.getContext("2d",{willReadFrequently:!0});x.font=`${c} ${a} ${e}px ${o}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){let r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){let{width:r,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(e),c=Math.ceil(i),h=0,p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-o))),x=Math.min(this.size-this.buffer,c+Math.ceil(n)),T=p+2*this.buffer,R=x+2*this.buffer,k=Math.max(T*R,0),j=new Uint8ClampedArray(k),q={data:j,width:T,height:R,glyphWidth:p,glyphHeight:x,glyphTop:c,glyphLeft:h,glyphAdvance:r};if(p===0||x===0)return q;let{ctx:Z,buffer:re,gridInner:ee,gridOuter:se}=this;Z.clearRect(re,re,p,x),Z.fillText(e,re,re+c);let me=Z.getImageData(re,re,p,x);se.fill(1e20,0,k),ee.fill(0,0,k);for(let Le=0;Le<x;Le++)for(let je=0;je<p;je++){let Je=me.data[4*(Le*p+je)+3]/255;if(Je===0)continue;let J=(Le+re)*T+je+re;if(Je===1)se[J]=0,ee[J]=1e20;else{let te=.5-Je;se[J]=te>0?te*te:0,ee[J]=te<0?te*te:0}}W7(se,0,0,T,R,T,this.f,this.v,this.z),W7(ee,re,re,p,x,T,this.f,this.v,this.z);for(let Le=0;Le<k;Le++){let je=Math.sqrt(se[Le])-Math.sqrt(ee[Le]);j[Le]=Math.round(255-255*(je/this.radius+this.cutoff))}return q}};function W7(t,e,r,i,n,o,a,c,h){for(let p=e;p<e+i;p++)$7(t,r*o+p,o,n,a,c,h);for(let p=r;p<r+n;p++)$7(t,p*o+e,1,i,a,c,h)}function $7(t,e,r,i,n,o,a){o[0]=0,a[0]=-1e20,a[1]=1e20,n[0]=t[e];for(let c=1,h=0,p=0;c<i;c++){n[c]=t[e+c*r];let x=c*c;do{let T=o[h];p=(n[c]-n[T]+x-T*T)/(c-T)/2}while(p<=a[h]&&--h>-1);h++,o[h]=c,a[h]=p,a[h+1]=1e20}for(let c=0,h=0;c<i;c++){for(;a[h+1]<c;)h++;let p=o[h],x=c-p;t[e+c*r]=n[p]+x*x}}var ele=32,tle=[];function rle(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function q7({characterSet:t,getFontWidth:e,fontHeight:r,buffer:i,maxCanvasWidth:n,mapping:o={},xOffset:a=0,yOffset:c=0}){let h=0,p=a,x=r+i*2;for(let T of t)if(!o[T]){let R=e(T);p+R+i*2>n&&(p=0,h++),o[T]={x:p+i,y:c+h*x+i,width:R,height:x,layoutWidth:R,layoutHeight:r},p+=R+i*2}return{mapping:o,xOffset:p,yOffset:c+h*x,canvasHeight:rle(c+(h+1)*x)}}function Z7(t,e,r,i){let n=0;for(let o=e;o<r;o++){let a=t[o];n+=i[a]?.layoutWidth||0}return n}function X7(t,e,r,i,n,o){let a=e,c=0;for(let h=e;h<r;h++){let p=Z7(t,h,h+1,n);c+p>i&&(a<h&&o.push(h),a=h,c=0),c+=p}return c}function ile(t,e,r,i,n,o){let a=e,c=e,h=e,p=0;for(let x=e;x<r;x++)if((t[x]===" "||t[x+1]===" "||x+1===r)&&(h=x+1),h>c){let T=Z7(t,c,h,n);p+T>i&&(a<c&&(o.push(c),a=c,p=0),T>i&&(T=X7(t,c,h,i,n,o),a=o[o.length-1])),c=h,p+=T}return p}function nle(t,e,r,i,n=0,o){o===void 0&&(o=t.length);let a=[];return e==="break-all"?X7(t,n,o,r,i,a):ile(t,n,o,r,i,a),a}function ole(t,e,r,i,n,o){let a=0,c=0;for(let h=e;h<r;h++){let p=t[h],x=i[p];x?(c||(c=x.layoutHeight),n[h]=a+x.layoutWidth/2,a+=x.layoutWidth):(cr.warn(`Missing character: ${p} (${p.codePointAt(0)})`)(),n[h]=a,a+=ele)}o[0]=a,o[1]=c}function Y7(t,e,r,i,n){let o=Array.from(t),a=o.length,c=new Array(a),h=new Array(a),p=new Array(a),x=(r==="break-word"||r==="break-all")&&isFinite(i)&&i>0,T=[0,0],R=[0,0],k=0,j=0,q=0;for(let Z=0;Z<=a;Z++){let re=o[Z];if((re===`
`||Z===a)&&(q=Z),q>j){let ee=x?nle(o,r,i,n,j,q):tle;for(let se=0;se<=ee.length;se++){let me=se===0?j:ee[se-1],Le=se<ee.length?ee[se]:q;ole(o,me,Le,n,c,R);for(let je=me;je<Le;je++){let Je=c[je]-R[0]/2,J=o[je],te=n[J]?.layoutOffsetY||0;h[je]=k+R[1]/2+te,p[je]=R[0]}k=k+R[1]*e,T[0]=Math.max(T[0],R[0])}j=q}re===`
`&&(c[j]=0,h[j]=0,p[j]=0,j++)}return T[1]=k,{x:c,y:h,rowWidth:p,size:T}}function K7({value:t,length:e,stride:r,offset:i,startIndices:n,characterSet:o}){let a=t.BYTES_PER_ELEMENT,c=r?r/a:1,h=i?i/a:0,p=n[e]||Math.ceil((t.length-h)/c),x=o&&new Set,T=new Array(e),R=t;if(c>1||h>0){let k=t.constructor;R=new k(p);for(let j=0;j<p;j++)R[j]=t[j*c+h]}for(let k=0;k<e;k++){let j=n[k],q=n[k+1]||p,Z=R.subarray(j,q);T[k]=String.fromCodePoint.apply(null,Z),x&&Z.forEach(x.add,x)}if(x)for(let k of x)o.add(String.fromCodePoint(k));return{texts:T,characterCount:p}}var Om=class{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){let r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}};function sle(){let t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}var gA={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:sle(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Q7=1024,J7=.9,e9=1.2,r9=3,t3=new Om(r9);function ale(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);let i=t3.get(t);if(!i)return r;for(let n in i.mapping)r.has(n)&&r.delete(n);return r}function lle(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function t9(t,e,r,i){t.font=`${i} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function i9(t){cr.assert(Number.isFinite(t)&&t>=r9,"Invalid cache limit"),t3=new Om(t)}var ox=class{constructor(){this.props={...gA}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:e,buffer:r}=this.props;return(e*e9+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();let r=ale(this._key,this.props.characterSet),i=t3.get(this._key);if(i&&r.size===0){this._atlas!==i&&(this._atlas=i);return}let n=this._generateFontAtlas(r,i);this._atlas=n,t3.set(this._key,n)}_generateFontAtlas(e,r){let{fontFamily:i,fontWeight:n,fontSize:o,buffer:a,sdf:c,radius:h,cutoff:p}=this.props,x=r&&r.data;x||(x=document.createElement("canvas"),x.width=Q7);let T=x.getContext("2d",{willReadFrequently:!0});t9(T,i,o,n);let{mapping:R,canvasHeight:k,xOffset:j,yOffset:q}=q7({getFontWidth:Z=>T.measureText(Z).width,fontHeight:o*e9,buffer:a,characterSet:e,maxCanvasWidth:Q7,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(x.height!==k){let Z=T.getImageData(0,0,x.width,x.height);x.height=k,T.putImageData(Z,0,0)}if(t9(T,i,o,n),c){let Z=new nx({fontSize:o,buffer:a,radius:h,cutoff:p,fontFamily:i,fontWeight:`${n}`});for(let re of e){let{data:ee,width:se,height:me,glyphTop:Le}=Z.draw(re);R[re].width=se,R[re].layoutOffsetY=o*J7-Le;let je=T.createImageData(se,me);lle(ee,je),T.putImageData(je,R[re].x,R[re].y)}}else for(let Z of e)T.fillText(Z,R[Z].x,R[Z].y+a+o*J7);return{xOffset:j,yOffset:q,mapping:R,data:x,width:x.width,height:x.height}}_getKey(){let{fontFamily:e,fontWeight:r,fontSize:i,buffer:n,sdf:o,radius:a,cutoff:c}=this.props;return o?`${e} ${r} ${i} ${n} ${a} ${c}`:`${e} ${r} ${i} ${n}`}};var n9=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,o9={name:"textBackground",vs:n9,fs:n9,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}};var s9=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var a9=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var cle={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},sx=class extends ln{getShaders(){return super.getShaders({vs:s9,fs:a9,modules:[Bi,Sn,o9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:r}=e;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{billboard:r,sizeScale:i,sizeUnits:n,sizeMinPixels:o,sizeMaxPixels:a,getLineWidth:c}=this.props,{padding:h,borderRadius:p}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]),Array.isArray(p)||(p=[p,p,p,p]);let x=this.state.model,T={billboard:r,stroked:!!c,borderRadius:p,padding:h,sizeUnits:Dn[n],sizeScale:i,sizeMinPixels:o,sizeMaxPixels:a};x.shaderInputs.setProps({textBackground:T}),x.draw(this.context.renderPass)}_getModel(){let e=[0,0,1,0,0,1,1,1];return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};sx.defaultProps=cle;sx.layerName="TextBackgroundLayer";var r3=sx;var l9={start:1,middle:0,end:-1},c9={top:1,center:0,bottom:-1},g4=[0,0,0,255],ule=1,hle={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:g4},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:gA.characterSet},fontFamily:gA.fontFamily,fontWeight:gA.fontWeight,lineHeight:ule,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:g4},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:g4},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},ax=class extends so{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[i,n]}=this.transformParagraph(e,r),{fontSize:o}=this.state.fontAtlasManager.props;i/=o,n/=o;let{getTextAnchor:a,getAlignmentBaseline:c}=this.props,h=l9[typeof a=="function"?a(e,r):a],p=c9[typeof c=="function"?c(e,r):c];return[(h-1)*i/2,(p-1)*n/2,i,n]},this.getIconOffsets=(e,r)=>{let{getTextAnchor:i,getAlignmentBaseline:n}=this.props,{x:o,y:a,rowWidth:c,size:[h,p]}=this.transformParagraph(e,r),x=l9[typeof i=="function"?i(e,r):i],T=c9[typeof n=="function"?n(e,r):n],R=o.length,k=new Array(R*2),j=0;for(let q=0;q<R;q++){let Z=(1-x)*(h-c[q])/2;k[j++]=(x-1)*h/2+Z+o[q],k[j++]=(T-1)*p/2+a[q]}return k}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new ox},this.props.maxWidth>0&&cr.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){let{props:r,oldProps:i,changeFlags:n}=e;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==i.lineHeight||r.wordBreak!==i.wordBreak||r.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:r,fontWeight:i}=this.props,{fontAtlasManager:n,characterSet:o}=this.state,a={...e,characterSet:o,fontFamily:r,fontWeight:i};if(!n.mapping)return n.setProps(a),!0;for(let c in a)if(a[c]!==n.props[c])return n.setProps(a),!0;return!1}_updateText(){let{data:e,characterSet:r}=this.props,i=e.attributes?.getText,{getText:n}=this.props,o=e.startIndices,a,c=r==="auto"&&new Set;if(i&&o){let{texts:h,characterCount:p}=K7({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:o,characterSet:c});a=p,n=(x,{index:T})=>h[T]}else{let{iterable:h,objectInfo:p}=Ro(e);o=[0],a=0;for(let x of h){p.index++;let T=Array.from(n(x,p)||"");c&&T.forEach(c.add,c),a+=T.length,o.push(a)}}this.setState({getText:n,startIndices:o,numInstances:a,characterSet:c||r})}transformParagraph(e,r){let{fontAtlasManager:i}=this.state,n=i.mapping,o=this.state.getText,{wordBreak:a,lineHeight:c,maxWidth:h}=this.props,p=o(e,r)||"";return Y7(p,c,a,h*i.props.fontSize,n)}renderLayers(){let{startIndices:e,numInstances:r,getText:i,fontAtlasManager:{scale:n,atlas:o,mapping:a},styleVersion:c}=this.state,{data:h,_dataDiff:p,getPosition:x,getColor:T,getSize:R,getAngle:k,getPixelOffset:j,getBackgroundColor:q,getBorderColor:Z,getBorderWidth:re,backgroundBorderRadius:ee,backgroundPadding:se,background:me,billboard:Le,fontSettings:je,outlineWidth:Je,outlineColor:J,sizeScale:te,sizeUnits:X,sizeMinPixels:ye,sizeMaxPixels:_e,transitions:Oe,updateTriggers:ve}=this.props,De=this.getSubLayerClass("characters",e3),Xe=this.getSubLayerClass("background",r3);return[me&&new Xe({getFillColor:q,getLineColor:Z,getLineWidth:re,borderRadius:ee,padding:se,getPosition:x,getSize:R,getAngle:k,getPixelOffset:j,billboard:Le,sizeScale:te,sizeUnits:X,sizeMinPixels:ye,sizeMaxPixels:_e,transitions:Oe&&{getPosition:Oe.getPosition,getAngle:Oe.getAngle,getSize:Oe.getSize,getFillColor:Oe.getBackgroundColor,getLineColor:Oe.getBorderColor,getLineWidth:Oe.getBorderWidth,getPixelOffset:Oe.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ve.getPosition,getAngle:ve.getAngle,getSize:ve.getSize,getFillColor:ve.getBackgroundColor,getLineColor:ve.getBorderColor,getLineWidth:ve.getBorderWidth,getPixelOffset:ve.getPixelOffset,getBoundingRect:{getText:ve.getText,getTextAnchor:ve.getTextAnchor,getAlignmentBaseline:ve.getAlignmentBaseline,styleVersion:c}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:p,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new De({sdf:je.sdf,smoothing:Number.isFinite(je.smoothing)?je.smoothing:gA.smoothing,outlineWidth:Je/(je.radius||gA.radius),outlineColor:J,iconAtlas:o,iconMapping:a,getPosition:x,getColor:T,getSize:R,getAngle:k,getPixelOffset:j,billboard:Le,sizeScale:te*n,sizeUnits:X,sizeMinPixels:ye*n,sizeMaxPixels:_e*n,transitions:Oe&&{getPosition:Oe.getPosition,getAngle:Oe.getAngle,getColor:Oe.getColor,getSize:Oe.getSize,getPixelOffset:Oe.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ve.getText,getPosition:ve.getPosition,getAngle:ve.getAngle,getColor:ve.getColor,getSize:ve.getSize,getPixelOffset:ve.getPixelOffset,getIconOffsets:{getTextAnchor:ve.getTextAnchor,getAlignmentBaseline:ve.getAlignmentBaseline,styleVersion:c}}}),{data:h,_dataDiff:p,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){i9(e)}};ax.defaultProps=hle;ax.layerName="TextLayer";var i3=ax;var lx={circle:{type:kw,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Mm,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:i3,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},cx={type:Wu,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},n3={type:Md,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Dm({type:t,props:e}){let r={};for(let i in e)r[i]=t.defaultProps[e[i]];return r}function o3(t,e){let{transitions:r,updateTriggers:i}=t.props,n={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(let o in e){let a=e[o],c=t.props[o];o.startsWith("get")&&(c=t.getSubLayerAccessor(c),n.updateTriggers[a]=i[o],r&&(n.transitions[a]=r[o])),n[a]=c}return n}function h9(t){if(Array.isArray(t))return t;switch(cr.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return cr.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function _4(t,e,r={}){let i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:o=t.length}=r;for(let a=n;a<o;a++){let c=t[a],{geometry:h}=c;if(h)if(h.type==="GeometryCollection"){cr.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");let{geometries:p}=h;for(let x=0;x<p.length;x++){let T=p[x];u9(T,i,e,c,a)}}else u9(h,i,e,c,a)}return i}function u9(t,e,r,i,n){let{type:o,coordinates:a}=t,{pointFeatures:c,lineFeatures:h,polygonFeatures:p,polygonOutlineFeatures:x}=e;if(!dle(o,a)){cr.warn(`${o} coordinates are malformed`)();return}switch(o){case"Point":c.push(r({geometry:t},i,n));break;case"MultiPoint":a.forEach(T=>{c.push(r({geometry:{type:"Point",coordinates:T}},i,n))});break;case"LineString":h.push(r({geometry:t},i,n));break;case"MultiLineString":a.forEach(T=>{h.push(r({geometry:{type:"LineString",coordinates:T}},i,n))});break;case"Polygon":p.push(r({geometry:t},i,n)),a.forEach(T=>{x.push(r({geometry:{type:"LineString",coordinates:T}},i,n))});break;case"MultiPolygon":a.forEach(T=>{p.push(r({geometry:{type:"Polygon",coordinates:T}},i,n)),T.forEach(R=>{x.push(r({geometry:{type:"LineString",coordinates:R}},i,n))})});break;default:}}var fle={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function dle(t,e){let r=fle[t];for(cr.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function f9(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function s3(t){return t.geometry.coordinates}function d9(t,e){let r=f9(),{pointFeatures:i,lineFeatures:n,polygonFeatures:o,polygonOutlineFeatures:a}=t;return r.points.data=i,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=s3,r.lines.data=n,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=s3,r.polygons.data=o,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=s3,r.polygonsOutline.data=a,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=s3,r}function p9(t,e){let r=f9(),{points:i,lines:n,polygons:o}=t,a=U7(t,e);return r.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:a.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:a.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines._pathType="open",r.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:4,value:a.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygons._normalize=!1,o.triangles&&(r.polygons.data.attributes.indices=o.triangles.value),r.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:4,value:a.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},r.polygonsOutline._pathType="open",r}var ple=["points","linestrings","polygons"],Ale={...Dm(lx.circle),...Dm(lx.icon),...Dm(lx.text),...Dm(cx),...Dm(n3),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},ux=class extends so{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;let{data:i}=this.props,n=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:n}),n?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){let i=p9(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:r}){let i=h9(e.data),n=this.getSubLayerRow.bind(this),o={},a={};if(Array.isArray(r.dataChanged)){let h=this.state.features;for(let p in h)o[p]=h[p].slice(),a[p]=[];for(let p of r.dataChanged){let x=_4(i,n,p);for(let T in h)a[T].push(Jw({data:o[T],getIndex:R=>R.__source.index,dataRange:p,replace:x[T]}))}}else o=_4(i,n);let c=d9(o,a);this.setState({features:o,featuresDiff:a,layerProps:c})}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i,sourceLayer:n}=r;return r.featureType=ple.find(o=>n.id.startsWith(`${this.id}-${o}-`)),i>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[i]),r}_updateAutoHighlight(e){let r=`${this.id}-points-`,i=e.featureType==="points";for(let n of this.getSubLayers())n.id.startsWith(r)===i&&n.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:r}=this.props,{layerProps:i}=this.state,n="polygons-fill",o=this.shouldRenderSubLayer(n,i.polygons?.data)&&this.getSubLayerClass(n,n3.type);if(o){let a=o3(this,n3.props),c=e&&r;return c||delete a.getLineColor,a.updateTriggers.lineColors=c,new o(a,this.getSubLayerProps({id:n,updateTriggers:a.updateTriggers}),i.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:r}=this.props,{layerProps:i}=this.state,n="polygons-stroke",o="linestrings",a=!e&&r&&this.shouldRenderSubLayer(n,i.polygonsOutline?.data)&&this.getSubLayerClass(n,cx.type),c=this.shouldRenderSubLayer(o,i.lines?.data)&&this.getSubLayerClass(o,cx.type);if(a||c){let h=o3(this,cx.props);return[a&&new a(h,this.getSubLayerProps({id:n,updateTriggers:h.updateTriggers}),i.polygonsOutline),c&&new c(h,this.getSubLayerProps({id:o,updateTriggers:h.updateTriggers}),i.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:r,binary:i}=this.state,{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=r.points.data.findIndex(c=>c.__source.index===n));let o=new Set(e.split("+")),a=[];for(let c of o){let h=`points-${c}`,p=lx[c],x=p&&this.shouldRenderSubLayer(h,r.points?.data)&&this.getSubLayerClass(h,p.type);if(x){let T=o3(this,p.props),R=r.points;if(c==="text"&&i){let{instancePickingColors:k,...j}=R.data.attributes;R={...R,data:{...R.data,attributes:j}}}a.push(new x(T,this.getSubLayerProps({id:h,updateTriggers:T.updateTriggers,highlightedObjectIndex:n}),R))}}return a}renderLayers(){let{extruded:e}=this.props,r=this._renderPolygonLayer(),i=this._renderLineLayers(),n=this._renderPointLayers();return[!e&&r,i,n,e&&r]}getSubLayerAccessor(e){let{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(i,n)=>{let{data:o,index:a}=n,c=z7(o,a);return e(c,n)}}};ux.layerName="GeoJsonLayer";ux.defaultProps=Ale;var _A=ux;var I4={};no(I4,{CPUAggregator:()=>ua,ContourLayer:()=>yz,GridLayer:()=>Tz,HeatmapLayer:()=>jz,HexagonLayer:()=>U9,ScreenGridLayer:()=>M9,WebGLAggregator:()=>Bo,_AggregationLayer:()=>$u});function A9({pointCount:t,getBinId:e}){let r=new Map;for(let i=0;i<t;i++){let n=e(i);if(n===null)continue;let o=r.get(String(n));o?o.points.push(i):(o={id:n,index:r.size,points:[i]},r.set(String(n),o))}return Array.from(r.values())}function m9({bins:t,dimensions:e,target:r}){let i=t.length*e;(!r||r.length<i)&&(r=new Float32Array(i));for(let n=0;n<t.length;n++){let{id:o}=t[n];Array.isArray(o)?r.set(o,n*e):r[n]=o}return r}var mle=t=>t.length,g9=(t,e)=>{let r=0;for(let i of t)r+=e(i);return r},gle=(t,e)=>t.length===0?NaN:g9(t,e)/t.length,_le=(t,e)=>{let r=1/0;for(let i of t){let n=e(i);n<r&&(r=n)}return r},yle=(t,e)=>{let r=-1/0;for(let i of t){let n=e(i);n>r&&(r=n)}return r},_9={COUNT:mle,SUM:g9,MEAN:gle,MIN:_le,MAX:yle};function y9({bins:t,getValue:e,operation:r,target:i}){(!i||i.length<t.length)&&(i=new Float32Array(t.length));let n=1/0,o=-1/0;for(let a=0;a<t.length;a++){let{points:c}=t[a];i[a]=r(c,e),i[a]<n&&(n=i[a]),i[a]>o&&(o=i[a])}return{value:i,domain:[n,o]}}function x4(t,e,r){let i={};for(let o of t.sources||[]){let a=e[o];if(a)i[o]=xle(a);else throw new Error(`Cannot find attribute ${o}`)}let n={};return o=>{for(let a in i)n[a]=i[a](o);return t.getValue(n,o,r)}}function xle(t){let e=t.value,{offset:r=0,stride:i,size:n}=t.getAccessor(),o=e.BYTES_PER_ELEMENT,a=r/o,c=i?i/o:n;if(n===1)return t.isConstant?()=>e[0]:p=>{let x=a+c*p;return e[x]};let h;return t.isConstant?(h=Array.from(e),()=>h):(h=new Array(n),p=>{let x=a+c*p;for(let T=0;T<n;T++)h[T]=e[x+T];return h})}var ua=class{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){let r=this.props;if(e.binOptions&&(An(e.binOptions,r.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==r.operations[i]&&this.setNeedsUpdate(i);if(e.customOperations)for(let i=0;i<this.channelCount;i++)!!e.customOperations[i]!=!!r.customOperations[i]&&this.setNeedsUpdate(i);e.pointCount!==void 0&&e.pointCount!==r.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...r.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){if(this.needsUpdate===!0){this.bins=A9({pointCount:this.props.pointCount,getBinId:x4(this.props.getBin,this.props.attributes,this.props.binOptions)});let e=m9({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:e,type:"float32",size:this.dimensions}}for(let e=0;e<this.channelCount;e++)if(this.needsUpdate===!0||this.needsUpdate[e]){let r=this.props.customOperations[e]||_9[this.props.operations[e]],{value:i,domain:n}=y9({bins:this.bins,getValue:x4(this.props.getValue[e],this.props.attributes,void 0),operation:r,target:this.results[e]?.value});this.results[e]={value:i,domain:n,type:"float32",size:1},this.props.onUpdate?.({channel:e})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){return this.results[e]?.domain??[1/0,-1/0]}getBin(e){let r=this.bins[e];if(!r)return null;let i=new Array(this.channelCount);for(let n=0;n<i.length;n++){let o=this.results[n];i[n]=o?.value[e]}return{id:r.id,value:i,count:r.points.length,pointIndices:r.points}}};function a3(t,e,r){return t.createFramebuffer({width:e,height:r,colorAttachments:[t.createTexture({width:e,height:r,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}var ble=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,x9={name:"binSorter",vs:ble,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}};var v9=[1,2,4,8],b9=3e38,vle={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},hx=1024,l3=class{constructor(e,r){this.binsFBO=null,this.device=e,this.model=Tle(e,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(e){if(!this.binsFBO)return null;let r=e%hx,i=Math.floor(e/hx),n=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:i,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(n)}setDimensions(e,r){let i=hx,n=Math.ceil(e/i);this.binsFBO?this.binsFBO.height<n&&this.binsFBO.resize({width:i,height:n}):this.binsFBO=a3(this.device,i,n);let o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:o})}setModelProps(e){let r=this.model;e.attributes&&r.setAttributes(e.attributes),e.constantAttributes&&r.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&r.setVertexCount(e.vertexCount),e.shaderModuleProps&&r.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;let r=wle(e);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(e,r){if(r===0)return;r|=v9[3];let i=this.model,n=this.binsFBO,o=e==="MAX"?-b9:e==="MIN"?b9:0,a=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:n,parameters:{viewport:[0,0,n.width,n.height],colorMask:r},clearColor:[o,o,o,0],clearDepth:!1,clearStencil:!1});i.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),i.draw(a),a.end()}};function wle(t){let e={...vle};for(let r=0;r<t.length;r++){let i=t[r];i&&(e[i]+=v9[r])}return e}function Tle(t,e){let r=e.vs;e.dimensions===2&&(r+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);let i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${r}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new di(t,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],x9],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:i,fs:n,topology:"point-list",disableWarnings:!0})}var Ele=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,w9={name:"aggregatorTransform",vs:Ele,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};var b4=3e38,c3=class{constructor(e,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=r.channelCount,this.transform=Cle(e,r),this.domainFBO=a3(e,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){let e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(e);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,r){let{model:i,transformFeedback:n}=this.transform;i.setVertexCount(e);let o={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};i.shaderInputs.setProps({aggregatorTransform:o});let a=e*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<a)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:a}),n.setBuffer("binIds",this.binBuffer));let c=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<c)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:c}),n.setBuffer("values",this.valueBuffer))}update(e,r){if(!e)return;let i=this.transform,n=this.domainFBO,o=[0,1,2].map(h=>r[h]==="COUNT"?1:0),a=[0,1,2].map(h=>r[h]==="MEAN"?1:0),c={isCount:o,isMean:a,bins:e};i.model.shaderInputs.setProps({aggregatorTransform:c}),i.run({id:"gpu-aggregation-domain",framebuffer:n,parameters:{viewport:[0,0,2,1]},clearColor:[-b4,-b4,-b4,0],clearDepth:!1,clearStencil:!1}),this._domains=null}};function Cle(t,e){let r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Du(t,{vs:r,fs:i,topology:"point-list",modules:[w9],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:hx},varyings:["binIds","values"],disableWarnings:!0})}var Bo=class{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,r){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new l3(e,r),this.aggregationTransform=new c3(e,r),this.setProps(r)}getBins(){let e=this.aggregationTransform.binBuffer;return e?(this.binIds?.buffer!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){let r=this.aggregationTransform.valueBuffer;return!r||e>=this.channelCount?null:(this.results[e]?.buffer!==r&&(this.results[e]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;let{binIdRange:r}=this.props,i;if(this.dimensions===1)i=[e+r[0][0]];else{let[[c,h],[p]]=r,x=h-c;i=[e%x+c,Math.floor(e/x)+p]}let n=this.binSorter.getBinValues(e);if(!n)return null;let o=n[3],a=[];for(let c=0;c<this.channelCount;c++){let h=this.props.operations[c];h==="COUNT"?a[c]=o:o===0?a[c]=NaN:a[c]=h==="MEAN"?n[c]/o:n[c]}return{id:i,value:a,count:o}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){let r=this.props;if("binIdRange"in e&&!An(e.binIdRange,r.binIdRange,2)){let i=e.binIdRange;if(cr.assert(i.length===this.dimensions),this.dimensions===1){let[[n,o]]=i;this.binCount=o-n}else{let[[n,o],[a,c]]=i;this.binCount=(o-n)*(c-a)}this.binSorter.setDimensions(this.binCount,i),this.aggregationTransform.setDimensions(this.binCount,i),this.setNeedsUpdate()}if(e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==r.operations[i]&&this.setNeedsUpdate(i);if(e.pointCount!==void 0&&e.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(An(e.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){let i={},n={};for(let o of Object.values(e.attributes))for(let[a,c]of Object.entries(o.getValue()))ArrayBuffer.isView(c)?n[a]=c:c&&(i[a]=c);this.binSorter.setModelProps({attributes:i,constantAttributes:n})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;let{operations:e}=this.props,r=this.needsUpdate.map((i,n)=>i?e[n]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,e);for(let i=0;i<this.channelCount;i++)this.needsUpdate[i]&&(this.needsUpdate[i]=!1,this.props.onUpdate?.({channel:i}))}};var u3=class extends so{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){super.updateState(e);let r=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==r){this.state.aggregator?.destroy();let i=this.createAggregator(r);return i.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:i,aggregatorType:r}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){let{aggregator:r}=this.state;r.setProps({attributes:e});for(let i in e)this.onAttributeChange(i);r.update()}draw({shaderModuleProps:e}){let{aggregator:r}=this.state;r.setProps({shaderModuleProps:e}),r.preDraw()}_getAttributeManager(){return new Fl(this.context.device,{id:this.props.id,stats:this.context.stats})}};u3.layerName="AggregationLayer";var $u=u3;var Rd=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function v4(t,e=!1,r=Float32Array){let i;if(Number.isFinite(t[0]))i=new r(t);else{i=new r(t.length*4);let n=0;for(let o=0;o<t.length;o++){let a=t[o];i[n++]=a[0],i[n++]=a[1],i[n++]=a[2],i[n++]=Number.isFinite(a[3])?a[3]:255}}if(e)for(let n=0;n<i.length;n++)i[n]/=255;return i}var h3={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function Fm(t,e){t.setSampler({minFilter:h3[e],magFilter:h3[e]})}function km(t,e,r="linear"){let i=v4(e,!1,Uint8Array);return t.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:h3[r],magFilter:h3[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:i,width:i.length/4,height:1})}var T9=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`;var E9=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Sle=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,C9={name:"screenGrid",vs:Sle,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};var f3=class extends ln{getShaders(){return super.getShaders({vs:T9,fs:E9,modules:[Sn,C9]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,o=this.state.model;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=km(this.context.device,r.colorRange,r.colorScaleType);let a={colorRange:this.state.colorTexture};o.shaderInputs.setProps({screenGrid:a})}else i.colorScaleType!==r.colorScaleType&&Fm(this.state.colorTexture,r.colorScaleType);if(i.cellMarginPixels!==r.cellMarginPixels||i.cellSizePixels!==r.cellSizePixels||n.viewportChanged){let{width:a,height:c}=this.context.viewport,{cellSizePixels:h,cellMarginPixels:p}=this.props,x=Math.max(h-p,0),T={gridSizeClipspace:[h/a*2,h/c*2],cellSizeClipspace:[x/a*2,x/c*2]};o.shaderInputs.setProps({screenGrid:T})}}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let r=this.props.colorDomain(),i=this.state.model,n={colorDomain:r};i.shaderInputs.setProps({screenGrid:n}),i.draw(this.context.renderPass)}_getModel(){return new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qi({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}};f3.layerName="ScreenGridCellLayer";var S9=f3;var Ile=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,I9={name:"binOptions",vs:Ile,uniformTypes:{cellSizePixels:"f32"}};var Mle={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:Rd,colorScaleType:"linear",getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},fx=class extends $u{getAggregatorType(){return this.props.gpuAggregation&&Bo.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!Bo.isSupported(this.context.device)?new ua({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},i,n)=>{let o=this.context.viewport,a=o.project(r),c=n.cellSizePixels;return a[0]<0||a[0]>=o.width||a[1]<0||a[1]>=o.height?null:[Math.floor(a[0]/c),Math.floor(a[1]/c)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new Bo(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Bi,I9],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:o}=e,{cellSizePixels:a,aggregation:c}=i;if(r||o.dataChanged||o.updateTriggersChanged||o.viewportChanged||c!==n.aggregation||a!==n.cellSizePixels){let{width:h,height:p}=this.context.viewport,{aggregator:x}=this.state;x instanceof Bo&&x.setProps({binIdRange:[[0,Math.ceil(h/a)],[0,Math.ceil(p/a)]]}),x.setProps({pointCount:this.getNumInstances(),operations:[c],binOptions:{cellSizePixels:a}})}return o.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let{aggregator:e}=this.state,r=this.getSubLayerClass("cells",S9),i=e.getBins(),n=e.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:i,getWeight:n}},dataComparator:(o,a)=>o.length===a.length,updateTriggers:{getBin:[i],getWeight:[n]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),o;n&&(o={col:n.id[0],row:n.id[1],value:n.value[0],count:n.count},n.pointIndices&&(o.pointIndices=n.pointIndices,o.points=Array.isArray(this.props.data)?n.pointIndices.map(a=>this.props.data[a]):[])),r.object=o}return r}};fx.layerName="ScreenGridLayer";fx.defaultProps=Mle;var M9=fx;var Bd=class{constructor(e,r){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=r,this.attribute=e}getScalePercentile(){if(!this._percentile){let e=P9(this.input,this.inputLength);this._percentile=Rle(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){let e=P9(this.input,this.inputLength);this._ordinal=Ple(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:r,upperPercentile:i}){if(e==="quantile")return[r,i-1];if(r>0||i<100){let{domain:n}=this.getScalePercentile(),o=n[Math.floor(r)-1]??-1/0,a=n[Math.floor(i)-1]??1/0;if(e==="ordinal"){let{domain:c}=this.getScaleOrdinal();o=c.findIndex(h=>h>=o),a=c.findIndex(h=>h>a)-1,a===-2&&(a=c.length-1)}return[o,a]}return null}update(e){let r=this.props;if(e.scaleType!==r.scaleType)switch(e.scaleType){case"quantile":{let{attribute:i}=this.getScalePercentile();this.attribute=i,this.domain=[0,99];break}case"ordinal":{let{attribute:i,domain:n}=this.getScaleOrdinal();this.attribute=i,this.domain=[0,n.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==r.scaleType||e.lowerPercentile!==r.lowerPercentile||e.upperPercentile!==r.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}};function Ple(t){let e=new Set;for(let n of t)Number.isFinite(n)&&e.add(n);let r=Array.from(e).sort(),i=new Map;for(let n=0;n<r.length;n++)i.set(r[n],n);return{attribute:{value:t.map(n=>Number.isFinite(n)?i.get(n):NaN),type:"float32",size:1},domain:r}}function Rle(t,e=100){let r=Array.from(t).filter(Number.isFinite).sort(Ble),i=0,n=Math.max(1,e),o=new Array(n-1);for(;++i<n;)o[i-1]=Lle(r,i/n);return{attribute:{value:t.map(a=>Number.isFinite(a)?Ole(o,a):NaN),type:"float32",size:1},domain:o}}function P9(t,e){let r=(t.stride??4)/4,i=(t.offset??0)/4,n=t.value;if(!n){let a=t.buffer?.readSyncWebGL(0,r*4*e);a&&(n=new Float32Array(a.buffer),t.value=n)}if(r===1)return n.subarray(0,e);let o=new Float32Array(e);for(let a=0;a<e;a++)o[a]=n[a*r+i];return o}function Ble(t,e){return t-e}function Lle(t,e){let r=t.length;if(e<=0||r<2)return t[0];if(e>=1)return t[r-1];let i=(r-1)*e,n=Math.floor(i),o=t[n],a=t[n+1];return o+(a-o)*(i-n)}function Ole(t,e){let r=0,i=t.length;for(;r<i;){let n=r+i>>>1;t[n]>e?i=n:r=n+1}return r}function Nm({dataBounds:t,getBinId:e,padding:r=0}){let i=[t[0],t[1],[t[0][0],t[1][1]],[t[1][0],t[0][1]]].map(h=>e(h)),n=Math.min(...i.map(h=>h[0]))-r,o=Math.min(...i.map(h=>h[1]))-r,a=Math.max(...i.map(h=>h[0]))+r+1,c=Math.max(...i.map(h=>h[1]))+r+1;return[[n,a],[o,c]]}var R9=Math.PI/3,d3=2*Math.sin(R9),p3=1.5,B9=Array.from({length:6},(t,e)=>{let r=e*R9;return[Math.sin(r),-Math.cos(r)]});function A3([t,e],r){let i=Math.round(e=e/r/p3),n=Math.round(t=t/r/d3-(i&1)/2),o=e-i;if(Math.abs(o)*3>1){let a=t-n,c=n+(t<n?-1:1)/2,h=i+(e<i?-1:1),p=t-c,x=e-h;a*a+o*o>p*p+x*x&&(n=c+(i&1?1:-1)/2,i=h)}return[n,i]}var L9=`
const vec2 DIST = vec2(${d3}, ${p3});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function w4([t,e],r){return[(t+(e&1)/2)*r*d3,e*r*p3]}var O9=`
const vec2 DIST = vec2(${d3}, ${p3});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`;var D9=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${O9}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Dle=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,F9={name:"hexagon",vs:Dle,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};var m3=class extends Hu{getShaders(){let e=super.getShaders();return e.modules.push(F9),{...e,vs:D9}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=km(this.context.device,r.colorRange,r.colorScaleType);let o={colorRange:this.state.colorTexture};n.shaderInputs.setProps({hexagon:o})}else i.colorScaleType!==r.colorScaleType&&Fm(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let{radius:r,hexOriginCommon:i,elevationRange:n,elevationScale:o,extruded:a,coverage:c,colorDomain:h,elevationDomain:p}=this.props,x=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],R=this.state.fillModel;R.vertexArray.indexBuffer&&R.setIndexBuffer(null),R.setVertexCount(this.state.fillVertexCount);let k={colorDomain:[Math.max(h[0],x[0]),Math.min(h[1],x[1]),Math.max(h[0]-1,x[0]),Math.min(h[1]+1,x[1])],elevationDomain:[Math.max(p[0],T[0]),Math.min(p[1],T[1]),Math.max(p[0]-1,T[0]),Math.min(p[1]+1,T[1])],elevationRange:[n[0]*o,n[1]*o],originCommon:i};R.shaderInputs.setProps({column:{extruded:a,coverage:c,radius:r},hexagon:k}),R.draw(this.context.renderPass)}};m3.layerName="HexagonCellLayer";var k9=m3;var Fle=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,N9={name:"binOptions",vs:Fle,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function z9(){}var kle={gpuAggregation:!0,colorDomain:null,colorRange:Rd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:z9,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:z9,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},dx=class extends $u{getAggregatorType(){let{gpuAggregation:e,hexagonAggregator:r,getColorValue:i,getElevationValue:n}=this.props;return e&&(r||i||n)?(cr.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Bo.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{hexagonAggregator:r,radius:i}=this.props;return new ua({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},o,a)=>{if(r)return r(n,i);let h=this.state.aggregatorViewport.projectPosition(n),{radiusCommon:p,hexOriginCommon:x}=a;return A3([h[0]-x[0],h[1]-x[1]],p)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new Bo(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Bi,N9],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${L9}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:o}=e,{aggregator:a}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Ro(i.data).iterable)),r||o.dataChanged||i.radius!==n.radius||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{radiusCommon:c,hexOriginCommon:h,binIdRange:p,dataAsArray:x}=this.state;if(a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{radiusCommon:c,hexOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),x){let{getColorValue:T,getElevationValue:R}=this.props;a.setProps({customOperations:[T&&(k=>T(k.map(j=>x[j]),{indices:k,data:i.data})),R&&(k=>R(k.map(j=>x[j]),{indices:k,data:i.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&a.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&a.setNeedsUpdate(1),r}_updateBinOptions(){let e=this.getBounds(),r=1,i=[0,0],n=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{radius:c}=this.props,{unitsPerMeter:h}=o.getDistanceScales(a);r=h[0]*c;let p=A3(o.projectFlat(a),r);a=o.unprojectFlat(w4(p,r));let x=o.constructor;o=o.isGeospatial?new x({longitude:a[0],latitude:a[1],zoom:12}):new ol({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(o.center[0]),Math.fround(o.center[1])],n=Nm({dataBounds:e,getBinId:T=>{let R=o.projectFlat(T);return R[0]-=i[0],R[1]-=i[1],A3(R,r)},padding:1})}this.setState({radiusCommon:r,hexOriginCommon:i,binIdRange:n,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let r=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new Bd(n,i.binCount)}),r.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new Bd(n,i.binCount)}),r.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{radiusCommon:i,hexOriginCommon:n,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{radiusCommon:i,hexOriginCommon:n}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,radiusCommon:r,hexOriginCommon:i}=this.state,{elevationScale:n,colorRange:o,elevationRange:a,extruded:c,coverage:h,material:p,transitions:x,colorScaleType:T,lowerPercentile:R,upperPercentile:k,colorDomain:j,elevationScaleType:q,elevationLowerPercentile:Z,elevationUpperPercentile:re,elevationDomain:ee}=this.props,se=this.getSubLayerClass("cells",k9),me=e.getBins(),Le=this.state.colors?.update({scaleType:T,lowerPercentile:R,upperPercentile:k}),je=this.state.elevations?.update({scaleType:q,lowerPercentile:Z,upperPercentile:re});return!Le||!je?null:new se(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:me,getColorValue:Le.attribute,getElevationValue:je.attribute}},dataComparator:(Je,J)=>Je.length===J.length,updateTriggers:{getBin:[me],getColorValue:[Le.attribute],getElevationValue:[je.attribute]},diskResolution:6,vertices:B9,radius:r,hexOriginCommon:i,elevationScale:n,colorRange:o,colorScaleType:T,elevationRange:a,extruded:c,coverage:h,material:p,colorDomain:Le.domain||j||e.getResultDomain(0),elevationDomain:je.domain||ee||e.getResultDomain(1),colorCutoff:Le.cutoff,elevationCutoff:je.cutoff,transitions:x&&{getFillColor:x.getColorValue||x.getColorWeight,getElevation:x.getElevationValue||x.getElevationWeight},extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),o;if(n){let a=w4(n.id,this.state.radiusCommon),c=this.context.viewport.unprojectFlat(a);o={col:n.id[0],row:n.id[1],position:c,colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(o.pointIndices=n.pointIndices,o.points=Array.isArray(this.props.data)?n.pointIndices.map(h=>this.props.data[h]):[])}r.object=o}return r}};dx.layerName="HexagonLayer";dx.defaultProps=kle;var U9=dx;var _r=.16666666666666666,St={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},zm=[St.W,St.SW,St.S],Um=[St.S,St.SE,St.E],Vm=[St.E,St.NE,St.N],jm=[St.NW,St.W,St.N],Gm=[[-.5,_r],[-.5,-_r],[-_r,-.5],[_r,-.5]],Hm=[[-_r,-.5],[_r,-.5],[.5,-_r],[.5,_r]],Wm=[[.5,-_r],[.5,_r],[_r,.5],[-_r,.5]],$m=[[-.5,_r],[-.5,-_r],[_r,.5],[-_r,.5]],V9=[St.W,St.SW,St.SE,St.E],j9=[St.S,St.SE,St.NE,St.N],G9=[St.NW,St.W,St.E,St.NE],H9=[St.NW,St.SW,St.S,St.N],W9=[[-.5,_r],[-.5,-_r],[.5,-_r],[.5,_r]],$9=[[-_r,-.5],[_r,-.5],[_r,.5],[-_r,.5]],Nle=[St.NW,St.SW,St.SE,St.NE],q9=[St.NW,St.SW,St.SE,St.E,St.N],Z9=[St.W,St.SW,St.SE,St.NE,St.N],X9=[St.NW,St.W,St.S,St.SE,St.NE],Y9=[St.NW,St.SW,St.S,St.E,St.NE],K9=[St.NW,St.W,[.5,-_r],[.5,_r],St.N],Q9=[[-_r,-.5],[_r,-.5],St.E,St.NE,St.N],J9=[[-.5,_r],[-.5,-_r],St.S,St.SE,St.E],ez=[St.W,St.SW,St.S,[_r,.5],[-_r,.5]],tz=[St.NW,St.W,[-_r,-.5],[_r,-.5],St.N],rz=[[-.5,_r],[-.5,-_r],St.E,St.NE,St.N],iz=[St.S,St.SE,St.E,[_r,.5],[-_r,.5]],nz=[St.W,St.SW,St.S,[.5,-_r],[.5,_r]],oz=[St.W,St.SW,St.SE,St.E,[_r,.5],[-_r,.5]],sz=[[-.5,_r],[-.5,-_r],St.S,St.SE,St.NE,St.N],az=[St.NW,St.W,[-_r,-.5],[_r,-.5],St.E,St.NE],lz=[St.NW,St.SW,St.S,[.5,-_r],[.5,_r],St.N],qm=[St.W,St.SW,St.S,St.E,St.NE,St.N],Zm=[St.NW,St.W,St.S,St.SE,St.E,St.N],g3=[[-.5,_r],[-.5,-_r],[-_r,-.5],[_r,-.5],St.E,St.NE,St.N],_3=[St.W,St.SW,St.S,[.5,-_r],[.5,_r],[_r,.5],[-_r,.5]],y3=[St.NW,St.W,[-_r,-.5],[_r,-.5],[.5,-_r],[.5,_r],St.N],x3=[[-.5,_r],[-.5,-_r],St.S,St.SE,St.E,[_r,.5],[-_r,.5]],cz=[[-.5,_r],[-.5,-_r],[-_r,-.5],[_r,-.5],[.5,-_r],[.5,_r],[_r,.5],[-_r,.5]],uz={0:[],1:[[St.W,St.S]],2:[[St.S,St.E]],3:[[St.W,St.E]],4:[[St.N,St.E]],5:{0:[[St.W,St.S],[St.N,St.E]],1:[[St.W,St.N],[St.S,St.E]]},6:[[St.N,St.S]],7:[[St.W,St.N]],8:[[St.W,St.N]],9:[[St.N,St.S]],10:{0:[[St.W,St.N],[St.S,St.E]],1:[[St.W,St.S],[St.N,St.E]]},11:[[St.N,St.E]],12:[[St.W,St.E]],13:[[St.S,St.E]],14:[[St.W,St.S]],15:[]};function hr(t){return parseInt(t,4)}var hz={[hr("0000")]:[],[hr("2222")]:[],[hr("2221")]:[zm],[hr("2212")]:[Um],[hr("2122")]:[Vm],[hr("1222")]:[jm],[hr("0001")]:[zm],[hr("0010")]:[Um],[hr("0100")]:[Vm],[hr("1000")]:[jm],[hr("2220")]:[Gm],[hr("2202")]:[Hm],[hr("2022")]:[Wm],[hr("0222")]:[$m],[hr("0002")]:[Gm],[hr("0020")]:[Hm],[hr("0200")]:[Wm],[hr("2000")]:[$m],[hr("0011")]:[V9],[hr("0110")]:[j9],[hr("1100")]:[G9],[hr("1001")]:[H9],[hr("2211")]:[V9],[hr("2112")]:[j9],[hr("1122")]:[G9],[hr("1221")]:[H9],[hr("2200")]:[W9],[hr("2002")]:[$9],[hr("0022")]:[W9],[hr("0220")]:[$9],[hr("1111")]:[Nle],[hr("1211")]:[q9],[hr("2111")]:[Z9],[hr("1112")]:[X9],[hr("1121")]:[Y9],[hr("1011")]:[q9],[hr("0111")]:[Z9],[hr("1110")]:[X9],[hr("1101")]:[Y9],[hr("1200")]:[K9],[hr("0120")]:[Q9],[hr("0012")]:[J9],[hr("2001")]:[ez],[hr("1022")]:[K9],[hr("2102")]:[Q9],[hr("2210")]:[J9],[hr("0221")]:[ez],[hr("1002")]:[tz],[hr("2100")]:[rz],[hr("0210")]:[iz],[hr("0021")]:[nz],[hr("1220")]:[tz],[hr("0122")]:[rz],[hr("2012")]:[iz],[hr("2201")]:[nz],[hr("0211")]:[oz],[hr("2110")]:[sz],[hr("1102")]:[az],[hr("1021")]:[lz],[hr("2011")]:[oz],[hr("0112")]:[sz],[hr("1120")]:[az],[hr("1201")]:[lz],[hr("2101")]:[qm],[hr("0121")]:[qm],[hr("1012")]:[Zm],[hr("1210")]:[Zm],[hr("0101")]:{0:[zm,Vm],1:[qm],2:[qm]},[hr("1010")]:{0:[jm,Um],1:[Zm],2:[Zm]},[hr("2121")]:{0:[qm],1:[qm],2:[zm,Vm]},[hr("1212")]:{0:[Zm],1:[Zm],2:[jm,Um]},[hr("2120")]:{0:[g3],1:[g3],2:[Gm,Vm]},[hr("2021")]:{0:[_3],1:[_3],2:[zm,Wm]},[hr("1202")]:{0:[y3],1:[y3],2:[jm,Hm]},[hr("0212")]:{0:[x3],1:[x3],2:[Um,$m]},[hr("0102")]:{0:[Gm,Vm],1:[g3],2:[g3]},[hr("0201")]:{0:[zm,Wm],1:[_3],2:[_3]},[hr("1020")]:{0:[jm,Hm],1:[y3],2:[y3]},[hr("2010")]:{0:[Um,$m],1:[x3],2:[x3]},[hr("2020")]:{0:[$m,Hm],1:[cz],2:[Gm,Wm]},[hr("0202")]:{0:[Wm,Gm],1:[cz],2:[$m,Hm]}};function px(t,e){return Number.isNaN(t)?0:Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function fz(t){let{x:e,y:r,xRange:i,yRange:n,getValue:o,threshold:a}=t,c=e<i[0],h=e>=i[1]-1,p=r<n[0],x=r>=n[1]-1,T=c||h||p||x,R=0,k,j,q,Z;if(c||x)q=0;else{let se=o(e,r+1);q=px(se,a),R+=se}if(h||x)Z=0;else{let se=o(e+1,r+1);Z=px(se,a),R+=se}if(h||p)j=0;else{let se=o(e+1,r);j=px(se,a),R+=se}if(c||p)k=0;else{let se=o(e,r);k=px(se,a),R+=se}let re=-1;Number.isFinite(a)&&(re=q<<3|Z<<2|j<<1|k),Array.isArray(a)&&(re=q<<6|Z<<4|j<<2|k);let ee=0;return T||(ee=px(R/4,a)),{code:re,meanCode:ee}}function dz(t){let{x:e,y:r,z:i,code:n,meanCode:o}=t,a=hz[n];Array.isArray(a)||(a=a[o]);let c=e+1,h=r+1,p=[];return a.forEach(x=>{let T=[];x.forEach(R=>{let k=c+R[0],j=h+R[1];T.push([k,j,i])}),p.push(T)}),p}function pz(t){let{x:e,y:r,z:i,code:n,meanCode:o}=t,a=uz[n];Array.isArray(a)||(a=a[o]);let c=e+1,h=r+1,p=[];return a.forEach(x=>{x.forEach(T=>{let R=c+T[0],k=h+T[1];p.push([R,k,i])})}),p}function Az({contours:t,getValue:e,xRange:r,yRange:i}){let n=[],o=[],a=0,c=0;for(let h=0;h<t.length;h++){let p=t[h],x=p.zIndex??h,{threshold:T}=p;for(let R=r[0]-1;R<r[1];R++)for(let k=i[0]-1;k<i[1];k++){let{code:j,meanCode:q}=fz({getValue:e,threshold:T,x:R,y:k,xRange:r,yRange:i}),Z={x:R,y:k,z:x,code:j,meanCode:q};if(Array.isArray(T)){let re=dz(Z);for(let ee of re)o[c++]={vertices:ee,contour:p}}else{let re=pz(Z);re.length>0&&(n[a++]={vertices:re,contour:p})}}}return{lines:n,polygons:o}}function mz(t){let{aggregator:e,binIdRange:r,channel:i}=t;if(e instanceof Bo){let n=e.getResult(i)?.buffer;if(n){let o=new Float32Array(n.readSyncWebGL().buffer);return zle(o,r)}}if(e instanceof ua){let n=e.getResult(i)?.value,o=e.getBins()?.value;if(o&&n)return Ule(n,o,e.binCount)}return null}function zle(t,e){let[[r,i],[n,o]]=e,a=i-r,c=o-n;return(h,p)=>(h-=r,p-=n,h<0||h>=a||p<0||p>=c?NaN:t[p*a+h])}function Ule(t,e,r){let i={};for(let n=0;n<r;n++){let o=e[n*2],a=e[n*2+1];i[o]=i[o]||{},i[o][a]=t[n]}return(n,o)=>i[n]?.[o]??NaN}var Vle=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,gz={name:"binOptions",vs:Vle,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};var _z=[255,255,255,255],jle=1,Gle={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005},Ax=class extends $u{getAggregatorType(){return this.props.gpuAggregation&&Bo.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new ua({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},i,n)=>{let a=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:c,cellOriginCommon:h}=n;return[Math.floor((a[0]-h[0])/c[0]),Math.floor((a[1]-h[1])/c[1])]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}],onUpdate:this._onAggregationUpdate.bind(this)}):new Bo(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Bi,gz],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:o}=e,{aggregator:a}=this.state;if(r||o.dataChanged||i.cellSize!==n.cellSize||!An(i.gridOrigin,n.gridOrigin,1)||i.aggregation!==n.aggregation){this._updateBinOptions();let{cellSizeCommon:c,cellOriginCommon:h,binIdRange:p}=this.state;a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.aggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:h}})}return An(n.contours,i.contours,2)||this.setState({contourData:null}),r}_updateBinOptions(){let e=this.getBounds(),r=[1,1],i=[0,0],n=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:c,gridOrigin:h}=this.props,{unitsPerMeter:p}=o.getDistanceScales(a);r[0]=p[0]*c,r[1]=p[1]*c;let x=o.projectFlat(a);i=[Math.floor((x[0]-h[0])/r[0])*r[0]+h[0],Math.floor((x[1]-h[1])/r[1])*r[1]+h[1]],a=o.unprojectFlat(i);let T=o.constructor;o=o.isGeospatial?new T({longitude:a[0],latitude:a[1],zoom:12}):new ol({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(o.center[0]),Math.fround(o.center[1])],n=Nm({dataBounds:e,getBinId:R=>{let k=o.projectFlat(R);return[Math.floor((k[0]-i[0])/r[0]),Math.floor((k[1]-i[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:i,binIdRange:n,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){let{aggregator:e,binIdRange:r}=this.state;this.setState({aggregatedValueReader:mz({aggregator:e,binIdRange:r,channel:0}),contourData:null})}_getContours(){let{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){let{binIdRange:r}=this.state,{contours:i}=this.props,n=Az({contours:i,getValue:e,xRange:r[0],yRange:r[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let e=this._getContours();if(!e)return null;let{lines:r,polygons:i}=e,{zOffset:n}=this.props,{cellOriginCommon:o,cellSizeCommon:a}=this.state,c=this.getSubLayerClass("lines",Wu),h=this.getSubLayerClass("bands",Md),p=new wr().translate([o[0],o[1],0]).scale([a[0],a[1],n]),x=r&&r.length>0&&new c(this.getSubLayerProps({id:"lines"}),{data:r,coordinateSystem:vr.CARTESIAN,modelMatrix:p,getPath:R=>R.vertices,getColor:R=>R.contour.color??_z,getWidth:R=>R.contour.strokeWidth??jle,widthUnits:"pixels"}),T=i&&i.length>0&&new h(this.getSubLayerProps({id:"bands"}),{data:i,coordinateSystem:vr.CARTESIAN,modelMatrix:p,getPolygon:R=>R.vertices,getFillColor:R=>R.contour.color??_z});return[x,T]}getPickingInfo(e){let r=e.info,{object:i}=r;return i&&(r.object={contour:i.contour}),r}};Ax.layerName="ContourLayer";Ax.defaultProps=Gle;var yz=Ax;var xz=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Hle=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,bz={name:"grid",vs:Hle,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};var mx=class extends Hu{getShaders(){let e=super.getShaders();return e.modules.push(bz),{...e,vs:xz}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=km(this.context.device,r.colorRange,r.colorScaleType);let o={colorRange:this.state.colorTexture};n.shaderInputs.setProps({grid:o})}else i.colorScaleType!==r.colorScaleType&&Fm(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}_updateGeometry(){let e=new nA;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{cellOriginCommon:r,cellSizeCommon:i,elevationRange:n,elevationScale:o,extruded:a,coverage:c,colorDomain:h,elevationDomain:p}=this.props,x=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],R=this.state.fillModel,k={colorDomain:[Math.max(h[0],x[0]),Math.min(h[1],x[1]),Math.max(h[0]-1,x[0]),Math.min(h[1]+1,x[1])],elevationDomain:[Math.max(p[0],T[0]),Math.min(p[1],T[1]),Math.max(p[0]-1,T[0]),Math.min(p[1]+1,T[1])],elevationRange:[n[0]*o,n[1]*o],originCommon:r,sizeCommon:i};R.shaderInputs.setProps({column:{extruded:a,coverage:c},grid:k}),R.draw(this.context.renderPass)}};mx.layerName="GridCellLayer";var Wle=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,vz={name:"binOptions",vs:Wle,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function wz(){}var $le={gpuAggregation:!0,colorDomain:null,colorRange:Rd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:wz,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:wz,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},gx=class extends $u{getAggregatorType(){let{gpuAggregation:e,gridAggregator:r,getColorValue:i,getElevationValue:n}=this.props;return e&&(r||i||n)?(cr.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Bo.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{gridAggregator:r,cellSize:i}=this.props;return new ua({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},o,a)=>{if(r)return r(n,i);let h=this.state.aggregatorViewport.projectPosition(n),{cellSizeCommon:p,cellOriginCommon:x}=a;return[Math.floor((h[0]-x[0])/p[0]),Math.floor((h[1]-x[1])/p[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new Bo(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Bi,vz],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:o}=e,{aggregator:a}=this.state;if((o.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Ro(i.data).iterable)),r||o.dataChanged||i.cellSize!==n.cellSize||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{cellSizeCommon:c,cellOriginCommon:h,binIdRange:p,dataAsArray:x}=this.state;if(a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),x){let{getColorValue:T,getElevationValue:R}=this.props;a.setProps({customOperations:[T&&(k=>T(k.map(j=>x[j]),{indices:k,data:i.data})),R&&(k=>R(k.map(j=>x[j]),{indices:k,data:i.data}))]})}}return o.updateTriggersChanged&&o.updateTriggersChanged.getColorValue&&a.setNeedsUpdate(0),o.updateTriggersChanged&&o.updateTriggersChanged.getElevationValue&&a.setNeedsUpdate(1),r}_updateBinOptions(){let e=this.getBounds(),r=[1,1],i=[0,0],n=[[0,1],[0,1]],o=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:c}=this.props,{unitsPerMeter:h}=o.getDistanceScales(a);r[0]=h[0]*c,r[1]=h[1]*c;let p=o.projectFlat(a);i=[Math.floor(p[0]/r[0])*r[0],Math.floor(p[1]/r[1])*r[1]],a=o.unprojectFlat(i);let x=o.constructor;o=o.isGeospatial?new x({longitude:a[0],latitude:a[1],zoom:12}):new ol({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(o.center[0]),Math.fround(o.center[1])],n=Nm({dataBounds:e,getBinId:T=>{let R=o.projectFlat(T);return[Math.floor((R[0]-i[0])/r[0]),Math.floor((R[1]-i[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:i,binIdRange:n,aggregatorViewport:o})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let r=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new Bd(n,i.binCount)}),r.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new Bd(n,i.binCount)}),r.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:o}=this.state;r.setProps({binIdRange:o,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,cellOriginCommon:r,cellSizeCommon:i}=this.state,{elevationScale:n,colorRange:o,elevationRange:a,extruded:c,coverage:h,material:p,transitions:x,colorScaleType:T,lowerPercentile:R,upperPercentile:k,colorDomain:j,elevationScaleType:q,elevationLowerPercentile:Z,elevationUpperPercentile:re,elevationDomain:ee}=this.props,se=this.getSubLayerClass("cells",mx),me=e.getBins(),Le=this.state.colors?.update({scaleType:T,lowerPercentile:R,upperPercentile:k}),je=this.state.elevations?.update({scaleType:q,lowerPercentile:Z,upperPercentile:re});return!Le||!je?null:new se(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:me,getColorValue:Le.attribute,getElevationValue:je.attribute}},dataComparator:(Je,J)=>Je.length===J.length,updateTriggers:{getBin:[me],getColorValue:[Le.attribute],getElevationValue:[je.attribute]},cellOriginCommon:r,cellSizeCommon:i,elevationScale:n,colorRange:o,colorScaleType:T,elevationRange:a,extruded:c,coverage:h,material:p,colorDomain:Le.domain||j||e.getResultDomain(0),elevationDomain:je.domain||ee||e.getResultDomain(1),colorCutoff:Le.cutoff,elevationCutoff:je.cutoff,transitions:x&&{getFillColor:x.getColorValue||x.getColorWeight,getElevation:x.getElevationValue||x.getElevationWeight},extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),o;n&&(o={col:n.id[0],row:n.id[1],colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(o.pointIndices=n.pointIndices,o.points=Array.isArray(this.props.data)?n.pointIndices.map(a=>this.props.data[a]):[])),r.object=o}return r}};gx.layerName="GridLayer";gx.defaultProps=$le;var Tz=gx;function Cz(t){let e=t.map(c=>c[0]),r=t.map(c=>c[1]),i=Math.min.apply(null,e),n=Math.max.apply(null,e),o=Math.min.apply(null,r),a=Math.max.apply(null,r);return[i,o,n,a]}function Sz(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}var Ez=new Float32Array(12);function T4(t,e=2){let r=0;for(let i of t)for(let n=0;n<e;n++)Ez[r++]=i[n]||0;return Ez}function Iz(t,e,r){let[i,n,o,a]=t,c=o-i,h=a-n,p=c,x=h;c/h<e/r?p=e/r*h:x=r/e*c,p<e&&(p=e,x=r);let T=(o+i)/2,R=(a+n)/2;return[T-p/2,R-x/2,T+p/2,R+x/2]}function Mz(t,e){let[r,i,n,o]=e;return[(t[0]-r)/(n-r),(t[1]-i)/(o-i)]}var Pz=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`;var Rz=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`;var Bz=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,Lz={name:"triangle",vs:Bz,fs:Bz,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};var b3=class extends ln{getShaders(){return super.getShaders({vs:Pz,fs:Rz,modules:[Bi,Lz]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){let{vertexCount:r,data:i}=this.props;return new di(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){let{model:e}=this.state,{aggregationMode:r,colorDomain:i,intensity:n,threshold:o,colorTexture:a,maxTexture:c,weightsTexture:h}=this.props,p={aggregationMode:r,colorDomain:i,intensity:n,threshold:o,colorTexture:a,maxTexture:c,weightsTexture:h};e.shaderInputs.setProps({triangle:p}),e.draw(this.context.renderPass)}};b3.layerName="TriangleLayer";var Oz=b3;function Dz(t,e){let r={};for(let i in t)e.includes(i)||(r[i]=t[i]);return r}var v3=class extends so{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:Dz(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);let{changeFlags:r}=e;if(r.extensionsChanged){let i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:e,mousePosition:r,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:r,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,r={}){let{props:i,oldProps:n,changeFlags:o}=e,{compareAll:a=!1,dimension:c}=r,{ignoreProps:h}=this.state,{props:p,accessors:x=[]}=c,{updateTriggersChanged:T}=o;if(o.dataChanged)return!0;if(T){if(T.all)return!0;for(let R of x)if(T[R])return!0}if(a)return o.extensionsChanged?!0:Ay({oldProps:n,newProps:i,ignoreProps:h,propTypes:this.constructor._propTypes});for(let R of p)if(i[R]!==n[R])return!0;return!1}isAttributeChanged(e){let{changedAttributes:r}=this.state;return e?r&&r[e]!==void 0:!qle(r)}_getAttributeManager(){return new Fl(this.context.device,{id:this.props.id,stats:this.context.stats})}};v3.layerName="AggregationLayer";var Fz=v3;function qle(t){let e=!0;for(let r in t){e=!1;break}return e}var E4=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`;var C4=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var kz=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var Nz=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var Zle=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,zz={name:"weight",vs:Zle,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},Uz={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}};var Xle=2,S4={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},Vz=[0,0],Yle={SUM:0,MEAN:1},Kle={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Rd,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},Qle=["float32-renderable-webgl","texture-blend-float-webgl"],Jle={data:{props:["radiusPixels"]}},_x=class extends Fz{getShaders(e){let r=[Bi];return e.modules&&(r=[...r,...e.modules]),super.getShaders({...e,modules:r})}initializeState(){super.initializeAggregationLayer(Jle),this.setState({colorDomain:Vz}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){let{props:r,oldProps:i}=e,n=this._getChangeFlags(e);(n.dataChanged||n.viewportChanged)&&(n.boundsChanged=this._updateBounds(n.dataChanged),this._updateTextureRenderingBounds()),n.dataChanged||n.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):n.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){let{weightsTexture:e,triPositionBuffer:r,triTexCoordBuffer:i,maxWeightsTexture:n,colorTexture:o,colorDomain:a}=this.state,{updateTriggers:c,intensity:h,threshold:p,aggregation:x}=this.props,T=this.getSubLayerClass("triangle",Oz);return new T(this.getSubLayerProps({id:"triangle-layer",updateTriggers:c}),{coordinateSystem:vr.DEFAULT,data:{attributes:{positions:r,texCoords:i}},vertexCount:4,maxTexture:n,colorTexture:o,aggregationMode:Yle[x]||0,weightsTexture:e,intensity:h,threshold:p,colorDomain:a})}finalizeState(e){super.finalizeState(e);let{weightsTransform:r,weightsTexture:i,maxWeightTransform:n,maxWeightsTexture:o,triPositionBuffer:a,triTexCoordBuffer:c,colorTexture:h,updateTimer:p}=this.state;r?.destroy(),i?.destroy(),n?.destroy(),o?.destroy(),a?.destroy(),c?.destroy(),h?.destroy(),p&&clearTimeout(p)}_getAttributeManager(){return new Fl(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){let r={},{dimensions:i}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",r.viewportChanged=e.changeFlags.viewportChanged;let{zoom:n}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==n)&&(r.viewportZoomChanged=!0),r}_createTextures(){let{textureSize:e,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...S4,width:e,height:e,format:r}),maxWeightsTexture:this.context.device.createTexture({...S4,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:e}=this.context,{weightsTextureSize:r}=this.props,i=Math.min(r,e.limits.maxTextureDimension2D),n=Qle.every(c=>e.features.has(c)),o=n?"rgba32float":"rgba8unorm",a=n?1:1/255;this.setState({textureSize:i,format:o,weightsScale:a}),n||cr.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:r}=this.state,{weightsTexture:i}=this.state,n=this.getAttributeManager();r?.destroy(),r=new gm(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:n.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,zz]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();let{device:e}=this.context,{textureSize:r,weightsTexture:i,maxWeightsTexture:n}=this.state,o=this.getShaders({vs:E4,fs:C4});this._createWeightsTransform(o);let a=this.getShaders({vs:kz,fs:Nz,modules:[Uz]}),c=new gm(e,{id:`${this.id}-max-weights-transform`,targetTexture:n,...a,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),h={inTexture:i,textureSize:r};c.model.shaderInputs.setProps({maxWeight:h}),this.setState({weightsTexture:i,maxWeightsTexture:n,maxWeightTransform:c,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:E4,fs:C4,...e})}_updateMaxWeightValue(){let{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){let{viewport:r}=this.context,i=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(c=>c.map(Math.fround)),n=Cz(i),o={visibleWorldBounds:n,viewportCorners:i},a=!1;if(e||!this.state.worldBounds||!Sz(this.state.worldBounds,n)){let c=this._worldToCommonBounds(n),h=this._commonToWorldBounds(c);this.props.coordinateSystem===vr.LNGLAT&&(h[1]=Math.max(h[1],-85.051129),h[3]=Math.min(h[3],85.051129),h[0]=Math.max(h[0],-360),h[2]=Math.min(h[2],360));let p=this._worldToCommonBounds(h);o.worldBounds=h,o.normalizedCommonBounds=p,a=!0}return this.setState(o),a}_updateTextureRenderingBounds(){let{triPositionBuffer:e,triTexCoordBuffer:r,normalizedCommonBounds:i,viewportCorners:n}=this.state,{viewport:o}=this.context;e.write(T4(n,3));let a=n.map(c=>Mz(o.projectPosition(c),i));r.write(T4(a,2))}_updateColorTexture(e){let{colorRange:r}=e.props,{colorTexture:i}=this.state,n=v4(r,!1,Uint8Array);i&&i?.width===r.length?i.setTexture2DData({data:n}):(i?.destroy(),i=this.context.device.createTexture({...S4,data:n,width:r.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){let{radiusPixels:e,colorDomain:r,aggregation:i}=this.props,{worldBounds:n,textureSize:o,weightsScale:a,weightsTexture:c}=this.state,h=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let p=this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0});if(r&&i==="SUM"){let{viewport:se}=this.context,me=se.distanceScales.metersPerUnit[2]*(p[2]-p[0])/o;this.state.colorDomain=r.map(Le=>Le*me*a)}else this.state.colorDomain=r||Vz;let T=this.getAttributeManager().getAttributes(),R=this.getModuleSettings();this._setModelAttributes(h.model,T),h.model.setVertexCount(this.getNumInstances());let k={radiusPixels:e,commonBounds:p,textureWidth:o,weightsScale:a,weightsTexture:c},{viewport:j,devicePixelRatio:q,coordinateSystem:Z,coordinateOrigin:re}=R,{modelMatrix:ee}=this.props;h.model.shaderInputs.setProps({project:{viewport:j,devicePixelRatio:q,modelMatrix:ee,coordinateSystem:Z,coordinateOrigin:re},weight:k}),h.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:r}=this.state,{debounceTimeout:i}=this.props;e?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:r})}_worldToCommonBounds(e,r={}){let{useLayerCoordinateSystem:i=!1}=r,[n,o,a,c]=e,{viewport:h}=this.context,{textureSize:p}=this.state,{coordinateSystem:x}=this.props,T=i&&(x===vr.LNGLAT_OFFSETS||x===vr.METER_OFFSETS),R=T?h.projectPosition(this.props.coordinateOrigin):[0,0],k=p*Xle/h.scale,j,q;return i&&!T?(j=this.projectPosition([n,o,0]),q=this.projectPosition([a,c,0])):(j=h.projectPosition([n,o,0]),q=h.projectPosition([a,c,0])),Iz([j[0]-R[0],j[1]-R[1],q[0]-R[0],q[1]-R[1]],k,k)}_commonToWorldBounds(e){let[r,i,n,o]=e,{viewport:a}=this.context,c=a.unprojectPosition([r,i]),h=a.unprojectPosition([n,o]);return c.slice(0,2).concat(h.slice(0,2))}};_x.layerName="HeatmapLayer";_x.defaultProps=Kle;var jz=_x;var Z5={};no(Z5,{GeohashLayer:()=>$H,GreatCircleLayer:()=>RU,H3ClusterLayer:()=>OV,H3HexagonLayer:()=>k3,MVTLayer:()=>jH,QuadkeyLayer:()=>WU,S2Layer:()=>GU,TerrainLayer:()=>mH,Tile3DLayer:()=>cH,TileLayer:()=>TA,TripsLayer:()=>hV,_GeoCellLayer:()=>qu,_Tile2DHeader:()=>vA,_Tileset2D:()=>wA,_WMSLayer:()=>Ym,_getURLFromTemplate:()=>Yu});function ece(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function w3(t){if(Array.isArray(t))return t.map(e=>w3(e));if(t&&typeof t=="object"){let e={};for(let[r,i]of Object.entries(t))e[ece(r)]=w3(i);return e}return t}var vU=yc(bU(),1);function N4(t,e){if(e?._parser&&e._parser!=="fast-xml-parser")throw new Error(e?._parser);let r={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e?.removeNSPrefix,textNodeName:e?.textNodeName,isArray:(n,o,a,c)=>!!e?.arrayPaths?.some(p=>o===p),...e?._fastXML},i=due(t,r);return e?.uncapitalizeKeys?w3(i):i}function due(t,e){return new vU.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}var pue="4.3.2",kc={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:pue,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:Aue,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>N4(new TextDecoder().decode(t),{...kc.options.xml,...e?.xml}),parseTextSync:(t,e)=>N4(t,{...kc.options.xml,...e?.xml})};function Aue(t){return t.startsWith("<?xml")}function wU(t,e){let r=kc.parseTextSync?.(t,e),i=r?.ServiceExceptionReport?.ServiceException||r?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof i=="string"?i:i.value||i.code||"Unknown error"}var mue="4.3.2",bx={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:mue,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:gue,options:{wms:{throwOnError:!1}},parse:async(t,e)=>z4(new TextDecoder().decode(t),e),parseSync:(t,e)=>z4(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>z4(t,e)};function gue(t){return t.startsWith("<?xml")}function z4(t,e){let r={...bx.options.wms,...e?.wms},i=wU(t,r),n=r.minimalErrors?i:`WMS Service error: ${i}`;if(r.throwOnError)throw new Error(n);return n}function xA(t){return Array.isArray(t)?t:t?[t]:[]}function vx(t){let e=xA(t);return e.length>0&&e.every(r=>typeof r=="string")?e:[]}function wx(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function E3(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function bA(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function U4(t,e){let r=kc.parseTextSync?.(t,e),i=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,n=_ue(i);if(e?.inheritedLayerProps)for(let o of n.layers)EU(o,null);return e?.includeRawJSON&&(n.json=i),e?.includeXMLText&&(n.xml=t),n}function _ue(t){let e={version:String(t.version||""),name:String(t.Service?.Name||"unnamed"),title:t.Service?.Title?String(t.Service?.Title):void 0,abstract:t.Service?.Abstract?String(t.Service?.Abstract):void 0,keywords:vx(t.Service?.KeywordList?.Keyword),fees:t.Service?.Fees?JSON.stringify(t.Service?.Fees):void 0,accessConstraints:t.Service?.AccessConstraints?JSON.stringify(t.Service?.AccessConstraints):void 0,layerLimit:E3(t.Service?.LayerLimit),maxWidth:E3(t.Service?.maxWidth),maxHeight:E3(t.Service?.maxHeight),layers:[],requests:yue(t.Capability?.Request),exceptions:xue(t.Exception)},r=xA(t.Capability?.Layer);for(let i of r)e.layers.push(TU(i));for(let[i,n]of Object.entries(e))n===void 0&&delete e[i];return e}function yue(t){let e={};for(let[r,i]of Object.entries(t||{})){let n=vx(i?.Format);e[r]={mimeTypes:n}}return e}function xue(t){if(xA(t?.Format).length>0)return{mimeTypes:vx(t)}}function TU(t){let e={title:String(t?.Title||""),name:t?.Name&&String(t?.Name),abstract:t?.Name&&String(t?.Abstract),keywords:vx(t.KeywordList?.Keyword)},r=t?.CRS||t?.SRS;r&&Array.isArray(r)&&r.every(p=>typeof p=="string")&&(e.crs=r);let i=t?.EX_GeographicBoundingBox&&bue(t?.EX_GeographicBoundingBox);i&&(e.geographicBoundingBox=i),i=t?.LatLonBoundingBox&&vue(t?.LatLonBoundingBox),i&&(e.geographicBoundingBox=i);let n=t?.BoundingBox&&wue(t?.BoundingBox);n&&n.length>0&&(e.boundingBoxes=n);let a=xA(t?.Dimension).map(p=>Eue(p));a.length&&(e.dimensions=a),t?.opaque&&(e.opaque=bA(t?.opaque)),t?.cascaded&&(e.cascaded=bA(t?.cascaded)),t?.queryable&&(e.queryable=bA(t?.queryable));let c=xA(t?.Layer),h=[];for(let p of c)h.push(TU(p));h.length>0&&(e.layers=h);for(let[p,x]of Object.entries(e))x===void 0&&delete e[p];return e}function bue(t){let{westBoundLongitude:e,northBoundLatitude:r,eastBoundLongitude:i,southBoundLatitude:n}=t;return[[e,n],[i,r]]}function vue(t){let{minx:e,miny:r,maxx:i,maxy:n}=t;return[[e,r],[i,n]]}function wue(t){return xA(t).map(r=>Tue(r))}function Tue(t){let{CRS:e,SRS:r,minx:i,miny:n,maxx:o,maxy:a,resx:c,resy:h}=t,p={crs:e||r,boundingBox:[[wx(i),wx(n)],[wx(o),wx(a)]]};return c&&(p.xResolution=c),h&&(p.yResolution=h),p}function Eue(t){let{name:e,units:r,value:i}=t,n={name:e,units:r,extent:i};return t.unitSymbol&&(n.unitSymbol=t.unitSymbol),t.default&&(n.defaultValue=t.default),t.multipleValues&&(n.multipleValues=bA(t.multipleValues)),t.nearestValue&&(n.nearestValue=bA(t.nearestValue)),t.current&&(n.current=bA(t.current)),n}function EU(t,e){e?.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),e?.crs&&!t.crs&&(t.crs=[...e.crs]),e?.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),e?.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(let r of t.layers||[])EU(r,t)}var Cue="4.3.2",Xm={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:Cue,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:Sue,options:{wms:{}},parse:async(t,e)=>U4(new TextDecoder().decode(t),e?.wms),parseTextSync:(t,e)=>U4(t,e?.wms)};function Sue(t){return t.startsWith("<?xml")}function V4(t,e){let i=(kc.parseTextSync?.(t,e)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(i)?i:[i]).map(o=>Iue(o))}}function Iue(t){return{attributes:t||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}var CU={...Xm,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>V4(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>V4(t,e)};function j4(t,e){return kc.parseTextSync?.(t,e)}var SU={...Xm,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>j4(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>j4(t,e)};var IU={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("wms"),createDataSource:(t,e)=>new G4(t,e)},G4=class extends Tu{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(e,r){super(r),this.url=e,this.data=e,this.substituteCRS84=r.wms?.substituteCRS84??r.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...r.wmsParameters,...r.wms?.wmsParameters},this.vendorParameters=r.wms?.vendorParameters||r.vendorParameters||{}}async getMetadata(){let e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){let{boundingBox:r,bbox:i,...n}=e,o={bbox:r?[...r[0],...r[1]]:i,...n};return await this.getMap(o)}normalizeMetadata(e){return e}async getCapabilities(e,r){let i=this.getCapabilitiesURL(e,r),n=await this.fetch(i),o=await n.arrayBuffer();this._checkResponse(n,o);let a=await Xm.parse(o,this.loadOptions);return this.capabilities=a,a}async getMap(e,r){let i=this.getMapURL(e,r),n=await this.fetch(i),o=await n.arrayBuffer();this._checkResponse(n,o);try{return await sd.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}async getFeatureInfo(e,r){let i=this.getFeatureInfoURL(e,r),n=await this.fetch(i),o=await n.arrayBuffer();return this._checkResponse(n,o),await CU.parse(o,this.loadOptions)}async getFeatureInfoText(e,r){let i=this.getFeatureInfoURL(e,r),n=await this.fetch(i),o=await n.arrayBuffer();return this._checkResponse(n,o),new TextDecoder().decode(o)}async describeLayer(e,r){let i=this.describeLayerURL(e,r),n=await this.fetch(i),o=await n.arrayBuffer();return this._checkResponse(n,o),await SU.parse(o,this.loadOptions)}async getLegendGraphic(e,r){let i=this.getLegendGraphicURL(e,r),n=await this.fetch(i),o=await n.arrayBuffer();this._checkResponse(n,o);try{return await sd.parse(o,this.loadOptions)}catch{throw this._parseError(o)}}getCapabilitiesURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",i,r)}getMapURL(e,r){e=this._getWMS130Parameters(e);let i={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",i,r)}getFeatureInfoURL(e,r){e=this._getWMS130Parameters(e);let{boundingBox:i,bbox:n}=e;e.bbox=i?[...i[0],...i[1]]:n;let o={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",o,r)}describeLayerURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",i,r)}getLegendGraphicURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",i,r)}_parseWMSUrl(e){let[r,i]=e.split("?"),n=i.split("&"),o={};for(let a of n){let[c,h]=a.split("=");o[c]=h}return{url:r,parameters:o}}_getWMSUrl(e,r,i){let n=this.url,o=!0,a={service:"WMS",version:r.version,request:e,...r,...this.vendorParameters,...i},c=["transparent","time","elevation"];for(let[h,p]of Object.entries(a))(!c.includes(h)||p)&&(n+=o?"?":"&",o=!1,n+=this._getURLParameter(h,p,r));return encodeURI(n)}_getWMS130Parameters(e){let r={...e};return r.srs&&(r.crs=r.crs||r.srs,delete r.srs),r}_getURLParameter(e,r,i){switch(e){case"crs":i.version!=="1.3.0"?e="srs":this.substituteCRS84&&r==="EPSG:4326"&&(r="CRS:84");break;case"srs":i.version==="1.3.0"&&(e="crs");break;case"bbox":let n=this._flipBoundingBox(r,i);n&&(r=n);break;case"x":i.version==="1.3.0"&&(e="i");break;case"y":i.version==="1.3.0"&&(e="j");break;default:}return e=e.toUpperCase(),Array.isArray(r)?`${e}=${r.join(",")}`:`${e}=${r?String(r):""}`}_flipBoundingBox(e,r){if(!Array.isArray(e)||e.length!==4)return null;let i=r.version==="1.3.0"&&this.flipCRS.includes(r.crs||"")&&!(this.substituteCRS84&&r.crs==="EPSG:4326"),n=e;return i?[n[1],n[0],n[3],n[2]]:n}async _fetchArrayBuffer(e){let r=await this.fetch(e),i=await r.arrayBuffer();return this._checkResponse(r,i),i}_checkResponse(e,r){let i=e.headers["content-type"];if(!e.ok||bx.mimeTypes.includes(i)){let n=M_(this.loadOptions,{wms:{throwOnError:!0}}),o=bx.parseSync?.(r,n);throw new Error(o)}}_parseError(e){let r=bx.parseSync?.(e,this.loadOptions);return new Error(r)}};var MU={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("ImageServer"),createDataSource:(t,e)=>new H4(t,e)},H4=class extends Tu{url;data;constructor(e,r){super(r),this.url=e,this.data=e}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.url}?f=pjson`}exportImageURL(e){let r=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,i=`size=${e.width},${e.height}`,n={...e,bbox:r,size:i};return delete n.width,delete n.height,this.getUrl("exportImage",n)}getUrl(e,r,i){let n=`${this.url}/${e}`,o=!0;for(let[a,c]of Object.entries(r))n+=o?"?":"&",o=!1,Array.isArray(c)?n+=`${a.toUpperCase()}=${c.join(",")}`:n+=`${a.toUpperCase()}=${c?String(c):""}`;return n}async checkResponse(e){if(!e.ok)throw new Error("error")}};var Mue=[IU,MU];function W4(t,e=Mue){let{type:r="auto"}=t,i=r==="auto"?Rue(t.url,e):Pue(r,e);if(!i)throw new Error("Not a valid image source type");return i.createDataSource(t.url,t)}function Pue(t,e){for(let r of e)if(r.type===t)return r;return null}function Rue(t,e){for(let r of e)if(r.testURL&&r.testURL(t))return r;return null}var PU=6378137*Math.PI;function $4(t){let e=ns(t);return e[0]=(e[0]/256-1)*PU,e[1]=(e[1]/256-1)*PU,e}var Bue={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(t,e)=>console.error(e,t)}},Ym=class extends so{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:r,oldProps:i}){let{viewport:n}=this.context;e.dataChanged||r.serviceType!==i.serviceType?(this.state.imageSource=this._createImageSource(r),this._loadMetadata(),this.debounce(()=>this.loadImage(n,"image source changed"),0)):An(r.layers,i.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(n,"viewport changed")):this.debounce(()=>this.loadImage(n,"layers changed"),0)}finalizeState(){}renderLayers(){let{bounds:e,image:r,lastRequestParameters:i}=this.state;return r&&new Dw({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:i.srs==="EPSG:4326"?vr.LNGLAT:vr.CARTESIAN,bounds:e,image:r})}async getFeatureInfoText(e,r){let{lastRequestParameters:i}=this.state;return i?await this.state.imageSource.getFeatureInfoText?.({...i,query_layers:i.layers,x:e,y:r,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(e){if(e.data instanceof Tu)return e.data;if(typeof e.data=="string")return W4({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){let{imageSource:e}=this.state;try{this.state.loadCounter++;let r=await e.getMetadata();this.state.imageSource===e&&this.getCurrentLayer()?.props.onMetadataLoad(r)}catch(r){this.getCurrentLayer()?.props.onMetadataLoadError(r)}finally{this.state.loadCounter--}}async loadImage(e,r){let{layers:i,serviceType:n}=this.props;if(n==="wms"&&i.length===0)return;let o=e.getBounds(),{width:a,height:c}=e,h=this.getRequestId(),{srs:p}=this.props;p==="auto"&&(p=e.resolution?"EPSG:4326":"EPSG:3857");let x={width:a,height:c,boundingBox:[[o[0],o[1]],[o[2],o[3]]],layers:i,crs:p};if(p==="EPSG:3857"){let T=$4([o[0],o[1]]),R=$4([o[2],o[3]]);x.boundingBox=[T,R]}try{this.state.loadCounter++,this.props.onImageLoadStart(h);let T=await this.state.imageSource.getImage(x);this.state.lastRequestId<h&&(this.getCurrentLayer()?.props.onImageLoad(h),this.setState({image:T,bounds:o,lastRequestParameters:x,lastRequestId:h}))}catch(T){this.raiseError(T,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(h,T)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,r=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),r)}};Ym.layerName="WMSLayer";Ym.defaultProps=Bue;var Lue={getHeight:{type:"accessor",value:0},greatCircle:!0},Tx=class extends Ow{};Tx.layerName="GreatCircleLayer";Tx.defaultProps=Lue;var RU=Tx;var Oue={...Pd.defaultProps},Ex=class extends so{indexToBounds(){return null}renderLayers(){let{elevationScale:e,extruded:r,wireframe:i,filled:n,stroked:o,lineWidthUnits:a,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:p,lineJointRounded:x,lineMiterLimit:T,lineDashJustified:R,getElevation:k,getFillColor:j,getLineColor:q,getLineWidth:Z}=this.props,{updateTriggers:re,material:ee,transitions:se}=this.props,me=this.getSubLayerClass("cell",Pd),{updateTriggers:Le,...je}=this.indexToBounds()||{};return new me({filled:n,wireframe:i,extruded:r,elevationScale:e,stroked:o,lineWidthUnits:a,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:p,lineJointRounded:x,lineMiterLimit:T,lineDashJustified:R,material:ee,transitions:se,getElevation:k,getFillColor:j,getLineColor:q,getLineWidth:Z},this.getSubLayerProps({id:"cell",updateTriggers:re&&{...Le,getElevation:re.getElevation,getFillColor:re.getFillColor,getLineColor:re.getLineColor,getLineWidth:re.getLineWidth}}),je)}};Ex.layerName="GeoCellLayer";Ex.defaultProps=Oue;var qu=Ex;var C3=yc(q4(),1),Due=3,Fue=30,kue=2*Fue+1,LU=180/Math.PI;function DU(t,e,r){let i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function OU(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function FU(t){return[OU(t[0]),OU(t[1])]}function kU(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function NU([t,e,r]){let i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*LU,i*LU]}function zU(t){let e=C3.default.fromString(t,!0,10).toString(2);for(;e.length<Due+kue;)e="0"+e;let r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),o=n.length/2,a=C3.default.fromString(i,!0,2).toString(10),c=C3.default.fromString(n,!0,2).toString(4);for(;c.length<o;)c="0"+c;return`${a}/${c}`}function Nue(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function UU(t){let e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length,o=[0,0],a;for(let c=n-1;c>=0;c--){a=n-c;let h=i[c],p=0,x=0;h==="1"?x=1:h==="2"?(p=1,x=1):h==="3"&&(p=1);let T=Math.pow(2,a-1);Nue(T,o,p,x),o[0]+=T*p,o[1]+=T*x}if(r%2===1){let c=o[0];o[0]=o[1],o[1]=c}return{face:r,ij:o,level:a}}var VU=yc(q4(),1);function zue(t){let e=t.padEnd(16,"0");return VU.default.fromString(e,16)}var Uue=100;function Vue({face:t,ij:e,level:r}){let i=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(Uue*Math.pow(2,-r))),o=new Float64Array(4*n*2+2),a=0,c=0;for(let h=0;h<4;h++){let p=i[h].slice(0),x=i[h+1],T=(x[0]-p[0])/n,R=(x[1]-p[1])/n;for(let k=0;k<n;k++){p[0]+=T,p[1]+=R;let j=DU(e,r,p),q=FU(j),Z=kU(t,q),re=NU(Z);Math.abs(re[1])>89.999&&(re[0]=c);let ee=re[0]-c;re[0]+=ee>180?-360:ee<-180?360:0,o[a++]=re[0],o[a++]=re[1],c=re[0]}}return o[a++]=o[0],o[a++]=o[1],o}function jue(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=zue(t)}return zU(t.toString())}function jU(t){let e=jue(t),r=UU(e);return Vue(r)}var Gue={getS2Token:{type:"accessor",value:t=>t.token}},Sx=class extends qu{indexToBounds(){let{data:e,getS2Token:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>jU(r(i,n))}}};Sx.layerName="S2Layer";Sx.defaultProps=Gue;var GU=Sx;var Z4=512;function Hue(t,e){let r=0,i=0,n=1<<t.length,o=n/Z4;for(let a=0;a<t.length;a++){n>>=1;let c=parseInt(t[a]);c%2&&(r|=n),c>1&&(i|=n)}return[[r/o,Z4-i/o],[(r+e)/o,Z4-(i+e)/o]]}function HU(t,e=1){let[r,i]=Hue(t,e),[n,o]=$s(r),[a,c]=$s(i);return[a,o,a,c,n,c,n,o,a,o]}var Wue={getQuadkey:{type:"accessor",value:t=>t.quadkey}},Ix=class extends qu{indexToBounds(){let{data:e,extruded:r,getQuadkey:i}=this.props,n=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(o,a)=>HU(i(o,a),n),updateTriggers:{getPolygon:n}}}};Ix.layerName="QuadkeyLayer";Ix.defaultProps=Wue;var WU=Ix;var vA=class{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:r,onLoad:i,onError:n}){let{index:o,id:a,bbox:c,userData:h,zoom:p}=this,x=this._loaderId;this._abortController=new AbortController;let{signal:T}=this._abortController,R=await r.scheduleRequest(this,q=>q.isSelected?1:-1);if(!R){this._isCancelled=!0;return}if(this._isCancelled){R.done();return}let k=null,j;try{k=await e({index:o,id:a,bbox:c,userData:h,zoom:p,signal:T})}catch(q){j=q||!0}finally{R.done()}if(x===this._loaderId){if(this._loader=void 0,this.content=k,this._isCancelled&&!k){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,j?n(j,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}};var Oo={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var $U=new ot,$ue=new ot,Km=class t{constructor(e=[0,0,0],r=[0,0,0],i){i=i||$U.copy(e).add(r).scale(.5),this.center=new ot(i),this.halfDiagonal=new ot(r).subtract(this.center),this.minimum=new ot(e),this.maximum=new ot(r)}clone(){return new t(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:r}=this,i=$ue.from(e.normal),n=r.x*Math.abs(i.x)+r.y*Math.abs(i.y)+r.z*Math.abs(i.z),o=this.center.dot(i)+e.distance;return o-n>0?Oo.INSIDE:o+n<0?Oo.OUTSIDE:Oo.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let r=$U.from(e).subtract(this.center),{halfDiagonal:i}=this,n=0,o;return o=Math.abs(r.x)-i.x,o>0&&(n+=o*o),o=Math.abs(r.y)-i.y,o>0&&(n+=o*o),o=Math.abs(r.z)-i.z,o>0&&(n+=o*o),n}};var Mx=new ot,qU=new ot,Zu=class t{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new ot,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=Mx.from(r),this.center=new ot().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new t(this.center,this.radius)}union(e){let r=this.center,i=this.radius,n=e.center,o=e.radius,a=Mx.copy(n).subtract(r),c=a.magnitude();if(i>=c+o)return this.clone();if(o>=c+i)return e.clone();let h=(i+c+o)*.5;return qU.copy(a).scale((-i+h)/c).add(r),this.center.copy(qU),this.radius=h,this}expand(e){let i=Mx.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);let r=Po.getScaling(Mx,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){let r=this.distanceTo(e);return r*r}distanceTo(e){let i=Mx.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){let r=this.center,i=this.radius,o=e.normal.dot(r)+e.distance;return o<-i?Oo.OUTSIDE:o<i?Oo.INTERSECTING:Oo.INSIDE}};var que=new ot,Zue=new ot,S3=new ot,I3=new ot,M3=new ot,Xue=new ot,Yue=new ot,Yh={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},Kh=class t{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new ot().from(e),this.halfAxes=new an(r)}get halfSize(){let e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new ot(e).len(),new ot(r).len(),new ot(i).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new ot(e).normalize(),o=new ot(r).normalize(),a=new ot(i).normalize();return new Rl().fromMatrix3(new an([...n,...o,...a]))}fromCenterHalfSizeQuaternion(e,r,i){let n=new Rl(i),o=new an().fromQuaternion(n);return o[0]=o[0]*r[0],o[1]=o[1]*r[0],o[2]=o[2]*r[0],o[3]=o[3]*r[1],o[4]=o[4]*r[1],o[5]=o[5]*r[1],o[6]=o[6]*r[2],o[7]=o[7]*r[2],o[8]=o[8]*r[2],this.center=new ot().from(e),this.halfAxes=o,this}clone(){return new t(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Zu){let r=this.halfAxes,i=r.getColumn(0,S3),n=r.getColumn(1,I3),o=r.getColumn(2,M3),a=que.copy(i).add(n).add(o);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){let r=this.center,i=e.normal,n=this.halfAxes,o=i.x,a=i.y,c=i.z,h=Math.abs(o*n[Yh.COLUMN0ROW0]+a*n[Yh.COLUMN0ROW1]+c*n[Yh.COLUMN0ROW2])+Math.abs(o*n[Yh.COLUMN1ROW0]+a*n[Yh.COLUMN1ROW1]+c*n[Yh.COLUMN1ROW2])+Math.abs(o*n[Yh.COLUMN2ROW0]+a*n[Yh.COLUMN2ROW1]+c*n[Yh.COLUMN2ROW2]),p=i.dot(r)+e.distance;return p<=-h?Oo.OUTSIDE:p>=h?Oo.INSIDE:Oo.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let r=Zue.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,S3),o=i.getColumn(1,I3),a=i.getColumn(2,M3),c=n.magnitude(),h=o.magnitude(),p=a.magnitude();n.normalize(),o.normalize(),a.normalize();let x=0,T;return T=Math.abs(r.dot(n))-c,T>0&&(x+=T*T),T=Math.abs(r.dot(o))-h,T>0&&(x+=T*T),T=Math.abs(r.dot(a))-p,T>0&&(x+=T*T),x}computePlaneDistances(e,r,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=this.center,c=this.halfAxes,h=c.getColumn(0,S3),p=c.getColumn(1,I3),x=c.getColumn(2,M3),T=Xue.copy(h).add(p).add(x).add(a),R=Yue.copy(T).subtract(e),k=r.dot(R);return n=Math.min(k,n),o=Math.max(k,o),T.copy(a).add(h).add(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),o=Math.max(k,o),T.copy(a).add(h).subtract(p).add(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),o=Math.max(k,o),T.copy(a).add(h).subtract(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),o=Math.max(k,o),a.copy(T).subtract(h).add(p).add(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),o=Math.max(k,o),a.copy(T).subtract(h).add(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),o=Math.max(k,o),a.copy(T).subtract(h).subtract(p).add(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),o=Math.max(k,o),a.copy(T).subtract(h).subtract(p).subtract(x),R.copy(T).subtract(e),k=r.dot(R),n=Math.min(k,n),o=Math.max(k,o),i[0]=n,i[1]=o,i}transform(e){this.center.transformAsPoint(e);let r=this.halfAxes.getColumn(0,S3);r.transformAsPoint(e);let i=this.halfAxes.getColumn(1,I3);i.transformAsPoint(e);let n=this.halfAxes.getColumn(2,M3);return n.transformAsPoint(e),this.halfAxes=new an([...r,...i,...n]),this}getTransform(){throw new Error("not implemented")}};var ZU=new ot,XU=new ot,qs=class t{constructor(e=[0,0,1],r=0){this.normal=new ot,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return bs(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=ZU.from(e),this.normal.from(r).normalize();let i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,r,i,n){return this.normal.set(e,r,i),bs(Wo(this.normal.len(),1)),this.distance=n,this}clone(){return new t(this.normal,this.distance)}equals(e){return Wo(this.distance,e.distance)&&Wo(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let r=XU.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,r)}projectPointOntoPlane(e,r=[0,0,0]){let i=ZU.from(e),n=this.getPointDistance(i),o=XU.copy(this.normal).scale(n);return i.subtract(o).to(r)}};var YU=[new ot([1,0,0]),new ot([0,1,0]),new ot([0,0,1])],KU=new ot,Kue=new ot,fa=class t{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*YU.length;let r=e.center,i=e.radius,n=0;for(let o of YU){let a=this.planes[n],c=this.planes[n+1];a||(a=this.planes[n]=new qs),c||(c=this.planes[n+1]=new qs);let h=KU.copy(o).scale(-i).add(r);a.fromPointNormal(h,o);let p=KU.copy(o).scale(i).add(r),x=Kue.copy(o).negate();c.fromPointNormal(p,x),n+=2}return this}computeVisibility(e){let r=Oo.INSIDE;for(let i of this.planes)switch(e.intersectPlane(i)){case Oo.OUTSIDE:return Oo.OUTSIDE;case Oo.INTERSECTING:r=Oo.INTERSECTING;break;default:}return r}computeVisibilityWithPlaneMask(e,r){if(bs(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;let i=t.MASK_INSIDE,n=this.planes;for(let o=0;o<this.planes.length;++o){let a=o<31?1<<o:0;if(o<31&&!(r&a))continue;let c=n[o],h=e.intersectPlane(c);if(h===Oo.OUTSIDE)return t.MASK_OUTSIDE;h===Oo.INTERSECTING&&(i|=a)}return i}};fa.MASK_OUTSIDE=4294967295;fa.MASK_INSIDE=0;fa.MASK_INDETERMINATE=2147483647;var uGe=new ot,hGe=new ot,fGe=new ot,dGe=new ot,pGe=new ot;var xGe=new ot,bGe=new ot,vGe=new ot,wGe=new ot,TGe=new ot,EGe=new ot,CGe=new ot,SGe=new ot,IGe=new ot,MGe=new ot,PGe=new ot,RGe=new ot;var Xu=new an,Jue=new an,ehe=new an,P3=new an,QU=new an;function K4(t,e={}){let r=Cc.EPSILON20,i=10,n=0,o=0,a=Jue,c=ehe;a.identity(),c.copy(t);let h=r*the(c);for(;o<i&&rhe(c)>h;)ihe(c,P3),QU.copy(P3).transpose(),c.multiplyRight(P3),c.multiplyLeft(QU),a.multiplyRight(P3),++n>2&&(++o,n=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function the(t){let e=0;for(let r=0;r<9;++r){let i=t[r];e+=i*i}return Math.sqrt(e)}var X4=[1,0,0],Y4=[2,2,1];function rhe(t){let e=0;for(let r=0;r<3;++r){let i=t[Xu.getElementIndex(Y4[r],X4[r])];e+=2*i*i}return Math.sqrt(e)}function ihe(t,e){let r=Cc.EPSILON15,i=0,n=1;for(let p=0;p<3;++p){let x=Math.abs(t[Xu.getElementIndex(Y4[p],X4[p])]);x>i&&(n=p,i=x)}let o=X4[n],a=Y4[n],c=1,h=0;if(Math.abs(t[Xu.getElementIndex(a,o)])>r){let p=t[Xu.getElementIndex(a,a)],x=t[Xu.getElementIndex(o,o)],T=t[Xu.getElementIndex(a,o)],R=(p-x)/2/T,k;R<0?k=-1/(-R+Math.sqrt(1+R*R)):k=1/(R+Math.sqrt(1+R*R)),c=1/Math.sqrt(1+k*k),h=k*c}return an.IDENTITY.to(e),e[Xu.getElementIndex(o,o)]=e[Xu.getElementIndex(a,a)]=c,e[Xu.getElementIndex(a,o)]=h,e[Xu.getElementIndex(o,a)]=-h,e}var Od=new ot,nhe=new ot,ohe=new ot,she=new ot,ahe=new ot,lhe=new an,che={diagonal:new an,unitary:new an};function Px(t,e=new Kh){if(!t||t.length===0)return e.halfAxes=new an([0,0,0,0,0,0,0,0,0]),e.center=new ot,e;let r=t.length,i=new ot(0,0,0);for(let te of t)i.add(te);let n=1/r;i.multiplyByScalar(n);let o=0,a=0,c=0,h=0,p=0,x=0;for(let te of t){let X=Od.copy(te).subtract(i);o+=X.x*X.x,a+=X.x*X.y,c+=X.x*X.z,h+=X.y*X.y,p+=X.y*X.z,x+=X.z*X.z}o*=n,a*=n,c*=n,h*=n,p*=n,x*=n;let T=lhe;T[0]=o,T[1]=a,T[2]=c,T[3]=a,T[4]=h,T[5]=p,T[6]=c,T[7]=p,T[8]=x;let{unitary:R}=K4(T,che),k=e.halfAxes.copy(R),j=k.getColumn(0,ohe),q=k.getColumn(1,she),Z=k.getColumn(2,ahe),re=-Number.MAX_VALUE,ee=-Number.MAX_VALUE,se=-Number.MAX_VALUE,me=Number.MAX_VALUE,Le=Number.MAX_VALUE,je=Number.MAX_VALUE;for(let te of t)Od.copy(te),re=Math.max(Od.dot(j),re),ee=Math.max(Od.dot(q),ee),se=Math.max(Od.dot(Z),se),me=Math.min(Od.dot(j),me),Le=Math.min(Od.dot(q),Le),je=Math.min(Od.dot(Z),je);j=j.multiplyByScalar(.5*(me+re)),q=q.multiplyByScalar(.5*(Le+ee)),Z=Z.multiplyByScalar(.5*(je+se)),e.center.copy(j).add(q).add(Z);let Je=nhe.set(re-me,ee-Le,se-je).multiplyByScalar(.5),J=new an([Je[0],0,0,0,Je[1],0,0,0,Je[2]]);return e.halfAxes.multiplyRight(J),e}var Qm=512,JU=3,eV=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],tV=eV.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),uhe=tV.concat([[.25,.5],[.75,.5]]),Q4=class t{constructor(e,r,i){this.x=e,this.y=r,this.z=i}get children(){if(!this._children){let e=this.x*2,r=this.y*2,i=this.z+1;this._children=[new t(e,r,i),new t(e,r+1,i),new t(e+1,r,i),new t(e+1,r+1,i)]}return this._children}update(e){let{viewport:r,cullingVolume:i,elevationBounds:n,minZ:o,maxZ:a,bounds:c,offset:h,project:p}=e,x=this.getBoundingVolume(n,h,p);if(c&&!this.insideBounds(c)||i.computeVisibility(x)<0)return!1;if(!this.childVisible){let{z:R}=this;if(R<a&&R>=o){let k=x.distanceTo(r.cameraPosition)*r.scale/r.height;R+=Math.floor(Math.log2(k))}if(R>=a)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let R of this.children)R.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let r of this._children)r.getSelected(e);return e}insideBounds([e,r,i,n]){let o=Math.pow(2,this.z),a=Qm/o;return this.x*a<i&&this.y*a<n&&(this.x+1)*a>e&&(this.y+1)*a>r}getBoundingVolume(e,r,i){if(i){let h=this.z<1?uhe:this.z<2?tV:eV,p=[];for(let x of h){let T=R3(this.x+x[0],this.y+x[1],this.z);T[2]=e[0],p.push(i(T)),e[0]!==e[1]&&(T[2]=e[1],p.push(i(T)))}return Px(p)}let n=Math.pow(2,this.z),o=Qm/n,a=this.x*o+r*Qm,c=Qm-(this.y+1)*o;return new Km([a,c,e[0]],[a+o,c+o,e[1]])}};function rV(t,e,r,i){let n=t instanceof Td&&t.resolution?t.projectPosition:null,o=Object.values(t.getFrustumPlanes()).map(({normal:k,distance:j})=>new qs(k.clone().negate(),j)),a=new fa(o),c=t.distanceScales.unitsPerMeter[2],h=r&&r[0]*c||0,p=r&&r[1]*c||0,x=t instanceof Ou&&t.pitch<=60?e:0;if(i){let[k,j,q,Z]=i,re=ns([k,Z]),ee=ns([q,j]);i=[re[0],Qm-re[1],ee[0],Qm-ee[1]]}let T=new Q4(0,0,0),R={viewport:t,project:n,cullingVolume:a,elevationBounds:[h,p],minZ:x,maxZ:e,bounds:i,offset:0};if(T.update(R),t instanceof Ou&&t.subViewports&&t.subViewports.length>1){for(R.offset=-1;T.update(R)&&!(--R.offset<-JU););for(R.offset=1;T.update(R)&&!(++R.offset>JU););}return T.getSelected()}var Qh=512,hhe=[-1/0,-1/0,1/0,1/0],Dd={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(r=>typeof r=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;let r=t.length;if(r!==e.length)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}};function nV(t,e){let r=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...r.map(n=>n[0])),Math.min(...r.map(n=>n[1])),Math.max(...r.map(n=>n[0])),Math.max(...r.map(n=>n[1]))]}function fhe(t){return Math.abs(t.split("").reduce((e,r)=>(e<<5)-e+r.charCodeAt(0)|0,0))}function Yu(t,e){if(!t||!t.length)return null;let{index:r,id:i}=e;if(Array.isArray(t)){let o=fhe(i)%t.length;t=t[o]}let n=t;for(let o of Object.keys(r)){let a=new RegExp(`{${o}}`,"g");n=n.replace(a,String(r[o]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),n}function dhe(t,e,r){let i;if(e&&e.length===2){let[n,o]=e,a=t.getBounds({z:n}),c=t.getBounds({z:o});i=[Math.min(a[0],c[0]),Math.min(a[1],c[1]),Math.max(a[2],c[2]),Math.max(a[3],c[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],r[0]),Math.max(i[1],r[1]),Math.min(i[2],r[2]),Math.min(i[3],r[3])]:[Math.max(Math.min(i[0],r[2]),r[0]),Math.max(Math.min(i[1],r[3]),r[1]),Math.min(Math.max(i[2],r[0]),r[2]),Math.min(Math.max(i[3],r[1]),r[3])]}function oV({viewport:t,z:e,cullRect:r}){return(t.subViewports||[t]).map(n=>J4(n,e||0,r))}function J4(t,e,r){if(!Array.isArray(e)){let o=r.x-t.x,a=r.y-t.y,{width:c,height:h}=r,p={targetZ:e},x=t.unproject([o,a],p),T=t.unproject([o+c,a],p),R=t.unproject([o,a+h],p),k=t.unproject([o+c,a+h],p);return[Math.min(x[0],T[0],R[0],k[0]),Math.min(x[1],T[1],R[1],k[1]),Math.max(x[0],T[0],R[0],k[0]),Math.max(x[1],T[1],R[1],k[1])]}let i=J4(t,e[0],r),n=J4(t,e[1],r);return[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]}function phe(t,e,r){return r?nV(t,r).map(n=>n*e/Qh):t.map(i=>i*e/Qh)}function eP(t,e){return Math.pow(2,t)*Qh/e}function R3(t,e,r){let i=eP(r,Qh),n=t/i*360-180,o=Math.PI-2*Math.PI*e/i,a=180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)));return[n,a]}function iV(t,e,r,i){let n=eP(r,i);return[t/n*Qh,e/n*Qh]}function tP(t,e,r,i,n=Qh){if(t.isGeospatial){let[p,x]=R3(e,r,i),[T,R]=R3(e+1,r+1,i);return{west:p,north:x,east:T,south:R}}let[o,a]=iV(e,r,i,n),[c,h]=iV(e+1,r+1,i,n);return{left:o,top:a,right:c,bottom:h}}function Ahe(t,e,r,i,n){let o=dhe(t,null,i),a=eP(e,r),[c,h,p,x]=phe(o,a,n),T=[];for(let R=Math.floor(c);R<p;R++)for(let k=Math.floor(h);k<x;k++)T.push({x:R,y:k,z:e});return T}function rP({viewport:t,maxZoom:e,minZoom:r,zRange:i,extent:n,tileSize:o=Qh,modelMatrix:a,modelMatrixInverse:c,zoomOffset:h=0}){let p=t.isGeospatial?Math.round(t.zoom+Math.log2(Qh/o))+h:Math.ceil(t.zoom)+h;if(typeof r=="number"&&Number.isFinite(r)&&p<r){if(!n)return[];p=r}typeof e=="number"&&Number.isFinite(e)&&p>e&&(p=e);let x=n;return a&&c&&n&&!t.isGeospatial&&(x=nV(n,a)),t.isGeospatial?rV(t,p,i,n):Ahe(t,p,o,x||hhe,c)}function iP(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function nP(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function sV(t){let e={},r;return i=>{for(let n in i)if(!mhe(i[n],e[n])){r=t(i),e=i;break}return r}}function mhe(t,e){if(t===e)return!0;if(Array.isArray(t)){let r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}var aV=1,B3=2,ghe="never",_he="no-overlap",Rx="best-available",yhe=5,xhe={[Rx]:vhe,[_he]:whe,[ghe]:()=>{}},bhe={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}},wA=class{constructor(e){this._getCullBounds=sV(oV),this.opts={...bhe,...e},this.setOptions(this.opts),this.onTileLoad=r=>{this.opts.onTileLoad?.(r),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new od({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new wr,this._modelMatrixInverse=new wr}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let r=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(e):r.setNeedsReload()}}update(e,{zRange:r,modelMatrix:i}={zRange:null,modelMatrix:null}){let n=i?new wr(i):new wr,o=!n.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Wo(this._zRange,r)||o){o&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=e,this._zRange=r;let c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(h=>this._getTile(h,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));let a=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),a&&this._frameNumber++,this._frameNumber}isTileVisible(e,r){if(!e.isVisible)return!1;if(r&&this._viewport){let i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:n}=e;for(let[o,a,c,h]of i){let p;if("west"in n)p=n.west<c&&n.east>o&&n.south<h&&n.north>a;else{let x=Math.min(n.top,n.bottom),T=Math.max(n.top,n.bottom);p=n.left<c&&n.right>o&&x<h&&T>a}if(p)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:r,minZoom:i,zRange:n,modelMatrix:o,modelMatrixInverse:a}){let{tileSize:c,extent:h,zoomOffset:p}=this.opts;return rP({viewport:e,maxZoom:r,minZoom:i,zRange:n,tileSize:c,extent:h,modelMatrix:o,modelMatrixInverse:a,zoomOffset:p})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:r}=this.opts;return{bbox:tP(this._viewport,e.x,e.y,e.z,r)}}getParentIndex(e){let r=Math.floor(e.x/2),i=Math.floor(e.y/2),n=e.z-1;return{x:r,y:i,z:n}}updateTileStates(){let e=this.opts.refinementStrategy||Rx,r=new Array(this._cache.size),i=0;for(let n of this._cache.values())r[i++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(let n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof e=="function"?e:xhe[e])(Array.from(this._cache.values())),i=0;for(let n of this._cache.values())if(r[i++]!==n.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e=0}=this.opts,r=[],i=0;for(let n of this._cache.values())n.isLoading&&(i++,!n.isSelected&&!n.isVisible&&r.push(n));for(;e>0&&i>e&&r.length>0;)r.shift().abort(),i--}_rebuildTree(){let{_cache:e}=this;for(let r of e.values())r.parent=null,r.children&&(r.children.length=0);for(let r of e.values()){let i=this._getNearestAncestor(r);r.parent=i,i?.children&&i.children.push(r)}}_resizeCache(){let{_cache:e,opts:r}=this,i=r.maxCacheSize??(r.maxCacheByteSize!==null?1/0:yhe*this.selectedTiles.length),n=r.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>n){for(let[a,c]of e)if(!c.isVisible&&!c.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!==null?c.byteLength:0,e.delete(a),this.opts.onTileUnload?.(c)),e.size<=i&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((a,c)=>a.zoom-c.zoom),this._dirty=!1)}_getTile(e,r){let i=this.getTileId(e),n=this._cache.get(i),o=!1;return!n&&r?(n=new vA(e),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:i,zoom:this.getTileZoom(n.index)}),o=!0,this._cache.set(i,n),this._dirty=!0):n&&n.needsReload&&(o=!0),n&&o&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(e){let{_minZoom:r=0}=this,i=e.index;for(;this.getTileZoom(i)>r;){i=this.getParentIndex(i);let n=this._getTile(i);if(n)return n}return null}};function vhe(t){for(let e of t)e.state=0;for(let e of t)e.isSelected&&!lV(e)&&oP(e);for(let e of t)e.isVisible=!!(e.state&B3)}function whe(t){for(let r of t)r.state=0;for(let r of t)r.isSelected&&lV(r);let e=Array.from(t).sort((r,i)=>r.zoom-i.zoom);for(let r of e)if(r.isVisible=!!(r.state&B3),r.children&&(r.isVisible||r.state&aV))for(let i of r.children)i.state=aV;else r.isSelected&&oP(r)}function lV(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=B3,!0;e=e.parent}return!1}function oP(t){for(let e of t.children)e.isLoaded||e.content?e.state|=B3:oP(e)}var The={TilesetClass:wA,data:{type:"data",value:[]},dataComparator:Dd.equal,renderSubLayers:{type:"function",value:t=>new _A(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Rx,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Bx=class extends so{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:r}=this.state,i=e.propsOrDataChanged||e.updateTriggersChanged,n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);r?i&&(r.setOptions(this._getTilesetOptions()),n?r.reloadAll():r.tiles.forEach(o=>{o.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:r,maxCacheByteSize:i,refinementStrategy:n,extent:o,maxZoom:a,minZoom:c,maxRequests:h,debounceTime:p,zoomOffset:x}=this.props;return{maxCacheSize:r,maxCacheByteSize:i,maxZoom:a,minZoom:c,tileSize:e,refinementStrategy:n,extent:o,maxRequests:h,debounceTime:p,zoomOffset:x,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let e=this.state.tileset,{zRange:r,modelMatrix:i}=this.props,n=e.update(this.context.viewport,{zRange:r,modelMatrix:i}),{isLoaded:o}=e,a=this.state.isLoaded!==o,c=this.state.frameNumber!==n;o&&(a||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:n}),this.state.isLoaded=o}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:r}=this.props;r&&r(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,r){this.props.onTileError(e),r.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:r,getTileData:i,fetch:n}=this.props,{signal:o}=e;return e.url=typeof r=="string"||Array.isArray(r)?Yu(r,e):null,i?i(e):n&&e.url?n(e.url,{propName:"data",layer:this,signal:o}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let r=e.sourceLayer,i=r.props.tile,n=e.info;return n.picked&&(n.tile=i),n.sourceTile=i,n.sourceTileSubLayer=r,n}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{let r=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)r&&e.layers[0]&&Object.keys(r).some(i=>e.layers[0].props[i]!==r[i])&&(e.layers=e.layers.map(i=>i.clone(r)));else{let i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=Ra(i,Boolean).map(n=>n.clone({tile:e,...r}))}return e.layers})}filterSubLayer({layer:e,cullRect:r}){let{tile:i}=e.props;return this.state.tileset.isTileVisible(i,r)}};Bx.defaultProps=The;Bx.layerName="TileLayer";var TA=Bx;var cV=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,uV={name:"trips",vs:cV,fs:cV,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}};var Ehe={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}},Lx=class extends Wu{getShaders(){let e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,uV],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){let{fadeTrail:r,trailLength:i,currentTime:n}=this.props,o={fadeTrail:r,trailLength:i,currentTime:n};this.state.model.shaderInputs.setProps({trips:o}),super.draw(e)}};Lx.layerName="TripsLayer";Lx.defaultProps=Ehe;var hV=Lx;var Ji=function(t){t=t||{};var e=typeof t<"u"?t:{},r={},i;for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);var n=[],o="";function a(gt){return e.locateFile?e.locateFile(gt,o):o+gt}var c;typeof document<"u"&&document.currentScript&&(o=document.currentScript.src),o.indexOf("blob:")!==0?o=o.substr(0,o.lastIndexOf("/")+1):o="",c=function(Wt,sr,Lr){var y=new XMLHttpRequest;y.open("GET",Wt,!0),y.responseType="arraybuffer",y.onload=function(){if(y.status==200||y.status==0&&y.response){sr(y.response);return}var Ii=zt(Wt);if(Ii){sr(Ii.buffer);return}Lr()},y.onerror=Lr,y.send(null)};var h=e.print||console.log.bind(console),p=e.printErr||console.warn.bind(console);for(i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);r=null,e.arguments&&(n=e.arguments);var x=0,T=function(gt){x=gt},R=function(){return x},k=8;function j(gt,Wt,sr,Lr){switch(sr=sr||"i8",sr.charAt(sr.length-1)==="*"&&(sr="i32"),sr){case"i1":ve[gt>>0]=Wt;break;case"i8":ve[gt>>0]=Wt;break;case"i16":Xe[gt>>1]=Wt;break;case"i32":tt[gt>>2]=Wt;break;case"i64":Xi=[Wt>>>0,(Mr=Wt,+Zo(Mr)>=1?Mr>0?(Aa(+Xo(Mr/4294967296),4294967295)|0)>>>0:~~+co((Mr-+(~~Mr>>>0))/4294967296)>>>0:0)],tt[gt>>2]=Xi[0],tt[gt+4>>2]=Xi[1];break;case"float":Xt[gt>>2]=Wt;break;case"double":jt[gt>>3]=Wt;break;default:za("invalid type for setValue: "+sr)}}function q(gt,Wt,sr){switch(Wt=Wt||"i8",Wt.charAt(Wt.length-1)==="*"&&(Wt="i32"),Wt){case"i1":return ve[gt>>0];case"i8":return ve[gt>>0];case"i16":return Xe[gt>>1];case"i32":return tt[gt>>2];case"i64":return tt[gt>>2];case"float":return Xt[gt>>2];case"double":return jt[gt>>3];default:za("invalid type for getValue: "+Wt)}return null}var Z=!1;function re(gt,Wt){gt||za("Assertion failed: "+Wt)}function ee(gt){var Wt=e["_"+gt];return re(Wt,"Cannot call unknown function "+gt+", make sure it is exported"),Wt}function se(gt,Wt,sr,Lr,y){var Yi={string:function(Wn){var Ei=0;if(Wn!=null&&Wn!==0){var Mi=(Wn.length<<2)+1;Ei=t0(Mi),te(Wn,Ei,Mi)}return Ei},array:function(Wn){var Ei=t0(Wn.length);return ye(Wn,Ei),Ei}};function Ii(Wn){return Wt==="string"?Je(Wn):Wt==="boolean"?!!Wn:Wn}var Ee=ee(gt),Rn=[],fs=0;if(Lr)for(var to=0;to<Lr.length;to++){var Gi=Yi[sr[to]];Gi?(fs===0&&(fs=mf()),Rn[to]=Gi(Lr[to])):Rn[to]=Lr[to]}var gn=Ee.apply(null,Rn);return gn=Ii(gn),fs!==0&&Af(fs),gn}function me(gt,Wt,sr,Lr){sr=sr||[];var y=sr.every(function(Ii){return Ii==="number"}),Yi=Wt!=="string";return Yi&&y&&!Lr?ee(gt):function(){return se(gt,Wt,sr,arguments,Lr)}}var Le=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function je(gt,Wt,sr){for(var Lr=Wt+sr,y=Wt;gt[y]&&!(y>=Lr);)++y;if(y-Wt>16&&gt.subarray&&Le)return Le.decode(gt.subarray(Wt,y));for(var Yi="";Wt<y;){var Ii=gt[Wt++];if(!(Ii&128)){Yi+=String.fromCharCode(Ii);continue}var Ee=gt[Wt++]&63;if((Ii&224)==192){Yi+=String.fromCharCode((Ii&31)<<6|Ee);continue}var Rn=gt[Wt++]&63;if((Ii&240)==224?Ii=(Ii&15)<<12|Ee<<6|Rn:Ii=(Ii&7)<<18|Ee<<12|Rn<<6|gt[Wt++]&63,Ii<65536)Yi+=String.fromCharCode(Ii);else{var fs=Ii-65536;Yi+=String.fromCharCode(55296|fs>>10,56320|fs&1023)}}return Yi}function Je(gt,Wt){return gt?je(De,gt,Wt):""}function J(gt,Wt,sr,Lr){if(!(Lr>0))return 0;for(var y=sr,Yi=sr+Lr-1,Ii=0;Ii<gt.length;++Ii){var Ee=gt.charCodeAt(Ii);if(Ee>=55296&&Ee<=57343){var Rn=gt.charCodeAt(++Ii);Ee=65536+((Ee&1023)<<10)|Rn&1023}if(Ee<=127){if(sr>=Yi)break;Wt[sr++]=Ee}else if(Ee<=2047){if(sr+1>=Yi)break;Wt[sr++]=192|Ee>>6,Wt[sr++]=128|Ee&63}else if(Ee<=65535){if(sr+2>=Yi)break;Wt[sr++]=224|Ee>>12,Wt[sr++]=128|Ee>>6&63,Wt[sr++]=128|Ee&63}else{if(sr+3>=Yi)break;Wt[sr++]=240|Ee>>18,Wt[sr++]=128|Ee>>12&63,Wt[sr++]=128|Ee>>6&63,Wt[sr++]=128|Ee&63}}return Wt[sr]=0,sr-y}function te(gt,Wt,sr){return J(gt,De,Wt,sr)}var X=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ye(gt,Wt){ve.set(gt,Wt)}function _e(gt,Wt){return gt%Wt>0&&(gt+=Wt-gt%Wt),gt}var Oe,ve,De,Xe,rt,tt,yt,Xt,jt;function fr(gt){Oe=gt,e.HEAP8=ve=new Int8Array(gt),e.HEAP16=Xe=new Int16Array(gt),e.HEAP32=tt=new Int32Array(gt),e.HEAPU8=De=new Uint8Array(gt),e.HEAPU16=rt=new Uint16Array(gt),e.HEAPU32=yt=new Uint32Array(gt),e.HEAPF32=Xt=new Float32Array(gt),e.HEAPF64=jt=new Float64Array(gt)}var qt=5267040,Ot=24128,Tr=e.TOTAL_MEMORY||33554432;e.buffer?Oe=e.buffer:Oe=new ArrayBuffer(Tr),Tr=Oe.byteLength,fr(Oe),tt[Ot>>2]=qt;function Or(gt){for(;gt.length>0;){var Wt=gt.shift();if(typeof Wt=="function"){Wt();continue}var sr=Wt.func;typeof sr=="number"?Wt.arg===void 0?e.dynCall_v(sr):e.dynCall_vi(sr,Wt.arg):sr(Wt.arg===void 0?null:Wt.arg)}}var Dr=[],Xr=[],ki=[],ei=[];function Oi(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)si(e.preRun.shift());Or(Dr)}function ui(){Or(Xr)}function tn(){Or(ki)}function Ni(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Es(e.postRun.shift());Or(ei)}function si(gt){Dr.unshift(gt)}function Es(gt){ei.unshift(gt)}var Zo=Math.abs,co=Math.ceil,Xo=Math.floor,Aa=Math.min,xo=0,as=null,bo=null;function jr(gt){xo++,e.monitorRunDependencies&&e.monitorRunDependencies(xo)}function Jt(gt){if(xo--,e.monitorRunDependencies&&e.monitorRunDependencies(xo),xo==0&&(as!==null&&(clearInterval(as),as=null),bo)){var Wt=bo;bo=null,Wt()}}e.preloadedImages={},e.preloadedAudios={};var kt=null,Er="data:application/octet-stream;base64,";function ai(gt){return String.prototype.startsWith?gt.startsWith(Er):gt.indexOf(Er)===0}var Mr,Xi;kt="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var uo=24144;function zn(gt){return gt}function st(gt){var Wt=/\b__Z[\w\d_]+/g;return gt.replace(Wt,function(sr){var Lr=sr;return sr===Lr?sr:Lr+" ["+sr+"]"})}function de(){var gt=new Error;if(!gt.stack){try{throw new Error(0)}catch(Wt){gt=Wt}if(!gt.stack)return"(no stack trace available)"}return gt.stack.toString()}function ge(){var gt=de();return e.extraStackTrace&&(gt+=`
`+e.extraStackTrace()),st(gt)}function ce(gt,Wt,sr,Lr){za("Assertion failed: "+Je(gt)+", at: "+[Wt?Je(Wt):"unknown filename",sr,Lr?Je(Lr):"unknown function"])}function ze(){return ve.length}function Ye(gt,Wt,sr){De.set(De.subarray(Wt,Wt+sr),gt)}function Ke(gt){return e.___errno_location&&(tt[e.___errno_location()>>2]=gt),gt}function dt(gt){za("OOM")}function it(gt){try{var Wt=new ArrayBuffer(gt);return Wt.byteLength!=gt?void 0:(new Int8Array(Wt).set(ve),Jn(Wt),fr(Wt),1)}catch{}}function Bt(gt){var Wt=ze(),sr=16777216,Lr=2147483648-sr;if(gt>Lr)return!1;for(var y=16777216,Yi=Math.max(Wt,y);Yi<gt;)Yi<=536870912?Yi=_e(2*Yi,sr):Yi=Math.min(_e((3*Yi+2147483648)/4,sr),Lr);var Ii=it(Yi);return!!Ii}var Mt=typeof atob=="function"?atob:function(gt){var Wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",sr="",Lr,y,Yi,Ii,Ee,Rn,fs,to=0;gt=gt.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ii=Wt.indexOf(gt.charAt(to++)),Ee=Wt.indexOf(gt.charAt(to++)),Rn=Wt.indexOf(gt.charAt(to++)),fs=Wt.indexOf(gt.charAt(to++)),Lr=Ii<<2|Ee>>4,y=(Ee&15)<<4|Rn>>2,Yi=(Rn&3)<<6|fs,sr=sr+String.fromCharCode(Lr),Rn!==64&&(sr=sr+String.fromCharCode(y)),fs!==64&&(sr=sr+String.fromCharCode(Yi));while(to<gt.length);return sr};function ut(gt){try{for(var Wt=Mt(gt),sr=new Uint8Array(Wt.length),Lr=0;Lr<Wt.length;++Lr)sr[Lr]=Wt.charCodeAt(Lr);return sr}catch{throw new Error("Converting base64 string to bytes failed.")}}function zt(gt){if(ai(gt))return ut(gt.slice(Er.length))}var rr={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},nr={a:za,b:T,c:R,d:ce,e:Ke,f:ze,g:Ye,h:Bt,i:dt,j:zn,k:st,l:it,m:de,n:ge,o:uo,p:Ot},We=function(gt,Wt,sr){"almost asm";var Lr=new gt.Int8Array(sr),y=new gt.Int32Array(sr),Yi=new gt.Uint8Array(sr),Ii=new gt.Float32Array(sr),Ee=new gt.Float64Array(sr),Rn=Wt.o|0,fs=Wt.p|0,to=gt.Math.floor,Gi=gt.Math.abs,gn=gt.Math.sqrt,Wn=gt.Math.pow,Ei=gt.Math.cos,Mi=gt.Math.sin,Yc=gt.Math.tan,r0=gt.Math.acos,Yl=gt.Math.asin,Kc=gt.Math.atan,Ps=gt.Math.atan2,xa=gt.Math.ceil,ba=gt.Math.imul,Kl=gt.Math.min,i0=gt.Math.max,Ql=gt.Math.clz32,Kr=Wt.b,Me=Wt.c,Nr=Wt.d,_f=Wt.e,n0=Wt.f,yf=Wt.g,va=Wt.h,Yd=Wt.i,be=24160;function Kd(m){return Lr=new Int8Array(m),Yi=new Uint8Array(m),y=new Int32Array(m),Ii=new Float32Array(m),Ee=new Float64Array(m),sr=m,!0}function o0(m){m=m|0;var A=0;return A=be,be=be+m|0,be=be+15&-16,A|0}function Pi(){return be|0}function Jl(m){m=m|0,be=m}function Qd(m,A){m=m|0,A=A|0,be=m}function Ug(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;return(m|0)<0?(A=2,A|0):(m|0)>13780509?(A=hc(15,A)|0,A|0):(b=((m|0)<0)<<31>>31,M=Tt(m|0,b|0,3,0)|0,E=Me()|0,b=Ge(m|0,b|0,1,0)|0,b=Tt(M|0,E|0,b|0,Me()|0)|0,b=Ge(b|0,Me()|0,1,0)|0,m=Me()|0,y[A>>2]=b,y[A+4>>2]=m,A=0,A|0)}function s0(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,a0(m,A,b,E,0)|0}function a0(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0;if(W=be,be=be+16|0,F=W,!(l0(m,A,b,E,M)|0))return E=0,be=W,E|0;do if((b|0)>=0){if((b|0)>13780509){if(B=hc(15,F)|0,B|0)break;N=F,F=y[N>>2]|0,N=y[N+4>>2]|0}else B=((b|0)<0)<<31>>31,Q=Tt(b|0,B|0,3,0)|0,N=Me()|0,B=Ge(b|0,B|0,1,0)|0,B=Tt(Q|0,N|0,B|0,Me()|0)|0,B=Ge(B|0,Me()|0,1,0)|0,N=Me()|0,y[F>>2]=B,y[F+4>>2]=N,F=B;if(Ui(E|0,0,F<<3|0)|0,M|0){Ui(M|0,0,F<<2|0)|0,B=wa(m,A,b,E,M,F,N,0)|0;break}B=qe(F,4)|0,B?(Q=wa(m,A,b,E,B,F,N,0)|0,Be(B),B=Q):B=13}else B=2;while(!1);return Q=B,be=W,Q|0}function l0(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0;if(nt=be,be=be+16|0,Qe=nt,Ue=nt+8|0,$e=Qe,y[$e>>2]=m,y[$e+4>>2]=A,(b|0)<0)return Ue=2,be=nt,Ue|0;if(B=E,y[B>>2]=m,y[B+4>>2]=A,B=(M|0)!=0,B&&(y[M>>2]=0),Hi(m,A)|0)return Ue=9,be=nt,Ue|0;y[Ue>>2]=0;e:do if((b|0)>=1)if(B)for(he=1,Q=0,we=0,$e=1,B=m;;){if(!(Q|we)){if(B=po(B,A,4,Ue,Qe)|0,B|0)break e;if(A=Qe,B=y[A>>2]|0,A=y[A+4>>2]|0,Hi(B,A)|0){B=9;break e}}if(B=po(B,A,y[22384+(we<<2)>>2]|0,Ue,Qe)|0,B|0)break e;if(A=Qe,B=y[A>>2]|0,A=y[A+4>>2]|0,m=E+(he<<3)|0,y[m>>2]=B,y[m+4>>2]=A,y[M+(he<<2)>>2]=$e,m=Q+1|0,F=(m|0)==($e|0),N=we+1|0,W=(N|0)==6,Hi(B,A)|0){B=9;break e}if($e=$e+(W&F&1)|0,($e|0)>(b|0)){B=0;break}else he=he+1|0,Q=F?0:m,we=F?W?0:N:we}else for(he=1,Q=0,we=0,$e=1,B=m;;){if(!(Q|we)){if(B=po(B,A,4,Ue,Qe)|0,B|0)break e;if(A=Qe,B=y[A>>2]|0,A=y[A+4>>2]|0,Hi(B,A)|0){B=9;break e}}if(B=po(B,A,y[22384+(we<<2)>>2]|0,Ue,Qe)|0,B|0)break e;if(A=Qe,B=y[A>>2]|0,A=y[A+4>>2]|0,m=E+(he<<3)|0,y[m>>2]=B,y[m+4>>2]=A,m=Q+1|0,F=(m|0)==($e|0),N=we+1|0,W=(N|0)==6,Hi(B,A)|0){B=9;break e}if($e=$e+(W&F&1)|0,($e|0)>(b|0)){B=0;break}else he=he+1|0,Q=F?0:m,we=F?W?0:N:we}else B=0;while(!1);return Ue=B,be=nt,Ue|0}function wa(m,A,b,E,M,B,F,N){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0,F=F|0,N=N|0;var W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0;if(nt=be,be=be+16|0,Qe=nt+8|0,Ue=nt,W=Kt(m|0,A|0,B|0,F|0)|0,he=Me()|0,we=E+(W<<3)|0,It=we,wt=y[It>>2]|0,It=y[It+4>>2]|0,Q=(wt|0)==(m|0)&(It|0)==(A|0),!((wt|0)==0&(It|0)==0|Q))do W=Ge(W|0,he|0,1,0)|0,W=er(W|0,Me()|0,B|0,F|0)|0,he=Me()|0,we=E+(W<<3)|0,wt=we,It=y[wt>>2]|0,wt=y[wt+4>>2]|0,Q=(It|0)==(m|0)&(wt|0)==(A|0);while(!((It|0)==0&(wt|0)==0|Q));if(W=M+(W<<2)|0,Q&&(y[W>>2]|0)<=(N|0)||(wt=we,y[wt>>2]=m,y[wt+4>>2]=A,y[W>>2]=N,(N|0)>=(b|0)))return wt=0,be=nt,wt|0;switch(Q=N+1|0,y[Qe>>2]=0,W=po(m,A,2,Qe,Ue)|0,W|0){case 9:{$e=9;break}case 0:{W=Ue,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,Q)|0,W||($e=9);break}default:}e:do if(($e|0)==9){switch(y[Qe>>2]=0,W=po(m,A,3,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=po(m,A,1,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=po(m,A,5,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=po(m,A,4,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=po(m,A,6,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=wa(y[W>>2]|0,y[W+4>>2]|0,b,E,M,B,F,Q)|0,W|0)break e;break}default:break e}return wt=0,be=nt,wt|0}while(!1);return wt=W,be=nt,wt|0}function po(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(b>>>0>6)return M=1,M|0;if(we=(y[E>>2]|0)%6|0,y[E>>2]=we,(we|0)>0){B=0;do b=oc(b)|0,B=B+1|0;while((B|0)<(y[E>>2]|0))}if(we=mt(m|0,A|0,45)|0,Me()|0,he=we&127,he>>>0>121)return M=5,M|0;W=zo(m,A)|0,B=mt(m|0,A|0,52)|0,Me()|0,B=B&15;e:do if(!B)Q=8;else{for(;;){if(F=(15-B|0)*3|0,N=mt(m|0,A|0,F|0)|0,Me()|0,N=N&7,(N|0)==7){A=5;break}if(Ue=(wn(B)|0)==0,B=B+-1|0,$e=Nt(7,0,F|0)|0,A=A&~(Me()|0),Qe=Nt(y[(Ue?432:16)+(N*28|0)+(b<<2)>>2]|0,0,F|0)|0,F=Me()|0,b=y[(Ue?640:224)+(N*28|0)+(b<<2)>>2]|0,m=Qe|m&~$e,A=F|A,!b){b=0;break e}if(!B){Q=8;break e}}return A|0}while(!1);(Q|0)==8&&(Ue=y[848+(he*28|0)+(b<<2)>>2]|0,Qe=Nt(Ue|0,0,45)|0,m=Qe|m,A=Me()|0|A&-1040385,b=y[4272+(he*28|0)+(b<<2)>>2]|0,(Ue&127|0)==127&&(Ue=Nt(y[848+(he*28|0)+20>>2]|0,0,45)|0,A=Me()|0|A&-1040385,b=y[4272+(he*28|0)+20>>2]|0,m=Ga(Ue|m,A)|0,A=Me()|0,y[E>>2]=(y[E>>2]|0)+1)),N=mt(m|0,A|0,45)|0,Me()|0,N=N&127;e:do if(_i(N)|0){t:do if((zo(m,A)|0)==1){if((he|0)!=(N|0))if(ph(N,y[7696+(he*28|0)>>2]|0)|0){m=Al(m,A)|0,F=1,A=Me()|0;break}else Nr(23313,22416,436,22424);switch(W|0){case 3:{m=Ga(m,A)|0,A=Me()|0,y[E>>2]=(y[E>>2]|0)+1,F=0;break t}case 5:{m=Al(m,A)|0,A=Me()|0,y[E>>2]=(y[E>>2]|0)+5,F=0;break t}case 0:return Ue=9,Ue|0;default:return Ue=1,Ue|0}}else F=0;while(!1);if((b|0)>0){B=0;do m=hp(m,A)|0,A=Me()|0,B=B+1|0;while((B|0)!=(b|0))}if((he|0)!=(N|0)){if(!(wf(N)|0)){if((F|0)!=0|(zo(m,A)|0)!=5)break;y[E>>2]=(y[E>>2]|0)+1;break}switch(we&127){case 8:case 118:break e;default:}(zo(m,A)|0)!=3&&(y[E>>2]=(y[E>>2]|0)+1)}}else if((b|0)>0){B=0;do m=Ga(m,A)|0,A=Me()|0,B=B+1|0;while((B|0)!=(b|0))}while(!1);return y[E>>2]=((y[E>>2]|0)+b|0)%6|0,Ue=M,y[Ue>>2]=m,y[Ue+4>>2]=A,Ue=0,Ue|0}function xf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0;for(N=be,be=be+16|0,B=N,F=N+8|0,M=(Hi(m,A)|0)==0,M=M?1:2;;){if(y[F>>2]=0,Q=(po(m,A,M,F,B)|0)==0,W=B,Q&((y[W>>2]|0)==(b|0)?(y[W+4>>2]|0)==(E|0):0)){m=4;break}if(M=M+1|0,M>>>0>=7){M=7,m=4;break}}return(m|0)==4?(be=N,M|0):0}function bf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(Ue=be,be=be+16|0,$e=Ue,Qe=Ue+8|0,we=$e,y[we>>2]=m,y[we+4>>2]=A,!b)return Qe=E,y[Qe>>2]=m,y[Qe+4>>2]=A,Qe=0,be=Ue,Qe|0;y[Qe>>2]=0;e:do if(Hi(m,A)|0)m=9;else{if(B=(b|0)>0,B){M=0,we=m;do{if(m=po(we,A,4,Qe,$e)|0,m|0)break e;if(A=$e,we=y[A>>2]|0,A=y[A+4>>2]|0,M=M+1|0,Hi(we,A)|0){m=9;break e}}while((M|0)<(b|0));if(he=E,y[he>>2]=we,y[he+4>>2]=A,he=b+-1|0,B){Q=0,m=1;do{if(M=22384+(Q<<2)|0,(Q|0)==5)for(F=y[M>>2]|0,B=0,M=m;;){if(m=$e,m=po(y[m>>2]|0,y[m+4>>2]|0,F,Qe,$e)|0,m|0)break e;if((B|0)!=(he|0))if(W=$e,N=y[W>>2]|0,W=y[W+4>>2]|0,m=E+(M<<3)|0,y[m>>2]=N,y[m+4>>2]=W,!(Hi(N,W)|0))m=M+1|0;else{m=9;break e}else m=M;if(B=B+1|0,(B|0)>=(b|0))break;M=m}else for(F=$e,W=y[M>>2]|0,N=0,M=m,B=y[F>>2]|0,F=y[F+4>>2]|0;;){if(m=po(B,F,W,Qe,$e)|0,m|0)break e;if(F=$e,B=y[F>>2]|0,F=y[F+4>>2]|0,m=E+(M<<3)|0,y[m>>2]=B,y[m+4>>2]=F,m=M+1|0,Hi(B,F)|0){m=9;break e}if(N=N+1|0,(N|0)>=(b|0))break;M=m}Q=Q+1|0}while(Q>>>0<6);m=$e,F=we,M=y[m>>2]|0,B=A,m=y[m+4>>2]|0}else F=we,M=we,B=A,m=A}else F=E,y[F>>2]=m,y[F+4>>2]=A,F=m,M=m,B=A,m=A;m=(F|0)==(M|0)&(B|0)==(m|0)?0:9}while(!1);return Qe=m,be=Ue,Qe|0}function vf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0;if(N=be,be=be+48|0,M=N+16|0,B=N+8|0,F=N,b|0)return F=15,be=N,F|0;if(Q=m,W=y[Q+4>>2]|0,b=B,y[b>>2]=y[Q>>2],y[b+4>>2]=W,fu(B,M),A=Ef(M,A,F)|0,!A){if(b=y[B>>2]|0,B=y[m+8>>2]|0,(B|0)>0){M=y[m+12>>2]|0,A=0;do b=(y[M+(A<<3)>>2]|0)+b|0,A=A+1|0;while((A|0)<(B|0))}A=F,M=y[A>>2]|0,A=y[A+4>>2]|0,B=((b|0)<0)<<31>>31,(A|0)<(B|0)|(A|0)==(B|0)&M>>>0<b>>>0?(A=F,y[A>>2]=b,y[A+4>>2]=B,A=B):b=M,W=Ge(b|0,A|0,12,0)|0,Q=Me()|0,A=F,y[A>>2]=W,y[A+4>>2]=Q,A=E,y[A>>2]=W,y[A+4>>2]=Q,A=0}return Q=A,be=N,Q|0}function dh(m,A,b,E,M,B,F){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0,F=F|0;var N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0,lr=0,Ai=0,ri=0,ni=0,Wr=0,Vr=0,Gr=0,Vi=0,$r=0,fn=0,Rs=0,g0=0;if(Vi=be,be=be+64|0,ni=Vi+48|0,Wr=Vi+32|0,Vr=Vi+24|0,ar=Vi+8|0,mr=Vi,W=y[m>>2]|0,(W|0)<=0)return Gr=0,be=Vi,Gr|0;for(or=m+4|0,lr=ni+8|0,Ai=Wr+8|0,ri=ar+8|0,N=0,bt=0;;){Q=y[or>>2]|0,at=Q+(bt<<4)|0,y[ni>>2]=y[at>>2],y[ni+4>>2]=y[at+4>>2],y[ni+8>>2]=y[at+8>>2],y[ni+12>>2]=y[at+12>>2],(bt|0)==(W+-1|0)?(y[Wr>>2]=y[Q>>2],y[Wr+4>>2]=y[Q+4>>2],y[Wr+8>>2]=y[Q+8>>2],y[Wr+12>>2]=y[Q+12>>2]):(at=Q+(bt+1<<4)|0,y[Wr>>2]=y[at>>2],y[Wr+4>>2]=y[at+4>>2],y[Wr+8>>2]=y[at+8>>2],y[Wr+12>>2]=y[at+12>>2]),W=Ci(ni,Wr,E,Vr)|0;e:do if(W)Q=0,N=W;else if(Q=Vr,W=y[Q>>2]|0,Q=y[Q+4>>2]|0,(Q|0)>0|(Q|0)==0&W>>>0>0){wt=0,at=0;t:for(;;){if(g0=+Ee[ni>>3],It=Ze(W|0,Q|0,wt|0,at|0)|0,Rs=+(It>>>0)+4294967296*+(Me()|0),$r=+(W>>>0)+4294967296*+(Q|0),fn=+(wt>>>0)+4294967296*+(at|0),Ee[ar>>3]=g0*Rs/$r+ +Ee[Wr>>3]*fn/$r,Ee[ri>>3]=+Ee[lr>>3]*Rs/$r+ +Ee[Ai>>3]*fn/$r,W=ur(ar,E,mr)|0,W|0){N=W;break}It=mr,nt=y[It>>2]|0,It=y[It+4>>2]|0,$e=Kt(nt|0,It|0,A|0,b|0)|0,he=Me()|0,W=F+($e<<3)|0,we=W,Q=y[we>>2]|0,we=y[we+4>>2]|0;r:do if((Q|0)==0&(we|0)==0)ft=W,Gr=16;else for(Qe=0,Ue=0;;){if((Qe|0)>(b|0)|(Qe|0)==(b|0)&Ue>>>0>A>>>0){N=1;break t}if((Q|0)==(nt|0)&(we|0)==(It|0))break r;if(W=Ge($e|0,he|0,1,0)|0,$e=er(W|0,Me()|0,A|0,b|0)|0,he=Me()|0,Ue=Ge(Ue|0,Qe|0,1,0)|0,Qe=Me()|0,W=F+($e<<3)|0,we=W,Q=y[we>>2]|0,we=y[we+4>>2]|0,(Q|0)==0&(we|0)==0){ft=W,Gr=16;break}}while(!1);if((Gr|0)==16&&(Gr=0,!((nt|0)==0&(It|0)==0))&&(Ue=ft,y[Ue>>2]=nt,y[Ue+4>>2]=It,Ue=B+(y[M>>2]<<3)|0,y[Ue>>2]=nt,y[Ue+4>>2]=It,Ue=M,Ue=Ge(y[Ue>>2]|0,y[Ue+4>>2]|0,1,0)|0,nt=Me()|0,It=M,y[It>>2]=Ue,y[It+4>>2]=nt),wt=Ge(wt|0,at|0,1,0)|0,at=Me()|0,Q=Vr,W=y[Q>>2]|0,Q=y[Q+4>>2]|0,!((Q|0)>(at|0)|(Q|0)==(at|0)&W>>>0>wt>>>0)){Q=1;break e}}Q=0}else Q=1;while(!1);if(bt=bt+1|0,!Q){Gr=21;break}if(W=y[m>>2]|0,(bt|0)>=(W|0)){N=0,Gr=21;break}}return(Gr|0)==21?(be=Vi,N|0):0}function Jd(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0,lr=0,Ai=0,ri=0,ni=0,Wr=0,Vr=0,Gr=0,Vi=0,$r=0,fn=0,Rs=0;if(Rs=be,be=be+112|0,Gr=Rs+80|0,W=Rs+72|0,Vi=Rs,$r=Rs+56|0,b|0)return fn=15,be=Rs,fn|0;if(Q=m+8|0,fn=Ve((y[Q>>2]<<5)+32|0)|0,!fn)return fn=13,be=Rs,fn|0;if(Gf(m,fn),Wr=m,Vr=y[Wr+4>>2]|0,b=W,y[b>>2]=y[Wr>>2],y[b+4>>2]=Vr,fu(W,Gr),b=Ef(Gr,A,Vi)|0,b)Wr=0,Vr=0;else{if(b=y[W>>2]|0,B=y[Q>>2]|0,(B|0)>0){F=y[m+12>>2]|0,M=0;do b=(y[F+(M<<3)>>2]|0)+b|0,M=M+1|0;while((M|0)!=(B|0));M=b}else M=b;b=Vi,B=y[b>>2]|0,b=y[b+4>>2]|0,F=((M|0)<0)<<31>>31,(b|0)<(F|0)|(b|0)==(F|0)&B>>>0<M>>>0?(b=Vi,y[b>>2]=M,y[b+4>>2]=F,b=F):M=B,Wr=Ge(M|0,b|0,12,0)|0,Vr=Me()|0,b=Vi,y[b>>2]=Wr,y[b+4>>2]=Vr,b=0}if(b|0)return Be(fn),fn=b,be=Rs,fn|0;if(M=qe(Wr,8)|0,!M)return Be(fn),fn=13,be=Rs,fn|0;if(N=qe(Wr,8)|0,!N)return Be(fn),Be(M),fn=13,be=Rs,fn|0;ri=Gr,y[ri>>2]=0,y[ri+4>>2]=0,ri=m,ni=y[ri+4>>2]|0,b=W,y[b>>2]=y[ri>>2],y[b+4>>2]=ni,b=dh(W,Wr,Vr,A,Gr,M,N)|0;e:do if(b)Be(M),Be(N),Be(fn);else{t:do if((y[Q>>2]|0)>0){for(F=m+12|0,B=0;b=dh((y[F>>2]|0)+(B<<3)|0,Wr,Vr,A,Gr,M,N)|0,B=B+1|0,!(b|0);)if((B|0)>=(y[Q>>2]|0))break t;Be(M),Be(N),Be(fn);break e}while(!1);(Vr|0)>0|(Vr|0)==0&Wr>>>0>0&&Ui(N|0,0,Wr<<3|0)|0,ni=Gr,ri=y[ni+4>>2]|0;t:do if((ri|0)>0|(ri|0)==0&(y[ni>>2]|0)>>>0>0){or=M,lr=N,Ai=M,ri=N,ni=M,b=M,ft=M,ar=N,mr=N,M=N;r:for(;;){for(It=0,wt=0,at=0,bt=0,B=0,F=0;;){N=Vi,W=N+56|0;do y[N>>2]=0,N=N+4|0;while((N|0)<(W|0));if(A=or+(It<<3)|0,Q=y[A>>2]|0,A=y[A+4>>2]|0,l0(Q,A,1,Vi,0)|0){N=Vi,W=N+56|0;do y[N>>2]=0,N=N+4|0;while((N|0)<(W|0));N=qe(7,4)|0,N|0&&(wa(Q,A,1,Vi,N,7,0,0)|0,Be(N))}for(nt=0;;){Ue=Vi+(nt<<3)|0,Qe=y[Ue>>2]|0,Ue=y[Ue+4>>2]|0;i:do if((Qe|0)==0&(Ue|0)==0)N=B,W=F;else{if(he=Kt(Qe|0,Ue|0,Wr|0,Vr|0)|0,Q=Me()|0,N=E+(he<<3)|0,A=N,W=y[A>>2]|0,A=y[A+4>>2]|0,!((W|0)==0&(A|0)==0)){we=0,$e=0;do{if((we|0)>(Vr|0)|(we|0)==(Vr|0)&$e>>>0>Wr>>>0)break r;if((W|0)==(Qe|0)&(A|0)==(Ue|0)){N=B,W=F;break i}N=Ge(he|0,Q|0,1,0)|0,he=er(N|0,Me()|0,Wr|0,Vr|0)|0,Q=Me()|0,$e=Ge($e|0,we|0,1,0)|0,we=Me()|0,N=E+(he<<3)|0,A=N,W=y[A>>2]|0,A=y[A+4>>2]|0}while(!((W|0)==0&(A|0)==0))}(Qe|0)==0&(Ue|0)==0?(N=B,W=F):(lu(Qe,Ue,$r)|0,fc(m,fn,$r)|0&&($e=Ge(B|0,F|0,1,0)|0,F=Me()|0,we=N,y[we>>2]=Qe,y[we+4>>2]=Ue,B=lr+(B<<3)|0,y[B>>2]=Qe,y[B+4>>2]=Ue,B=$e),N=B,W=F)}while(!1);if(nt=nt+1|0,nt>>>0>=7)break;B=N,F=W}if(It=Ge(It|0,wt|0,1,0)|0,wt=Me()|0,at=Ge(at|0,bt|0,1,0)|0,bt=Me()|0,F=Gr,B=y[F>>2]|0,F=y[F+4>>2]|0,(bt|0)<(F|0)|(bt|0)==(F|0)&at>>>0<B>>>0)B=N,F=W;else break}if((F|0)>0|(F|0)==0&B>>>0>0){B=0,F=0;do bt=or+(B<<3)|0,y[bt>>2]=0,y[bt+4>>2]=0,B=Ge(B|0,F|0,1,0)|0,F=Me()|0,bt=Gr,at=y[bt+4>>2]|0;while((F|0)<(at|0)|((F|0)==(at|0)?B>>>0<(y[bt>>2]|0)>>>0:0))}if(bt=Gr,y[bt>>2]=N,y[bt+4>>2]=W,(W|0)>0|(W|0)==0&N>>>0>0)nt=M,It=mr,wt=ni,at=ar,bt=lr,M=ft,mr=b,ar=Ai,ft=nt,b=It,ni=ri,ri=wt,Ai=at,lr=or,or=bt;else break t}Be(Ai),Be(ri),Be(fn),b=1;break e}else b=N;while(!1);Be(fn),Be(M),Be(b),b=0}while(!1);return fn=b,be=Rs,fn|0}function ec(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0;if(he=be,be=be+176|0,W=he,(A|0)<1)return H(b,0,0),Q=0,be=he,Q|0;for(N=m,N=mt(y[N>>2]|0,y[N+4>>2]|0,52)|0,Me()|0,H(b,(A|0)>6?A:6,N&15),N=0;E=m+(N<<3)|0,E=ra(y[E>>2]|0,y[E+4>>2]|0,W)|0,!(E|0);){if(E=y[W>>2]|0,(E|0)>0){F=0;do B=W+8+(F<<4)|0,F=F+1|0,E=W+8+(((F|0)%(E|0)|0)<<4)|0,M=Ae(b,E,B)|0,M?ie(b,M)|0:fe(b,B,E)|0,E=y[W>>2]|0;while((F|0)<(E|0))}if(N=N+1|0,(N|0)>=(A|0)){E=0,Q=13;break}}return(Q|0)==13?(be=he,E|0):(K(b),Q=E,be=he,Q|0)}function Qc(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;if(B=be,be=be+32|0,E=B,M=B+16|0,m=ec(m,A,M)|0,m|0)return b=m,be=B,b|0;if(y[b>>2]=0,y[b+4>>2]=0,y[b+8>>2]=0,m=ne(M)|0,m|0)do{A=Vf(b)|0;do mp(A,m)|0,F=m+16|0,y[E>>2]=y[F>>2],y[E+4>>2]=y[F+4>>2],y[E+8>>2]=y[F+8>>2],y[E+12>>2]=y[F+12>>2],ie(M,m)|0,m=Ie(M,E)|0;while(m|0);m=ne(M)|0}while(m|0);return K(M),m=ps(b)|0,m?(jf(b),F=m,be=B,F|0):(F=0,be=B,F|0)}function _i(m){return m=m|0,m>>>0>121?(m=0,m|0):(m=y[7696+(m*28|0)+16>>2]|0,m|0)}function wf(m){return m=m|0,(m|0)==4|(m|0)==117|0}function ep(m){return m=m|0,y[11120+((y[m>>2]|0)*216|0)+((y[m+4>>2]|0)*72|0)+((y[m+8>>2]|0)*24|0)+(y[m+12>>2]<<3)>>2]|0}function tp(m){return m=m|0,y[11120+((y[m>>2]|0)*216|0)+((y[m+4>>2]|0)*72|0)+((y[m+8>>2]|0)*24|0)+(y[m+12>>2]<<3)+4>>2]|0}function tc(m,A){m=m|0,A=A|0,m=7696+(m*28|0)|0,y[A>>2]=y[m>>2],y[A+4>>2]=y[m+4>>2],y[A+8>>2]=y[m+8>>2],y[A+12>>2]=y[m+12>>2]}function Tf(m,A){m=m|0,A=A|0;var b=0,E=0;if(A>>>0>20)return A=-1,A|0;do if((y[11120+(A*216|0)>>2]|0)!=(m|0))if((y[11120+(A*216|0)+8>>2]|0)!=(m|0))if((y[11120+(A*216|0)+16>>2]|0)!=(m|0))if((y[11120+(A*216|0)+24>>2]|0)!=(m|0))if((y[11120+(A*216|0)+32>>2]|0)!=(m|0))if((y[11120+(A*216|0)+40>>2]|0)!=(m|0))if((y[11120+(A*216|0)+48>>2]|0)!=(m|0))if((y[11120+(A*216|0)+56>>2]|0)!=(m|0))if((y[11120+(A*216|0)+64>>2]|0)!=(m|0))if((y[11120+(A*216|0)+72>>2]|0)!=(m|0))if((y[11120+(A*216|0)+80>>2]|0)!=(m|0))if((y[11120+(A*216|0)+88>>2]|0)!=(m|0))if((y[11120+(A*216|0)+96>>2]|0)!=(m|0))if((y[11120+(A*216|0)+104>>2]|0)!=(m|0))if((y[11120+(A*216|0)+112>>2]|0)!=(m|0))if((y[11120+(A*216|0)+120>>2]|0)!=(m|0))if((y[11120+(A*216|0)+128>>2]|0)!=(m|0))if((y[11120+(A*216|0)+136>>2]|0)==(m|0))m=2,b=1,E=2;else{if((y[11120+(A*216|0)+144>>2]|0)==(m|0)){m=0,b=2,E=0;break}if((y[11120+(A*216|0)+152>>2]|0)==(m|0)){m=0,b=2,E=1;break}if((y[11120+(A*216|0)+160>>2]|0)==(m|0)){m=0,b=2,E=2;break}if((y[11120+(A*216|0)+168>>2]|0)==(m|0)){m=1,b=2,E=0;break}if((y[11120+(A*216|0)+176>>2]|0)==(m|0)){m=1,b=2,E=1;break}if((y[11120+(A*216|0)+184>>2]|0)==(m|0)){m=1,b=2,E=2;break}if((y[11120+(A*216|0)+192>>2]|0)==(m|0)){m=2,b=2,E=0;break}if((y[11120+(A*216|0)+200>>2]|0)==(m|0)){m=2,b=2,E=1;break}if((y[11120+(A*216|0)+208>>2]|0)==(m|0)){m=2,b=2,E=2;break}else m=-1;return m|0}else m=2,b=1,E=1;else m=2,b=1,E=0;else m=1,b=1,E=2;else m=1,b=1,E=1;else m=1,b=1,E=0;else m=0,b=1,E=2;else m=0,b=1,E=1;else m=0,b=1,E=0;else m=2,b=0,E=2;else m=2,b=0,E=1;else m=2,b=0,E=0;else m=1,b=0,E=2;else m=1,b=0,E=1;else m=1,b=0,E=0;else m=0,b=0,E=2;else m=0,b=0,E=1;else m=0,b=0,E=0;while(!1);return A=y[11120+(A*216|0)+(b*72|0)+(m*24|0)+(E<<3)+4>>2]|0,A|0}function ph(m,A){return m=m|0,A=A|0,(y[7696+(m*28|0)+20>>2]|0)==(A|0)?(A=1,A|0):(A=(y[7696+(m*28|0)+24>>2]|0)==(A|0),A|0)}function rc(m,A){return m=m|0,A=A|0,y[848+(m*28|0)+(A<<2)>>2]|0}function Jc(m,A){return m=m|0,A=A|0,(y[848+(m*28|0)>>2]|0)==(A|0)?(A=0,A|0):(y[848+(m*28|0)+4>>2]|0)==(A|0)?(A=1,A|0):(y[848+(m*28|0)+8>>2]|0)==(A|0)?(A=2,A|0):(y[848+(m*28|0)+12>>2]|0)==(A|0)?(A=3,A|0):(y[848+(m*28|0)+16>>2]|0)==(A|0)?(A=4,A|0):(y[848+(m*28|0)+20>>2]|0)==(A|0)?(A=5,A|0):((y[848+(m*28|0)+24>>2]|0)==(A|0)?6:7)|0}function c0(){return 122}function eu(m){m=m|0;var A=0,b=0,E=0;A=0;do Nt(A|0,0,45)|0,E=Me()|0|134225919,b=m+(A<<3)|0,y[b>>2]=-1,y[b+4>>2]=E,A=A+1|0;while((A|0)!=122);return 0}function ic(m){return m=m|0,+Ee[m+16>>3]<+Ee[m+24>>3]|0}function rp(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;return b=+Ee[A>>3],!(b>=+Ee[m+8>>3])||!(b<=+Ee[m>>3])?(A=0,A|0):(E=+Ee[m+16>>3],b=+Ee[m+24>>3],M=+Ee[A+8>>3],A=M>=b,m=M<=E&1,E<b?A&&(m=1):A||(m=0),A=(m|0)!=0,A|0)}function Ef(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0;Ue=be,be=be+288|0,he=Ue+264|0,we=Ue+96|0,Q=Ue,N=Q,W=N+96|0;do y[N>>2]=0,N=N+4|0;while((N|0)<(W|0));return A=cu(A,Q)|0,A|0?(Qe=A,be=Ue,Qe|0):(W=Q,Q=y[W>>2]|0,W=y[W+4>>2]|0,lu(Q,W,he)|0,ra(Q,W,we)|0,F=+uu(he,we+8|0),Ee[he>>3]=+Ee[m>>3],W=he+8|0,Ee[W>>3]=+Ee[m+16>>3],Ee[we>>3]=+Ee[m+8>>3],Q=we+8|0,Ee[Q>>3]=+Ee[m+24>>3],M=+uu(he,we),It=+Ee[W>>3]-+Ee[Q>>3],B=+Gi(+It),nt=+Ee[he>>3]-+Ee[we>>3],E=+Gi(+nt),!(It==0|nt==0)&&(It=+Ri(+B,+E),It=+xa(+(M*M/+Hr(+(It/+Hr(+B,+E)),3)/(F*(F*2.59807621135)*.8))),Ee[Rn>>3]=It,$e=~~It>>>0,Qe=+Gi(It)>=1?It>0?~~+Kl(+to(It/4294967296),4294967295)>>>0:~~+xa((It-+(~~It>>>0))/4294967296)>>>0:0,(y[Rn+4>>2]&2146435072|0)!=2146435072)?(we=($e|0)==0&(Qe|0)==0,A=b,y[A>>2]=we?1:$e,y[A+4>>2]=we?0:Qe,A=0):A=1,Qe=A,be=Ue,Qe|0)}function Ci(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0;Q=be,be=be+288|0,F=Q+264|0,N=Q+96|0,W=Q,M=W,B=M+96|0;do y[M>>2]=0,M=M+4|0;while((M|0)<(B|0));return b=cu(b,W)|0,b|0?(E=b,be=Q,E|0):(b=W,M=y[b>>2]|0,b=y[b+4>>2]|0,lu(M,b,F)|0,ra(M,b,N)|0,he=+uu(F,N+8|0),he=+xa(+(+uu(m,A)/(he*2))),Ee[Rn>>3]=he,b=~~he>>>0,M=+Gi(he)>=1?he>0?~~+Kl(+to(he/4294967296),4294967295)>>>0:~~+xa((he-+(~~he>>>0))/4294967296)>>>0:0,(y[Rn+4>>2]&2146435072|0)==2146435072?(E=1,be=Q,E|0):(W=(b|0)==0&(M|0)==0,y[E>>2]=W?1:b,y[E+4>>2]=W?0:M,E=0,be=Q,E|0))}function Cf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0,y[m>>2]=A,y[m+4>>2]=b,y[m+8>>2]=E}function ip(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0;we=A+8|0,y[we>>2]=0,W=+Ee[m>>3],F=+Gi(+W),Q=+Ee[m+8>>3],N=+Gi(+Q)/.8660254037844386,F=F+N*.5,b=~~F,m=~~N,F=F-+(b|0),N=N-+(m|0);do if(F<.5)if(F<.3333333333333333)if(y[A>>2]=b,N<(F+1)*.5){y[A+4>>2]=m;break}else{m=m+1|0,y[A+4>>2]=m;break}else if($e=1-F,m=(!(N<$e)&1)+m|0,y[A+4>>2]=m,$e<=N&N<F*2){b=b+1|0,y[A>>2]=b;break}else{y[A>>2]=b;break}else{if(!(F<.6666666666666666))if(b=b+1|0,y[A>>2]=b,N<F*.5){y[A+4>>2]=m;break}else{m=m+1|0,y[A+4>>2]=m;break}if(N<1-F){if(y[A+4>>2]=m,F*2+-1<N){y[A>>2]=b;break}}else m=m+1|0,y[A+4>>2]=m;b=b+1|0,y[A>>2]=b}while(!1);do if(W<0)if(m&1){he=(m+1|0)/2|0,he=Ze(b|0,((b|0)<0)<<31>>31|0,he|0,((he|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-((+(he>>>0)+4294967296*+(Me()|0))*2+1)),y[A>>2]=b;break}else{he=(m|0)/2|0,he=Ze(b|0,((b|0)<0)<<31>>31|0,he|0,((he|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-(+(he>>>0)+4294967296*+(Me()|0))*2),y[A>>2]=b;break}while(!1);he=A+4|0,Q<0&&(b=b-((m<<1|1|0)/2|0)|0,y[A>>2]=b,m=0-m|0,y[he>>2]=m),E=m-b|0,(b|0)<0?(M=0-b|0,y[he>>2]=E,y[we>>2]=M,y[A>>2]=0,m=E,b=0):M=0,(m|0)<0&&(b=b-m|0,y[A>>2]=b,M=M-m|0,y[we>>2]=M,y[he>>2]=0,m=0),B=b-M|0,E=m-M|0,(M|0)<0&&(y[A>>2]=B,y[he>>2]=E,y[we>>2]=0,m=E,b=B,M=0),E=(m|0)<(b|0)?m:b,E=(M|0)<(E|0)?M:E,!((E|0)<=0)&&(y[A>>2]=b-E,y[he>>2]=m-E,y[we>>2]=M-E)}function vo(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0;A=y[m>>2]|0,F=m+4|0,b=y[F>>2]|0,(A|0)<0&&(b=b-A|0,y[F>>2]=b,B=m+8|0,y[B>>2]=(y[B>>2]|0)-A,y[m>>2]=0,A=0),(b|0)<0?(A=A-b|0,y[m>>2]=A,B=m+8|0,M=(y[B>>2]|0)-b|0,y[B>>2]=M,y[F>>2]=0,b=0):(M=m+8|0,B=M,M=y[M>>2]|0),(M|0)<0&&(A=A-M|0,y[m>>2]=A,b=b-M|0,y[F>>2]=b,y[B>>2]=0,M=0),E=(b|0)<(A|0)?b:A,E=(M|0)<(E|0)?M:E,!((E|0)<=0)&&(y[m>>2]=A-E,y[F>>2]=b-E,y[B>>2]=M-E)}function ea(m,A){m=m|0,A=A|0;var b=0,E=0;E=y[m+8>>2]|0,b=+((y[m+4>>2]|0)-E|0),Ee[A>>3]=+((y[m>>2]|0)-E|0)-b*.5,Ee[A+8>>3]=b*.8660254037844386}function Qo(m,A,b){m=m|0,A=A|0,b=b|0,y[b>>2]=(y[A>>2]|0)+(y[m>>2]|0),y[b+4>>2]=(y[A+4>>2]|0)+(y[m+4>>2]|0),y[b+8>>2]=(y[A+8>>2]|0)+(y[m+8>>2]|0)}function Sf(m,A,b){m=m|0,A=A|0,b=b|0,y[b>>2]=(y[m>>2]|0)-(y[A>>2]|0),y[b+4>>2]=(y[m+4>>2]|0)-(y[A+4>>2]|0),y[b+8>>2]=(y[m+8>>2]|0)-(y[A+8>>2]|0)}function np(m,A){m=m|0,A=A|0;var b=0,E=0;b=ba(y[m>>2]|0,A)|0,y[m>>2]=b,b=m+4|0,E=ba(y[b>>2]|0,A)|0,y[b>>2]=E,m=m+8|0,A=ba(y[m>>2]|0,A)|0,y[m>>2]=A}function If(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=y[m>>2]|0,N=(F|0)<0,E=(y[m+4>>2]|0)-(N?F:0)|0,B=(E|0)<0,M=(B?0-E|0:0)+((y[m+8>>2]|0)-(N?F:0))|0,b=(M|0)<0,m=b?0:M,A=(B?0:E)-(b?M:0)|0,M=(N?0:F)-(B?E:0)-(b?M:0)|0,b=(A|0)<(M|0)?A:M,b=(m|0)<(b|0)?m:b,E=(b|0)>0,m=m-(E?b:0)|0,A=A-(E?b:0)|0;e:do switch(M-(E?b:0)|0){case 0:switch(A|0){case 0:return N=m|0?(m|0)==1?1:7:0,N|0;case 1:return N=m|0?(m|0)==1?3:7:2,N|0;default:break e}case 1:switch(A|0){case 0:return N=m|0?(m|0)==1?5:7:4,N|0;case 1:{if(!m)m=6;else break e;return m|0}default:break e}default:}while(!1);return N=7,N|0}function tu(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,M=y[F>>2]|0,B=(y[m>>2]|0)-M|0,N=m+4|0,M=(y[N>>2]|0)-M|0;do if(B>>>0>715827881|M>>>0>715827881){if(b=(B|0)>0,b){if((2147483647-B|0)<(B|0)||(2147483647-(B<<1)|0)<(B|0))return N=1,N|0}else if((-2147483648-B|0)>(B|0)||(-2147483648-(B<<1)|0)>(B|0))return N=1,N|0;if(A=B*3|0,(M|0)>0){if((2147483647-M|0)<(M|0))return N=1,N|0}else if((-2147483648-M|0)>(M|0))return N=1,N|0;if(E=M<<1,(B|0)>-1){if((A|-2147483648|0)>=(M|0))return N=1,N|0}else if((A^-2147483648|0)<(M|0))return N=1,N|0;if(b){if((2147483647-B|0)<(E|0))A=1;else{b=E;break}return A|0}else{if((-2147483648-B|0)>(E|0))A=1;else{b=E;break}return A|0}}else b=M<<1,A=B*3|0;while(!1);E=Fe(+(A-M|0)/7)|0,y[m>>2]=E,M=Fe(+(b+B|0)/7)|0,y[N>>2]=M,y[F>>2]=0,b=(M|0)<(E|0),A=b?E:M,b=b?M:E;do if((b|0)<0){if((A|0)>0){if((A|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-A|0)>=(b|0)))break;Nr(23313,22444,355,22455)}if((b|0)==-2147483648|(-2147483648-A|0)>(b|0)&&Nr(23313,22444,355,22455),(A|0)>-1){if((A|-2147483648|0)<(b|0))break;Nr(23313,22444,355,22455)}else{if((A^-2147483648|0)>=(b|0))break;Nr(23313,22444,355,22455)}}while(!1);return A=M-E|0,(E|0)<0?(b=0-E|0,y[N>>2]=A,y[F>>2]=b,y[m>>2]=0,E=0):(A=M,b=0),(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,(E|0)<=0?(N=0,N|0):(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E,N=0,N|0)}function Ah(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,M=y[F>>2]|0,B=(y[m>>2]|0)-M|0,N=m+4|0,M=(y[N>>2]|0)-M|0;do if(B>>>0>715827881|M>>>0>715827881){if(b=(B|0)>0,b){if((2147483647-B|0)<(B|0))return N=1,N|0}else if((-2147483648-B|0)>(B|0))return N=1,N|0;if(A=B<<1,(M|0)>0){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return N=1,N|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return N=1,N|0;if(E=M*3|0,b){if((2147483647-A|0)<(M|0))return N=1,N|0}else if((-2147483648-A|0)>(M|0))return N=1,N|0;if((M|0)>-1){if((E|-2147483648|0)<(B|0)){b=E;break}else A=1;return A|0}else{if((E^-2147483648|0)<(B|0))A=1;else{b=E;break}return A|0}}else b=M*3|0,A=B<<1;while(!1);E=Fe(+(A+M|0)/7)|0,y[m>>2]=E,M=Fe(+(b-B|0)/7)|0,y[N>>2]=M,y[F>>2]=0,b=(M|0)<(E|0),A=b?E:M,b=b?M:E;do if((b|0)<0){if((A|0)>0){if((A|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-A|0)>=(b|0)))break;Nr(23313,22444,404,22469)}if((b|0)==-2147483648|(-2147483648-A|0)>(b|0)&&Nr(23313,22444,404,22469),(A|0)>-1){if((A|-2147483648|0)<(b|0))break;Nr(23313,22444,404,22469)}else{if((A^-2147483648|0)>=(b|0))break;Nr(23313,22444,404,22469)}}while(!1);return A=M-E|0,(E|0)<0?(b=0-E|0,y[N>>2]=A,y[F>>2]=b,y[m>>2]=0,E=0):(A=M,b=0),(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,(E|0)<=0?(N=0,N|0):(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E,N=0,N|0)}function Mf(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,b=y[F>>2]|0,A=(y[m>>2]|0)-b|0,N=m+4|0,b=(y[N>>2]|0)-b|0,E=Fe(+((A*3|0)-b|0)/7)|0,y[m>>2]=E,A=Fe(+((b<<1)+A|0)/7)|0,y[N>>2]=A,y[F>>2]=0,b=A-E|0,(E|0)<0?(B=0-E|0,y[N>>2]=b,y[F>>2]=B,y[m>>2]=0,A=b,E=0,b=B):b=0,(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,!((E|0)<=0)&&(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E)}function Pf(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;F=m+8|0,b=y[F>>2]|0,A=(y[m>>2]|0)-b|0,N=m+4|0,b=(y[N>>2]|0)-b|0,E=Fe(+((A<<1)+b|0)/7)|0,y[m>>2]=E,A=Fe(+((b*3|0)-A|0)/7)|0,y[N>>2]=A,y[F>>2]=0,b=A-E|0,(E|0)<0?(B=0-E|0,y[N>>2]=b,y[F>>2]=B,y[m>>2]=0,A=b,E=0,b=B):b=0,(A|0)<0&&(E=E-A|0,y[m>>2]=E,b=b-A|0,y[F>>2]=b,y[N>>2]=0,A=0),B=E-b|0,M=A-b|0,(b|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,A=M,M=B,b=0):M=E,E=(A|0)<(M|0)?A:M,E=(b|0)<(E|0)?b:E,!((E|0)<=0)&&(y[m>>2]=M-E,y[N>>2]=A-E,y[F>>2]=b-E)}function ru(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;A=y[m>>2]|0,F=m+4|0,b=y[F>>2]|0,N=m+8|0,E=y[N>>2]|0,M=b+(A*3|0)|0,y[m>>2]=M,b=E+(b*3|0)|0,y[F>>2]=b,A=(E*3|0)+A|0,y[N>>2]=A,E=b-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=E,y[N>>2]=A,y[m>>2]=0,b=E,E=0):E=M,(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function fl(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=y[m>>2]|0,F=m+4|0,A=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,E=(A*3|0)+M|0,M=b+(M*3|0)|0,y[m>>2]=M,y[F>>2]=E,A=(b*3|0)+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,M=0):b=E,(b|0)<0&&(M=M-b|0,y[m>>2]=M,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=M-A|0,E=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=E,y[N>>2]=0,M=B,A=0):E=b,b=(E|0)<(M|0)?E:M,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=M-b,y[F>>2]=E-b,y[N>>2]=A-b)}function mh(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;(A+-1|0)>>>0>=6||(M=(y[15440+(A*12|0)>>2]|0)+(y[m>>2]|0)|0,y[m>>2]=M,N=m+4|0,E=(y[15440+(A*12|0)+4>>2]|0)+(y[N>>2]|0)|0,y[N>>2]=E,F=m+8|0,A=(y[15440+(A*12|0)+8>>2]|0)+(y[F>>2]|0)|0,y[F>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[N>>2]=b,y[F>>2]=A,y[m>>2]=0,E=0):(b=E,E=M),(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[F>>2]=A,y[N>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[N>>2]=M,y[F>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[N>>2]=M-b,y[F>>2]=A-b))}function iu(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=y[m>>2]|0,F=m+4|0,A=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,E=A+M|0,M=b+M|0,y[m>>2]=M,y[F>>2]=E,A=b+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,E=0):(b=E,E=M),(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function nc(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;A=y[m>>2]|0,F=m+4|0,E=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,M=E+A|0,y[m>>2]=M,E=b+E|0,y[F>>2]=E,A=b+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,E=0):(b=E,E=M),(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function oc(m){switch(m=m|0,m|0){case 1:{m=5;break}case 5:{m=4;break}case 4:{m=6;break}case 6:{m=2;break}case 2:{m=3;break}case 3:{m=1;break}default:}return m|0}function Ta(m){switch(m=m|0,m|0){case 1:{m=3;break}case 3:{m=2;break}case 2:{m=6;break}case 6:{m=4;break}case 4:{m=5;break}case 5:{m=1;break}default:}return m|0}function op(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;A=y[m>>2]|0,F=m+4|0,b=y[F>>2]|0,N=m+8|0,E=y[N>>2]|0,M=b+(A<<1)|0,y[m>>2]=M,b=E+(b<<1)|0,y[F>>2]=b,A=(E<<1)+A|0,y[N>>2]=A,E=b-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=E,y[N>>2]=A,y[m>>2]=0,b=E,E=0):E=M,(b|0)<0&&(E=E-b|0,y[m>>2]=E,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=E-A|0,M=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=M,y[N>>2]=0,E=B,A=0):M=b,b=(M|0)<(E|0)?M:E,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=E-b,y[F>>2]=M-b,y[N>>2]=A-b)}function Rf(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=y[m>>2]|0,F=m+4|0,A=y[F>>2]|0,N=m+8|0,b=y[N>>2]|0,E=(A<<1)+M|0,M=b+(M<<1)|0,y[m>>2]=M,y[F>>2]=E,A=(b<<1)+A|0,y[N>>2]=A,b=E-M|0,(M|0)<0?(A=A-M|0,y[F>>2]=b,y[N>>2]=A,y[m>>2]=0,M=0):b=E,(b|0)<0&&(M=M-b|0,y[m>>2]=M,A=A-b|0,y[N>>2]=A,y[F>>2]=0,b=0),B=M-A|0,E=b-A|0,(A|0)<0?(y[m>>2]=B,y[F>>2]=E,y[N>>2]=0,M=B,A=0):E=b,b=(E|0)<(M|0)?E:M,b=(A|0)<(b|0)?A:b,!((b|0)<=0)&&(y[m>>2]=M-b,y[F>>2]=E-b,y[N>>2]=A-b)}function sc(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;return F=(y[m>>2]|0)-(y[A>>2]|0)|0,N=(F|0)<0,E=(y[m+4>>2]|0)-(y[A+4>>2]|0)-(N?F:0)|0,B=(E|0)<0,M=(N?0-F|0:0)+(y[m+8>>2]|0)-(y[A+8>>2]|0)+(B?0-E|0:0)|0,m=(M|0)<0,A=m?0:M,b=(B?0:E)-(m?M:0)|0,M=(N?0:F)-(B?E:0)-(m?M:0)|0,m=(b|0)<(M|0)?b:M,m=(A|0)<(m|0)?A:m,E=(m|0)>0,A=A-(E?m:0)|0,b=b-(E?m:0)|0,m=M-(E?m:0)|0,m=(m|0)>-1?m:0-m|0,b=(b|0)>-1?b:0-b|0,A=(A|0)>-1?A:0-A|0,A=(b|0)>(A|0)?b:A,((m|0)>(A|0)?m:A)|0}function Bf(m,A){m=m|0,A=A|0;var b=0;b=y[m+8>>2]|0,y[A>>2]=(y[m>>2]|0)-b,y[A+4>>2]=(y[m+4>>2]|0)-b}function Lf(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;E=y[m>>2]|0,y[A>>2]=E,M=y[m+4>>2]|0,F=A+4|0,y[F>>2]=M,N=A+8|0,y[N>>2]=0,b=(M|0)<(E|0),m=b?E:M,b=b?M:E;do if((b|0)<0){if((m|0)>0){if((m|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-m|0)>=(b|0)))break;return m=1,m|0}if((b|0)==-2147483648|(-2147483648-m|0)>(b|0))return A=1,A|0;if((m|0)>-1){if((m|-2147483648|0)<(b|0))break;return m=1,m|0}else{if((m^-2147483648|0)<(b|0))m=1;else break;return m|0}}while(!1);return m=M-E|0,(E|0)<0?(b=0-E|0,y[F>>2]=m,y[N>>2]=b,y[A>>2]=0,E=0):(m=M,b=0),(m|0)<0&&(E=E-m|0,y[A>>2]=E,b=b-m|0,y[N>>2]=b,y[F>>2]=0,m=0),B=E-b|0,M=m-b|0,(b|0)<0?(y[A>>2]=B,y[F>>2]=M,y[N>>2]=0,m=M,M=B,b=0):M=E,E=(m|0)<(M|0)?m:M,E=(b|0)<(E|0)?b:E,(E|0)<=0?(A=0,A|0):(y[A>>2]=M-E,y[F>>2]=m-E,y[N>>2]=b-E,A=0,A|0)}function gh(m){m=m|0;var A=0,b=0,E=0,M=0;A=m+8|0,M=y[A>>2]|0,b=M-(y[m>>2]|0)|0,y[m>>2]=b,E=m+4|0,m=(y[E>>2]|0)-M|0,y[E>>2]=m,y[A>>2]=0-(m+b)}function nu(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;b=y[m>>2]|0,A=0-b|0,y[m>>2]=A,F=m+8|0,y[F>>2]=0,N=m+4|0,E=y[N>>2]|0,M=E+b|0,(b|0)>0?(y[N>>2]=M,y[F>>2]=b,y[m>>2]=0,A=0,E=M):b=0,(E|0)<0?(B=A-E|0,y[m>>2]=B,b=b-E|0,y[F>>2]=b,y[N>>2]=0,M=B-b|0,A=0-b|0,(b|0)<0?(y[m>>2]=M,y[N>>2]=A,y[F>>2]=0,E=A,b=0):(E=0,M=B)):M=A,A=(E|0)<(M|0)?E:M,A=(b|0)<(A|0)?b:A,!((A|0)<=0)&&(y[m>>2]=M-A,y[N>>2]=E-A,y[F>>2]=b-A)}function ou(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0;if(we=be,be=be+64|0,he=we,N=we+56|0,!(!0&(A&2013265920|0)==134217728&(!0&(E&2013265920|0)==134217728)))return M=5,be=we,M|0;if((m|0)==(b|0)&(A|0)==(E|0))return y[M>>2]=0,M=0,be=we,M|0;if(F=mt(m|0,A|0,52)|0,Me()|0,F=F&15,Q=mt(b|0,E|0,52)|0,Me()|0,(F|0)!=(Q&15|0))return M=12,be=we,M|0;if(B=F+-1|0,F>>>0>1){kf(m,A,B,he)|0,kf(b,E,B,N)|0,Q=he,W=y[Q>>2]|0,Q=y[Q+4>>2]|0;e:do if((W|0)==(y[N>>2]|0)&&(Q|0)==(y[N+4>>2]|0)){F=(F^15)*3|0,B=mt(m|0,A|0,F|0)|0,Me()|0,B=B&7,F=mt(b|0,E|0,F|0)|0,Me()|0,F=F&7;do if((B|0)==0|(F|0)==0)y[M>>2]=1,B=0;else if((B|0)==7)B=5;else{if((B|0)==1|(F|0)==1&&Hi(W,Q)|0){B=5;break}if((y[15536+(B<<2)>>2]|0)!=(F|0)&&(y[15568+(B<<2)>>2]|0)!=(F|0))break e;y[M>>2]=1,B=0}while(!1);return M=B,be=we,M|0}while(!1)}B=he,F=B+56|0;do y[B>>2]=0,B=B+4|0;while((B|0)<(F|0));return s0(m,A,1,he)|0,A=he,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0))&&(A=he+8|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+16|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+24|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+32|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+40|0,!((y[A>>2]|0)==(b|0)&&(y[A+4>>2]|0)==(E|0)))?(B=he+48|0,B=((y[B>>2]|0)==(b|0)?(y[B+4>>2]|0)==(E|0):0)&1):B=1,y[M>>2]=B,M=0,be=we,M|0}function Vg(m,A,b,E,M){return m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,b=xf(m,A,b,E)|0,(b|0)==7?(M=11,M|0):(E=Nt(b|0,0,56)|0,A=A&-2130706433|(Me()|0)|268435456,y[M>>2]=m|E,y[M+4>>2]=A,M=0,M|0)}function u0(m,A,b){return m=m|0,A=A|0,b=b|0,!0&(A&2013265920|0)==268435456?(y[b>>2]=m,y[b+4>>2]=A&-2130706433|134217728,b=0,b|0):(b=6,b|0)}function Un(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;return M=be,be=be+16|0,E=M,y[E>>2]=0,!0&(A&2013265920|0)==268435456?(B=mt(m|0,A|0,56)|0,Me()|0,E=po(m,A&-2130706433|134217728,B&7,E,b)|0,be=M,E|0):(E=6,be=M,E|0)}function ac(m,A){m=m|0,A=A|0;var b=0;switch(b=mt(m|0,A|0,56)|0,Me()|0,b&7){case 0:case 7:return b=0,b|0;default:}return b=A&-2130706433|134217728,!(!0&(A&2013265920|0)==268435456)||!0&(A&117440512|0)==16777216&(Hi(m,b)|0)!=0?(b=0,b|0):(b=Ff(m,b)|0,b|0)}function zs(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;return M=be,be=be+16|0,E=M,!0&(A&2013265920|0)==268435456?(B=A&-2130706433|134217728,F=b,y[F>>2]=m,y[F+4>>2]=B,y[E>>2]=0,A=mt(m|0,A|0,56)|0,Me()|0,E=po(m,B,A&7,E,b+8|0)|0,be=M,E|0):(E=6,be=M,E|0)}function sp(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;return M=(Hi(m,A)|0)==0,A=A&-2130706433,E=b,y[E>>2]=M?m:0,y[E+4>>2]=M?A|285212672:0,E=b+8|0,y[E>>2]=m,y[E+4>>2]=A|301989888,E=b+16|0,y[E>>2]=m,y[E+4>>2]=A|318767104,E=b+24|0,y[E>>2]=m,y[E+4>>2]=A|335544320,E=b+32|0,y[E>>2]=m,y[E+4>>2]=A|352321536,b=b+40|0,y[b>>2]=m,y[b+4>>2]=A|369098752,0}function lc(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;return F=be,be=be+16|0,M=F,B=A&-2130706433|134217728,!0&(A&2013265920|0)==268435456?(E=mt(m|0,A|0,56)|0,Me()|0,E=_(m,B,E&7)|0,(E|0)==-1?(y[b>>2]=0,B=6,be=F,B|0):(ta(m,B,M)|0&&Nr(23313,22484,282,22499),A=mt(m|0,A|0,52)|0,Me()|0,A=A&15,Hi(m,B)|0?Of(M,A,E,2,b):Va(M,A,E,2,b),B=0,be=F,B|0)):(B=6,be=F,B|0)}function ap(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;E=be,be=be+16|0,M=E,Ua(m,A,b,M),ip(M,b+4|0),be=E}function Ua(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0;if(N=be,be=be+16|0,W=N,_h(m,b,W),B=+r0(+(1-+Ee[W>>3]*.5)),B<1e-16){y[E>>2]=0,y[E+4>>2]=0,y[E+8>>2]=0,y[E+12>>2]=0,be=N;return}if(W=y[b>>2]|0,M=+Ee[15920+(W*24|0)>>3],M=+uc(M-+uc(+Gg(15600+(W<<4)|0,m))),wn(A)|0?F=+uc(M+-.3334731722518321):F=M,M=+Yc(+B)/.381966011250105,(A|0)>0){m=0;do M=M*2.6457513110645907,m=m+1|0;while((m|0)!=(A|0))}B=+Ei(+F)*M,Ee[E>>3]=B,F=+Mi(+F)*M,Ee[E+8>>3]=F,be=N}function _h(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(B=be,be=be+32|0,M=B,u(m,M),y[A>>2]=0,Ee[b>>3]=5,E=+s(16400,M),E<+Ee[b>>3]&&(y[A>>2]=0,Ee[b>>3]=E),E=+s(16424,M),E<+Ee[b>>3]&&(y[A>>2]=1,Ee[b>>3]=E),E=+s(16448,M),E<+Ee[b>>3]&&(y[A>>2]=2,Ee[b>>3]=E),E=+s(16472,M),E<+Ee[b>>3]&&(y[A>>2]=3,Ee[b>>3]=E),E=+s(16496,M),E<+Ee[b>>3]&&(y[A>>2]=4,Ee[b>>3]=E),E=+s(16520,M),E<+Ee[b>>3]&&(y[A>>2]=5,Ee[b>>3]=E),E=+s(16544,M),E<+Ee[b>>3]&&(y[A>>2]=6,Ee[b>>3]=E),E=+s(16568,M),E<+Ee[b>>3]&&(y[A>>2]=7,Ee[b>>3]=E),E=+s(16592,M),E<+Ee[b>>3]&&(y[A>>2]=8,Ee[b>>3]=E),E=+s(16616,M),E<+Ee[b>>3]&&(y[A>>2]=9,Ee[b>>3]=E),E=+s(16640,M),E<+Ee[b>>3]&&(y[A>>2]=10,Ee[b>>3]=E),E=+s(16664,M),E<+Ee[b>>3]&&(y[A>>2]=11,Ee[b>>3]=E),E=+s(16688,M),E<+Ee[b>>3]&&(y[A>>2]=12,Ee[b>>3]=E),E=+s(16712,M),E<+Ee[b>>3]&&(y[A>>2]=13,Ee[b>>3]=E),E=+s(16736,M),E<+Ee[b>>3]&&(y[A>>2]=14,Ee[b>>3]=E),E=+s(16760,M),E<+Ee[b>>3]&&(y[A>>2]=15,Ee[b>>3]=E),E=+s(16784,M),E<+Ee[b>>3]&&(y[A>>2]=16,Ee[b>>3]=E),E=+s(16808,M),E<+Ee[b>>3]&&(y[A>>2]=17,Ee[b>>3]=E),E=+s(16832,M),E<+Ee[b>>3]&&(y[A>>2]=18,Ee[b>>3]=E),E=+s(16856,M),!(E<+Ee[b>>3])){be=B;return}y[A>>2]=19,Ee[b>>3]=E,be=B}function dl(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0;if(B=+Ch(m),B<1e-16){A=15600+(A<<4)|0,y[M>>2]=y[A>>2],y[M+4>>2]=y[A+4>>2],y[M+8>>2]=y[A+8>>2],y[M+12>>2]=y[A+12>>2];return}if(F=+Ps(+ +Ee[m+8>>3],+ +Ee[m>>3]),(b|0)>0){m=0;do B=B/2.6457513110645907,m=m+1|0;while((m|0)!=(b|0))}E?(B=B/3,b=(wn(b)|0)==0,B=+Kc(+((b?B:B/2.6457513110645907)*.381966011250105))):(B=+Kc(+(B*.381966011250105)),wn(b)|0&&(F=+uc(F+.3334731722518321))),Hg(15600+(A<<4)|0,+uc(+Ee[15920+(A*24|0)>>3]-F),B,M)}function lp(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;E=be,be=be+16|0,M=E,ea(m+4|0,M),dl(M,y[m>>2]|0,A,0,b),be=E}function Of(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0,lr=0,Ai=0,ri=0,ni=0,Wr=0,Vr=0,Gr=0,Vi=0,$r=0;if(Gr=be,be=be+272|0,B=Gr+256|0,at=Gr+240|0,ni=Gr,Wr=Gr+224|0,Vr=Gr+208|0,bt=Gr+176|0,ft=Gr+160|0,ar=Gr+192|0,mr=Gr+144|0,or=Gr+128|0,lr=Gr+112|0,Ai=Gr+96|0,ri=Gr+80|0,y[B>>2]=A,y[at>>2]=y[m>>2],y[at+4>>2]=y[m+4>>2],y[at+8>>2]=y[m+8>>2],y[at+12>>2]=y[m+12>>2],Df(at,B,ni),y[M>>2]=0,at=E+b+((E|0)==5&1)|0,(at|0)<=(b|0)){be=Gr;return}W=y[B>>2]|0,Q=Wr+4|0,he=bt+4|0,we=b+5|0,$e=16880+(W<<2)|0,Qe=16960+(W<<2)|0,Ue=or+8|0,nt=lr+8|0,It=Ai+8|0,wt=Vr+4|0,N=b;e:for(;;){F=ni+(((N|0)%5|0)<<4)|0,y[Vr>>2]=y[F>>2],y[Vr+4>>2]=y[F+4>>2],y[Vr+8>>2]=y[F+8>>2],y[Vr+12>>2]=y[F+12>>2];do;while((pl(Vr,W,0,1)|0)==2);if((N|0)>(b|0)&(wn(A)|0)!=0){if(y[bt>>2]=y[Vr>>2],y[bt+4>>2]=y[Vr+4>>2],y[bt+8>>2]=y[Vr+8>>2],y[bt+12>>2]=y[Vr+12>>2],ea(Q,ft),E=y[bt>>2]|0,B=y[17040+(E*80|0)+(y[Wr>>2]<<2)>>2]|0,y[bt>>2]=y[18640+(E*80|0)+(B*20|0)>>2],F=y[18640+(E*80|0)+(B*20|0)+16>>2]|0,(F|0)>0){m=0;do iu(he),m=m+1|0;while((m|0)<(F|0))}switch(F=18640+(E*80|0)+(B*20|0)+4|0,y[ar>>2]=y[F>>2],y[ar+4>>2]=y[F+4>>2],y[ar+8>>2]=y[F+8>>2],np(ar,(y[$e>>2]|0)*3|0),Qo(he,ar,he),vo(he),ea(he,mr),Vi=+(y[Qe>>2]|0),Ee[or>>3]=Vi*3,Ee[Ue>>3]=0,$r=Vi*-1.5,Ee[lr>>3]=$r,Ee[nt>>3]=Vi*2.598076211353316,Ee[Ai>>3]=$r,Ee[It>>3]=Vi*-2.598076211353316,y[17040+((y[bt>>2]|0)*80|0)+(y[Vr>>2]<<2)>>2]|0){case 1:{m=lr,E=or;break}case 3:{m=Ai,E=lr;break}case 2:{m=or,E=Ai;break}default:{m=12;break e}}Wf(ft,mr,E,m,ri),dl(ri,y[bt>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1}if((N|0)<(we|0)&&(ea(wt,bt),dl(bt,y[Vr>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1),y[Wr>>2]=y[Vr>>2],y[Wr+4>>2]=y[Vr+4>>2],y[Wr+8>>2]=y[Vr+8>>2],y[Wr+12>>2]=y[Vr+12>>2],N=N+1|0,(N|0)>=(at|0)){m=3;break}}if((m|0)==3){be=Gr;return}else(m|0)==12&&Nr(22522,22569,571,22579)}function Df(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0;W=be,be=be+128|0,E=W+64|0,M=W,B=E,F=20240,N=B+60|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));B=M,F=20304,N=B+60|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));N=(wn(y[A>>2]|0)|0)==0,E=N?E:M,M=m+4|0,op(M),Rf(M),wn(y[A>>2]|0)|0&&(fl(M),y[A>>2]=(y[A>>2]|0)+1),y[b>>2]=y[m>>2],A=b+4|0,Qo(M,E,A),vo(A),y[b+16>>2]=y[m>>2],A=b+20|0,Qo(M,E+12|0,A),vo(A),y[b+32>>2]=y[m>>2],A=b+36|0,Qo(M,E+24|0,A),vo(A),y[b+48>>2]=y[m>>2],A=b+52|0,Qo(M,E+36|0,A),vo(A),y[b+64>>2]=y[m>>2],b=b+68|0,Qo(M,E+48|0,b),vo(b),be=W}function pl(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(Ue=be,be=be+32|0,$e=Ue+12|0,N=Ue,Qe=m+4|0,we=y[16960+(A<<2)>>2]|0,he=(E|0)!=0,we=he?we*3|0:we,M=y[Qe>>2]|0,Q=m+8|0,F=y[Q>>2]|0,he){if(B=m+12|0,E=y[B>>2]|0,M=F+M+E|0,(M|0)==(we|0))return Qe=1,be=Ue,Qe|0;W=B}else W=m+12|0,E=y[W>>2]|0,M=F+M+E|0;if((M|0)<=(we|0))return Qe=0,be=Ue,Qe|0;do if((E|0)>0){if(E=y[m>>2]|0,(F|0)>0){B=18640+(E*80|0)+60|0,E=m;break}E=18640+(E*80|0)+40|0,b?(Cf($e,we,0,0),Sf(Qe,$e,N),nc(N),Qo(N,$e,Qe),B=E,E=m):(B=E,E=m)}else B=18640+((y[m>>2]|0)*80|0)+20|0,E=m;while(!1);if(y[E>>2]=y[B>>2],M=B+16|0,(y[M>>2]|0)>0){E=0;do iu(Qe),E=E+1|0;while((E|0)<(y[M>>2]|0))}return m=B+4|0,y[$e>>2]=y[m>>2],y[$e+4>>2]=y[m+4>>2],y[$e+8>>2]=y[m+8>>2],A=y[16880+(A<<2)>>2]|0,np($e,he?A*3|0:A),Qo(Qe,$e,Qe),vo(Qe),he?E=((y[Q>>2]|0)+(y[Qe>>2]|0)+(y[W>>2]|0)|0)==(we|0)?1:2:E=2,Qe=E,be=Ue,Qe|0}function su(m,A){m=m|0,A=A|0;var b=0;do b=pl(m,A,0,1)|0;while((b|0)==2);return b|0}function Va(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0,lr=0,Ai=0,ri=0,ni=0;if(Ai=be,be=be+240|0,B=Ai+224|0,ar=Ai+208|0,mr=Ai,or=Ai+192|0,lr=Ai+176|0,It=Ai+160|0,wt=Ai+144|0,at=Ai+128|0,bt=Ai+112|0,ft=Ai+96|0,y[B>>2]=A,y[ar>>2]=y[m>>2],y[ar+4>>2]=y[m+4>>2],y[ar+8>>2]=y[m+8>>2],y[ar+12>>2]=y[m+12>>2],cp(ar,B,mr),y[M>>2]=0,nt=E+b+((E|0)==6&1)|0,(nt|0)<=(b|0)){be=Ai;return}W=y[B>>2]|0,Q=b+6|0,he=16960+(W<<2)|0,we=wt+8|0,$e=at+8|0,Qe=bt+8|0,Ue=or+4|0,F=0,N=b,E=-1;e:for(;;){if(B=(N|0)%6|0,m=mr+(B<<4)|0,y[or>>2]=y[m>>2],y[or+4>>2]=y[m+4>>2],y[or+8>>2]=y[m+8>>2],y[or+12>>2]=y[m+12>>2],m=F,F=pl(or,W,0,1)|0,(N|0)>(b|0)&(wn(A)|0)!=0&&(m|0)!=1&&(y[or>>2]|0)!=(E|0)){switch(ea(mr+(((B+5|0)%6|0)<<4)+4|0,lr),ea(mr+(B<<4)+4|0,It),ri=+(y[he>>2]|0),Ee[wt>>3]=ri*3,Ee[we>>3]=0,ni=ri*-1.5,Ee[at>>3]=ni,Ee[$e>>3]=ri*2.598076211353316,Ee[bt>>3]=ni,Ee[Qe>>3]=ri*-2.598076211353316,B=y[ar>>2]|0,y[17040+(B*80|0)+(((E|0)==(B|0)?y[or>>2]|0:E)<<2)>>2]|0){case 1:{m=at,E=wt;break}case 3:{m=bt,E=at;break}case 2:{m=wt,E=bt;break}default:{m=8;break e}}Wf(lr,It,E,m,ft),!(C(lr,ft)|0)&&!(C(It,ft)|0)&&(dl(ft,y[ar>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1)}if((N|0)<(Q|0)&&(ea(Ue,lr),dl(lr,y[or>>2]|0,W,1,M+8+(y[M>>2]<<4)|0),y[M>>2]=(y[M>>2]|0)+1),N=N+1|0,(N|0)>=(nt|0)){m=3;break}else E=y[or>>2]|0}if((m|0)==3){be=Ai;return}else(m|0)==8&&Nr(22606,22569,736,22651)}function cp(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0;W=be,be=be+160|0,E=W+80|0,M=W,B=E,F=20368,N=B+72|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));B=M,F=20448,N=B+72|0;do y[B>>2]=y[F>>2],B=B+4|0,F=F+4|0;while((B|0)<(N|0));N=(wn(y[A>>2]|0)|0)==0,E=N?E:M,M=m+4|0,op(M),Rf(M),wn(y[A>>2]|0)|0&&(fl(M),y[A>>2]=(y[A>>2]|0)+1),y[b>>2]=y[m>>2],A=b+4|0,Qo(M,E,A),vo(A),y[b+16>>2]=y[m>>2],A=b+20|0,Qo(M,E+12|0,A),vo(A),y[b+32>>2]=y[m>>2],A=b+36|0,Qo(M,E+24|0,A),vo(A),y[b+48>>2]=y[m>>2],A=b+52|0,Qo(M,E+36|0,A),vo(A),y[b+64>>2]=y[m>>2],A=b+68|0,Qo(M,E+48|0,A),vo(A),y[b+80>>2]=y[m>>2],b=b+84|0,Qo(M,E+60|0,b),vo(b),be=W}function h0(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,52)|0,Me()|0,A&15|0}function up(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,45)|0,Me()|0,A&127|0}function Ff(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0;if(!(!0&(A&-16777216|0)==134217728)||(F=mt(m|0,A|0,45)|0,Me()|0,F=F&127,F>>>0>121))return A=0,A|0;b=mt(m|0,A|0,52)|0,Me()|0,b=b&15;do if(b|0){for(M=1,E=0;;){if(B=mt(m|0,A|0,(15-M|0)*3|0)|0,Me()|0,B=B&7,(B|0)!=0&(E^1))if((B|0)==1&(_i(F)|0)!=0){N=0,E=13;break}else E=1;if((B|0)==7){N=0,E=13;break}if(M>>>0<b>>>0)M=M+1|0;else{E=9;break}}if((E|0)==9){if((b|0)==15)N=1;else break;return N|0}else if((E|0)==13)return N|0}while(!1);for(;;){if(N=mt(m|0,A|0,(14-b|0)*3|0)|0,Me()|0,!((N&7|0)==7&!0)){N=0,E=13;break}if(b>>>0<14)b=b+1|0;else{N=1,E=13;break}}return(E|0)==13?N|0:0}function kf(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;if(B=mt(m|0,A|0,52)|0,Me()|0,B=B&15,b>>>0>15)return E=4,E|0;if((B|0)<(b|0))return E=12,E|0;if((B|0)==(b|0))return y[E>>2]=m,y[E+4>>2]=A,E=0,E|0;if(M=Nt(b|0,0,52)|0,M=M|m,m=Me()|0|A&-15728641,(B|0)>(b|0))do A=Nt(7,0,(14-b|0)*3|0)|0,b=b+1|0,M=A|M,m=Me()|0|m;while((b|0)<(B|0));return y[E>>2]=M,y[E+4>>2]=m,E=0,E|0}function ja(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0;if(B=mt(m|0,A|0,52)|0,Me()|0,B=B&15,!((b|0)<16&(B|0)<=(b|0)))return E=4,E|0;M=b-B|0,b=mt(m|0,A|0,45)|0,Me()|0;e:do if(!(_i(b&127)|0))b=wo(7,0,M,((M|0)<0)<<31>>31)|0,M=Me()|0;else{t:do if(B|0){for(b=1;F=Nt(7,0,(15-b|0)*3|0)|0,!!((F&m|0)==0&((Me()|0)&A|0)==0);)if(b>>>0<B>>>0)b=b+1|0;else break t;b=wo(7,0,M,((M|0)<0)<<31>>31)|0,M=Me()|0;break e}while(!1);b=wo(7,0,M,((M|0)<0)<<31>>31)|0,b=Tt(b|0,Me()|0,5,0)|0,b=Ge(b|0,Me()|0,-5,-1)|0,b=Pt(b|0,Me()|0,6,0)|0,b=Ge(b|0,Me()|0,1,0)|0,M=Me()|0}while(!1);return F=E,y[F>>2]=b,y[F+4>>2]=M,F=0,F|0}function Hi(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;if(M=mt(m|0,A|0,45)|0,Me()|0,!(_i(M&127)|0))return M=0,M|0;M=mt(m|0,A|0,52)|0,Me()|0,M=M&15;e:do if(!M)b=0;else for(E=1;;){if(b=mt(m|0,A|0,(15-E|0)*3|0)|0,Me()|0,b=b&7,b|0)break e;if(E>>>0<M>>>0)E=E+1|0;else{b=0;break}}while(!1);return M=(b|0)==0&1,M|0}function No(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0;if(F=be,be=be+16|0,B=F,fp(B,m,A,b),A=B,m=y[A>>2]|0,A=y[A+4>>2]|0,(m|0)==0&(A|0)==0)return be=F,0;M=0,b=0;do N=E+(M<<3)|0,y[N>>2]=m,y[N+4>>2]=A,M=Ge(M|0,b|0,1,0)|0,b=Me()|0,p0(B),N=B,m=y[N>>2]|0,A=y[N+4>>2]|0;while(!((m|0)==0&(A|0)==0));return be=F,0}function au(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,(E|0)<(b|0)?(b=A,E=m,Kr(b|0),E|0):(b=Nt(-1,-1,((E-b|0)*3|0)+3|0)|0,E=Nt(~b|0,~(Me()|0)|0,(15-E|0)*3|0)|0,b=~(Me()|0)&A,E=~E&m,Kr(b|0),E|0)}function Us(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0;return M=mt(m|0,A|0,52)|0,Me()|0,M=M&15,(b|0)<16&(M|0)<=(b|0)?((M|0)<(b|0)&&(M=Nt(-1,-1,((b+-1-M|0)*3|0)+3|0)|0,M=Nt(~M|0,~(Me()|0)|0,(15-b|0)*3|0)|0,A=~(Me()|0)&A,m=~M&m),M=Nt(b|0,0,52)|0,b=A&-15728641|(Me()|0),y[E>>2]=m|M,y[E+4>>2]=b,E=0,E|0):(E=4,E|0)}function Ea(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0,lr=0;if((b|0)==0&(E|0)==0)return or=0,or|0;if(M=m,B=y[M>>2]|0,M=y[M+4>>2]|0,!0&(M&15728640|0)==0){if(!((E|0)>0|(E|0)==0&b>>>0>0)||(or=A,y[or>>2]=B,y[or+4>>2]=M,(b|0)==1&(E|0)==0))return or=0,or|0;M=1;do ar=m+(M<<3)|0,mr=y[ar+4>>2]|0,or=A+(M<<3)|0,y[or>>2]=y[ar>>2],y[or+4>>2]=mr,M=M+1|0;while(0<(E|0)|(E|0)==0&M>>>0<b>>>0);return M=0,M|0}if(ft=b<<3,mr=Ve(ft)|0,!mr)return or=13,or|0;if(Zi(mr|0,m|0,ft|0)|0,ar=qe(b,8)|0,!ar)return Be(mr),or=13,or|0;e:do if(b|0){t:for(;;){M=mr,wt=y[M>>2]|0,M=y[M+4>>2]|0,at=mt(wt|0,M|0,52)|0,Me()|0,at=at&15,bt=at+-1|0,It=(b|0)>0;r:do if((at|0)!=0&It){if(Qe=((b|0)<0)<<31>>31,Ue=Nt(bt|0,0,52)|0,nt=Me()|0,bt>>>0>15){if(!((wt|0)==0&(M|0)==0)){or=17;break t}for(B=0;;){if(B=B+1|0,(B|0)>=(b|0))break r;if(E=mr+(B<<3)|0,nt=y[E>>2]|0,E=y[E+4>>2]|0,!((nt|0)==0&(E|0)==0)){M=E,or=17;break t}}}for(B=0,m=wt,E=M;;){if(!((m|0)==0&(E|0)==0)){if(!(!0&(E&117440512|0)==0)){or=22;break t}if(N=mt(m|0,E|0,52)|0,Me()|0,N=N&15,(N|0)<(bt|0)){M=12,or=28;break t}if((N|0)!=(bt|0)&&(m=m|Ue,E=E&-15728641|nt,N>>>0>=at>>>0)){F=bt;do $e=Nt(7,0,(14-F|0)*3|0)|0,F=F+1|0,m=$e|m,E=Me()|0|E;while(F>>>0<N>>>0)}if(F=Kt(m|0,E|0,b|0,Qe|0)|0,Me()|0,Q=ar+(F<<3)|0,N=Q,W=y[N>>2]|0,N=y[N+4>>2]|0,(W|0)==0&(N|0)==0)F=Q;else for($e=0;;){if(($e|0)>(b|0)){or=32;break t}if((W|0)==(m|0)&(N&-117440513|0)==(E|0)){he=mt(W|0,N|0,56)|0,Me()|0,he=he&7,we=he+1|0,lr=mt(W|0,N|0,45)|0,Me()|0;i:do if(!(_i(lr&127)|0))N=7;else{if(W=mt(W|0,N|0,52)|0,Me()|0,W=W&15,!W){N=6;break}for(N=1;;){if(lr=Nt(7,0,(15-N|0)*3|0)|0,!((lr&m|0)==0&((Me()|0)&E|0)==0)){N=7;break i}if(N>>>0<W>>>0)N=N+1|0;else{N=6;break}}}while(!1);if((he+2|0)>>>0>N>>>0){or=42;break t}lr=Nt(we|0,0,56)|0,E=Me()|0|E&-117440513,we=Q,y[we>>2]=0,y[we+4>>2]=0,m=lr|m}else F=(F+1|0)%(b|0)|0;if(Q=ar+(F<<3)|0,N=Q,W=y[N>>2]|0,N=y[N+4>>2]|0,(W|0)==0&(N|0)==0){F=Q;break}else $e=$e+1|0}lr=F,y[lr>>2]=m,y[lr+4>>2]=E}if(B=B+1|0,(B|0)>=(b|0))break r;E=mr+(B<<3)|0,m=y[E>>2]|0,E=y[E+4>>2]|0}}while(!1);if((b+5|0)>>>0<11){or=85;break}if(nt=qe((b|0)/6|0,8)|0,!nt){or=49;break}r:do if(It){$e=0,we=0;do{if(N=ar+($e<<3)|0,E=N,B=y[E>>2]|0,E=y[E+4>>2]|0,!((B|0)==0&(E|0)==0)){W=mt(B|0,E|0,56)|0,Me()|0,W=W&7,m=W+1|0,Q=E&-117440513,lr=mt(B|0,E|0,45)|0,Me()|0;i:do if(_i(lr&127)|0){if(he=mt(B|0,E|0,52)|0,Me()|0,he=he&15,he|0)for(F=1;;){if(lr=Nt(7,0,(15-F|0)*3|0)|0,!((B&lr|0)==0&(Q&(Me()|0)|0)==0))break i;if(F>>>0<he>>>0)F=F+1|0;else break}E=Nt(m|0,0,56)|0,B=E|B,E=Me()|0|Q,m=N,y[m>>2]=B,y[m+4>>2]=E,m=W+2|0}while(!1);(m|0)==7&&(lr=nt+(we<<3)|0,y[lr>>2]=B,y[lr+4>>2]=E&-117440513,we=we+1|0)}$e=$e+1|0}while(($e|0)!=(b|0));if(It){if($e=((b|0)<0)<<31>>31,Qe=Nt(bt|0,0,52)|0,Ue=Me()|0,bt>>>0>15){if(!((wt|0)==0&(M|0)==0)){M=4,or=84;break t}for(M=0;;){if(M=M+1|0,(M|0)>=(b|0)){B=0,M=we;break r}if(lr=mr+(M<<3)|0,!((y[lr>>2]|0)==0&(y[lr+4>>2]|0)==0)){M=4,or=84;break t}}}for(he=0,B=0,Q=wt;;){do if(!((Q|0)==0&(M|0)==0)){if(N=mt(Q|0,M|0,52)|0,Me()|0,N=N&15,(N|0)<(bt|0)){M=12,or=84;break t}do if((N|0)==(bt|0))E=Q,N=M;else{if(E=Q|Qe,m=M&-15728641|Ue,N>>>0<at>>>0){N=m;break}F=bt;do lr=Nt(7,0,(14-F|0)*3|0)|0,F=F+1|0,E=lr|E,m=Me()|0|m;while(F>>>0<N>>>0);N=m}while(!1);for(F=Kt(E|0,N|0,b|0,$e|0)|0,Me()|0,m=0;;){if((m|0)>(b|0)){or=77;break t}if(lr=ar+(F<<3)|0,W=y[lr+4>>2]|0,(W&-117440513|0)==(N|0)&&(y[lr>>2]|0)==(E|0)){or=79;break}if(F=(F+1|0)%(b|0)|0,lr=ar+(F<<3)|0,(y[lr>>2]|0)==(E|0)&&(y[lr+4>>2]|0)==(N|0))break;m=m+1|0}if((or|0)==79&&(or=0,!0&(W&117440512|0)==100663296))break;lr=A+(B<<3)|0,y[lr>>2]=Q,y[lr+4>>2]=M,B=B+1|0}while(!1);if(M=he+1|0,(M|0)>=(b|0)){M=we;break r}lr=mr+(M<<3)|0,he=M,Q=y[lr>>2]|0,M=y[lr+4>>2]|0}}else B=0,M=we}else B=0,M=0;while(!1);if(Ui(ar|0,0,ft|0)|0,Zi(mr|0,nt|0,M<<3|0)|0,Be(nt),M)A=A+(B<<3)|0,b=M;else break e}if((or|0)==17)!0&(M&117440512|0)==0?(M=4,or=28):or=22;else if((or|0)==32)Nr(23313,22674,362,22684);else{if((or|0)==42)return Be(mr),Be(ar),lr=10,lr|0;if((or|0)==49)return Be(mr),Be(ar),lr=13,lr|0;if((or|0)==77)Nr(23313,22674,462,22684);else{if((or|0)==84)return Be(nt),Be(mr),Be(ar),lr=M,lr|0;if((or|0)==85){Zi(A|0,mr|0,b<<3|0)|0;break}}}if((or|0)==22)return Be(mr),Be(ar),lr=5,lr|0;if((or|0)==28)return Be(mr),Be(ar),lr=M,lr|0}while(!1);return Be(mr),Be(ar),lr=0,lr|0}function f0(m,A,b,E,M,B,F){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0,F=F|0;var N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0;if(nt=be,be=be+16|0,Ue=nt,!((b|0)>0|(b|0)==0&A>>>0>0))return Ue=0,be=nt,Ue|0;if((F|0)>=16)return Ue=12,be=nt,Ue|0;$e=0,Qe=0,we=0,N=0;e:for(;;){if(Q=m+($e<<3)|0,W=y[Q>>2]|0,Q=y[Q+4>>2]|0,he=mt(W|0,Q|0,52)|0,Me()|0,(he&15|0)>(F|0)){N=12,W=11;break}if(fp(Ue,W,Q,F),he=Ue,Q=y[he>>2]|0,he=y[he+4>>2]|0,(Q|0)==0&(he|0)==0)W=we;else{W=we;do{if(!((N|0)<(B|0)|(N|0)==(B|0)&W>>>0<M>>>0)){W=10;break e}we=E+(W<<3)|0,y[we>>2]=Q,y[we+4>>2]=he,W=Ge(W|0,N|0,1,0)|0,N=Me()|0,p0(Ue),we=Ue,Q=y[we>>2]|0,he=y[we+4>>2]|0}while(!((Q|0)==0&(he|0)==0))}if($e=Ge($e|0,Qe|0,1,0)|0,Qe=Me()|0,(Qe|0)<(b|0)|(Qe|0)==(b|0)&$e>>>0<A>>>0)we=W;else{N=0,W=11;break}}return(W|0)==10?(Ue=14,be=nt,Ue|0):(W|0)==11?(be=nt,N|0):0}function ds(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0;$e=be,be=be+16|0,we=$e;e:do if((b|0)>0|(b|0)==0&A>>>0>0){for(Q=0,F=0,B=0,he=0;;){if(W=m+(Q<<3)|0,N=y[W>>2]|0,W=y[W+4>>2]|0,!((N|0)==0&(W|0)==0)&&(W=(ja(N,W,E,we)|0)==0,N=we,F=Ge(y[N>>2]|0,y[N+4>>2]|0,F|0,B|0)|0,B=Me()|0,!W)){B=12;break}if(Q=Ge(Q|0,he|0,1,0)|0,he=Me()|0,!((he|0)<(b|0)|(he|0)==(b|0)&Q>>>0<A>>>0))break e}return be=$e,B|0}else F=0,B=0;while(!1);return y[M>>2]=F,y[M+4>>2]=B,M=0,be=$e,M|0}function cc(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,52)|0,Me()|0,A&1|0}function zo(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;if(M=mt(m|0,A|0,52)|0,Me()|0,M=M&15,!M)return M=0,M|0;for(E=1;;){if(b=mt(m|0,A|0,(15-E|0)*3|0)|0,Me()|0,b=b&7,b|0){E=5;break}if(E>>>0<M>>>0)E=E+1|0;else{b=0,E=5;break}}return(E|0)==5?b|0:0}function hp(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(W=mt(m|0,A|0,52)|0,Me()|0,W=W&15,!W)return N=A,W=m,Kr(N|0),W|0;for(N=1,b=0;;){B=(15-N|0)*3|0,E=Nt(7,0,B|0)|0,M=Me()|0,F=mt(m|0,A|0,B|0)|0,Me()|0,B=Nt(oc(F&7)|0,0,B|0)|0,F=Me()|0,m=B|m&~E,A=F|A&~M;e:do if(!b)if((B&E|0)==0&(F&M|0)==0)b=0;else if(E=mt(m|0,A|0,52)|0,Me()|0,E=E&15,!E)b=1;else{b=1;t:for(;;){switch(F=mt(m|0,A|0,(15-b|0)*3|0)|0,Me()|0,F&7){case 1:break t;case 0:break;default:{b=1;break e}}if(b>>>0<E>>>0)b=b+1|0;else{b=1;break e}}for(b=1;;)if(F=(15-b|0)*3|0,M=mt(m|0,A|0,F|0)|0,Me()|0,B=Nt(7,0,F|0)|0,A=A&~(Me()|0),F=Nt(oc(M&7)|0,0,F|0)|0,m=m&~B|F,A=A|(Me()|0),b>>>0<E>>>0)b=b+1|0;else{b=1;break}}while(!1);if(N>>>0<W>>>0)N=N+1|0;else break}return Kr(A|0),m|0}function Ga(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0;if(E=mt(m|0,A|0,52)|0,Me()|0,E=E&15,!E)return b=A,E=m,Kr(b|0),E|0;for(b=1;B=(15-b|0)*3|0,F=mt(m|0,A|0,B|0)|0,Me()|0,M=Nt(7,0,B|0)|0,A=A&~(Me()|0),B=Nt(oc(F&7)|0,0,B|0)|0,m=B|m&~M,A=Me()|0|A,b>>>0<E>>>0;)b=b+1|0;return Kr(A|0),m|0}function jg(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(W=mt(m|0,A|0,52)|0,Me()|0,W=W&15,!W)return N=A,W=m,Kr(N|0),W|0;for(N=1,b=0;;){B=(15-N|0)*3|0,E=Nt(7,0,B|0)|0,M=Me()|0,F=mt(m|0,A|0,B|0)|0,Me()|0,B=Nt(Ta(F&7)|0,0,B|0)|0,F=Me()|0,m=B|m&~E,A=F|A&~M;e:do if(!b)if((B&E|0)==0&(F&M|0)==0)b=0;else if(E=mt(m|0,A|0,52)|0,Me()|0,E=E&15,!E)b=1;else{b=1;t:for(;;){switch(F=mt(m|0,A|0,(15-b|0)*3|0)|0,Me()|0,F&7){case 1:break t;case 0:break;default:{b=1;break e}}if(b>>>0<E>>>0)b=b+1|0;else{b=1;break e}}for(b=1;;)if(M=(15-b|0)*3|0,B=Nt(7,0,M|0)|0,F=A&~(Me()|0),A=mt(m|0,A|0,M|0)|0,Me()|0,A=Nt(Ta(A&7)|0,0,M|0)|0,m=m&~B|A,A=F|(Me()|0),b>>>0<E>>>0)b=b+1|0;else{b=1;break}}while(!1);if(N>>>0<W>>>0)N=N+1|0;else break}return Kr(A|0),m|0}function Al(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0;if(E=mt(m|0,A|0,52)|0,Me()|0,E=E&15,!E)return b=A,E=m,Kr(b|0),E|0;for(b=1;F=(15-b|0)*3|0,B=Nt(7,0,F|0)|0,M=A&~(Me()|0),A=mt(m|0,A|0,F|0)|0,Me()|0,A=Nt(Ta(A&7)|0,0,F|0)|0,m=A|m&~B,A=Me()|0|M,b>>>0<E>>>0;)b=b+1|0;return Kr(A|0),m|0}function yh(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0;if(W=be,be=be+64|0,N=W+40|0,E=W+24|0,M=W+12|0,B=W,Nt(A|0,0,52)|0,b=Me()|0|134225919,!A)return(y[m+4>>2]|0)>2||(y[m+8>>2]|0)>2||(y[m+12>>2]|0)>2?(F=0,N=0,Kr(F|0),be=W,N|0):(Nt(ep(m)|0,0,45)|0,F=Me()|0|b,N=-1,Kr(F|0),be=W,N|0);if(y[N>>2]=y[m>>2],y[N+4>>2]=y[m+4>>2],y[N+8>>2]=y[m+8>>2],y[N+12>>2]=y[m+12>>2],F=N+4|0,(A|0)>0)for(m=-1;y[E>>2]=y[F>>2],y[E+4>>2]=y[F+4>>2],y[E+8>>2]=y[F+8>>2],A&1?(Mf(F),y[M>>2]=y[F>>2],y[M+4>>2]=y[F+4>>2],y[M+8>>2]=y[F+8>>2],ru(M)):(Pf(F),y[M>>2]=y[F>>2],y[M+4>>2]=y[F+4>>2],y[M+8>>2]=y[F+8>>2],fl(M)),Sf(E,M,B),vo(B),he=(15-A|0)*3|0,Q=Nt(7,0,he|0)|0,b=b&~(Me()|0),he=Nt(If(B)|0,0,he|0)|0,m=he|m&~Q,b=Me()|0|b,(A|0)>1;)A=A+-1|0;else m=-1;e:do if((y[F>>2]|0)<=2&&(y[N+8>>2]|0)<=2&&(y[N+12>>2]|0)<=2){if(E=ep(N)|0,A=Nt(E|0,0,45)|0,A=A|m,m=Me()|0|b&-1040385,B=tp(N)|0,!(_i(E)|0)){if((B|0)<=0)break;for(M=0;;){if(E=mt(A|0,m|0,52)|0,Me()|0,E=E&15,E)for(b=1;he=(15-b|0)*3|0,N=mt(A|0,m|0,he|0)|0,Me()|0,Q=Nt(7,0,he|0)|0,m=m&~(Me()|0),he=Nt(oc(N&7)|0,0,he|0)|0,A=A&~Q|he,m=m|(Me()|0),b>>>0<E>>>0;)b=b+1|0;if(M=M+1|0,(M|0)==(B|0))break e}}M=mt(A|0,m|0,52)|0,Me()|0,M=M&15;t:do if(M){b=1;r:for(;;){switch(he=mt(A|0,m|0,(15-b|0)*3|0)|0,Me()|0,he&7){case 1:break r;case 0:break;default:break t}if(b>>>0<M>>>0)b=b+1|0;else break t}if(ph(E,y[N>>2]|0)|0)for(b=1;N=(15-b|0)*3|0,Q=Nt(7,0,N|0)|0,he=m&~(Me()|0),m=mt(A|0,m|0,N|0)|0,Me()|0,m=Nt(Ta(m&7)|0,0,N|0)|0,A=A&~Q|m,m=he|(Me()|0),b>>>0<M>>>0;)b=b+1|0;else for(b=1;he=(15-b|0)*3|0,N=mt(A|0,m|0,he|0)|0,Me()|0,Q=Nt(7,0,he|0)|0,m=m&~(Me()|0),he=Nt(oc(N&7)|0,0,he|0)|0,A=A&~Q|he,m=m|(Me()|0),b>>>0<M>>>0;)b=b+1|0}while(!1);if((B|0)>0){b=0;do A=hp(A,m)|0,m=Me()|0,b=b+1|0;while((b|0)!=(B|0))}}else A=0,m=0;while(!1);return Q=m,he=A,Kr(Q|0),be=W,he|0}function wn(m){return m=m|0,(m|0)%2|0|0}function ur(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;return M=be,be=be+16|0,E=M,A>>>0>15?(E=4,be=M,E|0):(y[m+4>>2]&2146435072|0)==2146435072||(y[m+8+4>>2]&2146435072|0)==2146435072?(E=3,be=M,E|0):(ap(m,A,E),A=yh(E,A)|0,E=Me()|0,y[b>>2]=A,y[b+4>>2]=E,(A|0)==0&(E|0)==0&&Nr(23313,22674,786,22697),E=0,be=M,E|0)}function Nf(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;if(M=b+4|0,B=mt(m|0,A|0,52)|0,Me()|0,B=B&15,F=mt(m|0,A|0,45)|0,Me()|0,E=(B|0)==0,_i(F&127)|0){if(E)return F=1,F|0;E=1}else{if(E)return F=0,F|0;!(y[M>>2]|0)&&!(y[b+8>>2]|0)?E=(y[b+12>>2]|0)!=0&1:E=1}for(b=1;b&1?ru(M):fl(M),F=mt(m|0,A|0,(15-b|0)*3|0)|0,Me()|0,mh(M,F&7),b>>>0<B>>>0;)b=b+1|0;return E|0}function ta(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0;if(he=be,be=be+16|0,W=he,Q=mt(m|0,A|0,45)|0,Me()|0,Q=Q&127,Q>>>0>121)return y[b>>2]=0,y[b+4>>2]=0,y[b+8>>2]=0,y[b+12>>2]=0,Q=5,be=he,Q|0;e:do if(_i(Q)|0&&(B=mt(m|0,A|0,52)|0,Me()|0,B=B&15,(B|0)!=0)){E=1;t:for(;;){switch(N=mt(m|0,A|0,(15-E|0)*3|0)|0,Me()|0,N&7){case 5:break t;case 0:break;default:{E=A;break e}}if(E>>>0<B>>>0)E=E+1|0;else{E=A;break e}}for(M=1,E=A;A=(15-M|0)*3|0,F=Nt(7,0,A|0)|0,N=E&~(Me()|0),E=mt(m|0,E|0,A|0)|0,Me()|0,E=Nt(Ta(E&7)|0,0,A|0)|0,m=m&~F|E,E=N|(Me()|0),M>>>0<B>>>0;)M=M+1|0}else E=A;while(!1);if(N=7696+(Q*28|0)|0,y[b>>2]=y[N>>2],y[b+4>>2]=y[N+4>>2],y[b+8>>2]=y[N+8>>2],y[b+12>>2]=y[N+12>>2],!(Nf(m,E,b)|0))return Q=0,be=he,Q|0;if(F=b+4|0,y[W>>2]=y[F>>2],y[W+4>>2]=y[F+4>>2],y[W+8>>2]=y[F+8>>2],B=mt(m|0,E|0,52)|0,Me()|0,N=B&15,B&1?(fl(F),B=N+1|0):B=N,!(_i(Q)|0))E=0;else{e:do if(!N)E=0;else for(A=1;;){if(M=mt(m|0,E|0,(15-A|0)*3|0)|0,Me()|0,M=M&7,M|0){E=M;break e}if(A>>>0<N>>>0)A=A+1|0;else{E=0;break}}while(!1);E=(E|0)==4&1}if(!(pl(b,B,E,0)|0))(B|0)!=(N|0)&&(y[F>>2]=y[W>>2],y[F+4>>2]=y[W+4>>2],y[F+8>>2]=y[W+8>>2]);else{if(_i(Q)|0)do;while(pl(b,B,0,0)|0);(B|0)!=(N|0)&&Pf(F)}return Q=0,be=he,Q|0}function lu(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;return B=be,be=be+16|0,E=B,M=ta(m,A,E)|0,M|0?(be=B,M|0):(M=mt(m|0,A|0,52)|0,Me()|0,lp(E,M&15,b),M=0,be=B,M|0)}function ra(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0;if(F=be,be=be+16|0,B=F,E=ta(m,A,B)|0,E|0)return B=E,be=F,B|0;E=mt(m|0,A|0,45)|0,Me()|0,E=(_i(E&127)|0)==0,M=mt(m|0,A|0,52)|0,Me()|0,M=M&15;e:do if(!E){if(M|0)for(E=1;;){if(N=Nt(7,0,(15-E|0)*3|0)|0,!((N&m|0)==0&((Me()|0)&A|0)==0))break e;if(E>>>0<M>>>0)E=E+1|0;else break}return Of(B,M,0,5,b),N=0,be=F,N|0}while(!1);return Va(B,M,0,6,b),N=0,be=F,N|0}function ml(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(M=mt(m|0,A|0,45)|0,Me()|0,!(_i(M&127)|0))return M=2,y[b>>2]=M,0;if(M=mt(m|0,A|0,52)|0,Me()|0,M=M&15,!M)return M=5,y[b>>2]=M,0;for(E=1;;){if(B=Nt(7,0,(15-E|0)*3|0)|0,!((B&m|0)==0&((Me()|0)&A|0)==0)){E=2,m=6;break}if(E>>>0<M>>>0)E=E+1|0;else{E=5,m=6;break}}return(m|0)==6&&(y[b>>2]=E),0}function zf(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0;we=be,be=be+128|0,Q=we+112|0,B=we+96|0,he=we,M=mt(m|0,A|0,52)|0,Me()|0,N=M&15,y[Q>>2]=N,F=mt(m|0,A|0,45)|0,Me()|0,F=F&127;e:do if(_i(F)|0){if(N|0)for(E=1;;){if(W=Nt(7,0,(15-E|0)*3|0)|0,!((W&m|0)==0&((Me()|0)&A|0)==0)){M=0;break e}if(E>>>0<N>>>0)E=E+1|0;else break}if(M&1)M=1;else return W=Nt(N+1|0,0,52)|0,he=Me()|0|A&-15728641,Q=Nt(7,0,(14-N|0)*3|0)|0,he=zf((W|m)&~Q,he&~(Me()|0),b)|0,be=we,he|0}else M=0;while(!1);if(E=ta(m,A,B)|0,!E){M?(Df(B,Q,he),W=5):(cp(B,Q,he),W=6);e:do if(_i(F)|0)if(!N)m=5;else for(E=1;;){if(F=Nt(7,0,(15-E|0)*3|0)|0,!((F&m|0)==0&((Me()|0)&A|0)==0)){m=2;break e}if(E>>>0<N>>>0)E=E+1|0;else{m=5;break}}else m=2;while(!1);Ui(b|0,-1,m<<2|0)|0;e:do if(M)for(B=0;;){if(F=he+(B<<4)|0,su(F,y[Q>>2]|0)|0,F=y[F>>2]|0,N=y[b>>2]|0,(N|0)==-1|(N|0)==(F|0))E=b;else{M=0;do{if(M=M+1|0,M>>>0>=m>>>0){E=1;break e}E=b+(M<<2)|0,N=y[E>>2]|0}while(!((N|0)==-1|(N|0)==(F|0)))}if(y[E>>2]=F,B=B+1|0,B>>>0>=W>>>0){E=0;break}}else for(B=0;;){if(F=he+(B<<4)|0,pl(F,y[Q>>2]|0,0,1)|0,F=y[F>>2]|0,N=y[b>>2]|0,(N|0)==-1|(N|0)==(F|0))E=b;else{M=0;do{if(M=M+1|0,M>>>0>=m>>>0){E=1;break e}E=b+(M<<2)|0,N=y[E>>2]|0}while(!((N|0)==-1|(N|0)==(F|0)))}if(y[E>>2]=F,B=B+1|0,B>>>0>=W>>>0){E=0;break}}while(!1)}return he=E,be=we,he|0}function li(){return 12}function cu(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(m>>>0>15)return N=4,N|0;if(Nt(m|0,0,52)|0,N=Me()|0|134225919,!m){b=0,E=0;do _i(E)|0&&(Nt(E|0,0,45)|0,F=N|(Me()|0),m=A+(b<<3)|0,y[m>>2]=-1,y[m+4>>2]=F,b=b+1|0),E=E+1|0;while((E|0)!=122);return b=0,b|0}b=0,F=0;do{if(_i(F)|0){for(Nt(F|0,0,45)|0,E=1,M=-1,B=N|(Me()|0);W=Nt(7,0,(15-E|0)*3|0)|0,M=M&~W,B=B&~(Me()|0),(E|0)!=(m|0);)E=E+1|0;W=A+(b<<3)|0,y[W>>2]=M,y[W+4>>2]=B,b=b+1|0}F=F+1|0}while((F|0)!=122);return b=0,b|0}function d0(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0;if(at=be,be=be+16|0,It=at,wt=mt(m|0,A|0,52)|0,Me()|0,wt=wt&15,b>>>0>15)return wt=4,be=at,wt|0;if((wt|0)<(b|0))return wt=12,be=at,wt|0;if((wt|0)!=(b|0))if(B=Nt(b|0,0,52)|0,B=B|m,N=Me()|0|A&-15728641,(wt|0)>(b|0)){W=b;do nt=Nt(7,0,(14-W|0)*3|0)|0,W=W+1|0,B=nt|B,N=Me()|0|N;while((W|0)<(wt|0));nt=B}else nt=B;else nt=m,N=A;Ue=mt(nt|0,N|0,45)|0,Me()|0;e:do if(_i(Ue&127)|0){if(W=mt(nt|0,N|0,52)|0,Me()|0,W=W&15,W|0)for(B=1;;){if(Ue=Nt(7,0,(15-B|0)*3|0)|0,!((Ue&nt|0)==0&((Me()|0)&N|0)==0)){Q=33;break e}if(B>>>0<W>>>0)B=B+1|0;else break}if(Ue=E,y[Ue>>2]=0,y[Ue+4>>2]=0,(wt|0)>(b|0)){for(Ue=A&-15728641,Qe=wt;;){if($e=Qe,Qe=Qe+-1|0,Qe>>>0>15|(wt|0)<(Qe|0)){Q=19;break}if((wt|0)!=(Qe|0))if(B=Nt(Qe|0,0,52)|0,B=B|m,W=Me()|0|Ue,(wt|0)<($e|0))we=B;else{Q=Qe;do we=Nt(7,0,(14-Q|0)*3|0)|0,Q=Q+1|0,B=we|B,W=Me()|0|W;while((Q|0)<(wt|0));we=B}else we=m,W=A;if(he=mt(we|0,W|0,45)|0,Me()|0,!(_i(he&127)|0))B=0;else{he=mt(we|0,W|0,52)|0,Me()|0,he=he&15;t:do if(!he)B=0;else for(Q=1;;){if(B=mt(we|0,W|0,(15-Q|0)*3|0)|0,Me()|0,B=B&7,B|0)break t;if(Q>>>0<he>>>0)Q=Q+1|0;else{B=0;break}}while(!1);B=(B|0)==0&1}if(W=mt(m|0,A|0,(15-$e|0)*3|0)|0,Me()|0,W=W&7,(W|0)==7){M=5,Q=42;break}if(B=(B|0)!=0,(W|0)==1&B){M=5,Q=42;break}if(we=W+(((W|0)!=0&B)<<31>>31)|0,we|0&&(Q=wt-$e|0,Q=wo(7,0,Q,((Q|0)<0)<<31>>31)|0,he=Me()|0,B?(B=Tt(Q|0,he|0,5,0)|0,B=Ge(B|0,Me()|0,-5,-1)|0,B=Pt(B|0,Me()|0,6,0)|0,B=Ge(B|0,Me()|0,1,0)|0,W=Me()|0):(B=Q,W=he),$e=we+-1|0,$e=Tt(Q|0,he|0,$e|0,(($e|0)<0)<<31>>31|0)|0,$e=Ge(B|0,W|0,$e|0,Me()|0)|0,we=Me()|0,he=E,he=Ge($e|0,we|0,y[he>>2]|0,y[he+4>>2]|0)|0,we=Me()|0,$e=E,y[$e>>2]=he,y[$e+4>>2]=we),(Qe|0)<=(b|0)){Q=37;break}}if((Q|0)==19)Nr(23313,22674,1099,22710);else if((Q|0)==37){F=E,M=y[F+4>>2]|0,F=y[F>>2]|0;break}else if((Q|0)==42)return be=at,M|0}else M=0,F=0}else Q=33;while(!1);e:do if((Q|0)==33)if(Ue=E,y[Ue>>2]=0,y[Ue+4>>2]=0,(wt|0)>(b|0)){for(B=wt;;){if(M=mt(m|0,A|0,(15-B|0)*3|0)|0,Me()|0,M=M&7,(M|0)==7){M=5;break}if(F=wt-B|0,F=wo(7,0,F,((F|0)<0)<<31>>31)|0,M=Tt(F|0,Me()|0,M|0,0)|0,F=Me()|0,Ue=E,F=Ge(y[Ue>>2]|0,y[Ue+4>>2]|0,M|0,F|0)|0,M=Me()|0,Ue=E,y[Ue>>2]=F,y[Ue+4>>2]=M,B=B+-1|0,(B|0)<=(b|0))break e}return be=at,M|0}else M=0,F=0;while(!1);return ja(nt,N,wt,It)|0&&Nr(23313,22674,1063,22725),wt=It,It=y[wt+4>>2]|0,((M|0)>-1|(M|0)==-1&F>>>0>4294967295)&((It|0)>(M|0)|((It|0)==(M|0)?(y[wt>>2]|0)>>>0>F>>>0:0))?(wt=0,be=at,wt|0):(Nr(23313,22674,1139,22710),0)}function xh(m,A,b,E,M,B){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0;var F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0;if(we=be,be=be+16|0,F=we,M>>>0>15)return B=4,be=we,B|0;if(N=mt(b|0,E|0,52)|0,Me()|0,N=N&15,(N|0)>(M|0))return B=12,be=we,B|0;if(ja(b,E,M,F)|0&&Nr(23313,22674,1063,22725),he=F,Q=y[he+4>>2]|0,!(((A|0)>-1|(A|0)==-1&m>>>0>4294967295)&((Q|0)>(A|0)|((Q|0)==(A|0)?(y[he>>2]|0)>>>0>m>>>0:0))))return B=2,be=we,B|0;he=M-N|0,M=Nt(M|0,0,52)|0,W=Me()|0|E&-15728641,Q=B,y[Q>>2]=M|b,y[Q+4>>2]=W,Q=mt(b|0,E|0,45)|0,Me()|0;e:do if(_i(Q&127)|0){if(N|0)for(F=1;;){if(Q=Nt(7,0,(15-F|0)*3|0)|0,!((Q&b|0)==0&((Me()|0)&E|0)==0))break e;if(F>>>0<N>>>0)F=F+1|0;else break}if((he|0)<1)return B=0,be=we,B|0;for(Q=N^15,E=-1,W=1,F=1;;){N=he-W|0,N=wo(7,0,N,((N|0)<0)<<31>>31)|0,b=Me()|0;do if(F)if(F=Tt(N|0,b|0,5,0)|0,F=Ge(F|0,Me()|0,-5,-1)|0,F=Pt(F|0,Me()|0,6,0)|0,M=Me()|0,(A|0)>(M|0)|(A|0)==(M|0)&m>>>0>F>>>0){A=Ge(m|0,A|0,-1,-1)|0,A=Ze(A|0,Me()|0,F|0,M|0)|0,F=Me()|0,$e=B,Ue=y[$e>>2]|0,$e=y[$e+4>>2]|0,nt=(Q+E|0)*3|0,Qe=Nt(7,0,nt|0)|0,$e=$e&~(Me()|0),E=Pt(A|0,F|0,N|0,b|0)|0,m=Me()|0,M=Ge(E|0,m|0,2,0)|0,nt=Nt(M|0,Me()|0,nt|0)|0,$e=Me()|0|$e,M=B,y[M>>2]=nt|Ue&~Qe,y[M+4>>2]=$e,m=Tt(E|0,m|0,N|0,b|0)|0,m=Ze(A|0,F|0,m|0,Me()|0)|0,F=0,A=Me()|0;break}else{nt=B,Qe=y[nt>>2]|0,nt=y[nt+4>>2]|0,Ue=Nt(7,0,(Q+E|0)*3|0)|0,nt=nt&~(Me()|0),F=B,y[F>>2]=Qe&~Ue,y[F+4>>2]=nt,F=1;break}else Qe=B,M=y[Qe>>2]|0,Qe=y[Qe+4>>2]|0,E=(Q+E|0)*3|0,$e=Nt(7,0,E|0)|0,Qe=Qe&~(Me()|0),nt=Pt(m|0,A|0,N|0,b|0)|0,F=Me()|0,E=Nt(nt|0,F|0,E|0)|0,Qe=Me()|0|Qe,Ue=B,y[Ue>>2]=E|M&~$e,y[Ue+4>>2]=Qe,F=Tt(nt|0,F|0,N|0,b|0)|0,m=Ze(m|0,A|0,F|0,Me()|0)|0,F=0,A=Me()|0;while(!1);if((he|0)>(W|0))E=~W,W=W+1|0;else{A=0;break}}return be=we,A|0}while(!1);if((he|0)<1)return nt=0,be=we,nt|0;for(M=N^15,F=1;;)if(Ue=he-F|0,Ue=wo(7,0,Ue,((Ue|0)<0)<<31>>31)|0,nt=Me()|0,W=B,b=y[W>>2]|0,W=y[W+4>>2]|0,N=(M-F|0)*3|0,E=Nt(7,0,N|0)|0,W=W&~(Me()|0),$e=Pt(m|0,A|0,Ue|0,nt|0)|0,Qe=Me()|0,N=Nt($e|0,Qe|0,N|0)|0,W=Me()|0|W,Q=B,y[Q>>2]=N|b&~E,y[Q+4>>2]=W,nt=Tt($e|0,Qe|0,Ue|0,nt|0)|0,m=Ze(m|0,A|0,nt|0,Me()|0)|0,A=Me()|0,(he|0)<=(F|0)){A=0;break}else F=F+1|0;return be=we,A|0}function fp(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;M=mt(A|0,b|0,52)|0,Me()|0,M=M&15,(A|0)==0&(b|0)==0|((E|0)>15|(M|0)>(E|0))?(E=-1,M=-1,A=0,b=0):(B=au(A,b,M+1|0,E)|0,b=(Me()|0)&-15728641,A=Nt(E|0,0,52)|0,A=B|A,b=b|(Me()|0),B=(Hi(A,b)|0)==0,E=B?-1:E),B=m,y[B>>2]=A,y[B+4>>2]=b,y[m+8>>2]=M,y[m+12>>2]=E}function p0(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0,Q=0;if(b=m,A=y[b>>2]|0,b=y[b+4>>2]|0,!((A|0)==0&(b|0)==0)&&(E=mt(A|0,b|0,52)|0,Me()|0,E=E&15,N=Nt(1,0,(E^15)*3|0)|0,A=Ge(N|0,Me()|0,A|0,b|0)|0,b=Me()|0,N=m,y[N>>2]=A,y[N+4>>2]=b,N=m+8|0,F=y[N>>2]|0,!((E|0)<(F|0)))){for(W=m+12|0,B=E;;){if((B|0)==(F|0)){E=5;break}if(Q=(B|0)==(y[W>>2]|0),M=(15-B|0)*3|0,E=mt(A|0,b|0,M|0)|0,Me()|0,E=E&7,Q&((E|0)==1&!0)){E=7;break}if(!((E|0)==7&!0)){E=10;break}if(Q=Nt(1,0,M|0)|0,A=Ge(A|0,b|0,Q|0,Me()|0)|0,b=Me()|0,Q=m,y[Q>>2]=A,y[Q+4>>2]=b,(B|0)>(F|0))B=B+-1|0;else{E=10;break}}if((E|0)==5){Q=m,y[Q>>2]=0,y[Q+4>>2]=0,y[N>>2]=-1,y[W>>2]=-1;return}else if((E|0)==7){F=Nt(1,0,M|0)|0,F=Ge(A|0,b|0,F|0,Me()|0)|0,N=Me()|0,Q=m,y[Q>>2]=F,y[Q+4>>2]=N,y[W>>2]=B+-1;return}else if((E|0)==10)return}}function uc(m){m=+m;var A=0;return A=m<0?m+6.283185307179586:m,+(m>=6.283185307179586?A+-6.283185307179586:A)}function gl(m,A){return m=m|0,A=A|0,+Gi(+(+Ee[m>>3]-+Ee[A>>3]))<17453292519943298e-27?(A=+Gi(+(+Ee[m+8>>3]-+Ee[A+8>>3]))<17453292519943298e-27,A|0):(A=0,A|0)}function dp(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=+Ee[A>>3],E=+Ee[m>>3],B=+Mi(+((M-E)*.5)),b=+Mi(+((+Ee[A+8>>3]-+Ee[m+8>>3])*.5)),b=B*B+b*(+Ei(+M)*+Ei(+E)*b),+(+Ps(+ +gn(+b),+ +gn(+(1-b)))*2)}function uu(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=+Ee[A>>3],E=+Ee[m>>3],B=+Mi(+((M-E)*.5)),b=+Mi(+((+Ee[A+8>>3]-+Ee[m+8>>3])*.5)),b=B*B+b*(+Ei(+M)*+Ei(+E)*b),+(+Ps(+ +gn(+b),+ +gn(+(1-b)))*2*6371.007180918475)}function pp(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=+Ee[A>>3],E=+Ee[m>>3],B=+Mi(+((M-E)*.5)),b=+Mi(+((+Ee[A+8>>3]-+Ee[m+8>>3])*.5)),b=B*B+b*(+Ei(+M)*+Ei(+E)*b),+(+Ps(+ +gn(+b),+ +gn(+(1-b)))*2*6371.007180918475*1e3)}function Gg(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0;return B=+Ee[A>>3],E=+Ei(+B),M=+Ee[A+8>>3]-+Ee[m+8>>3],F=E*+Mi(+M),b=+Ee[m>>3],+ +Ps(+F,+(+Mi(+B)*+Ei(+b)-+Ei(+M)*(E*+Mi(+b))))}function Hg(m,A,b,E){m=m|0,A=+A,b=+b,E=E|0;var M=0,B=0,F=0,N=0;if(b<1e-16){y[E>>2]=y[m>>2],y[E+4>>2]=y[m+4>>2],y[E+8>>2]=y[m+8>>2],y[E+12>>2]=y[m+12>>2];return}B=A<0?A+6.283185307179586:A,B=A>=6.283185307179586?B+-6.283185307179586:B;do if(B<1e-16)A=+Ee[m>>3]+b,Ee[E>>3]=A,M=E;else{if(M=+Gi(+(B+-3.141592653589793))<1e-16,A=+Ee[m>>3],M){A=A-b,Ee[E>>3]=A,M=E;break}if(F=+Ei(+b),b=+Mi(+b),A=F*+Mi(+A)+ +Ei(+B)*(b*+Ei(+A)),A=A>1?1:A,A=+Yl(+(A<-1?-1:A)),Ee[E>>3]=A,+Gi(+(A+-1.5707963267948966))<1e-16){Ee[E>>3]=1.5707963267948966,Ee[E+8>>3]=0;return}if(+Gi(+(A+1.5707963267948966))<1e-16){Ee[E>>3]=-1.5707963267948966,Ee[E+8>>3]=0;return}if(N=+Ei(+A),B=b*+Mi(+B)/N,b=+Ee[m>>3],A=(F-+Mi(+A)*+Mi(+b))/+Ei(+b)/N,F=B>1?1:B,A=A>1?1:A,A=+Ee[m+8>>3]+ +Ps(+(F<-1?-1:F),+(A<-1?-1:A)),A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);Ee[E+8>>3]=A;return}while(!1);if(+Gi(+(A+-1.5707963267948966))<1e-16){Ee[M>>3]=1.5707963267948966,Ee[E+8>>3]=0;return}if(+Gi(+(A+1.5707963267948966))<1e-16){Ee[M>>3]=-1.5707963267948966,Ee[E+8>>3]=0;return}if(A=+Ee[m+8>>3],A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);Ee[E+8>>3]=A}function Ha(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20528+(m<<3)>>3],A=0,A|0)}function hn(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20656+(m<<3)>>3],A=0,A|0)}function bh(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20784+(m<<3)>>3],A=0,A|0)}function Uf(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20912+(m<<3)>>3],A=0,A|0)}function hc(m,A){m=m|0,A=A|0;var b=0;return m>>>0>15?(A=4,A|0):(b=wo(7,0,m,((m|0)<0)<<31>>31)|0,b=Tt(b|0,Me()|0,120,0)|0,m=Me()|0,y[A>>2]=b|2,y[A+4>>2]=m,A=0,A|0)}function Ap(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0;return $e=+Ee[A>>3],he=+Ee[m>>3],W=+Mi(+(($e-he)*.5)),B=+Ee[A+8>>3],Q=+Ee[m+8>>3],F=+Mi(+((B-Q)*.5)),N=+Ei(+he),we=+Ei(+$e),F=W*W+F*(we*N*F),F=+Ps(+ +gn(+F),+ +gn(+(1-F)))*2,W=+Ee[b>>3],$e=+Mi(+((W-$e)*.5)),E=+Ee[b+8>>3],B=+Mi(+((E-B)*.5)),M=+Ei(+W),B=$e*$e+B*(we*M*B),B=+Ps(+ +gn(+B),+ +gn(+(1-B)))*2,W=+Mi(+((he-W)*.5)),E=+Mi(+((Q-E)*.5)),E=W*W+E*(N*M*E),E=+Ps(+ +gn(+E),+ +gn(+(1-E)))*2,M=(F+B+E)*.5,+(+Kc(+ +gn(+(+Yc(+(M*.5))*+Yc(+((M-F)*.5))*+Yc(+((M-B)*.5))*+Yc(+((M-E)*.5)))))*4)}function hu(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0;if(N=be,be=be+192|0,B=N+168|0,F=N,M=lu(m,A,B)|0,M|0)return b=M,be=N,b|0;if(ra(m,A,F)|0&&Nr(23313,22742,386,22751),A=y[F>>2]|0,(A|0)>0){if(E=+Ap(F+8|0,F+8+(((A|0)!=1&1)<<4)|0,B)+0,(A|0)!=1){m=1;do M=m,m=m+1|0,E=E+ +Ap(F+8+(M<<4)|0,F+8+(((m|0)%(A|0)|0)<<4)|0,B);while((m|0)<(A|0))}}else E=0;return Ee[b>>3]=E,b=0,be=N,b|0}function Wg(m,A,b){return m=m|0,A=A|0,b=b|0,m=hu(m,A,b)|0,m|0||(Ee[b>>3]=+Ee[b>>3]*6371.007180918475*6371.007180918475),m|0}function Ca(m,A,b){return m=m|0,A=A|0,b=b|0,m=hu(m,A,b)|0,m|0||(Ee[b>>3]=+Ee[b>>3]*6371.007180918475*6371.007180918475*1e3*1e3),m|0}function vh(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0;if(N=be,be=be+176|0,F=N,m=lc(m,A,F)|0,m|0)return F=m,be=N,F|0;if(Ee[b>>3]=0,m=y[F>>2]|0,(m|0)<=1)return F=0,be=N,F|0;A=m+-1|0,m=0,E=+Ee[F+8>>3],M=+Ee[F+16>>3],B=0;do m=m+1|0,Q=E,E=+Ee[F+8+(m<<4)>>3],he=+Mi(+((E-Q)*.5)),W=M,M=+Ee[F+8+(m<<4)+8>>3],W=+Mi(+((M-W)*.5)),W=he*he+W*(+Ei(+E)*+Ei(+Q)*W),B=B+ +Ps(+ +gn(+W),+ +gn(+(1-W)))*2;while((m|0)<(A|0));return Ee[b>>3]=B,F=0,be=N,F|0}function xr(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0;if(N=be,be=be+176|0,F=N,m=lc(m,A,F)|0,m|0)return F=m,B=+Ee[b>>3],B=B*6371.007180918475,Ee[b>>3]=B,be=N,F|0;if(Ee[b>>3]=0,m=y[F>>2]|0,(m|0)<=1)return F=0,B=0,B=B*6371.007180918475,Ee[b>>3]=B,be=N,F|0;A=m+-1|0,m=0,E=+Ee[F+8>>3],M=+Ee[F+16>>3],B=0;do m=m+1|0,Q=E,E=+Ee[F+8+(m<<4)>>3],he=+Mi(+((E-Q)*.5)),W=M,M=+Ee[F+8+(m<<4)+8>>3],W=+Mi(+((M-W)*.5)),W=he*he+W*(+Ei(+Q)*+Ei(+E)*W),B=B+ +Ps(+ +gn(+W),+ +gn(+(1-W)))*2;while((m|0)!=(A|0));return Ee[b>>3]=B,F=0,he=B,he=he*6371.007180918475,Ee[b>>3]=he,be=N,F|0}function Rr(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0;if(N=be,be=be+176|0,F=N,m=lc(m,A,F)|0,m|0)return F=m,B=+Ee[b>>3],B=B*6371.007180918475,B=B*1e3,Ee[b>>3]=B,be=N,F|0;if(Ee[b>>3]=0,m=y[F>>2]|0,(m|0)<=1)return F=0,B=0,B=B*6371.007180918475,B=B*1e3,Ee[b>>3]=B,be=N,F|0;A=m+-1|0,m=0,E=+Ee[F+8>>3],M=+Ee[F+16>>3],B=0;do m=m+1|0,Q=E,E=+Ee[F+8+(m<<4)>>3],he=+Mi(+((E-Q)*.5)),W=M,M=+Ee[F+8+(m<<4)+8>>3],W=+Mi(+((M-W)*.5)),W=he*he+W*(+Ei(+Q)*+Ei(+E)*W),B=B+ +Ps(+ +gn(+W),+ +gn(+(1-W)))*2;while((m|0)!=(A|0));return Ee[b>>3]=B,F=0,he=B,he=he*6371.007180918475,he=he*1e3,Ee[b>>3]=he,be=N,F|0}function Vf(m){m=m|0;var A=0,b=0,E=0;return A=qe(1,12)|0,A||Nr(22832,22787,49,22845),b=m+4|0,E=y[b>>2]|0,E|0?(E=E+8|0,y[E>>2]=A,y[b>>2]=A,A|0):(y[m>>2]|0&&Nr(22862,22787,61,22885),E=m,y[E>>2]=A,y[b>>2]=A,A|0)}function mp(m,A){m=m|0,A=A|0;var b=0,E=0;return E=Ve(24)|0,E||Nr(22899,22787,78,22913),y[E>>2]=y[A>>2],y[E+4>>2]=y[A+4>>2],y[E+8>>2]=y[A+8>>2],y[E+12>>2]=y[A+12>>2],y[E+16>>2]=0,A=m+4|0,b=y[A>>2]|0,b|0?(y[b+16>>2]=E,y[A>>2]=E,E|0):(y[m>>2]|0&&Nr(22928,22787,82,22913),y[m>>2]=E,y[A>>2]=E,E|0)}function jf(m){m=m|0;var A=0,b=0,E=0,M=0;if(m)for(E=1;;){if(A=y[m>>2]|0,A|0)do{if(b=y[A>>2]|0,b|0)do M=b,b=y[b+16>>2]|0,Be(M);while(b|0);M=A,A=y[A+8>>2]|0,Be(M)}while(A|0);if(A=m,m=y[m+8>>2]|0,E||Be(A),m)E=0;else break}}function ps(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0,lr=0,Ai=0,ri=0,ni=0,Wr=0,Vr=0,Gr=0,Vi=0,$r=0;if(M=m+8|0,y[M>>2]|0)return $r=1,$r|0;if(E=y[m>>2]|0,!E)return $r=0,$r|0;A=E,b=0;do b=b+1|0,A=y[A+8>>2]|0;while(A|0);if(b>>>0<2)return $r=0,$r|0;Gr=Ve(b<<2)|0,Gr||Nr(22948,22787,317,22967),Vr=Ve(b<<5)|0,Vr||Nr(22989,22787,321,22967),y[m>>2]=0,mr=m+4|0,y[mr>>2]=0,y[M>>2]=0,b=0,Wr=0,ar=0,we=0;e:for(;;){if(he=y[E>>2]|0,he){B=0,F=he;do{if(W=+Ee[F+8>>3],A=F,F=y[F+16>>2]|0,Q=(F|0)==0,M=Q?he:F,N=+Ee[M+8>>3],+Gi(+(W-N))>3.141592653589793){$r=14;break}B=B+(N-W)*(+Ee[A>>3]+ +Ee[M>>3])}while(!Q);if(($r|0)==14){$r=0,B=0,A=he;do ft=+Ee[A+8>>3],ni=A+16|0,ri=y[ni>>2]|0,ri=ri|0?ri:he,bt=+Ee[ri+8>>3],B=B+(+Ee[A>>3]+ +Ee[ri>>3])*((bt<0?bt+6.283185307179586:bt)-(ft<0?ft+6.283185307179586:ft)),A=y[(A|0?ni:E)>>2]|0;while(A|0)}B>0?(y[Gr+(Wr<<2)>>2]=E,Wr=Wr+1|0,M=ar,A=we):$r=19}else $r=19;if(($r|0)==19){$r=0;do if(b){if(A=b+8|0,y[A>>2]|0){$r=21;break e}if(b=qe(1,12)|0,!b){$r=23;break e}y[A>>2]=b,M=b+4|0,F=b,A=we}else if(we){M=mr,F=we+8|0,A=E,b=m;break}else if(y[m>>2]|0){$r=27;break e}else{M=mr,F=m,A=E,b=m;break}while(!1);if(y[F>>2]=E,y[M>>2]=E,F=Vr+(ar<<5)|0,Q=y[E>>2]|0,Q){for(he=Vr+(ar<<5)+8|0,Ee[he>>3]=17976931348623157e292,we=Vr+(ar<<5)+24|0,Ee[we>>3]=17976931348623157e292,Ee[F>>3]=-17976931348623157e292,$e=Vr+(ar<<5)+16|0,Ee[$e>>3]=-17976931348623157e292,wt=17976931348623157e292,at=-17976931348623157e292,M=0,Qe=Q,W=17976931348623157e292,nt=17976931348623157e292,It=-17976931348623157e292,N=-17976931348623157e292;B=+Ee[Qe>>3],ft=+Ee[Qe+8>>3],Qe=y[Qe+16>>2]|0,Ue=(Qe|0)==0,bt=+Ee[(Ue?Q:Qe)+8>>3],B<W&&(Ee[he>>3]=B,W=B),ft<nt&&(Ee[we>>3]=ft,nt=ft),B>It?Ee[F>>3]=B:B=It,ft>N&&(Ee[$e>>3]=ft,N=ft),wt=ft>0&ft<wt?ft:wt,at=ft<0&ft>at?ft:at,M=M|+Gi(+(ft-bt))>3.141592653589793,!Ue;)It=B;M&&(Ee[$e>>3]=at,Ee[we>>3]=wt)}else y[F>>2]=0,y[F+4>>2]=0,y[F+8>>2]=0,y[F+12>>2]=0,y[F+16>>2]=0,y[F+20>>2]=0,y[F+24>>2]=0,y[F+28>>2]=0;M=ar+1|0}if(ni=E+8|0,E=y[ni>>2]|0,y[ni>>2]=0,E)ar=M,we=A;else{$r=45;break}}if(($r|0)==21)Nr(22765,22787,35,22799);else if(($r|0)==23)Nr(22819,22787,37,22799);else if(($r|0)==27)Nr(22862,22787,61,22885);else if(($r|0)==45){e:do if((Wr|0)>0){for(ni=(M|0)==0,Ai=M<<2,ri=(m|0)==0,lr=0,A=0;;){if(or=y[Gr+(lr<<2)>>2]|0,ni)$r=73;else{if(ar=Ve(Ai)|0,!ar){$r=50;break}if(mr=Ve(Ai)|0,!mr){$r=52;break}t:do if(ri)b=0;else{for(M=0,b=0,F=m;E=Vr+(M<<5)|0,gp(y[F>>2]|0,E,y[or>>2]|0)|0?(y[ar+(b<<2)>>2]=F,y[mr+(b<<2)>>2]=E,Ue=b+1|0):Ue=b,F=y[F+8>>2]|0,F;)M=M+1|0,b=Ue;if((Ue|0)>0)if(E=y[ar>>2]|0,(Ue|0)==1)b=E;else for($e=0,Qe=-1,b=E,we=E;;){for(Q=y[we>>2]|0,E=0,F=0;M=y[y[ar+(F<<2)>>2]>>2]|0,(M|0)==(Q|0)?he=E:he=E+((gp(M,y[mr+(F<<2)>>2]|0,y[Q>>2]|0)|0)&1)|0,F=F+1|0,(F|0)!=(Ue|0);)E=he;if(M=(he|0)>(Qe|0),b=M?we:b,E=$e+1|0,(E|0)==(Ue|0))break t;$e=E,Qe=M?he:Qe,we=y[ar+(E<<2)>>2]|0}else b=0}while(!1);if(Be(ar),Be(mr),b){if(M=b+4|0,E=y[M>>2]|0,E)b=E+8|0;else if(y[b>>2]|0){$r=70;break}y[b>>2]=or,y[M>>2]=or}else $r=73}if(($r|0)==73){if($r=0,A=y[or>>2]|0,A|0)do mr=A,A=y[A+16>>2]|0,Be(mr);while(A|0);Be(or),A=1}if(lr=lr+1|0,(lr|0)>=(Wr|0)){Vi=A;break e}}($r|0)==50?Nr(23004,22787,249,23023):($r|0)==52?Nr(23042,22787,252,23023):($r|0)==70&&Nr(22862,22787,61,22885)}else Vi=0;while(!1);return Be(Gr),Be(Vr),$r=Vi,$r|0}return 0}function gp(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0;if(!(rp(A,b)|0)||(A=ic(A)|0,E=+Ee[b>>3],M=+Ee[b+8>>3],M=A&M<0?M+6.283185307179586:M,m=y[m>>2]|0,!m))return m=0,m|0;if(A){A=0,Q=M,b=m;e:for(;;){for(;F=+Ee[b>>3],M=+Ee[b+8>>3],b=b+16|0,he=y[b>>2]|0,he=he|0?he:m,B=+Ee[he>>3],N=+Ee[he+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=y[b>>2]|0,!b){b=22;break e}if(N=F<0?F+6.283185307179586:F,F=M<0?M+6.283185307179586:M,Q=N==Q|F==Q?Q+-2220446049250313e-31:Q,W=N+(F-N)*((E-B)/(W-B)),(W<0?W+6.283185307179586:W)>Q&&(A=A^1),b=y[b>>2]|0,!b){b=22;break}}if((b|0)==22)return A|0}else{A=0,Q=M,b=m;e:for(;;){for(;F=+Ee[b>>3],M=+Ee[b+8>>3],b=b+16|0,he=y[b>>2]|0,he=he|0?he:m,B=+Ee[he>>3],N=+Ee[he+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=y[b>>2]|0,!b){b=22;break e}if(Q=F==Q|M==Q?Q+-2220446049250313e-31:Q,F+(M-F)*((E-B)/(W-B))>Q&&(A=A^1),b=y[b>>2]|0,!b){b=22;break}}if((b|0)==22)return A|0}return 0}function Bn(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0;if(at=be,be=be+32|0,wt=at+16|0,It=at,B=mt(m|0,A|0,52)|0,Me()|0,B=B&15,Qe=mt(b|0,E|0,52)|0,Me()|0,(B|0)!=(Qe&15|0))return wt=12,be=at,wt|0;if(Q=mt(m|0,A|0,45)|0,Me()|0,Q=Q&127,he=mt(b|0,E|0,45)|0,Me()|0,he=he&127,Q>>>0>121|he>>>0>121)return wt=5,be=at,wt|0;if(Qe=(Q|0)!=(he|0),Qe){if(N=Jc(Q,he)|0,(N|0)==7)return wt=1,be=at,wt|0;W=Jc(he,Q)|0,(W|0)==7?Nr(23066,23090,161,23100):(Ue=N,F=W)}else Ue=0,F=0;we=_i(Q)|0,$e=_i(he)|0,y[wt>>2]=0,y[wt+4>>2]=0,y[wt+8>>2]=0,y[wt+12>>2]=0;do if(Ue){if(he=y[4272+(Q*28|0)+(Ue<<2)>>2]|0,N=(he|0)>0,$e)if(N){Q=0,W=b,N=E;do W=jg(W,N)|0,N=Me()|0,F=Ta(F)|0,(F|0)==1&&(F=Ta(1)|0),Q=Q+1|0;while((Q|0)!=(he|0));he=F,Q=W,W=N}else he=F,Q=b,W=E;else if(N){Q=0,W=b,N=E;do W=Al(W,N)|0,N=Me()|0,F=Ta(F)|0,Q=Q+1|0;while((Q|0)!=(he|0));he=F,Q=W,W=N}else he=F,Q=b,W=E;if(Nf(Q,W,wt)|0,Qe||Nr(23115,23090,191,23100),N=(we|0)!=0,F=($e|0)!=0,N&F&&Nr(23142,23090,192,23100),N){if(F=zo(m,A)|0,(F|0)==7){B=5;break}if(Lr[21872+(F*7|0)+Ue>>0]|0){B=1;break}W=y[21040+(F*28|0)+(Ue<<2)>>2]|0,Q=W}else if(F){if(F=zo(Q,W)|0,(F|0)==7){B=5;break}if(Lr[21872+(F*7|0)+he>>0]|0){B=1;break}Q=0,W=y[21040+(he*28|0)+(F<<2)>>2]|0}else Q=0,W=0;if((Q|W|0)<0)B=5;else{if((W|0)>0){N=wt+4|0,F=0;do nc(N),F=F+1|0;while((F|0)!=(W|0))}if(y[It>>2]=0,y[It+4>>2]=0,y[It+8>>2]=0,mh(It,Ue),B|0)for(;wn(B)|0?ru(It):fl(It),(B|0)>1;)B=B+-1|0;if((Q|0)>0){B=0;do nc(It),B=B+1|0;while((B|0)!=(Q|0))}nt=wt+4|0,Qo(nt,It,nt),vo(nt),nt=51}}else if(Nf(b,E,wt)|0,(we|0)!=0&($e|0)!=0)if((he|0)!=(Q|0)&&Nr(23173,23090,261,23100),F=zo(m,A)|0,B=zo(b,E)|0,(F|0)==7|(B|0)==7)B=5;else if(Lr[21872+(F*7|0)+B>>0]|0)B=1;else if(F=y[21040+(F*28|0)+(B<<2)>>2]|0,(F|0)>0){N=wt+4|0,B=0;do nc(N),B=B+1|0;while((B|0)!=(F|0));nt=51}else nt=51;else nt=51;while(!1);return(nt|0)==51&&(B=wt+4|0,y[M>>2]=y[B>>2],y[M+4>>2]=y[B+4>>2],y[M+8>>2]=y[B+8>>2],B=0),wt=B,be=at,wt|0}function A0(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0;if(nt=be,be=be+48|0,Q=nt+36|0,F=nt+24|0,N=nt+12|0,W=nt,M=mt(m|0,A|0,52)|0,Me()|0,M=M&15,$e=mt(m|0,A|0,45)|0,Me()|0,$e=$e&127,$e>>>0>121)return E=5,be=nt,E|0;if(he=_i($e)|0,Nt(M|0,0,52)|0,It=Me()|0|134225919,B=E,y[B>>2]=-1,y[B+4>>2]=It,!M)return M=If(b)|0,(M|0)==7||(M=rc($e,M)|0,(M|0)==127)?(It=1,be=nt,It|0):(Qe=Nt(M|0,0,45)|0,Ue=Me()|0,$e=E,Ue=y[$e+4>>2]&-1040385|Ue,It=E,y[It>>2]=y[$e>>2]|Qe,y[It+4>>2]=Ue,It=0,be=nt,It|0);for(y[Q>>2]=y[b>>2],y[Q+4>>2]=y[b+4>>2],y[Q+8>>2]=y[b+8>>2],b=M;;){if(B=b,b=b+-1|0,y[F>>2]=y[Q>>2],y[F+4>>2]=y[Q+4>>2],y[F+8>>2]=y[Q+8>>2],wn(B)|0){if(M=tu(Q)|0,M|0){b=13;break}y[N>>2]=y[Q>>2],y[N+4>>2]=y[Q+4>>2],y[N+8>>2]=y[Q+8>>2],ru(N)}else{if(M=Ah(Q)|0,M|0){b=13;break}y[N>>2]=y[Q>>2],y[N+4>>2]=y[Q+4>>2],y[N+8>>2]=y[Q+8>>2],fl(N)}if(Sf(F,N,W),vo(W),M=E,at=y[M>>2]|0,M=y[M+4>>2]|0,bt=(15-B|0)*3|0,wt=Nt(7,0,bt|0)|0,M=M&~(Me()|0),bt=Nt(If(W)|0,0,bt|0)|0,M=Me()|0|M,It=E,y[It>>2]=bt|at&~wt,y[It+4>>2]=M,(B|0)<=1){b=14;break}}e:do if((b|0)!=13&&(b|0)==14)if((y[Q>>2]|0)<=1&&(y[Q+4>>2]|0)<=1&&(y[Q+8>>2]|0)<=1){b=If(Q)|0,M=rc($e,b)|0,(M|0)==127?W=0:W=_i(M)|0;t:do if(b){if(he){if(M=zo(m,A)|0,(M|0)==7){M=5;break e}if(B=y[21248+(M*28|0)+(b<<2)>>2]|0,(B|0)>0){M=b,b=0;do M=oc(M)|0,b=b+1|0;while((b|0)!=(B|0))}else M=b;if((M|0)==1){M=9;break e}b=rc($e,M)|0,(b|0)==127&&Nr(23200,23090,411,23230),_i(b)|0?Nr(23245,23090,412,23230):(Ue=b,Qe=B,we=M)}else Ue=M,Qe=0,we=b;if(N=y[4272+($e*28|0)+(we<<2)>>2]|0,(N|0)<=-1&&Nr(23276,23090,419,23230),!W){if((Qe|0)<0){M=5;break e}if(Qe|0){B=E,M=0,b=y[B>>2]|0,B=y[B+4>>2]|0;do b=Ga(b,B)|0,B=Me()|0,bt=E,y[bt>>2]=b,y[bt+4>>2]=B,M=M+1|0;while((M|0)<(Qe|0))}if((N|0)<=0){M=Ue,b=58;break}for(B=E,M=0,b=y[B>>2]|0,B=y[B+4>>2]|0;;)if(b=Ga(b,B)|0,B=Me()|0,bt=E,y[bt>>2]=b,y[bt+4>>2]=B,M=M+1|0,(M|0)==(N|0)){M=Ue,b=58;break t}}if(F=Jc(Ue,$e)|0,(F|0)==7&&Nr(23066,23090,428,23230),M=E,b=y[M>>2]|0,M=y[M+4>>2]|0,(N|0)>0){B=0;do b=Ga(b,M)|0,M=Me()|0,bt=E,y[bt>>2]=b,y[bt+4>>2]=M,B=B+1|0;while((B|0)!=(N|0))}if(M=zo(b,M)|0,(M|0)==7&&Nr(23313,23090,440,23230),b=wf(Ue)|0,b=y[(b?21664:21456)+(F*28|0)+(M<<2)>>2]|0,(b|0)<0&&Nr(23313,23090,454,23230),!b)M=Ue,b=58;else{F=E,M=0,B=y[F>>2]|0,F=y[F+4>>2]|0;do B=hp(B,F)|0,F=Me()|0,bt=E,y[bt>>2]=B,y[bt+4>>2]=F,M=M+1|0;while((M|0)<(b|0));M=Ue,b=58}}else if((he|0)!=0&(W|0)!=0){if(b=zo(m,A)|0,B=E,B=zo(y[B>>2]|0,y[B+4>>2]|0)|0,(b|0)==7|(B|0)==7){M=5;break e}if(B=y[21248+(b*28|0)+(B<<2)>>2]|0,(B|0)<0){M=5;break e}if(!B)b=59;else{N=E,b=0,F=y[N>>2]|0,N=y[N+4>>2]|0;do F=Ga(F,N)|0,N=Me()|0,bt=E,y[bt>>2]=F,y[bt+4>>2]=N,b=b+1|0;while((b|0)<(B|0));b=58}}else b=58;while(!1);if((b|0)==58&&W&&(b=59),(b|0)==59&&(bt=E,(zo(y[bt>>2]|0,y[bt+4>>2]|0)|0)==1)){M=9;break}bt=E,wt=y[bt>>2]|0,bt=y[bt+4>>2]&-1040385,at=Nt(M|0,0,45)|0,bt=bt|(Me()|0),M=E,y[M>>2]=wt|at,y[M+4>>2]=bt,M=0}else M=1;while(!1);return bt=M,be=nt,bt|0}function wh(m,A,b,E,M,B){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0,B=B|0;var F=0,N=0;return N=be,be=be+16|0,F=N,M?m=15:(m=Bn(m,A,b,E,F)|0,m||(Bf(F,B),m=0)),be=N,m|0}function Ln(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0;return F=be,be=be+16|0,B=F,E?b=15:(b=Lf(b,B)|0,b||(b=A0(m,A,B,M)|0)),be=F,b|0}function Vn(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0;return W=be,be=be+32|0,F=W+12|0,N=W,B=Bn(m,A,m,A,F)|0,B|0?(N=B,be=W,N|0):(m=Bn(m,A,b,E,N)|0,m|0?(N=m,be=W,N|0):(F=sc(F,N)|0,N=M,y[N>>2]=F,y[N+4>>2]=((F|0)<0)<<31>>31,N=0,be=W,N|0))}function m0(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0;return W=be,be=be+32|0,F=W+12|0,N=W,B=Bn(m,A,m,A,F)|0,!B&&(B=Bn(m,A,b,E,N)|0,!B)?(E=sc(F,N)|0,E=Ge(E|0,((E|0)<0)<<31>>31|0,1,0)|0,F=Me()|0,N=M,y[N>>2]=E,y[N+4>>2]=F,N=0,be=W,N|0):(N=B,be=W,N|0)}function Th(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0,lr=0;if(or=be,be=be+48|0,F=or+24|0,N=or+12|0,mr=or,B=Bn(m,A,m,A,F)|0,!B&&(B=Bn(m,A,b,E,N)|0,!B)){ft=sc(F,N)|0,ar=((ft|0)<0)<<31>>31,y[F>>2]=0,y[F+4>>2]=0,y[F+8>>2]=0,y[N>>2]=0,y[N+4>>2]=0,y[N+8>>2]=0,Bn(m,A,m,A,F)|0&&Nr(23313,23090,691,23299),Bn(m,A,b,E,N)|0&&Nr(23313,23090,696,23299),gh(F),gh(N),ft?(we=y[F>>2]|0,Ue=+(ft|0),wt=F+4|0,$e=y[wt>>2]|0,at=F+8|0,Qe=y[at>>2]|0,bt=F,E=we,B=$e,b=Qe,nt=+((y[N>>2]|0)-we|0)/Ue,It=+((y[N+4>>2]|0)-$e|0)/Ue,Ue=+((y[N+8>>2]|0)-Qe|0)/Ue):(B=F+4|0,b=F+8|0,wt=B,at=b,bt=F,E=y[F>>2]|0,B=y[B>>2]|0,b=y[b>>2]|0,nt=0,It=0,Ue=0),y[mr>>2]=E,Qe=mr+4|0,y[Qe>>2]=B,$e=mr+8|0,y[$e>>2]=b;e:do if((ft|0)<0)B=0;else for(he=0,we=0,B=E;;){Q=+(we>>>0)+4294967296*+(he|0),lr=nt*Q+ +(B|0),W=It*Q+ +(y[wt>>2]|0),Q=Ue*Q+ +(y[at>>2]|0),b=~~+zi(+lr),F=~~+zi(+W),B=~~+zi(+Q),lr=+Gi(+(+(b|0)-lr)),W=+Gi(+(+(F|0)-W)),Q=+Gi(+(+(B|0)-Q));do if(lr>W&lr>Q)b=0-(F+B)|0,E=F;else if(N=0-b|0,W>Q){E=N-B|0;break}else{E=F,B=N-F|0;break}while(!1);if(y[mr>>2]=b,y[Qe>>2]=E,y[$e>>2]=B,nu(mr),B=A0(m,A,mr,M+(we<<3)|0)|0,B|0)break e;if(!((he|0)<(ar|0)|(he|0)==(ar|0)&we>>>0<ft>>>0)){B=0;break e}B=Ge(we|0,he|0,1,0)|0,N=Me()|0,he=N,we=B,B=y[bt>>2]|0}while(!1);return mr=B,be=or,mr|0}return mr=B,be=or,mr|0}function wo(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0;if((b|0)==0&(E|0)==0)return M=0,B=1,Kr(M|0),B|0;B=m,M=A,m=1,A=0;do F=(b&1|0)==0&!0,m=Tt((F?1:B)|0,(F?0:M)|0,m|0,A|0)|0,A=Me()|0,b=Ut(b|0,E|0,1)|0,E=Me()|0,B=Tt(B|0,M|0,B|0,M|0)|0,M=Me()|0;while(!((b|0)==0&(E|0)==0));return Kr(A|0),m|0}function Eh(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0;if(!(rp(A,b)|0)||(A=ic(A)|0,E=+Ee[b>>3],M=+Ee[b+8>>3],M=A&M<0?M+6.283185307179586:M,$e=y[m>>2]|0,($e|0)<=0))return $e=0,$e|0;if(we=y[m+4>>2]|0,A){A=0,he=M,b=-1,m=0;e:for(;;){for(Q=m;F=+Ee[we+(Q<<4)>>3],M=+Ee[we+(Q<<4)+8>>3],m=(b+2|0)%($e|0)|0,B=+Ee[we+(m<<4)>>3],N=+Ee[we+(m<<4)+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=Q+1|0,(b|0)>=($e|0)){b=22;break e}else m=Q,Q=b,b=m;if(N=F<0?F+6.283185307179586:F,F=M<0?M+6.283185307179586:M,he=N==he|F==he?he+-2220446049250313e-31:he,W=N+(F-N)*((E-B)/(W-B)),(W<0?W+6.283185307179586:W)>he&&(A=A^1),m=Q+1|0,(m|0)>=($e|0)){b=22;break}else b=Q}if((b|0)==22)return A|0}else{A=0,he=M,b=-1,m=0;e:for(;;){for(Q=m;F=+Ee[we+(Q<<4)>>3],M=+Ee[we+(Q<<4)+8>>3],m=(b+2|0)%($e|0)|0,B=+Ee[we+(m<<4)>>3],N=+Ee[we+(m<<4)+8>>3],F>B?(W=F,F=N):(W=B,B=F,F=M,M=N),E=E==B|E==W?E+2220446049250313e-31:E,!!(E<B|E>W);)if(b=Q+1|0,(b|0)>=($e|0)){b=22;break e}else m=Q,Q=b,b=m;if(he=F==he|M==he?he+-2220446049250313e-31:he,F+(M-F)*((E-B)/(W-B))>he&&(A=A^1),m=Q+1|0,(m|0)>=($e|0)){b=22;break}else b=Q}if((b|0)==22)return A|0}return 0}function fu(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0;if(Ue=y[m>>2]|0,!Ue){y[A>>2]=0,y[A+4>>2]=0,y[A+8>>2]=0,y[A+12>>2]=0,y[A+16>>2]=0,y[A+20>>2]=0,y[A+24>>2]=0,y[A+28>>2]=0;return}if(nt=A+8|0,Ee[nt>>3]=17976931348623157e292,It=A+24|0,Ee[It>>3]=17976931348623157e292,Ee[A>>3]=-17976931348623157e292,wt=A+16|0,Ee[wt>>3]=-17976931348623157e292,!((Ue|0)<=0)){for($e=y[m+4>>2]|0,Q=17976931348623157e292,he=-17976931348623157e292,we=0,m=-1,B=17976931348623157e292,F=17976931348623157e292,W=-17976931348623157e292,E=-17976931348623157e292,Qe=0;b=+Ee[$e+(Qe<<4)>>3],N=+Ee[$e+(Qe<<4)+8>>3],m=m+2|0,M=+Ee[$e+(((m|0)==(Ue|0)?0:m)<<4)+8>>3],b<B&&(Ee[nt>>3]=b,B=b),N<F&&(Ee[It>>3]=N,F=N),b>W?Ee[A>>3]=b:b=W,N>E&&(Ee[wt>>3]=N,E=N),Q=N>0&N<Q?N:Q,he=N<0&N>he?N:he,we=we|+Gi(+(N-M))>3.141592653589793,m=Qe+1|0,(m|0)!=(Ue|0);)at=Qe,W=b,Qe=m,m=at;we&&(Ee[wt>>3]=he,Ee[It>>3]=Q)}}function Gf(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,or=0;if(Ue=y[m>>2]|0,Ue){if(nt=A+8|0,Ee[nt>>3]=17976931348623157e292,It=A+24|0,Ee[It>>3]=17976931348623157e292,Ee[A>>3]=-17976931348623157e292,wt=A+16|0,Ee[wt>>3]=-17976931348623157e292,(Ue|0)>0){for(M=y[m+4>>2]|0,$e=17976931348623157e292,Qe=-17976931348623157e292,E=0,b=-1,W=17976931348623157e292,Q=17976931348623157e292,we=-17976931348623157e292,F=-17976931348623157e292,at=0;B=+Ee[M+(at<<4)>>3],he=+Ee[M+(at<<4)+8>>3],mr=b+2|0,N=+Ee[M+(((mr|0)==(Ue|0)?0:mr)<<4)+8>>3],B<W&&(Ee[nt>>3]=B,W=B),he<Q&&(Ee[It>>3]=he,Q=he),B>we?Ee[A>>3]=B:B=we,he>F&&(Ee[wt>>3]=he,F=he),$e=he>0&he<$e?he:$e,Qe=he<0&he>Qe?he:Qe,E=E|+Gi(+(he-N))>3.141592653589793,b=at+1|0,(b|0)!=(Ue|0);)mr=at,we=B,at=b,b=mr;E&&(Ee[wt>>3]=Qe,Ee[It>>3]=$e)}}else y[A>>2]=0,y[A+4>>2]=0,y[A+8>>2]=0,y[A+12>>2]=0,y[A+16>>2]=0,y[A+20>>2]=0,y[A+24>>2]=0,y[A+28>>2]=0;if(mr=m+8|0,b=y[mr>>2]|0,!((b|0)<=0)){ar=m+12|0,ft=0;do if(M=y[ar>>2]|0,E=ft,ft=ft+1|0,It=A+(ft<<5)|0,wt=y[M+(E<<3)>>2]|0,wt){if(at=A+(ft<<5)+8|0,Ee[at>>3]=17976931348623157e292,m=A+(ft<<5)+24|0,Ee[m>>3]=17976931348623157e292,Ee[It>>3]=-17976931348623157e292,bt=A+(ft<<5)+16|0,Ee[bt>>3]=-17976931348623157e292,(wt|0)>0){for(Ue=y[M+(E<<3)+4>>2]|0,$e=17976931348623157e292,Qe=-17976931348623157e292,M=0,E=-1,nt=0,W=17976931348623157e292,Q=17976931348623157e292,he=-17976931348623157e292,F=-17976931348623157e292;B=+Ee[Ue+(nt<<4)>>3],we=+Ee[Ue+(nt<<4)+8>>3],E=E+2|0,N=+Ee[Ue+(((E|0)==(wt|0)?0:E)<<4)+8>>3],B<W&&(Ee[at>>3]=B,W=B),we<Q&&(Ee[m>>3]=we,Q=we),B>he?Ee[It>>3]=B:B=he,we>F&&(Ee[bt>>3]=we,F=we),$e=we>0&we<$e?we:$e,Qe=we<0&we>Qe?we:Qe,M=M|+Gi(+(we-N))>3.141592653589793,E=nt+1|0,(E|0)!=(wt|0);)or=nt,nt=E,he=B,E=or;M&&(Ee[bt>>3]=Qe,Ee[m>>3]=$e)}}else y[It>>2]=0,y[It+4>>2]=0,y[It+8>>2]=0,y[It+12>>2]=0,y[It+16>>2]=0,y[It+20>>2]=0,y[It+24>>2]=0,y[It+28>>2]=0,b=y[mr>>2]|0;while((ft|0)<(b|0))}}function fc(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(!(Eh(m,A,b)|0))return M=0,M|0;if(M=m+8|0,(y[M>>2]|0)<=0)return M=1,M|0;for(E=m+12|0,m=0;;){if(B=m,m=m+1|0,Eh((y[E>>2]|0)+(B<<3)|0,A+(m<<5)|0,b)|0){m=0,E=6;break}if((m|0)>=(y[M>>2]|0)){m=1,E=6;break}}return(E|0)==6?m|0:0}function _p(){return 8}function du(){return 16}function dc(){return 168}function yp(){return 8}function Hf(){return 16}function pc(){return 12}function xp(){return 8}function bp(m){return m=m|0,+(+((y[m>>2]|0)>>>0)+4294967296*+(y[m+4>>2]|0))}function Ch(m){m=m|0;var A=0,b=0;return b=+Ee[m>>3],A=+Ee[m+8>>3],+ +gn(+(b*b+A*A))}function Wf(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0;Q=+Ee[m>>3],W=+Ee[A>>3]-Q,N=+Ee[m+8>>3],F=+Ee[A+8>>3]-N,we=+Ee[b>>3],B=+Ee[E>>3]-we,$e=+Ee[b+8>>3],he=+Ee[E+8>>3]-$e,B=(B*(N-$e)-(Q-we)*he)/(W*he-F*B),Ee[M>>3]=Q+W*B,Ee[M+8>>3]=N+F*B}function C(m,A){return m=m|0,A=A|0,+Gi(+(+Ee[m>>3]-+Ee[A>>3]))<11920928955078125e-23?(A=+Gi(+(+Ee[m+8>>3]-+Ee[A+8>>3]))<11920928955078125e-23,A|0):(A=0,A|0)}function s(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;return M=+Ee[m>>3]-+Ee[A>>3],E=+Ee[m+8>>3]-+Ee[A+8>>3],b=+Ee[m+16>>3]-+Ee[A+16>>3],+(M*M+E*E+b*b)}function u(m,A){m=m|0,A=A|0;var b=0,E=0,M=0;b=+Ee[m>>3],E=+Ei(+b),b=+Mi(+b),Ee[A+16>>3]=b,b=+Ee[m+8>>3],M=E*+Ei(+b),Ee[A>>3]=M,b=E*+Mi(+b),Ee[A+8>>3]=b}function _(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if(B=be,be=be+16|0,M=B,E=Hi(m,A)|0,(b+-1|0)>>>0>5||(E=(E|0)!=0,(b|0)==1&E))return M=-1,be=B,M|0;do if(v(m,A,M)|0)E=-1;else if(E){E=((y[21936+(b<<2)>>2]|0)+5-(y[M>>2]|0)|0)%5|0;break}else{E=((y[21968+(b<<2)>>2]|0)+6-(y[M>>2]|0)|0)%6|0;break}while(!1);return M=E,be=B,M|0}function v(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0,Q=0;if(Q=be,be=be+32|0,F=Q+16|0,N=Q,E=ta(m,A,F)|0,E|0)return b=E,be=Q,b|0;B=up(m,A)|0,W=zo(m,A)|0,tc(B,N),E=Tf(B,y[F>>2]|0)|0;e:do if(_i(B)|0){do switch(B|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:{E=1;break e}}while(!1);if(M=y[22e3+(m*24|0)+8>>2]|0,A=y[22e3+(m*24|0)+16>>2]|0,m=y[F>>2]|0,(m|0)!=(y[N>>2]|0)&&(N=wf(B)|0,m=y[F>>2]|0,N|(m|0)==(A|0)&&(E=(E+1|0)%6|0)),(W|0)==3&(m|0)==(A|0)){E=(E+5|0)%6|0,M=22;break}(W|0)==5&(m|0)==(M|0)&&(E=(E+1|0)%6|0),M=22}else M=22;while(!1);return(M|0)==22&&(y[b>>2]=E,E=0),b=E,be=Q,b|0}function S(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0;if(bt=be,be=be+32|0,at=bt+24|0,It=bt+20|0,Ue=bt+8|0,Qe=bt+16|0,$e=bt,W=(Hi(m,A)|0)==0,W=W?6:5,he=mt(m|0,A|0,52)|0,Me()|0,he=he&15,W>>>0<=b>>>0)return E=2,be=bt,E|0;we=(he|0)==0,!we&&(nt=Nt(7,0,(he^15)*3|0)|0,(nt&m|0)==0&((Me()|0)&A|0)==0)?M=b:B=4;e:do if((B|0)==4){if(M=(Hi(m,A)|0)!=0,((M?4:5)|0)<(b|0)||v(m,A,at)|0||(B=(y[at>>2]|0)+b|0,M?M=22288+(((B|0)%5|0)<<2)|0:M=22320+(((B|0)%6|0)<<2)|0,nt=y[M>>2]|0,(nt|0)==7))return E=1,be=bt,E|0;y[It>>2]=0,M=po(m,A,nt,It,Ue)|0;do if(!M){if(N=Ue,Q=y[N>>2]|0,N=y[N+4>>2]|0,F=N>>>0<A>>>0|(N|0)==(A|0)&Q>>>0<m>>>0,B=F?Q:m,F=F?N:A,!we&&(we=Nt(7,0,(he^15)*3|0)|0,(Q&we|0)==0&(N&(Me()|0)|0)==0))M=b;else{if(N=(b+-1+W|0)%(W|0)|0,M=Hi(m,A)|0,(N|0)<0&&Nr(23313,23315,245,23324),W=(M|0)!=0,((W?4:5)|0)<(N|0)&&Nr(23313,23315,245,23324),v(m,A,at)|0&&Nr(23313,23315,245,23324),M=(y[at>>2]|0)+N|0,W?M=22288+(((M|0)%5|0)<<2)|0:M=22320+(((M|0)%6|0)<<2)|0,N=y[M>>2]|0,(N|0)==7&&Nr(23313,23315,245,23324),y[Qe>>2]=0,M=po(m,A,N,Qe,$e)|0,M|0)break;Q=$e,W=y[Q>>2]|0,Q=y[Q+4>>2]|0;do if(Q>>>0<F>>>0|(Q|0)==(F|0)&W>>>0<B>>>0){if(Hi(W,Q)|0?B=xf(W,Q,m,A)|0:B=y[22384+((((y[Qe>>2]|0)+(y[22352+(N<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,M=Hi(W,Q)|0,(B+-1|0)>>>0>5){M=-1,B=W,F=Q;break}if(M=(M|0)!=0,(B|0)==1&M){M=-1,B=W,F=Q;break}do if(v(W,Q,at)|0)M=-1;else if(M){M=((y[21936+(B<<2)>>2]|0)+5-(y[at>>2]|0)|0)%5|0;break}else{M=((y[21968+(B<<2)>>2]|0)+6-(y[at>>2]|0)|0)%6|0;break}while(!1);B=W,F=Q}else M=b;while(!1);N=Ue,Q=y[N>>2]|0,N=y[N+4>>2]|0}if((B|0)==(Q|0)&(F|0)==(N|0)){if(W=(Hi(Q,N)|0)!=0,W?m=xf(Q,N,m,A)|0:m=y[22384+((((y[It>>2]|0)+(y[22352+(nt<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,M=Hi(Q,N)|0,(m+-1|0)>>>0<=5&&(wt=(M|0)!=0,!((m|0)==1&wt)))do if(v(Q,N,at)|0)M=-1;else if(wt){M=((y[21936+(m<<2)>>2]|0)+5-(y[at>>2]|0)|0)%5|0;break}else{M=((y[21968+(m<<2)>>2]|0)+6-(y[at>>2]|0)|0)%6|0;break}while(!1);else M=-1;M=M+1|0,M=(M|0)==6|W&(M|0)==5?0:M}A=F,m=B;break e}while(!1);return E=M,be=bt,E|0}while(!1);return wt=Nt(M|0,0,56)|0,at=Me()|0|A&-2130706433|536870912,y[E>>2]=wt|m,y[E+4>>2]=at,E=0,be=bt,E|0}function O(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;return B=(Hi(m,A)|0)==0,E=S(m,A,0,b)|0,M=(E|0)==0,B?!M||(E=S(m,A,1,b+8|0)|0,E|0)||(E=S(m,A,2,b+16|0)|0,E|0)||(E=S(m,A,3,b+24|0)|0,E|0)||(E=S(m,A,4,b+32|0)|0,E)?(B=E,B|0):S(m,A,5,b+40|0)|0:!M||(E=S(m,A,1,b+8|0)|0,E|0)||(E=S(m,A,2,b+16|0)|0,E|0)||(E=S(m,A,3,b+24|0)|0,E|0)||(E=S(m,A,4,b+32|0)|0,E|0)?(B=E,B|0):(B=b+40|0,y[B>>2]=0,y[B+4>>2]=0,B=0,B|0)}function z(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0,N=0,W=0;return W=be,be=be+192|0,M=W,B=W+168|0,F=mt(m|0,A|0,56)|0,Me()|0,F=F&7,N=A&-2130706433|134217728,E=ta(m,N,B)|0,E|0?(N=E,be=W,N|0):(A=mt(m|0,A|0,52)|0,Me()|0,A=A&15,Hi(m,N)|0?Of(B,A,F,1,M):Va(B,A,F,1,M),N=M+8|0,y[b>>2]=y[N>>2],y[b+4>>2]=y[N+4>>2],y[b+8>>2]=y[N+8>>2],y[b+12>>2]=y[N+12>>2],N=0,be=W,N|0)}function V(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return M=be,be=be+16|0,b=M,!(!0&(A&2013265920|0)==536870912)||(E=A&-2130706433|134217728,!(Ff(m,E)|0))?(E=0,be=M,E|0):(B=mt(m|0,A|0,56)|0,Me()|0,B=(S(m,E,B&7,b)|0)==0,E=b,E=B&((y[E>>2]|0)==(m|0)?(y[E+4>>2]|0)==(A|0):0)&1,be=M,E|0)}function H(m,A,b){m=m|0,A=A|0,b=b|0;var E=0;(A|0)>0?(E=qe(A,4)|0,y[m>>2]=E,E||Nr(23337,23360,40,23374)):y[m>>2]=0,y[m+4>>2]=A,y[m+8>>2]=0,y[m+12>>2]=b}function K(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0;M=m+4|0,B=m+12|0,F=m+8|0;e:for(;;){for(b=y[M>>2]|0,A=0;;){if((A|0)>=(b|0))break e;if(E=y[m>>2]|0,N=y[E+(A<<2)>>2]|0,!N)A=A+1|0;else break}A=E+(~~(+Gi(+(+Wn(10,+ +(15-(y[B>>2]|0)|0))*(+Ee[N>>3]+ +Ee[N+8>>3])))%+(b|0))>>>0<<2)|0,b=y[A>>2]|0;t:do if(b|0){if(E=N+32|0,(b|0)==(N|0))y[A>>2]=y[E>>2];else{if(b=b+32|0,A=y[b>>2]|0,!A)break;for(;(A|0)!=(N|0);)if(b=A+32|0,A=y[b>>2]|0,!A)break t;y[b>>2]=y[E>>2]}Be(N),y[F>>2]=(y[F>>2]|0)+-1}while(!1)}Be(y[m>>2]|0)}function ne(m){m=m|0;var A=0,b=0,E=0;for(E=y[m+4>>2]|0,b=0;;){if((b|0)>=(E|0)){A=0,b=4;break}if(A=y[(y[m>>2]|0)+(b<<2)>>2]|0,!A)b=b+1|0;else{b=4;break}}return(b|0)==4?A|0:0}function ie(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;if(b=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,b=(y[m>>2]|0)+(b<<2)|0,E=y[b>>2]|0,!E)return B=1,B|0;B=A+32|0;do if((E|0)!=(A|0)){if(b=y[E+32>>2]|0,!b)return B=1,B|0;for(M=b;;){if((M|0)==(A|0)){M=8;break}if(b=y[M+32>>2]|0,b)E=M,M=b;else{b=1,M=10;break}}if((M|0)==8){y[E+32>>2]=y[B>>2];break}else if((M|0)==10)return b|0}else y[b>>2]=y[B>>2];while(!1);return Be(A),B=m+8|0,y[B>>2]=(y[B>>2]|0)+-1,B=0,B|0}function fe(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;B=Ve(40)|0,B||Nr(23390,23360,98,23403),y[B>>2]=y[A>>2],y[B+4>>2]=y[A+4>>2],y[B+8>>2]=y[A+8>>2],y[B+12>>2]=y[A+12>>2],M=B+16|0,y[M>>2]=y[b>>2],y[M+4>>2]=y[b+4>>2],y[M+8>>2]=y[b+8>>2],y[M+12>>2]=y[b+12>>2],y[B+32>>2]=0,M=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,M=(y[m>>2]|0)+(M<<2)|0,E=y[M>>2]|0;do if(!E)y[M>>2]=B;else{for(;!(gl(E,A)|0&&gl(E+16|0,b)|0);)if(M=y[E+32>>2]|0,E=M|0?M:E,!(y[E+32>>2]|0)){F=10;break}if((F|0)==10){y[E+32>>2]=B;break}return Be(B),F=E,F|0}while(!1);return F=m+8|0,y[F>>2]=(y[F>>2]|0)+1,F=B,F|0}function Ae(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0;if(M=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,M=y[(y[m>>2]|0)+(M<<2)>>2]|0,!M)return b=0,b|0;if(!b){for(m=M;;){if(gl(m,A)|0){E=10;break}if(m=y[m+32>>2]|0,!m){m=0,E=10;break}}if((E|0)==10)return m|0}for(m=M;;){if(gl(m,A)|0&&gl(m+16|0,b)|0){E=10;break}if(m=y[m+32>>2]|0,!m){m=0,E=10;break}}return(E|0)==10?m|0:0}function Ie(m,A){m=m|0,A=A|0;var b=0;if(b=~~(+Gi(+(+Wn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,m=y[(y[m>>2]|0)+(b<<2)>>2]|0,!m)return b=0,b|0;for(;;){if(gl(m,A)|0){A=5;break}if(m=y[m+32>>2]|0,!m){m=0,A=5;break}}return(A|0)==5?m|0:0}function Ce(){return 23424}function Pe(m){return m=+m,+ +Wi(+m)}function Fe(m){return m=+m,~~+Pe(m)|0}function Ve(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0;ar=be,be=be+16|0,$e=ar;do if(m>>>0<245){if(Q=m>>>0<11?16:m+11&-8,m=Q>>>3,we=y[5857]|0,b=we>>>m,b&3|0)return A=(b&1^1)+m|0,m=23468+(A<<1<<2)|0,b=m+8|0,E=y[b>>2]|0,M=E+8|0,B=y[M>>2]|0,(B|0)==(m|0)?y[5857]=we&~(1<<A):(y[B+12>>2]=m,y[b>>2]=B),ft=A<<3,y[E+4>>2]=ft|3,ft=E+ft+4|0,y[ft>>2]=y[ft>>2]|1,ft=M,be=ar,ft|0;if(he=y[5859]|0,Q>>>0>he>>>0){if(b|0)return A=2<<m,A=b<<m&(A|0-A),A=(A&0-A)+-1|0,N=A>>>12&16,A=A>>>N,b=A>>>5&8,A=A>>>b,B=A>>>2&4,A=A>>>B,m=A>>>1&2,A=A>>>m,E=A>>>1&1,E=(b|N|B|m|E)+(A>>>E)|0,A=23468+(E<<1<<2)|0,m=A+8|0,B=y[m>>2]|0,N=B+8|0,b=y[N>>2]|0,(b|0)==(A|0)?(m=we&~(1<<E),y[5857]=m):(y[b+12>>2]=A,y[m>>2]=b,m=we),ft=E<<3,F=ft-Q|0,y[B+4>>2]=Q|3,M=B+Q|0,y[M+4>>2]=F|1,y[B+ft>>2]=F,he|0&&(E=y[5862]|0,A=he>>>3,b=23468+(A<<1<<2)|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=E,y[A+12>>2]=E,y[E+8>>2]=A,y[E+12>>2]=b),y[5859]=F,y[5862]=M,ft=N,be=ar,ft|0;if(B=y[5858]|0,B){for(b=(B&0-B)+-1|0,M=b>>>12&16,b=b>>>M,E=b>>>5&8,b=b>>>E,F=b>>>2&4,b=b>>>F,N=b>>>1&2,b=b>>>N,W=b>>>1&1,W=y[23732+((E|M|F|N|W)+(b>>>W)<<2)>>2]|0,b=W,N=W,W=(y[W+4>>2]&-8)-Q|0;m=y[b+16>>2]|0,!(!m&&(m=y[b+20>>2]|0,!m));)F=(y[m+4>>2]&-8)-Q|0,M=F>>>0<W>>>0,b=m,N=M?m:N,W=M?F:W;if(F=N+Q|0,F>>>0>N>>>0){M=y[N+24>>2]|0,A=y[N+12>>2]|0;do if((A|0)==(N|0)){if(m=N+20|0,A=y[m>>2]|0,!A&&(m=N+16|0,A=y[m>>2]|0,!A)){b=0;break}for(;;)if(E=A+20|0,b=y[E>>2]|0,b)A=b,m=E;else if(E=A+16|0,b=y[E>>2]|0,b)A=b,m=E;else break;y[m>>2]=0,b=A}else b=y[N+8>>2]|0,y[b+12>>2]=A,y[A+8>>2]=b,b=A;while(!1);do if(M|0){if(A=y[N+28>>2]|0,m=23732+(A<<2)|0,(N|0)==(y[m>>2]|0)){if(y[m>>2]=b,!b){y[5858]=B&~(1<<A);break}}else if(ft=M+16|0,y[((y[ft>>2]|0)==(N|0)?ft:M+20|0)>>2]=b,!b)break;y[b+24>>2]=M,A=y[N+16>>2]|0,A|0&&(y[b+16>>2]=A,y[A+24>>2]=b),A=y[N+20>>2]|0,A|0&&(y[b+20>>2]=A,y[A+24>>2]=b)}while(!1);return W>>>0<16?(ft=W+Q|0,y[N+4>>2]=ft|3,ft=N+ft+4|0,y[ft>>2]=y[ft>>2]|1):(y[N+4>>2]=Q|3,y[F+4>>2]=W|1,y[F+W>>2]=W,he|0&&(E=y[5862]|0,A=he>>>3,b=23468+(A<<1<<2)|0,A=1<<A,A&we?(m=b+8|0,A=y[m>>2]|0):(y[5857]=A|we,A=b,m=b+8|0),y[m>>2]=E,y[A+12>>2]=E,y[E+8>>2]=A,y[E+12>>2]=b),y[5859]=W,y[5862]=F),ft=N+8|0,be=ar,ft|0}else we=Q}else we=Q}else we=Q}else if(m>>>0<=4294967231)if(m=m+11|0,Q=m&-8,E=y[5858]|0,E){M=0-Q|0,m=m>>>8,m?Q>>>0>16777215?W=31:(we=(m+1048320|0)>>>16&8,nt=m<<we,N=(nt+520192|0)>>>16&4,nt=nt<<N,W=(nt+245760|0)>>>16&2,W=14-(N|we|W)+(nt<<W>>>15)|0,W=Q>>>(W+7|0)&1|W<<1):W=0,b=y[23732+(W<<2)>>2]|0;e:do if(!b)b=0,m=0,nt=61;else for(m=0,N=Q<<((W|0)==31?0:25-(W>>>1)|0),B=0;;){if(F=(y[b+4>>2]&-8)-Q|0,F>>>0<M>>>0)if(F)m=b,M=F;else{m=b,M=0,nt=65;break e}if(nt=y[b+20>>2]|0,b=y[b+16+(N>>>31<<2)>>2]|0,B=(nt|0)==0|(nt|0)==(b|0)?B:nt,b)N=N<<1;else{b=B,nt=61;break}}while(!1);if((nt|0)==61){if((b|0)==0&(m|0)==0){if(m=2<<W,m=(m|0-m)&E,!m){we=Q;break}we=(m&0-m)+-1|0,F=we>>>12&16,we=we>>>F,B=we>>>5&8,we=we>>>B,N=we>>>2&4,we=we>>>N,W=we>>>1&2,we=we>>>W,b=we>>>1&1,m=0,b=y[23732+((B|F|N|W|b)+(we>>>b)<<2)>>2]|0}b?nt=65:(N=m,F=M)}if((nt|0)==65)for(B=b;;)if(we=(y[B+4>>2]&-8)-Q|0,b=we>>>0<M>>>0,M=b?we:M,m=b?B:m,b=y[B+16>>2]|0,b||(b=y[B+20>>2]|0),b)B=b;else{N=m,F=M;break}if(N|0&&F>>>0<((y[5859]|0)-Q|0)>>>0&&(he=N+Q|0,he>>>0>N>>>0)){B=y[N+24>>2]|0,A=y[N+12>>2]|0;do if((A|0)==(N|0)){if(m=N+20|0,A=y[m>>2]|0,!A&&(m=N+16|0,A=y[m>>2]|0,!A)){A=0;break}for(;;)if(M=A+20|0,b=y[M>>2]|0,b)A=b,m=M;else if(M=A+16|0,b=y[M>>2]|0,b)A=b,m=M;else break;y[m>>2]=0}else ft=y[N+8>>2]|0,y[ft+12>>2]=A,y[A+8>>2]=ft;while(!1);do if(B){if(m=y[N+28>>2]|0,b=23732+(m<<2)|0,(N|0)==(y[b>>2]|0)){if(y[b>>2]=A,!A){E=E&~(1<<m),y[5858]=E;break}}else if(ft=B+16|0,y[((y[ft>>2]|0)==(N|0)?ft:B+20|0)>>2]=A,!A)break;y[A+24>>2]=B,m=y[N+16>>2]|0,m|0&&(y[A+16>>2]=m,y[m+24>>2]=A),m=y[N+20>>2]|0,m&&(y[A+20>>2]=m,y[m+24>>2]=A)}while(!1);e:do if(F>>>0<16)ft=F+Q|0,y[N+4>>2]=ft|3,ft=N+ft+4|0,y[ft>>2]=y[ft>>2]|1;else{if(y[N+4>>2]=Q|3,y[he+4>>2]=F|1,y[he+F>>2]=F,A=F>>>3,F>>>0<256){b=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=he,y[A+12>>2]=he,y[he+8>>2]=A,y[he+12>>2]=b;break}if(A=F>>>8,A?F>>>0>16777215?b=31:(bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,b=(ft+245760|0)>>>16&2,b=14-(at|bt|b)+(ft<<b>>>15)|0,b=F>>>(b+7|0)&1|b<<1):b=0,A=23732+(b<<2)|0,y[he+28>>2]=b,m=he+16|0,y[m+4>>2]=0,y[m>>2]=0,m=1<<b,!(E&m)){y[5858]=E|m,y[A>>2]=he,y[he+24>>2]=A,y[he+12>>2]=he,y[he+8>>2]=he;break}A=y[A>>2]|0;t:do if((y[A+4>>2]&-8|0)!=(F|0)){for(E=F<<((b|0)==31?0:25-(b>>>1)|0);b=A+16+(E>>>31<<2)|0,m=y[b>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(F|0)){A=m;break t}else E=E<<1,A=m;y[b>>2]=he,y[he+24>>2]=A,y[he+12>>2]=he,y[he+8>>2]=he;break e}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=he,y[bt>>2]=he,y[he+8>>2]=ft,y[he+12>>2]=A,y[he+24>>2]=0}while(!1);return ft=N+8|0,be=ar,ft|0}else we=Q}else we=Q;else we=-1;while(!1);if(b=y[5859]|0,b>>>0>=we>>>0)return A=b-we|0,m=y[5862]|0,A>>>0>15?(ft=m+we|0,y[5862]=ft,y[5859]=A,y[ft+4>>2]=A|1,y[m+b>>2]=A,y[m+4>>2]=we|3):(y[5859]=0,y[5862]=0,y[m+4>>2]=b|3,ft=m+b+4|0,y[ft>>2]=y[ft>>2]|1),ft=m+8|0,be=ar,ft|0;if(F=y[5860]|0,F>>>0>we>>>0)return at=F-we|0,y[5860]=at,ft=y[5863]|0,bt=ft+we|0,y[5863]=bt,y[bt+4>>2]=at|1,y[ft+4>>2]=we|3,ft=ft+8|0,be=ar,ft|0;if(y[5975]|0?m=y[5977]|0:(y[5977]=4096,y[5976]=4096,y[5978]=-1,y[5979]=-1,y[5980]=0,y[5968]=0,y[5975]=$e&-16^1431655768,m=4096),N=we+48|0,W=we+47|0,B=m+W|0,M=0-m|0,Q=B&M,Q>>>0<=we>>>0||(m=y[5967]|0,m|0&&(he=y[5965]|0,$e=he+Q|0,$e>>>0<=he>>>0|$e>>>0>m>>>0)))return ft=0,be=ar,ft|0;e:do if(y[5968]&4)A=0,nt=143;else{b=y[5863]|0;t:do if(b){for(E=23876;$e=y[E>>2]|0,!($e>>>0<=b>>>0&&($e+(y[E+4>>2]|0)|0)>>>0>b>>>0);)if(m=y[E+8>>2]|0,m)E=m;else{nt=128;break t}if(A=B-F&M,A>>>0<2147483647)if(m=vi(A|0)|0,(m|0)==((y[E>>2]|0)+(y[E+4>>2]|0)|0)){if((m|0)!=-1){F=A,B=m,nt=145;break e}}else E=m,nt=136;else A=0}else nt=128;while(!1);do if((nt|0)==128)if(b=vi(0)|0,(b|0)!=-1&&(A=b,Qe=y[5976]|0,Ue=Qe+-1|0,A=(Ue&A|0?(Ue+A&0-Qe)-A|0:0)+Q|0,Qe=y[5965]|0,Ue=A+Qe|0,A>>>0>we>>>0&A>>>0<2147483647)){if($e=y[5967]|0,$e|0&&Ue>>>0<=Qe>>>0|Ue>>>0>$e>>>0){A=0;break}if(m=vi(A|0)|0,(m|0)==(b|0)){F=A,B=b,nt=145;break e}else E=m,nt=136}else A=0;while(!1);do if((nt|0)==136){if(b=0-A|0,!(N>>>0>A>>>0&(A>>>0<2147483647&(E|0)!=-1)))if((E|0)==-1){A=0;break}else{F=A,B=E,nt=145;break e}if(m=y[5977]|0,m=W-A+m&0-m,m>>>0>=2147483647){F=A,B=E,nt=145;break e}if((vi(m|0)|0)==-1){vi(b|0)|0,A=0;break}else{F=m+A|0,B=E,nt=145;break e}}while(!1);y[5968]=y[5968]|4,nt=143}while(!1);if((nt|0)==143&&Q>>>0<2147483647&&(at=vi(Q|0)|0,Ue=vi(0)|0,It=Ue-at|0,wt=It>>>0>(we+40|0)>>>0,!((at|0)==-1|wt^1|at>>>0<Ue>>>0&((at|0)!=-1&(Ue|0)!=-1)^1))&&(F=wt?It:A,B=at,nt=145),(nt|0)==145){A=(y[5965]|0)+F|0,y[5965]=A,A>>>0>(y[5966]|0)>>>0&&(y[5966]=A),W=y[5863]|0;e:do if(W){for(A=23876;;){if(m=y[A>>2]|0,b=y[A+4>>2]|0,(B|0)==(m+b|0)){nt=154;break}if(E=y[A+8>>2]|0,E)A=E;else break}if((nt|0)==154&&(bt=A+4|0,(y[A+12>>2]&8|0)==0)&&B>>>0>W>>>0&m>>>0<=W>>>0){y[bt>>2]=b+F,ft=(y[5860]|0)+F|0,at=W+8|0,at=at&7|0?0-at&7:0,bt=W+at|0,at=ft-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[W+ft+4>>2]=40,y[5864]=y[5979];break}for(B>>>0<(y[5861]|0)>>>0&&(y[5861]=B),b=B+F|0,A=23876;;){if((y[A>>2]|0)==(b|0)){nt=162;break}if(m=y[A+8>>2]|0,m)A=m;else break}if((nt|0)==162&&!(y[A+12>>2]&8|0)){y[A>>2]=B,he=A+4|0,y[he>>2]=(y[he>>2]|0)+F,he=B+8|0,he=B+(he&7|0?0-he&7:0)|0,A=b+8|0,A=b+(A&7|0?0-A&7:0)|0,Q=he+we|0,N=A-he-we|0,y[he+4>>2]=we|3;t:do if((W|0)==(A|0))ft=(y[5860]|0)+N|0,y[5860]=ft,y[5863]=Q,y[Q+4>>2]=ft|1;else{if((y[5862]|0)==(A|0)){ft=(y[5859]|0)+N|0,y[5859]=ft,y[5862]=Q,y[Q+4>>2]=ft|1,y[Q+ft>>2]=ft;break}if(m=y[A+4>>2]|0,(m&3|0)==1){F=m&-8,E=m>>>3;r:do if(m>>>0<256)if(m=y[A+8>>2]|0,b=y[A+12>>2]|0,(b|0)==(m|0)){y[5857]=y[5857]&~(1<<E);break}else{y[m+12>>2]=b,y[b+8>>2]=m;break}else{B=y[A+24>>2]|0,m=y[A+12>>2]|0;do if((m|0)==(A|0)){if(b=A+16|0,E=b+4|0,m=y[E>>2]|0,m)b=E;else if(m=y[b>>2]|0,!m){m=0;break}for(;;)if(M=m+20|0,E=y[M>>2]|0,E)m=E,b=M;else if(M=m+16|0,E=y[M>>2]|0,E)m=E,b=M;else break;y[b>>2]=0}else ft=y[A+8>>2]|0,y[ft+12>>2]=m,y[m+8>>2]=ft;while(!1);if(!B)break;b=y[A+28>>2]|0,E=23732+(b<<2)|0;do if((y[E>>2]|0)!=(A|0)){if(ft=B+16|0,y[((y[ft>>2]|0)==(A|0)?ft:B+20|0)>>2]=m,!m)break r}else{if(y[E>>2]=m,m|0)break;y[5858]=y[5858]&~(1<<b);break r}while(!1);if(y[m+24>>2]=B,b=A+16|0,E=y[b>>2]|0,E|0&&(y[m+16>>2]=E,y[E+24>>2]=m),b=y[b+4>>2]|0,!b)break;y[m+20>>2]=b,y[b+24>>2]=m}while(!1);A=A+F|0,M=F+N|0}else M=N;if(A=A+4|0,y[A>>2]=y[A>>2]&-2,y[Q+4>>2]=M|1,y[Q+M>>2]=M,A=M>>>3,M>>>0<256){b=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=Q,y[A+12>>2]=Q,y[Q+8>>2]=A,y[Q+12>>2]=b;break}A=M>>>8;do if(!A)E=0;else{if(M>>>0>16777215){E=31;break}bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,E=(ft+245760|0)>>>16&2,E=14-(at|bt|E)+(ft<<E>>>15)|0,E=M>>>(E+7|0)&1|E<<1}while(!1);if(A=23732+(E<<2)|0,y[Q+28>>2]=E,m=Q+16|0,y[m+4>>2]=0,y[m>>2]=0,m=y[5858]|0,b=1<<E,!(m&b)){y[5858]=m|b,y[A>>2]=Q,y[Q+24>>2]=A,y[Q+12>>2]=Q,y[Q+8>>2]=Q;break}A=y[A>>2]|0;r:do if((y[A+4>>2]&-8|0)!=(M|0)){for(E=M<<((E|0)==31?0:25-(E>>>1)|0);b=A+16+(E>>>31<<2)|0,m=y[b>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(M|0)){A=m;break r}else E=E<<1,A=m;y[b>>2]=Q,y[Q+24>>2]=A,y[Q+12>>2]=Q,y[Q+8>>2]=Q;break t}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=Q,y[bt>>2]=Q,y[Q+8>>2]=ft,y[Q+12>>2]=A,y[Q+24>>2]=0}while(!1);return ft=he+8|0,be=ar,ft|0}for(A=23876;m=y[A>>2]|0,!(m>>>0<=W>>>0&&(ft=m+(y[A+4>>2]|0)|0,ft>>>0>W>>>0));)A=y[A+8>>2]|0;M=ft+-47|0,m=M+8|0,m=M+(m&7|0?0-m&7:0)|0,M=W+16|0,m=m>>>0<M>>>0?W:m,A=m+8|0,b=F+-40|0,at=B+8|0,at=at&7|0?0-at&7:0,bt=B+at|0,at=b-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[B+b+4>>2]=40,y[5864]=y[5979],b=m+4|0,y[b>>2]=27,y[A>>2]=y[5969],y[A+4>>2]=y[5970],y[A+8>>2]=y[5971],y[A+12>>2]=y[5972],y[5969]=B,y[5970]=F,y[5972]=0,y[5971]=A,A=m+24|0;do bt=A,A=A+4|0,y[A>>2]=7;while((bt+8|0)>>>0<ft>>>0);if((m|0)!=(W|0)){if(B=m-W|0,y[b>>2]=y[b>>2]&-2,y[W+4>>2]=B|1,y[m>>2]=B,A=B>>>3,B>>>0<256){b=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=b+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=b,m=b+8|0),y[m>>2]=W,y[A+12>>2]=W,y[W+8>>2]=A,y[W+12>>2]=b;break}if(A=B>>>8,A?B>>>0>16777215?E=31:(bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,E=(ft+245760|0)>>>16&2,E=14-(at|bt|E)+(ft<<E>>>15)|0,E=B>>>(E+7|0)&1|E<<1):E=0,b=23732+(E<<2)|0,y[W+28>>2]=E,y[W+20>>2]=0,y[M>>2]=0,A=y[5858]|0,m=1<<E,!(A&m)){y[5858]=A|m,y[b>>2]=W,y[W+24>>2]=b,y[W+12>>2]=W,y[W+8>>2]=W;break}A=y[b>>2]|0;t:do if((y[A+4>>2]&-8|0)!=(B|0)){for(E=B<<((E|0)==31?0:25-(E>>>1)|0);b=A+16+(E>>>31<<2)|0,m=y[b>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(B|0)){A=m;break t}else E=E<<1,A=m;y[b>>2]=W,y[W+24>>2]=A,y[W+12>>2]=W,y[W+8>>2]=W;break e}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=W,y[bt>>2]=W,y[W+8>>2]=ft,y[W+12>>2]=A,y[W+24>>2]=0}}else ft=y[5861]|0,(ft|0)==0|B>>>0<ft>>>0&&(y[5861]=B),y[5969]=B,y[5970]=F,y[5972]=0,y[5866]=y[5975],y[5865]=-1,y[5870]=23468,y[5869]=23468,y[5872]=23476,y[5871]=23476,y[5874]=23484,y[5873]=23484,y[5876]=23492,y[5875]=23492,y[5878]=23500,y[5877]=23500,y[5880]=23508,y[5879]=23508,y[5882]=23516,y[5881]=23516,y[5884]=23524,y[5883]=23524,y[5886]=23532,y[5885]=23532,y[5888]=23540,y[5887]=23540,y[5890]=23548,y[5889]=23548,y[5892]=23556,y[5891]=23556,y[5894]=23564,y[5893]=23564,y[5896]=23572,y[5895]=23572,y[5898]=23580,y[5897]=23580,y[5900]=23588,y[5899]=23588,y[5902]=23596,y[5901]=23596,y[5904]=23604,y[5903]=23604,y[5906]=23612,y[5905]=23612,y[5908]=23620,y[5907]=23620,y[5910]=23628,y[5909]=23628,y[5912]=23636,y[5911]=23636,y[5914]=23644,y[5913]=23644,y[5916]=23652,y[5915]=23652,y[5918]=23660,y[5917]=23660,y[5920]=23668,y[5919]=23668,y[5922]=23676,y[5921]=23676,y[5924]=23684,y[5923]=23684,y[5926]=23692,y[5925]=23692,y[5928]=23700,y[5927]=23700,y[5930]=23708,y[5929]=23708,y[5932]=23716,y[5931]=23716,ft=F+-40|0,at=B+8|0,at=at&7|0?0-at&7:0,bt=B+at|0,at=ft-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[B+ft+4>>2]=40,y[5864]=y[5979];while(!1);if(A=y[5860]|0,A>>>0>we>>>0)return at=A-we|0,y[5860]=at,ft=y[5863]|0,bt=ft+we|0,y[5863]=bt,y[bt+4>>2]=at|1,y[ft+4>>2]=we|3,ft=ft+8|0,be=ar,ft|0}return ft=Ce()|0,y[ft>>2]=12,ft=0,be=ar,ft|0}function Be(m){m=m|0;var A=0,b=0,E=0,M=0,B=0,F=0,N=0,W=0;if(m){b=m+-8|0,M=y[5861]|0,m=y[m+-4>>2]|0,A=m&-8,W=b+A|0;do if(m&1)N=b,F=b;else{if(E=y[b>>2]|0,!(m&3)||(F=b+(0-E)|0,B=E+A|0,F>>>0<M>>>0))return;if((y[5862]|0)==(F|0)){if(m=W+4|0,A=y[m>>2]|0,(A&3|0)!=3){N=F,A=B;break}y[5859]=B,y[m>>2]=A&-2,y[F+4>>2]=B|1,y[F+B>>2]=B;return}if(b=E>>>3,E>>>0<256)if(m=y[F+8>>2]|0,A=y[F+12>>2]|0,(A|0)==(m|0)){y[5857]=y[5857]&~(1<<b),N=F,A=B;break}else{y[m+12>>2]=A,y[A+8>>2]=m,N=F,A=B;break}M=y[F+24>>2]|0,m=y[F+12>>2]|0;do if((m|0)==(F|0)){if(A=F+16|0,b=A+4|0,m=y[b>>2]|0,m)A=b;else if(m=y[A>>2]|0,!m){m=0;break}for(;;)if(E=m+20|0,b=y[E>>2]|0,b)m=b,A=E;else if(E=m+16|0,b=y[E>>2]|0,b)m=b,A=E;else break;y[A>>2]=0}else N=y[F+8>>2]|0,y[N+12>>2]=m,y[m+8>>2]=N;while(!1);if(M){if(A=y[F+28>>2]|0,b=23732+(A<<2)|0,(y[b>>2]|0)==(F|0)){if(y[b>>2]=m,!m){y[5858]=y[5858]&~(1<<A),N=F,A=B;break}}else if(N=M+16|0,y[((y[N>>2]|0)==(F|0)?N:M+20|0)>>2]=m,!m){N=F,A=B;break}y[m+24>>2]=M,A=F+16|0,b=y[A>>2]|0,b|0&&(y[m+16>>2]=b,y[b+24>>2]=m),A=y[A+4>>2]|0,A?(y[m+20>>2]=A,y[A+24>>2]=m,N=F,A=B):(N=F,A=B)}else N=F,A=B}while(!1);if(!(F>>>0>=W>>>0)&&(m=W+4|0,E=y[m>>2]|0,!!(E&1))){if(E&2)y[m>>2]=E&-2,y[N+4>>2]=A|1,y[F+A>>2]=A,M=A;else{if((y[5863]|0)==(W|0)){if(W=(y[5860]|0)+A|0,y[5860]=W,y[5863]=N,y[N+4>>2]=W|1,(N|0)!=(y[5862]|0))return;y[5862]=0,y[5859]=0;return}if((y[5862]|0)==(W|0)){W=(y[5859]|0)+A|0,y[5859]=W,y[5862]=F,y[N+4>>2]=W|1,y[F+W>>2]=W;return}M=(E&-8)+A|0,b=E>>>3;do if(E>>>0<256)if(A=y[W+8>>2]|0,m=y[W+12>>2]|0,(m|0)==(A|0)){y[5857]=y[5857]&~(1<<b);break}else{y[A+12>>2]=m,y[m+8>>2]=A;break}else{B=y[W+24>>2]|0,m=y[W+12>>2]|0;do if((m|0)==(W|0)){if(A=W+16|0,b=A+4|0,m=y[b>>2]|0,m)A=b;else if(m=y[A>>2]|0,!m){b=0;break}for(;;)if(E=m+20|0,b=y[E>>2]|0,b)m=b,A=E;else if(E=m+16|0,b=y[E>>2]|0,b)m=b,A=E;else break;y[A>>2]=0,b=m}else b=y[W+8>>2]|0,y[b+12>>2]=m,y[m+8>>2]=b,b=m;while(!1);if(B|0){if(m=y[W+28>>2]|0,A=23732+(m<<2)|0,(y[A>>2]|0)==(W|0)){if(y[A>>2]=b,!b){y[5858]=y[5858]&~(1<<m);break}}else if(E=B+16|0,y[((y[E>>2]|0)==(W|0)?E:B+20|0)>>2]=b,!b)break;y[b+24>>2]=B,m=W+16|0,A=y[m>>2]|0,A|0&&(y[b+16>>2]=A,y[A+24>>2]=b),m=y[m+4>>2]|0,m|0&&(y[b+20>>2]=m,y[m+24>>2]=b)}}while(!1);if(y[N+4>>2]=M|1,y[F+M>>2]=M,(N|0)==(y[5862]|0)){y[5859]=M;return}}if(m=M>>>3,M>>>0<256){b=23468+(m<<1<<2)|0,A=y[5857]|0,m=1<<m,A&m?(A=b+8|0,m=y[A>>2]|0):(y[5857]=A|m,m=b,A=b+8|0),y[A>>2]=N,y[m+12>>2]=N,y[N+8>>2]=m,y[N+12>>2]=b;return}m=M>>>8,m?M>>>0>16777215?E=31:(F=(m+1048320|0)>>>16&8,W=m<<F,B=(W+520192|0)>>>16&4,W=W<<B,E=(W+245760|0)>>>16&2,E=14-(B|F|E)+(W<<E>>>15)|0,E=M>>>(E+7|0)&1|E<<1):E=0,m=23732+(E<<2)|0,y[N+28>>2]=E,y[N+20>>2]=0,y[N+16>>2]=0,A=y[5858]|0,b=1<<E;e:do if(!(A&b))y[5858]=A|b,y[m>>2]=N,y[N+24>>2]=m,y[N+12>>2]=N,y[N+8>>2]=N;else{m=y[m>>2]|0;t:do if((y[m+4>>2]&-8|0)!=(M|0)){for(E=M<<((E|0)==31?0:25-(E>>>1)|0);b=m+16+(E>>>31<<2)|0,A=y[b>>2]|0,!!A;)if((y[A+4>>2]&-8|0)==(M|0)){m=A;break t}else E=E<<1,m=A;y[b>>2]=N,y[N+24>>2]=m,y[N+12>>2]=N,y[N+8>>2]=N;break e}while(!1);F=m+8|0,W=y[F>>2]|0,y[W+12>>2]=N,y[F>>2]=N,y[N+8>>2]=W,y[N+12>>2]=m,y[N+24>>2]=0}while(!1);if(W=(y[5865]|0)+-1|0,y[5865]=W,!(W|0)){for(m=23884;m=y[m>>2]|0,m;)m=m+8|0;y[5865]=-1}}}}function qe(m,A){m=m|0,A=A|0;var b=0;return m?(b=ba(A,m)|0,(A|m)>>>0>65535&&(b=((b>>>0)/(m>>>0)|0|0)==(A|0)?b:-1)):b=0,m=Ve(b)|0,!m||!(y[m+-4>>2]&3)||Ui(m|0,0,b|0)|0,m|0}function Ge(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,b=m+b>>>0,Kr(A+E+(b>>>0<m>>>0|0)>>>0|0),b|0|0}function Ze(m,A,b,E){return m=m|0,A=A|0,b=b|0,E=E|0,E=A-E-(b>>>0>m>>>0|0)>>>0,Kr(E|0),m-b>>>0|0|0}function _t(m){return m=m|0,(m?31-(Ql(m^m-1)|0)|0:32)|0}function At(m,A,b,E,M){m=m|0,A=A|0,b=b|0,E=E|0,M=M|0;var B=0,F=0,N=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(he=m,W=A,Q=W,F=b,$e=E,N=$e,!Q)return B=(M|0)!=0,N?B?(y[M>>2]=m|0,y[M+4>>2]=A&0,$e=0,M=0,Kr($e|0),M|0):($e=0,M=0,Kr($e|0),M|0):(B&&(y[M>>2]=(he>>>0)%(F>>>0),y[M+4>>2]=0),$e=0,M=(he>>>0)/(F>>>0)>>>0,Kr($e|0),M|0);B=(N|0)==0;do if(F){if(!B){if(B=(Ql(N|0)|0)-(Ql(Q|0)|0)|0,B>>>0<=31){we=B+1|0,N=31-B|0,A=B-31>>31,F=we,m=he>>>(we>>>0)&A|Q<<N,A=Q>>>(we>>>0)&A,B=0,N=he<<N;break}return M?(y[M>>2]=m|0,y[M+4>>2]=W|A&0,$e=0,M=0,Kr($e|0),M|0):($e=0,M=0,Kr($e|0),M|0)}if(B=F-1|0,B&F|0){N=(Ql(F|0)|0)+33-(Ql(Q|0)|0)|0,Ue=64-N|0,we=32-N|0,W=we>>31,Qe=N-32|0,A=Qe>>31,F=N,m=we-1>>31&Q>>>(Qe>>>0)|(Q<<we|he>>>(N>>>0))&A,A=A&Q>>>(N>>>0),B=he<<Ue&W,N=(Q<<Ue|he>>>(Qe>>>0))&W|he<<we&N-33>>31;break}return M|0&&(y[M>>2]=B&he,y[M+4>>2]=0),(F|0)==1?(Qe=W|A&0,Ue=m|0|0,Kr(Qe|0),Ue|0):(Ue=_t(F|0)|0,Qe=Q>>>(Ue>>>0)|0,Ue=Q<<32-Ue|he>>>(Ue>>>0)|0,Kr(Qe|0),Ue|0)}else{if(B)return M|0&&(y[M>>2]=(Q>>>0)%(F>>>0),y[M+4>>2]=0),Qe=0,Ue=(Q>>>0)/(F>>>0)>>>0,Kr(Qe|0),Ue|0;if(!he)return M|0&&(y[M>>2]=0,y[M+4>>2]=(Q>>>0)%(N>>>0)),Qe=0,Ue=(Q>>>0)/(N>>>0)>>>0,Kr(Qe|0),Ue|0;if(B=N-1|0,!(B&N))return M|0&&(y[M>>2]=m|0,y[M+4>>2]=B&Q|A&0),Qe=0,Ue=Q>>>((_t(N|0)|0)>>>0),Kr(Qe|0),Ue|0;if(B=(Ql(N|0)|0)-(Ql(Q|0)|0)|0,B>>>0<=30){A=B+1|0,N=31-B|0,F=A,m=Q<<N|he>>>(A>>>0),A=Q>>>(A>>>0),B=0,N=he<<N;break}return M?(y[M>>2]=m|0,y[M+4>>2]=W|A&0,Qe=0,Ue=0,Kr(Qe|0),Ue|0):(Qe=0,Ue=0,Kr(Qe|0),Ue|0)}while(!1);if(!F)Q=N,W=0,N=0;else{we=b|0|0,he=$e|E&0,Q=Ge(we|0,he|0,-1,-1)|0,b=Me()|0,W=N,N=0;do E=W,W=B>>>31|W<<1,B=N|B<<1,E=m<<1|E>>>31|0,$e=m>>>31|A<<1|0,Ze(Q|0,b|0,E|0,$e|0)|0,Ue=Me()|0,Qe=Ue>>31|((Ue|0)<0?-1:0)<<1,N=Qe&1,m=Ze(E|0,$e|0,Qe&we|0,(((Ue|0)<0?-1:0)>>31|((Ue|0)<0?-1:0)<<1)&he|0)|0,A=Me()|0,F=F-1|0;while(F|0);Q=W,W=0}return F=0,M|0&&(y[M>>2]=m,y[M+4>>2]=A),Qe=(B|0)>>>31|(Q|F)<<1|(F<<1|B>>>31)&0|W,Ue=(B<<1|0)&-2|N,Kr(Qe|0),Ue|0}function Pt(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0;return Q=A>>31|((A|0)<0?-1:0)<<1,W=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,B=E>>31|((E|0)<0?-1:0)<<1,M=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,N=Ze(Q^m|0,W^A|0,Q|0,W|0)|0,F=Me()|0,m=B^Q,A=M^W,Ze((At(N,F,Ze(B^b|0,M^E|0,B|0,M|0)|0,Me()|0,0)|0)^m|0,(Me()|0)^A|0,m|0,A|0)|0}function Lt(m,A){m=m|0,A=A|0;var b=0,E=0,M=0,B=0;return B=m&65535,M=A&65535,b=ba(M,B)|0,E=m>>>16,m=(b>>>16)+(ba(M,E)|0)|0,M=A>>>16,A=ba(M,B)|0,Kr((m>>>16)+(ba(M,E)|0)+(((m&65535)+A|0)>>>16)|0),m+A<<16|b&65535|0|0}function Tt(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;return M=m,B=b,b=Lt(M,B)|0,m=Me()|0,Kr((ba(A,B)|0)+(ba(E,M)|0)+m|m&0|0),b|0|0|0}function er(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0,F=0,N=0,W=0,Q=0;return M=be,be=be+16|0,N=M|0,F=A>>31|((A|0)<0?-1:0)<<1,B=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,Q=E>>31|((E|0)<0?-1:0)<<1,W=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,m=Ze(F^m|0,B^A|0,F|0,B|0)|0,A=Me()|0,At(m,A,Ze(Q^b|0,W^E|0,Q|0,W|0)|0,Me()|0,N)|0,E=Ze(y[N>>2]^F|0,y[N+4>>2]^B|0,F|0,B|0)|0,b=Me()|0,be=M,Kr(b|0),E|0}function Kt(m,A,b,E){m=m|0,A=A|0,b=b|0,E=E|0;var M=0,B=0;return B=be,be=be+16|0,M=B|0,At(m,A,b,E,M)|0,be=B,Kr(y[M+4>>2]|0),y[M>>2]|0|0}function Ut(m,A,b){return m=m|0,A=A|0,b=b|0,(b|0)<32?(Kr(A>>b|0),m>>>b|(A&(1<<b)-1)<<32-b):(Kr(((A|0)<0?-1:0)|0),A>>b-32|0)}function mt(m,A,b){return m=m|0,A=A|0,b=b|0,(b|0)<32?(Kr(A>>>b|0),m>>>b|(A&(1<<b)-1)<<32-b):(Kr(0),A>>>b-32|0)}function Nt(m,A,b){return m=m|0,A=A|0,b=b|0,(b|0)<32?(Kr(A<<b|(m&(1<<b)-1<<32-b)>>>32-b|0),m<<b):(Kr(m<<b-32|0),0)}function Ri(m,A){return m=+m,A=+A,m!=m?+A:A!=A?+m:+i0(+m,+A)}function Hr(m,A){return m=+m,A=+A,m!=m?+A:A!=A?+m:+Kl(+m,+A)}function zi(m){return m=+m,m>=0?+to(m+.5):+xa(m-.5)}function Zi(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0;if((b|0)>=8192)return yf(m|0,A|0,b|0)|0,m|0;if(B=m|0,M=m+b|0,(m&3)==(A&3)){for(;m&3;){if(!b)return B|0;Lr[m>>0]=Lr[A>>0]|0,m=m+1|0,A=A+1|0,b=b-1|0}for(b=M&-4|0,E=b-64|0;(m|0)<=(E|0);)y[m>>2]=y[A>>2],y[m+4>>2]=y[A+4>>2],y[m+8>>2]=y[A+8>>2],y[m+12>>2]=y[A+12>>2],y[m+16>>2]=y[A+16>>2],y[m+20>>2]=y[A+20>>2],y[m+24>>2]=y[A+24>>2],y[m+28>>2]=y[A+28>>2],y[m+32>>2]=y[A+32>>2],y[m+36>>2]=y[A+36>>2],y[m+40>>2]=y[A+40>>2],y[m+44>>2]=y[A+44>>2],y[m+48>>2]=y[A+48>>2],y[m+52>>2]=y[A+52>>2],y[m+56>>2]=y[A+56>>2],y[m+60>>2]=y[A+60>>2],m=m+64|0,A=A+64|0;for(;(m|0)<(b|0);)y[m>>2]=y[A>>2],m=m+4|0,A=A+4|0}else for(b=M-4|0;(m|0)<(b|0);)Lr[m>>0]=Lr[A>>0]|0,Lr[m+1>>0]=Lr[A+1>>0]|0,Lr[m+2>>0]=Lr[A+2>>0]|0,Lr[m+3>>0]=Lr[A+3>>0]|0,m=m+4|0,A=A+4|0;for(;(m|0)<(M|0);)Lr[m>>0]=Lr[A>>0]|0,m=m+1|0,A=A+1|0;return B|0}function Ui(m,A,b){m=m|0,A=A|0,b=b|0;var E=0,M=0,B=0,F=0;if(B=m+b|0,A=A&255,(b|0)>=67){for(;m&3;)Lr[m>>0]=A,m=m+1|0;for(E=B&-4|0,F=A|A<<8|A<<16|A<<24,M=E-64|0;(m|0)<=(M|0);)y[m>>2]=F,y[m+4>>2]=F,y[m+8>>2]=F,y[m+12>>2]=F,y[m+16>>2]=F,y[m+20>>2]=F,y[m+24>>2]=F,y[m+28>>2]=F,y[m+32>>2]=F,y[m+36>>2]=F,y[m+40>>2]=F,y[m+44>>2]=F,y[m+48>>2]=F,y[m+52>>2]=F,y[m+56>>2]=F,y[m+60>>2]=F,m=m+64|0;for(;(m|0)<(E|0);)y[m>>2]=F,m=m+4|0}for(;(m|0)<(B|0);)Lr[m>>0]=A,m=m+1|0;return B-b|0}function Wi(m){return m=+m,m>=0?+to(m+.5):+xa(m-.5)}function vi(m){m=m|0;var A=0,b=0,E=0;return E=n0()|0,b=y[fs>>2]|0,A=b+m|0,(m|0)>0&(A|0)<(b|0)|(A|0)<0?(Yd(A|0)|0,_f(12),-1):(A|0)>(E|0)&&!(va(A|0)|0)?(_f(12),-1):(y[fs>>2]=A,b|0)}return{___divdi3:Pt,___muldi3:Tt,___remdi3:er,___uremdi3:Kt,_areNeighborCells:ou,_bitshift64Ashr:Ut,_bitshift64Lshr:mt,_bitshift64Shl:Nt,_calloc:qe,_cellAreaKm2:Wg,_cellAreaM2:Ca,_cellAreaRads2:hu,_cellToBoundary:ra,_cellToCenterChild:Us,_cellToChildPos:d0,_cellToChildren:No,_cellToChildrenSize:ja,_cellToLatLng:lu,_cellToLocalIj:wh,_cellToParent:kf,_cellToVertex:S,_cellToVertexes:O,_cellsToDirectedEdge:Vg,_cellsToLinkedMultiPolygon:Qc,_childPosToCell:xh,_compactCells:Ea,_destroyLinkedMultiPolygon:jf,_directedEdgeToBoundary:lc,_directedEdgeToCells:zs,_edgeLengthKm:xr,_edgeLengthM:Rr,_edgeLengthRads:vh,_emscripten_replace_memory:Kd,_free:Be,_getBaseCellNumber:up,_getDirectedEdgeDestination:Un,_getDirectedEdgeOrigin:u0,_getHexagonAreaAvgKm2:Ha,_getHexagonAreaAvgM2:hn,_getHexagonEdgeLengthAvgKm:bh,_getHexagonEdgeLengthAvgM:Uf,_getIcosahedronFaces:zf,_getNumCells:hc,_getPentagons:cu,_getRes0Cells:eu,_getResolution:h0,_greatCircleDistanceKm:uu,_greatCircleDistanceM:pp,_greatCircleDistanceRads:dp,_gridDisk:s0,_gridDiskDistances:a0,_gridDistance:Vn,_gridPathCells:Th,_gridPathCellsSize:m0,_gridRingUnsafe:bf,_i64Add:Ge,_i64Subtract:Ze,_isPentagon:Hi,_isResClassIII:cc,_isValidCell:Ff,_isValidDirectedEdge:ac,_isValidVertex:V,_latLngToCell:ur,_llvm_maxnum_f64:Ri,_llvm_minnum_f64:Hr,_llvm_round_f64:zi,_localIjToCell:Ln,_malloc:Ve,_maxFaceCount:ml,_maxGridDiskSize:Ug,_maxPolygonToCellsSize:vf,_memcpy:Zi,_memset:Ui,_originToDirectedEdges:sp,_pentagonCount:li,_polygonToCells:Jd,_readInt64AsDoubleFromPointer:bp,_res0CellCount:c0,_round:Wi,_sbrk:vi,_sizeOfCellBoundary:dc,_sizeOfCoordIJ:xp,_sizeOfGeoLoop:yp,_sizeOfGeoPolygon:Hf,_sizeOfH3Index:_p,_sizeOfLatLng:du,_sizeOfLinkedGeoPolygon:pc,_uncompactCells:f0,_uncompactCellsSize:ds,_vertexToLatLng:z,establishStackSpace:Qd,stackAlloc:o0,stackRestore:Jl,stackSave:Pi}}(rr,nr,Oe),Fr=e.___divdi3=We.___divdi3,Cr=e.___muldi3=We.___muldi3,kr=e.___remdi3=We.___remdi3,gi=e.___uremdi3=We.___uremdi3,Gt=e._areNeighborCells=We._areNeighborCells,dr=e._bitshift64Ashr=We._bitshift64Ashr,tr=e._bitshift64Lshr=We._bitshift64Lshr,Ur=e._bitshift64Shl=We._bitshift64Shl,xn=e._calloc=We._calloc,ma=e._cellAreaKm2=We._cellAreaKm2,Pr=e._cellAreaM2=We._cellAreaM2,Kn=e._cellAreaRads2=We._cellAreaRads2,rn=e._cellToBoundary=We._cellToBoundary,ih=e._cellToCenterChild=We._cellToCenterChild,Hl=e._cellToChildPos=We._cellToChildPos,Ct=e._cellToChildren=We._cellToChildren,Yr=e._cellToChildrenSize=We._cellToChildrenSize,ii=e._cellToLatLng=We._cellToLatLng,Yo=e._cellToLocalIj=We._cellToLocalIj,Qn=e._cellToParent=We._cellToParent,Cs=e._cellToVertex=We._cellToVertex,ho=e._cellToVertexes=We._cellToVertexes,wi=e._cellsToDirectedEdge=We._cellsToDirectedEdge,Wl=e._cellsToLinkedMultiPolygon=We._cellsToLinkedMultiPolygon,ls=e._childPosToCell=We._childPosToCell,nh=e._compactCells=We._compactCells,cs=e._destroyLinkedMultiPolygon=We._destroyLinkedMultiPolygon,af=e._directedEdgeToBoundary=We._directedEdgeToBoundary,$c=e._directedEdgeToCells=We._directedEdgeToCells,Gd=e._edgeLengthKm=We._edgeLengthKm,Fa=e._edgeLengthM=We._edgeLengthM,$l=e._edgeLengthRads=We._edgeLengthRads,Jn=e._emscripten_replace_memory=We._emscripten_replace_memory,qc=e._free=We._free,KA=e._getBaseCellNumber=We._getBaseCellNumber,Dg=e._getDirectedEdgeDestination=We._getDirectedEdgeDestination,QA=e._getDirectedEdgeOrigin=We._getDirectedEdgeOrigin,Hd=e._getHexagonAreaAvgKm2=We._getHexagonAreaAvgKm2,lf=e._getHexagonAreaAvgM2=We._getHexagonAreaAvgM2,ga=e._getHexagonEdgeLengthAvgKm=We._getHexagonEdgeLengthAvgKm,hi=e._getHexagonEdgeLengthAvgM=We._getHexagonEdgeLengthAvgM,Zc=e._getIcosahedronFaces=We._getIcosahedronFaces,ql=e._getNumCells=We._getNumCells,cl=e._getPentagons=We._getPentagons,oh=e._getRes0Cells=We._getRes0Cells,Ti=e._getResolution=We._getResolution,Js=e._greatCircleDistanceKm=We._greatCircleDistanceKm,cf=e._greatCircleDistanceM=We._greatCircleDistanceM,sh=e._greatCircleDistanceRads=We._greatCircleDistanceRads,us=e._gridDisk=We._gridDisk,Fo=e._gridDiskDistances=We._gridDiskDistances,bn=e._gridDistance=We._gridDistance,Wd=e._gridPathCells=We._gridPathCells,hs=e._gridPathCellsSize=We._gridPathCellsSize,Ss=e._gridRingUnsafe=We._gridRingUnsafe,fo=e._i64Add=We._i64Add,Fg=e._i64Subtract=We._i64Subtract,Zl=e._isPentagon=We._isPentagon,vn=e._isResClassIII=We._isResClassIII,ah=e._isValidCell=We._isValidCell,Xl=e._isValidDirectedEdge=We._isValidDirectedEdge,uf=e._isValidVertex=We._isValidVertex,Is=e._latLngToCell=We._latLngToCell,mn=e._llvm_maxnum_f64=We._llvm_maxnum_f64,ka=e._llvm_minnum_f64=We._llvm_minnum_f64,Di=e._llvm_round_f64=We._llvm_round_f64,ti=e._localIjToCell=We._localIjToCell,lh=e._malloc=We._malloc,bi=e._maxFaceCount=We._maxFaceCount,ch=e._maxGridDiskSize=We._maxGridDiskSize,_a=e._maxPolygonToCellsSize=We._maxPolygonToCellsSize,hf=e._memcpy=We._memcpy,ff=e._memset=We._memset,$d=e._originToDirectedEdges=We._originToDirectedEdges,df=e._pentagonCount=We._pentagonCount,pf=e._polygonToCells=We._polygonToCells,qd=e._readInt64AsDoubleFromPointer=We._readInt64AsDoubleFromPointer,uh=e._res0CellCount=We._res0CellCount,kg=e._round=We._round,Xc=e._sbrk=We._sbrk,ko=e._sizeOfCellBoundary=We._sizeOfCellBoundary,Zd=e._sizeOfCoordIJ=We._sizeOfCoordIJ,Ng=e._sizeOfGeoLoop=We._sizeOfGeoLoop,Ko=e._sizeOfGeoPolygon=We._sizeOfGeoPolygon,eo=e._sizeOfH3Index=We._sizeOfH3Index,ya=e._sizeOfLatLng=We._sizeOfLatLng,hh=e._sizeOfLinkedGeoPolygon=We._sizeOfLinkedGeoPolygon,JA=e._uncompactCells=We._uncompactCells,zg=e._uncompactCellsSize=We._uncompactCellsSize,ul=e._vertexToLatLng=We._vertexToLatLng,e0=e.establishStackSpace=We.establishStackSpace,t0=e.stackAlloc=We.stackAlloc,Af=e.stackRestore=We.stackRestore,mf=e.stackSave=We.stackSave;if(e.asm=We,e.cwrap=me,e.setValue=j,e.getValue=q,kt){ai(kt)||(kt=a(kt));{jr("memory initializer");var Ms=function(gt){gt.byteLength&&(gt=new Uint8Array(gt)),De.set(gt,k),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Jt("memory initializer")},Xd=function(){c(kt,Ms,function(){throw"could not load memory initializer "+kt})},hl=zt(kt);if(hl)Ms(hl.buffer);else if(e.memoryInitializerRequest){var gf=function(){var gt=e.memoryInitializerRequest,Wt=gt.response;if(gt.status!==200&&gt.status!==0){var sr=zt(e.memoryInitializerRequestURL);if(sr)Wt=sr.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+gt.status+", retrying "+kt),Xd();return}}Ms(Wt)};e.memoryInitializerRequest.response?setTimeout(gf,0):e.memoryInitializerRequest.addEventListener("load",gf)}else Xd()}}var Na;bo=function gt(){Na||fh(),Na||(bo=gt)};function fh(gt){if(gt=gt||n,xo>0||(Oi(),xo>0))return;function Wt(){Na||(Na=!0,!Z&&(ui(),tn(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Ni()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Wt()},1)):Wt()}e.run=fh;function za(gt){throw e.onAbort&&e.onAbort(gt),gt+="",h(gt),p(gt),Z=!0,"abort("+gt+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=za,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return fh(),t}(typeof Ji=="object"?Ji:{}),pi="number",Zr=pi,Ox=pi,Qr=pi,Jr=pi,Zs=pi,Sr=pi,Che=[["sizeOfH3Index",pi],["sizeOfLatLng",pi],["sizeOfCellBoundary",pi],["sizeOfGeoLoop",pi],["sizeOfGeoPolygon",pi],["sizeOfLinkedGeoPolygon",pi],["sizeOfCoordIJ",pi],["readInt64AsDoubleFromPointer",pi],["isValidCell",Ox,[Qr,Jr]],["latLngToCell",Zr,[pi,pi,Zs,Sr]],["cellToLatLng",Zr,[Qr,Jr,Sr]],["cellToBoundary",Zr,[Qr,Jr,Sr]],["maxGridDiskSize",Zr,[pi,Sr]],["gridDisk",Zr,[Qr,Jr,pi,Sr]],["gridDiskDistances",Zr,[Qr,Jr,pi,Sr,Sr]],["gridRingUnsafe",Zr,[Qr,Jr,pi,Sr]],["maxPolygonToCellsSize",Zr,[Sr,Zs,pi,Sr]],["polygonToCells",Zr,[Sr,Zs,pi,Sr]],["cellsToLinkedMultiPolygon",Zr,[Sr,pi,Sr]],["destroyLinkedMultiPolygon",null,[Sr]],["compactCells",Zr,[Sr,Sr,pi,pi]],["uncompactCells",Zr,[Sr,pi,pi,Sr,pi,Zs]],["uncompactCellsSize",Zr,[Sr,pi,pi,Zs,Sr]],["isPentagon",Ox,[Qr,Jr]],["isResClassIII",Ox,[Qr,Jr]],["getBaseCellNumber",pi,[Qr,Jr]],["getResolution",pi,[Qr,Jr]],["maxFaceCount",Zr,[Qr,Jr,Sr]],["getIcosahedronFaces",Zr,[Qr,Jr,Sr]],["cellToParent",Zr,[Qr,Jr,Zs,Sr]],["cellToChildren",Zr,[Qr,Jr,Zs,Sr]],["cellToCenterChild",Zr,[Qr,Jr,Zs,Sr]],["cellToChildrenSize",Zr,[Qr,Jr,Zs,Sr]],["cellToChildPos",Zr,[Qr,Jr,Zs,Sr]],["childPosToCell",Zr,[pi,pi,Qr,Jr,Zs,Sr]],["areNeighborCells",Zr,[Qr,Jr,Qr,Jr,Sr]],["cellsToDirectedEdge",Zr,[Qr,Jr,Qr,Jr,Sr]],["getDirectedEdgeOrigin",Zr,[Qr,Jr,Sr]],["getDirectedEdgeDestination",Zr,[Qr,Jr,Sr]],["isValidDirectedEdge",Ox,[Qr,Jr]],["directedEdgeToCells",Zr,[Qr,Jr,Sr]],["originToDirectedEdges",Zr,[Qr,Jr,Sr]],["directedEdgeToBoundary",Zr,[Qr,Jr,Sr]],["gridDistance",Zr,[Qr,Jr,Qr,Jr,Sr]],["gridPathCells",Zr,[Qr,Jr,Qr,Jr,Sr]],["gridPathCellsSize",Zr,[Qr,Jr,Qr,Jr,Sr]],["cellToLocalIj",Zr,[Qr,Jr,Qr,Jr,pi,Sr]],["localIjToCell",Zr,[Qr,Jr,Sr,pi,Sr]],["getHexagonAreaAvgM2",Zr,[Zs,Sr]],["getHexagonAreaAvgKm2",Zr,[Zs,Sr]],["getHexagonEdgeLengthAvgM",Zr,[Zs,Sr]],["getHexagonEdgeLengthAvgKm",Zr,[Zs,Sr]],["greatCircleDistanceM",pi,[Sr,Sr]],["greatCircleDistanceKm",pi,[Sr,Sr]],["greatCircleDistanceRads",pi,[Sr,Sr]],["cellAreaM2",Zr,[Qr,Jr,Sr]],["cellAreaKm2",Zr,[Qr,Jr,Sr]],["cellAreaRads2",Zr,[Qr,Jr,Sr]],["edgeLengthM",Zr,[Qr,Jr,Sr]],["edgeLengthKm",Zr,[Qr,Jr,Sr]],["edgeLengthRads",Zr,[Qr,Jr,Sr]],["getNumCells",Zr,[Zs,Sr]],["getRes0Cells",Zr,[Sr]],["res0CellCount",pi],["getPentagons",Zr,[pi,Sr]],["pentagonCount",pi],["cellToVertex",Zr,[Qr,Jr,pi,Sr]],["cellToVertexes",Zr,[Qr,Jr,Sr]],["vertexToLatLng",Zr,[Qr,Jr,Sr]],["isValidVertex",Ox,[Qr,Jr]]],She=0,Ihe=1,Mhe=2,Phe=3,AV=4,Rhe=5,Bhe=6,Lhe=7,Ohe=8,Dhe=9,Fhe=10,khe=11,Nhe=12,zhe=13,Uhe=14,Vhe=15,ks={};ks[She]="Success";ks[Ihe]="The operation failed but a more specific error is not available";ks[Mhe]="Argument was outside of acceptable range";ks[Phe]="Latitude or longitude arguments were outside of acceptable range";ks[AV]="Resolution argument was outside of acceptable range";ks[Rhe]="Cell argument was not valid";ks[Bhe]="Directed edge argument was not valid";ks[Lhe]="Undirected edge argument was not valid";ks[Ohe]="Vertex argument was not valid";ks[Dhe]="Pentagon distortion was encountered";ks[Fhe]="Duplicate input";ks[khe]="Cell arguments were not neighbors";ks[Nhe]="Cell arguments had incompatible resolutions";ks[zhe]="Memory allocation failed";ks[Uhe]="Bounds of provided memory were insufficient";ks[Vhe]="Mode or flags argument was not valid";var mV=1e3,jhe=1001,gV=1002,D3={};D3[mV]="Unknown unit";D3[jhe]="Array length out of bounds";D3[gV]="Got unexpected null value for H3 index";var Ghe="Unknown error";function _V(t,e,r){var i=r&&"value"in r,n=new Error((t[e]||Ghe)+" (code: "+e+(i?", value: "+r.value:"")+")");return n.code=e,n}function yV(t,e){var r=arguments.length===2?{value:e}:{};return _V(ks,t,r)}function xV(t,e){var r=arguments.length===2?{value:e}:{};return _V(D3,t,r)}function EA(t){if(t!==0)throw yV(t)}var qo={};Che.forEach(function(e){qo[e[0]]=Ji.cwrap.apply(Ji,e)});var Jm=16;var bV=4,fV=4,Fd=8,Hhe=8,L3=qo.sizeOfH3Index(),vV=qo.sizeOfLatLng(),Whe=qo.sizeOfCellBoundary(),IHe=qo.sizeOfGeoPolygon(),MHe=qo.sizeOfGeoLoop(),$he=qo.sizeOfLinkedGeoPolygon(),PHe=qo.sizeOfCoordIJ(),dV={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function qhe(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw yV(AV,t);return t}function Zhe(t){if(!t)throw xV(gV);return t}var RHe=Math.pow(2,32)-1;var Xhe=/[^0-9a-fA-F]/;function CA(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||Xhe.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),Jm),r=parseInt(t.substring(t.length-8),Jm);return[r,e]}function pV(t){if(t>=0)return t.toString(Jm);t=t&2147483647;var e=wV(8,t.toString(Jm)),r=(parseInt(e[0],Jm)+8).toString(Jm);return e=r+e.substring(1),e}function Yhe(t,e){return pV(e)+wV(8,pV(t))}function wV(t,e){for(var r=t-e.length,i="",n=0;n<r;n++)i+="0";return i=i+e,i}var BHe=Math.pow(2,32);function Khe(t,e){e===void 0&&(e=0);var r=Ji.getValue(t+L3*e,"i32"),i=Ji.getValue(t+L3*e+bV,"i32");return i?Yhe(r,i):null}function Qhe(t,e){return e===void 0&&(e=0),Ji.getValue(t+Fd*e,"double")}function Jhe(t){return qo.readInt64AsDoubleFromPointer(t)}function efe(t,e,r){Ji.HEAPU32.set(CA(t),e/bV+2*r)}function tfe(t,e){for(var r=e.length,i=0;i<r;i++)efe(e[i],t,i)}function O3(t){return ofe(Ji.getValue(t,"double"))}function sP(t){return[O3(t),O3(t+Fd)]}function TV(t){return[O3(t+Fd),O3(t)]}function rfe(t,e,r){for(var i=Ji.getValue(t,"i32"),n=t+Fd,o=[],a=e?TV:sP,c=0;c<i*2;c+=2)o.push(a(n+Fd*c));return r&&o.push(o[0]),o}function ife(t,e){for(var r=[],i=e?TV:sP,n,o,a,c;t;){for(r.push(n=[]),o=Ji.getValue(t,"i8*");o;){for(n.push(a=[]),c=Ji.getValue(o,"i8*");c;)a.push(i(c)),c=Ji.getValue(c+Fd*2,"i8*");e&&a.push(a[0]),o=Ji.getValue(o+fV*2,"i8*")}t=Ji.getValue(t+fV*2,"i8*")}return r}function EV(t){var e=CA(t),r=e[0],i=e[1];return!!qo.isPentagon(r,i)}function CV(t){var e=CA(t),r=e[0],i=e[1];return qo.isValidCell(r,i)?qo.getResolution(r,i):-1}function SV(t,e,r){var i=Ji._malloc(vV);Ji.HEAPF64.set([t,e].map(nfe),i/Fd);var n=Ji._malloc(L3);try{return EA(qo.latLngToCell(i,r,n)),Zhe(Khe(n))}finally{Ji._free(n),Ji._free(i)}}function Dx(t){var e=Ji._malloc(vV),r=CA(t),i=r[0],n=r[1];try{return EA(qo.cellToLatLng(i,n,e)),sP(e)}finally{Ji._free(e)}}function IV(t,e){var r=Ji._malloc(Whe),i=CA(t),n=i[0],o=i[1];try{return EA(qo.cellToBoundary(n,o,r)),rfe(r,e,e)}finally{Ji._free(r)}}function MV(t,e){if(!t||!t.length)return[];var r=t.length,i=Ji._calloc(r,L3);tfe(i,t);var n=Ji._calloc($he);try{return EA(qo.cellsToLinkedMultiPolygon(i,r,n)),ife(n,e)}finally{qo.destroyLinkedMultiPolygon(n),Ji._free(n),Ji._free(i)}}function PV(t,e){var r=CA(t),i=r[0],n=r[1],o=CA(e),a=o[0],c=o[1],h=Ji._malloc(Hhe);try{return EA(qo.gridDistance(i,n,a,c,h)),Jhe(h)}finally{Ji._free(h)}}function RV(t,e){qhe(t);var r=Ji._malloc(Fd);try{switch(e){case dV.m:EA(qo.getHexagonEdgeLengthAvgM(t,r));break;case dV.km:EA(qo.getHexagonEdgeLengthAvgKm(t,r));break;default:throw xV(mV,e)}return Qhe(r)}finally{Ji._free(r)}}function nfe(t){return t*Math.PI/180}function ofe(t){return t*180/Math.PI}function F3(t,e){e=e===void 0?t[0][0]:e;for(let r of t){let i=r[0]-e;i>180?r[0]-=360:i<-180&&(r[0]+=360)}}function sfe(t,e,r){let[i,n]=Dx(t),o=e.length;F3(e,n);let a=e[0]===e[o-1]?o-1:o;for(let c=0;c<a;c++)e[c][0]=Ds(n,e[c][0],r),e[c][1]=Ds(i,e[c][1],r)}function BV(t,e,r){let i=t(e,r),[n,o]=Dx(i);return[o,n]}function aP(t,e=1){let r=IV(t,!0);return e!==1?sfe(t,r,e):F3(r),r}function LV(t){let e=new Float64Array(t.length*2),r=0;for(let i of t)e[r++]=i[0],e[r++]=i[1];return e}var afe=10;function lfe(t,e){let r;return t==null?r=e:typeof t=="object"?r={...t,coverage:e}:r={getHexagon:t,coverage:e},r}var cfe={...Pd.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0},eg=class t extends so{initializeState(){t._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:r}){if(e.highPrecision!==!0&&(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagon)){let i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,r=!1,i=!1,{iterable:n,objectInfo:o}=Ro(this.props.data);for(let a of n){o.index++;let c=this.props.getHexagon(a,o),h=CV(c);if(e<0){if(e=h,!this.props.highPrecision)break}else if(e!==h){i=!0;break}if(EV(c)){r=!0;break}}return{resolution:e,edgeLengthKM:e>=0?RV(e,"km"):0,hasMultipleRes:i,hasPentagon:r}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){let{resolution:e,hasPentagon:r,hasMultipleRes:i}=this.state,{viewport:n}=this.context;return!!n?.resolution||i||r||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;let{resolution:r,edgeLengthKM:i,centerHex:n}=this.state;if(r<0)return;let o=this.props.centerHexagon||SV(e.latitude,e.longitude,r);if(n===o)return;if(n)try{if(PV(n,o)*i<afe)return}catch{}let{unitsPerMeter:a}=e.distanceScales,c=aP(o),[h,p]=Dx(o),[x,T]=e.projectFlat([p,h]);c=c.map(R=>{let k=e.projectFlat(R);return[(k[0]-x)/a[0],(k[1]-T)/a[1]]}),this.setState({centerHex:o,vertices:c})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){let{elevationScale:e,material:r,coverage:i,extruded:n,wireframe:o,stroked:a,filled:c,lineWidthUnits:h,lineWidthScale:p,lineWidthMinPixels:x,lineWidthMaxPixels:T,getFillColor:R,getElevation:k,getLineColor:j,getLineWidth:q,transitions:Z,updateTriggers:re}=this.props;return{elevationScale:e,extruded:n,coverage:i,wireframe:o,stroked:a,filled:c,lineWidthUnits:h,lineWidthScale:p,lineWidthMinPixels:x,lineWidthMaxPixels:T,material:r,getElevation:k,getFillColor:R,getLineColor:j,getLineWidth:q,transitions:Z,updateTriggers:{getFillColor:re.getFillColor,getElevation:re.getElevation,getLineColor:re.getLineColor,getLineWidth:re.getLineWidth}}}_renderPolygonLayer(){let{data:e,getHexagon:r,updateTriggers:i,coverage:n}=this.props,o=this.getSubLayerClass("hexagon-cell-hifi",Pd),a=this._getForwardProps();return a.updateTriggers.getPolygon=lfe(i.getHexagon,n),new o(a,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:a.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(c,h)=>{let p=r(c,h);return LV(aP(p,n))}})}_renderColumnLayer(){let{data:e,getHexagon:r,updateTriggers:i}=this.props,n=this.getSubLayerClass("hexagon-cell",Hu),o=this._getForwardProps();return o.updateTriggers.getPosition=i.getHexagon,new n(o,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:BV.bind(null,r)})}};eg.defaultProps=cfe;eg.layerName="H3HexagonLayer";eg._checkH3Lib=()=>{};var k3=eg;var ufe={getHexagons:{type:"accessor",value:t=>t.hexagons}},Fx=class extends qu{initializeState(){k3._checkH3Lib()}updateState({props:e,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagons){let{data:i,getHexagons:n}=e,o=[],{iterable:a,objectInfo:c}=Ro(i);for(let h of a){c.index++;let p=n(h,c),x=MV(p,!0);for(let T of x){for(let R of T)F3(R);o.push(this.getSubLayerRow({polygon:T},h,c.index))}}this.setState({polygons:o})}}indexToBounds(){let{getElevation:e,getFillColor:r,getLineColor:i,getLineWidth:n}=this.props;return{data:this.state.polygons,getPolygon:o=>o.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(n)}}};Fx.layerName="H3ClusterLayer";Fx.defaultProps=ufe;var OV=Fx;var lP=Math.PI/180,N3=new Float32Array(16),DV=new Float32Array(12);function FV(t,e,r){let i=e[0]*lP,n=e[1]*lP,o=e[2]*lP,a=Math.sin(o),c=Math.sin(i),h=Math.sin(n),p=Math.cos(o),x=Math.cos(i),T=Math.cos(n),R=r[0],k=r[1],j=r[2];t[0]=R*T*x,t[1]=R*h*x,t[2]=R*-c,t[3]=k*(-h*p+T*c*a),t[4]=k*(T*p+h*c*a),t[5]=k*x*a,t[6]=j*(h*a+T*c*p),t[7]=j*(-T*a+h*c*p),t[8]=j*x*p}function kV(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}var z3={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){let{data:i,getOrientation:n,getScale:o,getTranslation:a,getTransformMatrix:c}=this.props,h=Array.isArray(c),p=h&&c.length===16,x=Array.isArray(o),T=Array.isArray(n),R=Array.isArray(a),k=p||!h&&!!c(i[0]);k?t.constant=p:t.constant=T&&x&&R;let j=t.value;if(t.constant){let q;k?(N3.set(c),q=kV(N3)):(q=DV,FV(q,n,o),q.set(a,9)),t.value=new Float32Array(q)}else{let q=e*t.size,{iterable:Z,objectInfo:re}=Ro(i,e,r);for(let ee of Z){re.index++;let se;if(k)N3.set(p?c:c(ee,re)),se=kV(N3);else{se=DV;let me=T?n:n(ee,re),Le=x?o:o(ee,re);FV(se,me,Le),se.set(R?a:a(ee,re),9)}j[q++]=se[0],j[q++]=se[1],j[q++]=se[2],j[q++]=se[3],j[q++]=se[4],j[q++]=se[5],j[q++]=se[6],j[q++]=se[7],j[q++]=se[8],j[q++]=se[9],j[q++]=se[10],j[q++]=se[11]}}}};function U3(t,e){return e===vr.CARTESIAN||e===vr.METER_OFFSETS||e===vr.DEFAULT&&!t.isGeospatial}var NV=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,zV={name:"simpleMesh",vs:NV,fs:NV,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}};var UV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var VV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function cP(t){let e=t.positions||t.POSITION;cr.assert(e,'no "postions" or "POSITION" attribute in mesh');let r=e.value.length/e.size,i=t.COLOR_0||t.colors;i||(i={size:3,value:new Float32Array(r*3).fill(1)});let n=t.NORMAL||t.normals;n||(n={size:3,value:new Float32Array(r*3).fill(0)});let o=t.TEXCOORD_0||t.texCoords;return o||(o={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:i,normals:n,texCoords:o}}function jV(t){return t instanceof Qi?(t.attributes=cP(t.attributes),t):t.attributes?new Qi({...t,topology:"triangle-list",attributes:cP(t.attributes)}):new Qi({topology:"triangle-list",attributes:cP(t)})}var hfe=[0,0,0,255],ffe={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:hfe},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},kx=class extends ln{getShaders(){return super.getShaders({vs:UV,fs:VV,modules:[Bi,om,Sn,zV]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;let{mesh:r}=this.props;if(!r)return null;if(e=r.header?.boundingBox,!e){let{attributes:i}=jV(r);i.POSITION=i.POSITION||i.positions,e=Dh(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:z3}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e;if(r.mesh!==i.mesh||n.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);let o=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(o.NORMAL||o.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&r.texture instanceof on&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){let{model:r}=this.state;if(!r)return;let{viewport:i,renderPass:n}=this.context,{sizeScale:o,coordinateSystem:a,_instanced:c}=this.props,h={sizeScale:o,composeModelMatrix:!c||U3(i,a),flatShading:!this.state.hasNormals};r.shaderInputs.setProps({simpleMesh:h}),r.draw(n)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){let r=new di(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:jV(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state,o={sampler:i||n,hasTexture:!!i};return r.shaderInputs.setProps({simpleMesh:o}),r}setTexture(e){let{emptyTexture:r,model:i}=this.state;if(i){let n={sampler:e||r,hasTexture:!!e};i.shaderInputs.setProps({simpleMesh:n})}}};kx.defaultProps=ffe;kx.layerName="SimpleMeshLayer";var tg=kx;var Nc;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Nc||(Nc={}));function zx(t,e,r,i){let n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;let{imageBasedLightingEnvironment:o}=i;return o&&(n.bindings.pbr_diffuseEnvSampler=o.diffuseEnvSampler.texture,n.bindings.pbr_specularEnvSampler=o.specularEnvSampler.texture,n.bindings.pbr_BrdfLUT=o.brdfLutTexture.texture,n.uniforms.scaleIBLAmbient=[1,1]),i?.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.scaleDiffBaseMR=[0,0,0,0],n.uniforms.scaleFGDSpec=[0,0,0,0]),r.NORMAL&&(n.defines.HAS_NORMALS=1),r.TANGENT&&i?.useTangents&&(n.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(n.defines.HAS_UV=1),i?.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),i?.lights&&(n.defines.USE_LIGHTS=1),e&&dfe(t,e,n),n}function dfe(t,e,r){if(r.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&pfe(t,e.pbrMetallicRoughness,r),e.normalTexture){Nx(t,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",r);let{scale:i=1}=e.normalTexture;r.uniforms.normalScale=i}if(e.occlusionTexture){Nx(t,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",r);let{strength:i=1}=e.occlusionTexture;r.uniforms.occlusionStrength=i}switch(e.emissiveTexture&&(Nx(t,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":let{alphaCutoff:i=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.alphaCutoff=i;break;case"BLEND":Vt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=Nc.FUNC_ADD,r.glParameters.blendFunc=[Nc.SRC_ALPHA,Nc.ONE_MINUS_SRC_ALPHA,Nc.ONE,Nc.ONE_MINUS_SRC_ALPHA];break}}function pfe(t,e,r){e.baseColorTexture&&Nx(t,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Nx(t,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);let{metallicFactor:i=1,roughnessFactor:n=1}=e;r.uniforms.metallicRoughnessValues=[i,n]}function Nx(t,e,r,i=null,n){let o=e?.texture?.sampler?.parameters||{},a=e.texture.source.image,c,h={};a.compressed?(c=a,h={[Nc.TEXTURE_MIN_FILTER]:a.data.length>1?Nc.LINEAR_MIPMAP_NEAREST:Nc.LINEAR}):c={data:a};let p=t.createTexture({id:e.uniformName||e.id,parameters:{...o,...h},pixelStore:{[Nc.UNPACK_FLIP_Y_WEBGL]:!1},...c});n.bindings[r]=p,i&&(n.defines[i]=1),n.generatedTextures.push(p)}var GV="4.3.2";var V3={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"},HV;async function hP(t){SC(t.modules);let e=IC("basis");return e||(HV||=Afe(t),await HV)}async function Afe(t){let e=null,r=null;return[e,r]=await Promise.all([await wu(V3.TRANSCODER,"textures",t),await wu(V3.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await mfe(e,r)}function mfe(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{let{BasisFile:o,initializeBasis:a}=n;a(),i({BasisFile:o})})})}var uP;async function fP(t){let e=t.modules||{};return e.basisEncoder?e.basisEncoder:(uP=uP||gfe(t),await uP)}async function gfe(t){let e=null,r=null;return[e,r]=await Promise.all([await wu(V3.ENCODER,"textures",t),await wu(V3.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await _fe(e,r)}function _fe(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{let{BasisFile:o,KTX2File:a,initializeBasis:c,BasisEncoder:h}=n;c(),i({BasisFile:o,KTX2File:a,BasisEncoder:h})})})}var SA={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};var yfe=["","WEBKIT_","MOZ_"],WV={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},j3=null;function $V(t){if(!j3){t=t||xfe()||void 0,j3=new Set;for(let e of yfe)for(let r in WV)if(t&&t.getExtension(`${e}${r}`)){let i=WV[r];j3.add(i)}}return j3}function xfe(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var ll=[171,75,84,88,32,50,48,187,13,10,26,10];function qV(t){let e=new Uint8Array(t);return!(e.byteLength<ll.length||e[0]!==ll[0]||e[1]!==ll[1]||e[2]!==ll[2]||e[3]!==ll[3]||e[4]!==ll[4]||e[5]!==ll[5]||e[6]!==ll[6]||e[7]!==ll[7]||e[8]!==ll[8]||e[9]!==ll[9]||e[10]!==ll[10]||e[11]!==ll[11])}var bfe={etc1:{basisFormat:0,compressed:!0,format:SA.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:SA.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:SA.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:SA.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:SA.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:SA.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function XV(t,e){if(e.basis.containerFormat==="auto"){if(qV(t)){let i=await fP(e);return ZV(i.KTX2File,t,e)}let{BasisFile:r}=await hP(e);return dP(r,t,e)}switch(e.basis.module){case"encoder":let r=await fP(e);switch(e.basis.containerFormat){case"ktx2":return ZV(r.KTX2File,t,e);case"basis":default:return dP(r.BasisFile,t,e)}case"transcoder":default:let{BasisFile:i}=await hP(e);return dP(i,t,e)}}function dP(t,e,r){let i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");let n=i.getNumImages(),o=[];for(let a=0;a<n;a++){let c=i.getNumLevels(a),h=[];for(let p=0;p<c;p++)h.push(vfe(i,a,p,r));o.push(h)}return o}finally{i.close(),i.delete()}}function vfe(t,e,r,i){let n=t.getImageWidth(e,r),o=t.getImageHeight(e,r),a=t.getHasAlpha(),{compressed:c,format:h,basisFormat:p}=YV(i,a),x=t.getImageTranscodedSizeInBytes(e,r,p),T=new Uint8Array(x);if(!t.transcodeImage(T,e,r,p,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:T,compressed:c,format:h,hasAlpha:a}}function ZV(t,e,r){let i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");let n=i.getLevels(),o=[];for(let a=0;a<n;a++)o.push(wfe(i,a,r));return[o]}finally{i.close(),i.delete()}}function wfe(t,e,r){let{alphaFlag:i,height:n,width:o}=t.getImageLevelInfo(e,0,0),{compressed:a,format:c,basisFormat:h}=YV(r,i),p=t.getImageTranscodedSizeInBytes(e,0,0,h),x=new Uint8Array(p);if(!t.transcodeImage(x,e,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:x,compressed:a,levelSize:p,hasAlpha:i,format:c}}function YV(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=G3()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),bfe[r]}function G3(){let t=$V();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}var KV={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:GV,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},pP={...KV,parse:XV};var Tfe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Efe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},mP=class{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;let i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:o,path:a})=>{Rfe(i,n,o,a),Sfe(o,o._node)})}},H3=class{animations;constructor(e){this.animations=e.animations.map((r,i)=>{let n=r.name||`Animation-${i}`,o=r.samplers.map(({input:c,interpolation:h="LINEAR",output:p})=>({input:QV(e.accessors[c]),interpolation:h,output:QV(e.accessors[p])})),a=r.channels.map(({sampler:c,target:h})=>({sampler:o[c],target:e.nodes[h.node],path:h.path}));return new mP({name:n,channels:a})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}};function QV(t){if(!t._animation){let e=Efe[t.componentType],r=Tfe[t.type],i=r*t.count,{buffer:n,byteOffset:o}=t.bufferView.data,a=new e(n,o+(t.byteOffset||0),i);if(r===1)t._animation=Array.from(a);else{let c=[];for(let h=0;h<a.length;h+=r)c.push(Array.from(a.slice(h,h+r)));t._animation=c}}return t._animation}var Cfe=new wr;function Sfe(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){let r=Cfe.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}var AP=new Rl;function Ife(t,e,r,i,n){if(e==="rotation"){AP.slerp({start:r,target:i,ratio:n});for(let o=0;o<AP.length;o++)t[e][o]=AP[o]}else for(let o=0;o<r.length;o++)t[e][o]=n*i[o]+(1-n)*r[o]}function Mfe(t,e,{p0:r,outTangent0:i,inTangent1:n,p1:o,tDiff:a,ratio:c}){for(let h=0;h<t[e].length;h++){let p=i[h]*a,x=n[h]*a;t[e][h]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*r[h]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*p+(-2*Math.pow(c,3)+3*Math.pow(c,2))*o[h]+(Math.pow(c,3)-Math.pow(c,2))*x}}function Pfe(t,e,r){for(let i=0;i<r.length;i++)t[e][i]=r[i]}function Rfe(t,{input:e,interpolation:r,output:i},n,o){let a=e[e.length-1],c=t%a,h=e.findIndex(R=>R>=c),p=Math.max(0,h-1);if(!Array.isArray(n[o]))switch(o){case"translation":n[o]=[0,0,0];break;case"rotation":n[o]=[0,0,0,1];break;case"scale":n[o]=[1,1,1];break;default:Vt.warn(`Bad animation path ${o}`)()}let x=e[p],T=e[h];switch(r){case"STEP":Pfe(n,o,i[p]);break;case"LINEAR":if(T>x){let R=(c-x)/(T-x);Ife(n,o,i[p],i[h],R)}break;case"CUBICSPLINE":if(T>x){let R=(c-x)/(T-x),k=T-x,j=i[3*p+1],q=i[3*p+2],Z=i[3*h+0],re=i[3*h+1];Mfe(n,o,{p0:j,outTangent0:q,inTangent1:Z,p1:re,tDiff:k,ratio:R})}break;default:Vt.warn(`Interpolation ${r} not supported`)();break}}var Bfe=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,Lfe=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,Ofe=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function JV(t,e){let{id:r,geometry:i,material:n,vertexCount:o,materialOptions:a,modelOptions:c}=e,h=zx(t,n,i.attributes,a);Vt.info(4,"createGLTFModel defines: ",h.defines)();let p=[],x={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},T={id:r,source:Bfe,vs:Lfe,fs:Ofe,geometry:i,topology:i.topology,vertexCount:o,modules:[Kp],...c,defines:{...h.defines,...c.defines},parameters:{...x,...h.parameters,...c.parameters}},R=new di(t,T),{camera:k,...j}={...h.uniforms,...c.uniforms,...h.bindings,...c.bindings};return R.shaderInputs.setProps({pbrMaterial:j,pbrProjection:{camera:k}}),new _d({managedResources:p,model:R})}var IA;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(IA||(IA={}));function ej(t){switch(t){case IA.POINTS:return"point-list";case IA.LINES:return"line-list";case IA.LINE_STRIP:return"line-strip";case IA.TRIANGLES:return"triangle-list";case IA.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(t))}}var Dfe={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},W3=class{device;options;gltf;constructor(e,r={}){this.device=e,this.options={...Dfe,...r}}instantiate(e){return this.gltf=gP(e),(this.gltf.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new H3(this.gltf):null}createScene(e){let i=(e.nodes||[]).map(o=>this.createNode(o));return new Hh({id:e.name||e.id,children:i})}createNode(e){if(!e._node){let n=(e.children||[]).map(a=>this.createNode(a));e.mesh&&n.push(this.createMesh(e.mesh));let o=new Hh({id:e.name||e.id,children:n});if(e.matrix)o.setMatrix(e.matrix);else{if(o.matrix.identity(),e.translation&&o.matrix.translate(e.translation),e.rotation){let a=new wr().fromQuaternion(e.rotation);o.matrix.multiplyRight(a)}e.scale&&o.matrix.scale(e.scale)}e._node=o}let r=this.gltf.nodes.find(i=>i.id===e.id);return r._node=e._node,e._node}createMesh(e){if(!e._mesh){let i=(e.primitives||[]).map((o,a)=>this.createPrimitive(o,a,e)),n=new Hh({id:e.name||e.id,children:i});e._mesh=n}return e._mesh}createPrimitive(e,r,i){let n=e.name||`${i.name||i.id}-primitive-${r}`,o=ej(e.mode||4),a=e.indices?e.indices.count:this.getVertexCount(e.attributes),c=JV(this.device,{id:n,geometry:this.createGeometry(n,e,o),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:a});return c.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],c}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,i){let n={};for(let[o,a]of Object.entries(r.attributes)){let{components:c,size:h,value:p}=a;n[o]={size:h??c,value:p}}return new Qi({id:e,topology:i,indices:r.indices.value,attributes:n})}createBuffer(e,r){e.bufferView||(e.bufferView={});let{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}};function gP(t){if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof ImageBitmap)return t;if(Array.isArray(t))return t.map(gP);if(t&&typeof t=="object"){let e={};for(let r in t)e[r]=gP(t[r]);return e}return t}function _P(t,e,r){let i=new W3(t,r),n=i.instantiate(e),o=i.createAnimator();return{scenes:n,animator:o}}var yP={};no(yP,{createExtMeshFeatures:()=>Qfe,decode:()=>qfe,encode:()=>Zfe,name:()=>$fe});function os(t,e){if(!t)throw new Error(e||"assert failed: gltf")}var $3={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},q3={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};var Ffe=1.33,tj=["SCALAR","VEC2","VEC3","VEC4"],kfe=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Nfe=new Map(kfe),zfe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ufe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Vfe={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Z3(t){return tj[t-1]||tj[0]}function kd(t){let e=Nfe.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function rg(t,e){let r=Vfe[t.componentType],i=zfe[t.type],n=Ufe[t.componentType],o=t.count*i,a=t.count*i*n;os(a>=0&&a<=e.byteLength);let c=q3[t.componentType],h=$3[t.type];return{ArrayType:r,length:o,byteLength:a,componentByteSize:c,numberOfComponentsInElement:h}}function Ux(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];let i=e.map(a=>a.bufferView);r=r.filter(a=>!i.includes(a));let n=r.reduce((a,c)=>a+c.byteLength,0),o=e.reduce((a,c)=>{let{width:h,height:p}=c.image;return a+h*p},0);return n+Math.ceil(4*o*Ffe)}function rj(t,e,r){let i=t.bufferViews[r];os(i);let n=i.buffer,o=e[n];os(o);let a=(i.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,a,i.byteLength)}function ij(t,e,r){let i=typeof r=="number"?t.accessors?.[r]:r;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);let n=t.bufferViews?.[i.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);let{arrayBuffer:o,byteOffset:a}=e[n.buffer],c=(a||0)+(i.byteOffset||0)+(n.byteOffset||0),{ArrayType:h,length:p,componentByteSize:x,numberOfComponentsInElement:T}=rg(i,n),R=x*T,k=n.byteStride||R;if(typeof n.byteStride>"u"||n.byteStride===R)return new h(o,c,p);let j=new h(p);for(let q=0;q<i.count;q++){let Z=new h(o,c+q*k,T);j.set(Z,q*T)}return j}function jfe(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}var en=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||jfe(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){let r=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof r=="string"||typeof i=="string"}getExtension(e){let r=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return r?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;let i=this.json[e]&&this.json[e][r];if(!i)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);let r=e.buffer,i=this.gltf.buffers[r];os(i);let n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){let r=this.getAccessor(e);return ij(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);let r=this.getBufferView(e.bufferView),n=this.getBuffer(r.buffer).data,o=r.byteOffset||0;return new Uint8Array(n,o,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,i){return e.extensions=e.extensions||{},e.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(e,r,i){let n=e.extensions||{};n[r]=i}removeObjectExtension(e,r){let i=e?.extensions||{};if(i[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let n=this.json.extensionsRemoved;n.includes(r)||n.push(r)}delete i[r]}addExtension(e,r={}){return os(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return os(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){let{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){let{meshIndex:r,matrix:i}=e;this.json.nodes=this.json.nodes||[];let n={mesh:r};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){let{attributes:r,indices:i,material:n,mode:o=4}=e,c={primitives:[{attributes:this._addAttributes(r),mode:o}]};if(i){let h=this._addIndices(i);c.primitives[0].indices=h}return Number.isFinite(n)&&(c.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){let i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,r){let i=Fp(e),n=r||i?.mimeType,a={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e,r=0,i=this.byteLength){let n=e.byteLength;os(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);let o={buffer:r,byteOffset:i,byteLength:n};return this.byteLength+=nd(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,r){let i={bufferView:e,type:Z3(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){let i=this.addBufferView(e),n={min:r.min,max:r.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,r.size));let o={size:r.size,componentType:kd(e),count:Math.round(e.length/r.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(o,r))}addTexture(e){let{imageIndex:r}=e,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){let e=this.byteLength,r=new ArrayBuffer(e),i=new Uint8Array(r),n=0;for(let o of this.sourceBuffers||[])n=UC(o,i,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(e,r){let i=!0;for(;i;){let n=e.indexOf(r);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){let r={};for(let i in e){let n=e[i],o=this._getGltfAttributeName(i),a=this.addBinaryBuffer(n.value,n);r[o]=a}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){let i={min:null,max:null};if(e.length<r)return i;i.min=[],i.max=[];let n=e.subarray(0,r);for(let o of n)i.min.push(o),i.max.push(o);for(let o=r;o<e.length;o+=r)for(let a=0;a<r;a++)i.min[0+a]=Math.min(i.min[0+a],e[o+a]),i.max[0+a]=Math.max(i.max[0+a],e[o+a]);return i}};function nj(t){return(t%1+1)%1}var oj={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Gfe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},sj={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Vx(t,e){return sj[e]*oj[t]}function ig(t,e,r,i){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;let n=t.getTypedArrayForBufferView(e),o=ng(n,"SCALAR",r,i+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function ng(t,e,r,i=1){let n=oj[e],o=Gfe[r],a=sj[r],c=i*n,h=c*a,p=t.buffer,x=t.byteOffset;return x%a!==0&&(p=new Uint8Array(p).slice(x,x+h).buffer,x=0),new o(p,x,c)}function og(t,e,r){let i=`TEXCOORD_${e.texCoord||0}`,n=r.attributes[i],o=t.getTypedArrayForAccessor(n),a=t.gltf.json,c=e.index,h=a.textures?.[c]?.source;if(typeof h<"u"){let p=a.images?.[h]?.mimeType,x=t.gltf.images?.[h];if(x&&typeof x.width<"u"){let T=[];for(let R=0;R<o.length;R+=2){let k=Hfe(x,p,o,R,e.channels);T.push(k)}return T}}return[]}function X3(t,e,r,i,n){if(!r?.length)return;let o=[];for(let x of r){let T=i.findIndex(R=>R===x);T===-1&&(T=i.push(x)-1),o.push(T)}let a=new Uint32Array(o),c=t.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength})-1,h=t.addBufferView(a,c,0),p=t.addAccessor(h,{size:1,componentType:kd(a),count:a.length});n.attributes[e]=p}function Hfe(t,e,r,i,n=[0]){let o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=r[i],c=r[i+1],h=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(h=4);let p=Wfe(a,c,t,h),x=0;for(let T of n){let R=typeof T=="number"?Object.values(o)[T]:o[T],k=p+R.offset,j=j_(t);if(j.data.length<=k)throw new Error(`${j.data.length} <= ${k}`);let q=j.data[k];x|=q<<R.shift}return x}function Wfe(t,e,r,i=1){let n=r.width,o=nj(t)*(n-1),a=Math.round(o),c=r.height,h=nj(e)*(c-1),p=Math.round(h),x=r.components?r.components:i;return(p*n+a)*x}function Y3(t,e,r,i,n){let o=[];for(let a=0;a<e;a++){let c=r[a],h=r[a+1]-r[a];if(h+c>i)break;let p=c/n,x=h/n;o.push(t.slice(p,p+x))}return o}function K3(t,e,r){let i=[];for(let n=0;n<e;n++){let o=n*r;i.push(t.slice(o,o+r))}return i}function Q3(t,e,r,i){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){let n=[],o=new TextDecoder("utf8"),a=0;for(let c=0;c<t;c++){let h=i[c+1]-i[c];if(h+a<=e.length){let p=e.subarray(a,h+a),x=o.decode(p);n.push(x),a+=h}}return n}return[]}var sg="EXT_mesh_features",$fe=sg;async function qfe(t,e){let r=new en(t);Xfe(r,e)}function Zfe(t,e){let r=new en(t);return Kfe(r,e),r.createBinaryChunk(),r.gltf}function Xfe(t,e){let r=t.gltf.json;if(r.meshes)for(let i of r.meshes)for(let n of i.primitives)Yfe(t,n,e)}function Yfe(t,e,r){if(!r?.gltf?.loadBuffers)return;let n=e.extensions?.[sg]?.featureIds;if(n)for(let o of n){let a;if(typeof o.attribute<"u"){let c=`_FEATURE_ID_${o.attribute}`,h=e.attributes[c];a=t.getTypedArrayForAccessor(h)}else typeof o.texture<"u"&&r?.gltf?.loadImages?a=og(t,o.texture,e):a=[];o.data=a}}function Kfe(t,e){let r=t.gltf.json.meshes;if(r)for(let i of r)for(let n of i.primitives)Jfe(t,n)}function Qfe(t,e,r,i){e.extensions||(e.extensions={});let n=e.extensions[sg];n||(n={featureIds:[]},e.extensions[sg]=n);let{featureIds:o}=n,a={featureCount:r.length,propertyTable:i,data:r};o.push(a),t.addObjectExtension(e,sg,n)}function Jfe(t,e){let r=e.extensions?.[sg];if(!r)return;let i=r.featureIds;i.forEach((n,o)=>{if(n.data){let{accessorKey:a,index:c}=ede(e.attributes),h=new Uint32Array(n.data);i[o]={featureCount:h.length,propertyTable:n.propertyTable,attribute:c},t.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});let p=t.addBufferView(h),x=t.addAccessor(p,{size:1,componentType:kd(h),count:h.length});e.attributes[a]=x}})}function ede(t){let e="_FEATURE_ID_",r=Object.keys(t).filter(o=>o.indexOf(e)===0),i=-1;for(let o of r){let a=Number(o.substring(e.length));a>i&&(i=a)}return i++,{accessorKey:`${e}${i}`,index:i}}var vP={};no(vP,{createExtStructuralMetadata:()=>vde,decode:()=>rde,encode:()=>ide,name:()=>tde});var ag="EXT_structural_metadata",tde=ag;async function rde(t,e){let r=new en(t);nde(r,e)}function ide(t,e){let r=new en(t);return xde(r,e),r.createBinaryChunk(),r.gltf}function nde(t,e){if(!e.gltf?.loadBuffers)return;let r=t.getExtension(ag);r&&(e.gltf?.loadImages&&ode(t,r),sde(t,r))}function ode(t,e){let r=e.propertyTextures,i=t.gltf.json;if(r&&i.meshes)for(let n of i.meshes)for(let o of n.primitives)lde(t,r,o,e)}function sde(t,e){let r=e.schema;if(!r)return;let i=r.classes,n=e.propertyTables;if(i&&n)for(let o in i){let a=ade(n,o);a&&ude(t,r,a)}}function ade(t,e){for(let r of t)if(r.class===e)return r;return null}function lde(t,e,r,i){if(!e)return;let o=r.extensions?.[ag]?.propertyTextures;if(o)for(let a of o){let c=e[a];cde(t,c,r,i)}}function cde(t,e,r,i){if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);let n=e.class;for(let o in e.properties){let a=`${n}_${o}`,c=e.properties?.[o];if(!c)continue;c.data||(c.data=[]);let h=c.data,p=og(t,c,r);p!==null&&(X3(t,a,p,h,r),c.data=h,i.dataAttributeNames.push(a))}}function ude(t,e,r){let i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let n=r.count;for(let o in i.properties){let a=i.properties[o],c=r.properties?.[o];if(c){let h=hde(t,e,a,n,c);c.data=h}}}function hde(t,e,r,i,n){let o=[],a=n.values,c=t.getTypedArrayForBufferView(a),h=fde(t,r,n,i),p=dde(t,n,i);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=pde(r,i,c,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{o=Q3(i,c,h,p);break}case"ENUM":{o=Ade(e,r,i,c,h);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return o}function fde(t,e,r,i){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?ig(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",i):null}function dde(t,e,r){return typeof e.stringOffsets<"u"?ig(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function pde(t,e,r,i){let n=t.array,o=t.count,a=Vx(t.type,t.componentType),c=r.byteLength/a,h;return t.componentType?h=ng(r,t.type,t.componentType,c):h=r,n?i?Y3(h,e,i,r.length,a):o?K3(h,e,o):[]:h}function Ade(t,e,r,i,n){let o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let a=t.enums?.[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);let c=a.valueType||"UINT16",h=Vx(e.type,c),p=i.byteLength/h,x=ng(i,e.type,c,p);if(x||(x=i),e.array){if(n)return mde({valuesData:x,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i.length,elementSize:h,enumEntry:a});let T=e.count;return T?gde(x,r,T,a):[]}return bP(x,0,r,a)}function mde(t){let{valuesData:e,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n,elementSize:o,enumEntry:a}=t,c=[];for(let h=0;h<r;h++){let p=i[h],x=i[h+1]-i[h];if(x+p>n)break;let T=p/o,R=x/o,k=bP(e,T,R,a);c.push(k)}return c}function gde(t,e,r,i){let n=[];for(let o=0;o<e;o++){let a=r*o,c=bP(t,a,r,i);n.push(c)}return n}function bP(t,e,r,i){let n=[];for(let o=0;o<r;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)n.push("");else{let a=t[e+o],c=_de(i,a);c?n.push(c.name):n.push("")}return n}function _de(t,e){for(let r of t.values)if(r.value===e)return r;return null}var yde="schemaClassId";function xde(t,e){let r=t.getExtension(ag);if(r&&r.propertyTables)for(let i of r.propertyTables){let n=i.class,o=r.schema?.classes?.[n];i.properties&&o&&bde(i,o,t)}}function bde(t,e,r){for(let i in t.properties){let n=t.properties[i].data;if(n){let o=e.properties[i];if(o){let a=Ede(n,o,r);t.properties[i]=a}}}}function vde(t,e,r=yde){let i=t.getExtension(ag);i||(i=t.addExtension(ag)),i.schema=wde(e,r,i.schema);let n=Tde(e,r,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(n)-1}function wde(t,e,r){let i=r??{id:"schema_id"},n={properties:{}};for(let o of t){let a={type:o.elementType,componentType:o.componentType};n.properties[o.name]=a}return i.classes={},i.classes[e]=n,i}function Tde(t,e,r){let i={class:e,count:0},n=0,o=r.classes?.[e];for(let a of t){if(n===0&&(n=a.values.length),n!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");o?.properties[a.name]&&(i.properties||(i.properties={}),i.properties[a.name]={values:0,data:a.values})}return i.count=n,i}function Ede(t,e,r){let i={values:0};if(e.type==="STRING"){let{stringData:n,stringOffsets:o}=Ide(t);i.stringOffsets=xP(o,r),i.values=xP(n,r)}else if(e.type==="SCALAR"&&e.componentType){let n=Sde(t,e.componentType);i.values=xP(n,r)}return i}var Cde={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Sde(t,e){let r=[];for(let n of t)r.push(Number(n));let i=Cde[e];if(!i)throw new Error("Illegal component type");return new i(r)}function Ide(t){let e=new TextEncoder,r=[],i=0;for(let h of t){let p=e.encode(h);i+=p.length,r.push(p)}let n=new Uint8Array(i),o=[],a=0;for(let h of r)n.set(h,a),o.push(a),a+=h.length;o.push(a);let c=new Uint32Array(o);return{stringData:n,stringOffsets:c}}function xP(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}var wP={};no(wP,{decode:()=>Pde,name:()=>Mde});var aj="EXT_feature_metadata",Mde=aj;async function Pde(t,e){let r=new en(t);Rde(r,e)}function Rde(t,e){if(!e.gltf?.loadBuffers)return;let r=t.getExtension(aj);r&&(e.gltf?.loadImages&&Bde(t,r),Lde(t,r))}function Bde(t,e){let r=e.schema;if(!r)return;let i=r.classes,{featureTextures:n}=e;if(i&&n)for(let o in i){let a=i[o],c=Dde(n,o);c&&kde(t,c,a)}}function Lde(t,e){let r=e.schema;if(!r)return;let i=r.classes,n=e.featureTables;if(i&&n)for(let o in i){let a=Ode(n,o);a&&Fde(t,r,a)}}function Ode(t,e){for(let r in t){let i=t[r];if(i.class===e)return i}return null}function Dde(t,e){for(let r in t){let i=t[r];if(i.class===e)return i}return null}function Fde(t,e,r){if(!r.class)return;let i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let n=r.count;for(let o in i.properties){let a=i.properties[o],c=r.properties?.[o];if(c){let h=Nde(t,e,a,n,c);c.data=h}}}function kde(t,e,r){let i=e.class;for(let n in r.properties){let o=e?.properties?.[n];if(o){let a=Gde(t,o,i);o.data=a}}}function Nde(t,e,r,i,n){let o=[],a=n.bufferView,c=t.getTypedArrayForBufferView(a),h=zde(t,r,n,i),p=Ude(t,r,n,i);return r.type==="STRING"||r.componentType==="STRING"?o=Q3(i,c,h,p):Vde(r)&&(o=jde(r,i,c,h)),o}function zde(t,e,r,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?ig(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",i):null}function Ude(t,e,r,i){return typeof r.stringOffsetBufferView<"u"?ig(t,r.stringOffsetBufferView,r.offsetType||"UINT32",i):null}function Vde(t){let e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function jde(t,e,r,i){let n=t.type==="ARRAY",o=t.componentCount,a="SCALAR",c=t.componentType||t.type,h=Vx(a,c),p=r.byteLength/h,x=ng(r,a,c,p);return n?i?Y3(x,e,i,r.length,h):o?K3(x,e,o):[]:x}function Gde(t,e,r){let i=t.gltf.json;if(!i.meshes)return[];let n=[];for(let o of i.meshes)for(let a of o.primitives)Hde(t,r,e,n,a);return n}function Hde(t,e,r,i,n){let o={channels:r.channels,...r.texture},a=og(t,o,n);a&&X3(t,e,a,i,n)}var lj="4.3.2";var lg=!0,cj=1735152710,CP=12,J3=8,Wde=1313821514,$de=5130562,qde=0,Zde=0,Xde=1;function Yde(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function uj(t,e=0,r={}){let i=new DataView(t),{magic:n=cj}=r,o=i.getUint32(e,!1);return o===n||o===cj}function hj(t,e,r=0,i={}){let n=new DataView(e),o=Yde(n,r+0),a=n.getUint32(r+4,lg),c=n.getUint32(r+8,lg);switch(Object.assign(t,{header:{byteOffset:r,byteLength:c,hasBinChunk:!1},type:o,version:a,json:{},binChunks:[]}),r+=CP,t.version){case 1:return Kde(t,n,r);case 2:return Qde(t,n,r,i={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function Kde(t,e,r){Si(t.header.byteLength>CP+J3);let i=e.getUint32(r+0,lg),n=e.getUint32(r+4,lg);return r+=J3,Si(n===qde),TP(t,e,r,i),r+=i,r+=EP(t,e,r,t.header.byteLength),r}function Qde(t,e,r,i){return Si(t.header.byteLength>CP+J3),Jde(t,e,r,i),r+t.header.byteLength}function Jde(t,e,r,i){for(;r+8<=t.header.byteLength;){let n=e.getUint32(r+0,lg),o=e.getUint32(r+4,lg);switch(r+=J3,o){case Wde:TP(t,e,r,n);break;case $de:EP(t,e,r,n);break;case Zde:i.strict||TP(t,e,r,n);break;case Xde:i.strict||EP(t,e,r,n);break;default:break}r+=nd(n,4)}return r}function TP(t,e,r,i){let n=new Uint8Array(e.buffer,r,i),a=new TextDecoder("utf8").decode(n);return t.json=JSON.parse(a),nd(i,4)}function EP(t,e,r,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:e.buffer}),nd(i,4)}function SP(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;let i=e.baseUri||e.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return i.substr(0,i.lastIndexOf("/")+1)+t}var MP={};no(MP,{decode:()=>hpe,name:()=>upe});var epe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",tpe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",rpe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),ipe=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),npe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ope={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function fj(t,e,r,i,n,o="NONE"){let a=await spe();cpe(a,a.exports[ope[n]],t,e,r,i,a.exports[npe[o||"NONE"]])}var IP;async function spe(){return IP||(IP=ape()),IP}async function ape(){let t=epe;WebAssembly.validate(rpe)&&(t=tpe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));let e=await WebAssembly.instantiate(lpe(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function lpe(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){let n=t.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let i=0;i<t.length;++i)e[r++]=e[i]<60?ipe[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,r)}function cpe(t,e,r,i,n,o,a){let c=t.exports.sbrk,h=i+3&-4,p=c(h*n),x=c(o.length),T=new Uint8Array(t.exports.memory.buffer);T.set(o,x);let R=e(p,i,n,x,o.length);if(R===0&&a&&a(p,h,n),r.set(T.subarray(p,p+i*n)),c(p-c(0)),R!==0)throw new Error(`Malformed buffer data: ${R}`)}var eT="EXT_meshopt_compression",upe=eT;async function hpe(t,e){let r=new en(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;let i=[];for(let n of t.json.bufferViews||[])i.push(fpe(r,n));await Promise.all(i),r.removeExtension(eT)}async function fpe(t,e){let r=t.getObjectExtension(e,eT);if(r){let{byteOffset:i=0,byteLength:n=0,byteStride:o,count:a,mode:c,filter:h="NONE",buffer:p}=r,x=t.gltf.buffers[p],T=new Uint8Array(x.arrayBuffer,x.byteOffset+i,n),R=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await fj(R,a,o,T,c,h),t.removeObjectExtension(e,eT)}}var PP={};no(PP,{name:()=>dpe,preprocess:()=>ppe});var cg="EXT_texture_webp",dpe=cg;function ppe(t,e){let r=new en(t);if(!lS("image/webp")){if(r.getRequiredExtensions().includes(cg))throw new Error(`gltf: Required extension ${cg} not supported by browser`);return}let{json:i}=r;for(let n of i.textures||[]){let o=r.getObjectExtension(n,cg);o&&(n.source=o.source),r.removeObjectExtension(n,cg)}r.removeExtension(cg)}var RP={};no(RP,{name:()=>Ape,preprocess:()=>mpe});var tT="KHR_texture_basisu",Ape=tT;function mpe(t,e){let r=new en(t),{json:i}=r;for(let n of i.textures||[]){let o=r.getObjectExtension(n,tT);o&&(n.source=o.source,r.removeObjectExtension(n,tT))}r.removeExtension(tT)}var FP={};no(FP,{decode:()=>Bpe,encode:()=>Lpe,name:()=>Ppe,preprocess:()=>Rpe});var dj="4.3.2";var pj={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:dj,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function mj(t,e,r){let i=gj(e.metadata),n=[],o=gpe(e.attributes);for(let a in t){let c=t[a],h=Aj(a,c,o[a]);n.push(h)}if(r){let a=Aj("indices",r);n.push(a)}return{fields:n,metadata:i}}function gpe(t){let e={};for(let r in t){let i=t[r];e[i.name||"undefined"]=i}return e}function Aj(t,e,r){let i=r?gj(r.metadata):void 0;return rS(t,e,i)}function gj(t){Object.entries(t);let e={};for(let r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}var _j={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},_pe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},ype=4,jx=class{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){let i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);let n=this.decoder.GetEncodedGeometryType(i),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(n){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(i,o);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(i,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!o.ptr){let R=`DRACO decompression failed: ${a.error_msg()}`;throw new Error(R)}let c=this._getDracoLoaderData(o,n,r),h=this._getMeshData(o,c,r),p=Dh(h.attributes),x=mj(h.attributes,c,h.indices);return{loader:"draco",loaderData:c,header:{vertexCount:o.num_points(),boundingBox:p},...h,schema:x}}finally{this.draco.destroy(i),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,r,i){let n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,i);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,r){let i={};for(let n=0;n<e.num_attributes();n++){let o=this.decoder.GetAttribute(e,n),a=this._getAttributeMetadata(e,n);i[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:a};let c=this._getQuantizationTransform(o,r);c&&(i[o.unique_id()].quantization_transform=c);let h=this._getOctahedronTransform(o,r);h&&(i[o.unique_id()].octahedron_transform=h)}return i}_getMeshData(e,r,i){let n=this._getMeshAttributes(r,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,r,i){let n={};for(let o of Object.values(e.attributes)){let a=this._deduceAttributeName(o,i);o.name=a;let c=this._getAttributeValues(r,o);if(c){let{value:h,size:p}=c;n[a]={value:h,size:p,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return n}_getTriangleListIndices(e){let i=e.num_faces()*3,n=i*ype,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,i).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){let r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),vpe(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){let i=_pe[r.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;let n=r.num_components,a=e.num_points()*n,c=a*i.BYTES_PER_ELEMENT,h=xpe(this.draco,i),p,x=this.draco._malloc(c);try{let T=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,T,h,c,x),p=new i(this.draco.HEAPF32.buffer,x,a).slice()}finally{this.draco._free(x)}return{value:p,size:n}}_deduceAttributeName(e,r){let i=e.unique_id;for(let[a,c]of Object.entries(r.extraAttributes||{}))if(c===i)return a;let n=e.attribute_type;for(let a in _j)if(this.draco[a]===n)return _j[a];let o=r.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){let r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){let i=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};let r={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){let o=this.metadataQuerier.GetEntryName(e,n);r[o]=this._getDracoMetadataField(e,o)}return r}_getDracoMetadataField(e,r){let i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,i);let n=bpe(i);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){let{quantizedAttributes:r=[],octahedronAttributes:i=[]}=e,n=[...r,...i];for(let o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,r){let{quantizedAttributes:i=[]}=r,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){let a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(c=>a.min_value(c))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,r){let{octahedronAttributes:i=[]}=r,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){let a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}};function xpe(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function bpe(t){let e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}function vpe(t){let e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}var wpe="1.5.6",Tpe="1.4.1",BP=`https://www.gstatic.com/draco/versioned/decoders/${wpe}`,La={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},LP={[La.DECODER]:`${BP}/${La.DECODER}`,[La.DECODER_WASM]:`${BP}/${La.DECODER_WASM}`,[La.FALLBACK_DECODER]:`${BP}/${La.FALLBACK_DECODER}`,[La.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Tpe}/javascript/${La.ENCODER}`},OP;async function yj(t){let e=t.modules||{};return e.draco3d?OP||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):OP||=Epe(t),await OP}async function Epe(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await wu(LP[La.FALLBACK_DECODER],"draco",t,La.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await wu(LP[La.DECODER],"draco",t,La.DECODER),await wu(LP[La.DECODER_WASM],"draco",t,La.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Cpe(e,r)}function Cpe(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t({...r,onModuleLoaded:n=>i({draco:n})})})}var rT={...pj,parse:Spe};async function Spe(t,e){let{draco:r}=await yj(e),i=new jx(r);try{return i.parseSync(t,e?.draco)}finally{i.destroy()}}function xj(t){let e={};for(let r in t){let i=t[r];if(r!=="indices"){let n=DP(i);e[r]=n}}return e}function DP(t){let{buffer:e,size:r,count:i}=Ipe(t);return{value:e,size:r,byteOffset:0,count:i,type:Z3(r),componentType:kd(e)}}function Ipe(t){let e=t,r=1,i=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=Mpe(e,Float32Array)),i=e.length/r),{buffer:e,size:r,count:i}}function Mpe(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}var Nd="KHR_draco_mesh_compression",Ppe=Nd;function Rpe(t,e,r){let i=new en(t);for(let n of bj(i))i.getObjectExtension(n,Nd)}async function Bpe(t,e,r){if(!e?.gltf?.decompressMeshes)return;let i=new en(t),n=[];for(let o of bj(i))i.getObjectExtension(o,Nd)&&n.push(Ope(i,o,e,r));await Promise.all(n),i.removeExtension(Nd)}function Lpe(t,e={}){let r=new en(t);for(let i of r.json.meshes||[])Dpe(i,e),r.addRequiredExtension(Nd)}async function Ope(t,e,r,i){let n=t.getObjectExtension(e,Nd);if(!n)return;let o=t.getTypedArrayForBufferView(n.bufferView),a=Bp(o.buffer,o.byteOffset),c={...r};delete c["3d-tiles"];let h=await el(a,rT,c,i),p=xj(h.attributes);for(let[x,T]of Object.entries(p))if(x in e.attributes){let R=e.attributes[x],k=t.getAccessor(R);k?.min&&k?.max&&(T.min=k.min,T.max=k.max)}e.attributes=p,h.indices&&(e.indices=DP(h.indices)),t.removeObjectExtension(e,Nd),Fpe(e)}function Dpe(t,e,r=4,i,n){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");let o=i.DracoWriter.encodeSync({attributes:t}),a=n?.parseSync?.({attributes:t}),c=i._addFauxAttributes(a.attributes),h=i.addBufferView(o);return{primitives:[{attributes:c,mode:r,extensions:{[Nd]:{bufferView:h,attributes:c}}}]}}function Fpe(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*bj(t){for(let e of t.json.meshes||[])for(let r of e.primitives)yield r}var kP={};no(kP,{decode:()=>Upe,name:()=>kpe});var nT="KHR_texture_transform",kpe=nT,iT=new ot,Npe=new an,zpe=new an;async function Upe(t,e){if(!new en(t).hasExtension(nT)||!e.gltf?.loadBuffers)return;let n=t.json.materials||[];for(let o=0;o<n.length;o++)Vpe(o,t)}function Vpe(t,e){let r=e.json.materials?.[t],i=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],n=[];for(let o of i)o&&o?.extensions?.[nT]&&jpe(e,t,o,n)}function jpe(t,e,r,i){let n=Gpe(r,i);if(!n)return;let o=t.json.meshes||[];for(let a of o)for(let c of a.primitives){let h=c.material;Number.isFinite(h)&&e===h&&Hpe(t,c,n)}}function Gpe(t,e){let r=t.extensions?.[nT],{texCoord:i=0}=t,{texCoord:n=i}=r;if(!(e.findIndex(([a,c])=>a===i&&c===n)!==-1)){let a=qpe(r);return i!==n&&(t.texCoord=n),e.push([i,n]),{originalTexCoord:i,texCoord:n,matrix:a}}return null}function Hpe(t,e,r){let{originalTexCoord:i,texCoord:n,matrix:o}=r,a=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(a)){let c=t.json.accessors?.[a];if(c&&c.bufferView){let h=t.json.bufferViews?.[c.bufferView];if(h){let{arrayBuffer:p,byteOffset:x}=t.buffers[h.buffer],T=(x||0)+(c.byteOffset||0)+(h.byteOffset||0),{ArrayType:R,length:k}=rg(c,h),j=q3[c.componentType],q=$3[c.type],Z=h.byteStride||j*q,re=new Float32Array(k);for(let ee=0;ee<c.count;ee++){let se=new R(p,T+ee*Z,2);iT.set(se[0],se[1],1),iT.transformByMatrix3(o),re.set([iT[0],iT[1]],ee*q)}i===n?Wpe(c,h,t.buffers,re):$pe(n,c,e,t,re)}}}}function Wpe(t,e,r,i){t.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function $pe(t,e,r,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});let o=i.json.bufferViews;if(!o)return;o.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});let a=i.json.accessors;a&&(a.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=a.length-1)}function qpe(t){let{offset:e=[0,0],rotation:r=0,scale:i=[1,1]}=t,n=new an().set(1,0,0,0,1,0,e[0],e[1],1),o=Npe.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),a=zpe.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(a)}var NP={};no(NP,{decode:()=>Xpe,encode:()=>Ype,name:()=>Zpe});var MA="KHR_lights_punctual",Zpe=MA;async function Xpe(t){let e=new en(t),{json:r}=e,i=e.getExtension(MA);i&&(e.json.lights=i.lights,e.removeExtension(MA));for(let n of r.nodes||[]){let o=e.getObjectExtension(n,MA);o&&(n.light=o.light),e.removeObjectExtension(n,MA)}}async function Ype(t){let e=new en(t),{json:r}=e;if(r.lights){let i=e.addExtension(MA);os(!i.lights),i.lights=r.lights,delete r.lights}if(e.json.lights){for(let i of e.json.lights){let n=i.node;e.addObjectExtension(n,MA,i)}delete e.json.lights}}var zP={};no(zP,{decode:()=>Qpe,encode:()=>Jpe,name:()=>Kpe});var Gx="KHR_materials_unlit",Kpe=Gx;async function Qpe(t){let e=new en(t),{json:r}=e;for(let i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,Gx);e.removeExtension(Gx)}function Jpe(t){let e=new en(t),{json:r}=e;if(e.materials)for(let i of r.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,Gx,{}),e.addExtension(Gx))}var UP={};no(UP,{decode:()=>tAe,encode:()=>rAe,name:()=>eAe});var Hx="KHR_techniques_webgl",eAe=Hx;async function tAe(t){let e=new en(t),{json:r}=e,i=e.getExtension(Hx);if(i){let n=iAe(i,e);for(let o of r.materials||[]){let a=e.getObjectExtension(o,Hx);a&&(o.technique=Object.assign({},a,n[a.technique]),o.technique.values=nAe(o.technique,e)),e.removeObjectExtension(o,Hx)}e.removeExtension(Hx)}}async function rAe(t,e){}function iAe(t,e){let{programs:r=[],shaders:i=[],techniques:n=[]}=t,o=new TextDecoder;return i.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=o.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(a=>{a.fragmentShader=i[a.fragmentShader],a.vertexShader=i[a.vertexShader]}),n.forEach(a=>{a.program=r[a.program]}),n}function nAe(t,e){let r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in r)&&(r[i]=t.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=e.getTexture(r[i].index))}),r}var vj=[vP,yP,MP,PP,RP,FP,NP,zP,UP,kP,wP];function wj(t,e={},r){let i=vj.filter(n=>Ej(n.name,e));for(let n of i)n.preprocess?.(t,e,r)}async function Tj(t,e={},r){let i=vj.filter(n=>Ej(n.name,e));for(let n of i)await n.decode?.(t,e,r)}function Ej(t,e){let r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}var VP="KHR_binary_glTF";function Cj(t){let e=new en(t),{json:r}=e;for(let i of r.images||[]){let n=e.getObjectExtension(i,VP);n&&Object.assign(i,n),e.removeObjectExtension(i,VP)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(VP)}var Sj={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},sAe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},jP=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;let i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),Cj(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(let r in Sj)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){let i=e[r];if(!(!i||Array.isArray(i))){e[r]=[];for(let n in i){let o=i[n];o.id=o.id||n;let a=e[r].length;e[r].push(o),this.idToIndexMap[r][n]=a}}}_convertObjectIdsToArrayIndices(e){for(let r in Sj)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(let r of e.textures)this._convertTextureIds(r);for(let r of e.meshes)this._convertMeshIds(r);for(let r of e.nodes)this._convertNodeIds(r);for(let r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(let r of e.primitives){let{attributes:i,indices:n,material:o}=r;for(let a in i)i[a]=this._convertIdToIndex(i[a],"accessor");n&&(r.indices=this._convertIdToIndex(n,"accessor")),o&&(r.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(let i of e[r])for(let n in i){let o=i[n],a=this._convertIdToIndex(o,n);i[n]=a}}_convertIdToIndex(e,r){let i=sAe[r];if(i in this.idToIndexMap){let n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return n}return e}_updateObjects(e){for(let r of this.json.buffers)delete r.type}_updateMaterial(e){for(let r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let i=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,n=e.textures.findIndex(o=>o.id===i);n!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:n})}}};function Ij(t,e={}){return new jP().normalize(t,e)}async function Mj(t,e,r=0,i,n){return aAe(t,e,r,i),Ij(t,{normalize:i?.gltf?.normalize}),wj(t,i,n),i?.gltf?.loadBuffers&&t.json.buffers&&await lAe(t,i,n),i?.gltf?.loadImages&&await cAe(t,i,n),await Tj(t,i,n),t}function aAe(t,e,r,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!uj(e,r,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=kC(e);else if(e instanceof ArrayBuffer){let a={};r=hj(a,e,r,i.glb),os(a.type==="glTF",`Invalid GLB magic string ${a.type}`),t._glb=a,t.json=a.json}else os(!1,"GLTF: must be ArrayBuffer or string");let n=t.json.buffers||[];if(t.buffers=new Array(n.length).fill(null),t._glb&&t._glb.header.hasBinChunk){let{binChunks:a}=t._glb;t.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}let o=t.json.images||[];t.images=new Array(o.length).fill({})}async function lAe(t,e,r){let i=t.json.buffers||[];for(let n=0;n<i.length;++n){let o=i[n];if(o.uri){let{fetch:a}=r;os(a);let c=SP(o.uri,e),p=await(await r?.fetch?.(c))?.arrayBuffer?.();t.buffers[n]={arrayBuffer:p,byteOffset:0,byteLength:p.byteLength},delete o.uri}else t.buffers[n]===null&&(t.buffers[n]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function cAe(t,e,r){let i=uAe(t),n=t.json.images||[],o=[];for(let a of i)o.push(hAe(t,n[a],a,e,r));return await Promise.all(o)}function uAe(t){let e=new Set,r=t.json.textures||[];for(let i of r)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function hAe(t,e,r,i,n){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){let c=SP(e.uri,i),{fetch:h}=n;o=await(await h(c)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){let c=rj(t.json,t.buffers,e.bufferView);o=Bp(c.buffer,c.byteOffset,c.byteLength)}os(o,"glTF image has no data");let a=await el(o,[sd,pP],{...i,mimeType:e.mimeType,basis:i.basis||{format:G3()}},n);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),t.images=t.images||[],t.images[r]=a}var Jh={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:lj,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:fAe,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function fAe(t,e={},r){e={...Jh.options,...e},e.gltf={...Jh.options.gltf,...e.gltf};let{byteOffset:i=0}=e;return await Mj({},t,i,e,r)}var dAe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pAe={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},kl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},AAe={magFilter:kl.TEXTURE_MAG_FILTER,minFilter:kl.TEXTURE_MIN_FILTER,wrapS:kl.TEXTURE_WRAP_S,wrapT:kl.TEXTURE_WRAP_T},mAe={[kl.TEXTURE_MAG_FILTER]:kl.LINEAR,[kl.TEXTURE_MIN_FILTER]:kl.NEAREST_MIPMAP_LINEAR,[kl.TEXTURE_WRAP_S]:kl.REPEAT,[kl.TEXTURE_WRAP_T]:kl.REPEAT};function gAe(){return{id:"default-sampler",parameters:mAe}}function _Ae(t){return pAe[t]}function yAe(t){return dAe[t]}var GP=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){let{json:i,buffers:n=[],images:o=[]}=e,{baseUri:a=""}=e;return os(i),this.baseUri=a,this.buffers=n,this.images=o,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){let i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,o)=>this._resolveBufferView(n,o))),e.images&&(i.images=e.images.map((n,o)=>this._resolveImage(n,o))),e.samplers&&(i.samplers=e.samplers.map((n,o)=>this._resolveSampler(n,o))),e.textures&&(i.textures=e.textures.map((n,o)=>this._resolveTexture(n,o))),e.accessors&&(i.accessors=e.accessors.map((n,o)=>this._resolveAccessor(n,o))),e.materials&&(i.materials=e.materials.map((n,o)=>this._resolveMaterial(n,o))),e.meshes&&(i.meshes=e.meshes.map((n,o)=>this._resolveMesh(n,o))),e.nodes&&(i.nodes=e.nodes.map((n,o)=>this._resolveNode(n,o)),i.nodes=i.nodes.map((n,o)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,o)=>this._resolveSkin(n,o))),e.scenes&&(i.scenes=e.scenes.map((n,o)=>this._resolveScene(n,o))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;let i=e&&e[r];return i||console.warn(`glTF file error: Could not find ${e}[${r}]`),i}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,r){let i={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,o)=>{let a=this.getMesh(o);return n.id=a.id,n.primitives=n.primitives.concat(a.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){let i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:i}}_resolveMesh(e,r){let i={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{let o={...n,attributes:{},indices:void 0,material:void 0},a=n.attributes;for(let c in a)o.attributes[c]=this.getAccessor(a[c]);return n.indices!==void 0&&(o.indices=this.getAccessor(n.indices)),n.material!==void 0&&(o.material=this.getMaterial(n.material)),o})),i}_resolveMaterial(e,r){let i={...e,id:e.id||`material-${r}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};let n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,r){let i=_Ae(e.componentType),n=yAe(e.type),o=i*n,a={...e,id:e.id||`accessor-${r}`,bytesPerComponent:i,components:n,bytesPerElement:o,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){let c=a.bufferView.buffer,{ArrayType:h,byteLength:p}=rg(a,a.bufferView),x=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+c.byteOffset,T=c.arrayBuffer.slice(x,x+p);a.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(c,x,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new h(T)}return a}_getValueFromInterleavedBuffer(e,r,i,n,o){let a=new Uint8Array(o*n);for(let c=0;c<o;c++){let h=r+c*i;a.set(new Uint8Array(e.arrayBuffer.slice(h,h+n)),c*n)}return a.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):gAe(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){let i={id:e.id||`sampler-${r}`,...e,parameters:{}};for(let n in i){let o=this._enumSamplerParameter(n);o!==void 0&&(i.parameters[o]=i[n])}return i}_enumSamplerParameter(e){return AAe[e]}_resolveImage(e,r){let i={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[r];return n&&(i.image=n),i}_resolveBufferView(e,r){let i=e.buffer,n=this.buffers[i].arrayBuffer,o=this.buffers[i].byteOffset||0;return e.byteOffset&&(o+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,o,e.byteLength)}}_resolveCamera(e,r){let i={...e,id:e.id||`camera-${r}`};return i.perspective,i.orthographic,i}};function PA(t,e){return new GP().postProcess(t,e)}async function Pj(t){let e=[];return t.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.uniforms).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await xAe(()=>e.some(r=>!r.loaded))}async function xAe(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}var Rj=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,Bj={name:"scenegraph",vs:Rj,fs:Rj,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}};var Lj=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Oj=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Dj=[255,255,255,255],bAe={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Dj},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Jh]},Wx=class extends ln{getShaders(){let e={},r;this.props._lighting==="pbr"?(r=Kp,e.LIGHTING_PBR=1):r={name:"pbrMaterial"};let i=[Bi,Sn,Bj,r];return super.getShaders({defines:e,vs:Lj,fs:Oj,modules:i})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:Dj,transition:!0},instanceModelMatrix:z3})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){let e=this.props,{device:r}=this.context,i=null;if(e.scenegraph instanceof Fu)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){let c=e.scenegraph,h=c.json?PA(c):c,p=_P(r,h,this._getModelOptions());i={gltf:h,...p},Pj(p).then(()=>{this.setNeedsRedraw()}).catch(x=>{this.raiseError(x,"loading glTF")})}let n={layer:this,device:this.context.device},o=e.getScene(i,n),a=e.getAnimator(i,n);if(o instanceof Hh){this.state.scenegraph?.destroy(),this._applyAnimationsProp(a,e._animations);let c=[];o.traverse(h=>{h instanceof _d&&c.push(h.model)}),this.setState({scenegraph:o,animator:a,models:c}),this.getAttributeManager().invalidateAll()}else o!==null&&cr.warn("invalid scenegraph:",o)()}_applyAnimationsProp(e,r){if(!e||!r)return;let i=e.getAnimations();Object.keys(r).sort().forEach(n=>{let o=r[n];if(n==="*")i.forEach(a=>{Object.assign(a,o)});else if(Number.isFinite(Number(n))){let a=Number(n);a>=0&&a<i.length?Object.assign(i[a],o):cr.warn(`animation ${n} not found`)()}else{let a=i.find(({name:c})=>c===n);a?Object.assign(a,o):cr.warn(`animation ${n} not found`)()}})}_getModelOptions(){let{_imageBasedLightingEnvironment:e}=this.props,r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());let{viewport:r,renderPass:i}=this.context,{sizeScale:n,sizeMinPixels:o,sizeMaxPixels:a,coordinateSystem:c}=this.props,h=this.getNumInstances();this.state.scenegraph.traverse((p,{worldMatrix:x})=>{if(p instanceof _d){let{model:T}=p;T.setInstanceCount(h);let R={camera:T.uniforms.cameraPosition},k={sizeScale:n,sizeMinPixels:o,sizeMaxPixels:a,composeModelMatrix:U3(r,c),sceneModelMatrix:x};T.shaderInputs.setProps({pbrProjection:R,scenegraph:k}),T.draw(i)}})}};Wx.defaultProps=bAe;Wx.layerName="ScenegraphLayer";var HP=Wx;var Fj=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,kj={name:"mesh",vs:Fj,fs:Fj,uniformTypes:{pickFeatureIds:"f32"}};var Nj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var zj=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function vAe(t){let e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}var wAe={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},$x=class extends tg{getShaders(){let e=super.getShaders();return e.modules.push(Kp,kj),{...e,vs:Nj,fs:zj}}initializeState(){let{featureIds:e}=this.props;super.initializeState();let r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){let{featureIds:r}=this.props,{model:i}=this.state;if(!i)return;let n={pickFeatureIds:!!r},o={camera:i.uniforms.cameraPosition};i.shaderInputs.setProps({pbrProjection:o,mesh:n}),super.draw(e)}getModel(e){let{id:r}=this.props,i=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:i});let n=this.getShaders();return vAe(e.attributes),new di(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...n.defines,...i?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:i?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){let{model:r}=this.state;if(r){let{mesh:i}=this.props,n=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:n});let{pbr_baseColorSampler:o}=n.bindings,{emptyTexture:a}=this.state,c={sampler:o||a,hasTexture:!!o},{camera:h,...p}={...n.bindings,...n.uniforms};r.shaderInputs.setProps({simpleMesh:c,pbrMaterial:p})}}parseMaterial(e,r){let i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return zx(this.context.device,{unlit:i,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){let r=this.props.featureIds,i=new Uint8ClampedArray(r.length*e.size),n=[];for(let o=0;o<r.length;o++)this.encodePickingColor(r[o],n),i[o*3]=n[0],i[o*3+1]=n[1],i[o*3+2]=n[2];e.value=i}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}};$x.layerName="MeshLayer";$x.defaultProps=wAe;var Uj=$x;var ef=6356752314245179e-9,TAe={radii:[6378137,6378137,ef],radiiSquared:[6378137*6378137,6378137*6378137,ef*ef],oneOverRadii:[1/6378137,1/6378137,1/ef],oneOverRadiiSquared:[1/(6378137*6378137),1/(6378137*6378137),1/(ef*ef)],maximumRadius:Math.max(6378137,6378137,ef),centerToleranceSquared:.1};function oT(t){return t}var nZe=new ot;function EAe(t,e=[],r=oT){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function Vj(t,e=[]){return EAe(t,e,On._cartographicRadians?oT:eI)}function CAe(t,e,r=oT){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function jj(t,e){return CAe(t,e,On._cartographicRadians?oT:tI)}var Gj=1e-14,SAe=new ot,Hj={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},WP={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},qx={east:new ot,north:new ot,up:new ot,west:new ot,south:new ot,down:new ot},IAe=new ot,MAe=new ot,PAe=new ot;function $P(t,e,r,i,n,o){let a=Hj[e]&&Hj[e][r];bs(a&&(!i||i===a));let c,h,p,x=SAe.copy(n);if(Wo(x.x,0,Gj)&&Wo(x.y,0,Gj)){let R=Math.sign(x.z);c=IAe.fromArray(WP[e]),e!=="east"&&e!=="west"&&c.scale(R),h=MAe.fromArray(WP[r]),r!=="east"&&r!=="west"&&h.scale(R),p=PAe.fromArray(WP[i]),i!=="east"&&i!=="west"&&p.scale(R)}else{let{up:R,east:k,north:j}=qx;k.set(-x.y,x.x,0).normalize(),t.geodeticSurfaceNormal(x,R),j.copy(R).cross(k);let{down:q,west:Z,south:re}=qx;q.copy(R).scale(-1),Z.copy(k).scale(-1),re.copy(j).scale(-1),c=qx[e],h=qx[r],p=qx[i]}return o[0]=c.x,o[1]=c.y,o[2]=c.z,o[3]=0,o[4]=h.x,o[5]=h.y,o[6]=h.z,o[7]=0,o[8]=p.x,o[9]=p.y,o[10]=p.z,o[11]=0,o[12]=x.x,o[13]=x.y,o[14]=x.z,o[15]=1,o}var ug=new ot,RAe=new ot,BAe=new ot;function Wj(t,e,r=[]){let{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:o}=e;ug.from(t);let a=ug.x,c=ug.y,h=ug.z,p=i.x,x=i.y,T=i.z,R=a*a*p*p,k=c*c*x*x,j=h*h*T*T,q=R+k+j,Z=Math.sqrt(1/q);if(!Number.isFinite(Z))return;let re=RAe;if(re.copy(t).scale(Z),q<o)return re.to(r);let ee=n.x,se=n.y,me=n.z,Le=BAe;Le.set(re.x*ee*2,re.y*se*2,re.z*me*2);let je=(1-Z)*ug.len()/(.5*Le.len()),Je=0,J,te,X,ye;do{je-=Je,J=1/(1+je*ee),te=1/(1+je*se),X=1/(1+je*me);let _e=J*J,Oe=te*te,ve=X*X,De=_e*J,Xe=Oe*te,rt=ve*X;ye=R*_e+k*Oe+j*ve-1;let yt=-2*(R*De*ee+k*Xe*se+j*rt*me);Je=ye/yt}while(Math.abs(ye)>Cc.EPSILON12);return ug.scale([J,te,X]).to(r)}var sT=new ot,$j=new ot,DAe=new ot,zc=new ot,FAe=new ot,aT=new ot,Li=class{constructor(e=0,r=0,i=0){this.centerToleranceSquared=Cc.EPSILON1,bs(e>=0),bs(r>=0),bs(i>=0),this.radii=new ot(e,r,i),this.radiiSquared=new ot(e*e,r*r,i*i),this.radiiToTheFourth=new ot(e*e*e*e,r*r*r*r,i*i*i*i),this.oneOverRadii=new ot(e===0?0:1/e,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new ot(e===0?0:1/(e*e),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,r,i),this.maximumRadius=Math.max(e,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){let i=$j,n=DAe,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,i),n.copy(this.radiiSquared).scale(i);let a=Math.sqrt(i.dot(n));return n.scale(1/a),i.scale(o),n.add(i),n.to(r)}cartesianToCartographic(e,r=[0,0,0]){aT.from(e);let i=this.scaleToGeodeticSurface(aT,zc);if(!i)return;let n=this.geodeticSurfaceNormal(i,$j),o=FAe;o.copy(aT).subtract(i);let a=Math.atan2(n.y,n.x),c=Math.asin(n.z),h=Math.sign(Fs.dot(o,aT))*Fs.length(o);return jj([a,c,h],r)}eastNorthUpToFixedFrame(e,r=new wr){return $P(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,i,n,o=new wr){return $P(this,e,r,i,n,o)}geocentricSurfaceNormal(e,r=[0,0,0]){return sT.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){let i=Vj(e),n=i[0],o=i[1],a=Math.cos(o);return sT.set(a*Math.cos(n),a*Math.sin(n),Math.sin(o)).normalize(),sT.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return sT.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return Wj(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){zc.from(e);let i=zc.x,n=zc.y,o=zc.z,a=this.oneOverRadiiSquared,c=1/Math.sqrt(i*i*a.x+n*n*a.y+o*o*a.z);return zc.multiplyScalar(c).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return zc.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return zc.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,i=[0,0,0]){bs(Wo(this.radii.x,this.radii.y,Cc.EPSILON15)),bs(this.radii.z>0),zc.from(e);let n=zc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-r))return zc.set(0,0,n).to(i)}};Li.WGS84=new Li(6378137,6378137,ef);var lT=class{item;previous;next;constructor(e,r,i){this.item=e,this.previous=r,this.next=i}};var cT=class{head=null;tail=null;_length=0;get length(){return this._length}add(e){let r=new lT(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){let i=e.next;e.next=r,this.tail===e?this.tail=r:i.previous=r,r.next=i,r.previous=e,++this._length}};var uT=class{_list;_sentinel;_trimTiles;constructor(){this._list=new cT,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){let r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(e,r))}unloadTile(e,r,i){let n=r._cacheNode;n&&(this._list.remove(n),r._cacheNode=null,i&&i(e,r))}unloadTiles(e,r){let i=this._trimTiles;this._trimTiles=!1;let n=this._list,o=e.maximumMemoryUsage*1024*1024,a=this._sentinel,c=n.head;for(;c!==a&&(e.gpuMemoryUsageInBytes>o||i);){let h=c.item;c=c.next,this.unloadTile(e,h,r)}}trim(){this._trimTiles=!0}};function qj(t,e){Si(t),Si(e);let{rtcCenter:r,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:o}}=t,a=new wr(n);switch(r&&a.translate(r),i){case"Z":break;case"Y":let T=new wr().rotateX(Math.PI/2);a=a.multiplyRight(T);break;case"X":let R=new wr().rotateY(-Math.PI/2);a=a.multiplyRight(R);break;default:break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);let c=new ot(o);e.cartesianModelMatrix=a,e.cartesianOrigin=c;let h=Li.WGS84.cartesianToCartographic(c,new ot),x=Li.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=x.multiplyRight(a),e.cartographicOrigin=h,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}var Zj=new ot,qP=new ot,ZP=new fa([new qs,new qs,new qs,new qs,new qs,new qs]);function Yj(t,e){let{cameraDirection:r,cameraUp:i,height:n}=t,{metersPerUnit:o}=t.distanceScales,a=hT(t,t.center),c=Li.WGS84.eastNorthUpToFixedFrame(a),h=t.unprojectPosition(t.cameraPosition),p=Li.WGS84.cartographicToCartesian(h,new ot),x=new ot(c.transformAsVector(new ot(r).scale(o))).normalize(),T=new ot(c.transformAsVector(new ot(i).scale(o))).normalize();kAe(t);let R=t.constructor,{longitude:k,latitude:j,width:q,bearing:Z,zoom:re}=t,ee=new R({longitude:k,latitude:j,height:n,width:q,bearing:Z,zoom:re,pitch:0});return{camera:{position:p,direction:x,up:T},viewport:t,topDownViewport:ee,height:n,cullingVolume:ZP,frameNumber:e,sseDenominator:1.15}}function Kj(t,e,r){if(r===0||t.length<=r)return[t,[]];let i=[],{longitude:n,latitude:o}=e.viewport;for(let[p,x]of t.entries()){let[T,R]=x.header.mbs,k=Math.abs(n-T),j=Math.abs(o-R),q=Math.sqrt(j*j+k*k);i.push([p,q])}let a=i.sort((p,x)=>p[1]-x[1]),c=[];for(let p=0;p<r;p++)c.push(t[a[p][0]]);let h=[];for(let p=r;p<a.length;p++)h.push(t[a[p][0]]);return[c,h]}function kAe(t){let e=t.getFrustumPlanes(),r=Xj(e.near,t.cameraPosition),i=hT(t,r),n=hT(t,t.cameraPosition,qP),o=0;ZP.planes[o++].fromPointNormal(i,Zj.copy(i).subtract(n));for(let a in e){if(a==="near")continue;let c=e[a],h=Xj(c,r,qP),p=hT(t,h,qP);ZP.planes[o++].fromPointNormal(p,Zj.copy(i).subtract(p))}}function Xj(t,e,r=new ot){let i=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-i).add(e),r}function hT(t,e,r=new ot){let i=t.unprojectPosition(e);return Li.WGS84.cartographicToCartesian(i,r)}var NAe=6378137,zAe=6378137,XP=6356752314245179e-9,hg=new ot;function Qj(t,e){if(t instanceof Kh){let{halfAxes:r}=t,i=UAe(r);return Math.log2(XP/(i+e[2]))}else if(t instanceof Zu){let{radius:r}=t;return Math.log2(XP/(r+e[2]))}else if(t.width&&t.height){let{width:r,height:i}=t,n=Math.log2(NAe/r),o=Math.log2(zAe/i);return(n+o)/2}return 1}function YP(t,e,r){Li.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],hg);let i=Math.sqrt(Math.pow(hg[0]-r[0],2)+Math.pow(hg[1]-r[1],2)+Math.pow(hg[2]-r[2],2));return Math.log2(XP/(i+e[2]))}function Jj(t,e,r){let[i,n,o,a]=t;return YP({xmin:i,xmax:o,ymin:n,ymax:a,zmin:0,zmax:0},e,r)}function UAe(t){t.getColumn(0,hg);let e=t.getColumn(1),r=t.getColumn(2);return hg.add(e).add(r).len()}var da={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Xs;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(Xs||(Xs={}));var Nl;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Nl||(Nl={}));var Ts;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(Ts||(Ts={}));var tf;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(tf||(tf={}));var eG={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function nG(t){return t!=null}var Ys=new ot,fT=new ot,VAe=new ot,jAe=new ot,RA=new ot,tG=new ot,rG=new ot,iG=new ot;function dT(t,e,r){if(Si(t,"3D Tile: boundingVolume must be defined"),t.box)return sG(t.box,e,r);if(t.region)return HAe(t.region);if(t.sphere)return GAe(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function oG(t,e){if(t.box)return WAe(e);if(t.region){let[r,i,n,o,a,c]=t.region;return[[nl(r),nl(i),a],[nl(n),nl(o),c]]}if(t.sphere)return $Ae(e);throw new Error("Unkown boundingVolume type")}function sG(t,e,r){let i=new ot(t[0],t[1],t[2]);e.transform(i,i);let n=[];if(t.length===10){let p=t.slice(3,6),x=new Rl;x.fromArray(t,6);let T=new ot([1,0,0]),R=new ot([0,1,0]),k=new ot([0,0,1]);T.transformByQuaternion(x),T.scale(p[0]),R.transformByQuaternion(x),R.scale(p[1]),k.transformByQuaternion(x),k.scale(p[2]),n=[...T.toArray(),...R.toArray(),...k.toArray()]}else n=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];let o=e.transformAsVector(n.slice(0,3)),a=e.transformAsVector(n.slice(3,6)),c=e.transformAsVector(n.slice(6,9)),h=new an([o[0],o[1],o[2],a[0],a[1],a[2],c[0],c[1],c[2]]);return nG(r)?(r.center=i,r.halfAxes=h,r):new Kh(i,h)}function GAe(t,e,r){let i=new ot(t[0],t[1],t[2]);e.transform(i,i);let n=e.getScale(fT),o=Math.max(Math.max(n[0],n[1]),n[2]),a=t[3]*o;return nG(r)?(r.center=i,r.radius=a,r):new Zu(i,a)}function HAe(t){let[e,r,i,n,o,a]=t,c=Li.WGS84.cartographicToCartesian([nl(e),nl(n),o],VAe),h=Li.WGS84.cartographicToCartesian([nl(i),nl(r),a],jAe),p=new ot().addVectors(c,h).multiplyByScalar(.5);return Li.WGS84.cartesianToCartographic(p,RA),Li.WGS84.cartographicToCartesian([nl(i),RA[1],RA[2]],tG),Li.WGS84.cartographicToCartesian([RA[0],nl(n),RA[2]],rG),Li.WGS84.cartographicToCartesian([RA[0],RA[1],a],iG),sG([...p,...tG.subtract(p),...rG.subtract(p),...iG.subtract(p)],new wr)}function WAe(t){let e=aG(),{halfAxes:r}=t,i=new ot(r.getColumn(0)),n=new ot(r.getColumn(1)),o=new ot(r.getColumn(2));for(let a=0;a<2;a++){for(let c=0;c<2;c++){for(let h=0;h<2;h++)Ys.copy(t.center),Ys.add(i),Ys.add(n),Ys.add(o),lG(e,Ys),o.negate();n.negate()}i.negate()}return e}function $Ae(t){let e=aG(),{center:r,radius:i}=t,n=Li.WGS84.scaleToGeodeticSurface(r,Ys),o;n?o=Li.WGS84.geodeticSurfaceNormal(n):o=new ot(0,0,1);let a=new ot(o[2],-o[1],0);a.len()>0?a.normalize():a=new ot(0,1,0);let c=a.clone().cross(o);for(let h of[a,c,o]){fT.copy(h).scale(i);for(let p=0;p<2;p++)Ys.copy(r),Ys.add(fT),lG(e,Ys),fT.negate()}return e}function aG(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function lG(t,e){Li.WGS84.cartesianToCartographic(e,Ys),t[0][0]=Math.min(t[0][0],Ys[0]),t[0][1]=Math.min(t[0][1],Ys[1]),t[0][2]=Math.min(t[0][2],Ys[2]),t[1][0]=Math.max(t[1][0],Ys[0]),t[1][1]=Math.max(t[1][1],Ys[1]),t[1][2]=Math.max(t[1][2],Ys[2])}var HZe=new ot,WZe=new ot,$Ze=new wr,qZe=new ot,ZZe=new ot,XZe=new ot;function qAe(t,e){let r=t*e;return 1-Math.exp(-(r*r))}function ZAe(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){let r=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return qAe(e,r)*i}return 0}function cG(t,e,r){let i=t.tileset,n=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,o=r?n:t.lodMetricValue;if(o===0)return 0;let a=Math.max(t._distanceToCamera,1e-7),{height:c,sseDenominator:h}=e,{viewDistanceScale:p}=i.options,x=o*c*(p||1)/(a*h);return x-=ZAe(i,a),x}var KP=new ot,uG=new ot,zd=new ot,hG=new ot,XAe=new ot,QP=new wr,fG=new wr;function dG(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";let r=2*JP(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function JP(t,e){let{topDownViewport:r}=e,i=t.header.mbs[1],n=t.header.mbs[0],o=t.header.mbs[2],a=t.header.mbs[3],c=[...t.boundingVolume.center],h=r.unprojectPosition(r.cameraPosition);Li.WGS84.cartographicToCartesian(h,KP),uG.copy(KP).subtract(c).normalize(),Li.WGS84.eastNorthUpToFixedFrame(c,QP),fG.copy(QP).invert(),zd.copy(KP).transform(fG);let p=Math.sqrt(zd[0]*zd[0]+zd[1]*zd[1]),x=p*p/zd[2];hG.copy([zd[0],zd[1],x]);let R=hG.transform(QP).subtract(c).normalize(),j=uG.cross(R).normalize().scale(a).add(c),q=Li.WGS84.cartesianToCartographic(j),Z=r.project([n,i,o]),re=r.project(q);return XAe.copy(Z).subtract(re).magnitude()}function pG(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}var Zx=class{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Si(e<this._array.length),this._array[e]}set(e,r){Si(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){let r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){let r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){let e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Si(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Si(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}};var YAe={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""},Ku=class{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new Zx;_emptyTraversalStack=new Zx;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...YAe,...e}}traverse(e,r,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){let i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){let o=i.pop(),a=!1;this.canTraverse(o,r)&&(this.updateChildTiles(o,r),a=this.updateAndPushChildren(o,r,i,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));let c=o.parent,h=!!(!c||c._shouldRefine),p=!a;o.hasRenderContent?o.refine===Xs.ADD?(this.loadTile(o,r),this.selectTile(o,r)):o.refine===Xs.REPLACE&&(this.loadTile(o,r),p&&this.selectTile(o,r)):(this.emptyTiles[o.id]=o,this.loadTile(o,r),p&&this.selectTile(o,r)),this.touchTile(o,r),o._shouldRefine=a&&h}let n=new Date().getTime();(this.traversalFinished(r)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(r))}updateChildTiles(e,r){let i=e.children;for(let n of i)this.updateTile(n,r)}updateAndPushChildren(e,r,i,n){let{loadSiblings:o,skipLevelOfDetail:a}=this.options,c=e.children;c.sort(this.compareDistanceToCamera.bind(this));let h=e.refine===Xs.REPLACE&&e.hasRenderContent&&!a,p=!1,x=!0;for(let T of c)if(T._selectionDepth=n,T.isVisibleAndInRequestVolume?(i.find(T)&&i.delete(T),i.push(T),p=!0):(h||o)&&(this.loadTile(T,r),this.touchTile(T,r)),h){let R;if(T._inRequestVolume?T.hasRenderContent?R=T.contentAvailable:R=this.executeEmptyTraversal(T,r):R=!1,x=x&&R,!x)return!1}return p||(x=!1),x}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,i=!1){let n=e._screenSpaceError;return i&&(n=e.getScreenSpaceError(r,!0)),n>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){let i=[];if(this.options.viewportTraversersMap)for(let n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===r.viewport.id&&i.push(n);else i.push(r.viewport.id);e.updateVisibility(r,i)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let i=!1;for(let n of e.children)n.updateVisibility(r),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,r){let i=!0,n=this._emptyTraversalStack;for(n.push(e);n.length>0;){let o=n.pop(),a=!o.hasRenderContent&&this.canTraverse(o,r),c=!o.hasRenderContent&&o.children.length===0;if(!a&&!o.contentAvailable&&!c&&(i=!1),this.updateTile(o,r),o.isVisibleAndInRequestVolume||(this.loadTile(o,r),this.touchTile(o,r)),a){let h=o.children;for(let p of h)n.push(p)}}return i}};var AG=new ot;function KAe(t){return t!=null}var BA=class{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=da.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new wr;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new Ku({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new wr;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,r,i,n=""){this.header=r,this.tileset=e,this.id=n||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===da.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===da.UNLOADED}get contentExpired(){return this.contentState===da.EXPIRED}get contentFailed(){return this.contentState===da.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=oG(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case Ts.I3S:return JP(this,e);case Ts.TILES3D:return cG(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){let e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,i=this.refine===Xs.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===da.UNLOADED)return-1;let n=this.parent,a=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,c=e.root?e.root._screenSpaceError:0;return Math.max(c-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=da.LOADING;let r=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!r)return this.contentState=da.UNLOADED,!1;try{let i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await ys(i,n,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=da.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=da.FAILED,i}finally{r.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=da.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;let i=this.parent,n=i?i._visibilityPlaneMask:fa.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){let o=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==fa.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){let{cullingVolume:i}=e,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,r)}contentVisibility(){return!0}distanceToTile(e){let r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){let r=this.boundingVolume;return AG.subVectors(r.center,e.position),e.direction.dot(AG)}insideViewerRequestVolume(e){let r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(KAe(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){let e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=da.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new wr(e.transform):new wr;let r=this.parent,i=this.tileset,n=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new wr(n).multiplyRight(this.transform);let o=r&&r._initialTransform?r._initialTransform.clone():new wr;this._initialTransform=new wr(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=da.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=fa.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Xs.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break;default:}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=dT(e.boundingVolume,this.computedTransform,this.boundingVolume);let r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=dT(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=dT(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new wr){let r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return pG(this.tileset.tileset)}}};var pT=class extends Ku{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;let i=e.children.length>0;if(e.hasTilesetContent&&i){let a=e.children[0];this.updateTileVisibility(a,r),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}let n=e.refine===Xs.REPLACE,o=e._optimChildrenWithinParent===eG.USE_OPTIMIZATION;if(n&&o&&i&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){let{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==Xs.ADD?!1:!this.shouldRefine(e,r,!0)}};var AT=class{frameNumberMap=new Map;register(e,r){let i=this.frameNumberMap.get(e)||new Map,n=i.get(r)||0;i.set(r,n+1),this.frameNumberMap.set(e,i)}deregister(e,r){let i=this.frameNumberMap.get(e);if(!i)return;let n=i.get(r)||1;i.set(r,n-1)}isZero(e,r){return(this.frameNumberMap.get(e)?.get(r)||0)===0}};var e5={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"},mT=class{_statusMap;pendingTilesRegister=new AT;constructor(){this._statusMap={}}add(e,r,i,n){if(!this._statusMap[r]){let{frameNumber:o,viewport:{id:a}}=n;this._statusMap[r]={request:e,callback:i,key:r,frameState:n,status:e5.REQUESTED},this.pendingTilesRegister.register(a,o),e().then(c=>{this._statusMap[r].status=e5.COMPLETED;let{frameNumber:h,viewport:{id:p}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(p,h),this._statusMap[r].callback(c,n)}).catch(c=>{this._statusMap[r].status=e5.ERROR;let{frameNumber:h,viewport:{id:p}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(p,h),i(c)})}}update(e,r){if(this._statusMap[e]){let{frameNumber:i,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,i);let{frameNumber:o,viewport:{id:a}}=r;this.pendingTilesRegister.register(a,o),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}};var gT=class extends Ku{_tileManager;constructor(e){super(e),this._tileManager=new mT}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,r){return e._lodJudge=dG(e,r),e._lodJudge==="DIG"}updateChildTiles(e,r){let i=e.header.children||[],n=e.children,o=e.tileset;for(let a of i){let c=`${a.id}-${r.viewport.id}`,h=n&&n.find(p=>p.id===c);if(h)h&&this.updateTile(h,r);else{let p=()=>this._loadTile(a.id,o);this._tileManager.find(c)?this._tileManager.update(c,r):(o.tileset.nodePages&&(p=()=>o.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(p,c,T=>this._onTileLoad(T,e,c),r))}}return!1}async _loadTile(e,r){let{loader:i}=r,n=r.getTileUrl(`${r.url}/nodes/${e}`),o={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await ys(n,i,o)}_onTileLoad(e,r,i){let n=new BA(r.tileset,e,r,i);r.children.push(n);let o=this._tileManager.find(n.id).frameState;this.updateTile(n,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,o)}};var QAe={description:"",ellipsoid:Li.WGS84,modelMatrix:new wr,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},_T="Tiles In Tileset(s)",t5="Tiles In Memory",mG="Tiles In View",gG="Tiles To Render",_G="Tiles Loaded",r5="Tiles Loading",yG="Tiles Unloaded",xG="Failed Tile Loads",bG="Points/Vertices",i5="Tile Memory Use",vG="Maximum Screen Space Error",Xx=class{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new uT;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,r){this.options={...QAe,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||tl.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new od({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Gs({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let i=e;return this.queryParams.length&&(i=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;let r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;let i=[];for(let n of r){let o=n.id;this._needTraverse(o)?i.push(o):this.traverseCounter--}for(let n of r){let o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!i.includes(o))continue;let a=Yj(n,this._frameNumber);this._traverser.traverse(this.roots[o],a,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){let r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});let i=this.frameStateData[r],n=Object.values(this._traverser.selectedTiles),[o,a]=Kj(n,e,this.options.maximumTilesSelected);i.selectedTiles=o;for(let c of a)c.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(let e in this.frameStateData){let r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(let e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;let i=new Set(e.map(a=>a.id)),n=new Set(r.map(a=>a.id)),o=e.filter(a=>!n.has(a.id)).length>0;return o=o||r.filter(a=>!i.has(a.id)).length>0,o}_loadTiles(){for(let e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(let i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(mG).count=this.selectedTiles.length,this.stats.get(gG).count=e,this.stats.get(bG).count=r,this.stats.get(vG).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===Ts.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Ts.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Ts.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){let e=this.tileset.fullExtent;if(e){let{xmin:i,xmax:n,ymin:o,ymax:a,zmin:c,zmax:h}=e;this.cartographicCenter=new ot(i+(n-i)/2,o+(a-o)/2,c+(h-c)/2),this.cartesianCenter=new ot,Li.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=YP(e,this.cartographicCenter,this.cartesianCenter);return}let r=this.tileset.store?.extent;if(r){let[i,n,o,a]=r;this.cartographicCenter=new ot(i+(o-i)/2,n+(a-n)/2,0),this.cartesianCenter=new ot,Li.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Jj(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new ot,this.zoom=1}calculateViewPropsTiles3D(){let e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new ot,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new ot,Li.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new ot(0,0,-Li.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=Qj(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(_T),this.stats.get(r5),this.stats.get(t5),this.stats.get(mG),this.stats.get(gG),this.stats.get(_G),this.stats.get(yG),this.stats.get(xG),this.stats.get(bG),this.stats.get(i5,"memory"),this.stats.get(vG)}_initializeTileHeaders(e,r){let i=new BA(this,e.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===Ts.TILES3D){let n=[];for(n.push(i);n.length>0;){let o=n.pop();this.stats.get(_T).incrementCount();let a=o.header.children||[];for(let c of a){let h=new BA(this,c,o);if(h.contentUrl?.includes("?session=")){let x=new URL(h.contentUrl).searchParams.get("session");x&&(this._queryParams.session=x)}o.children.push(h),h.depth=o.depth+1,n.push(h)}}}return i}_initializeTraverser(){let e;switch(this.type){case Ts.TILES3D:e=pT;break;case Ts.I3S:e=gT;break;default:e=Ku}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(xG).incrementCount();let i=r.message||r.toString(),n=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,n)}_onTileLoad(e,r){if(r){if(this.type===Ts.I3S){let i=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(_T).reset(),this.stats.get(_T).addCount(i)}e&&e.content&&qj(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Ts.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break;default:}else if(this.type===Ts.TILES3D){let{extensionsRemoved:r=[]}=e.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(r5).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(r5).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(_G).incrementCount(),this.stats.get(t5).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(i5).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(t5).decrementCount(),this.stats.get(yG).incrementCount(),this.stats.get(i5).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){let e=[];for(this.root&&e.push(this.root);e.length>0;){let r=e.pop();for(let i of r.children)e.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(e){let r=e,i=[];for(i.push(r);i.length>0;){e=i.pop();for(let n of e.children)i.push(n);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){let r=new URLSearchParams(e.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}};var yT="4.3.2";var LA={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},$Xe=Object.keys(LA);function n5(t,e,r){Si(t instanceof ArrayBuffer);let i=new TextDecoder("utf8"),n=new Uint8Array(t,e,r);return i.decode(n)}function wG(t,e=0){let r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}var JAe={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Do={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},xi={...JAe,...Do};var o5={[Do.DOUBLE]:Float64Array,[Do.FLOAT]:Float32Array,[Do.UNSIGNED_SHORT]:Uint16Array,[Do.UNSIGNED_INT]:Uint32Array,[Do.UNSIGNED_BYTE]:Uint8Array,[Do.BYTE]:Int8Array,[Do.SHORT]:Int16Array,[Do.INT]:Int32Array},e0e={DOUBLE:Do.DOUBLE,FLOAT:Do.FLOAT,UNSIGNED_SHORT:Do.UNSIGNED_SHORT,UNSIGNED_INT:Do.UNSIGNED_INT,UNSIGNED_BYTE:Do.UNSIGNED_BYTE,BYTE:Do.BYTE,SHORT:Do.SHORT,INT:Do.INT},s5="Failed to convert GL type",Uc=class t{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(let r in o5)if(o5[r]===e)return r;throw new Error(s5)}static fromName(e){let r=e0e[e];if(!r)throw new Error(s5);return r}static getArrayType(e){switch(e){case Do.UNSIGNED_SHORT_5_6_5:case Do.UNSIGNED_SHORT_4_4_4_4:case Do.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:let r=o5[e];if(!r)throw new Error(s5);return r}}static getByteSize(e){return t.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!t.getArrayType(e)}static createTypedArray(e,r,i=0,n){n===void 0&&(n=(r.byteLength-i)/t.getByteSize(e));let o=t.getArrayType(e);return new o(r,i,n)}};function TG(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function a5(t,e=[0,0,0]){let r=t>>11&31,i=t>>5&63,n=t&31;return e[0]=r<<3,e[1]=i<<2,e[2]=n<<3,e}var iYe=1/256;var nYe=new Zp,oYe=new ot,sYe=new Zp,aYe=new Zp,lYe=new Uint8Array(1);function EG(t,e=255){return xs(t,0,e)/e*2-1}function CG(t){return t<0?-1:1}function SG(t,e,r,i){if(TG(i),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=EG(t,r),i.y=EG(e,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){let n=i.x;i.x=(1-Math.abs(i.y))*CG(n),i.y=(1-Math.abs(n))*CG(i.y)}return i.normalize()}function l5(t,e,r){return SG(t,e,255,r)}var rf=class{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,r){this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=xi.UNSIGNED_INT,i=1){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,r,i,1,n.byteOffset):n}getPropertyArray(e,r,i){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(r=Uc.fromName(n.componentType)),this._getTypedArrayFromBinary(e,r,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,r,n)}getProperty(e,r,i,n,o){let a=this.json[e];if(!a)return a;let c=this.getPropertyArray(e,r,i);if(i===1)return c[n];for(let h=0;h<i;++h)o[h]=c[i*n+h];return o}_getTypedArrayFromBinary(e,r,i,n,o){let a=this._cachedTypedArrays,c=a[e];return c||(c=Uc.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+o,n*i),a[e]=c),c}_getTypedArrayFromArray(e,r,i){let n=this._cachedTypedArrays,o=n[e];return o||(o=Uc.createTypedArray(r,i),n[e]=o),o}};var t0e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},r0e={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},i0e={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function IG(t,e,r,i){let{componentType:n}=t;Si(t.componentType);let o=typeof n=="string"?Uc.fromName(n):n,a=t0e[t.type],c=r0e[t.type],h=i0e[t.type];return r+=t.byteOffset,{values:Uc.createTypedArray(o,e,r,a*i),type:o,size:a,unpacker:c,packer:h}}var Qu=t=>t!==void 0;function MG(t,e,r){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy"),n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?n0e(i,r):null}function n0e(t,e){let r,i,n,o=t.instancesLength,a=t.classes,c=t.classIds,h=t.parentCounts,p=t.parentIds,x=o;Qu(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,n=getBinaryAccessor(c),c=n.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,o));let T;if(Qu(h))for(Qu(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,n=getBinaryAccessor(h),h=n.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,o)),T=new Uint16Array(o),x=0,r=0;r<o;++r)T[r]=x,x+=h[r];Qu(p)&&Qu(p.byteOffset)&&(p.componentType=defaultValue(p.componentType,GL.UNSIGNED_SHORT),p.type=AttributeType.SCALAR,n=getBinaryAccessor(p),p=n.createArrayBufferView(e.buffer,e.byteOffset+p.byteOffset,x));let R=a.length;for(r=0;r<R;++r){let Z=a[r].length,re=a[r].instances,ee=getBinaryProperties(Z,re,e);a[r].instances=combine(ee,re)}let k=new Array(R).fill(0),j=new Uint16Array(o);for(r=0;r<o;++r)i=c[r],j[r]=k[i],++k[i];let q={classes:a,classIds:c,classIndexes:j,parentCounts:h,parentIndexes:T,parentIds:p};return a0e(q),q}function fg(t,e,r){if(!t)return;let i=t.parentCounts;return t.parentIds?r(t,e):i>0?o0e(t,e,r):s0e(t,e,r)}function o0e(t,e,r){let i=t.classIds,n=t.parentCounts,o=t.parentIds,a=t.parentIndexes,c=i.length,h=scratchVisited;h.length=Math.max(h.length,c);let p=++marker,x=scratchStack;for(x.length=0,x.push(e);x.length>0;){if(e=x.pop(),h[e]===p)continue;h[e]=p;let T=r(t,e);if(Qu(T))return T;let R=n[e],k=a[e];for(let j=0;j<R;++j){let q=o[k+j];q!==e&&x.push(q)}}return null}function s0e(t,e,r){let i=!0;for(;i;){let n=r(t,e);if(Qu(n))return n;let o=t.parentIds[e];i=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function a0e(t){let e=[],i=t.classIds.length;for(let n=0;n<i;++n)PG(t,n,stack)}function PG(t,e,r){let i=t.parentCounts,n=t.parentIds,o=t.parentIndexes,c=t.classIds.length;if(!Qu(n))return;assert(e<c,`Parent index ${e} exceeds the total number of instances: ${c}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);let h=Qu(i)?i[e]:1,p=Qu(i)?o[e]:e;for(let x=0;x<h;++x){let T=n[p+x];T!==e&&PG(t,T,r)}r.pop(e)}function Oa(t){return t!=null}var xT=(t,e)=>t,l0e={HIERARCHY:!0,extensions:!0,extras:!0},OA=class{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,r,i,n={}){Si(i>=0),this.json=e||{},this.binary=r,this.featureCount=i,this._extensions=this.json?.extensions||{},this._properties={};for(let o in this.json)l0e[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=MG(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),Si(typeof r=="string",r),this._hierarchy){let i=fg(this._hierarchy,e,(n,o)=>{let a=n.classIds[o];return n.classes[a].name===r});return Oa(i)}return!1}isExactClass(e,r){return Si(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){let r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),Si(typeof r=="string",r),Oa(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=Oa(r)?r:[],r.length=0;let i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),Si(typeof r=="string",r),this._binaryProperties){let n=this._binaryProperties[r];if(Oa(n))return this._getBinaryProperty(n,e)}let i=this._properties[r];if(Oa(i))return xT(i[e],!0);if(this._hierarchy){let n=this._getHierarchyProperty(e,r);if(Oa(n))return n}}setProperty(e,r,i){let n=this.featureCount;if(this._checkBatchId(e),Si(typeof r=="string",r),this._binaryProperties){let a=this._binaryProperties[r];if(a){this._setBinaryProperty(a,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,i))return;let o=this._properties[r];Oa(o)||(this._properties[r]=new Array(n),o=this._properties[r]),o[e]=xT(i,!0)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,i){e.pack(i,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(let r in this._properties){let i=this._properties[r],n=this._initializeBinaryProperty(r,i);n&&(e=e||{},e[r]=n)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){let i=r;Si(this.binary,`Property ${e} requires a batch table binary.`),Si(i.type,`Property ${e} requires a type.`);let n=IG(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;let i=fg(this._hierarchy,e,(n,o)=>{let a=n.classIds[o],c=n.classes[a].instances;return Oa(c[r])});return Oa(i)}_getPropertyNamesInHierarchy(e,r){fg(this._hierarchy,e,(i,n)=>{let o=i.classIds[n],a=i.classes[o].instances;for(let c in a)a.hasOwnProperty(c)&&r.indexOf(c)===-1&&r.push(c)})}_getHierarchyProperty(e,r){return fg(this._hierarchy,e,(i,n)=>{let o=i.classIds[n],a=i.classes[o],c=i.classIndexes[n],h=a.instances[r];return Oa(h)?Oa(h.typedArray)?this._getBinaryProperty(h,c):xT(h[c],!0):null})}_setHierarchyProperty(e,r,i,n){let o=fg(this._hierarchy,r,(a,c)=>{let h=a.classIds[c],p=a.classes[h],x=a.classIndexes[c],T=p.instances[i];return Oa(T)?(Si(c===r,`Inherited property "${i}" is read-only.`),Oa(T.typedArray)?this._setBinaryProperty(T,x,n):T[x]=xT(n,!0),!0):!1});return Oa(o)}};function Ud(t,e,r=0){let i=new DataView(e);if(t.magic=i.getUint32(r,!0),r+=4,t.version=i.getUint32(r,!0),r+=4,t.byteLength=i.getUint32(r,!0),r+=4,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}var dg=4,RG="b3dm tile in legacy format.";function pg(t,e,r){let i=new DataView(e),n;t.header=t.header||{};let o=i.getUint32(r,!0);r+=dg;let a=i.getUint32(r,!0);r+=dg;let c=i.getUint32(r,!0);r+=dg;let h=i.getUint32(r,!0);return r+=dg,c>=570425344?(r-=dg*2,n=o,c=a,h=0,o=0,a=0,console.warn(RG)):h>=570425344&&(r-=dg,n=c,c=o,h=a,o=0,a=0,console.warn(RG)),t.header.featureTableJsonByteLength=o,t.header.featureTableBinaryByteLength=a,t.header.batchTableJsonByteLength=c,t.header.batchTableBinaryByteLength=h,t.header.batchLength=n,r}function Ag(t,e,r,i){return r=c0e(t,e,r,i),r=u0e(t,e,r,i),r}function c0e(t,e,r,i){let{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:a}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:a||0},n&&n>0){let c=n5(e,r,n);t.featureTableJson=JSON.parse(c)}return r+=n||0,t.featureTableBinary=new Uint8Array(e,r,o),r+=o||0,r}function u0e(t,e,r,i){let{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=t.header||{};if(n&&n>0){let a=n5(e,r,n);t.batchTableJson=JSON.parse(a),r+=n,o&&o>0&&(t.batchTableBinary=new Uint8Array(e,r,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=o)}return r}function c5(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;let{batchIds:i,isRGB565:n,pointCount:o=0}=t;if(i&&r){let a=new Uint8ClampedArray(o*3);for(let c=0;c<o;c++){let h=i[c],x=r.getProperty(h,"dimensions").map(T=>T*255);a[c*3]=x[0],a[c*3+1]=x[1],a[c*3+2]=x[2]}return{type:xi.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(e&&n){let a=new Uint8ClampedArray(o*3);for(let c=0;c<o;c++){let h=a5(e[c]);a[c*3]=h[0],a[c*3+1]=h[1],a[c*3+2]=h[2]}return{type:xi.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===o*3?{type:xi.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:xi.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}var BG=new ot;function LG(t,e){if(!e)return null;if(t.isOctEncoded16P){let r=new Float32Array((t.pointsLength||0)*3);for(let i=0;i<(t.pointsLength||0);i++)l5(e[i*2],e[i*2+1],BG),BG.toArray(r,i*3);return{type:xi.FLOAT,size:2,value:r}}return{type:xi.FLOAT,size:2,value:e}}function OG(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,h0e(t,e)):{type:xi.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function h0e(t,e){let r=new ot,i=new Float32Array(t.pointCount*3);for(let n=0;n<t.pointCount;n++)r.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,n*3);return i}async function DG(t,e,r,i,n){r=Ud(t,e,r),r=pg(t,e,r),r=Ag(t,e,r,i),f0e(t);let{featureTable:o,batchTable:a}=d0e(t);return await _0e(t,o,a,i,n),p0e(t,o,i),A0e(t,o,a),m0e(t,o),r}function f0e(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function d0e(t){let e=new rf(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",xi.FLOAT,3);let i=g0e(t,e);return{featureTable:e,batchTable:i}}function p0e(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",xi.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){let i=e.getPropertyArray("POSITION_QUANTIZED",xi.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",xi.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",xi.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=OG(t,i,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function A0e(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",xi.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",xi.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",xi.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=c5(t,i,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",xi.UNSIGNED_BYTE,4))}function m0e(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",xi.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",xi.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=LG(t,r)}}function g0e(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",xi.UNSIGNED_SHORT,1),t.batchIds)){let i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");let{batchTableJson:n,batchTableBinary:o}=t;r=new OA(n,o,i)}return r}async function _0e(t,e,r,i,n){let o,a,c,h=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(c=h.properties);let p=e.getExtension("3DTILES_draco_point_compression");if(p){a=p.properties;let T=p.byteOffset,R=p.byteLength;if(!a||!Number.isFinite(T)||!R)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=(t.featureTableBinary||[]).slice(T,T+R),t.hasPositions=Number.isFinite(a.POSITION),t.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),t.hasNormals=Number.isFinite(a.NORMAL),t.hasBatchIds=Number.isFinite(a.BATCH_ID),t.isTranslucent=Number.isFinite(a.RGBA)}if(!o)return!0;let x={buffer:o,properties:{...a,...c},featureTableProperties:a,batchTableProperties:c,dequantizeInShader:!1};return await y0e(t,x,i,n)}async function y0e(t,e,r,i){if(!i)return;let n={...r,draco:{...r?.draco,extraAttributes:e.batchTableProperties||{}}};delete n["3d-tiles"];let o=await el(e.buffer,rT,n,i),a=o.attributes.POSITION&&o.attributes.POSITION.value,c=o.attributes.COLOR_0&&o.attributes.COLOR_0.value,h=o.attributes.NORMAL&&o.attributes.NORMAL.value,p=o.attributes.BATCH_ID&&o.attributes.BATCH_ID.value,x=a&&o.attributes.POSITION.value.quantization,T=h&&o.attributes.NORMAL.value.quantization;if(x){let k=o.POSITION.data.quantization,j=k.range;t.quantizedVolumeScale=new ot(j,j,j),t.quantizedVolumeOffset=new ot(k.minValues),t.quantizedRange=(1<<k.quantizationBits)-1,t.isQuantizedDraco=!0}T&&(t.octEncodedRange=(1<<o.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);let R={};if(e.batchTableProperties)for(let k of Object.keys(e.batchTableProperties))o.attributes[k]&&o.attributes[k].value&&(R[k.toLowerCase()]=o.attributes[k].value);t.attributes={positions:a,colors:c5(t,c,void 0),normals:h,batchIds:p,...R}}var bT={URI:0,EMBEDDED:1};function vT(t,e,r,i){t.rotateYtoZ=!0;let n=(t.byteOffset||0)+(t.byteLength||0)-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Bp(e,r,n),t.gltfByteOffset=0,t.gltfByteLength=n,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function wT(t,e,r,i){let n=r?.["3d-tiles"]||{};if(x0e(t,e,r),n.loadGLTF){if(!i)return;if(t.gltfUrl){let{fetch:o}=i,a=await o(t.gltfUrl,r);t.gltfArrayBuffer=await a.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){let o=await el(t.gltfArrayBuffer,Jh,r,i);t.gltf=PA(o),t.gpuMemoryUsageInBytes=Ux(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function x0e(t,e,r){switch(e){case bT.URI:if(t.gltfArrayBuffer){let i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),o=new TextDecoder().decode(i);t.gltfUrl=o.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case bT.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function FG(t,e,r,i,n){r=b0e(t,e,r,i,n),await wT(t,bT.EMBEDDED,i,n);let o=t?.gltf?.extensions;return o&&o.CESIUM_RTC&&(t.rtcCenter=o.CESIUM_RTC.center),r}function b0e(t,e,r,i,n){r=Ud(t,e,r),r=pg(t,e,r),r=Ag(t,e,r,i),r=vT(t,e,r,i);let o=new rf(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=o.getGlobalProperty("RTC_CENTER",xi.FLOAT,3),r}async function kG(t,e,r,i,n){return r=v0e(t,e,r,i,n),await wT(t,t.gltfFormat||0,i,n),r}function v0e(t,e,r,i,n){if(r=Ud(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=pg(t,e,r);let o=new DataView(e);if(t.gltfFormat=o.getUint32(r,!0),r+=4,r=Ag(t,e,r,i),r=vT(t,e,r,i),!t?.header?.featureTableJsonByteLength||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");let a=new rf(t.featureTableJson,t.featureTableBinary),c=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=a.getGlobalProperty("RTC_CENTER",xi.FLOAT,3);let h=new OA(t.batchTableJson,t.batchTableBinary,c);return w0e(t,a,h,c),r}function w0e(t,e,r,i){let n=new Array(i),o=new ot,a=new ot,c=new ot,h=new ot,p=new an,x=new Rl,T=new ot,R={},k=new wr,j=[],q=[],Z=[],re=[];for(let ee=0;ee<i;ee++){let se;if(e.hasProperty("POSITION"))se=e.getProperty("POSITION",xi.FLOAT,3,ee,o);else if(e.hasProperty("POSITION_QUANTIZED")){se=e.getProperty("POSITION_QUANTIZED",xi.UNSIGNED_SHORT,3,ee,o);let X=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",xi.FLOAT,3);if(!X)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let ye=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",xi.FLOAT,3);if(!ye)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let _e=65535;for(let Oe=0;Oe<3;Oe++)se[Oe]=se[Oe]/_e*ye[Oe]+X[Oe]}if(!se)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");o.copy(se),R.translation=o,t.normalUp=e.getProperty("NORMAL_UP",xi.FLOAT,3,ee,j),t.normalRight=e.getProperty("NORMAL_RIGHT",xi.FLOAT,3,ee,q);let me=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",xi.UNSIGNED_SHORT,2,ee,j),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",xi.UNSIGNED_SHORT,2,ee,q),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(Li.WGS84.eastNorthUpToFixedFrame(o,k),k.getRotationMatrix3(p)):p.identity()}me&&(h.copy(a).cross(c).normalize(),p.setColumn(0,a),p.setColumn(1,c),p.setColumn(2,h)),x.fromMatrix3(p),R.rotation=x,T.set(1,1,1);let Le=e.getProperty("SCALE",xi.FLOAT,1,ee,Z);Number.isFinite(Le)&&T.multiplyByScalar(Le);let je=e.getProperty("SCALE_NON_UNIFORM",xi.FLOAT,3,ee,j);je&&T.scale(je),R.scale=T;let Je=e.getProperty("BATCH_ID",xi.UNSIGNED_SHORT,1,ee,re);Je===void 0&&(Je=ee);let J=new wr().fromQuaternion(R.rotation);k.identity(),k.translate(R.translation),k.multiplyRight(J),k.scale(R.scale);let te=k.clone();n[ee]={modelMatrix:te,batchId:Je}}t.instances=n}async function NG(t,e,r,i,n,o){r=Ud(t,e,r);let a=new DataView(e);for(t.tilesLength=a.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){let c={shape:"tile3d"};t.tiles.push(c),r=await o(e,r,i,n,c)}return r}async function zG(t,e,r,i){if(t.rotateYtoZ=!0,t.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!i)return e.byteLength;let n=await el(e,Jh,r,i);t.gltf=PA(n),t.gpuMemoryUsageInBytes=Ux(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function u5(t,e=0,r,i,n={shape:"tile3d"}){switch(n.byteOffset=e,n.type=wG(t,e),n.type){case LA.COMPOSITE:return await NG(n,t,e,r,i,u5);case LA.BATCHED_3D_MODEL:return await FG(n,t,e,r,i);case LA.GLTF:return await zG(n,t,r,i);case LA.INSTANCED_3D_MODEL:return await kG(n,t,e,r,i);case LA.POINT_CLOUD:return await DG(n,t,e,r,i);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}async function h5(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==1952609651)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==1)throw new Error("Wrong subtree file verson, must be 1");let o=UG(t.slice(8,16)),a=new Uint8Array(t,24,o),h=new TextDecoder("utf8").decode(a),p=JSON.parse(h),x=UG(t.slice(16,24)),T=new ArrayBuffer(0);if(x&&(T=t.slice(24+o)),await TT(p,p.tileAvailability,T,r),Array.isArray(p.contentAvailability))for(let R of p.contentAvailability)await TT(p,R,T,r);else await TT(p,p.contentAvailability,T,r);return await TT(p,p.childSubtreeAvailability,T,r),p}async function TT(t,e,r,i){let n=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof n!="number")return;let o=t.bufferViews[n],a=t.buffers[o.buffer];if(!i?.baseUrl)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(a.uri){let h=`${i?.baseUrl||""}/${a.uri}`,x=await(await i.fetch(h)).arrayBuffer();e.explicitBitstream=new Uint8Array(x,o.byteOffset,o.byteLength);return}let c=t.buffers.slice(0,o.buffer).reduce((h,p)=>h+p.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(c,c+a.byteLength),o.byteOffset,o.byteLength)}function UG(t){let e=new DataView(t),r=e.getUint32(0,!0),i=e.getUint32(4,!0);return r+2**32*i}var ET={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:yT,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:h5,options:{}};var zl=null;try{zl=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function In(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}In.prototype.__isLong__;Object.defineProperty(In.prototype,"__isLong__",{value:!0});function Ks(t){return(t&&t.__isLong__)===!0}function VG(t){var e=Math.clz32(t&-t);return t?31-e:e}In.isLong=Ks;var jG={},GG={};function DA(t,e){var r,i,n;return e?(t>>>=0,(n=0<=t&&t<256)&&(i=GG[t],i)?i:(r=Ki(t,0,!0),n&&(GG[t]=r),r)):(t|=0,(n=-128<=t&&t<128)&&(i=jG[t],i)?i:(r=Ki(t,t<0?-1:0,!1),n&&(jG[t]=r),r))}In.fromInt=DA;function Ul(t,e){if(isNaN(t))return e?nf:Vc;if(e){if(t<0)return nf;if(t>=qG)return YG}else{if(t<=-WG)return Da;if(t+1>=WG)return XG}return t<0?Ul(-t,e).neg():Ki(t%gg|0,t/gg|0,e)}In.fromNumber=Ul;function Ki(t,e,r){return new In(t,e,r)}In.fromBits=Ki;var CT=Math.pow;function d5(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?nf:Vc;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return d5(t.substring(1),e,r).neg();for(var n=Ul(CT(r,8)),o=Vc,a=0;a<t.length;a+=8){var c=Math.min(8,t.length-a),h=parseInt(t.substring(a,a+c),r);if(c<8){var p=Ul(CT(r,c));o=o.mul(p).add(Ul(h))}else o=o.mul(n),o=o.add(Ul(h))}return o.unsigned=e,o}In.fromString=d5;function Vl(t,e){return typeof t=="number"?Ul(t,e):typeof t=="string"?d5(t,e):Ki(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}In.fromValue=Vl;var HG=65536,T0e=1<<24,gg=HG*HG,qG=gg*gg,WG=qG/2,$G=DA(T0e),Vc=DA(0);In.ZERO=Vc;var nf=DA(0,!0);In.UZERO=nf;var mg=DA(1);In.ONE=mg;var ZG=DA(1,!0);In.UONE=ZG;var f5=DA(-1);In.NEG_ONE=f5;var XG=Ki(-1,2147483647,!1);In.MAX_VALUE=XG;var YG=Ki(-1,-1,!0);In.MAX_UNSIGNED_VALUE=YG;var Da=Ki(0,-2147483648,!1);In.MIN_VALUE=Da;var ir=In.prototype;ir.toInt=function(){return this.unsigned?this.low>>>0:this.low};ir.toNumber=function(){return this.unsigned?(this.high>>>0)*gg+(this.low>>>0):this.high*gg+(this.low>>>0)};ir.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Da)){var r=Ul(e),i=this.div(r),n=i.mul(r).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Ul(CT(e,6),this.unsigned),a=this,c="";;){var h=a.div(o),p=a.sub(h.mul(o)).toInt()>>>0,x=p.toString(e);if(a=h,a.isZero())return x+c;for(;x.length<6;)x="0"+x;c=""+x+c}};ir.getHighBits=function(){return this.high};ir.getHighBitsUnsigned=function(){return this.high>>>0};ir.getLowBits=function(){return this.low};ir.getLowBitsUnsigned=function(){return this.low>>>0};ir.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Da)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;r>0&&!(e&1<<r);r--);return this.high!=0?r+33:r+1};ir.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};ir.isZero=function(){return this.high===0&&this.low===0};ir.eqz=ir.isZero;ir.isNegative=function(){return!this.unsigned&&this.high<0};ir.isPositive=function(){return this.unsigned||this.high>=0};ir.isOdd=function(){return(this.low&1)===1};ir.isEven=function(){return(this.low&1)===0};ir.equals=function(e){return Ks(e)||(e=Vl(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ir.eq=ir.equals;ir.notEquals=function(e){return!this.eq(e)};ir.neq=ir.notEquals;ir.ne=ir.notEquals;ir.lessThan=function(e){return this.comp(e)<0};ir.lt=ir.lessThan;ir.lessThanOrEqual=function(e){return this.comp(e)<=0};ir.lte=ir.lessThanOrEqual;ir.le=ir.lessThanOrEqual;ir.greaterThan=function(e){return this.comp(e)>0};ir.gt=ir.greaterThan;ir.greaterThanOrEqual=function(e){return this.comp(e)>=0};ir.gte=ir.greaterThanOrEqual;ir.ge=ir.greaterThanOrEqual;ir.compare=function(e){if(Ks(e)||(e=Vl(e)),this.eq(e))return 0;var r=this.isNegative(),i=e.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ir.comp=ir.compare;ir.negate=function(){return!this.unsigned&&this.eq(Da)?Da:this.not().add(mg)};ir.neg=ir.negate;ir.add=function(e){Ks(e)||(e=Vl(e));var r=this.high>>>16,i=this.high&65535,n=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,h=e.low>>>16,p=e.low&65535,x=0,T=0,R=0,k=0;return k+=o+p,R+=k>>>16,k&=65535,R+=n+h,T+=R>>>16,R&=65535,T+=i+c,x+=T>>>16,T&=65535,x+=r+a,x&=65535,Ki(R<<16|k,x<<16|T,this.unsigned)};ir.subtract=function(e){return Ks(e)||(e=Vl(e)),this.add(e.neg())};ir.sub=ir.subtract;ir.multiply=function(e){if(this.isZero())return this;if(Ks(e)||(e=Vl(e)),zl){var r=zl.mul(this.low,this.high,e.low,e.high);return Ki(r,zl.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?nf:Vc;if(this.eq(Da))return e.isOdd()?Da:Vc;if(e.eq(Da))return this.isOdd()?Da:Vc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt($G)&&e.lt($G))return Ul(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,o=this.low>>>16,a=this.low&65535,c=e.high>>>16,h=e.high&65535,p=e.low>>>16,x=e.low&65535,T=0,R=0,k=0,j=0;return j+=a*x,k+=j>>>16,j&=65535,k+=o*x,R+=k>>>16,k&=65535,k+=a*p,R+=k>>>16,k&=65535,R+=n*x,T+=R>>>16,R&=65535,R+=o*p,T+=R>>>16,R&=65535,R+=a*h,T+=R>>>16,R&=65535,T+=i*x+n*p+o*h+a*c,T&=65535,Ki(k<<16|j,T<<16|R,this.unsigned)};ir.mul=ir.multiply;ir.divide=function(e){if(Ks(e)||(e=Vl(e)),e.isZero())throw Error("division by zero");if(zl){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?zl.div_u:zl.div_s)(this.low,this.high,e.low,e.high);return Ki(r,zl.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?nf:Vc;var i,n,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return nf;if(e.gt(this.shru(1)))return ZG;o=nf}else{if(this.eq(Da)){if(e.eq(mg)||e.eq(f5))return Da;if(e.eq(Da))return mg;var a=this.shr(1);return i=a.div(e).shl(1),i.eq(Vc)?e.isNegative()?mg:f5:(n=this.sub(e.mul(i)),o=i.add(n.div(e)),o)}else if(e.eq(Da))return this.unsigned?nf:Vc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Vc}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(i)/Math.LN2),h=c<=48?1:CT(2,c-48),p=Ul(i),x=p.mul(e);x.isNegative()||x.gt(n);)i-=h,p=Ul(i,this.unsigned),x=p.mul(e);p.isZero()&&(p=mg),o=o.add(p),n=n.sub(x)}return o};ir.div=ir.divide;ir.modulo=function(e){if(Ks(e)||(e=Vl(e)),zl){var r=(this.unsigned?zl.rem_u:zl.rem_s)(this.low,this.high,e.low,e.high);return Ki(r,zl.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ir.mod=ir.modulo;ir.rem=ir.modulo;ir.not=function(){return Ki(~this.low,~this.high,this.unsigned)};ir.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};ir.clz=ir.countLeadingZeros;ir.countTrailingZeros=function(){return this.low?VG(this.low):VG(this.high)+32};ir.ctz=ir.countTrailingZeros;ir.and=function(e){return Ks(e)||(e=Vl(e)),Ki(this.low&e.low,this.high&e.high,this.unsigned)};ir.or=function(e){return Ks(e)||(e=Vl(e)),Ki(this.low|e.low,this.high|e.high,this.unsigned)};ir.xor=function(e){return Ks(e)||(e=Vl(e)),Ki(this.low^e.low,this.high^e.high,this.unsigned)};ir.shiftLeft=function(e){return Ks(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ki(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ki(0,this.low<<e-32,this.unsigned)};ir.shl=ir.shiftLeft;ir.shiftRight=function(e){return Ks(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ki(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ki(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ir.shr=ir.shiftRight;ir.shiftRightUnsigned=function(e){return Ks(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ki(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Ki(this.high,0,this.unsigned):Ki(this.high>>>e-32,0,this.unsigned)};ir.shru=ir.shiftRightUnsigned;ir.shr_u=ir.shiftRightUnsigned;ir.rotateLeft=function(e){var r;return Ks(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ki(this.high,this.low,this.unsigned):e<32?(r=32-e,Ki(this.low<<e|this.high>>>r,this.high<<e|this.low>>>r,this.unsigned)):(e-=32,r=32-e,Ki(this.high<<e|this.low>>>r,this.low<<e|this.high>>>r,this.unsigned))};ir.rotl=ir.rotateLeft;ir.rotateRight=function(e){var r;return Ks(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ki(this.high,this.low,this.unsigned):e<32?(r=32-e,Ki(this.high<<r|this.low>>>e,this.low<<r|this.high>>>e,this.unsigned)):(e-=32,r=32-e,Ki(this.low<<r|this.high>>>e,this.high<<r|this.low>>>e,this.unsigned))};ir.rotr=ir.rotateRight;ir.toSigned=function(){return this.unsigned?Ki(this.low,this.high,!1):this};ir.toUnsigned=function(){return this.unsigned?this:Ki(this.low,this.high,!0)};ir.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ir.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ir.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};In.fromBytes=function(e,r,i){return i?In.fromBytesLE(e,r):In.fromBytesBE(e,r)};In.fromBytesLE=function(e,r){return new In(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)};In.fromBytesBE=function(e,r){return new In(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};typeof BigInt=="function"&&(In.fromBigInt=function(e,r){var i=Number(BigInt.asIntN(32,e)),n=Number(BigInt.asIntN(32,e>>BigInt(32)));return Ki(i,n,r)},In.fromValue=function(e,r){return typeof e=="bigint"?fromBigInt(e,r):Vl(e,r)},ir.toBigInt=function(){var e=BigInt(this.low>>>0),r=BigInt(this.unsigned?this.high>>>0:this.high);return r<<BigInt(32)|e});var _g=In;var E0e=16;function Yx(t){t==="X"&&(t="");let e=t.padEnd(E0e,"0");return _g.fromString(e,!0,16)}function p5(t){if(t.isZero())return"X";let e=t.countTrailingZeros(),r=e%4;e=(e-r)/4;let i=e;e*=4;let o=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-o.length).join("0")+o}function A5(t,e){let r=C0e(t).shiftRightUnsigned(2);return t.add(_g.fromNumber(2*e+1-4).multiply(r))}function C0e(t){return t.and(t.not().add(1))}var S0e=3,I0e=30,M0e=2*I0e+1,KG=180/Math.PI;function JG(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);let e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length,o=0,a=[0,0];for(let c=n-1;c>=0;c--){o=n-c;let h=i[c],p=0,x=0;h==="1"?x=1:h==="2"?(p=1,x=1):h==="3"&&(p=1);let T=Math.pow(2,o-1);P0e(T,a,p,x),a[0]+=T*p,a[1]+=T*x}if(r%2===1){let c=a[0];a[0]=a[1],a[1]=c}return{face:r,ij:a,level:o}}function eH(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<S0e+M0e;)e="0"+e;let r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),o=n.length/2,a=_g.fromString(i,!0,2).toString(10),c="";if(o!==0)for(c=_g.fromString(n,!0,2).toString(4);c.length<o;)c="0"+c;return`${a}/${c}`}function m5(t,e,r){let i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function QG(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function g5(t){return[QG(t[0]),QG(t[1])]}function _5(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function y5([t,e,r]){let i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*KG,i*KG]}function P0e(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function tH(t){let e=m5(t.ij,t.level,[.5,.5]),r=g5(e),i=_5(t.face,r);return y5(i)}var R0e=100;function x5(t){let{face:e,ij:r,level:i}=t,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(R0e*Math.pow(2,-i))),a=new Float64Array(4*o*2+2),c=0,h=0;for(let p=0;p<4;p++){let x=n[p].slice(0),T=n[p+1],R=(T[0]-x[0])/o,k=(T[1]-x[1])/o;for(let j=0;j<o;j++){x[0]+=R,x[1]+=k;let q=m5(r,i,x),Z=g5(q),re=_5(e,Z),ee=y5(re);Math.abs(ee[1])>89.999&&(ee[0]=h);let se=ee[0]-h;ee[0]+=se>180?-360:se<-180?360:0,a[c++]=ee[0],a[c++]=ee[1],h=ee[0]}}return a[c++]=a[0],a[c++]=a[1],a}function yg(t){let e=B0e(t);return JG(e)}function B0e(t){if(t.indexOf("/")>0)return t;let e=Yx(t);return eH(e)}function b5(t){let e=yg(t);return tH(e)}function iH(t){let e;if(t.face===2||t.face===5){let r=null,i=0;for(let n=0;n<4;n++){let o=`${t.face}/${n}`,a=yg(o),c=x5(a);(typeof r>"u"||r===null)&&(r=new Float64Array(4*c.length)),r.set(c,i),i+=c.length}e=rH(r)}else{let r=x5(t);e=rH(r)}return e}function rH(t){if(t.length%2!==0)throw new Error("Invalid corners");let e=[],r=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),r.push(t[i+1]);return e.sort((i,n)=>i-n),r.sort((i,n)=>i-n),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function v5(t,e){let r=e?.minimumHeight||0,i=e?.maximumHeight||0,n=yg(t),o=iH(n),a=o.west,c=o.south,h=o.east,p=o.north,x=[];return x.push(new ot(a,p,r)),x.push(new ot(h,p,r)),x.push(new ot(h,c,r)),x.push(new ot(a,c,r)),x.push(new ot(a,p,i)),x.push(new ot(h,p,i)),x.push(new ot(h,c,i)),x.push(new ot(a,c,i)),x}function ST(t){let e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=v5(e,r),n=b5(e),o=n[0],a=n[1],c=Li.WGS84.cartographicToCartesian([o,a,r.maximumHeight]),h=new ot(c[0],c[1],c[2]);i.push(h);let p=Px(i);return[...p.center,...p.halfAxes]}var L0e=4,O0e=8,D0e={QUADTREE:L0e,OCTREE:O0e};function F0e(t,e,r){if(t?.box){let i=Yx(t.s2VolumeInfo.token),n=A5(i,e),o=p5(n),a={...t.s2VolumeInfo};switch(a.token=o,r){case"OCTREE":let p=t.s2VolumeInfo,x=p.maximumHeight-p.minimumHeight,T=x/2,R=p.minimumHeight+x/2;p.minimumHeight=R-T,p.maximumHeight=R+T;break;default:break}return{box:ST(a),s2VolumeInfo:a}}}async function T5(t){let{subtree:e,subtreeData:r={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:n=0,implicitOptions:o,loaderOptions:a,s2VolumeBox:c}=t,{subdivisionScheme:h,subtreeLevels:p,maximumLevel:x,contentUrlTemplate:T,subtreesUriTemplate:R,basePath:k}=o,j={children:[],lodMetricValue:0,contentUrl:""};if(!x)return EC.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${T} won't be loaded...`),j;let q=i.localLevel+1,Z=r.level+q;if(Z>x)return j;let re=D0e[h],ee=Math.log2(re),se=n&1,me=n>>1&1,Le=n>>2&1,je=FA(i.localX,se,1),Je=FA(i.localY,me,1),J=FA(i.localZ,Le,1),te=FA(r.x,je,q),X=FA(r.y,Je,q),ye=FA(r.z,J,q),_e=FA(i.mortonIndex,n,ee),Oe=q===p&&w5(e.childSubtreeAvailability,_e),ve,De,Xe,rt;if(Oe){let Xt=`${k}/${R}`,jt=IT(Xt,Z,te,X,ye);ve=await ys(jt,ET,a),rt=0,De={level:Z,x:te,y:X,z:ye},Xe={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else ve=e,rt=(re**q-1)/(re-1)+_e,De=r,Xe={mortonIndex:_e,localLevel:q,localX:je,localY:Je,localZ:J};if(!w5(ve.tileAvailability,rt))return j;w5(ve.contentAvailability,rt)&&(j.contentUrl=IT(T,Z,te,X,ye));for(let Xt=0;Xt<re;Xt++){let jt=F0e(c,Xt,h),fr=await T5({subtree:ve,subtreeData:De,parentData:Xe,childIndex:Xt,implicitOptions:o,loaderOptions:a,s2VolumeBox:jt});(fr.contentUrl||fr.children.length)&&j.children.push(fr)}return j.contentUrl||j.children.length?k0e(j,{level:Z,x:te,y:X,z:ye},o,c):j}function w5(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&EC.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?U0e(e,r.explicitBitstream):!1}function k0e(t,e,r,i){let{basePath:n,refine:o,getRefine:a,lodMetricType:c,getTileType:h,rootLodMetricValue:p,rootBoundingVolume:x}=r,T=t.contentUrl&&t.contentUrl.replace(`${n}/`,""),R=p/2**e.level,k=i?.box?{box:i.box}:x,j=N0e(k,e,r.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:T},id:t.contentUrl,refine:a(o),type:h(t),lodMetricType:c,lodMetricValue:R,geometricError:R,transform:t.transform,boundingVolume:j}}function N0e(t,e,r){if(t.region){let{level:i,x:n,y:o,z:a}=e,[c,h,p,x,T,R]=t.region,k=2**i,j=(p-c)/k,[q,Z]=[c+j*n,c+j*(n+1)],re=(x-h)/k,[ee,se]=[h+re*o,h+re*(o+1)],me,Le;if(r==="OCTREE"){let je=(R-T)/k;[me,Le]=[T+je*a,T+je*(a+1)]}else[me,Le]=[T,R];return{region:[q,ee,Z,se,me,Le]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function FA(t,e,r){return(t<<r)+e}function IT(t,e,r,i,n){let o=z0e({level:e,x:r,y:i,z:n});return t.replace(/{level}|{x}|{y}|{z}/gi,a=>o[a])}function z0e(t){let e={};for(let r in t)e[`{${r}}`]=t[r];return e}function U0e(t,e){let r=Math.floor(t/8),i=t%8;return(e[r]>>i&1)===1}function C5(t,e=""){if(!e)return Nl.EMPTY;let i=e.split("?")[0].split(".").pop();switch(i){case"pnts":return Nl.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Nl.SCENEGRAPH;default:return i||Nl.EMPTY}}function S5(t){switch(t){case"REPLACE":case"replace":return Xs.REPLACE;case"ADD":case"add":return Xs.ADD;default:return t}}function E5(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){let i=new URL(t,`${e}/`);return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return tl.resolve(e,t)}function nH(t,e){if(!t)return null;let r;if(t.content){let n=t.content.uri||t.content?.url;typeof n<"u"&&(r=E5(n,e))}return{...t,id:r,contentUrl:r,lodMetricType:tf.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:C5(t,r),refine:S5(t.refine)}}async function aH(t,e,r){let i=null,n=sH(t.root);n&&t.root?i=await oH(t.root,t,e,n,r):i=nH(t.root,e);let o=[];for(o.push(i);o.length>0;){let a=o.pop()||{},c=a.children||[],h=[];for(let p of c){let x=sH(p),T;x?T=await oH(p,t,e,x,r):T=nH(p,e),T&&(h.push(T),o.push(T))}a.children=h}return i}async function oH(t,e,r,i,n){let{subdivisionScheme:o,maximumLevel:a,availableLevels:c,subtreeLevels:h,subtrees:{uri:p}}=i,x=IT(p,0,0,0,0),T=E5(x,r),R=await ys(T,ET,n),k=t.content?.uri,j=k?E5(k,r):"",q=e?.root?.refine,Z=t.geometricError,re=t.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(re){let Le={box:ST(re),s2VolumeInfo:re};t.boundingVolume=Le}let ee=t.boundingVolume,se={contentUrlTemplate:j,subtreesUriTemplate:p,subdivisionScheme:o,subtreeLevels:h,maximumLevel:Number.isFinite(c)?c-1:a,refine:q,basePath:r,lodMetricType:tf.GEOMETRIC_ERROR,rootLodMetricValue:Z,rootBoundingVolume:ee,getTileType:C5,getRefine:S5};return await V0e(t,r,R,se,n)}async function V0e(t,e,r,i,n){if(!t)return null;let{children:o,contentUrl:a}=await T5({subtree:r,implicitOptions:i,loaderOptions:n}),c,h=null;return a&&(c=a,h={uri:a.replace(`${e}/`,"")}),{...t,id:c,contentUrl:c,lodMetricType:tf.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:C5(t,c),refine:S5(t.refine),content:h||t.content,children:o}}function sH(t){return t?.extensions?.["3DTILES_implicit_tiling"]||t?.implicitTiling}var MT={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:yT,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:j0e,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function j0e(t,e={},r){let i=e["3d-tiles"]||{},n;return i.isTileset==="auto"?n=r?.url&&r.url.indexOf(".json")!==-1:n=i.isTileset,n?G0e(t,e,r):H0e(t,e,r)}async function G0e(t,e,r){let i=JSON.parse(new TextDecoder().decode(t)),n=r?.url||"",o=W0e(n),a=await aH(i,o,e||{});return{...i,shape:"tileset3d",loader:MT,url:n,queryString:r?.queryString||"",basePath:o,root:a||i.root,type:Ts.TILES3D,lodMetricType:tf.GEOMETRIC_ERROR,lodMetricValue:i.root?.geometricError||0}}async function H0e(t,e,r){let i={content:{shape:"tile3d",featureIds:null}};return await u5(t,0,e,r,i.content),i.content}function W0e(t){return tl.dirname(t)}var lH=[0],$0e={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:MT,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}},Kx=class extends so{initializeState(){"onTileLoadFail"in this.props&&cr.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:i}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),i.viewportChanged){let{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(i.propsChanged){let{layerMap:n}=this.state;for(let o in n)n[o].needsUpdate=!0}}activateViewport(e){let{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,r[e.id]=e;let n=i?.[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){let i=r&&r.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:r}){let{tile:i}=e.props,{id:n}=r;return i.selected&&i.viewportIds.includes(n)}_updateAutoHighlight(e){let r=e.sourceTile,i=this.state.layerMap[r?.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){let{loadOptions:r={}}=this.props,i=this.props.loader||this.props.loaders,n=Array.isArray(i)?i[0]:i,o={loadOptions:{...r}},a=e;if(n.preload){let p=await n.preload(e,r);p.url&&(a=p.url),p.headers&&(o.loadOptions.fetch={...o.loadOptions.fetch,headers:p.headers}),Object.assign(o,p)}let c=await ys(a,n,o.loadOptions),h=new Xx(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...o});this.setState({tileset3d:h,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(h)}_onTileLoad(e){let{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;let{tileset3d:r}=this.state,{timeline:i}=this.context,n=Object.keys(e).length;!i||!n||!r||r.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case Nl.POINTCLOUD:return this._makePointCloudLayer(e,r);case Nl.SCENEGRAPH:return this._make3DModelLayer(e);case Nl.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){let{attributes:i,pointCount:n,constantRGBA:o,cartographicOrigin:a,modelMatrix:c}=e.content,{positions:h,normals:p,colors:x}=i;if(!h)return null;let T=r&&r.props.data||{header:{vertexCount:n},attributes:{POSITION:h,NORMAL:p,COLOR_0:x}},{pointSize:R,getPointColor:k}=this.props,j=this.getSubLayerClass("pointcloud",Fw);return new j({pointSize:R},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:T,coordinateSystem:vr.METER_OFFSETS,coordinateOrigin:a,modelMatrix:c,getColor:o||k,_offset:0})}_make3DModelLayer(e){let{gltf:r,instances:i,cartographicOrigin:n,modelMatrix:o}=e.content,a=this.getSubLayerClass("scenegraph",HP);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||lH,scenegraph:r,coordinateSystem:vr.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:c=>c.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){let i=e.content,{attributes:n,indices:o,modelMatrix:a,cartographicOrigin:c,coordinateSystem:h=vr.METER_OFFSETS,material:p,featureIds:x}=i,{_getMeshColor:T}=this.props,R=r&&r.props.mesh||new Qi({topology:"triangle-list",attributes:q0e(n),indices:o}),k=this.getSubLayerClass("mesh",Uj);return new k(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:R,data:lH,getColor:T(e),pbrMaterial:p,modelMatrix:a,coordinateOrigin:c,coordinateSystem:h,featureIds:x,_offset:0})}renderLayers(){let{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(i=>{let n=r[i.id]=r[i.id]||{tile:i},{layer:o}=n;return i.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(i,o),n.needsUpdate=!1):o=this._getSubLayer(i)),n.layer=o,o}).filter(Boolean):null}};Kx.defaultProps=$0e;Kx.layerName="Tile3DLayer";var cH=Kx;function q0e(t){let e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}var Z0e=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function I5(t){return t>>1^-(t&1)}function X0e(t){let e=0,r={};for(let[i,n]of Z0e){let o=n===8?t.getFloat64:t.getFloat32;r[i]=o.call(t,e,!0),e+=n}return{header:r,headerEndPosition:e}}function Y0e(t,e){let r=e,i=3,n=t.getUint32(r,!0),o=new Uint16Array(n*i);r+=Uint32Array.BYTES_PER_ELEMENT;let a=Uint16Array.BYTES_PER_ELEMENT,c=n*a,h=r,p=h+c,x=p+c,T=0,R=0,k=0;for(let j=0;j<n;j++)T+=I5(t.getUint16(h+a*j,!0)),R+=I5(t.getUint16(p+a*j,!0)),k+=I5(t.getUint16(x+a*j,!0)),o[j]=T,o[j+n]=R,o[j+n*2]=k;return r+=c*3,{vertexData:o,vertexDataEndPosition:r}}function Qx(t,e,r,i,n=!0){let o;if(i===2?o=new Uint16Array(t,e,r):o=new Uint32Array(t,e,r),!n)return o;let a=0;for(let c=0;c<o.length;++c){let h=o[c];o[c]=a-h,h===0&&++a}return o}function K0e(t,e,r){let i=r,n=3,a=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%a!==0&&(i+=a-i%a);let c=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let h=c*3,p=Qx(t.buffer,i,h,a);return i+=h*a,{triangleIndicesEndPosition:i,triangleIndices:p}}function Q0e(t,e,r){let i=r,n=3,a=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,c=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let h=Qx(t.buffer,i,c,a,!1);i+=c*a;let p=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let x=Qx(t.buffer,i,p,a,!1);i+=p*a;let T=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let R=Qx(t.buffer,i,T,a,!1);i+=T*a;let k=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let j=Qx(t.buffer,i,k,a,!1);return i+=k*a,{edgeIndicesEndPosition:i,westIndices:h,southIndices:x,eastIndices:R,northIndices:j}}function J0e(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function eme(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function tme(t,e){let r={};if(t.byteLength<=e)return{extensions:r,extensionsEndPosition:e};let i=e;for(;i<t.byteLength;){let n=t.getUint8(i,!0);i+=Uint8Array.BYTES_PER_ELEMENT;let o=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let a=new DataView(t.buffer,i,o);switch(n){case 1:{r.vertexNormals=J0e(a);break}case 2:{r.waterMask=eme(a);break}default:}i+=o}return{extensions:r,extensionsEndPosition:i}}var kA={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},rme={maxDecodingStep:kA.extensions};function M5(t,e){let r=Object.assign({},rme,e),i=new DataView(t),{header:n,headerEndPosition:o}=X0e(i);if(r.maxDecodingStep<kA.vertices)return{header:n};let{vertexData:a,vertexDataEndPosition:c}=Y0e(i,o);if(r.maxDecodingStep<kA.triangleIndices)return{header:n,vertexData:a};let{triangleIndices:h,triangleIndicesEndPosition:p}=K0e(i,a,c);if(r.maxDecodingStep<kA.edgeIndices)return{header:n,vertexData:a,triangleIndices:h};let{westIndices:x,southIndices:T,eastIndices:R,northIndices:k,edgeIndicesEndPosition:j}=Q0e(i,a,p);if(r.maxDecodingStep<kA.extensions)return{header:n,vertexData:a,triangleIndices:h,westIndices:x,northIndices:k,eastIndices:R,southIndices:T};let{extensions:q}=tme(i,j);return{header:n,vertexData:a,triangleIndices:h,westIndices:x,northIndices:k,eastIndices:R,southIndices:T,extensions:q}}function PT(t,e,r,i){let n=i?nme(i,t.POSITION.value):ime(e),o=new t.POSITION.value.constructor(n.length*6),a=new t.TEXCOORD_0.value.constructor(n.length*4),c=new e.constructor(n.length*6);for(let p=0;p<n.length;p++){let x=n[p];ome({edge:x,edgeIndex:p,attributes:t,skirtHeight:r,newPosition:o,newTexcoord0:a,newTriangles:c})}t.POSITION.value=O_(t.POSITION.value,o),t.TEXCOORD_0.value=O_(t.TEXCOORD_0.value,a);let h=e instanceof Array?e.concat(c):O_(e,c);return{attributes:t,triangles:h}}function ime(t){let e=[];for(let n=0;n<t.length;n+=3)e.push([t[n],t[n+1]]),e.push([t[n+1],t[n+2]]),e.push([t[n+2],t[n]]);e.sort((n,o)=>Math.min(...n)-Math.min(...o)||Math.max(...n)-Math.max(...o));let r=[],i=0;for(;i<e.length;)e[i][0]===e[i+1]?.[1]&&e[i][1]===e[i+1]?.[0]?i+=2:(r.push(e[i]),i++);return r}function nme(t,e){t.westIndices.sort((i,n)=>e[3*i+1]-e[3*n+1]),t.eastIndices.sort((i,n)=>e[3*n+1]-e[3*i+1]),t.southIndices.sort((i,n)=>e[3*n]-e[3*i]),t.northIndices.sort((i,n)=>e[3*i]-e[3*n]);let r=[];for(let i in t){let n=t[i];for(let o=0;o<n.length-1;o++)r.push([n[o],n[o+1]])}return r}function ome({edge:t,edgeIndex:e,attributes:r,skirtHeight:i,newPosition:n,newTexcoord0:o,newTriangles:a}){let c=r.POSITION.value.length,h=e*2,p=e*2+1;n.set(r.POSITION.value.subarray(t[0]*3,t[0]*3+3),h*3),n[h*3+2]=n[h*3+2]-i,n.set(r.POSITION.value.subarray(t[1]*3,t[1]*3+3),p*3),n[p*3+2]=n[p*3+2]-i,o.set(r.TEXCOORD_0.value.subarray(t[0]*2,t[0]*2+2),h*2),o.set(r.TEXCOORD_0.value.subarray(t[1]*2,t[1]*2+2),p*2);let x=e*2*3;a[x]=t[0],a[x+1]=c/3+p,a[x+2]=t[1],a[x+3]=c/3+p,a[x+4]=t[0],a[x+5]=c/3+h}function P5(t,e={}){let{bounds:r}=e,{header:i,vertexData:n,triangleIndices:o,westIndices:a,northIndices:c,eastIndices:h,southIndices:p}=M5(t,kA.triangleIndices),x=o,T=sme(n,i,r),R=Dh(T);if(e?.skirtHeight){let{attributes:k,triangles:j}=PT(T,x,e.skirtHeight,{westIndices:a,northIndices:c,eastIndices:h,southIndices:p});T=k,x=j}return{loaderData:{header:{}},header:{vertexCount:x.length,boundingBox:R},schema:void 0,topology:"triangle-list",mode:4,indices:{value:x,size:1},attributes:T}}function sme(t,e,r){let{minHeight:i,maxHeight:n}=e,[o,a,c,h]=r||[0,0,1,1],p=c-o,x=h-a,T=n-i,R=t.length/3,k=new Float32Array(R*3),j=new Float32Array(R*2);for(let q=0;q<R;q++){let Z=t[q]/32767,re=t[q+R]/32767,ee=t[q+R*2]/32767;k[3*q+0]=Z*p+o,k[3*q+1]=re*x+a,k[3*q+2]=ee*T+i,j[2*q+0]=Z,j[2*q+1]=re}return{POSITION:{value:k,size:3},TEXCOORD_0:{value:j,size:2}}}var Jx=class{constructor(e=257){this.gridSize=e;let r=e-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let i=0;i<this.numTriangles;i++){let n=i+2,o=0,a=0,c=0,h=0,p=0,x=0;for(n&1?c=h=p=r:o=a=x=r;(n>>=1)>1;){let R=o+c>>1,k=a+h>>1;n&1?(c=o,h=a,o=p,a=x):(o=c,a=h,c=p,h=x),p=R,x=k}let T=i*4;this.coords[T+0]=o,this.coords[T+1]=a,this.coords[T+2]=c,this.coords[T+3]=h}}createTile(e){return new R5(e,this)}},R5=class{constructor(e,r){let i=r.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=r,this.errors=new Float32Array(e.length),this.update()}update(){let{numTriangles:e,numParentTriangles:r,coords:i,gridSize:n}=this.martini,{terrain:o,errors:a}=this;for(let c=e-1;c>=0;c--){let h=c*4,p=i[h+0],x=i[h+1],T=i[h+2],R=i[h+3],k=p+T>>1,j=x+R>>1,q=k+j-x,Z=j+p-k,re=(o[x*n+p]+o[R*n+T])/2,ee=j*n+k,se=Math.abs(re-o[ee]);if(a[ee]=Math.max(a[ee],se),c<r){let me=(x+Z>>1)*n+(p+q>>1),Le=(R+Z>>1)*n+(T+q>>1);a[ee]=Math.max(a[ee],a[me],a[Le])}}}getMesh(e=0){let{gridSize:r,indices:i}=this.martini,{errors:n}=this,o=0,a=0,c=r-1;i.fill(0);function h(k,j,q,Z,re,ee){let se=k+q>>1,me=j+Z>>1;Math.abs(k-re)+Math.abs(j-ee)>1&&n[me*r+se]>e?(h(re,ee,k,j,se,me),h(q,Z,re,ee,se,me)):(i[j*r+k]=i[j*r+k]||++o,i[Z*r+q]=i[Z*r+q]||++o,i[ee*r+re]=i[ee*r+re]||++o,a++)}h(0,0,c,c,c,0),h(c,c,0,0,0,c);let p=new Uint16Array(o*2),x=new Uint32Array(a*3),T=0;function R(k,j,q,Z,re,ee){let se=k+q>>1,me=j+Z>>1;if(Math.abs(k-re)+Math.abs(j-ee)>1&&n[me*r+se]>e)R(re,ee,k,j,se,me),R(q,Z,re,ee,se,me);else{let Le=i[j*r+k]-1,je=i[Z*r+q]-1,Je=i[ee*r+re]-1;p[2*Le]=k,p[2*Le+1]=j,p[2*je]=q,p[2*je+1]=Z,p[2*Je]=re,p[2*Je+1]=ee,x[T++]=Le,x[T++]=je,x[T++]=Je}}return R(0,0,c,c,c,0),R(c,c,0,0,0,c),{vertices:p,triangles:x}}};var e2=class{constructor(e,r,i=r){this.data=e,this.width=r,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;let n=r-1,o=i-1,a=this._addPoint(0,0),c=this._addPoint(n,0),h=this._addPoint(0,o),p=this._addPoint(n,o),x=this._addTriangle(p,a,h,-1,-1,-1);this._addTriangle(a,p,c,x,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,r){return this.data[this.width*r+e]}_flush(){let e=this.coords;for(let r=0;r<this._pendingLen;r++){let i=this._pending[r],n=2*this.triangles[i*3+0],o=2*this.triangles[i*3+1],a=2*this.triangles[i*3+2];this._findCandidate(e[n],e[n+1],e[o],e[o+1],e[a],e[a+1],i)}this._pendingLen=0}_findCandidate(e,r,i,n,o,a,c){let h=Math.min(e,i,o),p=Math.min(r,n,a),x=Math.max(e,i,o),T=Math.max(r,n,a),R=NA(i,n,o,a,h,p),k=NA(o,a,e,r,h,p),j=NA(e,r,i,n,h,p),q=n-r,Z=e-i,re=a-n,ee=i-o,se=r-a,me=o-e,Le=NA(e,r,i,n,o,a),je=this.heightAt(e,r)/Le,Je=this.heightAt(i,n)/Le,J=this.heightAt(o,a)/Le,te=0,X=0,ye=0,_e=0;for(let Oe=p;Oe<=T;Oe++){let ve=0;R<0&&re!==0&&(ve=Math.max(ve,Math.floor(-R/re))),k<0&&se!==0&&(ve=Math.max(ve,Math.floor(-k/se))),j<0&&q!==0&&(ve=Math.max(ve,Math.floor(-j/q)));let De=R+re*ve,Xe=k+se*ve,rt=j+q*ve,tt=!1;for(let yt=h+ve;yt<=x;yt++){if(De>=0&&Xe>=0&&rt>=0){tt=!0;let Xt=je*De+Je*Xe+J*rt,jt=Math.abs(Xt-this.heightAt(yt,Oe));_e+=jt*jt,jt>te&&(te=jt,X=yt,ye=Oe)}else if(tt)break;De+=re,Xe+=se,rt+=q}R+=ee,k+=me,j+=Z}(X===e&&ye===r||X===i&&ye===n||X===o&&ye===a)&&(te=0),this._candidates[2*c]=X,this._candidates[2*c+1]=ye,this._rms[c]=_e,this._queuePush(c,te,_e)}_step(){let e=this._queuePop(),r=e*3+0,i=e*3+1,n=e*3+2,o=this.triangles[r],a=this.triangles[i],c=this.triangles[n],h=this.coords[2*o],p=this.coords[2*o+1],x=this.coords[2*a],T=this.coords[2*a+1],R=this.coords[2*c],k=this.coords[2*c+1],j=this._candidates[2*e],q=this._candidates[2*e+1],Z=this._addPoint(j,q);if(NA(h,p,x,T,j,q)===0)this._handleCollinear(Z,r);else if(NA(x,T,R,k,j,q)===0)this._handleCollinear(Z,i);else if(NA(R,k,h,p,j,q)===0)this._handleCollinear(Z,n);else{let re=this._halfedges[r],ee=this._halfedges[i],se=this._halfedges[n],me=this._addTriangle(o,a,Z,re,-1,-1,r),Le=this._addTriangle(a,c,Z,ee,-1,me+1),je=this._addTriangle(c,o,Z,se,me+2,Le+1);this._legalize(me),this._legalize(Le),this._legalize(je)}}_addPoint(e,r){let i=this.coords.length>>1;return this.coords.push(e,r),i}_addTriangle(e,r,i,n,o,a,c=this.triangles.length){let h=c/3;return this.triangles[c+0]=e,this.triangles[c+1]=r,this.triangles[c+2]=i,this._halfedges[c+0]=n,this._halfedges[c+1]=o,this._halfedges[c+2]=a,n>=0&&(this._halfedges[n]=c+0),o>=0&&(this._halfedges[o]=c+1),a>=0&&(this._halfedges[a]=c+2),this._candidates[2*h+0]=0,this._candidates[2*h+1]=0,this._queueIndices[h]=-1,this._rms[h]=0,this._pending[this._pendingLen++]=h,c}_legalize(e){let r=this._halfedges[e];if(r<0)return;let i=e-e%3,n=r-r%3,o=i+(e+1)%3,a=i+(e+2)%3,c=n+(r+2)%3,h=n+(r+1)%3,p=this.triangles[a],x=this.triangles[e],T=this.triangles[o],R=this.triangles[c],k=this.coords;if(!ame(k[2*p],k[2*p+1],k[2*x],k[2*x+1],k[2*T],k[2*T+1],k[2*R],k[2*R+1]))return;let j=this._halfedges[o],q=this._halfedges[a],Z=this._halfedges[c],re=this._halfedges[h];this._queueRemove(i/3),this._queueRemove(n/3);let ee=this._addTriangle(p,R,T,-1,Z,j,i),se=this._addTriangle(R,p,x,ee,q,re,n);this._legalize(ee+1),this._legalize(se+2)}_handleCollinear(e,r){let i=r-r%3,n=i+(r+1)%3,o=i+(r+2)%3,a=this.triangles[o],c=this.triangles[r],h=this.triangles[n],p=this._halfedges[n],x=this._halfedges[o],T=this._halfedges[r];if(T<0){let je=this._addTriangle(e,a,c,-1,x,-1,i),Je=this._addTriangle(a,e,h,je,-1,p);this._legalize(je+1),this._legalize(Je+2);return}let R=T-T%3,k=R+(T+2)%3,j=R+(T+1)%3,q=this.triangles[k],Z=this._halfedges[k],re=this._halfedges[j];this._queueRemove(R/3);let ee=this._addTriangle(a,c,e,x,-1,-1,i),se=this._addTriangle(c,q,e,re,-1,ee+1,R),me=this._addTriangle(q,h,e,Z,-1,se+1),Le=this._addTriangle(h,a,e,p,ee+2,me+1);this._legalize(ee),this._legalize(se),this._legalize(me),this._legalize(Le)}_queuePush(e,r,i){let n=this._queue.length;this._queueIndices[e]=n,this._queue.push(e),this._errors.push(r),this._rmsSum+=i,this._queueUp(n)}_queuePop(){let e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){let e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){let r=this._queueIndices[e];if(r<0){let n=this._pending.indexOf(e);if(n!==-1)this._pending[n]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}let i=this._queue.length-1;i!==r&&(this._queueSwap(r,i),this._queueDown(r,i)||this._queueUp(r)),this._queuePopBack()}_queueLess(e,r){return this._errors[e]>this._errors[r]}_queueSwap(e,r){let i=this._queue[e],n=this._queue[r];this._queue[e]=n,this._queue[r]=i,this._queueIndices[i]=r,this._queueIndices[n]=e;let o=this._errors[e];this._errors[e]=this._errors[r],this._errors[r]=o}_queueUp(e){let r=e;for(;;){let i=r-1>>1;if(i===r||!this._queueLess(r,i))break;this._queueSwap(i,r),r=i}}_queueDown(e,r){let i=e;for(;;){let n=2*i+1;if(n>=r||n<0)break;let o=n+1,a=n;if(o<r&&this._queueLess(o,n)&&(a=o),!this._queueLess(a,i))break;this._queueSwap(i,a),i=a}return i>e}};function NA(t,e,r,i,n,o){return(r-n)*(e-o)-(i-o)*(t-n)}function ame(t,e,r,i,n,o,a,c){let h=t-a,p=e-c,x=r-a,T=i-c,R=n-a,k=o-c,j=h*h+p*p,q=x*x+T*T,Z=R*R+k*k;return h*(T*Z-q*k)-p*(x*Z-q*R)+j*(x*k-T*R)<0}function fH(t,e){let{meshMaxError:r,bounds:i,elevationDecoder:n}=e,{data:o,width:a,height:c}=t,h,p;switch(e.tesselator){case"martini":h=RT(o,a,c,n,e.tesselator),p=uH(r,a,h);break;case"delatin":h=RT(o,a,c,n,e.tesselator),p=hH(r,a,c,h);break;default:a===c&&!(c&a-1)?(h=RT(o,a,c,n,"martini"),p=uH(r,a,h)):(h=RT(o,a,c,n,"delatin"),p=hH(r,a,c,h));break}let{vertices:x}=p,{triangles:T}=p,R=lme(x,h,a,c,i),k=Dh(R);if(e.skirtHeight){let{attributes:j,triangles:q}=PT(R,T,e.skirtHeight);R=j,T=q}return{loaderData:{header:{}},header:{vertexCount:T.length,boundingBox:k},mode:4,indices:{value:Uint32Array.from(T),size:1},attributes:R}}function uH(t,e,r){let i=e+1,o=new Jx(i).createTile(r),{vertices:a,triangles:c}=o.getMesh(t);return{vertices:a,triangles:c}}function hH(t,e,r,i){let n=new e2(i,e+1,r+1);n.run(t);let{coords:o,triangles:a}=n;return{vertices:o,triangles:a}}function RT(t,e,r,i,n){let{rScaler:o,bScaler:a,gScaler:c,offset:h}=i,p=new Float32Array((e+1)*(r+1));for(let x=0,T=0;T<r;T++)for(let R=0;R<e;R++,x++){let k=x*4,j=t[k+0],q=t[k+1],Z=t[k+2];p[x+T]=j*o+q*c+Z*a+h}if(n==="martini"){for(let x=(e+1)*e,T=0;T<e;T++,x++)p[x]=p[x-e-1];for(let x=r,T=0;T<r+1;T++,x+=r+1)p[x]=p[x-1]}return p}function lme(t,e,r,i,n){let o=r+1,a=t.length/2,c=new Float32Array(a*3),h=new Float32Array(a*2),[p,x,T,R]=n||[0,0,r,i],k=(T-p)/r,j=(R-x)/i;for(let q=0;q<a;q++){let Z=t[q*2],re=t[q*2+1],ee=re*o+Z;c[3*q+0]=Z*k+p,c[3*q+1]=-re*j+R,c[3*q+2]=e[ee],h[2*q+0]=Z/r,h[2*q+1]=re/i}return{POSITION:{value:c,size:3},TEXCOORD_0:{value:h,size:2}}}var BT="4.3.2";var LT={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:BT,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};var dH={dataType:null,batchType:null,name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:BT,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};var cme={...LT,parse:ume};async function ume(t,e,r){let i={...e,mimeType:"application/x.image",image:{...e?.image,type:"data"}},n=await el(t,[],i,r),o={...cme.options.terrain,...e?.terrain};return fH(n,o)}var _Je={...dH,parseSync:(t,e)=>P5(t,e?.["quantized-mesh"]),parse:async(t,e)=>P5(t,e?.["quantized-mesh"])};var pH=[1],hme={...TA.defaultProps,elevationData:Dd,texture:{...Dd,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[LT]};function AH(t){return Array.isArray(t)?t.join(";"):t||""}var t2=class extends so{updateState({props:e,oldProps:r}){let i=e.elevationData!==r.elevationData;if(i){let{elevationData:o}=e,a=o&&(Array.isArray(o)||o.includes("{x}")&&o.includes("{y}"));this.setState({isTiled:a})}let n=i||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&n){let o=this.loadTerrain(e);this.setState({terrain:o})}e.workerUrl&&cr.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:r,elevationDecoder:i,meshMaxError:n,signal:o}){if(!e)return null;let a=this.getLoadOptions();a={...a,terrain:{skirtHeight:this.state.isTiled?n*2:0,...a?.terrain,bounds:r,meshMaxError:n,elevationDecoder:i}};let{fetch:c}=this.props;return c(e,{propName:"elevationData",layer:this,loadOptions:a,signal:o})}getTiledTerrainData(e){let{elevationData:r,fetch:i,texture:n,elevationDecoder:o,meshMaxError:a}=this.props,{viewport:c}=this.context,h=Yu(r,e),p=n&&Yu(n,e),{signal:x}=e,T=[0,0],R=[0,0];if(c.isGeospatial){let Z=e.bbox;T=c.projectFlat([Z.west,Z.south]),R=c.projectFlat([Z.east,Z.north])}else{let Z=e.bbox;T=[Z.left,Z.bottom],R=[Z.right,Z.top]}let k=[T[0],T[1],R[0],R[1]],j=this.loadTerrain({elevationData:h,bounds:k,elevationDecoder:o,meshMaxError:a,signal:x}),q=p?i(p,{propName:"texture",layer:this,loaders:[],signal:x}).catch(Z=>null):Promise.resolve(null);return Promise.all([j,q])}renderSubLayers(e){let r=this.getSubLayerClass("mesh",tg),{color:i,wireframe:n,material:o}=this.props,{data:a}=e;if(!a)return null;let[c,h]=a;return new r(e,{data:pH,mesh:c,texture:h,_instanced:!1,coordinateSystem:vr.CARTESIAN,getPosition:p=>[0,0,0],getColor:i,wireframe:n,material:o})}onViewportLoad(e){if(!e)return;let{zRange:r}=this.state,i=e.map(a=>a.content).filter(Boolean).map(a=>a[0].header.boundingBox.map(h=>h[2]));if(i.length===0)return;let n=Math.min(...i.map(a=>a[0])),o=Math.max(...i.map(a=>a[1]));(!r||n<r[0]||o>r[1])&&this.setState({zRange:[n,o]})}renderLayers(){let{color:e,material:r,elevationData:i,texture:n,wireframe:o,meshMaxError:a,elevationDecoder:c,tileSize:h,maxZoom:p,minZoom:x,extent:T,maxRequests:R,onTileLoad:k,onTileUnload:j,onTileError:q,maxCacheSize:Z,maxCacheByteSize:re,refinementStrategy:ee}=this.props;if(this.state.isTiled)return new TA(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:AH(i),texture:AH(n),meshMaxError:a,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:h,maxZoom:p,minZoom:x,extent:T,maxRequests:R,onTileLoad:k,onTileUnload:j,onTileError:q,maxCacheSize:Z,maxCacheByteSize:re,refinementStrategy:ee});if(!i)return null;let se=this.getSubLayerClass("mesh",tg);return new se(this.getSubLayerProps({id:"mesh"}),{data:pH,mesh:this.state.terrain,texture:n,_instanced:!1,getPosition:me=>[0,0,0],getColor:e,material:r,wireframe:o})}};t2.defaultProps=hme;t2.layerName="TerrainLayer";var mH=t2;var fme={clipBounds:[0,0,1,1],clipByInstance:void 0},gH=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,dme={name:"clip",vs:gH,uniformTypes:{bounds:"vec4<f32>"}},pme={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},Ame={name:"clip",fs:gH,uniformTypes:{bounds:"vec4<f32>"}},mme={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`},r2=class extends WM{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[dme],inject:pme}:{modules:[Ame],inject:mme}}draw(){let{clipBounds:e}=this.props,r={};if(this.state.clipByInstance)r.bounds=e;else{let i=this.projectPosition([e[0],e[1],0]),n=this.projectPosition([e[2],e[3],0]);r.bounds=[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[0],n[0]),Math.max(i[1],n[1])]}this.setShaderModuleProps({clip:r})}};r2.defaultProps=fme;r2.extensionName="ClipExtension";var B5=r2;function D5(t,e,r){let i=gme(t),n=Object.keys(i).filter(o=>i[o]!==Array);return _me(t,{propArrayTypes:i,...e},{numericPropKeys:r&&r.numericPropKeys||n,PositionDataType:r?r.PositionDataType:Float32Array,triangulate:r?r.triangulate:!0})}function gme(t){let e={};for(let r of t)if(r.properties)for(let i in r.properties){let n=r.properties[i];e[i]=Tme(n,e[i])}return e}function _me(t,e,r){let{pointPositionsCount:i,pointFeaturesCount:n,linePositionsCount:o,linePathsCount:a,lineFeaturesCount:c,polygonPositionsCount:h,polygonObjectsCount:p,polygonRingsCount:x,polygonFeaturesCount:T,propArrayTypes:R,coordLength:k}=e,{numericPropKeys:j=[],PositionDataType:q=Float32Array,triangulate:Z=!0}=r,re=t[0]&&"id"in t[0],ee=t.length>65535?Uint32Array:Uint16Array,se={type:"Point",positions:new q(i*k),globalFeatureIds:new ee(i),featureIds:n>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},me={type:"LineString",pathIndices:o>65535?new Uint32Array(a+1):new Uint16Array(a+1),positions:new q(o*k),globalFeatureIds:new ee(o),featureIds:c>65535?new Uint32Array(o):new Uint16Array(o),numericProps:{},properties:[],fields:[]},Le={type:"Polygon",polygonIndices:h>65535?new Uint32Array(p+1):new Uint16Array(p+1),primitivePolygonIndices:h>65535?new Uint32Array(x+1):new Uint16Array(x+1),positions:new q(h*k),globalFeatureIds:new ee(h),featureIds:T>65535?new Uint32Array(h):new Uint16Array(h),numericProps:{},properties:[],fields:[]};Z&&(Le.triangles=[]);for(let Je of[se,me,Le])for(let J of j){let te=R[J];Je.numericProps[J]=new te(Je.positions.length/k)}me.pathIndices[a]=o,Le.polygonIndices[p]=h,Le.primitivePolygonIndices[x]=h;let je={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(let Je of t){let J=Je.geometry,te=Je.properties||{};switch(J.type){case"Point":yme(J,se,je,k,te),se.properties.push(O5(te,j)),re&&se.fields.push({id:Je.id}),je.pointFeature++;break;case"LineString":xme(J,me,je,k,te),me.properties.push(O5(te,j)),re&&me.fields.push({id:Je.id}),je.lineFeature++;break;case"Polygon":bme(J,Le,je,k,te),Le.properties.push(O5(te,j)),re&&Le.fields.push({id:Je.id}),je.polygonFeature++;break;default:throw new Error("Invalid geometry type")}je.feature++}return wme(se,me,Le,k)}function yme(t,e,r,i,n){e.positions.set(t.data,r.pointPosition*i);let o=t.data.length/i;F5(e,n,r.pointPosition,o),e.globalFeatureIds.fill(r.feature,r.pointPosition,r.pointPosition+o),e.featureIds.fill(r.pointFeature,r.pointPosition,r.pointPosition+o),r.pointPosition+=o}function xme(t,e,r,i,n){e.positions.set(t.data,r.linePosition*i);let o=t.data.length/i;F5(e,n,r.linePosition,o),e.globalFeatureIds.fill(r.feature,r.linePosition,r.linePosition+o),e.featureIds.fill(r.lineFeature,r.linePosition,r.linePosition+o);for(let a=0,c=t.indices.length;a<c;++a){let h=t.indices[a],p=a===c-1?t.data.length:t.indices[a+1];e.pathIndices[r.linePath++]=r.linePosition,r.linePosition+=(p-h)/i}}function bme(t,e,r,i,n){e.positions.set(t.data,r.polygonPosition*i);let o=t.data.length/i;F5(e,n,r.polygonPosition,o),e.globalFeatureIds.fill(r.feature,r.polygonPosition,r.polygonPosition+o),e.featureIds.fill(r.polygonFeature,r.polygonPosition,r.polygonPosition+o);for(let a=0,c=t.indices.length;a<c;++a){let h=r.polygonPosition;e.polygonIndices[r.polygonObject++]=h;let p=t.areas[a],x=t.indices[a],T=t.indices[a+1];for(let k=0,j=x.length;k<j;++k){let q=x[k],Z=k===j-1?T===void 0?t.data.length:T[0]:x[k+1];e.primitivePolygonIndices[r.polygonRing++]=r.polygonPosition,r.polygonPosition+=(Z-q)/i}let R=r.polygonPosition;vme(e,p,x,{startPosition:h,endPosition:R,coordLength:i})}}function vme(t,e,r,{startPosition:i,endPosition:n,coordLength:o}){if(!t.triangles)return;let a=i*o,c=n*o,h=t.positions.subarray(a,c),p=r[0],x=r.slice(1).map(R=>(R-p)/o),T=s4(h,x,o,e);for(let R=0,k=T.length;R<k;++R)t.triangles.push(i+T[R])}function L5(t,e){let r={};for(let i in t)r[i]={value:t[i],size:e};return r}function wme(t,e,r,i){let n={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:L5(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:L5(e.numericProps,1)},polygons:{...r,positions:{value:r.positions,size:i},polygonIndices:{value:r.polygonIndices,size:1},primitivePolygonIndices:{value:r.primitivePolygonIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:L5(r.numericProps,1)}};return n.polygons&&r.triangles&&(n.polygons.triangles={value:new Uint32Array(r.triangles),size:1}),n}function F5(t,e,r,i){for(let n in t.numericProps)if(n in e){let o=e[n];t.numericProps[n].fill(o,r,r+i)}}function O5(t,e){let r={};for(let i in t)e.includes(i)||(r[i]=t[i]);return r}function Tme(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function FT(t,e){let r=e?.globalFeatureId;return r!==void 0?Eme(t,r):Cme(t,e?.type)}function Eme(t,e){let r=yH(t);for(let i of r){let n=0,o=i.featureIds.value[0];for(let a=0;a<i.featureIds.value.length;a++){let c=i.featureIds.value[a];if(c!==o){if(e===i.globalFeatureIds.value[n])return OT(i,n,a);n=a,o=c}}if(e===i.globalFeatureIds.value[n])return OT(i,n,i.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function Cme(t,e){let r=yH(t,e);return Sme(r)}function _H(t,e,r){switch(t.type){case"Point":return Rme(t,e,r);case"LineString":return Pme(t,e,r);case"Polygon":return xH(t,e,r);default:let i=t;throw new Error(`Unsupported geometry type: ${i?.type}`)}}function yH(t,e){let r=[];return t.points&&(t.points.type="Point",r.push(t.points)),t.lines&&(t.lines.type="LineString",r.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",r.push(t.polygons)),r}function Sme(t){let e=[];for(let r of t){if(r.featureIds.value.length===0)continue;let i=0,n=r.featureIds.value[0];for(let o=0;o<r.featureIds.value.length;o++){let a=r.featureIds.value[o];a!==n&&(e.push(OT(r,i,o)),i=o,n=a)}e.push(OT(r,i,r.featureIds.value.length))}return e}function OT(t,e,r){let i=_H(t,e,r),n=Mme(t,e,r),o=Ime(t,e,r);return{type:"Feature",geometry:i,properties:n,...o}}function Ime(t,e=0,r){return t.fields&&t.fields[t.featureIds.value[e]]}function Mme(t,e=0,r){let i=Object.assign({},t.properties[t.featureIds.value[e]]);for(let n in t.numericProps)i[n]=t.numericProps[n].value[e];return i}function xH(t,e=-1/0,r=1/0){let{positions:i}=t,n=t.polygonIndices.value.filter(h=>h>=e&&h<=r),o=t.primitivePolygonIndices.value.filter(h=>h>=e&&h<=r);if(!(n.length>2)){let h=[];for(let p=0;p<o.length-1;p++){let x=o[p],T=o[p+1],R=DT(i,x,T);h.push(R)}return{type:"Polygon",coordinates:h}}let c=[];for(let h=0;h<n.length-1;h++){let p=n[h],x=n[h+1],T=xH(t,p,x).coordinates;c.push(T)}return{type:"MultiPolygon",coordinates:c}}function Pme(t,e=-1/0,r=1/0){let{positions:i}=t,n=t.pathIndices.value.filter(c=>c>=e&&c<=r);if(!(n.length>2))return{type:"LineString",coordinates:DT(i,n[0],n[1])};let a=[];for(let c=0;c<n.length-1;c++){let h=DT(i,n[c],n[c+1]);a.push(h)}return{type:"MultiLineString",coordinates:a}}function Rme(t,e,r){let{positions:i}=t,n=DT(i,e,r);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function DT(t,e,r){e=e||0,r=r||t.value.length/t.size;let i=[];for(let n=e;n<r;n++){let o=Array();for(let a=n*t.size;a<(n+1)*t.size;a++)o.push(Number(t.value[a]));i.push(o)}return i}var j5=yc(SH(),1);function Xme(t){let e=0;for(let r=0,i=t.length-1,n,o;r<t.length;i=r++)n=t[r],o=t[i],e+=(o[0]-n[0])*(n[1]+o[1]);return e}function z5(t,e){if(Array.isArray(t[0])){for(let i of t)z5(i,e);return}let r=t;r[0]/=e,r[1]/=e}function IH(t,e){for(let r=0;r<t.length;++r)t[r]/=e}function U5(t,e,r){if(typeof t[0][0]!="number"){for(let a of t)U5(a,e,r);return}let i=r*Math.pow(2,e.z),n=r*e.x,o=r*e.y;for(let a=0;a<t.length;a++){let c=t[a];c[0]=(c[0]+n)*360/i-180;let h=180-(c[1]+o)*360/i;c[1]=360/Math.PI*Math.atan(Math.exp(h*Math.PI/180))-90}}function MH(t,e,r){let{x:i,y:n,z:o}=e,a=r*Math.pow(2,o),c=r*i,h=r*n;for(let p=0,x=t.length;p<x;p+=2){t[p]=(t[p]+c)*360/a-180;let T=180-(t[p+1]+h)*360/a;t[p+1]=360/Math.PI*Math.atan(Math.exp(T*Math.PI/180))-90}}function PH(t){let e=t.length;if(e<=1)return[t];let r=[],i,n;for(let o=0;o<e;o++){let a=Xme(t[o]);a!==0&&(n===void 0&&(n=a<0),n===a<0?(i&&r.push(i),i=[t[o]]):i&&i.push(t[o]))}return i&&r.push(i),r}function RH(t){let e=t.indices.length,r="Polygon";if(e<=1)return{type:r,data:t.data,areas:[[Cd(t.data)]],indices:[t.indices]};let i=[],n=[],o=[],a=[],c,h=0;for(let p,x=0,T;x<e;x++){T=t.indices[x]-h,p=t.indices[x+1]-h||t.data.length;let R=t.data.slice(T,p),k=Cd(R);if(k===0){let j=t.data.slice(0,T),q=t.data.slice(p);t.data=j.concat(q),h+=p-T;continue}c===void 0&&(c=k<0),c===k<0?(a.length&&(i.push(o),n.push(a)),a=[T],o=[k]):(o.push(k),a.push(T))}return o&&i.push(o),a.length&&n.push(a),{type:r,areas:i,indices:n,data:t.data}}var vg=class{properties;extent;type;id;_pbf;_geometry;_keys;_values;_geometryInfo;static types=["Unknown","Point","LineString","Polygon"];constructor(e,r,i,n,o,a){this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=n,this._values=o,this._geometryInfo=a,e.readFields(Yme,this,r)}toGeoJSONFeature(e,r){let i=this.loadGeometry();switch(e){case"wgs84":return BH(this,i,n=>U5(n,r,this.extent));default:return BH(this,i,z5)}}toBinaryFeature(e,r){let i=this.loadFlatGeometry();switch(e){case"wgs84":return this._toBinaryCoordinates(i,n=>MH(n,r,this.extent));default:return this._toBinaryCoordinates(i,IH)}}bbox(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n=0,o=0,a=0,c=1/0,h=-1/0,p=1/0,x=-1/0;for(;e.pos<r;){if(n<=0){let T=e.readVarint();i=T&7,n=T>>3}if(n--,i===1||i===2)o+=e.readSVarint(),a+=e.readSVarint(),o<c&&(c=o),o>h&&(h=o),a<p&&(p=a),a>x&&(x=a);else if(i!==7)throw new Error(`unknown command ${i}`)}return[c,p,h,x]}_toBinaryCoordinates(e,r){let i;r(e.data,this.extent);let n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=e.indices.length,i={type:"Point",...e};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=e.indices.length,this._geometryInfo.linePositionsCount+=e.data.length/n,i={type:"LineString",...e};break;case 3:i=RH(e),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(let a of i.indices)this._geometryInfo.polygonRingsCount+=a.length;this._geometryInfo.polygonPositionsCount+=i.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}let o={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(o.id=this.id),o}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n=0,o=0,a=0,c=[],h;for(;e.pos<r;){if(n<=0){let p=e.readVarint();i=p&7,n=p>>3}switch(n--,i){case 1:case 2:o+=e.readSVarint(),a+=e.readSVarint(),i===1&&(h&&c.push(h),h=[]),h&&h.push([o,a]);break;case 7:h&&h.push(h[0].slice());break;default:throw new Error(`unknown command ${i}`)}}return h&&c.push(h),c}loadFlatGeometry(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n,o=0,a=0,c=0,h=0,p=[],x=[];for(;e.pos<r;)if(o<=0&&(n=e.readVarint(),i=n&7,o=n>>3),o--,i===1||i===2)a+=e.readSVarint(),c+=e.readSVarint(),i===1&&p.push(h),x.push(a,c),h+=2;else if(i===7){if(h>0){let T=p[p.length-1];x.push(x[T],x[T+1]),h+=2}}else throw new Error(`unknown command ${i}`);return{data:x,indices:p}}};function BH(t,e,r){let i=vg.types[t.type],n,o,a;switch(t.type){case 1:let h=[];for(n=0;n<e.length;n++)h[n]=e[n][0];a=h,r(a,t.extent);break;case 2:for(a=e,n=0;n<a.length;n++)r(a[n],t.extent);break;case 3:for(a=PH(e),n=0;n<a.length;n++)for(o=0;o<a[n].length;o++)r(a[n][o],t.extent);break;default:throw new Error("illegal vector tile type")}a.length===1?a=a[0]:i=`Multi${i}`;let c={type:"Feature",geometry:{type:i,coordinates:a},properties:t.properties};return t.id!==null&&(c.properties||={},c.properties.id=t.id),c}function Yme(t,e,r){e&&r&&(t===1?e.id=r.readVarint():t===2?Kme(r,e):t===3?e.type=r.readVarint():t===4&&(e._geometry=r.pos))}function Kme(t,e){let r=t.readVarint()+t.pos;for(;t.pos<r;){let i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}var zT=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Qme,this,r),this.length=this._features.length}getGeoJSONFeature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let r=this._pbf.readVarint()+this._pbf.pos;return new vg(this._pbf,r,this.extent,this._keys,this._values)}getBinaryFeature(e,r){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let i=this._pbf.readVarint()+this._pbf.pos;return new vg(this._pbf,i,this.extent,this._keys,this._values,r)}};function Qme(t,e,r){e&&r&&(t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(Jme(r)))}function Jme(t){let e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){let i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}var i2=class{layers;constructor(e,r){this.layers=e.readFields(ege,{},r)}};function ege(t,e,r){if(t===3&&r){let i=new zT(r,r.readVarint()+r.pos);i.length&&e&&(e[i.name]=i)}}function G5(t,e){let r=rge(e),i=e?.gis?.format||e?.mvt?.shape||e?.shape;switch(i){case"columnar-table":return{shape:"columnar-table",data:V5(t,r)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:LH(t,r)};case"geojson":return LH(t,r);case"binary-geometry":return V5(t,r);case"binary":return V5(t,r);default:throw new Error(i||"undefined shape")}}function V5(t,e){let[r,i]=tge(t,e),n=D5(r,i);return n.byteLength=t.byteLength,n}function tge(t,e){let r=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[r,i];let n=new i2(new j5.default(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(n.layers)).forEach(a=>{let c=n.layers[a];if(c)for(let h=0;h<c.length;h++){let p=c.getBinaryFeature(h,i),x=nge(p,e,a);r.push(x)}}),[r,i]}function LH(t,e){if(t.byteLength<=0)return[];let r=[],i=new i2(new j5.default(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(o=>{let a=i.layers[o];if(a)for(let c=0;c<a.length;c++){let h=a.getGeoJSONFeature(c),p=ige(h,e,o);r.push(p)}}),r}function rge(t){if(!t?.mvt)throw new Error("mvt options required");if(t.mvt?.coordinates==="wgs84"&&!t.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.gis&&I_.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')(),t.mvt}function ige(t,e,r){let i=t.toGeoJSONFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&(i.properties||={},i.properties[e.layerProperty]=r),i}function nge(t,e,r){let i=t.toBinaryFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=r),i}var oge="4.3.2",UT={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:oge,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}},sge={...UT,parse:async(t,e)=>G5(t,e),parseSync:G5,binary:!0};var age={Point:OH,MultiPoint:lge,LineString:DH,MultiLineString:cge,Polygon:FH,MultiPolygon:uge};function OH([t,e],[r,i],n){let o=Ds(r[0],i[0],t),a=Ds(r[1],i[1],e);return n.unprojectFlat([o,a])}function H5(t,e,r){return t.map(i=>OH(i,e,r))}function lge(t,e,r){return H5(t,e,r)}function DH(t,e,r){return H5(t,e,r)}function cge(t,e,r){return t.map(i=>DH(i,e,r))}function FH(t,e,r){return t.map(i=>H5(i,e,r))}function uge(t,e,r){return t.map(i=>FH(i,e,r))}function kH(t,e,r){let i=r.projectFlat([e.west,e.north]),n=r.projectFlat([e.east,e.south]),o=[i,n];return{...t,coordinates:age[t.type](t.coordinates,o,r)}}var hge=["points","lines","polygons"];function W5(t,e,r,i){for(let n of hge){let o=t[n]&&fge(t[n],e,r,i);if(o>=0)return o}return-1}function fge(t,e,r,i){let n=t.featureIds.value;if(!n.length)return-1;let o=0,a=n[n.length-1]+1;if(i){let h=dge(t,i);if(h)o=h[0],a=h[1]+1;else return-1}let c=-1;if(e in t.numericProps){let h=t.numericProps[e].value.findIndex((p,x)=>p===r&&n[x]>=o&&n[x]<a);return h>=0?t.globalFeatureIds.value[h]:-1}else e?c=NH(t.properties,h=>h[e]===r,o,a):t.fields&&(c=NH(t.fields,h=>h.id===r,o,a));return c>=0?pge(t,c):-1}function dge(t,e){if(!t.__layers){let r={},{properties:i}=t;for(let n=0;n<i.length;n++){let{layerName:o}=i[n];o&&(r[o]?r[o][1]=n:r[o]=[n,n])}t.__layers=r}return t.__layers[e]}function pge(t,e){if(!t.__ids){let r=[],i=t.featureIds.value,n=t.globalFeatureIds.value;for(let o=0;o<i.length;o++)r[i[o]]=n[o];t.__ids=r}return t.__ids[e]}function NH(t,e,r,i){for(let n=r;n<i;n++)if(e(t[n],n))return n;return-1}var $5=512,Age={..._A.defaultProps,data:Dd,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[UT],binary:!0},n2=class extends TA{initializeState(){super.initializeState();let e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:r,context:i,changeFlags:n}){n.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:r,context:i,changeFlags:n}),this._setWGS84PropertyForTiles());let{highlightColor:o}=e;o!==r.highlightColor&&Array.isArray(o)&&this.setState({highlightColor:o})}async _updateTileData(){let e=this.props.data,r=null;if(typeof e=="string"&&!iP(e)){let{onDataLoad:i,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{r=await n(e,{propName:"data",layer:this,loaders:[]})}catch(o){this.raiseError(o,"loading TileJSON"),e=null}i&&i(r,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(r=e);r&&(e=r.tiles),this.setState({data:e,tileJSON:r})}_getTilesetOptions(){let e=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:i,maxZoom:n}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>i&&(e.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(n)||r.maxzoom<n)&&(e.maxZoom=r.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){let{data:r,binary:i}=this.state,{index:n,signal:o}=e,a=Yu(r,e);if(!a)return Promise.reject("Invalid URL");let c=this.getLoadOptions(),{fetch:h}=this.props;return c={...c,mimeType:"application/x-protobuf",mvt:{...c?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:i?{format:"binary"}:{}},h(a,{propName:"data",layer:this,loadOptions:c,signal:o})}renderSubLayers(e){let{x:r,y:i,z:n}=e.tile.index,o=Math.pow(2,n),a=$5/o,c=-a,h=$5*r/o,p=$5*(1-i/o),x=new wr().scale([a,c,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=x,e.coordinateOrigin=[h,p,0],e.coordinateSystem=vr.CARTESIAN,e.extensions=[...e.extensions||[],new B5]);let T=super.renderSubLayers(e);return this.state.binary&&!(T instanceof _A)&&cr.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),T}_updateAutoHighlight(e){let{uniqueIdProperty:r}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:n}=this.state,o=e.object,a=null,c=null;o&&(a=q5(o,r),c=zH(o));let{highlightColor:h}=this.props;typeof h=="function"&&(h=h(e)),(i!==a||n!==c)&&this.setState({highlightColor:h,hoveredFeatureId:a,hoveredFeatureLayerName:c})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){let r=super.getPickingInfo(e);if(this.state.binary&&r.index!==-1){let{data:i}=e.sourceLayer.props;r.object=FT(i,{globalFeatureId:r.index})}return r.object&&!this._isWGS84()&&(r.object=VH(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){let{hoveredFeatureId:r,hoveredFeatureLayerName:i,binary:n}=this.state,{uniqueIdProperty:o,highlightedFeatureId:a}=this.props,c=e.content,h=UH(a);if(!(UH(r)||h))return-1;let x=h?a:r;return Array.isArray(c)?c.findIndex(T=>{let R=q5(T,o)===x,k=h||zH(T)===i;return R&&k}):c&&n?W5(c,o,x,h?"":i):-1}_pickObjects(e){let{deck:r,viewport:i}=this.context,n=i.width,o=i.height,a=i.x,c=i.y,h=[this.id];return r.pickObjects({x:a,y:c,width:n,height:o,layerIds:h,maxObjects:e})}getRenderedFeatures(e=null){let r=this._pickObjects(e),i=new Set,n=[];for(let o of r){let a=q5(o.object,this.props.uniqueIdProperty);a===void 0?n.push(o.object):i.has(a)||(i.add(a),n.push(o.object))}return n}_setWGS84PropertyForTiles(){let e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];let{bbox:n}=i;if(i._contentWGS84===void 0&&nP(n)){let o=this.state.binary?FT(i.content):i.content;i._contentWGS84=o.map(a=>VH(a,n,this.context.viewport))}return i._contentWGS84}})})}};n2.layerName="MVTLayer";n2.defaultProps=Age;var jH=n2;function q5(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function zH(t){return t.properties?.layerName||null}function UH(t){return t!=null&&t!==""}function VH(t,e,r){let i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>kH(t.geometry,e,r).coordinates}),i}var GH="0123456789bcdefghjkmnpqrstuvwxyz",HH={};for(let t=0;t<GH.length;t++)HH[GH.charAt(t)]=t;var mge=-90,gge=90,_ge=-180,yge=180;function xge(t){let e=!0,r=gge,i=mge,n=yge,o=_ge,a,c=0;for(let h=0,p=t.length;h<p;h++){let x=t[h].toLowerCase();c=HH[x];for(let T=4;T>=0;T--){let R=c>>T&1;e?(a=(n+o)/2,R===1?o=a:n=a):(a=(r+i)/2,R===1?i=a:r=a),e=!e}}return[i,o,r,n]}function WH(t){let[e,r,i,n]=xge(t);return[n,i,n,e,r,e,r,i,n,i]}var bge={getGeohash:{type:"accessor",value:t=>t.geohash}},o2=class extends qu{indexToBounds(){let{data:e,getGeohash:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>WH(r(i,n))}}};o2.layerName="GeohashLayer";o2.defaultProps=bge;var $H=o2;var vge=Object.assign(Object.assign(Object.assign({},y4),I4),Z5),wge=new Gu({layers:vge}),qH=new Im({configuration:wge});var Tge=function(t,e){let r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},i={on(o,a,c){if(r[o]===void 0)throw new Error(`Invalid event type: ${o}`);r[o].push({selector:a,fn:c})},render(o){e.store.featureChanged(o)}},n=function(o,a){let c=r[o],h=c.length;for(;h--;){let p=c[h];if(p.selector(a)){p.fn.call(i,a)||e.store.render(),e.ui.updateMapClasses();break}}};return t.start.call(i),{render:t.render,stop(){t.stop&&t.stop()},trash(){t.trash&&(t.trash(),e.store.render())},combineFeatures(){t.combineFeatures&&t.combineFeatures()},uncombineFeatures(){t.uncombineFeatures&&t.uncombineFeatures()},drag(o){n("drag",o)},click(o){n("click",o)},mousemove(o){n("mousemove",o)},mousedown(o){n("mousedown",o)},mouseup(o){n("mouseup",o)},mouseout(o){n("mouseout",o)},keydown(o){n("keydown",o)},keyup(o){n("keyup",o)},touchstart(o){n("touchstart",o)},touchmove(o){n("touchmove",o)},touchend(o){n("touchend",o)},tap(o){n("tap",o)}}},s2=Tge;var eW=yc(QH(),1);var Mn={};no(Mn,{LAT_MAX:()=>Cge,LAT_MIN:()=>Ege,LAT_RENDERED_MAX:()=>GT,LAT_RENDERED_MIN:()=>jT,LNG_MAX:()=>Ige,LNG_MIN:()=>Sge,activeStates:()=>Fn,classes:()=>Ns,cursors:()=>un,events:()=>yo,geojsonTypes:()=>gr,interactions:()=>Q5,meta:()=>Yn,modes:()=>oi,sources:()=>pa,types:()=>ss,updateActions:()=>Vd});var Ns={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},pa={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},un={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ss={POLYGON:"polygon",LINE:"line_string",POINT:"point"},gr={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},oi={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},yo={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Vd={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},Yn={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Fn={ACTIVE:"true",INACTIVE:"false"},Q5=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Ege=-90,jT=-85,Cge=90,GT=85,Sge=-270,Ige=270;var JH={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Mge(t,e){let r=JH[t.geometry.type]-JH[e.geometry.type];return r===0&&t.geometry.type===gr.POLYGON?t.area-e.area:r}function Pge(t){return t.map(e=>(e.geometry.type===gr.POLYGON&&(e.area=eW.default.geometry({type:gr.FEATURE,property:{},geometry:e.geometry})),e)).sort(Mge).map(e=>(delete e.area,e))}var HT=Pge;function Rge(t,e=0){return[[t.point.x-e,t.point.y-e],[t.point.x+e,t.point.y+e]]}var WT=Rge;function wg(t){if(this._items={},this._nums={},this._length=t?t.length:0,!!t)for(let e=0,r=t.length;e<r;e++)this.add(t[e]),t[e]!==void 0&&(typeof t[e]=="string"?this._items[t[e]]=e:this._nums[t[e]]=e)}wg.prototype.add=function(t){return this.has(t)?this:(this._length++,typeof t=="string"?this._items[t]=this._length:this._nums[t]=this._length,this)};wg.prototype.delete=function(t){return this.has(t)===!1?this:(this._length--,delete this._items[t],delete this._nums[t],this)};wg.prototype.has=function(t){return typeof t!="string"&&typeof t!="number"?!1:this._items[t]!==void 0||this._nums[t]!==void 0};wg.prototype.values=function(){let t=[];return Object.keys(this._items).forEach(e=>{t.push({k:e,v:this._items[e]})}),Object.keys(this._nums).forEach(e=>{t.push({k:JSON.parse(e),v:this._nums[e]})}),t.sort((e,r)=>e.v-r.v).map(e=>e.k)};wg.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var jl=wg;var Bge=[Yn.FEATURE,Yn.MIDPOINT,Yn.VERTEX],jc={click:Lge,touch:Oge};function Lge(t,e,r){return tW(t,e,r,r.options.clickBuffer)}function Oge(t,e,r){return tW(t,e,r,r.options.touchBuffer)}function tW(t,e,r,i){if(r.map===null)return[];let n=t?WT(t,i):e,o={};r.options.styles&&(o.layers=r.options.styles.map(p=>p.id).filter(p=>r.map.getLayer(p)!=null));let a=r.map.queryRenderedFeatures(n,o).filter(p=>Bge.indexOf(p.properties.meta)!==-1),c=new jl,h=[];return a.forEach(p=>{let x=p.properties.id;c.has(x)||(c.add(x),h.push(p))}),HT(h)}function zA(t,e){let r=jc.click(t,null,e),i={mouse:un.NONE};return r[0]&&(i.mouse=r[0].properties.active===Fn.ACTIVE?un.MOVE:un.POINTER,i.feature=r[0].properties.meta),e.events.currentModeName().indexOf("draw")!==-1&&(i.mouse=un.ADD),e.ui.queueMapClasses(i),e.ui.updateMapClasses(),r[0]}function Tg(t,e){let r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}var Dge=4,Fge=12,kge=500;function Eg(t,e,r={}){let i=r.fineTolerance!=null?r.fineTolerance:Dge,n=r.grossTolerance!=null?r.grossTolerance:Fge,o=r.interval!=null?r.interval:kge;t.point=t.point||e.point,t.time=t.time||e.time;let a=Tg(t.point,e.point);return a<i||a<n&&e.time-t.time<o}var Nge=25,zge=250;function Cg(t,e,r={}){let i=r.tolerance!=null?r.tolerance:Nge,n=r.interval!=null?r.interval:zge;return t.point=t.point||e.point,t.time=t.time||e.time,Tg(t.point,e.point)<i&&e.time-t.time<n}var rW=(t,e=21)=>(r=e)=>{let i="",n=r|0;for(;n--;)i+=t[Math.random()*t.length|0];return i};var Uge=rW("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function Sg(){return Uge()}var jd=function(t,e){this.ctx=t,this.properties=e.properties||{},this.coordinates=e.geometry.coordinates,this.id=e.id||Sg(),this.type=e.geometry.type};jd.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};jd.prototype.incomingCoords=function(t){this.setCoordinates(t)};jd.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()};jd.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};jd.prototype.setProperty=function(t,e){this.properties[t]=e};jd.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:gr.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};jd.prototype.internal=function(t){let e={id:this.id,meta:Yn.FEATURE,"meta:type":this.type,active:Fn.INACTIVE,mode:t};if(this.ctx.options.userProperties)for(let r in this.properties)e[`user_${r}`]=this.properties[r];return{type:gr.FEATURE,properties:e,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Gl=jd;var a2=function(t,e){Gl.call(this,t,e)};a2.prototype=Object.create(Gl.prototype);a2.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};a2.prototype.updateCoordinate=function(t,e,r){arguments.length===3?this.coordinates=[e,r]:this.coordinates=[t,e],this.changed()};a2.prototype.getCoordinate=function(){return this.getCoordinates()};var UA=a2;var VA=function(t,e){Gl.call(this,t,e)};VA.prototype=Object.create(Gl.prototype);VA.prototype.isValid=function(){return this.coordinates.length>1};VA.prototype.addCoordinate=function(t,e,r){this.changed();let i=parseInt(t,10);this.coordinates.splice(i,0,[e,r])};VA.prototype.getCoordinate=function(t){let e=parseInt(t,10);return JSON.parse(JSON.stringify(this.coordinates[e]))};VA.prototype.removeCoordinate=function(t){this.changed(),this.coordinates.splice(parseInt(t,10),1)};VA.prototype.updateCoordinate=function(t,e,r){let i=parseInt(t,10);this.coordinates[i]=[e,r],this.changed()};var jA=VA;var Ju=function(t,e){Gl.call(this,t,e),this.coordinates=this.coordinates.map(r=>r.slice(0,-1))};Ju.prototype=Object.create(Gl.prototype);Ju.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(t=>t.length>2)};Ju.prototype.incomingCoords=function(t){this.coordinates=t.map(e=>e.slice(0,-1)),this.changed()};Ju.prototype.setCoordinates=function(t){this.coordinates=t,this.changed()};Ju.prototype.addCoordinate=function(t,e,r){this.changed();let i=t.split(".").map(o=>parseInt(o,10));this.coordinates[i[0]].splice(i[1],0,[e,r])};Ju.prototype.removeCoordinate=function(t){this.changed();let e=t.split(".").map(i=>parseInt(i,10)),r=this.coordinates[e[0]];r&&(r.splice(e[1],1),r.length<3&&this.coordinates.splice(e[0],1))};Ju.prototype.getCoordinate=function(t){let e=t.split(".").map(i=>parseInt(i,10)),r=this.coordinates[e[0]];return JSON.parse(JSON.stringify(r[e[1]]))};Ju.prototype.getCoordinates=function(){return this.coordinates.map(t=>t.concat([t[0]]))};Ju.prototype.updateCoordinate=function(t,e,r){this.changed();let i=t.split("."),n=parseInt(i[0],10),o=parseInt(i[1],10);this.coordinates[n]===void 0&&(this.coordinates[n]=[]),this.coordinates[n][o]=[e,r]};var GA=Ju;var Vge={MultiPoint:UA,MultiLineString:jA,MultiPolygon:GA},$T=(t,e,r,i,n)=>{let o=r.split("."),a=parseInt(o[0],10),c=o[1]?o.slice(1).join("."):null;return t[a][e](c,i,n)},Gc=function(t,e){if(Gl.call(this,t,e),delete this.coordinates,this.model=Vge[e.geometry.type],this.model===void 0)throw new TypeError(`${e.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(e.geometry.coordinates)};Gc.prototype=Object.create(Gl.prototype);Gc.prototype._coordinatesToFeatures=function(t){let e=this.model.bind(this);return t.map(r=>new e(this.ctx,{id:Sg(),type:gr.FEATURE,properties:{},geometry:{coordinates:r,type:this.type.replace("Multi","")}}))};Gc.prototype.isValid=function(){return this.features.every(t=>t.isValid())};Gc.prototype.setCoordinates=function(t){this.features=this._coordinatesToFeatures(t),this.changed()};Gc.prototype.getCoordinate=function(t){return $T(this.features,"getCoordinate",t)};Gc.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(t=>t.type===gr.POLYGON?t.getCoordinates():t.coordinates)))};Gc.prototype.updateCoordinate=function(t,e,r){$T(this.features,"updateCoordinate",t,e,r),this.changed()};Gc.prototype.addCoordinate=function(t,e,r){$T(this.features,"addCoordinate",t,e,r),this.changed()};Gc.prototype.removeCoordinate=function(t){$T(this.features,"removeCoordinate",t),this.changed()};Gc.prototype.getFeatures=function(){return this.features};var HA=Gc;function mi(t){this.map=t.map,this.drawConfig=JSON.parse(JSON.stringify(t.options||{})),this._ctx=t}mi.prototype.setSelected=function(t){return this._ctx.store.setSelected(t)};mi.prototype.setSelectedCoordinates=function(t){this._ctx.store.setSelectedCoordinates(t),t.reduce((e,r)=>(e[r.feature_id]===void 0&&(e[r.feature_id]=!0,this._ctx.store.get(r.feature_id).changed()),e),{})};mi.prototype.getSelected=function(){return this._ctx.store.getSelected()};mi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};mi.prototype.isSelected=function(t){return this._ctx.store.isSelected(t)};mi.prototype.getFeature=function(t){return this._ctx.store.get(t)};mi.prototype.select=function(t){return this._ctx.store.select(t)};mi.prototype.deselect=function(t){return this._ctx.store.deselect(t)};mi.prototype.deleteFeature=function(t,e={}){return this._ctx.store.delete(t,e)};mi.prototype.addFeature=function(t,e={}){return this._ctx.store.add(t,e)};mi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};mi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};mi.prototype.setActionableState=function(t={}){let e={trash:t.trash||!1,combineFeatures:t.combineFeatures||!1,uncombineFeatures:t.uncombineFeatures||!1};return this._ctx.events.actionable(e)};mi.prototype.changeMode=function(t,e={},r={}){return this._ctx.events.changeMode(t,e,r)};mi.prototype.fire=function(t,e){return this._ctx.events.fire(t,e)};mi.prototype.updateUIClasses=function(t){return this._ctx.ui.queueMapClasses(t)};mi.prototype.activateUIButton=function(t){return this._ctx.ui.setActiveButton(t)};mi.prototype.featuresAt=function(t,e,r="click"){if(r!=="click"&&r!=="touch")throw new Error("invalid buffer type");return jc[r](t,e,this._ctx)};mi.prototype.newFeature=function(t){let e=t.geometry.type;return e===gr.POINT?new UA(this._ctx,t):e===gr.LINE_STRING?new jA(this._ctx,t):e===gr.POLYGON?new GA(this._ctx,t):new HA(this._ctx,t)};mi.prototype.isInstanceOf=function(t,e){if(t===gr.POINT)return e instanceof UA;if(t===gr.LINE_STRING)return e instanceof jA;if(t===gr.POLYGON)return e instanceof GA;if(t==="MultiFeature")return e instanceof HA;throw new Error(`Unknown feature class: ${t}`)};mi.prototype.doRender=function(t){return this._ctx.store.featureChanged(t)};var iW=mi;mi.prototype.onSetup=function(){};mi.prototype.onDrag=function(){};mi.prototype.onClick=function(){};mi.prototype.onMouseMove=function(){};mi.prototype.onMouseDown=function(){};mi.prototype.onMouseUp=function(){};mi.prototype.onMouseOut=function(){};mi.prototype.onKeyUp=function(){};mi.prototype.onKeyDown=function(){};mi.prototype.onTouchStart=function(){};mi.prototype.onTouchMove=function(){};mi.prototype.onTouchEnd=function(){};mi.prototype.onTap=function(){};mi.prototype.onStop=function(){};mi.prototype.onTrash=function(){};mi.prototype.onCombineFeature=function(){};mi.prototype.onUncombineFeature=function(){};mi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var nW={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},jge=Object.keys(nW);function oW(t){let e=Object.keys(t);return function(r,i={}){let n={},o=e.reduce((c,h)=>(c[h]=t[h],c),new iW(r));function a(c){return h=>o[c](n,h)}return{start(){n=o.onSetup(i),jge.forEach(c=>{let h=nW[c],p=()=>!1;t[h]&&(p=()=>!0),this.on(c,p,a(h))})},stop(){o.onStop(n)},trash(){o.onTrash(n)},combineFeatures(){o.onCombineFeatures(n)},uncombineFeatures(){o.onUncombineFeatures(n)},render(c,h){o.toDisplayFeatures(n,c,h)}}}}function sW(t){let e=Object.keys(t.options.modes).reduce((R,k)=>(R[k]=oW(t.options.modes[k]),R),{}),r={},i={},n={},o=null,a=null;n.drag=function(R,k){k({point:R.point,time:new Date().getTime()})?(t.ui.queueMapClasses({mouse:un.DRAG}),a.drag(R)):R.originalEvent.stopPropagation()},n.mousedrag=function(R){n.drag(R,k=>!Eg(r,k))},n.touchdrag=function(R){n.drag(R,k=>!Cg(i,k))},n.mousemove=function(R){if((R.originalEvent.buttons!==void 0?R.originalEvent.buttons:R.originalEvent.which)===1)return n.mousedrag(R);let j=zA(R,t);R.featureTarget=j,a.mousemove(R)},n.mousedown=function(R){r={time:new Date().getTime(),point:R.point};let k=zA(R,t);R.featureTarget=k,a.mousedown(R)},n.mouseup=function(R){let k=zA(R,t);R.featureTarget=k,Eg(r,{point:R.point,time:new Date().getTime()})?a.click(R):a.mouseup(R)},n.mouseout=function(R){a.mouseout(R)},n.touchstart=function(R){if(!t.options.touchEnabled)return;i={time:new Date().getTime(),point:R.point};let k=jc.touch(R,null,t)[0];R.featureTarget=k,a.touchstart(R)},n.touchmove=function(R){if(t.options.touchEnabled)return a.touchmove(R),n.touchdrag(R)},n.touchend=function(R){if(R.originalEvent.preventDefault(),!t.options.touchEnabled)return;let k=jc.touch(R,null,t)[0];R.featureTarget=k,Cg(i,{time:new Date().getTime(),point:R.point})?a.tap(R):a.touchend(R)};let c=R=>!(R===8||R===46||R>=48&&R<=57);n.keydown=function(R){(R.srcElement||R.target).classList.contains(Ns.CANVAS)&&((R.keyCode===8||R.keyCode===46)&&t.options.controls.trash?(R.preventDefault(),a.trash()):c(R.keyCode)?a.keydown(R):R.keyCode===49&&t.options.controls.point?h(oi.DRAW_POINT):R.keyCode===50&&t.options.controls.line_string?h(oi.DRAW_LINE_STRING):R.keyCode===51&&t.options.controls.polygon&&h(oi.DRAW_POLYGON))},n.keyup=function(R){c(R.keyCode)&&a.keyup(R)},n.zoomend=function(){t.store.changeZoom()},n.data=function(R){if(R.dataType==="style"){let{setup:k,map:j,options:q,store:Z}=t;q.styles.some(ee=>j.getLayer(ee.id))||(k.addLayers(),Z.setDirty(),Z.render())}};function h(R,k,j={}){a.stop();let q=e[R];if(q===void 0)throw new Error(`${R} is not valid`);o=R;let Z=q(t,k);a=s2(Z,t),j.silent||t.map.fire(yo.MODE_CHANGE,{mode:R}),t.store.setDirty(),t.store.render()}let p={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function x(R){let k=!1;Object.keys(R).forEach(j=>{if(p[j]===void 0)throw new Error("Invalid action type");p[j]!==R[j]&&(k=!0),p[j]=R[j]}),k&&t.map.fire(yo.ACTIONABLE,{actions:p})}return{start(){o=t.options.defaultMode,a=s2(e[o](t),t)},changeMode:h,actionable:x,currentModeName(){return o},currentModeRender(R,k){return a.render(R,k)},fire(R,k){t.map&&t.map.fire(R,k)},addEventListeners(){t.map.on("mousemove",n.mousemove),t.map.on("mousedown",n.mousedown),t.map.on("mouseup",n.mouseup),t.map.on("data",n.data),t.map.on("touchmove",n.touchmove),t.map.on("touchstart",n.touchstart),t.map.on("touchend",n.touchend),t.container.addEventListener("mouseout",n.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",n.keydown),t.container.addEventListener("keyup",n.keyup))},removeEventListeners(){t.map.off("mousemove",n.mousemove),t.map.off("mousedown",n.mousedown),t.map.off("mouseup",n.mouseup),t.map.off("data",n.data),t.map.off("touchmove",n.touchmove),t.map.off("touchstart",n.touchstart),t.map.off("touchend",n.touchend),t.container.removeEventListener("mouseout",n.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",n.keydown),t.container.removeEventListener("keyup",n.keyup))},trash(R){a.trash(R)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode(){return o}}}function Gge(t){return[].concat(t).filter(e=>e!==void 0)}var WA=Gge;function J5(){let t=this;if(!(t.ctx.map&&t.ctx.map.getSource(pa.HOT)!==void 0))return h();let r=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:r});let i=[],n=[];t.isDirty?n=t.getAllIds():(i=t.getChangedIds().filter(p=>t.get(p)!==void 0),n=t.sources.hot.filter(p=>p.properties.id&&i.indexOf(p.properties.id)===-1&&t.get(p.properties.id)!==void 0).map(p=>p.properties.id)),t.sources.hot=[];let o=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(p=>{let x=p.properties.id||p.properties.parent;return i.indexOf(x)===-1});let a=o!==t.sources.cold.length||n.length>0;i.forEach(p=>c(p,"hot")),n.forEach(p=>c(p,"cold"));function c(p,x){let R=t.get(p).internal(r);t.ctx.events.currentModeRender(R,k=>{k.properties.mode=r,t.sources[x].push(k)})}a&&t.ctx.map.getSource(pa.COLD).setData({type:gr.FEATURE_COLLECTION,features:t.sources.cold}),t.ctx.map.getSource(pa.HOT).setData({type:gr.FEATURE_COLLECTION,features:t.sources.hot}),h();function h(){t.isDirty=!1,t.clearChangedIds()}}function Pn(t){this._features={},this._featureIds=new jl,this._selectedFeatureIds=new jl,this._selectedCoordinates=[],this._changedFeatureIds=new jl,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=t,this.sources={hot:[],cold:[]};let e;this.render=()=>{e||(e=requestAnimationFrame(()=>{e=null,J5.call(this),this._emitSelectionChange&&(this.ctx.events.fire(yo.SELECTION_CHANGE,{features:this.getSelected().map(r=>r.toGeoJSON()),points:this.getSelectedCoordinates().map(r=>({type:gr.FEATURE,properties:{},geometry:{type:gr.POINT,coordinates:r.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(yo.RENDER,{})}))},this.isDirty=!1}Pn.prototype.createRenderBatch=function(){let t=this.render,e=0;return this.render=function(){e++},()=>{this.render=t,e>0&&this.render()}};Pn.prototype.setDirty=function(){return this.isDirty=!0,this};Pn.prototype.featureCreated=function(t,e={}){if(this._changedFeatureIds.add(t),(e.silent!=null?e.silent:this.ctx.options.suppressAPIEvents)!==!0){let i=this.get(t);this.ctx.events.fire(yo.CREATE,{features:[i.toGeoJSON()]})}return this};Pn.prototype.featureChanged=function(t,e={}){return this._changedFeatureIds.add(t),(e.silent!=null?e.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(yo.UPDATE,{action:e.action?e.action:Vd.CHANGE_COORDINATES,features:[this.get(t).toGeoJSON()]}),this};Pn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};Pn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};Pn.prototype.getAllIds=function(){return this._featureIds.values()};Pn.prototype.add=function(t,e={}){return this._features[t.id]=t,this._featureIds.add(t.id),this.featureCreated(t.id,{silent:e.silent}),this};Pn.prototype.delete=function(t,e={}){let r=[];return WA(t).forEach(i=>{this._featureIds.has(i)&&(this._featureIds.delete(i),this._selectedFeatureIds.delete(i),e.silent||r.indexOf(this._features[i])===-1&&r.push(this._features[i].toGeoJSON()),delete this._features[i],this.isDirty=!0)}),r.length&&this.ctx.events.fire(yo.DELETE,{features:r}),aW(this,e),this};Pn.prototype.get=function(t){return this._features[t]};Pn.prototype.getAll=function(){return Object.keys(this._features).map(t=>this._features[t])};Pn.prototype.select=function(t,e={}){return WA(t).forEach(r=>{this._selectedFeatureIds.has(r)||(this._selectedFeatureIds.add(r),this._changedFeatureIds.add(r),e.silent||(this._emitSelectionChange=!0))}),this};Pn.prototype.deselect=function(t,e={}){return WA(t).forEach(r=>{this._selectedFeatureIds.has(r)&&(this._selectedFeatureIds.delete(r),this._changedFeatureIds.add(r),e.silent||(this._emitSelectionChange=!0))}),aW(this,e),this};Pn.prototype.clearSelected=function(t={}){return this.deselect(this._selectedFeatureIds.values(),{silent:t.silent}),this};Pn.prototype.setSelected=function(t,e={}){return t=WA(t),this.deselect(this._selectedFeatureIds.values().filter(r=>t.indexOf(r)===-1),{silent:e.silent}),this.select(t.filter(r=>!this._selectedFeatureIds.has(r)),{silent:e.silent}),this};Pn.prototype.setSelectedCoordinates=function(t){return this._selectedCoordinates=t,this._emitSelectionChange=!0,this};Pn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};Pn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};Pn.prototype.getSelected=function(){return this.getSelectedIds().map(t=>this.get(t))};Pn.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(e=>({coordinates:this.get(e.feature_id).getCoordinate(e.coord_path)}))};Pn.prototype.isSelected=function(t){return this._selectedFeatureIds.has(t)};Pn.prototype.setFeatureProperty=function(t,e,r,i={}){this.get(t).setProperty(e,r),this.featureChanged(t,{silent:i.silent,action:Vd.CHANGE_PROPERTIES})};function aW(t,e={}){let r=t._selectedCoordinates.filter(i=>t._selectedFeatureIds.has(i.feature_id));t._selectedCoordinates.length!==r.length&&!e.silent&&(t._emitSelectionChange=!0),t._selectedCoordinates=r}Pn.prototype.storeMapConfig=function(){Q5.forEach(t=>{this.ctx.map[t]&&(this._mapInitialConfig[t]=this.ctx.map[t].isEnabled())})};Pn.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(t=>{this._mapInitialConfig[t]?this.ctx.map[t].enable():this.ctx.map[t].disable()})};Pn.prototype.getInitialConfigValue=function(t){return this._mapInitialConfig[t]!==void 0?this._mapInitialConfig[t]:!0};var Hge=["mode","feature","mouse"];function lW(t){let e={},r=null,i={mode:null,feature:null,mouse:null},n={mode:null,feature:null,mouse:null};function o(){a({mode:null,feature:null,mouse:null}),c()}function a(k){n=Object.assign(n,k)}function c(){if(!t.container)return;let k=[],j=[];Hge.forEach(q=>{n[q]!==i[q]&&(k.push(`${q}-${i[q]}`),n[q]!==null&&j.push(`${q}-${n[q]}`))}),k.length>0&&t.container.classList.remove(...k),j.length>0&&t.container.classList.add(...j),i=Object.assign(i,n)}function h(k,j={}){let q=document.createElement("button");return q.className=`${Ns.CONTROL_BUTTON} ${j.className}`,q.setAttribute("title",j.title),j.container.appendChild(q),q.addEventListener("click",Z=>{if(Z.preventDefault(),Z.stopPropagation(),Z.target===r){p(),j.onDeactivate();return}x(k),j.onActivate()},!0),q}function p(){r&&(r.classList.remove(Ns.ACTIVE_BUTTON),r=null)}function x(k){p();let j=e[k];j&&j&&k!=="trash"&&(j.classList.add(Ns.ACTIVE_BUTTON),r=j)}function T(){let k=t.options.controls,j=document.createElement("div");return j.className=`${Ns.CONTROL_GROUP} ${Ns.CONTROL_BASE}`,k&&(k[ss.LINE]&&(e[ss.LINE]=h(ss.LINE,{container:j,className:Ns.CONTROL_BUTTON_LINE,title:`LineString tool ${t.options.keybindings?"(l)":""}`,onActivate:()=>t.events.changeMode(oi.DRAW_LINE_STRING),onDeactivate:()=>t.events.trash()})),k[ss.POLYGON]&&(e[ss.POLYGON]=h(ss.POLYGON,{container:j,className:Ns.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${t.options.keybindings?"(p)":""}`,onActivate:()=>t.events.changeMode(oi.DRAW_POLYGON),onDeactivate:()=>t.events.trash()})),k[ss.POINT]&&(e[ss.POINT]=h(ss.POINT,{container:j,className:Ns.CONTROL_BUTTON_POINT,title:`Marker tool ${t.options.keybindings?"(m)":""}`,onActivate:()=>t.events.changeMode(oi.DRAW_POINT),onDeactivate:()=>t.events.trash()})),k.trash&&(e.trash=h("trash",{container:j,className:Ns.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{t.events.trash()}})),k.combine_features&&(e.combine_features=h("combineFeatures",{container:j,className:Ns.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{t.events.combineFeatures()}})),k.uncombine_features&&(e.uncombine_features=h("uncombineFeatures",{container:j,className:Ns.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{t.events.uncombineFeatures()}}))),j}function R(){Object.keys(e).forEach(k=>{let j=e[k];j.parentNode&&j.parentNode.removeChild(j),delete e[k]})}return{setActiveButton:x,queueMapClasses:a,updateMapClasses:c,clearMapClasses:o,addButtons:T,removeButtons:R}}function cW(t){let e=null,r=null,i={onRemove(){return t.map.off("load",i.connect),clearInterval(r),i.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,e&&e.parentNode&&e.parentNode.removeChild(e),e=null,this},connect(){t.map.off("load",i.connect),clearInterval(r),i.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd(n){if(t.map=n,t.events=sW(t),t.ui=lW(t),t.container=n.getContainer(),t.store=new Pn(t),e=t.ui.addButtons(),t.options.boxSelect){t.boxZoomInitial=n.boxZoom.isEnabled(),n.boxZoom.disable();let o=n.dragPan.isEnabled();n.dragPan.disable(),n.dragPan.enable(),o||n.dragPan.disable()}return n.loaded()?i.connect():(n.on("load",i.connect),r=setInterval(()=>{n.loaded()&&i.connect()},16)),t.events.start(),e},addLayers(){t.map.addSource(pa.COLD,{data:{type:gr.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(pa.HOT,{data:{type:gr.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(n=>{t.map.addLayer(n)}),t.store.setDirty(!0),t.store.render()},removeLayers(){t.options.styles.forEach(n=>{t.map.getLayer(n.id)&&t.map.removeLayer(n.id)}),t.map.getSource(pa.COLD)&&t.map.removeSource(pa.COLD),t.map.getSource(pa.HOT)&&t.map.removeSource(pa.HOT)}};return t.setup=i,i}var eR="#3bb2d0",l2="#fbb03b",uW="#fff",qT=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],l2,eR],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],l2,eR],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":uW}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],l2,eR]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":uW}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":l2}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":l2}}];var XA={};no(XA,{isActiveFeature:()=>sf,isEnterKey:()=>ZA,isEscapeKey:()=>qA,isFeature:()=>XT,isInactiveFeature:()=>ZT,isOfMetaType:()=>Ig,isShiftDown:()=>Pg,isShiftMousedown:()=>tR,isTrue:()=>Wge,isVertex:()=>$A,noTarget:()=>Mg});function Ig(t){return function(e){let r=e.featureTarget;return!r||!r.properties?!1:r.properties.meta===t}}function tR(t){return!t.originalEvent||!t.originalEvent.shiftKey?!1:t.originalEvent.button===0}function sf(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.active===Fn.ACTIVE&&t.featureTarget.properties.meta===Yn.FEATURE}function ZT(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.active===Fn.INACTIVE&&t.featureTarget.properties.meta===Yn.FEATURE}function Mg(t){return t.featureTarget===void 0}function XT(t){return!t.featureTarget||!t.featureTarget.properties?!1:t.featureTarget.properties.meta===Yn.FEATURE}function $A(t){let e=t.featureTarget;return!e||!e.properties?!1:e.properties.meta===Yn.VERTEX}function Pg(t){return t.originalEvent?t.originalEvent.shiftKey===!0:!1}function qA(t){return t.keyCode===27}function ZA(t){return t.keyCode===13}function Wge(){return!0}function eh(t,e){this.x=t,this.y=e}eh.prototype={clone(){return new eh(this.x,this.y)},add(t){return this.clone()._add(t)},sub(t){return this.clone()._sub(t)},multByPoint(t){return this.clone()._multByPoint(t)},divByPoint(t){return this.clone()._divByPoint(t)},mult(t){return this.clone()._mult(t)},div(t){return this.clone()._div(t)},rotate(t){return this.clone()._rotate(t)},rotateAround(t,e){return this.clone()._rotateAround(t,e)},matMult(t){return this.clone()._matMult(t)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(t){return this.x===t.x&&this.y===t.y},dist(t){return Math.sqrt(this.distSqr(t))},distSqr(t){let e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith(t){return this.angleWithSep(t.x,t.y)},angleWithSep(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult(t){let e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add(t){return this.x+=t.x,this.y+=t.y,this},_sub(t){return this.x-=t.x,this.y-=t.y,this},_mult(t){return this.x*=t,this.y*=t,this},_div(t){return this.x/=t,this.y/=t,this},_multByPoint(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint(t){return this.x/=t.x,this.y/=t.y,this},_unit(){return this._div(this.mag()),this},_perp(){let t=this.y;return this.y=this.x,this.x=-t,this},_rotate(t){let e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround(t,e){let r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:eh};eh.convert=function(t){if(t instanceof eh)return t;if(Array.isArray(t))return new eh(+t[0],+t[1]);if(t.x!==void 0&&t.y!==void 0)return new eh(+t.x,+t.y);throw new Error("Expected [x, y] or {x, y} point format")};function $ge(t,e){let r=e.getBoundingClientRect();return new eh(t.clientX-r.left-(e.clientLeft||0),t.clientY-r.top-(e.clientTop||0))}var YT=$ge;function th(t,e,r,i){return{type:gr.FEATURE,properties:{meta:Yn.VERTEX,parent:t,coord_path:r,active:i?Fn.ACTIVE:Fn.INACTIVE},geometry:{type:gr.POINT,coordinates:e}}}function KT(t,e,r){let i=e.geometry.coordinates,n=r.geometry.coordinates;if(i[1]>GT||i[1]<jT||n[1]>GT||n[1]<jT)return null;let o={lng:(i[0]+n[0])/2,lat:(i[1]+n[1])/2};return{type:gr.FEATURE,properties:{meta:Yn.MIDPOINT,parent:t,lng:o.lng,lat:o.lat,coord_path:r.properties.coord_path},geometry:{type:gr.POINT,coordinates:[o.lng,o.lat]}}}function hW(t,e={},r=null){let{type:i,coordinates:n}=t.geometry,o=t.properties&&t.properties.id,a=[];i===gr.POINT?a.push(th(o,n,r,h(r))):i===gr.POLYGON?n.forEach((x,T)=>{c(x,r!==null?`${r}.${T}`:String(T))}):i===gr.LINE_STRING?c(n,r):i.indexOf(gr.MULTI_PREFIX)===0&&p();function c(x,T){let R="",k=null;x.forEach((j,q)=>{let Z=T!=null?`${T}.${q}`:String(q),re=th(o,j,Z,h(Z));if(e.midpoints&&k){let se=KT(o,k,re);se&&a.push(se)}k=re;let ee=JSON.stringify(j);R!==ee&&a.push(re),q===0&&(R=ee)})}function h(x){return e.selectedPaths?e.selectedPaths.indexOf(x)!==-1:!1}function p(){let x=i.replace(gr.MULTI_PREFIX,"");n.forEach((T,R)=>{let k={type:gr.FEATURE,properties:t.properties,geometry:{type:x,coordinates:T}};a=a.concat(hW(k,e,R))})}return a}var Rg=hW;var Qs={enable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||!t._ctx||!t._ctx.store||!t._ctx.store.getInitialConfigValue||t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()},0)},disable(t){setTimeout(()=>{!t.map||!t.map.doubleClickZoom||t.map.doubleClickZoom.disable()},0)}};var{LAT_MIN:QT,LAT_MAX:JT,LAT_RENDERED_MIN:fW,LAT_RENDERED_MAX:dW,LNG_MIN:pW,LNG_MAX:AW}=Mn;function qge(t){let e={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[t.geometry.type],r=[t.geometry.coordinates].flat(e),i=r.map(c=>c[0]),n=r.map(c=>c[1]),o=c=>Math.min.apply(null,c),a=c=>Math.max.apply(null,c);return[o(i),o(n),a(i),a(n)]}function Bg(t,e){let r=QT,i=JT,n=QT,o=JT,a=AW,c=pW;t.forEach(p=>{let x=qge(p),T=x[1],R=x[3],k=x[0],j=x[2];T>r&&(r=T),R<i&&(i=R),R>n&&(n=R),T<o&&(o=T),k<a&&(a=k),j>c&&(c=j)});let h=e;return r+h.lat>dW&&(h.lat=dW-r),n+h.lat>JT&&(h.lat=JT-n),i+h.lat<fW&&(h.lat=fW-i),o+h.lat<QT&&(h.lat=QT-o),a+h.lng<=pW&&(h.lng+=Math.ceil(Math.abs(h.lng)/360)*360),c+h.lng>=AW&&(h.lng-=Math.ceil(Math.abs(h.lng)/360)*360),h}function Lg(t,e){let r=Bg(t.map(i=>i.toGeoJSON()),e);t.forEach(i=>{let n=i.getCoordinates(),o=p=>{let x={lng:p[0]+r.lng,lat:p[1]+r.lat};return[x.lng,x.lat]},a=p=>p.map(x=>o(x)),c=p=>p.map(x=>a(x)),h;i.type===gr.POINT?h=o(n):i.type===gr.LINE_STRING||i.type===gr.MULTI_POINT?h=n.map(o):i.type===gr.POLYGON||i.type===gr.MULTI_LINE_STRING?h=n.map(a):i.type===gr.MULTI_POLYGON&&(h=n.map(c)),i.incomingCoords(h)})}var kn={};kn.onSetup=function(t){let e={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:t.featureIds||[]};return this.setSelected(e.initiallySelectedFeatureIds.filter(r=>this.getFeature(r)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),e};kn.fireUpdate=function(){this.fire(yo.UPDATE,{action:Vd.MOVE,features:this.getSelected().map(t=>t.toGeoJSON())})};kn.fireActionable=function(){let t=this.getSelected(),e=t.filter(o=>this.isInstanceOf("MultiFeature",o)),r=!1;if(t.length>1){r=!0;let o=t[0].type.replace("Multi","");t.forEach(a=>{a.type.replace("Multi","")!==o&&(r=!1)})}let i=e.length>0,n=t.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:i,trash:n})};kn.getUniqueIds=function(t){return t.length?t.map(r=>r.properties.id).filter(r=>r!==void 0).reduce((r,i)=>(r.add(i),r),new jl).values():[]};kn.stopExtendedInteractions=function(t){t.boxSelectElement&&(t.boxSelectElement.parentNode&&t.boxSelectElement.parentNode.removeChild(t.boxSelectElement),t.boxSelectElement=null),(t.canDragMove||t.canBoxSelect)&&t.initialDragPanState===!0&&this.map.dragPan.enable(),t.boxSelecting=!1,t.canBoxSelect=!1,t.dragMoving=!1,t.canDragMove=!1};kn.onStop=function(){Qs.enable(this)};kn.onMouseMove=function(t,e){return XT(e)&&t.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(t),!0};kn.onMouseOut=function(t){return t.dragMoving?this.fireUpdate():!0};kn.onTap=kn.onClick=function(t,e){if(Mg(e))return this.clickAnywhere(t,e);if(Ig(Yn.VERTEX)(e))return this.clickOnVertex(t,e);if(XT(e))return this.clickOnFeature(t,e)};kn.clickAnywhere=function(t){let e=this.getSelectedIds();e.length&&(this.clearSelectedFeatures(),e.forEach(r=>this.doRender(r))),Qs.enable(this),this.stopExtendedInteractions(t)};kn.clickOnVertex=function(t,e){this.changeMode(oi.DIRECT_SELECT,{featureId:e.featureTarget.properties.parent,coordPath:e.featureTarget.properties.coord_path,startPos:e.lngLat}),this.updateUIClasses({mouse:un.MOVE})};kn.startOnActiveFeature=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),this.doRender(e.featureTarget.properties.id),t.canDragMove=!0,t.dragMoveLocation=e.lngLat};kn.clickOnFeature=function(t,e){Qs.disable(this),this.stopExtendedInteractions(t);let r=Pg(e),i=this.getSelectedIds(),n=e.featureTarget.properties.id,o=this.isSelected(n);if(!r&&o&&this.getFeature(n).type!==gr.POINT)return this.changeMode(oi.DIRECT_SELECT,{featureId:n});o&&r?(this.deselect(n),this.updateUIClasses({mouse:un.POINTER}),i.length===1&&Qs.enable(this)):!o&&r?(this.select(n),this.updateUIClasses({mouse:un.MOVE})):!o&&!r&&(i.forEach(a=>this.doRender(a)),this.setSelected(n),this.updateUIClasses({mouse:un.MOVE})),this.doRender(n)};kn.onMouseDown=function(t,e){if(t.initialDragPanState=this.map.dragPan.isEnabled(),sf(e))return this.startOnActiveFeature(t,e);if(this.drawConfig.boxSelect&&tR(e))return this.startBoxSelect(t,e)};kn.startBoxSelect=function(t,e){this.stopExtendedInteractions(t),this.map.dragPan.disable(),t.boxSelectStartLocation=YT(e.originalEvent,this.map.getContainer()),t.canBoxSelect=!0};kn.onTouchStart=function(t,e){if(sf(e))return this.startOnActiveFeature(t,e)};kn.onDrag=function(t,e){if(t.canDragMove)return this.dragMove(t,e);if(this.drawConfig.boxSelect&&t.canBoxSelect)return this.whileBoxSelect(t,e)};kn.whileBoxSelect=function(t,e){t.boxSelecting=!0,this.updateUIClasses({mouse:un.ADD}),t.boxSelectElement||(t.boxSelectElement=document.createElement("div"),t.boxSelectElement.classList.add(Ns.BOX_SELECT),this.map.getContainer().appendChild(t.boxSelectElement));let r=YT(e.originalEvent,this.map.getContainer()),i=Math.min(t.boxSelectStartLocation.x,r.x),n=Math.max(t.boxSelectStartLocation.x,r.x),o=Math.min(t.boxSelectStartLocation.y,r.y),a=Math.max(t.boxSelectStartLocation.y,r.y),c=`translate(${i}px, ${o}px)`;t.boxSelectElement.style.transform=c,t.boxSelectElement.style.WebkitTransform=c,t.boxSelectElement.style.width=`${n-i}px`,t.boxSelectElement.style.height=`${a-o}px`};kn.dragMove=function(t,e){t.dragMoving=!0,e.originalEvent.stopPropagation();let r={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};Lg(this.getSelected(),r),t.dragMoveLocation=e.lngLat};kn.onTouchEnd=kn.onMouseUp=function(t,e){if(t.dragMoving)this.fireUpdate();else if(t.boxSelecting){let r=[t.boxSelectStartLocation,YT(e.originalEvent,this.map.getContainer())],i=this.featuresAt(null,r,"click"),n=this.getUniqueIds(i).filter(o=>!this.isSelected(o));n.length&&(this.select(n),n.forEach(o=>this.doRender(o)),this.updateUIClasses({mouse:un.MOVE}))}this.stopExtendedInteractions(t)};kn.toDisplayFeatures=function(t,e,r){e.properties.active=this.isSelected(e.properties.id)?Fn.ACTIVE:Fn.INACTIVE,r(e),this.fireActionable(),!(e.properties.active!==Fn.ACTIVE||e.geometry.type===gr.POINT)&&Rg(e).forEach(r)};kn.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};kn.onCombineFeatures=function(){let t=this.getSelected();if(t.length===0||t.length<2)return;let e=[],r=[],i=t[0].type.replace("Multi","");for(let n=0;n<t.length;n++){let o=t[n];if(o.type.replace("Multi","")!==i)return;o.type.includes("Multi")?o.getCoordinates().forEach(a=>{e.push(a)}):e.push(o.getCoordinates()),r.push(o.toGeoJSON())}if(r.length>1){let n=this.newFeature({type:gr.FEATURE,properties:r[0].properties,geometry:{type:`Multi${i}`,coordinates:e}});this.addFeature(n),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([n.id]),this.fire(yo.COMBINE_FEATURES,{createdFeatures:[n.toGeoJSON()],deletedFeatures:r})}this.fireActionable()};kn.onUncombineFeatures=function(){let t=this.getSelected();if(t.length===0)return;let e=[],r=[];for(let i=0;i<t.length;i++){let n=t[i];this.isInstanceOf("MultiFeature",n)&&(n.getFeatures().forEach(o=>{this.addFeature(o),o.properties=n.properties,e.push(o.toGeoJSON()),this.select([o.id])}),this.deleteFeature(n.id,{silent:!0}),r.push(n.toGeoJSON()))}e.length>1&&this.fire(yo.UNCOMBINE_FEATURES,{createdFeatures:e,deletedFeatures:r}),this.fireActionable()};var mW=kn;var gW=Ig(Yn.VERTEX),_W=Ig(Yn.MIDPOINT),Nn={};Nn.fireUpdate=function(){this.fire(yo.UPDATE,{action:Vd.CHANGE_COORDINATES,features:this.getSelected().map(t=>t.toGeoJSON())})};Nn.fireActionable=function(t){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:t.selectedCoordPaths.length>0})};Nn.startDragging=function(t,e){t.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),t.canDragMove=!0,t.dragMoveLocation=e.lngLat};Nn.stopDragging=function(t){t.canDragMove&&t.initialDragPanState===!0&&this.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.dragMoveLocation=null};Nn.onVertex=function(t,e){this.startDragging(t,e);let r=e.featureTarget.properties,i=t.selectedCoordPaths.indexOf(r.coord_path);!Pg(e)&&i===-1?t.selectedCoordPaths=[r.coord_path]:Pg(e)&&i===-1&&t.selectedCoordPaths.push(r.coord_path);let n=this.pathsToCoordinates(t.featureId,t.selectedCoordPaths);this.setSelectedCoordinates(n)};Nn.onMidpoint=function(t,e){this.startDragging(t,e);let r=e.featureTarget.properties;t.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),t.selectedCoordPaths=[r.coord_path]};Nn.pathsToCoordinates=function(t,e){return e.map(r=>({feature_id:t,coord_path:r}))};Nn.onFeature=function(t,e){t.selectedCoordPaths.length===0?this.startDragging(t,e):this.stopDragging(t)};Nn.dragFeature=function(t,e,r){Lg(this.getSelected(),r),t.dragMoveLocation=e.lngLat};Nn.dragVertex=function(t,e,r){let i=t.selectedCoordPaths.map(a=>t.feature.getCoordinate(a)),n=i.map(a=>({type:gr.FEATURE,properties:{},geometry:{type:gr.POINT,coordinates:a}})),o=Bg(n,r);for(let a=0;a<i.length;a++){let c=i[a];t.feature.updateCoordinate(t.selectedCoordPaths[a],c[0]+o.lng,c[1]+o.lat)}};Nn.clickNoTarget=function(){this.changeMode(oi.SIMPLE_SELECT)};Nn.clickInactive=function(){this.changeMode(oi.SIMPLE_SELECT)};Nn.clickActiveFeature=function(t){t.selectedCoordPaths=[],this.clearSelectedCoordinates(),t.feature.changed()};Nn.onSetup=function(t){let e=t.featureId,r=this.getFeature(e);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===gr.POINT)throw new TypeError("direct_select mode doesn't handle point features");let i={featureId:e,feature:r,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(e,i.selectedCoordPaths)),this.setSelected(e),Qs.disable(this),this.setActionableState({trash:!0}),i};Nn.onStop=function(){Qs.enable(this),this.clearSelectedCoordinates()};Nn.toDisplayFeatures=function(t,e,r){t.featureId===e.properties.id?(e.properties.active=Fn.ACTIVE,r(e),Rg(e,{map:this.map,midpoints:!0,selectedPaths:t.selectedCoordPaths}).forEach(r)):(e.properties.active=Fn.INACTIVE,r(e)),this.fireActionable(t)};Nn.onTrash=function(t){t.selectedCoordPaths.sort((e,r)=>r.localeCompare(e,"en",{numeric:!0})).forEach(e=>t.feature.removeCoordinate(e)),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),t.feature.isValid()===!1&&(this.deleteFeature([t.featureId]),this.changeMode(oi.SIMPLE_SELECT,{}))};Nn.onMouseMove=function(t,e){let r=sf(e),i=gW(e),n=_W(e),o=t.selectedCoordPaths.length===0;return r&&o?this.updateUIClasses({mouse:un.MOVE}):i&&!o?this.updateUIClasses({mouse:un.MOVE}):this.updateUIClasses({mouse:un.NONE}),(i||r||n)&&t.dragMoving&&this.fireUpdate(),this.stopDragging(t),!0};Nn.onMouseOut=function(t){return t.dragMoving&&this.fireUpdate(),!0};Nn.onTouchStart=Nn.onMouseDown=function(t,e){if(gW(e))return this.onVertex(t,e);if(sf(e))return this.onFeature(t,e);if(_W(e))return this.onMidpoint(t,e)};Nn.onDrag=function(t,e){if(t.canDragMove!==!0)return;t.dragMoving=!0,e.originalEvent.stopPropagation();let r={lng:e.lngLat.lng-t.dragMoveLocation.lng,lat:e.lngLat.lat-t.dragMoveLocation.lat};t.selectedCoordPaths.length>0?this.dragVertex(t,e,r):this.dragFeature(t,e,r),t.dragMoveLocation=e.lngLat};Nn.onClick=function(t,e){if(Mg(e))return this.clickNoTarget(t,e);if(sf(e))return this.clickActiveFeature(t,e);if(ZT(e))return this.clickInactive(t,e);this.stopDragging(t)};Nn.onTap=function(t,e){if(Mg(e))return this.clickNoTarget(t,e);if(sf(e))return this.clickActiveFeature(t,e);if(ZT(e))return this.clickInactive(t,e)};Nn.onTouchEnd=Nn.onMouseUp=function(t){t.dragMoving&&this.fireUpdate(),this.stopDragging(t)};var yW=Nn;var rh={};rh.onSetup=function(){let t=this.newFeature({type:gr.FEATURE,properties:{},geometry:{type:gr.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:un.ADD}),this.activateUIButton(ss.POINT),this.setActionableState({trash:!0}),{point:t}};rh.stopDrawingAndRemove=function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(oi.SIMPLE_SELECT)};rh.onTap=rh.onClick=function(t,e){this.updateUIClasses({mouse:un.MOVE}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.fire(yo.CREATE,{features:[t.point.toGeoJSON()]}),this.changeMode(oi.SIMPLE_SELECT,{featureIds:[t.point.id]})};rh.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})};rh.toDisplayFeatures=function(t,e,r){let i=e.properties.id===t.point.id;if(e.properties.active=i?Fn.ACTIVE:Fn.INACTIVE,!i)return r(e)};rh.onTrash=rh.stopDrawingAndRemove;rh.onKeyUp=function(t,e){if(qA(e)||ZA(e))return this.stopDrawingAndRemove(t,e)};var xW=rh;function Zge(t,e){return t.lngLat?t.lngLat.lng===e[0]&&t.lngLat.lat===e[1]:!1}var YA=Zge;var Hc={};Hc.onSetup=function(){let t=this.newFeature({type:gr.FEATURE,properties:{},geometry:{type:gr.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),Qs.disable(this),this.updateUIClasses({mouse:un.ADD}),this.activateUIButton(ss.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};Hc.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&YA(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(oi.SIMPLE_SELECT,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:un.ADD}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)};Hc.clickOnVertex=function(t){return this.changeMode(oi.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};Hc.onMouseMove=function(t,e){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),$A(e)&&this.updateUIClasses({mouse:un.POINTER})};Hc.onTap=Hc.onClick=function(t,e){return $A(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)};Hc.onKeyUp=function(t,e){qA(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(oi.SIMPLE_SELECT)):ZA(e)&&this.changeMode(oi.SIMPLE_SELECT,{featureIds:[t.polygon.id]})};Hc.onStop=function(t){this.updateUIClasses({mouse:un.NONE}),Qs.enable(this),this.activateUIButton(),this.getFeature(t.polygon.id)!==void 0&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.fire(yo.CREATE,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(oi.SIMPLE_SELECT,{},{silent:!0})))};Hc.toDisplayFeatures=function(t,e,r){let i=e.properties.id===t.polygon.id;if(e.properties.active=i?Fn.ACTIVE:Fn.INACTIVE,!i)return r(e);if(e.geometry.coordinates.length===0)return;let n=e.geometry.coordinates[0].length;if(!(n<3)){if(e.properties.meta=Yn.FEATURE,r(th(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),n>3){let o=e.geometry.coordinates[0].length-3;r(th(t.polygon.id,e.geometry.coordinates[0][o],`0.${o}`,!1))}if(n<=4){let o=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(r({type:gr.FEATURE,properties:e.properties,geometry:{coordinates:o,type:gr.LINE_STRING}}),n===3)return}return r(e)}};Hc.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(oi.SIMPLE_SELECT)};var bW=Hc;var Wc={};Wc.onSetup=function(t){t=t||{};let e=t.featureId,r,i,n="forward";if(e){if(r=this.getFeature(e),!r)throw new Error("Could not find a feature with the provided featureId");let o=t.from;if(o&&o.type==="Feature"&&o.geometry&&o.geometry.type==="Point"&&(o=o.geometry),o&&o.type==="Point"&&o.coordinates&&o.coordinates.length===2&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");let a=r.coordinates.length-1;if(r.coordinates[a][0]===o[0]&&r.coordinates[a][1]===o[1])i=a+1,r.addCoordinate(i,...r.coordinates[a]);else if(r.coordinates[0][0]===o[0]&&r.coordinates[0][1]===o[1])n="backwards",i=0,r.addCoordinate(i,...r.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else r=this.newFeature({type:gr.FEATURE,properties:{},geometry:{type:gr.LINE_STRING,coordinates:[]}}),i=0,this.addFeature(r);return this.clearSelectedFeatures(),Qs.disable(this),this.updateUIClasses({mouse:un.ADD}),this.activateUIButton(ss.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:i,direction:n}};Wc.clickAnywhere=function(t,e){if(t.currentVertexPosition>0&&YA(e,t.line.coordinates[t.currentVertexPosition-1])||t.direction==="backwards"&&YA(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(oi.SIMPLE_SELECT,{featureIds:[t.line.id]});this.updateUIClasses({mouse:un.ADD}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),t.direction==="forward"?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)};Wc.clickOnVertex=function(t){return this.changeMode(oi.SIMPLE_SELECT,{featureIds:[t.line.id]})};Wc.onMouseMove=function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),$A(e)&&this.updateUIClasses({mouse:un.POINTER})};Wc.onTap=Wc.onClick=function(t,e){if($A(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)};Wc.onKeyUp=function(t,e){ZA(e)?this.changeMode(oi.SIMPLE_SELECT,{featureIds:[t.line.id]}):qA(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(oi.SIMPLE_SELECT))};Wc.onStop=function(t){Qs.enable(this),this.activateUIButton(),this.getFeature(t.line.id)!==void 0&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.fire(yo.CREATE,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(oi.SIMPLE_SELECT,{},{silent:!0})))};Wc.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(oi.SIMPLE_SELECT)};Wc.toDisplayFeatures=function(t,e,r){let i=e.properties.id===t.line.id;if(e.properties.active=i?Fn.ACTIVE:Fn.INACTIVE,!i)return r(e);e.geometry.coordinates.length<2||(e.properties.meta=Yn.FEATURE,r(th(t.line.id,e.geometry.coordinates[t.direction==="forward"?e.geometry.coordinates.length-2:1],`${t.direction==="forward"?e.geometry.coordinates.length-2:1}`,!1)),r(e))};var vW=Wc;var eE={simple_select:mW,direct_select:yW,draw_point:xW,draw_polygon:bW,draw_line_string:vW};var Xge={defaultMode:oi.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:qT,modes:eE,controls:{},userProperties:!1,suppressAPIEvents:!0},Yge={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Kge={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function wW(t,e){return t.map(r=>r.source?r:Object.assign({},r,{id:`${r.id}.${e}`,source:e==="hot"?pa.HOT:pa.COLD}))}function TW(t={}){let e=Object.assign({},t);return t.controls||(e.controls={}),t.displayControlsDefault===!1?e.controls=Object.assign({},Kge,t.controls):e.controls=Object.assign({},Yge,t.controls),e=Object.assign({},Xge,e),e.styles=wW(e.styles,"cold").concat(wW(e.styles,"hot")),e}var rR=yc(CW(),1),MW=yc(IW(),1);function tE(t,e){return t.length!==e.length?!1:JSON.stringify(t.map(r=>r).sort())===JSON.stringify(e.map(r=>r).sort())}var e_e={Polygon:GA,LineString:jA,Point:UA,MultiPolygon:HA,MultiLineString:HA,MultiPoint:HA};function PW(t,e){e.modes=oi;let r=t.options.suppressAPIEvents!==void 0?!!t.options.suppressAPIEvents:!0;return e.getFeatureIdsAt=function(i){return jc.click({point:i},null,t).map(o=>o.properties.id)},e.getSelectedIds=function(){return t.store.getSelectedIds()},e.getSelected=function(){return{type:gr.FEATURE_COLLECTION,features:t.store.getSelectedIds().map(i=>t.store.get(i)).map(i=>i.toGeoJSON())}},e.getSelectedPoints=function(){return{type:gr.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map(i=>({type:gr.FEATURE,properties:{},geometry:{type:gr.POINT,coordinates:i.coordinates}}))}},e.set=function(i){if(i.type===void 0||i.type!==gr.FEATURE_COLLECTION||!Array.isArray(i.features))throw new Error("Invalid FeatureCollection");let n=t.store.createRenderBatch(),o=t.store.getAllIds().slice(),a=e.add(i),c=new jl(a);return o=o.filter(h=>!c.has(h)),o.length&&e.delete(o),n(),a},e.add=function(i){let o=JSON.parse(JSON.stringify((0,MW.default)(i))).features.map(a=>{if(a.id=a.id||Sg(),a.geometry===null)throw new Error("Invalid geometry: null");if(t.store.get(a.id)===void 0||t.store.get(a.id).type!==a.geometry.type){let c=e_e[a.geometry.type];if(c===void 0)throw new Error(`Invalid geometry type: ${a.geometry.type}.`);let h=new c(t,a);t.store.add(h,{silent:r})}else{let c=t.store.get(a.id),h=c.properties;c.properties=a.properties,(0,rR.default)(h,a.properties)||t.store.featureChanged(c.id,{silent:r}),(0,rR.default)(c.getCoordinates(),a.geometry.coordinates)||c.incomingCoords(a.geometry.coordinates)}return a.id});return t.store.render(),o},e.get=function(i){let n=t.store.get(i);if(n)return n.toGeoJSON()},e.getAll=function(){return{type:gr.FEATURE_COLLECTION,features:t.store.getAll().map(i=>i.toGeoJSON())}},e.delete=function(i){return t.store.delete(i,{silent:r}),e.getMode()===oi.DIRECT_SELECT&&!t.store.getSelectedIds().length?t.events.changeMode(oi.SIMPLE_SELECT,void 0,{silent:r}):t.store.render(),e},e.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:r}),e.getMode()===oi.DIRECT_SELECT?t.events.changeMode(oi.SIMPLE_SELECT,void 0,{silent:r}):t.store.render(),e},e.changeMode=function(i,n={}){return i===oi.SIMPLE_SELECT&&e.getMode()===oi.SIMPLE_SELECT?(tE(n.featureIds||[],t.store.getSelectedIds())||(t.store.setSelected(n.featureIds,{silent:r}),t.store.render()),e):(i===oi.DIRECT_SELECT&&e.getMode()===oi.DIRECT_SELECT&&n.featureId===t.store.getSelectedIds()[0]||t.events.changeMode(i,n,{silent:r}),e)},e.getMode=function(){return t.events.getMode()},e.trash=function(){return t.events.trash({silent:r}),e},e.combineFeatures=function(){return t.events.combineFeatures({silent:r}),e},e.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:r}),e},e.setFeatureProperty=function(i,n,o){return t.store.setFeatureProperty(i,n,o,{silent:r}),e},e}var iR={};no(iR,{CommonSelectors:()=>XA,ModeHandler:()=>s2,StringSet:()=>jl,constrainFeatureMovement:()=>Bg,createMidPoint:()=>KT,createSupplementaryPoints:()=>Rg,createVertex:()=>th,doubleClickZoom:()=>Qs,euclideanDistance:()=>Tg,featuresAt:()=>jc,getFeatureAtAndSetCursors:()=>zA,isClick:()=>Eg,isEventAtCoordinates:()=>YA,isTap:()=>Cg,mapEventToBoundingBox:()=>WT,moveFeatures:()=>Lg,sortFeatures:()=>HT,stringSetsAreEqual:()=>tE,theme:()=>qT,toDenseArray:()=>WA});var t_e=function(t,e){t=TW(t);let r={options:t};e=PW(r,e),r.api=e;let i=cW(r);return e.onAdd=i.onAdd,e.onRemove=i.onRemove,e.types=ss,e.options=t,e};function rE(t){t_e(t,this)}rE.modes=eE;rE.constants=Mn;rE.lib=iR;var c2=rE;c2.constants.classes.CONTROL_BASE="maplibregl-ctrl";c2.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-";c2.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";var RW=c2;var BW=function(t,e,r,i){function n(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function c(x){try{p(i.next(x))}catch(T){a(T)}}function h(x){try{p(i.throw(x))}catch(T){a(T)}}function p(x){x.done?o(x.value):n(x.value).then(c,h)}p((i=i.apply(t,e||[])).next())})},r_e=new K6;Og.default.addProtocol("pmtiles",r_e.tile);Og.default.MapTilerGeocodingControl=Z2;var i_e=["addControl","addImage","addTooltip","addMapboxOverlay","setCenterFromPMTiles","fitBoundsFromPMTiles"];function n_e(t,e){let r=t.properties;return e?F6.render(e,r):Object.keys(r).map(i=>`${i}: ${r[i]}`).join("</br>")}var u2=class{constructor(e,r,i){this._model=i,r.container=e,this._map=new Og.default.Map(r)}getMap(){return this._map}getElement(){return this._map.getContainer()}getAnywidgetModel(){return this._model}executeCall(e,r){if(i_e.includes(e)){this[e](...r);return}if(this._map[e]instanceof Function){this._map[e](...r);return}console.log("NOT IMPLEMENTED")}addControl(e,r,i){if(e==="MapboxDraw"){console.log("Add MapnoxDraw"),this._map.addControl(new RW(r),i);return}this._map.addControl(new Og.default[e](r),i)}addImage(e,r,i){return BW(this,void 0,void 0,function*(){let n=yield this._map.loadImage(r);this._map.addImage(e,n.data,i)})}addTooltip(e,r){let i=new Og.default.Popup({closeButton:!1,closeOnClick:!1});this._map.on("mousemove",e,n=>{let o=n.features[0],a=n_e(o,r);i.setLngLat(n.lngLat).setHTML(a).addTo(this._map)}),this._map.on("mouseleave",e,()=>{i.remove()})}addMapboxOverlay(e){let r=e.map(i=>qH.convert(i));if(this._mapboxOverlay!==void 0){console.log("Update layers"),this._mapboxOverlay.setProps({layers:r});return}console.log("Create MapboxOverlay"),this._mapboxOverlay=new dA({interleaved:!0,layers:r}),this._map.addControl(this._mapboxOverlay)}setCenterFromPMTilesOld(e){new N0(e).getHeader().then(i=>{this._map.setZoom(i.maxZoom-2),this._map.setCenter([i.centerLon,i.centerLat])})}setCenterFromPMTiles(e){return BW(this,arguments,void 0,function*(r,i=2){let o=yield new N0(r).getHeader();this._map.setZoom(o.maxZoom-i),this._map.setCenter([o.centerLon,o.centerLat])})}fitBoundsFromPMTiles(e){new N0(e).getHeader().then(i=>{let n=[i.minLon,i.minLat,i.maxLon,i.maxLat];this._map.fitBounds(n)})}};function o_e({model:t,el:e}){console.log("Welcome to maplibre-anywidget v2",e);let r=t.get("height")||"400px",i=document.createElement("div");i.id="maplibre-anywidget",i.style.height=r,i.style.width="100%",e.appendChild(i);let n=t.get("map_options"),o=window.anywidgetMapWidget=new u2(i,n,t),a=o.getMap(),c=()=>t.get("calls"),h=()=>t.get("msg");t.on("change:msg",()=>{let p=h();console.log("run",p);let[x,T]=p;o.executeCall(x,T)}),a.on("load",()=>{console.log("map loaded"),a.resize(),t.set("load",!0),t.save_changes();for(let p of c()){console.log("init call",p);let[x,T]=p;o.executeCall(x,T)}})}var Nit={render:o_e};export{Nit as default};
/*! Bundled license information:

maplibre-gl/dist/maplibre-gl.js:
  (**
   * MapLibre GL JS
   * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.3.1/LICENSE.txt
   *)

long/dist/long.js:
  (**
   * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
   * Released under the Apache License, Version 2.0
   * see: https://github.com/dcodeIO/long.js for details
   *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)

long/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
