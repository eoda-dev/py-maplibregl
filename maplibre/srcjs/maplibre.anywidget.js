var iW=Object.create;var CT=Object.defineProperty;var nW=Object.getOwnPropertyDescriptor;var sW=Object.getOwnPropertyNames;var oW=Object.getPrototypeOf,aW=Object.prototype.hasOwnProperty;var dR=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Gs=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Ms=(r,e)=>{for(var t in e)CT(r,t,{get:e[t],enumerable:!0})},lW=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of sW(e))!aW.call(r,n)&&n!==t&&CT(r,n,{get:()=>e[n],enumerable:!(i=nW(e,n))||i.enumerable});return r};var Tf=(r,e,t)=>(t=r!=null?iW(oW(r)):{},lW(e||!r||!r.__esModule?CT(t,"default",{value:r,enumerable:!0}):t,r));var MT=Gs((IT,PT)=>{(function(r,e){typeof IT=="object"&&typeof PT<"u"?PT.exports=e():typeof define=="function"&&define.amd?define(e):(r=typeof globalThis<"u"?globalThis:r||self,r.maplibregl=e())})(IT,function(){"use strict";var r={},e={};function t(n,s,a){if(e[n]=a,n==="index"){var c="var sharedModule = {}; ("+e.shared+")(sharedModule); ("+e.worker+")(sharedModule);",d={};return e.shared(d),e.index(r,d),typeof window<"u"&&r.setWorkerUrl(window.URL.createObjectURL(new Blob([c],{type:"text/javascript"}))),r}}t("shared",["exports"],function(n){"use strict";function s(h,l,f,g){return new(f||(f=Promise))(function(w,I){function M(j){try{U(g.next(j))}catch($){I($)}}function D(j){try{U(g.throw(j))}catch($){I($)}}function U(j){var $;j.done?w(j.value):($=j.value,$ instanceof f?$:new f(function(Y){Y($)})).then(M,D)}U((g=g.apply(h,l||[])).next())})}function a(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var c,d;function p(){if(d)return c;function h(l,f){this.x=l,this.y=f}return d=1,c=h,h.prototype={clone:function(){return new h(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,f){return this.clone()._rotateAround(l,f)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var f=l.x-this.x,g=l.y-this.y;return f*f+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,f){return Math.atan2(this.x*f-this.y*l,this.x*l+this.y*f)},_matMult:function(l){var f=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=f,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var f=Math.cos(l),g=Math.sin(l),w=g*this.x+f*this.y;return this.x=f*this.x-g*this.y,this.y=w,this},_rotateAround:function(l,f){var g=Math.cos(l),w=Math.sin(l),I=f.y+w*(this.x-f.x)+g*(this.y-f.y);return this.x=f.x+g*(this.x-f.x)-w*(this.y-f.y),this.y=I,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(l){return l instanceof h?l:Array.isArray(l)?new h(l[0],l[1]):l},c}typeof SuppressedError=="function"&&SuppressedError;var b,T,B=a(p()),z=function(){if(T)return b;function h(l,f,g,w){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(w-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=f,this.p2x=g,this.p2y=w}return T=1,b=h,h.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,f){if(f===void 0&&(f=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,w=0;w<8;w++){var I=this.sampleCurveX(g)-l;if(Math.abs(I)<f)return g;var M=this.sampleCurveDerivativeX(g);if(Math.abs(M)<1e-6)break;g-=I/M}var D=0,U=1;for(g=l,w=0;w<20&&(I=this.sampleCurveX(g),!(Math.abs(I-l)<f));w++)l>I?D=g:U=g,g=.5*(U-D)+D;return g},solve:function(l,f){return this.sampleCurveY(this.solveCurveX(l,f))}},b}(),G=a(z);let Z,q;function re(){return Z==null&&(Z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Z}function ee(){if(q==null&&(q=!1,re())){let l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let g=0;g<5*5;g++){let w=4*g;l.fillStyle=`rgb(${w},${w+1},${w+2})`,l.fillRect(g%5,Math.floor(g/5),1,1)}let f=l.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&f[g]!==g){q=!0;break}}}return q||!1}var ae,me=1e-6,Le=typeof Float32Array<"u"?Float32Array:Array;function je(){var h=new Le(9);return Le!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h}function Je(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function J(){var h=new Le(3);return Le!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function te(h,l,f){var g=new Le(3);return g[0]=h,g[1]=l,g[2]=f,g}function X(h,l,f){var g=l[0],w=l[1],I=l[2],M=l[3];return h[0]=f[0]*g+f[4]*w+f[8]*I+f[12]*M,h[1]=f[1]*g+f[5]*w+f[9]*I+f[13]*M,h[2]=f[2]*g+f[6]*w+f[10]*I+f[14]*M,h[3]=f[3]*g+f[7]*w+f[11]*I+f[15]*M,h}function ye(){var h=new Le(4);return Le!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h[3]=1,h}function _e(){var h=new Le(2);return Le!=Float32Array&&(h[0]=0,h[1]=0),h}function Oe(h,l){var f=new Le(2);return f[0]=h,f[1]=l,f}Math.hypot||(Math.hypot=function(){for(var h=0,l=arguments.length;l--;)h+=arguments[l]*arguments[l];return Math.sqrt(h)}),J(),ae=new Le(4),Le!=Float32Array&&(ae[0]=0,ae[1]=0,ae[2]=0,ae[3]=0),J(),te(1,0,0),te(0,1,0),ye(),ye(),je(),_e();let ve=8192;function De(h,l,f){return l*(ve/(h.tileSize*Math.pow(2,f-h.tileID.overscaledZ)))}function Xe(h,l){return(h%l+l)%l}function rt(h,l,f){return h*(1-f)+l*f}function tt(h){if(h<=0)return 0;if(h>=1)return 1;let l=h*h,f=l*h;return 4*(h<.5?f:3*(h-l)+f-.75)}function yt(h,l,f,g){let w=new G(h,l,f,g);return I=>w.solve(I)}let Xt=yt(.25,.1,.25,1);function jt(h,l,f){return Math.min(f,Math.max(l,h))}function fr(h,l,f){let g=f-l,w=((h-l)%g+g)%g+l;return w===l?f:w}function qt(h,...l){for(let f of l)for(let g in f)h[g]=f[g];return h}let Ot=1;function wr(h,l,f){let g={};for(let w in h)g[w]=l.call(this,h[w],w,h);return g}function Lr(h,l,f){let g={};for(let w in h)l.call(this,h[w],w,h)&&(g[w]=h[w]);return g}function Or(h){return Array.isArray(h)?h.map(Or):typeof h=="object"&&h?wr(h,Or):h}let Zr={};function Oi(h){Zr[h]||(typeof console<"u"&&console.warn(h),Zr[h]=!0)}function Jr(h,l,f){return(f.y-h.y)*(l.x-h.x)>(l.y-h.y)*(f.x-h.x)}function Ri(h){return typeof WorkerGlobalScope<"u"&&h!==void 0&&h instanceof WorkerGlobalScope}let li=null;function Qi(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}let Di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ni(h,l,f,g,w){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let I=new VideoFrame(h,{timestamp:0});try{let M=I?.format;if(!M||!M.startsWith("BGR")&&!M.startsWith("RGB"))throw new Error(`Unrecognized format ${M}`);let D=M.startsWith("BGR"),U=new Uint8ClampedArray(g*w*4);if(yield I.copyTo(U,function(j,$,Y,se,le){let ue=4*Math.max(1,0),pe=(Math.max(0,Y)-Y)*se*4+ue,Te=4*se,Re=Math.max(0,$),et=Math.max(0,Y);return{rect:{x:Re,y:et,width:Math.min(j.width,$+se)-Re,height:Math.min(j.height,Y+le)-et},layout:[{offset:pe,stride:Te}]}}(h,l,f,g,w)),D)for(let j=0;j<U.length;j+=4){let $=U[j];U[j]=U[j+2],U[j+2]=$}return U}finally{I.close()}})}let fo,Ds;function Kn(h,l,f,g){return h.addEventListener(l,f,g),{unsubscribe:()=>{h.removeEventListener(l,f,g)}}}function ks(h){return h/Math.PI*180}let ea={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},os={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Zs="AbortError";function as(){return new Error(Zs)}let Vr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jt(h){return Vr.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))]}let Ft="global-dispatcher";class Tr extends Error{constructor(l,f,g,w){super(`AJAXError: ${f} (${l}): ${g}`),this.status=l,this.statusText=f,this.url=g,this.body=w}}let si=()=>Ri(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ir=function(h,l){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){let g=Jt(h.url);if(g)return g(h,l);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,targetMapId:Ft},l)}if(!(/^file:/.test(f=h.url)||/^file:/.test(si())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,w){return s(this,void 0,void 0,function*(){let I=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:si(),signal:w.signal}),M,D;g.type!=="json"||I.headers.has("Accept")||I.headers.set("Accept","application/json");try{M=yield fetch(I)}catch(j){throw new Tr(0,j.message,g.url,new Blob)}if(!M.ok){let j=yield M.blob();throw new Tr(M.status,M.statusText,g.url,j)}D=g.type==="arrayBuffer"||g.type==="image"?M.arrayBuffer():g.type==="json"?M.json():M.text();let U=yield D;if(w.signal.aborted)throw as();return{data:U,cacheControl:M.headers.get("Cache-Control"),expires:M.headers.get("Expires")}})}(h,l);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:h,mustQueue:!0,targetMapId:Ft},l)}var f;return function(g,w){return new Promise((I,M)=>{var D;let U=new XMLHttpRequest;U.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(U.responseType="arraybuffer");for(let j in g.headers)U.setRequestHeader(j,g.headers[j]);g.type==="json"&&(U.responseType="text",!((D=g.headers)===null||D===void 0)&&D.Accept||U.setRequestHeader("Accept","application/json")),U.withCredentials=g.credentials==="include",U.onerror=()=>{M(new Error(U.statusText))},U.onload=()=>{if(!w.signal.aborted)if((U.status>=200&&U.status<300||U.status===0)&&U.response!==null){let j=U.response;if(g.type==="json")try{j=JSON.parse(U.response)}catch($){return void M($)}I({data:j,cacheControl:U.getResponseHeader("Cache-Control"),expires:U.getResponseHeader("Expires")})}else{let j=new Blob([U.response],{type:U.getResponseHeader("Content-Type")});M(new Tr(U.status,U.statusText,g.url,j))}},w.signal.addEventListener("abort",()=>{U.abort(),M(as())}),U.send(g.body)})}(h,l)};function $i(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;let l=new URL(h),f=window.location;return l.protocol===f.protocol&&l.host===f.host}function Qn(h,l,f){f[h]&&f[h].indexOf(l)!==-1||(f[h]=f[h]||[],f[h].push(l))}function Mn(h,l,f){if(f&&f[h]){let g=f[h].indexOf(l);g!==-1&&f[h].splice(g,1)}}class ot{constructor(l,f={}){qt(this,f),this.type=l}}class de extends ot{constructor(l,f={}){super("error",qt({error:l},f))}}class ge{on(l,f){return this._listeners=this._listeners||{},Qn(l,f,this._listeners),{unsubscribe:()=>{this.off(l,f)}}}off(l,f){return Mn(l,f,this._listeners),Mn(l,f,this._oneTimeListeners),this}once(l,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},Qn(l,f,this._oneTimeListeners),this):new Promise(g=>this.once(l,g))}fire(l,f){typeof l=="string"&&(l=new ot(l,f||{}));let g=l.type;if(this.listens(g)){l.target=this;let w=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(let D of w)D.call(this,l);let I=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(let D of I)Mn(g,D,this._oneTimeListeners),D.call(this,l);let M=this._eventedParent;M&&(qt(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(l))}else l instanceof de&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,f){return this._eventedParent=l,this._eventedParentData=f,this}}var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let ze=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ye(h,l){let f={};for(let g in h)g!=="ref"&&(f[g]=h[g]);return ze.forEach(g=>{g in l&&(f[g]=l[g])}),f}function Ke(h,l){if(Array.isArray(h)){if(!Array.isArray(l)||h.length!==l.length)return!1;for(let f=0;f<h.length;f++)if(!Ke(h[f],l[f]))return!1;return!0}if(typeof h=="object"&&h!==null&&l!==null){if(typeof l!="object"||Object.keys(h).length!==Object.keys(l).length)return!1;for(let f in h)if(!Ke(h[f],l[f]))return!1;return!0}return h===l}function dt(h,l){h.push(l)}function it(h,l,f){dt(f,{command:"addSource",args:[h,l[h]]})}function Bt(h,l,f){dt(l,{command:"removeSource",args:[h]}),f[h]=!0}function Pt(h,l,f,g){Bt(h,f,g),it(h,l,f)}function ut(h,l,f){let g;for(g in h[f])if(Object.prototype.hasOwnProperty.call(h[f],g)&&g!=="data"&&!Ke(h[f][g],l[f][g]))return!1;for(g in l[f])if(Object.prototype.hasOwnProperty.call(l[f],g)&&g!=="data"&&!Ke(h[f][g],l[f][g]))return!1;return!0}function zt(h,l,f,g,w,I){h=h||{},l=l||{};for(let M in h)Object.prototype.hasOwnProperty.call(h,M)&&(Ke(h[M],l[M])||f.push({command:I,args:[g,M,l[M],w]}));for(let M in l)Object.prototype.hasOwnProperty.call(l,M)&&!Object.prototype.hasOwnProperty.call(h,M)&&(Ke(h[M],l[M])||f.push({command:I,args:[g,M,l[M],w]}))}function rr(h){return h.id}function nr(h,l){return h[l.id]=l,h}class We{constructor(l,f,g,w){this.message=(l?`${l}: `:"")+g,w&&(this.identifier=w),f!=null&&f.__line__&&(this.line=f.__line__)}}function Dr(h,...l){for(let f of l)for(let g in f)h[g]=f[g];return h}class Er extends Error{constructor(l,f){super(f),this.message=f,this.key=l}}class kr{constructor(l,f=[]){this.parent=l,this.bindings={};for(let[g,w]of f)this.bindings[g]=w}concat(l){return new kr(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}let pi={kind:"null"},Gt={kind:"number"},dr={kind:"string"},tr={kind:"boolean"},zr={kind:"color"},mn={kind:"projectionDefinition"},ta={kind:"object"},Pr={kind:"value"},Vn={kind:"collator"},Ji={kind:"formatted"},Ru={kind:"padding"},Cl={kind:"resolvedImage"},St={kind:"variableAnchorOffsetCollection"};function Xr(h,l){return{kind:"array",itemType:h,N:l}}function ri(h){if(h.kind==="array"){let l=ri(h.itemType);return typeof h.N=="number"?`array<${l}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${l}>`}return h.kind}let Fs=[pi,Gt,dr,tr,zr,mn,Ji,ta,Xr(Pr),Ru,Cl,St];function jn(h,l){if(l.kind==="error")return null;if(h.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!jn(h.itemType,l.itemType))&&(typeof h.N!="number"||h.N===l.N))return null}else{if(h.kind===l.kind)return null;if(h.kind==="value"){for(let f of Fs)if(!jn(f,l))return null}}return`Expected ${ri(h)} but found ${ri(l)} instead.`}function po(h,l){return l.some(f=>f.kind===h.kind)}function Jn(h,l){return l.some(f=>f==="null"?h===null:f==="array"?Array.isArray(h):f==="object"?h&&!Array.isArray(h)&&typeof h=="object":f===typeof h)}function xi(h,l){return h.kind==="array"&&l.kind==="array"?h.itemType.kind===l.itemType.kind&&typeof h.N=="number":h.kind===l.kind}let Il=.96422,Xs=.82521,Bu=4/29,Ys=6/29,Lh=3*Ys*Ys,Tc=Ys*Ys*Ys,Ad=Math.PI/180,ba=180/Math.PI;function Pl(h){return(h%=360)<0&&(h+=360),h}function Gn([h,l,f,g]){let w,I,M=hA((.2225045*(h=Ec(h))+.7168786*(l=Ec(l))+.0606169*(f=Ec(f)))/1);h===l&&l===f?w=I=M:(w=hA((.4360747*h+.3850649*l+.1430804*f)/Il),I=hA((.0139322*h+.0971045*l+.7141733*f)/Xs));let D=116*M-16;return[D<0?0:D,500*(w-M),200*(M-I),g]}function Ec(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function hA(h){return h>Tc?Math.pow(h,1/3):h/Lh+Bu}function Fm([h,l,f,g]){let w=(h+16)/116,I=isNaN(l)?w:w+l/500,M=isNaN(f)?w:w-f/200;return w=1*md(w),I=Il*md(I),M=Xs*md(M),[fA(3.1338561*I-1.6168667*w-.4906146*M),fA(-.9787684*I+1.9161415*w+.033454*M),fA(.0719453*I-.2289914*w+1.4052427*M),g]}function fA(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function md(h){return h>Ys?h*h*h:Lh*(h-Bu)}function Oh(h){return parseInt(h.padEnd(2,h),16)/255}function ra(h,l){return ci(l?h/100:h,0,1)}function ci(h,l,f){return Math.min(Math.max(l,h),f)}function Sc(h){return!h.some(Number.isNaN)}let Ml={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Za(h,l,f){return h+f*(l-h)}function Lu(h,l,f){return h.map((g,w)=>Za(g,l[w],f))}class bi{constructor(l,f,g,w=1,I=!0){this.r=l,this.g=f,this.b=g,this.a=w,I||(this.r*=w,this.g*=w,this.b*=w,w||this.overwriteGetter("rgb",[l,f,g,w]))}static parse(l){if(l instanceof bi)return l;if(typeof l!="string")return;let f=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];let w=Ml[g];if(w){let[M,D,U]=w;return[M/255,D/255,U/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){let M=g.length<6?1:2,D=1;return[Oh(g.slice(D,D+=M)),Oh(g.slice(D,D+=M)),Oh(g.slice(D,D+=M)),Oh(g.slice(D,D+M)||"ff")]}if(g.startsWith("rgb")){let M=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){let[D,U,j,$,Y,se,le,ue,pe,Te,Re,et]=M,Ne=[$||" ",le||" ",Te].join("");if(Ne==="  "||Ne==="  /"||Ne===",,"||Ne===",,,"){let oe=[j,se,pe].join(""),xe=oe==="%%%"?100:oe===""?255:0;if(xe){let He=[ci(+U/xe,0,1),ci(+Y/xe,0,1),ci(+ue/xe,0,1),Re?ra(+Re,et):1];if(Sc(He))return He}}return}}let I=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(I){let[M,D,U,j,$,Y,se,le,ue]=I,pe=[U||" ",$||" ",se].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){let Te=[+D,ci(+j,0,100),ci(+Y,0,100),le?ra(+le,ue):1];if(Sc(Te))return function([Re,et,Ne,oe]){function xe(He){let xt=(He+Re/30)%12,Ht=et*Math.min(Ne,1-Ne);return Ne-Ht*Math.max(-1,Math.min(xt-3,9-xt,1))}return Re=Pl(Re),et/=100,Ne/=100,[xe(0),xe(8),xe(4),oe]}(Te)}}}(l);return f?new bi(...f,!1):void 0}get rgb(){let{r:l,g:f,b:g,a:w}=this,I=w||1/0;return this.overwriteGetter("rgb",[l/I,f/I,g/I,w])}get hcl(){return this.overwriteGetter("hcl",function(l){let[f,g,w,I]=Gn(l),M=Math.sqrt(g*g+w*w);return[Math.round(1e4*M)?Pl(Math.atan2(w,g)*ba):NaN,M,f,I]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Gn(this.rgb))}overwriteGetter(l,f){return Object.defineProperty(this,l,{value:f}),f}toString(){let[l,f,g,w]=this.rgb;return`rgba(${[l,f,g].map(I=>Math.round(255*I)).join(",")},${w})`}static interpolate(l,f,g,w="rgb"){switch(w){case"rgb":{let[I,M,D,U]=Lu(l.rgb,f.rgb,g);return new bi(I,M,D,U,!1)}case"hcl":{let[I,M,D,U]=l.hcl,[j,$,Y,se]=f.hcl,le,ue;if(isNaN(I)||isNaN(j))isNaN(I)?isNaN(j)?le=NaN:(le=j,D!==1&&D!==0||(ue=$)):(le=I,Y!==1&&Y!==0||(ue=M));else{let Ne=j-I;j>I&&Ne>180?Ne-=360:j<I&&I-j>180&&(Ne+=360),le=I+g*Ne}let[pe,Te,Re,et]=function([Ne,oe,xe,He]){return Ne=isNaN(Ne)?0:Ne*Ad,Fm([xe,Math.cos(Ne)*oe,Math.sin(Ne)*oe,He])}([le,ue??Za(M,$,g),Za(D,Y,g),Za(U,se,g)]);return new bi(pe,Te,Re,et,!1)}case"lab":{let[I,M,D,U]=Fm(Lu(l.lab,f.lab,g));return new bi(I,M,D,U,!1)}}}}bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1);class zo{constructor(l,f,g){this.sensitivity=l?f?"variant":"case":f?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,f){return this.collator.compare(l,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let Dh=["bottom","center","top"];class Ou{constructor(l,f,g,w,I,M){this.text=l,this.image=f,this.scale=g,this.fontStack=w,this.textColor=I,this.verticalAlign=M}}class Ks{constructor(l){this.sections=l}static fromString(l){return new Ks([new Ou(l,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof Ks?l:Ks.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class vs{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof vs)return l;if(typeof l=="number")return new vs([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(let f of l)if(typeof f!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new vs(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,f,g){return new vs(Lu(l.values,f.values,g))}}class gn{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}let gd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qs{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Qs)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let f=0;f<l.length;f+=2){let g=l[f],w=l[f+1];if(typeof g!="string"||!gd.has(g)||!Array.isArray(w)||w.length!==2||typeof w[0]!="number"||typeof w[1]!="number")return}return new Qs(l)}}toString(){return JSON.stringify(this.values)}static interpolate(l,f,g){let w=l.values,I=f.values;if(w.length!==I.length)throw new gn(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${f.toString()}`);let M=[];for(let D=0;D<w.length;D+=2){if(w[D]!==I[D])throw new gn(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${w[D]}, to[${D}]: ${I[D]}`);M.push(w[D]);let[U,j]=w[D+1],[$,Y]=I[D+1];M.push([Za(U,$,g),Za(j,Y,g)])}return new Qs(M)}}class Ao{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Ao({name:l,available:!1}):null}}class es{constructor(l,f,g){this.from=l,this.to=f,this.transition=g}static interpolate(l,f,g){return new es(l,f,g)}static parse(l){return l instanceof es?l:Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"?new es(l[0],l[1],l[2]):typeof l=="object"&&typeof l.from=="string"&&typeof l.to=="string"&&typeof l.transition=="number"?new es(l.from,l.to,l.transition):typeof l=="string"?new es(l,l,1):void 0}}function Nm(h,l,f,g){return typeof h=="number"&&h>=0&&h<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof f=="number"&&f>=0&&f<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[h,l,f,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[h,l,f,g]:[h,l,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rl(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof es||h instanceof bi||h instanceof zo||h instanceof Ks||h instanceof vs||h instanceof Qs||h instanceof Ao)return!0;if(Array.isArray(h)){for(let l of h)if(!Rl(l))return!1;return!0}if(typeof h=="object"){for(let l in h)if(!Rl(h[l]))return!1;return!0}return!1}function _n(h){if(h===null)return pi;if(typeof h=="string")return dr;if(typeof h=="boolean")return tr;if(typeof h=="number")return Gt;if(h instanceof bi)return zr;if(h instanceof es)return mn;if(h instanceof zo)return Vn;if(h instanceof Ks)return Ji;if(h instanceof vs)return Ru;if(h instanceof Qs)return St;if(h instanceof Ao)return Cl;if(Array.isArray(h)){let l=h.length,f;for(let g of h){let w=_n(g);if(f){if(f===w)continue;f=Pr;break}f=w}return Xr(f||Pr,l)}return ta}function Du(h){let l=typeof h;return h===null?"":l==="string"||l==="number"||l==="boolean"?String(h):h instanceof bi||h instanceof es||h instanceof Ks||h instanceof vs||h instanceof Qs||h instanceof Ao?h.toString():JSON.stringify(h)}class Bl{constructor(l,f){this.type=l,this.value=f}static parse(l,f){if(l.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Rl(l[1]))return f.error("invalid value");let g=l[1],w=_n(g),I=f.expectedType;return w.kind!=="array"||w.N!==0||!I||I.kind!=="array"||typeof I.N=="number"&&I.N!==0||(w=I),new Bl(w,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let kh={string:dr,number:Gt,boolean:tr,object:ta};class mo{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let g,w=1,I=l[0];if(I==="array"){let D,U;if(l.length>2){let j=l[1];if(typeof j!="string"||!(j in kh)||j==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);D=kh[j],w++}else D=Pr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return f.error('The length argument to "array" must be a positive integer literal',2);U=l[2],w++}g=Xr(D,U)}else{if(!kh[I])throw new Error(`Types doesn't contain name = ${I}`);g=kh[I]}let M=[];for(;w<l.length;w++){let D=f.parse(l[w],w,Pr);if(!D)return null;M.push(D)}return new mo(g,M)}evaluate(l){for(let f=0;f<this.args.length;f++){let g=this.args[f].evaluate(l);if(!jn(this.type,_n(g)))return g;if(f===this.args.length-1)throw new gn(`Expected value to be of type ${ri(this.type)}, but found ${ri(_n(g))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let fn={"to-boolean":tr,"to-color":zr,"to-number":Gt,"to-string":dr};class va{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let g=l[0];if(!fn[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&l.length!==2)return f.error("Expected one argument.");let w=fn[g],I=[];for(let M=1;M<l.length;M++){let D=f.parse(l[M],M,Pr);if(!D)return null;I.push(D)}return new va(w,I)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let f,g;for(let w of this.args){if(f=w.evaluate(l),g=null,f instanceof bi)return f;if(typeof f=="string"){let I=l.parseColor(f);if(I)return I}else if(Array.isArray(f)&&(g=f.length<3||f.length>4?`Invalid rgba value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:Nm(f[0],f[1],f[2],f[3]),!g))return new bi(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new gn(g||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(let g of this.args){f=g.evaluate(l);let w=vs.parse(f);if(w)return w}throw new gn(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(let g of this.args){f=g.evaluate(l);let w=Qs.parse(f);if(w)return w}throw new gn(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(let g of this.args){if(f=g.evaluate(l),f===null)return 0;let w=Number(f);if(!isNaN(w))return w}throw new gn(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return Ks.fromString(Du(this.args[0].evaluate(l)));case"resolvedImage":return Ao.fromString(Du(this.args[0].evaluate(l)));case"projectionDefinition":return this.args[0].evaluate(l);default:return Du(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}let Bi=["Unknown","Point","LineString","Polygon"];class ei{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Bi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let f=this._parseColorCache[l];return f||(f=this._parseColorCache[l]=bi.parse(l)),f}}class ku{constructor(l,f,g=[],w,I=new kr,M=[]){this.registry=l,this.path=g,this.key=g.map(D=>`[${D}]`).join(""),this.scope=I,this.errors=M,this.expectedType=w,this._isConstant=f}parse(l,f,g,w,I={}){return f?this.concat(f,g,w)._parse(l,I):this._parse(l,I)}_parse(l,f){function g(w,I,M){return M==="assert"?new mo(I,[w]):M==="coerce"?new va(I,[w]):w}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let w=l[0];if(typeof w!="string")return this.error(`Expression name must be a string, but found ${typeof w} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let I=this.registry[w];if(I){let M=I.parse(l,this);if(!M)return null;if(this.expectedType){let D=this.expectedType,U=M.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||U.kind!=="value")if(D.kind!=="projectionDefinition"||U.kind!=="string"&&U.kind!=="array")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||U.kind!=="value"&&U.kind!=="string")if(D.kind!=="padding"||U.kind!=="value"&&U.kind!=="number"&&U.kind!=="array")if(D.kind!=="variableAnchorOffsetCollection"||U.kind!=="value"&&U.kind!=="array"){if(this.checkSubtype(D,U))return null}else M=g(M,D,f.typeAnnotation||"coerce");else M=g(M,D,f.typeAnnotation||"coerce");else M=g(M,D,f.typeAnnotation||"coerce");else M=g(M,D,f.typeAnnotation||"coerce");else M=g(M,D,f.typeAnnotation||"assert")}if(!(M instanceof Bl)&&M.type.kind!=="resolvedImage"&&this._isConstant(M)){let D=new ei;try{M=new Bl(M.type,M.evaluate(D))}catch(U){return this.error(U.message),null}}return M}return this.error(`Unknown expression "${w}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,f,g){let w=typeof l=="number"?this.path.concat(l):this.path,I=g?this.scope.concat(g):this.scope;return new ku(this.registry,this._isConstant,w,f||null,I,this.errors)}error(l,...f){let g=`${this.key}${f.map(w=>`[${w}]`).join("")}`;this.errors.push(new Er(g,l))}checkSubtype(l,f){let g=jn(l,f);return g&&this.error(g),g}}class _i{constructor(l,f){this.type=f.type,this.bindings=[].concat(l),this.result=f}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(let f of this.bindings)l(f[1]);l(this.result)}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);let g=[];for(let I=1;I<l.length-1;I+=2){let M=l[I];if(typeof M!="string")return f.error(`Expected string, but found ${typeof M} instead.`,I);if(/[^a-zA-Z0-9_]/.test(M))return f.error("Variable names must contain only alphanumeric characters or '_'.",I);let D=f.parse(l[I+1],I+1);if(!D)return null;g.push([M,D])}let w=f.parse(l[l.length-1],l.length-1,f.expectedType,g);return w?new _i(g,w):null}outputDefined(){return this.result.outputDefined()}}class Fu{constructor(l,f){this.type=f.type,this.name=l,this.boundExpression=f}static parse(l,f){if(l.length!==2||typeof l[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");let g=l[1];return f.scope.has(g)?new Fu(g,f.scope.get(g)):f.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class ia{constructor(l,f,g){this.type=l,this.index=f,this.input=g}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=f.parse(l[1],1,Gt),w=f.parse(l[2],2,Xr(f.expectedType||Pr));return g&&w?new ia(w.type.itemType,g,w):null}evaluate(l){let f=this.index.evaluate(l),g=this.input.evaluate(l);if(f<0)throw new gn(`Array index out of bounds: ${f} < 0.`);if(f>=g.length)throw new gn(`Array index out of bounds: ${f} > ${g.length-1}.`);if(f!==Math.floor(f))throw new gn(`Array index must be an integer, but found ${f} instead.`);return g[f]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Fh{constructor(l,f){this.type=tr,this.needle=l,this.haystack=f}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);let g=f.parse(l[1],1,Pr),w=f.parse(l[2],2,Pr);return g&&w?po(g.type,[tr,dr,Gt,pi,Pr])?new Fh(g,w):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(g.type)} instead`):null}evaluate(l){let f=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!g)return!1;if(!Jn(f,["boolean","string","number","null"]))throw new gn(`Expected first argument to be of type boolean, string, number or null, but found ${ri(_n(f))} instead.`);if(!Jn(g,["string","array"]))throw new gn(`Expected second argument to be of type array or string, but found ${ri(_n(g))} instead.`);return g.indexOf(f)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class Nh{constructor(l,f,g){this.type=Gt,this.needle=l,this.haystack=f,this.fromIndex=g}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=f.parse(l[1],1,Pr),w=f.parse(l[2],2,Pr);if(!g||!w)return null;if(!po(g.type,[tr,dr,Gt,pi,Pr]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(g.type)} instead`);if(l.length===4){let I=f.parse(l[3],3,Gt);return I?new Nh(g,w,I):null}return new Nh(g,w)}evaluate(l){let f=this.needle.evaluate(l),g=this.haystack.evaluate(l);if(!Jn(f,["boolean","string","number","null"]))throw new gn(`Expected first argument to be of type boolean, string, number or null, but found ${ri(_n(f))} instead.`);let w;if(this.fromIndex&&(w=this.fromIndex.evaluate(l)),Jn(g,["string"])){let I=g.indexOf(f,w);return I===-1?-1:[...g.slice(0,I)].length}if(Jn(g,["array"]))return g.indexOf(f,w);throw new gn(`Expected second argument to be of type array or string, but found ${ri(_n(g))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class _d{constructor(l,f,g,w,I,M){this.inputType=l,this.type=f,this.input=g,this.cases=w,this.outputs=I,this.otherwise=M}static parse(l,f){if(l.length<5)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return f.error("Expected an even number of arguments.");let g,w;f.expectedType&&f.expectedType.kind!=="value"&&(w=f.expectedType);let I={},M=[];for(let j=2;j<l.length-1;j+=2){let $=l[j],Y=l[j+1];Array.isArray($)||($=[$]);let se=f.concat(j);if($.length===0)return se.error("Expected at least one branch label.");for(let ue of $){if(typeof ue!="number"&&typeof ue!="string")return se.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ue=="number"&&Math.floor(ue)!==ue)return se.error("Numeric branch labels must be integer values.");if(g){if(se.checkSubtype(g,_n(ue)))return null}else g=_n(ue);if(I[String(ue)]!==void 0)return se.error("Branch labels must be unique.");I[String(ue)]=M.length}let le=f.parse(Y,j,w);if(!le)return null;w=w||le.type,M.push(le)}let D=f.parse(l[1],1,Pr);if(!D)return null;let U=f.parse(l[l.length-1],l.length-1,w);return U?D.type.kind!=="value"&&f.concat(1).checkSubtype(g,D.type)?null:new _d(g,w,D,I,M,U):null}evaluate(l){let f=this.input.evaluate(l);return(_n(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class zh{constructor(l,f,g){this.type=l,this.branches=f,this.otherwise=g}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return f.error("Expected an odd number of arguments.");let g;f.expectedType&&f.expectedType.kind!=="value"&&(g=f.expectedType);let w=[];for(let M=1;M<l.length-1;M+=2){let D=f.parse(l[M],M,tr);if(!D)return null;let U=f.parse(l[M+1],M+1,g);if(!U)return null;w.push([D,U]),g=g||U.type}let I=f.parse(l[l.length-1],l.length-1,g);if(!I)return null;if(!g)throw new Error("Can't infer output type");return new zh(g,w,I)}evaluate(l){for(let[f,g]of this.branches)if(f.evaluate(l))return g.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(let[f,g]of this.branches)l(f),l(g);l(this.otherwise)}outputDefined(){return this.branches.every(([l,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class Uh{constructor(l,f,g,w){this.type=l,this.input=f,this.beginIndex=g,this.endIndex=w}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);let g=f.parse(l[1],1,Pr),w=f.parse(l[2],2,Gt);if(!g||!w)return null;if(!po(g.type,[Xr(Pr),dr,Pr]))return f.error(`Expected first argument to be of type array or string, but found ${ri(g.type)} instead`);if(l.length===4){let I=f.parse(l[3],3,Gt);return I?new Uh(g.type,g,w,I):null}return new Uh(g.type,g,w)}evaluate(l){let f=this.input.evaluate(l),g=this.beginIndex.evaluate(l),w;if(this.endIndex&&(w=this.endIndex.evaluate(l)),Jn(f,["string"]))return[...f].slice(g,w).join("");if(Jn(f,["array"]))return f.slice(g,w);throw new gn(`Expected first argument to be of type array or string, but found ${ri(_n(f))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function yd(h,l){let f=h.length-1,g,w,I=0,M=f,D=0;for(;I<=M;)if(D=Math.floor((I+M)/2),g=h[D],w=h[D+1],g<=l){if(D===f||l<w)return D;I=D+1}else{if(!(g>l))throw new gn("Input is not a number.");M=D-1}return 0}class Nu{constructor(l,f,g){this.type=l,this.input=f,this.labels=[],this.outputs=[];for(let[w,I]of g)this.labels.push(w),this.outputs.push(I)}static parse(l,f){if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");let g=f.parse(l[1],1,Gt);if(!g)return null;let w=[],I=null;f.expectedType&&f.expectedType.kind!=="value"&&(I=f.expectedType);for(let M=1;M<l.length;M+=2){let D=M===1?-1/0:l[M],U=l[M+1],j=M,$=M+1;if(typeof D!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(w.length&&w[w.length-1][0]>=D)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);let Y=f.parse(U,$,I);if(!Y)return null;I=I||Y.type,w.push([D,Y])}return new Nu(I,g,w)}evaluate(l){let f=this.labels,g=this.outputs;if(f.length===1)return g[0].evaluate(l);let w=this.input.evaluate(l);if(w<=f[0])return g[0].evaluate(l);let I=f.length;return w>=f[I-1]?g[I-1].evaluate(l):g[yd(f,w)].evaluate(l)}eachChild(l){l(this.input);for(let f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function zm(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Cc,ws,xd=function(){if(ws)return Cc;function h(l,f,g,w){this.cx=3*l,this.bx=3*(g-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*f,this.by=3*(w-f)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=f,this.p2x=g,this.p2y=w}return ws=1,Cc=h,h.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,f){if(f===void 0&&(f=1e-6),l<0)return 0;if(l>1)return 1;for(var g=l,w=0;w<8;w++){var I=this.sampleCurveX(g)-l;if(Math.abs(I)<f)return g;var M=this.sampleCurveDerivativeX(g);if(Math.abs(M)<1e-6)break;g-=I/M}var D=0,U=1;for(g=l,w=0;w<20&&(I=this.sampleCurveX(g),!(Math.abs(I-l)<f));w++)l>I?D=g:U=g,g=.5*(U-D)+D;return g},solve:function(l,f){return this.sampleCurveY(this.solveCurveX(l,f))}},Cc}(),Um=zm(xd);class Ns{constructor(l,f,g,w,I){this.type=l,this.operator=f,this.interpolation=g,this.input=w,this.labels=[],this.outputs=[];for(let[M,D]of I)this.labels.push(M),this.outputs.push(D)}static interpolationFactor(l,f,g,w){let I=0;if(l.name==="exponential")I=Hn(f,l.base,g,w);else if(l.name==="linear")I=Hn(f,1,g,w);else if(l.name==="cubic-bezier"){let M=l.controlPoints;I=new Um(M[0],M[1],M[2],M[3]).solve(Hn(f,1,g,w))}return I}static parse(l,f){let[g,w,I,...M]=l;if(!Array.isArray(w)||w.length===0)return f.error("Expected an interpolation type expression.",1);if(w[0]==="linear")w={name:"linear"};else if(w[0]==="exponential"){let j=w[1];if(typeof j!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);w={name:"exponential",base:j}}else{if(w[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(w[0])}`,1,0);{let j=w.slice(1);if(j.length!==4||j.some($=>typeof $!="number"||$<0||$>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);w={name:"cubic-bezier",controlPoints:j}}}if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(I=f.parse(I,2,Gt),!I)return null;let D=[],U=null;g==="interpolate-hcl"||g==="interpolate-lab"?U=zr:f.expectedType&&f.expectedType.kind!=="value"&&(U=f.expectedType);for(let j=0;j<M.length;j+=2){let $=M[j],Y=M[j+1],se=j+3,le=j+4;if(typeof $!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(D.length&&D[D.length-1][0]>=$)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);let ue=f.parse(Y,le,U);if(!ue)return null;U=U||ue.type,D.push([$,ue])}return xi(U,Gt)||xi(U,mn)||xi(U,zr)||xi(U,Ru)||xi(U,St)||xi(U,Xr(Gt))?new Ns(U,g,w,I,D):f.error(`Type ${ri(U)} is not interpolatable.`)}evaluate(l){let f=this.labels,g=this.outputs;if(f.length===1)return g[0].evaluate(l);let w=this.input.evaluate(l);if(w<=f[0])return g[0].evaluate(l);let I=f.length;if(w>=f[I-1])return g[I-1].evaluate(l);let M=yd(f,w),D=Ns.interpolationFactor(this.interpolation,w,f[M],f[M+1]),U=g[M].evaluate(l),j=g[M+1].evaluate(l);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Za(U,j,D);case"color":return bi.interpolate(U,j,D);case"padding":return vs.interpolate(U,j,D);case"variableAnchorOffsetCollection":return Qs.interpolate(U,j,D);case"array":return Lu(U,j,D);case"projectionDefinition":return es.interpolate(U,j,D)}case"interpolate-hcl":return bi.interpolate(U,j,D,"hcl");case"interpolate-lab":return bi.interpolate(U,j,D,"lab")}}eachChild(l){l(this.input);for(let f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Hn(h,l,f,g){let w=g-f,I=h-f;return w===0?0:l===1?I/w:(Math.pow(l,I)-1)/(Math.pow(l,w)-1)}let na={color:bi.interpolate,number:Za,padding:vs.interpolate,variableAnchorOffsetCollection:Qs.interpolate,array:Lu};class zu{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let g=null,w=f.expectedType;w&&w.kind!=="value"&&(g=w);let I=[];for(let D of l.slice(1)){let U=f.parse(D,1+I.length,g,void 0,{typeAnnotation:"omit"});if(!U)return null;g=g||U.type,I.push(U)}if(!g)throw new Error("No output type");let M=w&&I.some(D=>jn(w,D.type));return new zu(M?Pr:g,I)}evaluate(l){let f,g=null,w=0;for(let I of this.args)if(w++,g=I.evaluate(l),g&&g instanceof Ao&&!g.available&&(f||(f=g.name),g=null,w===this.args.length&&(g=f)),g!==null)break;return g}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function dA(h,l){return h==="=="||h==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Vm(h,l,f,g){return g.compare(l,f)===0}function Xa(h,l,f){let g=h!=="=="&&h!=="!=";return class pR{constructor(I,M,D){this.type=tr,this.lhs=I,this.rhs=M,this.collator=D,this.hasUntypedArgument=I.type.kind==="value"||M.type.kind==="value"}static parse(I,M){if(I.length!==3&&I.length!==4)return M.error("Expected two or three arguments.");let D=I[0],U=M.parse(I[1],1,Pr);if(!U)return null;if(!dA(D,U.type))return M.concat(1).error(`"${D}" comparisons are not supported for type '${ri(U.type)}'.`);let j=M.parse(I[2],2,Pr);if(!j)return null;if(!dA(D,j.type))return M.concat(2).error(`"${D}" comparisons are not supported for type '${ri(j.type)}'.`);if(U.type.kind!==j.type.kind&&U.type.kind!=="value"&&j.type.kind!=="value")return M.error(`Cannot compare types '${ri(U.type)}' and '${ri(j.type)}'.`);g&&(U.type.kind==="value"&&j.type.kind!=="value"?U=new mo(j.type,[U]):U.type.kind!=="value"&&j.type.kind==="value"&&(j=new mo(U.type,[j])));let $=null;if(I.length===4){if(U.type.kind!=="string"&&j.type.kind!=="string"&&U.type.kind!=="value"&&j.type.kind!=="value")return M.error("Cannot use collator to compare non-string types.");if($=M.parse(I[3],3,Vn),!$)return null}return new pR(U,j,$)}evaluate(I){let M=this.lhs.evaluate(I),D=this.rhs.evaluate(I);if(g&&this.hasUntypedArgument){let U=_n(M),j=_n(D);if(U.kind!==j.kind||U.kind!=="string"&&U.kind!=="number")throw new gn(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${U.kind}, ${j.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){let U=_n(M),j=_n(D);if(U.kind!=="string"||j.kind!=="string")return l(I,M,D)}return this.collator?f(I,M,D,this.collator.evaluate(I)):l(I,M,D)}eachChild(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)}outputDefined(){return!0}}}let pA=Xa("==",function(h,l,f){return l===f},Vm),AA=Xa("!=",function(h,l,f){return l!==f},function(h,l,f,g){return!Vm(0,l,f,g)}),Vh=Xa("<",function(h,l,f){return l<f},function(h,l,f,g){return g.compare(l,f)<0}),jh=Xa(">",function(h,l,f){return l>f},function(h,l,f,g){return g.compare(l,f)>0}),go=Xa("<=",function(h,l,f){return l<=f},function(h,l,f,g){return g.compare(l,f)<=0}),bd=Xa(">=",function(h,l,f){return l>=f},function(h,l,f,g){return g.compare(l,f)>=0});class Ya{constructor(l,f,g){this.type=Vn,this.locale=g,this.caseSensitive=l,this.diacriticSensitive=f}static parse(l,f){if(l.length!==2)return f.error("Expected one argument.");let g=l[1];if(typeof g!="object"||Array.isArray(g))return f.error("Collator options argument must be an object.");let w=f.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,tr);if(!w)return null;let I=f.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,tr);if(!I)return null;let M=null;return g.locale&&(M=f.parse(g.locale,1,dr),!M)?null:new Ya(w,I,M)}evaluate(l){return new zo(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class Gh{constructor(l,f,g,w,I){this.type=dr,this.number=l,this.locale=f,this.currency=g,this.minFractionDigits=w,this.maxFractionDigits=I}static parse(l,f){if(l.length!==3)return f.error("Expected two arguments.");let g=f.parse(l[1],1,Gt);if(!g)return null;let w=l[2];if(typeof w!="object"||Array.isArray(w))return f.error("NumberFormat options argument must be an object.");let I=null;if(w.locale&&(I=f.parse(w.locale,1,dr),!I))return null;let M=null;if(w.currency&&(M=f.parse(w.currency,1,dr),!M))return null;let D=null;if(w["min-fraction-digits"]&&(D=f.parse(w["min-fraction-digits"],1,Gt),!D))return null;let U=null;return w["max-fraction-digits"]&&(U=f.parse(w["max-fraction-digits"],1,Gt),!U)?null:new Gh(g,I,M,D,U)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class wa{constructor(l){this.type=Ji,this.sections=l}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let g=l[1];if(!Array.isArray(g)&&typeof g=="object")return f.error("First argument must be an image or text section.");let w=[],I=!1;for(let M=1;M<=l.length-1;++M){let D=l[M];if(I&&typeof D=="object"&&!Array.isArray(D)){I=!1;let U=null;if(D["font-scale"]&&(U=f.parse(D["font-scale"],1,Gt),!U))return null;let j=null;if(D["text-font"]&&(j=f.parse(D["text-font"],1,Xr(dr)),!j))return null;let $=null;if(D["text-color"]&&($=f.parse(D["text-color"],1,zr),!$))return null;let Y=null;if(D["vertical-align"]){if(typeof D["vertical-align"]=="string"&&!Dh.includes(D["vertical-align"]))return f.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${D["vertical-align"]}' instead.`);if(Y=f.parse(D["vertical-align"],1,dr),!Y)return null}let se=w[w.length-1];se.scale=U,se.font=j,se.textColor=$,se.verticalAlign=Y}else{let U=f.parse(l[M],1,Pr);if(!U)return null;let j=U.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");I=!0,w.push({content:U,scale:null,font:null,textColor:null,verticalAlign:null})}}return new wa(w)}evaluate(l){return new Ks(this.sections.map(f=>{let g=f.content.evaluate(l);return _n(g)===Cl?new Ou("",g,null,null,null,f.verticalAlign?f.verticalAlign.evaluate(l):null):new Ou(Du(g),null,f.scale?f.scale.evaluate(l):null,f.font?f.font.evaluate(l).join(","):null,f.textColor?f.textColor.evaluate(l):null,f.verticalAlign?f.verticalAlign.evaluate(l):null)}))}eachChild(l){for(let f of this.sections)l(f.content),f.scale&&l(f.scale),f.font&&l(f.font),f.textColor&&l(f.textColor),f.verticalAlign&&l(f.verticalAlign)}outputDefined(){return!1}}class Uu{constructor(l){this.type=Cl,this.input=l}static parse(l,f){if(l.length!==2)return f.error("Expected two arguments.");let g=f.parse(l[1],1,dr);return g?new Uu(g):f.error("No image name provided.")}evaluate(l){let f=this.input.evaluate(l),g=Ao.fromString(f);return g&&l.availableImages&&(g.available=l.availableImages.indexOf(f)>-1),g}eachChild(l){l(this.input)}outputDefined(){return!1}}class Ta{constructor(l){this.type=Gt,this.input=l}static parse(l,f){if(l.length!==2)return f.error(`Expected 1 argument, but found ${l.length-1} instead.`);let g=f.parse(l[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${ri(g.type)} instead.`):new Ta(g):null}evaluate(l){let f=this.input.evaluate(l);if(typeof f=="string")return[...f].length;if(Array.isArray(f))return f.length;throw new gn(`Expected value to be of type string or array, but found ${ri(_n(f))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}let gt=8192;function Wt(h,l){let f=(180+h[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,w=Math.pow(2,l.z);return[Math.round(f*w*gt),Math.round(g*w*gt)]}function or(h,l){let f=Math.pow(2,l.z);return[(w=(h[0]/gt+l.x)/f,360*w-180),(g=(h[1]/gt+l.y)/f,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,w}function Br(h,l){h[0]=Math.min(h[0],l[0]),h[1]=Math.min(h[1],l[1]),h[2]=Math.max(h[2],l[0]),h[3]=Math.max(h[3],l[1])}function y(h,l){return!(h[0]<=l[0]||h[2]>=l[2]||h[1]<=l[1]||h[3]>=l[3])}function qi(h,l,f){let g=h[0]-l[0],w=h[1]-l[1],I=h[0]-f[0],M=h[1]-f[1];return g*M-I*w==0&&g*I<=0&&w*M<=0}function Ei(h,l,f,g){return(w=[g[0]-f[0],g[1]-f[1]])[0]*(I=[l[0]-h[0],l[1]-h[1]])[1]-w[1]*I[0]!=0&&!(!dn(h,l,f,g)||!dn(f,g,h,l));var w,I}function Ee(h,l,f){for(let g of f)for(let w=0;w<g.length-1;++w)if(Ei(h,l,g[w],g[w+1]))return!0;return!1}function En(h,l,f=!1){let g=!1;for(let D of l)for(let U=0;U<D.length-1;U++){if(qi(h,D[U],D[U+1]))return f;(I=D[U])[1]>(w=h)[1]!=(M=D[U+1])[1]>w[1]&&w[0]<(M[0]-I[0])*(w[1]-I[1])/(M[1]-I[1])+I[0]&&(g=!g)}var w,I,M;return g}function Js(h,l){for(let f of l)if(En(h,f))return!0;return!1}function Wn(h,l){for(let f of h)if(!En(f,l))return!1;for(let f=0;f<h.length-1;++f)if(Ee(h[f],h[f+1],l))return!1;return!0}function Ui(h,l){for(let f of l)if(Wn(h,f))return!0;return!1}function dn(h,l,f,g){let w=g[0]-f[0],I=g[1]-f[1],M=(h[0]-f[0])*I-w*(h[1]-f[1]),D=(l[0]-f[0])*I-w*(l[1]-f[1]);return M>0&&D<0||M<0&&D>0}function kn(h,l,f){let g=[];for(let w=0;w<h.length;w++){let I=[];for(let M=0;M<h[w].length;M++){let D=Wt(h[w][M],f);Br(l,D),I.push(D)}g.push(I)}return g}function vi(h,l,f){let g=[];for(let w=0;w<h.length;w++){let I=kn(h[w],l,f);g.push(I)}return g}function Si(h,l,f,g){if(h[0]<f[0]||h[0]>f[2]){let w=.5*g,I=h[0]-f[0]>w?-g:f[0]-h[0]>w?g:0;I===0&&(I=h[0]-f[2]>w?-g:f[2]-h[0]>w?g:0),h[0]+=I}Br(l,h)}function Ic(h,l,f,g){let w=Math.pow(2,g.z)*gt,I=[g.x*gt,g.y*gt],M=[];for(let D of h)for(let U of D){let j=[U.x+I[0],U.y+I[1]];Si(j,l,f,w),M.push(j)}return M}function mA(h,l,f,g){let w=Math.pow(2,g.z)*gt,I=[g.x*gt,g.y*gt],M=[];for(let U of h){let j=[];for(let $ of U){let Y=[$.x+I[0],$.y+I[1]];Br(l,Y),j.push(Y)}M.push(j)}if(l[2]-l[0]<=w/2){(D=l)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(let U of M)for(let j of U)Si(j,l,f,w)}var D;return M}class Ll{constructor(l,f){this.type=tr,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Rl(l[1])){let g=l[1];if(g.type==="FeatureCollection"){let w=[];for(let I of g.features){let{type:M,coordinates:D}=I.geometry;M==="Polygon"&&w.push(D),M==="MultiPolygon"&&w.push(...D)}if(w.length)return new Ll(g,{type:"MultiPolygon",coordinates:w})}else if(g.type==="Feature"){let w=g.geometry.type;if(w==="Polygon"||w==="MultiPolygon")return new Ll(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new Ll(g,g)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(f,g){let w=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],M=f.canonicalID();if(g.type==="Polygon"){let D=kn(g.coordinates,I,M),U=Ic(f.geometry(),w,I,M);if(!y(w,I))return!1;for(let j of U)if(!En(j,D))return!1}if(g.type==="MultiPolygon"){let D=vi(g.coordinates,I,M),U=Ic(f.geometry(),w,I,M);if(!y(w,I))return!1;for(let j of U)if(!Js(j,D))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(f,g){let w=[1/0,1/0,-1/0,-1/0],I=[1/0,1/0,-1/0,-1/0],M=f.canonicalID();if(g.type==="Polygon"){let D=kn(g.coordinates,I,M),U=mA(f.geometry(),w,I,M);if(!y(w,I))return!1;for(let j of U)if(!Wn(j,D))return!1}if(g.type==="MultiPolygon"){let D=vi(g.coordinates,I,M),U=mA(f.geometry(),w,I,M);if(!y(w,I))return!1;for(let j of U)if(!Ui(j,D))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Pc=class{constructor(h=[],l=(f,g)=>f<g?-1:f>g?1:0){if(this.data=h,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;let h=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),h}peek(){return this.data[0]}_up(h){let{data:l,compare:f}=this,g=l[h];for(;h>0;){let w=h-1>>1,I=l[w];if(f(g,I)>=0)break;l[h]=I,h=w}l[h]=g}_down(h){let{data:l,compare:f}=this,g=this.length>>1,w=l[h];for(;h<g;){let I=1+(h<<1),M=I+1;if(M<this.length&&f(l[M],l[I])<0&&(I=M),f(l[I],w)>=0)break;l[h]=l[I],h=I}l[h]=w}};function _o(h,l,f=0,g=h.length-1,w=oa){for(;g>f;){if(g-f>600){let U=g-f+1,j=l-f+1,$=Math.log(U),Y=.5*Math.exp(2*$/3),se=.5*Math.sqrt($*Y*(U-Y)/U)*(j-U/2<0?-1:1);_o(h,l,Math.max(f,Math.floor(l-j*Y/U+se)),Math.min(g,Math.floor(l+(U-j)*Y/U+se)),w)}let I=h[l],M=f,D=g;for(sa(h,f,l),w(h[g],I)>0&&sa(h,f,g);M<D;){for(sa(h,M,D),M++,D--;w(h[M],I)<0;)M++;for(;w(h[D],I)>0;)D--}w(h[f],I)===0?sa(h,f,D):(D++,sa(h,D,g)),D<=l&&(f=D+1),l<=D&&(g=D-1)}}function sa(h,l,f){let g=h[l];h[l]=h[f],h[f]=g}function oa(h,l){return h<l?-1:h>l?1:0}function Ol(h,l){if(h.length<=1)return[h];let f=[],g,w;for(let I of h){let M=Dl(I);M!==0&&(I.area=Math.abs(M),w===void 0&&(w=M<0),w===M<0?(g&&f.push(g),g=[I]):g.push(I))}if(g&&f.push(g),l>1)for(let I=0;I<f.length;I++)f[I].length<=l||(_o(f[I],l,1,f[I].length-1,gA),f[I]=f[I].slice(0,l));return f}function gA(h,l){return l.area-h.area}function Dl(h){let l=0;for(let f,g,w=0,I=h.length,M=I-1;w<I;M=w++)f=h[w],g=h[M],l+=(g.x-f.x)*(f.y+g.y);return l}let Yr=1/298.257223563,Pe=Yr*(2-Yr),Fr=Math.PI/180;class Hh{constructor(l){let f=6378.137*Fr*1e3,g=Math.cos(l*Fr),w=1/(1-Pe*(1-g*g)),I=Math.sqrt(w);this.kx=f*I*g,this.ky=f*I*w*(1-Pe)}distance(l,f){let g=this.wrap(l[0]-f[0])*this.kx,w=(l[1]-f[1])*this.ky;return Math.sqrt(g*g+w*w)}pointOnLine(l,f){let g,w,I,M,D=1/0;for(let U=0;U<l.length-1;U++){let j=l[U][0],$=l[U][1],Y=this.wrap(l[U+1][0]-j)*this.kx,se=(l[U+1][1]-$)*this.ky,le=0;Y===0&&se===0||(le=(this.wrap(f[0]-j)*this.kx*Y+(f[1]-$)*this.ky*se)/(Y*Y+se*se),le>1?(j=l[U+1][0],$=l[U+1][1]):le>0&&(j+=Y/this.kx*le,$+=se/this.ky*le)),Y=this.wrap(f[0]-j)*this.kx,se=(f[1]-$)*this.ky;let ue=Y*Y+se*se;ue<D&&(D=ue,g=j,w=$,I=U,M=le)}return{point:[g,w],index:I,t:Math.max(0,Math.min(1,M))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function _A(h,l){return l[0]-h[0]}function Wh(h){return h[1]-h[0]+1}function aa(h,l){return h[1]>=h[0]&&h[1]<l}function vd(h,l){if(h[0]>h[1])return[null,null];let f=Wh(h);if(l){if(f===2)return[h,null];let w=Math.floor(f/2);return[[h[0],h[0]+w],[h[0]+w,h[1]]]}if(f===1)return[h,null];let g=Math.floor(f/2)-1;return[[h[0],h[0]+g],[h[0]+g+1,h[1]]]}function be(h,l){if(!aa(l,h.length))return[1/0,1/0,-1/0,-1/0];let f=[1/0,1/0,-1/0,-1/0];for(let g=l[0];g<=l[1];++g)Br(f,h[g]);return f}function wd(h){let l=[1/0,1/0,-1/0,-1/0];for(let f of h)for(let g of f)Br(l,g);return l}function yA(h){return h[0]!==-1/0&&h[1]!==-1/0&&h[2]!==1/0&&h[3]!==1/0}function Ci(h,l,f){if(!yA(h)||!yA(l))return NaN;let g=0,w=0;return h[2]<l[0]&&(g=l[0]-h[2]),h[0]>l[2]&&(g=h[0]-l[2]),h[1]>l[3]&&(w=h[1]-l[3]),h[3]<l[1]&&(w=l[1]-h[3]),f.distance([0,0],[g,w])}function kl(h,l,f){let g=f.pointOnLine(l,h);return f.distance(h,g.point)}function Td(h,l,f,g,w){let I=Math.min(kl(h,[f,g],w),kl(l,[f,g],w)),M=Math.min(kl(f,[h,l],w),kl(g,[h,l],w));return Math.min(I,M)}function jm(h,l,f,g,w){if(!aa(l,h.length)||!aa(g,f.length))return 1/0;let I=1/0;for(let M=l[0];M<l[1];++M){let D=h[M],U=h[M+1];for(let j=g[0];j<g[1];++j){let $=f[j],Y=f[j+1];if(Ei(D,U,$,Y))return 0;I=Math.min(I,Td(D,U,$,Y,w))}}return I}function xA(h,l,f,g,w){if(!aa(l,h.length)||!aa(g,f.length))return NaN;let I=1/0;for(let M=l[0];M<=l[1];++M)for(let D=g[0];D<=g[1];++D)if(I=Math.min(I,w.distance(h[M],f[D])),I===0)return I;return I}function bA(h,l,f){if(En(h,l,!0))return 0;let g=1/0;for(let w of l){let I=w[0],M=w[w.length-1];if(I!==M&&(g=Math.min(g,kl(h,[M,I],f)),g===0))return g;let D=f.pointOnLine(w,h);if(g=Math.min(g,f.distance(h,D.point)),g===0)return g}return g}function vA(h,l,f,g){if(!aa(l,h.length))return NaN;for(let I=l[0];I<=l[1];++I)if(En(h[I],f,!0))return 0;let w=1/0;for(let I=l[0];I<l[1];++I){let M=h[I],D=h[I+1];for(let U of f)for(let j=0,$=U.length,Y=$-1;j<$;Y=j++){let se=U[Y],le=U[j];if(Ei(M,D,se,le))return 0;w=Math.min(w,Td(M,D,se,le,g))}}return w}function la(h,l){for(let f of h)for(let g of f)if(En(g,l,!0))return!0;return!1}function ts(h,l,f,g=1/0){let w=wd(h),I=wd(l);if(g!==1/0&&Ci(w,I,f)>=g)return g;if(y(w,I)){if(la(h,l))return 0}else if(la(l,h))return 0;let M=1/0;for(let D of h)for(let U=0,j=D.length,$=j-1;U<j;$=U++){let Y=D[$],se=D[U];for(let le of l)for(let ue=0,pe=le.length,Te=pe-1;ue<pe;Te=ue++){let Re=le[Te],et=le[ue];if(Ei(Y,se,Re,et))return 0;M=Math.min(M,Td(Y,se,Re,et,f))}}return M}function $h(h,l,f,g,w,I){if(!I)return;let M=Ci(be(g,I),w,f);M<l&&h.push([M,I,[0,0]])}function qh(h,l,f,g,w,I,M){if(!I||!M)return;let D=Ci(be(g,I),be(w,M),f);D<l&&h.push([D,I,M])}function Zh(h,l,f,g,w=1/0){let I=Math.min(g.distance(h[0],f[0][0]),w);if(I===0)return I;let M=new Pc([[0,[0,h.length-1],[0,0]]],_A),D=wd(f);for(;M.length>0;){let U=M.pop();if(U[0]>=I)continue;let j=U[1],$=l?50:100;if(Wh(j)<=$){if(!aa(j,h.length))return NaN;if(l){let Y=vA(h,j,f,g);if(isNaN(Y)||Y===0)return Y;I=Math.min(I,Y)}else for(let Y=j[0];Y<=j[1];++Y){let se=bA(h[Y],f,g);if(I=Math.min(I,se),I===0)return 0}}else{let Y=vd(j,l);$h(M,I,g,h,D,Y[0]),$h(M,I,g,h,D,Y[1])}}return I}function Vu(h,l,f,g,w,I=1/0){let M=Math.min(I,w.distance(h[0],f[0]));if(M===0)return M;let D=new Pc([[0,[0,h.length-1],[0,f.length-1]]],_A);for(;D.length>0;){let U=D.pop();if(U[0]>=M)continue;let j=U[1],$=U[2],Y=l?50:100,se=g?50:100;if(Wh(j)<=Y&&Wh($)<=se){if(!aa(j,h.length)&&aa($,f.length))return NaN;let le;if(l&&g)le=jm(h,j,f,$,w),M=Math.min(M,le);else if(l&&!g){let ue=h.slice(j[0],j[1]+1);for(let pe=$[0];pe<=$[1];++pe)if(le=kl(f[pe],ue,w),M=Math.min(M,le),M===0)return M}else if(!l&&g){let ue=f.slice($[0],$[1]+1);for(let pe=j[0];pe<=j[1];++pe)if(le=kl(h[pe],ue,w),M=Math.min(M,le),M===0)return M}else le=xA(h,j,f,$,w),M=Math.min(M,le)}else{let le=vd(j,l),ue=vd($,g);qh(D,M,w,h,f,le[0],ue[0]),qh(D,M,w,h,f,le[0],ue[1]),qh(D,M,w,h,f,le[1],ue[0]),qh(D,M,w,h,f,le[1],ue[1])}}return M}function Ed(h){return h.type==="MultiPolygon"?h.coordinates.map(l=>({type:"Polygon",coordinates:l})):h.type==="MultiLineString"?h.coordinates.map(l=>({type:"LineString",coordinates:l})):h.type==="MultiPoint"?h.coordinates.map(l=>({type:"Point",coordinates:l})):[h]}class Fl{constructor(l,f){this.type=Gt,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Rl(l[1])){let g=l[1];if(g.type==="FeatureCollection")return new Fl(g,g.features.map(w=>Ed(w.geometry)).flat());if(g.type==="Feature")return new Fl(g,Ed(g.geometry));if("type"in g&&"coordinates"in g)return new Fl(g,Ed(g))}return f.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(f,g){let w=f.geometry(),I=w.flat().map(U=>or([U.x,U.y],f.canonical));if(w.length===0)return NaN;let M=new Hh(I[0][1]),D=1/0;for(let U of g){switch(U.type){case"Point":D=Math.min(D,Vu(I,!1,[U.coordinates],!1,M,D));break;case"LineString":D=Math.min(D,Vu(I,!1,U.coordinates,!0,M,D));break;case"Polygon":D=Math.min(D,Zh(I,!1,U.coordinates,M,D))}if(D===0)return D}return D}(l,this.geometries);if(l.geometryType()==="LineString")return function(f,g){let w=f.geometry(),I=w.flat().map(U=>or([U.x,U.y],f.canonical));if(w.length===0)return NaN;let M=new Hh(I[0][1]),D=1/0;for(let U of g){switch(U.type){case"Point":D=Math.min(D,Vu(I,!0,[U.coordinates],!1,M,D));break;case"LineString":D=Math.min(D,Vu(I,!0,U.coordinates,!0,M,D));break;case"Polygon":D=Math.min(D,Zh(I,!0,U.coordinates,M,D))}if(D===0)return D}return D}(l,this.geometries);if(l.geometryType()==="Polygon")return function(f,g){let w=f.geometry();if(w.length===0||w[0].length===0)return NaN;let I=Ol(w,0).map(U=>U.map(j=>j.map($=>or([$.x,$.y],f.canonical)))),M=new Hh(I[0][0][0][1]),D=1/0;for(let U of g)for(let j of I){switch(U.type){case"Point":D=Math.min(D,Zh([U.coordinates],!1,j,M,D));break;case"LineString":D=Math.min(D,Zh(U.coordinates,!0,j,M,D));break;case"Polygon":D=Math.min(D,ts(j,U.coordinates,M,D))}if(D===0)return D}return D}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let Mc={"==":pA,"!=":AA,">":jh,"<":Vh,">=":bd,"<=":go,array:mo,at:ia,boolean:mo,case:zh,coalesce:zu,collator:Ya,format:wa,image:Uu,in:Fh,"index-of":Nh,interpolate:Ns,"interpolate-hcl":Ns,"interpolate-lab":Ns,length:Ta,let:_i,literal:Bl,match:_d,number:mo,"number-format":Gh,object:mo,slice:Uh,step:Nu,string:mo,"to-boolean":va,"to-color":va,"to-number":va,"to-string":va,var:Fu,within:Ll,distance:Fl};class Ai{constructor(l,f,g,w){this.name=l,this.type=f,this._evaluate=g,this.args=w}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,f){let g=l[0],w=Ai.definitions[g];if(!w)return f.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);let I=Array.isArray(w)?w[0]:w.type,M=Array.isArray(w)?[[w[1],w[2]]]:w.overloads,D=M.filter(([j])=>!Array.isArray(j)||j.length===l.length-1),U=null;for(let[j,$]of D){U=new ku(f.registry,Yh,f.path,null,f.scope);let Y=[],se=!1;for(let le=1;le<l.length;le++){let ue=l[le],pe=Array.isArray(j)?j[le-1]:j.type,Te=U.parse(ue,1+Y.length,pe);if(!Te){se=!0;break}Y.push(Te)}if(!se)if(Array.isArray(j)&&j.length!==Y.length)U.error(`Expected ${j.length} arguments, but found ${Y.length} instead.`);else{for(let le=0;le<Y.length;le++){let ue=Array.isArray(j)?j[le]:j.type,pe=Y[le];U.concat(le+1).checkSubtype(ue,pe.type)}if(U.errors.length===0)return new Ai(g,I,$,Y)}}if(D.length===1)f.errors.push(...U.errors);else{let j=(D.length?D:M).map(([Y])=>{return se=Y,Array.isArray(se)?`(${se.map(ri).join(", ")})`:`(${ri(se.type)}...)`;var se}).join(" | "),$=[];for(let Y=1;Y<l.length;Y++){let se=f.parse(l[Y],1+$.length);if(!se)return null;$.push(ri(se.type))}f.error(`Expected arguments of type ${j}, but found (${$.join(", ")}) instead.`)}return null}static register(l,f){Ai.definitions=f;for(let g in f)l[g]=Ai}}function Xh(h,[l,f,g,w]){l=l.evaluate(h),f=f.evaluate(h),g=g.evaluate(h);let I=w?w.evaluate(h):1,M=Nm(l,f,g,I);if(M)throw new gn(M);return new bi(l/255,f/255,g/255,I,!1)}function Sd(h,l){return h in l}function Cd(h,l){let f=l[h];return f===void 0?null:f}function Nl(h){return{type:h}}function Yh(h){if(h instanceof Fu)return Yh(h.boundExpression);if(h instanceof Ai&&h.name==="error"||h instanceof Ya||h instanceof Ll||h instanceof Fl)return!1;let l=h instanceof va||h instanceof mo,f=!0;return h.eachChild(g=>{f=l?f&&Yh(g):f&&g instanceof Bl}),!!f&&ju(h)&&Rc(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ju(h){if(h instanceof Ai&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Ll||h instanceof Fl)return!1;let l=!0;return h.eachChild(f=>{l&&!ju(f)&&(l=!1)}),l}function zl(h){if(h instanceof Ai&&h.name==="feature-state")return!1;let l=!0;return h.eachChild(f=>{l&&!zl(f)&&(l=!1)}),l}function Rc(h,l){if(h instanceof Ai&&l.indexOf(h.name)>=0)return!1;let f=!0;return h.eachChild(g=>{f&&!Rc(g,l)&&(f=!1)}),f}function wA(h){return{result:"success",value:h}}function Bc(h){return{result:"error",value:h}}function Ul(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function Id(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Kh(h){return!!h.expression&&h.expression.interpolated}function wi(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Qh(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function Pd(h){return h}function ls(h,l){let f=l.type==="color",g=h.stops&&typeof h.stops[0][0]=="object",w=g||!(g||h.property!==void 0),I=h.type||(Kh(l)?"exponential":"interval");if(f||l.type==="padding"){let $=f?bi.parse:vs.parse;(h=Dr({},h)).stops&&(h.stops=h.stops.map(Y=>[Y[0],$(Y[1])])),h.default=$(h.default?h.default:l.default)}if(h.colorSpace&&(M=h.colorSpace)!=="rgb"&&M!=="hcl"&&M!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var M;let D,U,j;if(I==="exponential")D=Md;else if(I==="interval")D=Jh;else if(I==="categorical"){D=zs,U=Object.create(null);for(let $ of h.stops)U[$[0]]=$[1];j=typeof h.stops[0][0]}else{if(I!=="identity")throw new Error(`Unknown function type "${I}"`);D=ef}if(g){let $={},Y=[];for(let ue=0;ue<h.stops.length;ue++){let pe=h.stops[ue],Te=pe[0].zoom;$[Te]===void 0&&($[Te]={zoom:Te,type:h.type,property:h.property,default:h.default,stops:[]},Y.push(Te)),$[Te].stops.push([pe[0].value,pe[1]])}let se=[];for(let ue of Y)se.push([$[ue].zoom,ls($[ue],l)]);let le={name:"linear"};return{kind:"composite",interpolationType:le,interpolationFactor:Ns.interpolationFactor.bind(void 0,le),zoomStops:se.map(ue=>ue[0]),evaluate:({zoom:ue},pe)=>Md({stops:se,base:h.base},l,ue).evaluate(ue,pe)}}if(w){let $=I==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:$,interpolationFactor:Ns.interpolationFactor.bind(void 0,$),zoomStops:h.stops.map(Y=>Y[0]),evaluate:({zoom:Y})=>D(h,l,Y,U,j)}}return{kind:"source",evaluate($,Y){let se=Y&&Y.properties?Y.properties[h.property]:void 0;return se===void 0?Uo(h.default,l.default):D(h,l,se,U,j)}}}function Uo(h,l,f){return h!==void 0?h:l!==void 0?l:f!==void 0?f:void 0}function zs(h,l,f,g,w){return Uo(typeof f===w?g[f]:void 0,h.default,l.default)}function Jh(h,l,f){if(wi(f)!=="number")return Uo(h.default,l.default);let g=h.stops.length;if(g===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[g-1][0])return h.stops[g-1][1];let w=yd(h.stops.map(I=>I[0]),f);return h.stops[w][1]}function Md(h,l,f){let g=h.base!==void 0?h.base:1;if(wi(f)!=="number")return Uo(h.default,l.default);let w=h.stops.length;if(w===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[w-1][0])return h.stops[w-1][1];let I=yd(h.stops.map($=>$[0]),f),M=function($,Y,se,le){let ue=le-se,pe=$-se;return ue===0?0:Y===1?pe/ue:(Math.pow(Y,pe)-1)/(Math.pow(Y,ue)-1)}(f,g,h.stops[I][0],h.stops[I+1][0]),D=h.stops[I][1],U=h.stops[I+1][1],j=na[l.type]||Pd;return typeof D.evaluate=="function"?{evaluate(...$){let Y=D.evaluate.apply(void 0,$),se=U.evaluate.apply(void 0,$);if(Y!==void 0&&se!==void 0)return j(Y,se,M,h.colorSpace)}}:j(D,U,M,h.colorSpace)}function ef(h,l,f){switch(l.type){case"color":f=bi.parse(f);break;case"formatted":f=Ks.fromString(f.toString());break;case"resolvedImage":f=Ao.fromString(f.toString());break;case"padding":f=vs.parse(f);break;default:wi(f)===l.type||l.type==="enum"&&l.values[f]||(f=void 0)}return Uo(f,h.default,l.default)}Ai.register(Mc,{error:[{kind:"error"},[dr],(h,[l])=>{throw new gn(l.evaluate(h))}],typeof:[dr,[Pr],(h,[l])=>ri(_n(l.evaluate(h)))],"to-rgba":[Xr(Gt,4),[zr],(h,[l])=>{let[f,g,w,I]=l.evaluate(h).rgb;return[255*f,255*g,255*w,I]}],rgb:[zr,[Gt,Gt,Gt],Xh],rgba:[zr,[Gt,Gt,Gt,Gt],Xh],has:{type:tr,overloads:[[[dr],(h,[l])=>Sd(l.evaluate(h),h.properties())],[[dr,ta],(h,[l,f])=>Sd(l.evaluate(h),f.evaluate(h))]]},get:{type:Pr,overloads:[[[dr],(h,[l])=>Cd(l.evaluate(h),h.properties())],[[dr,ta],(h,[l,f])=>Cd(l.evaluate(h),f.evaluate(h))]]},"feature-state":[Pr,[dr],(h,[l])=>Cd(l.evaluate(h),h.featureState||{})],properties:[ta,[],h=>h.properties()],"geometry-type":[dr,[],h=>h.geometryType()],id:[Pr,[],h=>h.id()],zoom:[Gt,[],h=>h.globals.zoom],"heatmap-density":[Gt,[],h=>h.globals.heatmapDensity||0],"line-progress":[Gt,[],h=>h.globals.lineProgress||0],accumulated:[Pr,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Gt,Nl(Gt),(h,l)=>{let f=0;for(let g of l)f+=g.evaluate(h);return f}],"*":[Gt,Nl(Gt),(h,l)=>{let f=1;for(let g of l)f*=g.evaluate(h);return f}],"-":{type:Gt,overloads:[[[Gt,Gt],(h,[l,f])=>l.evaluate(h)-f.evaluate(h)],[[Gt],(h,[l])=>-l.evaluate(h)]]},"/":[Gt,[Gt,Gt],(h,[l,f])=>l.evaluate(h)/f.evaluate(h)],"%":[Gt,[Gt,Gt],(h,[l,f])=>l.evaluate(h)%f.evaluate(h)],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(h,[l,f])=>Math.pow(l.evaluate(h),f.evaluate(h))],sqrt:[Gt,[Gt],(h,[l])=>Math.sqrt(l.evaluate(h))],log10:[Gt,[Gt],(h,[l])=>Math.log(l.evaluate(h))/Math.LN10],ln:[Gt,[Gt],(h,[l])=>Math.log(l.evaluate(h))],log2:[Gt,[Gt],(h,[l])=>Math.log(l.evaluate(h))/Math.LN2],sin:[Gt,[Gt],(h,[l])=>Math.sin(l.evaluate(h))],cos:[Gt,[Gt],(h,[l])=>Math.cos(l.evaluate(h))],tan:[Gt,[Gt],(h,[l])=>Math.tan(l.evaluate(h))],asin:[Gt,[Gt],(h,[l])=>Math.asin(l.evaluate(h))],acos:[Gt,[Gt],(h,[l])=>Math.acos(l.evaluate(h))],atan:[Gt,[Gt],(h,[l])=>Math.atan(l.evaluate(h))],min:[Gt,Nl(Gt),(h,l)=>Math.min(...l.map(f=>f.evaluate(h)))],max:[Gt,Nl(Gt),(h,l)=>Math.max(...l.map(f=>f.evaluate(h)))],abs:[Gt,[Gt],(h,[l])=>Math.abs(l.evaluate(h))],round:[Gt,[Gt],(h,[l])=>{let f=l.evaluate(h);return f<0?-Math.round(-f):Math.round(f)}],floor:[Gt,[Gt],(h,[l])=>Math.floor(l.evaluate(h))],ceil:[Gt,[Gt],(h,[l])=>Math.ceil(l.evaluate(h))],"filter-==":[tr,[dr,Pr],(h,[l,f])=>h.properties()[l.value]===f.value],"filter-id-==":[tr,[Pr],(h,[l])=>h.id()===l.value],"filter-type-==":[tr,[dr],(h,[l])=>h.geometryType()===l.value],"filter-<":[tr,[dr,Pr],(h,[l,f])=>{let g=h.properties()[l.value],w=f.value;return typeof g==typeof w&&g<w}],"filter-id-<":[tr,[Pr],(h,[l])=>{let f=h.id(),g=l.value;return typeof f==typeof g&&f<g}],"filter->":[tr,[dr,Pr],(h,[l,f])=>{let g=h.properties()[l.value],w=f.value;return typeof g==typeof w&&g>w}],"filter-id->":[tr,[Pr],(h,[l])=>{let f=h.id(),g=l.value;return typeof f==typeof g&&f>g}],"filter-<=":[tr,[dr,Pr],(h,[l,f])=>{let g=h.properties()[l.value],w=f.value;return typeof g==typeof w&&g<=w}],"filter-id-<=":[tr,[Pr],(h,[l])=>{let f=h.id(),g=l.value;return typeof f==typeof g&&f<=g}],"filter->=":[tr,[dr,Pr],(h,[l,f])=>{let g=h.properties()[l.value],w=f.value;return typeof g==typeof w&&g>=w}],"filter-id->=":[tr,[Pr],(h,[l])=>{let f=h.id(),g=l.value;return typeof f==typeof g&&f>=g}],"filter-has":[tr,[Pr],(h,[l])=>l.value in h.properties()],"filter-has-id":[tr,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[tr,[Xr(dr)],(h,[l])=>l.value.indexOf(h.geometryType())>=0],"filter-id-in":[tr,[Xr(Pr)],(h,[l])=>l.value.indexOf(h.id())>=0],"filter-in-small":[tr,[dr,Xr(Pr)],(h,[l,f])=>f.value.indexOf(h.properties()[l.value])>=0],"filter-in-large":[tr,[dr,Xr(Pr)],(h,[l,f])=>function(g,w,I,M){for(;I<=M;){let D=I+M>>1;if(w[D]===g)return!0;w[D]>g?M=D-1:I=D+1}return!1}(h.properties()[l.value],f.value,0,f.value.length-1)],all:{type:tr,overloads:[[[tr,tr],(h,[l,f])=>l.evaluate(h)&&f.evaluate(h)],[Nl(tr),(h,l)=>{for(let f of l)if(!f.evaluate(h))return!1;return!0}]]},any:{type:tr,overloads:[[[tr,tr],(h,[l,f])=>l.evaluate(h)||f.evaluate(h)],[Nl(tr),(h,l)=>{for(let f of l)if(f.evaluate(h))return!0;return!1}]]},"!":[tr,[tr],(h,[l])=>!l.evaluate(h)],"is-supported-script":[tr,[dr],(h,[l])=>{let f=h.globals&&h.globals.isSupportedScript;return!f||f(l.evaluate(h))}],upcase:[dr,[dr],(h,[l])=>l.evaluate(h).toUpperCase()],downcase:[dr,[dr],(h,[l])=>l.evaluate(h).toLowerCase()],concat:[dr,Nl(Pr),(h,l)=>l.map(f=>Du(f.evaluate(h))).join("")],"resolved-locale":[dr,[Vn],(h,[l])=>l.evaluate(h).resolvedLocale()]});class Lc{constructor(l,f){var g;this.expression=l,this._warningHistory={},this._evaluator=new ei,this._defaultValue=f?(g=f).type==="color"&&Qh(g.default)?new bi(0,0,0,0):g.type==="color"?bi.parse(g.default)||null:g.type==="padding"?vs.parse(g.default)||null:g.type==="variableAnchorOffsetCollection"?Qs.parse(g.default)||null:g.type==="projectionDefinition"?es.parse(g.default)||null:g.default===void 0?null:g.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(l,f,g,w,I,M){return this._evaluator.globals=l,this._evaluator.feature=f,this._evaluator.featureState=g,this._evaluator.canonical=w,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=M,this.expression.evaluate(this._evaluator)}evaluate(l,f,g,w,I,M){this._evaluator.globals=l,this._evaluator.feature=f||null,this._evaluator.featureState=g||null,this._evaluator.canonical=w,this._evaluator.availableImages=I||null,this._evaluator.formattedSection=M||null;try{let D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new gn(`Expected value to be one of ${Object.keys(this._enumValues).map(U=>JSON.stringify(U)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function Gu(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in Mc}function tf(h,l){let f=new ku(Mc,Yh,[],l?function(w){let I={color:zr,string:dr,number:Gt,enum:dr,boolean:tr,formatted:Ji,padding:Ru,projectionDefinition:mn,resolvedImage:Cl,variableAnchorOffsetCollection:St};return w.type==="array"?Xr(I[w.value]||Pr,w.length):I[w.type]}(l):void 0),g=f.parse(h,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?wA(new Lc(g,l)):Bc(f.errors)}class rf{constructor(l,f){this.kind=l,this._styleExpression=f,this.isStateDependent=l!=="constant"&&!zl(f.expression)}evaluateWithoutErrorHandling(l,f,g,w,I,M){return this._styleExpression.evaluateWithoutErrorHandling(l,f,g,w,I,M)}evaluate(l,f,g,w,I,M){return this._styleExpression.evaluate(l,f,g,w,I,M)}}class Oc{constructor(l,f,g,w){this.kind=l,this.zoomStops=g,this._styleExpression=f,this.isStateDependent=l!=="camera"&&!zl(f.expression),this.interpolationType=w}evaluateWithoutErrorHandling(l,f,g,w,I,M){return this._styleExpression.evaluateWithoutErrorHandling(l,f,g,w,I,M)}evaluate(l,f,g,w,I,M){return this._styleExpression.evaluate(l,f,g,w,I,M)}interpolationFactor(l,f,g){return this.interpolationType?Ns.interpolationFactor(this.interpolationType,l,f,g):0}}function Ka(h,l){let f=tf(h,l);if(f.result==="error")return f;let g=f.value.expression,w=ju(g);if(!w&&!Ul(l))return Bc([new Er("","data expressions not supported")]);let I=Rc(g,["zoom"]);if(!I&&!Id(l))return Bc([new Er("","zoom expressions not supported")]);let M=Dc(g);return M||I?M instanceof Er?Bc([M]):M instanceof Ns&&!Kh(l)?Bc([new Er("",'"interpolate" expressions cannot be used with this property')]):wA(M?new Oc(w?"camera":"composite",f.value,M.labels,M instanceof Ns?M.interpolation:void 0):new rf(w?"constant":"source",f.value)):Bc([new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hu{constructor(l,f){this._parameters=l,this._specification=f,Dr(this,ls(this._parameters,this._specification))}static deserialize(l){return new Hu(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Dc(h){let l=null;if(h instanceof _i)l=Dc(h.result);else if(h instanceof zu){for(let f of h.args)if(l=Dc(f),l)break}else(h instanceof Nu||h instanceof Ns)&&h.input instanceof Ai&&h.input.name==="zoom"&&(l=h);return l instanceof Er||h.eachChild(f=>{let g=Dc(f);g instanceof Er?l=g:!l&&g?l=new Er("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&g&&l!==g&&(l=new Er("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function Vl(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(let l of h.slice(1))if(!Vl(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}let jl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ca(h){if(h==null)return{filter:()=>!0,needGeometry:!1};Vl(h)||(h=Gl(h));let l=tf(h,jl);if(l.result==="error")throw new Error(l.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,g,w)=>l.value.evaluate(f,g,{},w),needGeometry:nf(h)}}function Rd(h,l){return h<l?-1:h>l?1:0}function nf(h){if(!Array.isArray(h))return!1;if(h[0]==="within"||h[0]==="distance")return!0;for(let l=1;l<h.length;l++)if(nf(h[l]))return!0;return!1}function Gl(h){if(!h)return!0;let l=h[0];return h.length<=1?l!=="any":l==="=="?sf(h[1],h[2],"=="):l==="!="?kc(sf(h[1],h[2],"==")):l==="<"||l===">"||l==="<="||l===">="?sf(h[1],h[2],l):l==="any"?(f=h.slice(1),["any"].concat(f.map(Gl))):l==="all"?["all"].concat(h.slice(1).map(Gl)):l==="none"?["all"].concat(h.slice(1).map(Gl).map(kc)):l==="in"?of(h[1],h.slice(2)):l==="!in"?kc(of(h[1],h.slice(2))):l==="has"?Wu(h[1]):l!=="!has"||kc(Wu(h[1]));var f}function sf(h,l,f){switch(h){case"$type":return[`filter-type-${f}`,l];case"$id":return[`filter-id-${f}`,l];default:return[`filter-${f}`,h,l]}}function of(h,l){if(l.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(f=>typeof f!=typeof l[0])?["filter-in-large",h,["literal",l.sort(Rd)]]:["filter-in-small",h,["literal",l]]}}function Wu(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function kc(h){return["!",h]}function Fc(h){let l=typeof h;if(l==="number"||l==="boolean"||l==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let w="[";for(let I of h)w+=`${Fc(I)},`;return`${w}]`}let f=Object.keys(h).sort(),g="{";for(let w=0;w<f.length;w++)g+=`${JSON.stringify(f[w])}:${Fc(h[f[w]])},`;return`${g}}`}function Gm(h){let l="";for(let f of ze)l+=`/${Fc(h[f])}`;return l}function TA(h){let l=h.value;return l?[new We(h.key,l,"constants have been deprecated as of v8")]:[]}function Rn(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Hl(h){if(Array.isArray(h))return h.map(Hl);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){let l={};for(let f in h)l[f]=Hl(h[f]);return l}return Rn(h)}function So(h){let l=h.key,f=h.value,g=h.valueSpec||{},w=h.objectElementValidators||{},I=h.style,M=h.styleSpec,D=h.validateSpec,U=[],j=wi(f);if(j!=="object")return[new We(l,f,`object expected, ${j} found`)];for(let $ in f){let Y=$.split(".")[0],se=g[Y]||g["*"],le;if(w[Y])le=w[Y];else if(g[Y])le=D;else if(w["*"])le=w["*"];else{if(!g["*"]){U.push(new We(l,f[$],`unknown property "${$}"`));continue}le=D}U=U.concat(le({key:(l&&`${l}.`)+$,value:f[$],valueSpec:se,style:I,styleSpec:M,object:f,objectKey:$,validateSpec:D},f))}for(let $ in g)w[$]||g[$].required&&g[$].default===void 0&&f[$]===void 0&&U.push(new We(l,f,`missing required property "${$}"`));return U}function Bd(h){let l=h.value,f=h.valueSpec,g=h.style,w=h.styleSpec,I=h.key,M=h.arrayElementValidator||h.validateSpec;if(wi(l)!=="array")return[new We(I,l,`array expected, ${wi(l)} found`)];if(f.length&&l.length!==f.length)return[new We(I,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new We(I,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let D={type:f.value,values:f.values};w.$version<7&&(D.function=f.function),wi(f.value)==="object"&&(D=f.value);let U=[];for(let j=0;j<l.length;j++)U=U.concat(M({array:l,arrayIndex:j,value:l[j],valueSpec:D,validateSpec:h.validateSpec,style:g,styleSpec:w,key:`${I}[${j}]`}));return U}function Wl(h){let l=h.key,f=h.value,g=h.valueSpec,w=wi(f);return w==="number"&&f!=f&&(w="NaN"),w!=="number"?[new We(l,f,`number expected, ${w} found`)]:"minimum"in g&&f<g.minimum?[new We(l,f,`${f} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&f>g.maximum?[new We(l,f,`${f} is greater than the maximum value ${g.maximum}`)]:[]}function Ld(h){let l=h.valueSpec,f=Rn(h.value.type),g,w,I,M={},D=f!=="categorical"&&h.value.property===void 0,U=!D,j=wi(h.value.stops)==="array"&&wi(h.value.stops[0])==="array"&&wi(h.value.stops[0][0])==="object",$=So({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(le){if(f==="identity")return[new We(le.key,le.value,'identity function may not have a "stops" property')];let ue=[],pe=le.value;return ue=ue.concat(Bd({key:le.key,value:pe,valueSpec:le.valueSpec,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,arrayElementValidator:Y})),wi(pe)==="array"&&pe.length===0&&ue.push(new We(le.key,pe,"array must have at least one stop")),ue},default:function(le){return le.validateSpec({key:le.key,value:le.value,valueSpec:l,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec})}}});return f==="identity"&&D&&$.push(new We(h.key,h.value,'missing required property "property"')),f==="identity"||h.value.stops||$.push(new We(h.key,h.value,'missing required property "stops"')),f==="exponential"&&h.valueSpec.expression&&!Kh(h.valueSpec)&&$.push(new We(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(U&&!Ul(h.valueSpec)?$.push(new We(h.key,h.value,"property functions not supported")):D&&!Id(h.valueSpec)&&$.push(new We(h.key,h.value,"zoom functions not supported"))),f!=="categorical"&&!j||h.value.property!==void 0||$.push(new We(h.key,h.value,'"property" property is required')),$;function Y(le){let ue=[],pe=le.value,Te=le.key;if(wi(pe)!=="array")return[new We(Te,pe,`array expected, ${wi(pe)} found`)];if(pe.length!==2)return[new We(Te,pe,`array length 2 expected, length ${pe.length} found`)];if(j){if(wi(pe[0])!=="object")return[new We(Te,pe,`object expected, ${wi(pe[0])} found`)];if(pe[0].zoom===void 0)return[new We(Te,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new We(Te,pe,"object stop key must have value")];if(I&&I>Rn(pe[0].zoom))return[new We(Te,pe[0].zoom,"stop zoom values must appear in ascending order")];Rn(pe[0].zoom)!==I&&(I=Rn(pe[0].zoom),w=void 0,M={}),ue=ue.concat(So({key:`${Te}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,objectElementValidators:{zoom:Wl,value:se}}))}else ue=ue.concat(se({key:`${Te}[0]`,value:pe[0],validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec},pe));return Gu(Hl(pe[1]))?ue.concat([new We(`${Te}[1]`,pe[1],"expressions are not allowed in function stops.")]):ue.concat(le.validateSpec({key:`${Te}[1]`,value:pe[1],valueSpec:l,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec}))}function se(le,ue){let pe=wi(le.value),Te=Rn(le.value),Re=le.value!==null?le.value:ue;if(g){if(pe!==g)return[new We(le.key,Re,`${pe} stop domain type must match previous stop domain type ${g}`)]}else g=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new We(le.key,Re,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&f!=="categorical"){let et=`number expected, ${pe} found`;return Ul(l)&&f===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(le.key,Re,et)]}return f!=="categorical"||pe!=="number"||isFinite(Te)&&Math.floor(Te)===Te?f!=="categorical"&&pe==="number"&&w!==void 0&&Te<w?[new We(le.key,Re,"stop domain values must appear in ascending order")]:(w=Te,f==="categorical"&&Te in M?[new We(le.key,Re,"stop domain values must be unique")]:(M[Te]=!0,[])):[new We(le.key,Re,`integer expected, found ${Te}`)]}}function Ea(h){let l=(h.expressionContext==="property"?Ka:tf)(Hl(h.value),h.valueSpec);if(l.result==="error")return l.value.map(g=>new We(`${h.key}${g.key}`,h.value,g.message));let f=l.value.expression||l.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!f.outputDefined())return[new We(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!zl(f))return[new We(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!zl(f))return[new We(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Rc(f,["zoom","feature-state"]))return[new We(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!ju(f))return[new We(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $u(h){let l=h.key,f=h.value,g=h.valueSpec,w=[];return Array.isArray(g.values)?g.values.indexOf(Rn(f))===-1&&w.push(new We(l,f,`expected one of [${g.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(g.values).indexOf(Rn(f))===-1&&w.push(new We(l,f,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(f)} found`)),w}function Qa(h){return Vl(Hl(h.value))?Ea(Dr({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Od(h)}function Od(h){let l=h.value,f=h.key;if(wi(l)!=="array")return[new We(f,l,`array expected, ${wi(l)} found`)];let g=h.styleSpec,w,I=[];if(l.length<1)return[new We(f,l,"filter array must have at least 1 element")];switch(I=I.concat($u({key:`${f}[0]`,value:l[0],valueSpec:g.filter_operator,style:h.style,styleSpec:h.styleSpec})),Rn(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Rn(l[1])==="$type"&&I.push(new We(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&I.push(new We(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(w=wi(l[1]),w!=="string"&&I.push(new We(`${f}[1]`,l[1],`string expected, ${w} found`)));for(let M=2;M<l.length;M++)w=wi(l[M]),Rn(l[1])==="$type"?I=I.concat($u({key:`${f}[${M}]`,value:l[M],valueSpec:g.geometry_type,style:h.style,styleSpec:h.styleSpec})):w!=="string"&&w!=="number"&&w!=="boolean"&&I.push(new We(`${f}[${M}]`,l[M],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let M=1;M<l.length;M++)I=I.concat(Od({key:`${f}[${M}]`,value:l[M],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":w=wi(l[1]),l.length!==2?I.push(new We(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):w!=="string"&&I.push(new We(`${f}[1]`,l[1],`string expected, ${w} found`))}return I}function af(h,l){let f=h.key,g=h.validateSpec,w=h.style,I=h.styleSpec,M=h.value,D=h.objectKey,U=I[`${l}_${h.layerType}`];if(!U)return[];let j=D.match(/^(.*)-transition$/);if(l==="paint"&&j&&U[j[1]]&&U[j[1]].transition)return g({key:f,value:M,valueSpec:I.transition,style:w,styleSpec:I});let $=h.valueSpec||U[D];if(!$)return[new We(f,M,`unknown property "${D}"`)];let Y;if(wi(M)==="string"&&Ul($)&&!$.tokens&&(Y=/^{([^}]+)}$/.exec(M)))return[new We(f,M,`"${D}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];let se=[];return h.layerType==="symbol"&&(D==="text-field"&&w&&!w.glyphs&&se.push(new We(f,M,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&Qh(Hl(M))&&Rn(M.type)==="identity"&&se.push(new We(f,M,'"text-font" does not support identity functions'))),se.concat(g({key:h.key,value:M,valueSpec:$,style:w,styleSpec:I,expressionContext:"property",propertyType:l,propertyKey:D}))}function lf(h){return af(h,"paint")}function Ja(h){return af(h,"layout")}function Nc(h){let l=[],f=h.value,g=h.key,w=h.style,I=h.styleSpec;f.type||f.ref||l.push(new We(g,f,'either "type" or "ref" is required'));let M=Rn(f.type),D=Rn(f.ref);if(f.id){let U=Rn(f.id);for(let j=0;j<h.arrayIndex;j++){let $=w.layers[j];Rn($.id)===U&&l.push(new We(g,f.id,`duplicate layer id "${f.id}", previously used at line ${$.id.__line__}`))}}if("ref"in f){let U;["type","source","source-layer","filter","layout"].forEach(j=>{j in f&&l.push(new We(g,f[j],`"${j}" is prohibited for ref layers`))}),w.layers.forEach(j=>{Rn(j.id)===D&&(U=j)}),U?U.ref?l.push(new We(g,f.ref,"ref cannot reference another ref layer")):M=Rn(U.type):l.push(new We(g,f.ref,`ref layer "${D}" not found`))}else if(M!=="background")if(f.source){let U=w.sources&&w.sources[f.source],j=U&&Rn(U.type);U?j==="vector"&&M==="raster"?l.push(new We(g,f.source,`layer "${f.id}" requires a raster source`)):j!=="raster-dem"&&M==="hillshade"?l.push(new We(g,f.source,`layer "${f.id}" requires a raster-dem source`)):j==="raster"&&M!=="raster"?l.push(new We(g,f.source,`layer "${f.id}" requires a vector source`)):j!=="vector"||f["source-layer"]?j==="raster-dem"&&M!=="hillshade"?l.push(new We(g,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!f.paint||!f.paint["line-gradient"]||j==="geojson"&&U.lineMetrics||l.push(new We(g,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new We(g,f,`layer "${f.id}" must specify a "source-layer"`)):l.push(new We(g,f.source,`source "${f.source}" not found`))}else l.push(new We(g,f,'missing required property "source"'));return l=l.concat(So({key:g,value:f,valueSpec:I.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${g}.type`,value:f.type,valueSpec:I.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:f,objectKey:"type"}),filter:Qa,layout:U=>So({layer:f,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":j=>Ja(Dr({layerType:M},j))}}),paint:U=>So({layer:f,key:U.key,value:U.value,style:U.style,styleSpec:U.styleSpec,validateSpec:U.validateSpec,objectElementValidators:{"*":j=>lf(Dr({layerType:M},j))}})}})),l}function Sa(h){let l=h.value,f=h.key,g=wi(l);return g!=="string"?[new We(f,l,`string expected, ${g} found`)]:[]}let Dd={promoteId:function({key:h,value:l}){if(wi(l)==="string")return Sa({key:h,value:l});{let f=[];for(let g in l)f.push(...Sa({key:`${h}.${g}`,value:l[g]}));return f}}};function EA(h){let l=h.value,f=h.key,g=h.styleSpec,w=h.style,I=h.validateSpec;if(!l.type)return[new We(f,l,'"type" is required')];let M=Rn(l.type),D;switch(M){case"vector":case"raster":return D=So({key:f,value:l,valueSpec:g[`source_${M.replace("-","_")}`],style:h.style,styleSpec:g,objectElementValidators:Dd,validateSpec:I}),D;case"raster-dem":return D=function(U){var j;let $=(j=U.sourceName)!==null&&j!==void 0?j:"",Y=U.value,se=U.styleSpec,le=se.source_raster_dem,ue=U.style,pe=[],Te=wi(Y);if(Y===void 0)return pe;if(Te!=="object")return pe.push(new We("source_raster_dem",Y,`object expected, ${Te} found`)),pe;let Re=Rn(Y.encoding)==="custom",et=["redFactor","greenFactor","blueFactor","baseShift"],Ne=U.value.encoding?`"${U.value.encoding}"`:"Default";for(let oe in Y)!Re&&et.includes(oe)?pe.push(new We(oe,Y[oe],`In "${$}": "${oe}" is only valid when "encoding" is set to "custom". ${Ne} encoding found`)):le[oe]?pe=pe.concat(U.validateSpec({key:oe,value:Y[oe],valueSpec:le[oe],validateSpec:U.validateSpec,style:ue,styleSpec:se})):pe.push(new We(oe,Y[oe],`unknown property "${oe}"`));return pe}({sourceName:f,value:l,style:h.style,styleSpec:g,validateSpec:I}),D;case"geojson":if(D=So({key:f,value:l,valueSpec:g.source_geojson,style:w,styleSpec:g,validateSpec:I,objectElementValidators:Dd}),l.cluster)for(let U in l.clusterProperties){let[j,$]=l.clusterProperties[U],Y=typeof j=="string"?[j,["accumulated"],["get",U]]:j;D.push(...Ea({key:`${f}.${U}.map`,value:$,expressionContext:"cluster-map"})),D.push(...Ea({key:`${f}.${U}.reduce`,value:Y,expressionContext:"cluster-reduce"}))}return D;case"video":return So({key:f,value:l,valueSpec:g.source_video,style:w,validateSpec:I,styleSpec:g});case"image":return So({key:f,value:l,valueSpec:g.source_image,style:w,validateSpec:I,styleSpec:g});case"canvas":return[new We(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $u({key:`${f}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function kd(h){let l=h.value,f=h.styleSpec,g=f.light,w=h.style,I=[],M=wi(l);if(l===void 0)return I;if(M!=="object")return I=I.concat([new We("light",l,`object expected, ${M} found`)]),I;for(let D in l){let U=D.match(/^(.*)-transition$/);I=I.concat(U&&g[U[1]]&&g[U[1]].transition?h.validateSpec({key:D,value:l[D],valueSpec:f.transition,validateSpec:h.validateSpec,style:w,styleSpec:f}):g[D]?h.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:h.validateSpec,style:w,styleSpec:f}):[new We(D,l[D],`unknown property "${D}"`)])}return I}function cf(h){let l=h.value,f=h.styleSpec,g=f.sky,w=h.style,I=wi(l);if(l===void 0)return[];if(I!=="object")return[new We("sky",l,`object expected, ${I} found`)];let M=[];for(let D in l)M=M.concat(g[D]?h.validateSpec({key:D,value:l[D],valueSpec:g[D],style:w,styleSpec:f}):[new We(D,l[D],`unknown property "${D}"`)]);return M}function uf(h){let l=h.value,f=h.styleSpec,g=f.terrain,w=h.style,I=[],M=wi(l);if(l===void 0)return I;if(M!=="object")return I=I.concat([new We("terrain",l,`object expected, ${M} found`)]),I;for(let D in l)I=I.concat(g[D]?h.validateSpec({key:D,value:l[D],valueSpec:g[D],validateSpec:h.validateSpec,style:w,styleSpec:f}):[new We(D,l[D],`unknown property "${D}"`)]);return I}function Ca(h){let l=[],f=h.value,g=h.key;if(Array.isArray(f)){let w=[],I=[];for(let M in f)f[M].id&&w.includes(f[M].id)&&l.push(new We(g,f,`all the sprites' ids must be unique, but ${f[M].id} is duplicated`)),w.push(f[M].id),f[M].url&&I.includes(f[M].url)&&l.push(new We(g,f,`all the sprites' URLs must be unique, but ${f[M].url} is duplicated`)),I.push(f[M].url),l=l.concat(So({key:`${g}[${M}]`,value:f[M],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return l}return Sa({key:g,value:f})}let Vi={"*":()=>[],array:Bd,boolean:function(h){let l=h.value,f=h.key,g=wi(l);return g!=="boolean"?[new We(f,l,`boolean expected, ${g} found`)]:[]},number:Wl,color:function(h){let l=h.key,f=h.value,g=wi(f);return g!=="string"?[new We(l,f,`color expected, ${g} found`)]:bi.parse(String(f))?[]:[new We(l,f,`color expected, "${f}" found`)]},constants:TA,enum:$u,filter:Qa,function:Ld,layer:Nc,object:So,source:EA,light:kd,sky:cf,terrain:uf,projection:function(h){let l=h.value,f=h.styleSpec,g=f.projection,w=h.style,I=wi(l);if(l===void 0)return[];if(I!=="object")return[new We("projection",l,`object expected, ${I} found`)];let M=[];for(let D in l)M=M.concat(g[D]?h.validateSpec({key:D,value:l[D],valueSpec:g[D],style:w,styleSpec:f}):[new We(D,l[D],`unknown property "${D}"`)]);return M},projectionDefinition:function(h){let l=h.key,f=h.value;f=f instanceof String?f.valueOf():f;let g=wi(f);return g!=="array"||function(w){return Array.isArray(w)&&w.length===3&&typeof w[0]=="string"&&typeof w[1]=="string"&&typeof w[2]=="number"}(f)||function(w){return!!["interpolate","step","literal"].includes(w[0])}(f)?["array","string"].includes(g)?[]:[new We(l,f,`projection expected, invalid type "${g}" found`)]:[new We(l,f,`projection expected, invalid array ${JSON.stringify(f)} found`)]},string:Sa,formatted:function(h){return Sa(h).length===0?[]:Ea(h)},resolvedImage:function(h){return Sa(h).length===0?[]:Ea(h)},padding:function(h){let l=h.key,f=h.value;if(wi(f)==="array"){if(f.length<1||f.length>4)return[new We(l,f,`padding requires 1 to 4 values; ${f.length} values found`)];let g={type:"number"},w=[];for(let I=0;I<f.length;I++)w=w.concat(h.validateSpec({key:`${l}[${I}]`,value:f[I],validateSpec:h.validateSpec,valueSpec:g}));return w}return Wl({key:l,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(h){let l=h.key,f=h.value,g=wi(f),w=h.styleSpec;if(g!=="array"||f.length<1||f.length%2!=0)return[new We(l,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let I=[];for(let M=0;M<f.length;M+=2)I=I.concat($u({key:`${l}[${M}]`,value:f[M],valueSpec:w.layout_symbol["text-anchor"]})),I=I.concat(Bd({key:`${l}[${M+1}]`,value:f[M+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:w}));return I},sprite:Ca};function Ts(h){let l=h.value,f=h.valueSpec,g=h.styleSpec;return h.validateSpec=Ts,f.expression&&Qh(Rn(l))?Ld(h):f.expression&&Gu(Hl(l))?Ea(h):f.type&&Vi[f.type]?Vi[f.type](h):So(Dr({},h,{valueSpec:f.type?g[f.type]:f}))}function zc(h){let l=h.value,f=h.key,g=Sa(h);return g.length||(l.indexOf("{fontstack}")===-1&&g.push(new We(f,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&g.push(new We(f,l,'"glyphs" url must include a "{range}" token'))),g}function Co(h,l=ce){let f=[];return f=f.concat(Ts({key:"",value:h,valueSpec:l.$root,styleSpec:l,style:h,validateSpec:Ts,objectElementValidators:{glyphs:zc,"*":()=>[]}})),h.constants&&(f=f.concat(TA({key:"constants",value:h.constants}))),SA(f)}function ua(h){return function(l){return h({...l,validateSpec:Ts})}}function SA(h){return[].concat(h).sort((l,f)=>l.line-f.line)}function eo(h){return function(...l){return SA(h.apply(this,l))}}Co.source=eo(ua(EA)),Co.sprite=eo(ua(Ca)),Co.glyphs=eo(ua(zc)),Co.light=eo(ua(kd)),Co.sky=eo(ua(cf)),Co.terrain=eo(ua(uf)),Co.layer=eo(ua(Nc)),Co.filter=eo(ua(Qa)),Co.paintProperty=eo(ua(lf)),Co.layoutProperty=eo(ua(Ja));let $l=Co,Es=$l.light,Fd=$l.sky,Ia=$l.paintProperty,Hm=$l.layoutProperty;function el(h,l){let f=!1;if(l&&l.length)for(let g of l)h.fire(new de(new Error(g.message))),f=!0;return f}class qu{constructor(l,f,g){let w=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;let M=new Int32Array(this.arrayBuffer);l=M[0],this.d=(f=M[1])+2*(g=M[2]);for(let U=0;U<this.d*this.d;U++){let j=M[3+U],$=M[3+U+1];w.push(j===$?null:M.subarray(j,$))}let D=M[3+w.length+1];this.keys=M.subarray(M[3+w.length],D),this.bboxes=M.subarray(D),this.insert=this._insertReadonly}else{this.d=f+2*g;for(let M=0;M<this.d*this.d;M++)w.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=l,this.padding=g,this.scale=f/l,this.uid=0;let I=g/f*l;this.min=-I,this.max=l+I}insert(l,f,g,w,I){this._forEachCell(f,g,w,I,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w),this.bboxes.push(I)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,f,g,w,I,M){this.cells[I].push(M)}query(l,f,g,w,I){let M=this.min,D=this.max;if(l<=M&&f<=M&&D<=g&&D<=w&&!I)return Array.prototype.slice.call(this.keys);{let U=[];return this._forEachCell(l,f,g,w,this._queryCell,U,{},I),U}}_queryCell(l,f,g,w,I,M,D,U){let j=this.cells[I];if(j!==null){let $=this.keys,Y=this.bboxes;for(let se=0;se<j.length;se++){let le=j[se];if(D[le]===void 0){let ue=4*le;(U?U(Y[ue+0],Y[ue+1],Y[ue+2],Y[ue+3]):l<=Y[ue+2]&&f<=Y[ue+3]&&g>=Y[ue+0]&&w>=Y[ue+1])?(D[le]=!0,M.push($[le])):D[le]=!1}}}}_forEachCell(l,f,g,w,I,M,D,U){let j=this._convertToCellCoord(l),$=this._convertToCellCoord(f),Y=this._convertToCellCoord(g),se=this._convertToCellCoord(w);for(let le=j;le<=Y;le++)for(let ue=$;ue<=se;ue++){let pe=this.d*ue+le;if((!U||U(this._convertFromCellCoord(le),this._convertFromCellCoord(ue),this._convertFromCellCoord(le+1),this._convertFromCellCoord(ue+1)))&&I.call(this,l,f,g,w,pe,M,D,U))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let l=this.cells,f=3+this.cells.length+1+1,g=0;for(let M=0;M<this.cells.length;M++)g+=this.cells[M].length;let w=new Int32Array(f+g+this.keys.length+this.bboxes.length);w[0]=this.extent,w[1]=this.n,w[2]=this.padding;let I=f;for(let M=0;M<l.length;M++){let D=l[M];w[3+M]=I,w.set(D,I),I+=D.length}return w[3+l.length]=I,w.set(this.keys,I),I+=this.keys.length,w[3+l.length+1]=I,w.set(this.bboxes,I),I+=this.bboxes.length,w.buffer}static serialize(l,f){let g=l.toArrayBuffer();return f&&f.push(g),{buffer:g}}static deserialize(l){return new qu(l.buffer)}}let yn={};function ur(h,l,f={}){if(yn[h])throw new Error(`${h} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:h,writeable:!1}),yn[h]={klass:l,omit:f.omit||[],shallow:f.shallow||[]}}ur("Object",Object),ur("TransferableGridIndex",qu),ur("Color",bi),ur("Error",Error),ur("AJAXError",Tr),ur("ResolvedImage",Ao),ur("StylePropertyFunction",Hu),ur("StyleExpression",Lc,{omit:["_evaluator"]}),ur("ZoomDependentExpression",Oc),ur("ZoomConstantExpression",rf),ur("CompoundExpression",Ai,{omit:["_evaluate"]});for(let h in Mc)Mc[h]._classRegistryKey||ur(`Expression_${h}`,Mc[h]);function hf(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Vo(h){return h.$name||h.constructor._classRegistryKey}function Uc(h){return!function(l){if(l===null||typeof l!="object")return!1;let f=Vo(l);return!(!f||f==="Object")}(h)&&(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||h instanceof Error||hf(h)||Qi(h)||ArrayBuffer.isView(h)||h instanceof ImageData)}function jo(h,l){if(Uc(h))return(hf(h)||Qi(h))&&l&&l.push(h),ArrayBuffer.isView(h)&&l&&l.push(h.buffer),h instanceof ImageData&&l&&l.push(h.data.buffer),h;if(Array.isArray(h)){let I=[];for(let M of h)I.push(jo(M,l));return I}if(typeof h!="object")throw new Error("can't serialize object of type "+typeof h);let f=Vo(h);if(!f)throw new Error(`can't serialize object of unregistered class ${h.constructor.name}`);if(!yn[f])throw new Error(`${f} is not registered.`);let{klass:g}=yn[f],w=g.serialize?g.serialize(h,l):{};if(g.serialize){if(l&&w===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let I in h){if(!h.hasOwnProperty(I)||yn[f].omit.indexOf(I)>=0)continue;let M=h[I];w[I]=yn[f].shallow.indexOf(I)>=0?M:jo(M,l)}h instanceof Error&&(w.message=h.message)}if(w.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(w.$name=f),w}function tl(h){if(Uc(h))return h;if(Array.isArray(h))return h.map(tl);if(typeof h!="object")throw new Error("can't deserialize object of type "+typeof h);let l=Vo(h)||"Object";if(!yn[l])throw new Error(`can't deserialize unregistered class ${l}`);let{klass:f}=yn[l];if(!f)throw new Error(`can't deserialize unregistered class ${l}`);if(f.deserialize)return f.deserialize(h);let g=Object.create(f.prototype);for(let w of Object.keys(h)){if(w==="$name")continue;let I=h[w];g[w]=yn[l].shallow.indexOf(w)>=0?I:tl(I)}return g}class ff{constructor(){this.first=!0}update(l,f){let g=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=f),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=g,!0))}}let oi={"Latin-1 Supplement":h=>h>=128&&h<=255,"Hangul Jamo":h=>h>=4352&&h<=4607,Khmer:h=>h>=6016&&h<=6143,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Kanbun:h=>h>=12688&&h<=12703,"CJK Strokes":h=>h>=12736&&h<=12783,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Hangul Syllables":h=>h>=44032&&h<=55215,"Private Use Area":h=>h>=57344&&h<=63743,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Vc(h){for(let l of h)if(rl(l.charCodeAt(0)))return!0;return!1}function CA(h){for(let l of h)if(!IA(l.charCodeAt(0)))return!1;return!0}function Zu(h){let l=h.map(f=>{try{return new RegExp(`\\p{sc=${f}}`,"u").source}catch{return null}}).filter(f=>f);return new RegExp(l.join("|"),"u")}let Nd=Zu(["Arab","Dupl","Mong","Ougr","Syrc"]);function IA(h){return!Nd.test(String.fromCodePoint(h))}let ql=Zu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function rl(h){return!(h!==746&&h!==747&&(h<4352||!(oi["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||oi["CJK Compatibility"](h)||oi["CJK Strokes"](h)||!(!oi["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||oi["Enclosed CJK Letters and Months"](h)||oi["Ideographic Description Characters"](h)||oi.Kanbun(h)||oi.Katakana(h)&&h!==12540||!(!oi["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!oi["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||oi["Vertical Forms"](h)||oi["Yijing Hexagram Symbols"](h)||/\p{sc=Cans}/u.test(String.fromCodePoint(h))||/\p{sc=Hang}/u.test(String.fromCodePoint(h))||ql.test(String.fromCodePoint(h)))))}function zd(h){return!(rl(h)||function(l){return!!(oi["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||oi["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||oi["Letterlike Symbols"](l)||oi["Number Forms"](l)||oi["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||oi["Control Pictures"](l)&&l!==9251||oi["Optical Character Recognition"](l)||oi["Enclosed Alphanumerics"](l)||oi["Geometric Shapes"](l)||oi["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||oi["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||oi["CJK Symbols and Punctuation"](l)||oi.Katakana(l)||oi["Private Use Area"](l)||oi["CJK Compatibility Forms"](l)||oi["Small Form Variants"](l)||oi["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(h))}let jc=Zu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ud(h){return jc.test(String.fromCodePoint(h))}function Wm(h,l){return!(!l&&Ud(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||oi.Khmer(h))}function $m(h){for(let l of h)if(Ud(l.charCodeAt(0)))return!0;return!1}let Pa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(h){this.pluginStatus=h.pluginStatus,this.pluginURL=h.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(h){if(Pa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=h.applyArabicShaping,this.processBidirectionalText=h.processBidirectionalText,this.processStyledBidirectionalText=h.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(h,l){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(h.pluginStatus!=="loading")return this.setState(h),h;let f=h.pluginURL,g=new Promise(I=>{this.loadScriptResolve=I});l(f);let w=new Promise(I=>setTimeout(()=>I(),this.TIMEOUT));if(yield Promise.race([g,w]),this.isParsed()){let I={pluginStatus:"loaded",pluginURL:f};return this.setState(I),I}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${f}`)})}};class an{constructor(l,f){this.zoom=l,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ff,this.transition={})}isSupportedScript(l){return function(f,g){for(let w of f)if(!Wm(w.charCodeAt(0),g))return!1;return!0}(l,Pa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let l=this.zoom,f=l-Math.floor(l),g=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*f}}}class Xu{constructor(l,f){this.property=l,this.value=f,this.expression=function(g,w){if(Qh(g))return new Hu(g,w);if(Gu(g)){let I=Ka(g,w);if(I.result==="error")throw new Error(I.value.map(M=>`${M.key}: ${M.message}`).join(", "));return I.value}{let I=g;return w.type==="color"&&typeof g=="string"?I=bi.parse(g):w.type!=="padding"||typeof g!="number"&&!Array.isArray(g)?w.type==="variableAnchorOffsetCollection"&&Array.isArray(g)?I=Qs.parse(g):w.type==="projectionDefinition"&&typeof g=="string"&&(I=es.parse(g)):I=vs.parse(g),{kind:"constant",evaluate:()=>I}}}(f===void 0?l.specification.default:f,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,f,g){return this.property.possiblyEvaluate(this,l,f,g)}}class df{constructor(l){this.property=l,this.value=new Xu(l,void 0)}transitioned(l,f){return new Vd(this.property,this.value,f,qt({},l.transition,this.transition),l.now)}untransitioned(){return new Vd(this.property,this.value,null,{},0)}}class Zl{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return Or(this._values[l].value.value)}setValue(l,f){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new df(this._values[l].property)),this._values[l].value=new Xu(this._values[l].property,f===null?void 0:Or(f))}getTransition(l){return Or(this._values[l].transition)}setTransition(l,f){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new df(this._values[l].property)),this._values[l].transition=Or(f)||void 0}serialize(){let l={};for(let f of Object.keys(this._values)){let g=this.getValue(f);g!==void 0&&(l[f]=g);let w=this.getTransition(f);w!==void 0&&(l[`${f}-transition`]=w)}return l}transitioned(l,f){let g=new Gc(this._properties);for(let w of Object.keys(this._values))g._values[w]=this._values[w].transitioned(l,f._values[w]);return g}untransitioned(){let l=new Gc(this._properties);for(let f of Object.keys(this._values))l._values[f]=this._values[f].untransitioned();return l}}class Vd{constructor(l,f,g,w,I){this.property=l,this.value=f,this.begin=I+w.delay||0,this.end=this.begin+w.duration||0,l.specification.transition&&(w.delay||w.duration)&&(this.prior=g)}possiblyEvaluate(l,f,g){let w=l.now||0,I=this.value.possiblyEvaluate(l,f,g),M=this.prior;if(M){if(w>this.end)return this.prior=null,I;if(this.value.isDataDriven())return this.prior=null,I;if(w<this.begin)return M.possiblyEvaluate(l,f,g);{let D=(w-this.begin)/(this.end-this.begin);return this.property.interpolate(M.possiblyEvaluate(l,f,g),I,tt(D))}}return I}}class Gc{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,f,g){let w=new Yu(this._properties);for(let I of Object.keys(this._values))w._values[I]=this._values[I].possiblyEvaluate(l,f,g);return w}hasTransition(){for(let l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class qm{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return Or(this._values[l].value)}setValue(l,f){this._values[l]=new Xu(this._values[l].property,f===null?void 0:Or(f))}serialize(){let l={};for(let f of Object.keys(this._values)){let g=this.getValue(f);g!==void 0&&(l[f]=g)}return l}possiblyEvaluate(l,f,g){let w=new Yu(this._properties);for(let I of Object.keys(this._values))w._values[I]=this._values[I].possiblyEvaluate(l,f,g);return w}}class ha{constructor(l,f,g){this.property=l,this.value=f,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,f,g,w){return this.property.evaluate(this.value,this.parameters,l,f,g,w)}}class Yu{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class yr{constructor(l){this.specification=l}possiblyEvaluate(l,f){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(f)}interpolate(l,f,g){let w=na[this.specification.type];return w?w(l,f,g):l}}class Mr{constructor(l,f){this.specification=l,this.overrides=f}possiblyEvaluate(l,f,g,w){return new ha(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(f,null,{},g,w)}:l.expression,f)}interpolate(l,f,g){if(l.value.kind!=="constant"||f.value.kind!=="constant")return l;if(l.value.value===void 0||f.value.value===void 0)return new ha(this,{kind:"constant",value:void 0},l.parameters);let w=na[this.specification.type];if(w){let I=w(l.value.value,f.value.value,g);return new ha(this,{kind:"constant",value:I},l.parameters)}return l}evaluate(l,f,g,w,I,M){return l.kind==="constant"?l.value:l.evaluate(f,g,w,I,M)}}class pf extends Mr{possiblyEvaluate(l,f,g,w){if(l.value===void 0)return new ha(this,{kind:"constant",value:void 0},f);if(l.expression.kind==="constant"){let I=l.expression.evaluate(f,null,{},g,w),M=l.property.specification.type==="resolvedImage"&&typeof I!="string"?I.name:I,D=this._calculate(M,M,M,f);return new ha(this,{kind:"constant",value:D},f)}if(l.expression.kind==="camera"){let I=this._calculate(l.expression.evaluate({zoom:f.zoom-1}),l.expression.evaluate({zoom:f.zoom}),l.expression.evaluate({zoom:f.zoom+1}),f);return new ha(this,{kind:"constant",value:I},f)}return new ha(this,l.expression,f)}evaluate(l,f,g,w,I,M){if(l.kind==="source"){let D=l.evaluate(f,g,w,I,M);return this._calculate(D,D,D,f)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(f.zoom)-1},g,w),l.evaluate({zoom:Math.floor(f.zoom)},g,w),l.evaluate({zoom:Math.floor(f.zoom)+1},g,w),f):l.value}_calculate(l,f,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:f}:{from:g,to:f}}interpolate(l){return l}}class jd{constructor(l){this.specification=l}possiblyEvaluate(l,f,g,w){if(l.value!==void 0){if(l.expression.kind==="constant"){let I=l.expression.evaluate(f,null,{},g,w);return this._calculate(I,I,I,f)}return this._calculate(l.expression.evaluate(new an(Math.floor(f.zoom-1),f)),l.expression.evaluate(new an(Math.floor(f.zoom),f)),l.expression.evaluate(new an(Math.floor(f.zoom+1),f)),f)}}_calculate(l,f,g,w){return w.zoom>w.zoomHistory.lastIntegerZoom?{from:l,to:f}:{from:g,to:f}}interpolate(l){return l}}class Af{constructor(l){this.specification=l}possiblyEvaluate(l,f,g,w){return!!l.expression.evaluate(f,null,{},g,w)}interpolate(){return!1}}class to{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let f in l){let g=l[f];g.specification.overridable&&this.overridableProperties.push(f);let w=this.defaultPropertyValues[f]=new Xu(g,void 0),I=this.defaultTransitionablePropertyValues[f]=new df(g);this.defaultTransitioningPropertyValues[f]=I.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=w.possiblyEvaluate({})}}}ur("DataDrivenProperty",Mr),ur("DataConstantProperty",yr),ur("CrossFadedDataDrivenProperty",pf),ur("CrossFadedProperty",jd),ur("ColorRampProperty",Af);let Gd="-transition";class Sn extends ge{constructor(l,f){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),f.layout&&(this._unevaluatedLayout=new qm(f.layout)),f.paint)){this._transitionablePaint=new Zl(f.paint);for(let g in l.paint)this.setPaintProperty(g,l.paint[g],{validate:!1});for(let g in l.layout)this.setLayoutProperty(g,l.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yu(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,f,g={}){f!=null&&this._validate(Hm,`layers.${this.id}.layout.${l}`,l,f,g)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,f):this.visibility=f)}getPaintProperty(l){return l.endsWith(Gd)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,f,g={}){if(f!=null&&this._validate(Ia,`layers.${this.id}.paint.${l}`,l,f,g))return!1;if(l.endsWith(Gd))return this._transitionablePaint.setTransition(l.slice(0,-11),f||void 0),!1;{let w=this._transitionablePaint._values[l],I=w.property.specification["property-type"]==="cross-faded-data-driven",M=w.value.isDataDriven(),D=w.value;this._transitionablePaint.setValue(l,f),this._handleSpecialPaintPropertyUpdate(l);let U=this._transitionablePaint._values[l].value;return U.isDataDriven()||M||I||this._handleOverridablePaintPropertyUpdate(l,D,U)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,f,g){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,f){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,f)}serialize(){let l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Lr(l,(f,g)=>!(f===void 0||g==="layout"&&!Object.keys(f).length||g==="paint"&&!Object.keys(f).length))}_validate(l,f,g,w,I={}){return(!I||I.validate!==!1)&&el(this,l.call($l,{key:f,layerType:this.type,objectKey:g,value:w,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let l in this.paint._values){let f=this.paint.get(l);if(f instanceof ha&&Ul(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}let PA={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ku{constructor(l,f){this._structArray=l,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Cn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,f){return l._trim(),f&&(l.isTransferred=!0,f.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){let f=Object.create(this.prototype);return f.arrayBuffer=l.arrayBuffer,f.length=l.length,f.capacity=l.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Bn(h,l=1){let f=0,g=0;return{members:h.map(w=>{let I=PA[w.type].BYTES_PER_ELEMENT,M=f=MA(f,Math.max(l,I)),D=w.components||1;return g=Math.max(g,I),f+=I*D,{name:w.name,type:w.type,components:D,offset:M}}),size:MA(f,Math.max(g,l)),alignment:l}}function MA(h,l){return Math.ceil(h/l)*l}class Qu extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f){let g=this.length;return this.resize(g+1),this.emplace(g,l,f)}emplace(l,f,g){let w=2*l;return this.int16[w+0]=f,this.int16[w+1]=g,l}}Qu.prototype.bytesPerElement=4,ur("StructArrayLayout2i4",Qu);class cs extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,f,g)}emplace(l,f,g,w){let I=3*l;return this.int16[I+0]=f,this.int16[I+1]=g,this.int16[I+2]=w,l}}cs.prototype.bytesPerElement=6,ur("StructArrayLayout3i6",cs);class Ju extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,g,w){let I=this.length;return this.resize(I+1),this.emplace(I,l,f,g,w)}emplace(l,f,g,w,I){let M=4*l;return this.int16[M+0]=f,this.int16[M+1]=g,this.int16[M+2]=w,this.int16[M+3]=I,l}}Ju.prototype.bytesPerElement=8,ur("StructArrayLayout4i8",Ju);class Hc extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M){let D=this.length;return this.resize(D+1),this.emplace(D,l,f,g,w,I,M)}emplace(l,f,g,w,I,M,D){let U=6*l;return this.int16[U+0]=f,this.int16[U+1]=g,this.int16[U+2]=w,this.int16[U+3]=I,this.int16[U+4]=M,this.int16[U+5]=D,l}}Hc.prototype.bytesPerElement=12,ur("StructArrayLayout2i4i12",Hc);class mf extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M){let D=this.length;return this.resize(D+1),this.emplace(D,l,f,g,w,I,M)}emplace(l,f,g,w,I,M,D){let U=4*l,j=8*l;return this.int16[U+0]=f,this.int16[U+1]=g,this.uint8[j+4]=w,this.uint8[j+5]=I,this.uint8[j+6]=M,this.uint8[j+7]=D,l}}mf.prototype.bytesPerElement=8,ur("StructArrayLayout2i4ub8",mf);class Xl extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f){let g=this.length;return this.resize(g+1),this.emplace(g,l,f)}emplace(l,f,g){let w=2*l;return this.float32[w+0]=f,this.float32[w+1]=g,l}}Xl.prototype.bytesPerElement=8,ur("StructArrayLayout2f8",Xl);class Hd extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M,D,U,j,$){let Y=this.length;return this.resize(Y+1),this.emplace(Y,l,f,g,w,I,M,D,U,j,$)}emplace(l,f,g,w,I,M,D,U,j,$,Y){let se=10*l;return this.uint16[se+0]=f,this.uint16[se+1]=g,this.uint16[se+2]=w,this.uint16[se+3]=I,this.uint16[se+4]=M,this.uint16[se+5]=D,this.uint16[se+6]=U,this.uint16[se+7]=j,this.uint16[se+8]=$,this.uint16[se+9]=Y,l}}Hd.prototype.bytesPerElement=20,ur("StructArrayLayout10ui20",Hd);class Wc extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M,D,U,j,$,Y,se){let le=this.length;return this.resize(le+1),this.emplace(le,l,f,g,w,I,M,D,U,j,$,Y,se)}emplace(l,f,g,w,I,M,D,U,j,$,Y,se,le){let ue=12*l;return this.int16[ue+0]=f,this.int16[ue+1]=g,this.int16[ue+2]=w,this.int16[ue+3]=I,this.uint16[ue+4]=M,this.uint16[ue+5]=D,this.uint16[ue+6]=U,this.uint16[ue+7]=j,this.int16[ue+8]=$,this.int16[ue+9]=Y,this.int16[ue+10]=se,this.int16[ue+11]=le,l}}Wc.prototype.bytesPerElement=24,ur("StructArrayLayout4i4ui4i24",Wc);class Yl extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,f,g)}emplace(l,f,g,w){let I=3*l;return this.float32[I+0]=f,this.float32[I+1]=g,this.float32[I+2]=w,l}}Yl.prototype.bytesPerElement=12,ur("StructArrayLayout3f12",Yl);class Wd extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){let f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint32[1*l+0]=f,l}}Wd.prototype.bytesPerElement=4,ur("StructArrayLayout1ul4",Wd);class gf extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M,D,U,j){let $=this.length;return this.resize($+1),this.emplace($,l,f,g,w,I,M,D,U,j)}emplace(l,f,g,w,I,M,D,U,j,$){let Y=10*l,se=5*l;return this.int16[Y+0]=f,this.int16[Y+1]=g,this.int16[Y+2]=w,this.int16[Y+3]=I,this.int16[Y+4]=M,this.int16[Y+5]=D,this.uint32[se+3]=U,this.uint16[Y+8]=j,this.uint16[Y+9]=$,l}}gf.prototype.bytesPerElement=20,ur("StructArrayLayout6i1ul2ui20",gf);class Kl extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M){let D=this.length;return this.resize(D+1),this.emplace(D,l,f,g,w,I,M)}emplace(l,f,g,w,I,M,D){let U=6*l;return this.int16[U+0]=f,this.int16[U+1]=g,this.int16[U+2]=w,this.int16[U+3]=I,this.int16[U+4]=M,this.int16[U+5]=D,l}}Kl.prototype.bytesPerElement=12,ur("StructArrayLayout2i2i2i12",Kl);class $d extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I){let M=this.length;return this.resize(M+1),this.emplace(M,l,f,g,w,I)}emplace(l,f,g,w,I,M){let D=4*l,U=8*l;return this.float32[D+0]=f,this.float32[D+1]=g,this.float32[D+2]=w,this.int16[U+6]=I,this.int16[U+7]=M,l}}$d.prototype.bytesPerElement=16,ur("StructArrayLayout2f1f2i16",$d);class qd extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M){let D=this.length;return this.resize(D+1),this.emplace(D,l,f,g,w,I,M)}emplace(l,f,g,w,I,M,D){let U=16*l,j=4*l,$=8*l;return this.uint8[U+0]=f,this.uint8[U+1]=g,this.float32[j+1]=w,this.float32[j+2]=I,this.int16[$+6]=M,this.int16[$+7]=D,l}}qd.prototype.bytesPerElement=16,ur("StructArrayLayout2ub2f2i16",qd);class eh extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,f,g)}emplace(l,f,g,w){let I=3*l;return this.uint16[I+0]=f,this.uint16[I+1]=g,this.uint16[I+2]=w,l}}eh.prototype.bytesPerElement=6,ur("StructArrayLayout3ui6",eh);class _f extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M,D,U,j,$,Y,se,le,ue,pe,Te,Re){let et=this.length;return this.resize(et+1),this.emplace(et,l,f,g,w,I,M,D,U,j,$,Y,se,le,ue,pe,Te,Re)}emplace(l,f,g,w,I,M,D,U,j,$,Y,se,le,ue,pe,Te,Re,et){let Ne=24*l,oe=12*l,xe=48*l;return this.int16[Ne+0]=f,this.int16[Ne+1]=g,this.uint16[Ne+2]=w,this.uint16[Ne+3]=I,this.uint32[oe+2]=M,this.uint32[oe+3]=D,this.uint32[oe+4]=U,this.uint16[Ne+10]=j,this.uint16[Ne+11]=$,this.uint16[Ne+12]=Y,this.float32[oe+7]=se,this.float32[oe+8]=le,this.uint8[xe+36]=ue,this.uint8[xe+37]=pe,this.uint8[xe+38]=Te,this.uint32[oe+10]=Re,this.int16[Ne+22]=et,l}}_f.prototype.bytesPerElement=48,ur("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_f);class S extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,g,w,I,M,D,U,j,$,Y,se,le,ue,pe,Te,Re,et,Ne,oe,xe,He,xt,Ht,Et,Rt,Yt,$t){let Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,l,f,g,w,I,M,D,U,j,$,Y,se,le,ue,pe,Te,Re,et,Ne,oe,xe,He,xt,Ht,Et,Rt,Yt,$t)}emplace(l,f,g,w,I,M,D,U,j,$,Y,se,le,ue,pe,Te,Re,et,Ne,oe,xe,He,xt,Ht,Et,Rt,Yt,$t,Qt){let Dt=32*l,Ar=16*l;return this.int16[Dt+0]=f,this.int16[Dt+1]=g,this.int16[Dt+2]=w,this.int16[Dt+3]=I,this.int16[Dt+4]=M,this.int16[Dt+5]=D,this.int16[Dt+6]=U,this.int16[Dt+7]=j,this.uint16[Dt+8]=$,this.uint16[Dt+9]=Y,this.uint16[Dt+10]=se,this.uint16[Dt+11]=le,this.uint16[Dt+12]=ue,this.uint16[Dt+13]=pe,this.uint16[Dt+14]=Te,this.uint16[Dt+15]=Re,this.uint16[Dt+16]=et,this.uint16[Dt+17]=Ne,this.uint16[Dt+18]=oe,this.uint16[Dt+19]=xe,this.uint16[Dt+20]=He,this.uint16[Dt+21]=xt,this.uint16[Dt+22]=Ht,this.uint32[Ar+12]=Et,this.float32[Ar+13]=Rt,this.float32[Ar+14]=Yt,this.uint16[Dt+30]=$t,this.uint16[Dt+31]=Qt,l}}S.prototype.bytesPerElement=64,ur("StructArrayLayout8i15ui1ul2f2ui64",S);class o extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){let f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.float32[1*l+0]=f,l}}o.prototype.bytesPerElement=4,ur("StructArrayLayout1f4",o);class u extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,f,g)}emplace(l,f,g,w){let I=3*l;return this.uint16[6*l+0]=f,this.float32[I+1]=g,this.float32[I+2]=w,l}}u.prototype.bytesPerElement=12,ur("StructArrayLayout1ui2f12",u);class _ extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,g){let w=this.length;return this.resize(w+1),this.emplace(w,l,f,g)}emplace(l,f,g,w){let I=4*l;return this.uint32[2*l+0]=f,this.uint16[I+2]=g,this.uint16[I+3]=w,l}}_.prototype.bytesPerElement=8,ur("StructArrayLayout1ul2ui8",_);class v extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f){let g=this.length;return this.resize(g+1),this.emplace(g,l,f)}emplace(l,f,g){let w=2*l;return this.uint16[w+0]=f,this.uint16[w+1]=g,l}}v.prototype.bytesPerElement=4,ur("StructArrayLayout2ui4",v);class C extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){let f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint16[1*l+0]=f,l}}C.prototype.bytesPerElement=2,ur("StructArrayLayout1ui2",C);class O extends Cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,g,w){let I=this.length;return this.resize(I+1),this.emplace(I,l,f,g,w)}emplace(l,f,g,w,I){let M=4*l;return this.float32[M+0]=f,this.float32[M+1]=g,this.float32[M+2]=w,this.float32[M+3]=I,l}}O.prototype.bytesPerElement=16,ur("StructArrayLayout4f16",O);class N extends Ku{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}N.prototype.size=20;class V extends gf{get(l){return new N(this,l)}}ur("CollisionBoxArray",V);class H extends Ku{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}H.prototype.size=48;class K extends _f{get(l){return new H(this,l)}}ur("PlacedSymbolArray",K);class ne extends Ku{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ne.prototype.size=64;class ie extends S{get(l){return new ne(this,l)}}ur("SymbolInstanceArray",ie);class fe extends o{getoffsetX(l){return this.float32[1*l+0]}}ur("GlyphOffsetArray",fe);class Ae extends cs{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}ur("SymbolLineVertexArray",Ae);class Ie extends Ku{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ie.prototype.size=12;class Se extends u{get(l){return new Ie(this,l)}}ur("TextAnchorOffsetArray",Se);class Me extends Ku{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Me.prototype.size=8;class ke extends _{get(l){return new Me(this,l)}}ur("FeatureIndexArray",ke);class Ve extends Qu{}class Be extends Qu{}class qe extends Qu{}class Ge extends Hc{}class Ze extends mf{}class _t extends Xl{}class At extends Hd{}class Mt extends Wc{}class Lt extends Yl{}class Tt extends Wd{}class er extends Kl{}class Kt extends qd{}class Ut extends eh{}class mt extends v{}let Nt=Bn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ii}=Nt;class Gr{constructor(l=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=l}prepareSegment(l,f,g,w){let I=this.segments[this.segments.length-1];return l>Gr.MAX_VERTEX_ARRAY_LENGTH&&Oi(`Max vertices per segment is ${Gr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Gr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!I||I.vertexLength+l>Gr.MAX_VERTEX_ARRAY_LENGTH||I.sortKey!==w?this.createNewSegment(f,g,w):I}createNewSegment(l,f,g){let w={vertexOffset:l.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0,vaos:{}};return g!==void 0&&(w.sortKey=g),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(w),w}getOrCreateLatestSegment(l,f,g){return this.prepareSegment(0,l,f,g)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let l of this.segments)for(let f in l.vaos)l.vaos[f].destroy()}static simpleSegment(l,f,g,w){return new Gr([{vertexOffset:l,primitiveOffset:f,vertexLength:g,primitiveLength:w,vaos:{},sortKey:0}])}}function ki(h,l){return 256*(h=jt(Math.floor(h),0,255))+jt(Math.floor(l),0,255)}Gr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ur("SegmentVector",Gr);let Wi=Bn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Fi,ji,yi,m={exports:{}},A={exports:{}},x={exports:{}},E=function(){if(yi)return m.exports;yi=1;var h=(Fi||(Fi=1,A.exports=function(f,g){var w,I,M,D,U,j,$,Y;for(I=f.length-(w=3&f.length),M=g,U=3432918353,j=461845907,Y=0;Y<I;)$=255&f.charCodeAt(Y)|(255&f.charCodeAt(++Y))<<8|(255&f.charCodeAt(++Y))<<16|(255&f.charCodeAt(++Y))<<24,++Y,M=27492+(65535&(D=5*(65535&(M=(M^=$=(65535&($=($=(65535&$)*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*j+((($>>>16)*j&65535)<<16)&4294967295)<<13|M>>>19))+((5*(M>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch($=0,w){case 3:$^=(255&f.charCodeAt(Y+2))<<16;case 2:$^=(255&f.charCodeAt(Y+1))<<8;case 1:M^=$=(65535&($=($=(65535&($^=255&f.charCodeAt(Y)))*U+((($>>>16)*U&65535)<<16)&4294967295)<<15|$>>>17))*j+((($>>>16)*j&65535)<<16)&4294967295}return M^=f.length,M=2246822507*(65535&(M^=M>>>16))+((2246822507*(M>>>16)&65535)<<16)&4294967295,M=3266489909*(65535&(M^=M>>>13))+((3266489909*(M>>>16)&65535)<<16)&4294967295,(M^=M>>>16)>>>0}),A.exports),l=(ji||(ji=1,x.exports=function(f,g){for(var w,I=f.length,M=g^I,D=0;I>=4;)w=1540483477*(65535&(w=255&f.charCodeAt(D)|(255&f.charCodeAt(++D))<<8|(255&f.charCodeAt(++D))<<16|(255&f.charCodeAt(++D))<<24))+((1540483477*(w>>>16)&65535)<<16),M=1540483477*(65535&M)+((1540483477*(M>>>16)&65535)<<16)^(w=1540483477*(65535&(w^=w>>>24))+((1540483477*(w>>>16)&65535)<<16)),I-=4,++D;switch(I){case 3:M^=(255&f.charCodeAt(D+2))<<16;case 2:M^=(255&f.charCodeAt(D+1))<<8;case 1:M=1540483477*(65535&(M^=255&f.charCodeAt(D)))+((1540483477*(M>>>16)&65535)<<16)}return M=1540483477*(65535&(M^=M>>>13))+((1540483477*(M>>>16)&65535)<<16),(M^=M>>>15)>>>0}),x.exports);return m.exports=h,m.exports.murmur3=h,m.exports.murmur2=l,m.exports}(),P=a(E);class R{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,f,g,w){this.ids.push(k(l)),this.positions.push(f,g,w)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let f=k(l),g=0,w=this.ids.length-1;for(;g<w;){let M=g+w>>1;this.ids[M]>=f?w=M:g=M+1}let I=[];for(;this.ids[g]===f;)I.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return I}static serialize(l,f){let g=new Float64Array(l.ids),w=new Uint32Array(l.positions);return F(g,w,0,g.length-1),f&&f.push(g.buffer,w.buffer),{ids:g,positions:w}}static deserialize(l){let f=new R;return f.ids=l.ids,f.positions=l.positions,f.indexed=!0,f}}function k(h){let l=+h;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:P(String(h))}function F(h,l,f,g){for(;f<g;){let w=h[f+g>>1],I=f-1,M=g+1;for(;;){do I++;while(h[I]<w);do M--;while(h[M]>w);if(I>=M)break;W(h,I,M),W(l,3*I,3*M),W(l,3*I+1,3*M+1),W(l,3*I+2,3*M+2)}M-f<g-M?(F(h,l,f,M),f=M+1):(F(h,l,M+1,g),g=M)}}function W(h,l,f){let g=h[l];h[l]=h[f],h[f]=g}ur("FeaturePositionMap",R);class Q{constructor(l,f){this.gl=l.gl,this.location=f}}class he extends Q{constructor(l,f){super(l,f),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class we extends Q{constructor(l,f){super(l,f),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class $e extends Q{constructor(l,f){super(l,f),this.current=bi.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}let Qe=new Float32Array(16);function Ue(h){return[ki(255*h.r,255*h.g),ki(255*h.b,255*h.a)]}class nt{constructor(l,f,g){this.value=l,this.uniformNames=f.map(w=>`u_${w}`),this.type=g}setUniform(l,f,g){l.set(g.constantOr(this.value))}getBinding(l,f,g){return this.type==="color"?new $e(l,f):new he(l,f)}}class It{constructor(l,f){this.uniformNames=f.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=l.tlbr}setUniform(l,f,g,w){let I=w==="u_pattern_to"?this.patternTo:w==="u_pattern_from"?this.patternFrom:w==="u_pixel_ratio_to"?this.pixelRatioTo:w==="u_pixel_ratio_from"?this.pixelRatioFrom:null;I&&l.set(I)}getBinding(l,f,g){return g.substr(0,9)==="u_pattern"?new we(l,f):new he(l,f)}}class wt{constructor(l,f,g,w){this.expression=l,this.type=g,this.maxValue=0,this.paintVertexAttributes=f.map(I=>({name:`a_${I}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new w}populatePaintArray(l,f,g,w,I){let M=this.paintVertexArray.length,D=this.expression.evaluate(new an(0),f,{},w,[],I);this.paintVertexArray.resize(l),this._setPaintValue(M,l,D)}updatePaintArray(l,f,g,w){let I=this.expression.evaluate({zoom:0},g,w);this._setPaintValue(l,f,I)}_setPaintValue(l,f,g){if(this.type==="color"){let w=Ue(g);for(let I=l;I<f;I++)this.paintVertexArray.emplace(I,w[0],w[1])}else{for(let w=l;w<f;w++)this.paintVertexArray.emplace(w,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class at{constructor(l,f,g,w,I,M){this.expression=l,this.uniformNames=f.map(D=>`u_${D}_t`),this.type=g,this.useIntegerZoom=w,this.zoom=I,this.maxValue=0,this.paintVertexAttributes=f.map(D=>({name:`a_${D}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new M}populatePaintArray(l,f,g,w,I){let M=this.expression.evaluate(new an(this.zoom),f,{},w,[],I),D=this.expression.evaluate(new an(this.zoom+1),f,{},w,[],I),U=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(U,l,M,D)}updatePaintArray(l,f,g,w){let I=this.expression.evaluate({zoom:this.zoom},g,w),M=this.expression.evaluate({zoom:this.zoom+1},g,w);this._setPaintValue(l,f,I,M)}_setPaintValue(l,f,g,w){if(this.type==="color"){let I=Ue(g),M=Ue(w);for(let D=l;D<f;D++)this.paintVertexArray.emplace(D,I[0],I[1],M[0],M[1])}else{for(let I=l;I<f;I++)this.paintVertexArray.emplace(I,g,w);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(w))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,f){let g=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,w=jt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);l.set(w)}getBinding(l,f,g){return new he(l,f)}}class bt{constructor(l,f,g,w,I,M){this.expression=l,this.type=f,this.useIntegerZoom=g,this.zoom=w,this.layerId=M,this.zoomInPaintVertexArray=new I,this.zoomOutPaintVertexArray=new I}populatePaintArray(l,f,g){let w=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(w,l,f.patterns&&f.patterns[this.layerId],g)}updatePaintArray(l,f,g,w,I){this._setPaintValues(l,f,g.patterns&&g.patterns[this.layerId],I)}_setPaintValues(l,f,g,w){if(!w||!g)return;let{min:I,mid:M,max:D}=g,U=w[I],j=w[M],$=w[D];if(U&&j&&$)for(let Y=l;Y<f;Y++)this.zoomInPaintVertexArray.emplace(Y,j.tl[0],j.tl[1],j.br[0],j.br[1],U.tl[0],U.tl[1],U.br[0],U.br[1],j.pixelRatio,U.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,j.tl[0],j.tl[1],j.br[0],j.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],j.pixelRatio,$.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,Wi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,Wi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ft{constructor(l,f,g){this.binders={},this._buffers=[];let w=[];for(let I in l.paint._values){if(!g(I))continue;let M=l.paint.get(I);if(!(M instanceof ha&&Ul(M.property.specification)))continue;let D=mr(I,l.type),U=M.value,j=M.property.specification.type,$=M.property.useIntegerZoom,Y=M.property.specification["property-type"],se=Y==="cross-faded"||Y==="cross-faded-data-driven";if(U.kind==="constant")this.binders[I]=se?new It(U.value,D):new nt(U.value,D,j),w.push(`/u_${I}`);else if(U.kind==="source"||se){let le=sr(I,j,"source");this.binders[I]=se?new bt(U,j,$,f,le,l.id):new wt(U,D,j,le),w.push(`/a_${I}`)}else{let le=sr(I,j,"composite");this.binders[I]=new at(U,D,j,$,f,le),w.push(`/z_${I}`)}}this.cacheKey=w.sort().join("")}getMaxValue(l){let f=this.binders[l];return f instanceof wt||f instanceof at?f.maxValue:0}populatePaintArrays(l,f,g,w,I){for(let M in this.binders){let D=this.binders[M];(D instanceof wt||D instanceof at||D instanceof bt)&&D.populatePaintArray(l,f,g,w,I)}}setConstantPatternPositions(l,f){for(let g in this.binders){let w=this.binders[g];w instanceof It&&w.setConstantPatternPositions(l,f)}}updatePaintArrays(l,f,g,w,I){let M=!1;for(let D in l){let U=f.getPositions(D);for(let j of U){let $=g.feature(j.index);for(let Y in this.binders){let se=this.binders[Y];if((se instanceof wt||se instanceof at||se instanceof bt)&&se.expression.isStateDependent===!0){let le=w.paint.get(Y);se.expression=le.value,se.updatePaintArray(j.start,j.end,$,l[D],I),M=!0}}}}return M}defines(){let l=[];for(let f in this.binders){let g=this.binders[f];(g instanceof nt||g instanceof It)&&l.push(...g.uniformNames.map(w=>`#define HAS_UNIFORM_${w}`))}return l}getBinderAttributes(){let l=[];for(let f in this.binders){let g=this.binders[f];if(g instanceof wt||g instanceof at)for(let w=0;w<g.paintVertexAttributes.length;w++)l.push(g.paintVertexAttributes[w].name);else if(g instanceof bt)for(let w=0;w<Wi.members.length;w++)l.push(Wi.members[w].name)}return l}getBinderUniforms(){let l=[];for(let f in this.binders){let g=this.binders[f];if(g instanceof nt||g instanceof It||g instanceof at)for(let w of g.uniformNames)l.push(w)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,f){let g=[];for(let w in this.binders){let I=this.binders[w];if(I instanceof nt||I instanceof It||I instanceof at){for(let M of I.uniformNames)if(f[M]){let D=I.getBinding(l,f[M],M);g.push({name:M,property:w,binding:D})}}}return g}setUniforms(l,f,g,w){for(let{name:I,property:M,binding:D}of f)this.binders[M].setUniform(D,w,g.get(M),I)}updatePaintBuffers(l){this._buffers=[];for(let f in this.binders){let g=this.binders[f];if(l&&g instanceof bt){let w=l.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;w&&this._buffers.push(w)}else(g instanceof wt||g instanceof at)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(l){for(let f in this.binders){let g=this.binders[f];(g instanceof wt||g instanceof at||g instanceof bt)&&g.upload(l)}this.updatePaintBuffers()}destroy(){for(let l in this.binders){let f=this.binders[l];(f instanceof wt||f instanceof at||f instanceof bt)&&f.destroy()}}}class ar{constructor(l,f,g=()=>!0){this.programConfigurations={};for(let w of l)this.programConfigurations[w.id]=new ft(w,f,g);this.needsUpload=!1,this._featureMap=new R,this._bufferOffset=0}populatePaintArrays(l,f,g,w,I,M){for(let D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(l,f,w,I,M);f.id!==void 0&&this._featureMap.add(f.id,g,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,f,g,w){for(let I of g)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(l,this._featureMap,f,I,w)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(let f in this.programConfigurations)this.programConfigurations[f].upload(l);this.needsUpload=!1}}destroy(){for(let l in this.programConfigurations)this.programConfigurations[l].destroy()}}function mr(h,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${l}-`,"").replace(/-/g,"_")]}function sr(h,l,f){let g={color:{source:Xl,composite:O},number:{source:o,composite:Xl}},w=function(I){return{"line-pattern":{source:At,composite:At},"fill-pattern":{source:At,composite:At},"fill-extrusion-pattern":{source:At,composite:At}}[I]}(h);return w&&w[f]||g[l][f]}ur("ConstantBinder",nt),ur("CrossFadedConstantBinder",It),ur("SourceExpressionBinder",wt),ur("CrossFadedCompositeBinder",bt),ur("CompositeExpressionBinder",at),ur("ProgramConfiguration",ft,{omit:["_buffers"]}),ur("ProgramConfigurationSet",ar);let lr=Math.pow(2,14)-1,di=-lr-1;function ti(h){let l=ve/h.extent,f=h.loadGeometry();for(let g=0;g<f.length;g++){let w=f[g];for(let I=0;I<w.length;I++){let M=w[I],D=Math.round(M.x*l),U=Math.round(M.y*l);M.x=jt(D,di,lr),M.y=jt(U,di,lr),(D<M.x||D>M.x+1||U<M.y||U>M.y+1)&&Oi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function ii(h,l){return{type:h.type,id:h.id,properties:h.properties,geometry:l?ti(h):[]}}let Hr=-32768;function Ur(h,l,f,g,w){h.emplaceBack(Hr+8*l+g,Hr+8*f+w)}class jr{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Be,this.indexArray=new Ut,this.segments=new Gr,this.programConfigurations=new ar(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,g){let w=this.layers[0],I=[],M=null,D=!1,U=w.type==="heatmap";if(w.type==="circle"){let $=w;M=$.layout.get("circle-sort-key"),D=!M.isConstant(),U=U||$.paint.get("circle-pitch-alignment")==="map"}let j=U?f.subdivisionGranularity.circle:1;for(let{feature:$,id:Y,index:se,sourceLayerIndex:le}of l){let ue=this.layers[0]._featureFilter.needGeometry,pe=ii($,ue);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),pe,g))continue;let Te=D?M.evaluate(pe,{},g):void 0,Re={id:Y,properties:$.properties,type:$.type,sourceLayerIndex:le,index:se,geometry:ue?pe.geometry:ti($),patterns:{},sortKey:Te};I.push(Re)}D&&I.sort(($,Y)=>$.sortKey-Y.sortKey);for(let $ of I){let{geometry:Y,index:se,sourceLayerIndex:le}=$,ue=l[se].feature;this.addFeature($,Y,se,g,j),f.featureIndex.insert(ue,Y,se,le,this.index)}}update(l,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ii),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,f,g,w,I=1){let M;switch(I){case 1:M=[0,7];break;case 3:M=[0,2,5,7];break;case 5:M=[0,1,3,4,6,7];break;case 7:M=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${I}; valid values are 1, 3, 5, 7.`)}let D=M.length;for(let U of f)for(let j of U){let $=j.x,Y=j.y;if($<0||$>=ve||Y<0||Y>=ve)continue;let se=this.segments.prepareSegment(D*D,this.layoutVertexArray,this.indexArray,l.sortKey),le=se.vertexLength;for(let ue=0;ue<D;ue++)for(let pe=0;pe<D;pe++)Ur(this.layoutVertexArray,$,Y,M[pe],M[ue]);for(let ue=0;ue<D-1;ue++)for(let pe=0;pe<D-1;pe++){let Te=le+ue*D+pe,Re=le+(ue+1)*D+pe;this.indexArray.emplaceBack(Te,Re+1,Te+1),this.indexArray.emplaceBack(Te,Re,Re+1)}se.vertexLength+=D*D,se.primitiveLength+=(D-1)*(D-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,{},w)}}function Ni(h,l){for(let f=0;f<h.length;f++)if(Zd(l,h[f]))return!0;for(let f=0;f<l.length;f++)if(Zd(h,l[f]))return!0;return!!RA(h,l)}function Wr(h,l,f){return!!Zd(h,l)||!!U3(l,h,f)}function ln(h,l){if(h.length===1)return LM(l,h[0]);for(let f=0;f<l.length;f++){let g=l[f];for(let w=0;w<g.length;w++)if(Zd(h,g[w]))return!0}for(let f=0;f<h.length;f++)if(LM(l,h[f]))return!0;for(let f=0;f<l.length;f++)if(RA(h,l[f]))return!0;return!1}function yo(h,l,f){if(h.length>1){if(RA(h,l))return!0;for(let g=0;g<l.length;g++)if(U3(l[g],h,f))return!0}for(let g=0;g<h.length;g++)if(U3(h[g],l,f))return!0;return!1}function RA(h,l){if(h.length===0||l.length===0)return!1;for(let f=0;f<h.length-1;f++){let g=h[f],w=h[f+1];for(let I=0;I<l.length-1;I++)if(vG(g,w,l[I],l[I+1]))return!0}return!1}function vG(h,l,f,g){return Jr(h,f,g)!==Jr(l,f,g)&&Jr(h,l,f)!==Jr(h,l,g)}function U3(h,l,f){let g=f*f;if(l.length===1)return h.distSqr(l[0])<g;for(let w=1;w<l.length;w++)if(BM(h,l[w-1],l[w])<g)return!0;return!1}function BM(h,l,f){let g=l.distSqr(f);if(g===0)return h.distSqr(l);let w=((h.x-l.x)*(f.x-l.x)+(h.y-l.y)*(f.y-l.y))/g;return h.distSqr(w<0?l:w>1?f:f.sub(l)._mult(w)._add(l))}function LM(h,l){for(let f=0;f<h.length;f++)if(Zd(h[f],l))return!0;return!1}function Zd(h,l){let f=!1;for(let g=0,w=h.length-1;g<h.length;w=g++){let I=h[g],M=h[w];I.y>l.y!=M.y>l.y&&l.x<(M.x-I.x)*(l.y-I.y)/(M.y-I.y)+I.x&&(f=!f)}return f}function wG(h,l,f){let g=f[0],w=f[2];if(h.x<g.x&&l.x<g.x||h.x>w.x&&l.x>w.x||h.y<g.y&&l.y<g.y||h.y>w.y&&l.y>w.y)return!1;let I=Jr(h,l,f[0]);return I!==Jr(h,l,f[1])||I!==Jr(h,l,f[2])||I!==Jr(h,l,f[3])}function Zm(h,l,f){let g=l.paint.get(h).value;return g.kind==="constant"?g.value:f.programConfigurations.get(l.id).getMaxValue(h)}function cx(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function ux(h,l,f,g,w){if(!l[0]&&!l[1])return h;let I=B.convert(l)._mult(w);f==="viewport"&&I._rotate(-g);let M=[];for(let D=0;D<h.length;D++)M.push(h[D].sub(I));return M}let OM,DM;ur("CircleBucket",jr,{omit:["layers"]});var TG={get paint(){return DM=DM||new to({"circle-radius":new Mr(ce.paint_circle["circle-radius"]),"circle-color":new Mr(ce.paint_circle["circle-color"]),"circle-blur":new Mr(ce.paint_circle["circle-blur"]),"circle-opacity":new Mr(ce.paint_circle["circle-opacity"]),"circle-translate":new yr(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new yr(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new yr(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new yr(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mr(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mr(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mr(ce.paint_circle["circle-stroke-opacity"])})},get layout(){return OM=OM||new to({"circle-sort-key":new Mr(ce.layout_circle["circle-sort-key"])})}};class EG extends Sn{constructor(l){super(l,TG)}createBucket(l){return new jr(l)}queryRadius(l){let f=l;return Zm("circle-radius",this,f)+Zm("circle-stroke-width",this,f)+cx(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:l,feature:f,featureState:g,geometry:w,transform:I,pixelsToTileUnits:M,unwrappedTileID:D,getElevation:U}){let j=ux(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-I.bearingInRadians,M),$=this.paint.get("circle-radius").evaluate(f,g)+this.paint.get("circle-stroke-width").evaluate(f,g),Y=this.paint.get("circle-pitch-alignment")==="map",se=Y?j:function(ue,pe,Te,Re){return ue.map(et=>kM(et,pe,Te,Re))}(j,I,D,U),le=Y?$*M:$;for(let ue of w)for(let pe of ue){let Te=Y?pe:kM(pe,I,D,U),Re=le,et=I.projectTileCoordinates(pe.x,pe.y,D,U).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Re*=et/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Re*=I.cameraToCenterDistance/et),Wr(se,Te,Re))return!0}return!1}}function kM(h,l,f,g){let w=l.projectTileCoordinates(h.x,h.y,f,g).point;return new B((.5*w.x+.5)*l.width,(.5*-w.y+.5)*l.height)}class FM extends jr{}let NM;ur("HeatmapBucket",FM,{omit:["layers"]});var SG={get paint(){return NM=NM||new to({"heatmap-radius":new Mr(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mr(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new yr(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Af(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new yr(ce.paint_heatmap["heatmap-opacity"])})}};function V3(h,{width:l,height:f},g,w){if(w){if(w instanceof Uint8ClampedArray)w=new Uint8Array(w.buffer);else if(w.length!==l*f*g)throw new RangeError(`mismatched image size. expected: ${w.length} but got: ${l*f*g}`)}else w=new Uint8Array(l*f*g);return h.width=l,h.height=f,h.data=w,h}function zM(h,{width:l,height:f},g){if(l===h.width&&f===h.height)return;let w=V3({},{width:l,height:f},g);j3(h,w,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,l),height:Math.min(h.height,f)},g),h.width=l,h.height=f,h.data=w.data}function j3(h,l,f,g,w,I){if(w.width===0||w.height===0)return l;if(w.width>h.width||w.height>h.height||f.x>h.width-w.width||f.y>h.height-w.height)throw new RangeError("out of range source coordinates for image copy");if(w.width>l.width||w.height>l.height||g.x>l.width-w.width||g.y>l.height-w.height)throw new RangeError("out of range destination coordinates for image copy");let M=h.data,D=l.data;if(M===D)throw new Error("srcData equals dstData, so image is already copied");for(let U=0;U<w.height;U++){let j=((f.y+U)*h.width+f.x)*I,$=((g.y+U)*l.width+g.x)*I;for(let Y=0;Y<w.width*I;Y++)D[$+Y]=M[j+Y]}return l}class Xm{constructor(l,f){V3(this,l,1,f)}resize(l){zM(this,l,1)}clone(){return new Xm({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,g,w,I){j3(l,f,g,w,I,1)}}class Ma{constructor(l,f){V3(this,l,4,f)}resize(l){zM(this,l,4)}replace(l,f){f?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,g,w,I){j3(l,f,g,w,I,4)}}function UM(h){let l={},f=h.resolution||256,g=h.clips?h.clips.length:1,w=h.image||new Ma({width:f,height:g});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);let I=(M,D,U)=>{l[h.evaluationKey]=U;let j=h.expression.evaluate(l);w.data[M+D+0]=Math.floor(255*j.r/j.a),w.data[M+D+1]=Math.floor(255*j.g/j.a),w.data[M+D+2]=Math.floor(255*j.b/j.a),w.data[M+D+3]=Math.floor(255*j.a)};if(h.clips)for(let M=0,D=0;M<g;++M,D+=4*f)for(let U=0,j=0;U<f;U++,j+=4){let $=U/(f-1),{start:Y,end:se}=h.clips[M];I(D,j,Y*(1-$)+se*$)}else for(let M=0,D=0;M<f;M++,D+=4)I(0,D,M/(f-1));return w}ur("AlphaImage",Xm),ur("RGBAImage",Ma);let G3="big-fb";class CG extends Sn{createBucket(l){return new FM(l)}constructor(l){super(l,SG),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=UM({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(G3)&&this.heatmapFbos.delete(G3)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let VM;var IG={get paint(){return VM=VM||new to({"hillshade-illumination-direction":new yr(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new yr(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new yr(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new yr(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new yr(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new yr(ce.paint_hillshade["hillshade-accent-color"])})}};class PG extends Sn{constructor(l){super(l,IG)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let MG=Bn([{name:"a_pos",components:2,type:"Int16"}],4),{members:RG}=MG;function H3(h,l,f){let g=f.patternDependencies,w=!1;for(let I of l){let M=I.paint.get(`${h}-pattern`);M.isConstant()||(w=!0);let D=M.constantOr(null);D&&(w=!0,g[D.to]=!0,g[D.from]=!0)}return w}function W3(h,l,f,g,w){let I=w.patternDependencies;for(let M of l){let D=M.paint.get(`${h}-pattern`).value;if(D.kind!=="constant"){let U=D.evaluate({zoom:g-1},f,{},w.availableImages),j=D.evaluate({zoom:g},f,{},w.availableImages),$=D.evaluate({zoom:g+1},f,{},w.availableImages);U=U&&U.name?U.name:U,j=j&&j.name?j.name:j,$=$&&$.name?$.name:$,I[U]=!0,I[j]=!0,I[$]=!0,f.patterns[M.id]={min:U,mid:j,max:$}}}return f}function jM(h,l,f,g,w){let I;if(w===function(M,D,U,j){let $=0;for(let Y=D,se=U-j;Y<U;Y+=j)$+=(M[se]-M[Y])*(M[Y+1]+M[se+1]),se=Y;return $}(h,l,f,g)>0)for(let M=l;M<f;M+=g)I=$M(M/g|0,h[M],h[M+1],I);else for(let M=f-g;M>=l;M-=g)I=$M(M/g|0,h[M],h[M+1],I);return I&&BA(I,I.next)&&(Jm(I),I=I.next),I}function Xd(h,l){if(!h)return h;l||(l=h);let f,g=h;do if(f=!1,g.steiner||!BA(g,g.next)&&$n(g.prev,g,g.next)!==0)g=g.next;else{if(Jm(g),g=l=g.prev,g===g.next)break;f=!0}while(f||g!==l);return l}function Ym(h,l,f,g,w,I,M){if(!h)return;!M&&I&&function(U,j,$,Y){let se=U;do se.z===0&&(se.z=$3(se.x,se.y,j,$,Y)),se.prevZ=se.prev,se.nextZ=se.next,se=se.next;while(se!==U);se.prevZ.nextZ=null,se.prevZ=null,function(le){let ue,pe=1;do{let Te,Re=le;le=null;let et=null;for(ue=0;Re;){ue++;let Ne=Re,oe=0;for(let He=0;He<pe&&(oe++,Ne=Ne.nextZ,Ne);He++);let xe=pe;for(;oe>0||xe>0&&Ne;)oe!==0&&(xe===0||!Ne||Re.z<=Ne.z)?(Te=Re,Re=Re.nextZ,oe--):(Te=Ne,Ne=Ne.nextZ,xe--),et?et.nextZ=Te:le=Te,Te.prevZ=et,et=Te;Re=Ne}et.nextZ=null,pe*=2}while(ue>1)}(se)}(h,g,w,I);let D=h;for(;h.prev!==h.next;){let U=h.prev,j=h.next;if(I?LG(h,g,w,I):BG(h))l.push(U.i,h.i,j.i),Jm(h),h=j.next,D=j.next;else if((h=j)===D){M?M===1?Ym(h=OG(Xd(h),l),l,f,g,w,I,2):M===2&&DG(h,l,f,g,w,I):Ym(Xd(h),l,f,g,w,I,1);break}}}function BG(h){let l=h.prev,f=h,g=h.next;if($n(l,f,g)>=0)return!1;let w=l.x,I=f.x,M=g.x,D=l.y,U=f.y,j=g.y,$=Math.min(w,I,M),Y=Math.min(D,U,j),se=Math.max(w,I,M),le=Math.max(D,U,j),ue=g.next;for(;ue!==l;){if(ue.x>=$&&ue.x<=se&&ue.y>=Y&&ue.y<=le&&Km(w,D,I,U,M,j,ue.x,ue.y)&&$n(ue.prev,ue,ue.next)>=0)return!1;ue=ue.next}return!0}function LG(h,l,f,g){let w=h.prev,I=h,M=h.next;if($n(w,I,M)>=0)return!1;let D=w.x,U=I.x,j=M.x,$=w.y,Y=I.y,se=M.y,le=Math.min(D,U,j),ue=Math.min($,Y,se),pe=Math.max(D,U,j),Te=Math.max($,Y,se),Re=$3(le,ue,l,f,g),et=$3(pe,Te,l,f,g),Ne=h.prevZ,oe=h.nextZ;for(;Ne&&Ne.z>=Re&&oe&&oe.z<=et;){if(Ne.x>=le&&Ne.x<=pe&&Ne.y>=ue&&Ne.y<=Te&&Ne!==w&&Ne!==M&&Km(D,$,U,Y,j,se,Ne.x,Ne.y)&&$n(Ne.prev,Ne,Ne.next)>=0||(Ne=Ne.prevZ,oe.x>=le&&oe.x<=pe&&oe.y>=ue&&oe.y<=Te&&oe!==w&&oe!==M&&Km(D,$,U,Y,j,se,oe.x,oe.y)&&$n(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;Ne&&Ne.z>=Re;){if(Ne.x>=le&&Ne.x<=pe&&Ne.y>=ue&&Ne.y<=Te&&Ne!==w&&Ne!==M&&Km(D,$,U,Y,j,se,Ne.x,Ne.y)&&$n(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.prevZ}for(;oe&&oe.z<=et;){if(oe.x>=le&&oe.x<=pe&&oe.y>=ue&&oe.y<=Te&&oe!==w&&oe!==M&&Km(D,$,U,Y,j,se,oe.x,oe.y)&&$n(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function OG(h,l){let f=h;do{let g=f.prev,w=f.next.next;!BA(g,w)&&HM(g,f,f.next,w)&&Qm(g,w)&&Qm(w,g)&&(l.push(g.i,f.i,w.i),Jm(f),Jm(f.next),f=h=w),f=f.next}while(f!==h);return Xd(f)}function DG(h,l,f,g,w,I){let M=h;do{let D=M.next.next;for(;D!==M.prev;){if(M.i!==D.i&&UG(M,D)){let U=WM(M,D);return M=Xd(M,M.next),U=Xd(U,U.next),Ym(M,l,f,g,w,I,0),void Ym(U,l,f,g,w,I,0)}D=D.next}M=M.next}while(M!==h)}function kG(h,l){let f=h.x-l.x;return f===0&&(f=h.y-l.y,f===0)&&(f=(h.next.y-h.y)/(h.next.x-h.x)-(l.next.y-l.y)/(l.next.x-l.x)),f}function FG(h,l){let f=function(w,I){let M=I,D=w.x,U=w.y,j,$=-1/0;if(BA(w,M))return M;do{if(BA(w,M.next))return M.next;if(U<=M.y&&U>=M.next.y&&M.next.y!==M.y){let pe=M.x+(U-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(pe<=D&&pe>$&&($=pe,j=M.x<M.next.x?M:M.next,pe===D))return j}M=M.next}while(M!==I);if(!j)return null;let Y=j,se=j.x,le=j.y,ue=1/0;M=j;do{if(D>=M.x&&M.x>=se&&D!==M.x&&GM(U<le?D:$,U,se,le,U<le?$:D,U,M.x,M.y)){let pe=Math.abs(U-M.y)/(D-M.x);Qm(M,w)&&(pe<ue||pe===ue&&(M.x>j.x||M.x===j.x&&NG(j,M)))&&(j=M,ue=pe)}M=M.next}while(M!==Y);return j}(h,l);if(!f)return l;let g=WM(f,h);return Xd(g,g.next),Xd(f,f.next)}function NG(h,l){return $n(h.prev,h,l.prev)<0&&$n(l.next,h,h.next)<0}function $3(h,l,f,g,w){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-f)*w|0)|h<<8))|h<<4))|h<<2))|h<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-g)*w|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function zG(h){let l=h,f=h;do(l.x<f.x||l.x===f.x&&l.y<f.y)&&(f=l),l=l.next;while(l!==h);return f}function GM(h,l,f,g,w,I,M,D){return(w-M)*(l-D)>=(h-M)*(I-D)&&(h-M)*(g-D)>=(f-M)*(l-D)&&(f-M)*(I-D)>=(w-M)*(g-D)}function Km(h,l,f,g,w,I,M,D){return!(h===M&&l===D)&&GM(h,l,f,g,w,I,M,D)}function UG(h,l){return h.next.i!==l.i&&h.prev.i!==l.i&&!function(f,g){let w=f;do{if(w.i!==f.i&&w.next.i!==f.i&&w.i!==g.i&&w.next.i!==g.i&&HM(w,w.next,f,g))return!0;w=w.next}while(w!==f);return!1}(h,l)&&(Qm(h,l)&&Qm(l,h)&&function(f,g){let w=f,I=!1,M=(f.x+g.x)/2,D=(f.y+g.y)/2;do w.y>D!=w.next.y>D&&w.next.y!==w.y&&M<(w.next.x-w.x)*(D-w.y)/(w.next.y-w.y)+w.x&&(I=!I),w=w.next;while(w!==f);return I}(h,l)&&($n(h.prev,h,l.prev)||$n(h,l.prev,l))||BA(h,l)&&$n(h.prev,h,h.next)>0&&$n(l.prev,l,l.next)>0)}function $n(h,l,f){return(l.y-h.y)*(f.x-l.x)-(l.x-h.x)*(f.y-l.y)}function BA(h,l){return h.x===l.x&&h.y===l.y}function HM(h,l,f,g){let w=fx($n(h,l,f)),I=fx($n(h,l,g)),M=fx($n(f,g,h)),D=fx($n(f,g,l));return w!==I&&M!==D||!(w!==0||!hx(h,f,l))||!(I!==0||!hx(h,g,l))||!(M!==0||!hx(f,h,g))||!(D!==0||!hx(f,l,g))}function hx(h,l,f){return l.x<=Math.max(h.x,f.x)&&l.x>=Math.min(h.x,f.x)&&l.y<=Math.max(h.y,f.y)&&l.y>=Math.min(h.y,f.y)}function fx(h){return h>0?1:h<0?-1:0}function Qm(h,l){return $n(h.prev,h,h.next)<0?$n(h,l,h.next)>=0&&$n(h,h.prev,l)>=0:$n(h,l,h.prev)<0||$n(h,h.next,l)<0}function WM(h,l){let f=q3(h.i,h.x,h.y),g=q3(l.i,l.x,l.y),w=h.next,I=l.prev;return h.next=l,l.prev=h,f.next=w,w.prev=f,g.next=f,f.prev=g,I.next=g,g.prev=I,g}function $M(h,l,f,g){let w=q3(h,l,f);return g?(w.next=g.next,w.prev=g,g.next.prev=w,g.next=w):(w.prev=w,w.next=w),w}function Jm(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function q3(h,l,f){return{i:h,x:l,y:f,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class LA{constructor(l,f){if(f>l)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=l,this._minGranularity=f}getGranularityForZoomLevel(l){return Math.max(Math.floor(this._baseZoomGranularity/(1<<l)),this._minGranularity,1)}}class dx{constructor(l){this.fill=l.fill,this.line=l.line,this.tile=l.tile,this.stencil=l.stencil,this.circle=l.circle}}dx.noSubdivision=new dx({fill:new LA(0,0),line:new LA(0,0),tile:new LA(0,0),stencil:new LA(0,0),circle:1}),ur("SubdivisionGranularityExpression",LA),ur("SubdivisionGranularitySetting",dx);let OA=-32768,eg=32767;class VG{constructor(l,f){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=l,this._granularityCellSize=ve/l,this._canonical=f}_getKey(l,f){return(l+=32768)<<16|(f+=32768)<<0}_vertexToIndex(l,f){if(l<-32768||f<-32768||l>32767||f>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let g=0|Math.round(l),w=0|Math.round(f),I=this._getKey(g,w);if(this._vertexDictionary.has(I))return this._vertexDictionary.get(I);let M=this._vertexBuffer.length/2;return this._vertexDictionary.set(I,M),this._vertexBuffer.push(g,w),M}_subdivideTrianglesScanline(l){if(this._granularity<2)return function(w,I){let M=[];for(let D=0;D<I.length;D+=3){let U=I[D],j=I[D+1],$=I[D+2],Y=w[2*U],se=w[2*U+1];(w[2*j]-Y)*(w[2*$+1]-se)-(w[2*j+1]-se)*(w[2*$]-Y)>0?(M.push(U),M.push($),M.push(j)):(M.push(U),M.push(j),M.push($))}return M}(this._vertexBuffer,l);let f=[],g=l.length;for(let w=0;w<g;w+=3){let I=[l[w+0],l[w+1],l[w+2]],M=[this._vertexBuffer[2*l[w+0]+0],this._vertexBuffer[2*l[w+0]+1],this._vertexBuffer[2*l[w+1]+0],this._vertexBuffer[2*l[w+1]+1],this._vertexBuffer[2*l[w+2]+0],this._vertexBuffer[2*l[w+2]+1]],D=1/0,U=1/0,j=-1/0,$=-1/0;for(let pe=0;pe<3;pe++){let Te=M[2*pe],Re=M[2*pe+1];D=Math.min(D,Te),j=Math.max(j,Te),U=Math.min(U,Re),$=Math.max($,Re)}if(D===j||U===$)continue;let Y=Math.floor(D/this._granularityCellSize),se=Math.ceil(j/this._granularityCellSize),le=Math.floor(U/this._granularityCellSize),ue=Math.ceil($/this._granularityCellSize);if(Y!==se||le!==ue)for(let pe=le;pe<ue;pe++){let Te=this._scanlineGenerateVertexRingForCellRow(pe,M,I);jG(this._vertexBuffer,Te,f)}else f.push(...I)}return f}_scanlineGenerateVertexRingForCellRow(l,f,g){let w=l*this._granularityCellSize,I=w+this._granularityCellSize,M=[];for(let D=0;D<3;D++){let U=f[2*D],j=f[2*D+1],$=f[2*(D+1)%6],Y=f[(2*(D+1)+1)%6],se=f[2*(D+2)%6],le=f[(2*(D+2)+1)%6],ue=$-U,pe=Y-j,Te=ue===0,Re=pe===0,et=(w-j)/pe,Ne=(I-j)/pe,oe=Math.min(et,Ne),xe=Math.max(et,Ne);if(!Re&&(oe>=1||xe<=0)||Re&&(j<w||j>I)){Y>=w&&Y<=I&&M.push(g[(D+1)%3]);continue}!Re&&oe>0&&M.push(this._vertexToIndex(U+ue*oe,j+pe*oe));let He=U+ue*Math.max(oe,0),xt=U+ue*Math.min(xe,1);Te||this._generateIntraEdgeVertices(M,U,j,$,Y,He,xt),!Re&&xe<1&&M.push(this._vertexToIndex(U+ue*xe,j+pe*xe)),(Re||Y>=w&&Y<=I)&&M.push(g[(D+1)%3]),!Re&&(Y<=w||Y>=I)&&this._generateInterEdgeVertices(M,U,j,$,Y,se,le,xt,w,I)}return M}_generateIntraEdgeVertices(l,f,g,w,I,M,D){let U=w-f,j=I-g,$=j===0,Y=$?Math.min(f,w):Math.min(M,D),se=$?Math.max(f,w):Math.max(M,D),le=Math.floor(Y/this._granularityCellSize)+1,ue=Math.ceil(se/this._granularityCellSize)-1;if($?f<w:M<D)for(let pe=le;pe<=ue;pe++){let Te=pe*this._granularityCellSize;l.push(this._vertexToIndex(Te,g+j*(Te-f)/U))}else for(let pe=ue;pe>=le;pe--){let Te=pe*this._granularityCellSize;l.push(this._vertexToIndex(Te,g+j*(Te-f)/U))}}_generateInterEdgeVertices(l,f,g,w,I,M,D,U,j,$){let Y=I-g,se=M-w,le=D-I,ue=(j-I)/le,pe=($-I)/le,Te=Math.min(ue,pe),Re=Math.max(ue,pe),et=w+se*Te,Ne=Math.floor(Math.min(et,U)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(et,U)/this._granularityCellSize)-1,xe=U<et,He=le===0;if(He&&(D===j||D===$))return;if(He||Te>=1||Re<=0){let Ht=g-D,Et=M+(f-M)*Math.min((j-D)/Ht,($-D)/Ht);Ne=Math.floor(Math.min(Et,U)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(Et,U)/this._granularityCellSize)-1,xe=U<Et}let xt=Y>0?$:j;if(xe)for(let Ht=Ne;Ht<=oe;Ht++)l.push(this._vertexToIndex(Ht*this._granularityCellSize,xt));else for(let Ht=oe;Ht>=Ne;Ht--)l.push(this._vertexToIndex(Ht*this._granularityCellSize,xt))}_generateOutline(l){let f=[];for(let g of l){let w=Yd(g,this._granularity,!0),I=this._pointArrayToIndices(w),M=[];for(let D=1;D<I.length;D++)M.push(I[D-1]),M.push(I[D]);f.push(M)}return f}_handlePoles(l){let f=!1,g=!1;this._canonical&&(this._canonical.y===0&&(f=!0),this._canonical.y===(1<<this._canonical.z)-1&&(g=!0)),(f||g)&&this._fillPoles(l,f,g)}_ensureNoPoleVertices(){let l=this._vertexBuffer;for(let f=0;f<l.length;f+=2){let g=l[f+1];g===OA&&(l[f+1]=-32767),g===eg&&(l[f+1]=32766)}}_generatePoleQuad(l,f,g,w,I,M){w>I!=(M===OA)?(l.push(f),l.push(g),l.push(this._vertexToIndex(w,M)),l.push(g),l.push(this._vertexToIndex(I,M)),l.push(this._vertexToIndex(w,M))):(l.push(g),l.push(f),l.push(this._vertexToIndex(w,M)),l.push(this._vertexToIndex(I,M)),l.push(g),l.push(this._vertexToIndex(w,M)))}_fillPoles(l,f,g){let w=this._vertexBuffer,I=ve,M=l.length;for(let D=2;D<M;D+=3){let U=l[D-2],j=l[D-1],$=l[D],Y=w[2*U],se=w[2*U+1],le=w[2*j],ue=w[2*j+1],pe=w[2*$],Te=w[2*$+1];f&&(se===0&&ue===0&&this._generatePoleQuad(l,U,j,Y,le,OA),ue===0&&Te===0&&this._generatePoleQuad(l,j,$,le,pe,OA),Te===0&&se===0&&this._generatePoleQuad(l,$,U,pe,Y,OA)),g&&(se===I&&ue===I&&this._generatePoleQuad(l,U,j,Y,le,eg),ue===I&&Te===I&&this._generatePoleQuad(l,j,$,le,pe,eg),Te===I&&se===I&&this._generatePoleQuad(l,$,U,pe,Y,eg))}}_initializeVertices(l){for(let f=0;f<l.length;f+=2)this._vertexToIndex(l[f],l[f+1])}subdividePolygonInternal(l,f){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:g,holeIndices:w}=function(D){let U=[],j=[];for(let $ of D)if($.length!==0){$!==D[0]&&U.push(j.length/2);for(let Y=0;Y<$.length;Y++)j.push($[Y].x),j.push($[Y].y)}return{flattened:j,holeIndices:U}}(l),I;this._initializeVertices(g);try{let D=function(j,$,Y=2){let se=$&&$.length,le=se?$[0]*Y:j.length,ue=jM(j,0,le,Y,!0),pe=[];if(!ue||ue.next===ue.prev)return pe;let Te,Re,et;if(se&&(ue=function(Ne,oe,xe,He){let xt=[];for(let Ht=0,Et=oe.length;Ht<Et;Ht++){let Rt=jM(Ne,oe[Ht]*He,Ht<Et-1?oe[Ht+1]*He:Ne.length,He,!1);Rt===Rt.next&&(Rt.steiner=!0),xt.push(zG(Rt))}xt.sort(kG);for(let Ht=0;Ht<xt.length;Ht++)xe=FG(xt[Ht],xe);return xe}(j,$,ue,Y)),j.length>80*Y){Te=1/0,Re=1/0;let Ne=-1/0,oe=-1/0;for(let xe=Y;xe<le;xe+=Y){let He=j[xe],xt=j[xe+1];He<Te&&(Te=He),xt<Re&&(Re=xt),He>Ne&&(Ne=He),xt>oe&&(oe=xt)}et=Math.max(Ne-Te,oe-Re),et=et!==0?32767/et:0}return Ym(ue,pe,Y,Te,Re,et,0),pe}(g,w),U=this._convertIndices(g,D);I=this._subdivideTrianglesScanline(U)}catch(D){console.error(D)}let M=[];return f&&(M=this._generateOutline(l)),this._ensureNoPoleVertices(),this._handlePoles(I),{verticesFlattened:this._vertexBuffer,indicesTriangles:I,indicesLineList:M}}_convertIndices(l,f){let g=[];for(let w=0;w<f.length;w++)g.push(this._vertexToIndex(l[2*f[w]],l[2*f[w]+1]));return g}_pointArrayToIndices(l){let f=[];for(let g=0;g<l.length;g++){let w=l[g];f.push(this._vertexToIndex(w.x,w.y))}return f}}function qM(h,l,f,g=!0){return new VG(f,l).subdividePolygonInternal(h,g)}function Yd(h,l,f=!1){if(!h||h.length<1)return[];if(h.length<2)return[];let g=h[0],w=h[h.length-1],I=f&&(g.x!==w.x||g.y!==w.y);if(l<2)return I?[...h,h[0]]:[...h];let M=Math.floor(ve/l),D=[];D.push(new B(h[0].x,h[0].y));let U=h.length,j=I?U:U-1;for(let $=0;$<j;$++){let Y=h[$],se=$<U-1?h[$+1]:h[0],le=Y.x,ue=Y.y,pe=se.x,Te=se.y,Re=le!==pe,et=ue!==Te;if(!Re&&!et)continue;let Ne=pe-le,oe=Te-ue,xe=Math.abs(Ne),He=Math.abs(oe),xt=le,Ht=ue;for(;;){let Rt=Ne>0?(Math.floor(xt/M)+1)*M:(Math.ceil(xt/M)-1)*M,Yt=oe>0?(Math.floor(Ht/M)+1)*M:(Math.ceil(Ht/M)-1)*M,$t=Math.abs(xt-Rt),Qt=Math.abs(Ht-Yt),Dt=Math.abs(xt-pe),Ar=Math.abs(Ht-Te),Rr=Re?$t/xe:Number.POSITIVE_INFINITY,Cr=et?Qt/He:Number.POSITIVE_INFINITY;if((Dt<=$t||!Re)&&(Ar<=Qt||!et))break;if(Rr<Cr&&Re||!et){xt=Rt,Ht+=oe*Rr;let _r=new B(xt,Math.round(Ht));D[D.length-1].x===_r.x&&D[D.length-1].y===_r.y||D.push(_r)}else{xt+=Ne*Cr,Ht=Yt;let _r=new B(Math.round(xt),Ht);D[D.length-1].x===_r.x&&D[D.length-1].y===_r.y||D.push(_r)}}let Et=new B(pe,Te);D[D.length-1].x===Et.x&&D[D.length-1].y===Et.y||D.push(Et)}return D}function jG(h,l,f){if(l.length===0)throw new Error("Subdivision vertex ring is empty.");let g=0,w=h[2*l[0]];for(let U=1;U<l.length;U++){let j=h[2*l[U]];j<w&&(w=j,g=U)}let I=l.length,M=g,D=(M+1)%I;for(;;){let U=M-1>=0?M-1:I-1,j=(D+1)%I,$=h[2*l[U]],Y=h[2*l[j]],se=h[2*l[M]],le=h[2*l[M]+1],ue=h[2*l[D]+1],pe=!1;if($<Y)pe=!0;else if($>Y)pe=!1;else{let Te=ue-le,Re=-(h[2*l[D]]-se),et=le<ue?1:-1;(($-se)*Te+(h[2*l[U]+1]-le)*Re)*et>((Y-se)*Te+(h[2*l[j]+1]-le)*Re)*et&&(pe=!0)}if(pe){let Te=l[U],Re=l[M],et=l[D];Te!==Re&&Te!==et&&Re!==et&&f.push(et,Re,Te),M--,M<0&&(M=I-1)}else{let Te=l[j],Re=l[M],et=l[D];Te!==Re&&Te!==et&&Re!==et&&f.push(et,Re,Te),D++,D>=I&&(D=0)}if(U===j)break}}function ZM(h,l,f,g,w,I,M,D,U){let j=w.length/2,$=M&&D&&U;if(j<Gr.MAX_VERTEX_ARRAY_LENGTH){let Y=l.prepareSegment(j,f,g),se=Y.vertexLength;for(let pe=0;pe<I.length;pe+=3)g.emplaceBack(se+I[pe],se+I[pe+1],se+I[pe+2]);let le,ue;Y.vertexLength+=j,Y.primitiveLength+=I.length/3,$&&(ue=M.prepareSegment(j,f,D),le=ue.vertexLength,ue.vertexLength+=j);for(let pe=0;pe<w.length;pe+=2)h(w[pe],w[pe+1]);if($)for(let pe=0;pe<U.length;pe++){let Te=U[pe];for(let Re=1;Re<Te.length;Re+=2)D.emplaceBack(le+Te[Re-1],le+Te[Re]);ue.primitiveLength+=Te.length/2}}else(function(Y,se,le,ue,pe,Te){let Re=[];for(let He=0;He<ue.length/2;He++)Re.push(-1);let et={count:0},Ne=0,oe=Y.getOrCreateLatestSegment(se,le),xe=oe.vertexLength;for(let He=2;He<pe.length;He+=3){let xt=pe[He-2],Ht=pe[He-1],Et=pe[He],Rt=Re[xt]<Ne,Yt=Re[Ht]<Ne,$t=Re[Et]<Ne;oe.vertexLength+((Rt?1:0)+(Yt?1:0)+($t?1:0))>Gr.MAX_VERTEX_ARRAY_LENGTH&&(oe=Y.createNewSegment(se,le),Ne=et.count,Rt=!0,Yt=!0,$t=!0,xe=0);let Qt=tg(Re,ue,Te,et,xt,Rt,oe),Dt=tg(Re,ue,Te,et,Ht,Yt,oe),Ar=tg(Re,ue,Te,et,Et,$t,oe);le.emplaceBack(xe+Qt-Ne,xe+Dt-Ne,xe+Ar-Ne),oe.primitiveLength++}})(l,f,g,w,I,h),$&&function(Y,se,le,ue,pe,Te){let Re=[];for(let He=0;He<ue.length/2;He++)Re.push(-1);let et={count:0},Ne=0,oe=Y.getOrCreateLatestSegment(se,le),xe=oe.vertexLength;for(let He=0;He<pe.length;He++){let xt=pe[He];for(let Ht=1;Ht<pe[He].length;Ht+=2){let Et=xt[Ht-1],Rt=xt[Ht],Yt=Re[Et]<Ne,$t=Re[Rt]<Ne;oe.vertexLength+((Yt?1:0)+($t?1:0))>Gr.MAX_VERTEX_ARRAY_LENGTH&&(oe=Y.createNewSegment(se,le),Ne=et.count,Yt=!0,$t=!0,xe=0);let Qt=tg(Re,ue,Te,et,Et,Yt,oe),Dt=tg(Re,ue,Te,et,Rt,$t,oe);le.emplaceBack(xe+Qt-Ne,xe+Dt-Ne),oe.primitiveLength++}}}(M,f,D,w,U,h),l.forceNewSegmentOnNextPrepare(),M?.forceNewSegmentOnNextPrepare()}function tg(h,l,f,g,w,I,M){if(I){let D=g.count;return f(l[2*w],l[2*w+1]),h[w]=g.count,g.count++,M.vertexLength++,D}return h[w]}class Z3{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qe,this.indexArray=new Ut,this.indexArray2=new mt,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new Gr,this.segments2=new Gr,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,g){this.hasPattern=H3("fill",this.layers,f);let w=this.layers[0].layout.get("fill-sort-key"),I=!w.isConstant(),M=[];for(let{feature:D,id:U,index:j,sourceLayerIndex:$}of l){let Y=this.layers[0]._featureFilter.needGeometry,se=ii(D,Y);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),se,g))continue;let le=I?w.evaluate(se,{},g,f.availableImages):void 0,ue={id:U,properties:D.properties,type:D.type,sourceLayerIndex:$,index:j,geometry:Y?se.geometry:ti(D),patterns:{},sortKey:le};M.push(ue)}I&&M.sort((D,U)=>D.sortKey-U.sortKey);for(let D of M){let{geometry:U,index:j,sourceLayerIndex:$}=D;if(this.hasPattern){let Y=W3("fill",this.layers,D,this.zoom,f);this.patternFeatures.push(Y)}else this.addFeature(D,U,j,g,{},f.subdivisionGranularity);f.featureIndex.insert(l[j].feature,U,j,$,this.index)}}update(l,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,g)}addFeatures(l,f,g){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,f,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,RG),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,f,g,w,I,M){for(let D of Ol(f,500)){let U=qM(D,w,M.fill.getGranularityForZoomLevel(w.z)),j=this.layoutVertexArray;ZM(($,Y)=>{j.emplaceBack($,Y)},this.segments,this.layoutVertexArray,this.indexArray,U.verticesFlattened,U.indicesTriangles,this.segments2,this.indexArray2,U.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}}let XM,YM;ur("FillBucket",Z3,{omit:["layers","patternFeatures"]});var GG={get paint(){return YM=YM||new to({"fill-antialias":new yr(ce.paint_fill["fill-antialias"]),"fill-opacity":new Mr(ce.paint_fill["fill-opacity"]),"fill-color":new Mr(ce.paint_fill["fill-color"]),"fill-outline-color":new Mr(ce.paint_fill["fill-outline-color"]),"fill-translate":new yr(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new yr(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new pf(ce.paint_fill["fill-pattern"])})},get layout(){return XM=XM||new to({"fill-sort-key":new Mr(ce.layout_fill["fill-sort-key"])})}};class HG extends Sn{constructor(l){super(l,GG)}recalculate(l,f){super.recalculate(l,f);let g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new Z3(l)}queryRadius(){return cx(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:l,geometry:f,transform:g,pixelsToTileUnits:w}){return ln(ux(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-g.bearingInRadians,w),f)}isTileClipped(){return!0}}let WG=Bn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),$G=Bn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:qG}=WG;var X3,KM,Y3,QM,K3,JM,e5,px={};function t5(){if(KM)return X3;KM=1;var h=p();function l(w,I,M,D,U){this.properties={},this.extent=M,this.type=0,this._pbf=w,this._geometry=-1,this._keys=D,this._values=U,w.readFields(f,this,I)}function f(w,I,M){w==1?I.id=M.readVarint():w==2?function(D,U){for(var j=D.readVarint()+D.pos;D.pos<j;){var $=U._keys[D.readVarint()],Y=U._values[D.readVarint()];U.properties[$]=Y}}(M,I):w==3?I.type=M.readVarint():w==4&&(I._geometry=M.pos)}function g(w){for(var I,M,D=0,U=0,j=w.length,$=j-1;U<j;$=U++)D+=((M=w[$]).x-(I=w[U]).x)*(I.y+M.y);return D}return X3=l,l.types=["Unknown","Point","LineString","Polygon"],l.prototype.loadGeometry=function(){var w=this._pbf;w.pos=this._geometry;for(var I,M=w.readVarint()+w.pos,D=1,U=0,j=0,$=0,Y=[];w.pos<M;){if(U<=0){var se=w.readVarint();D=7&se,U=se>>3}if(U--,D===1||D===2)j+=w.readSVarint(),$+=w.readSVarint(),D===1&&(I&&Y.push(I),I=[]),I.push(new h(j,$));else{if(D!==7)throw new Error("unknown command "+D);I&&I.push(I[0].clone())}}return I&&Y.push(I),Y},l.prototype.bbox=function(){var w=this._pbf;w.pos=this._geometry;for(var I=w.readVarint()+w.pos,M=1,D=0,U=0,j=0,$=1/0,Y=-1/0,se=1/0,le=-1/0;w.pos<I;){if(D<=0){var ue=w.readVarint();M=7&ue,D=ue>>3}if(D--,M===1||M===2)(U+=w.readSVarint())<$&&($=U),U>Y&&(Y=U),(j+=w.readSVarint())<se&&(se=j),j>le&&(le=j);else if(M!==7)throw new Error("unknown command "+M)}return[$,se,Y,le]},l.prototype.toGeoJSON=function(w,I,M){var D,U,j=this.extent*Math.pow(2,M),$=this.extent*w,Y=this.extent*I,se=this.loadGeometry(),le=l.types[this.type];function ue(Re){for(var et=0;et<Re.length;et++){var Ne=Re[et];Re[et]=[360*(Ne.x+$)/j-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ne.y+Y)/j)*Math.PI/180))-90]}}switch(this.type){case 1:var pe=[];for(D=0;D<se.length;D++)pe[D]=se[D][0];ue(se=pe);break;case 2:for(D=0;D<se.length;D++)ue(se[D]);break;case 3:for(se=function(Re){var et=Re.length;if(et<=1)return[Re];for(var Ne,oe,xe=[],He=0;He<et;He++){var xt=g(Re[He]);xt!==0&&(oe===void 0&&(oe=xt<0),oe===xt<0?(Ne&&xe.push(Ne),Ne=[Re[He]]):Ne.push(Re[He]))}return Ne&&xe.push(Ne),xe}(se),D=0;D<se.length;D++)for(U=0;U<se[D].length;U++)ue(se[D][U])}se.length===1?se=se[0]:le="Multi"+le;var Te={type:"Feature",geometry:{type:le,coordinates:se},properties:this.properties};return"id"in this&&(Te.id=this.id),Te},X3}function r5(){if(QM)return Y3;QM=1;var h=t5();function l(g,w){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=g,this._keys=[],this._values=[],this._features=[],g.readFields(f,this,w),this.length=this._features.length}function f(g,w,I){g===15?w.version=I.readVarint():g===1?w.name=I.readString():g===5?w.extent=I.readVarint():g===2?w._features.push(I.pos):g===3?w._keys.push(I.readString()):g===4&&w._values.push(function(M){for(var D=null,U=M.readVarint()+M.pos;M.pos<U;){var j=M.readVarint()>>3;D=j===1?M.readString():j===2?M.readFloat():j===3?M.readDouble():j===4?M.readVarint64():j===5?M.readVarint():j===6?M.readSVarint():j===7?M.readBoolean():null}return D}(I))}return Y3=l,l.prototype.feature=function(g){if(g<0||g>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[g];var w=this._pbf.readVarint()+this._pbf.pos;return new h(this._pbf,w,this.extent,this._keys,this._values)},Y3}function i5(){return e5||(e5=1,px.VectorTile=function(){if(JM)return K3;JM=1;var h=r5();function l(f,g,w){if(f===3){var I=new h(w,w.readVarint()+w.pos);I.length&&(g[I.name]=I)}}return K3=function(f,g){this.layers=f.readFields(l,{},g)},K3}(),px.VectorTileFeature=t5(),px.VectorTileLayer=r5()),px}var rg=a(i5());let ZG=rg.VectorTileFeature.types,Q3=Math.pow(2,13);function ig(h,l,f,g,w,I,M,D){h.emplaceBack(l,f,2*Math.floor(g*Q3)+M,w*Q3*2,I*Q3*2,Math.round(D))}class J3{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Ge,this.centroidVertexArray=new Ve,this.indexArray=new Ut,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new Gr,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,g){this.features=[],this.hasPattern=H3("fill-extrusion",this.layers,f);for(let{feature:w,id:I,index:M,sourceLayerIndex:D}of l){let U=this.layers[0]._featureFilter.needGeometry,j=ii(w,U);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),j,g))continue;let $={id:I,sourceLayerIndex:D,index:M,geometry:U?j.geometry:ti(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(W3("fill-extrusion",this.layers,$,this.zoom,f)):this.addFeature($,$.geometry,M,g,{},f.subdivisionGranularity),f.featureIndex.insert(w,$.geometry,M,D,this.index,!0)}}addFeatures(l,f,g){for(let w of this.features){let{geometry:I}=w;this.addFeature(w,I,w.index,f,g,l.subdivisionGranularity)}}update(l,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,g)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,qG),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,$G.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,f,g,w,I,M){for(let D of Ol(f,500)){let U={x:0,y:0,sampleCount:0},j=this.layoutVertexArray.length;this.processPolygon(U,w,l,D,M);let $=this.layoutVertexArray.length-j,Y=Math.floor(U.x/U.sampleCount),se=Math.floor(U.y/U.sampleCount);for(let le=0;le<$;le++)this.centroidVertexArray.emplaceBack(Y,se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}processPolygon(l,f,g,w,I){if(w.length<1||n5(w[0]))return;for(let Y of w)Y.length!==0&&XG(l,Y);let M={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},D=I.fill.getGranularityForZoomLevel(f.z),U=ZG[g.type]==="Polygon";for(let Y of w){if(Y.length===0||n5(Y))continue;let se=Yd(Y,D,U);this._generateSideFaces(se,M)}if(!U)return;let j=qM(w,f,D,!1),$=this.layoutVertexArray;ZM((Y,se)=>{ig($,Y,se,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,j.verticesFlattened,j.indicesTriangles)}_generateSideFaces(l,f){let g=0;for(let w=1;w<l.length;w++){let I=l[w],M=l[w-1];if(YG(I,M))continue;f.segment.vertexLength+4>Gr.MAX_VERTEX_ARRAY_LENGTH&&(f.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let D=I.sub(M)._perp()._unit(),U=M.dist(I);g+U>32768&&(g=0),ig(this.layoutVertexArray,I.x,I.y,D.x,D.y,0,0,g),ig(this.layoutVertexArray,I.x,I.y,D.x,D.y,0,1,g),g+=U,ig(this.layoutVertexArray,M.x,M.y,D.x,D.y,0,0,g),ig(this.layoutVertexArray,M.x,M.y,D.x,D.y,0,1,g);let j=f.segment.vertexLength;this.indexArray.emplaceBack(j,j+2,j+1),this.indexArray.emplaceBack(j+1,j+2,j+3),f.segment.vertexLength+=4,f.segment.primitiveLength+=2}}}function XG(h,l){for(let f=0;f<l.length;f++){let g=l[f];f===l.length-1&&l[0].x===g.x&&l[0].y===g.y||(h.x+=g.x,h.y+=g.y,h.sampleCount++)}}function YG(h,l){return h.x===l.x&&(h.x<0||h.x>ve)||h.y===l.y&&(h.y<0||h.y>ve)}function n5(h){return h.every(l=>l.x<0)||h.every(l=>l.x>ve)||h.every(l=>l.y<0)||h.every(l=>l.y>ve)}let s5;ur("FillExtrusionBucket",J3,{omit:["layers","features"]});var KG={get paint(){return s5=s5||new to({"fill-extrusion-opacity":new yr(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mr(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new yr(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new yr(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pf(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mr(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mr(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new yr(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class QG extends Sn{constructor(l){super(l,KG)}createBucket(l){return new J3(l)}queryRadius(){return cx(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:l,feature:f,featureState:g,geometry:w,transform:I,pixelsToTileUnits:M,pixelPosMatrix:D}){let U=ux(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-I.bearingInRadians,M),j=this.paint.get("fill-extrusion-height").evaluate(f,g),$=this.paint.get("fill-extrusion-base").evaluate(f,g),Y=function(le,ue,pe){let Te=[];for(let Re of le){let et=[Re.x,Re.y,0,1];X(et,et,ue),Te.push(new B(et[0]/et[3],et[1]/et[3]))}return Te}(U,D),se=function(le,ue,pe,Te){let Re=[],et=[],Ne=Te[8]*ue,oe=Te[9]*ue,xe=Te[10]*ue,He=Te[11]*ue,xt=Te[8]*pe,Ht=Te[9]*pe,Et=Te[10]*pe,Rt=Te[11]*pe;for(let Yt of le){let $t=[],Qt=[];for(let Dt of Yt){let Ar=Dt.x,Rr=Dt.y,Cr=Te[0]*Ar+Te[4]*Rr+Te[12],_r=Te[1]*Ar+Te[5]*Rr+Te[13],mi=Te[2]*Ar+Te[6]*Rr+Te[14],Fn=Te[3]*Ar+Te[7]*Rr+Te[15],hs=mi+xe,io=Fn+He,Ba=Cr+xt,Ho=_r+Ht,Us=mi+Et,Ln=Fn+Rt,Ss=new B((Cr+Ne)/io,(_r+oe)/io);Ss.z=hs/io,$t.push(Ss);let Vs=new B(Ba/Ln,Ho/Ln);Vs.z=Us/Ln,Qt.push(Vs)}Re.push($t),et.push(Qt)}return[Re,et]}(w,$,j,D);return function(le,ue,pe){let Te=1/0;ln(pe,ue)&&(Te=o5(pe,ue[0]));for(let Re=0;Re<ue.length;Re++){let et=ue[Re],Ne=le[Re];for(let oe=0;oe<et.length-1;oe++){let xe=et[oe],He=[xe,et[oe+1],Ne[oe+1],Ne[oe],xe];Ni(pe,He)&&(Te=Math.min(Te,o5(pe,He)))}}return Te!==1/0&&Te}(se[0],se[1],Y)}}function ng(h,l){return h.x*l.x+h.y*l.y}function o5(h,l){if(h.length===1){let f=0,g=l[f++],w;for(;!w||g.equals(w);)if(w=l[f++],!w)return 1/0;for(;f<l.length;f++){let I=l[f],M=h[0],D=w.sub(g),U=I.sub(g),j=M.sub(g),$=ng(D,D),Y=ng(D,U),se=ng(U,U),le=ng(j,D),ue=ng(j,U),pe=$*se-Y*Y,Te=(se*le-Y*ue)/pe,Re=($*ue-Y*le)/pe,et=g.z*(1-Te-Re)+w.z*Te+I.z*Re;if(isFinite(et))return et}return 1/0}{let f=1/0;for(let g of l)f=Math.min(f,g.z);return f}}let JG=Bn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:eH}=JG,tH=Bn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rH}=tH,iH=rg.VectorTileFeature.types,nH=Math.cos(Math.PI/180*37.5),a5=Math.pow(2,14)/.5;class eT{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Ze,this.layoutVertexArray2=new _t,this.indexArray=new Ut,this.programConfigurations=new ar(l.layers,l.zoom),this.segments=new Gr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,g){this.hasPattern=H3("line",this.layers,f);let w=this.layers[0].layout.get("line-sort-key"),I=!w.isConstant(),M=[];for(let{feature:D,id:U,index:j,sourceLayerIndex:$}of l){let Y=this.layers[0]._featureFilter.needGeometry,se=ii(D,Y);if(!this.layers[0]._featureFilter.filter(new an(this.zoom),se,g))continue;let le=I?w.evaluate(se,{},g):void 0,ue={id:U,properties:D.properties,type:D.type,sourceLayerIndex:$,index:j,geometry:Y?se.geometry:ti(D),patterns:{},sortKey:le};M.push(ue)}I&&M.sort((D,U)=>D.sortKey-U.sortKey);for(let D of M){let{geometry:U,index:j,sourceLayerIndex:$}=D;if(this.hasPattern){let Y=W3("line",this.layers,D,this.zoom,f);this.patternFeatures.push(Y)}else this.addFeature(D,U,j,g,{},f.subdivisionGranularity);f.featureIndex.insert(l[j].feature,U,j,$,this.index)}}update(l,f,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,g)}addFeatures(l,f,g){for(let w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,f,g,l.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,rH)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,eH),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,f,g,w,I,M){let D=this.layers[0].layout,U=D.get("line-join").evaluate(l,{}),j=D.get("line-cap"),$=D.get("line-miter-limit"),Y=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(let se of f)this.addLine(se,l,U,j,$,Y,w,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,g,I,w)}addLine(l,f,g,w,I,M,D,U){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,l=Yd(l,D?U.line.getGranularityForZoomLevel(D.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ne=0;Ne<l.length-1;Ne++)this.totalDistance+=l[Ne].dist(l[Ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let j=iH[f.type]==="Polygon",$=l.length;for(;$>=2&&l[$-1].equals(l[$-2]);)$--;let Y=0;for(;Y<$-1&&l[Y].equals(l[Y+1]);)Y++;if($<(j?3:2))return;g==="bevel"&&(I=1.05);let se=this.overscaling<=16?15*ve/(512*this.overscaling):0,le=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray),ue,pe,Te,Re,et;this.e1=this.e2=-1,j&&(ue=l[$-2],et=l[Y].sub(ue)._unit()._perp());for(let Ne=Y;Ne<$;Ne++){if(Te=Ne===$-1?j?l[Y+1]:void 0:l[Ne+1],Te&&l[Ne].equals(Te))continue;et&&(Re=et),ue&&(pe=ue),ue=l[Ne],et=Te?Te.sub(ue)._unit()._perp():Re,Re=Re||et;let oe=Re.add(et);oe.x===0&&oe.y===0||oe._unit();let xe=Re.x*et.x+Re.y*et.y,He=oe.x*et.x+oe.y*et.y,xt=He!==0?1/He:1/0,Ht=2*Math.sqrt(2-2*He),Et=He<nH&&pe&&Te,Rt=Re.x*et.y-Re.y*et.x>0;if(Et&&Ne>Y){let Qt=ue.dist(pe);if(Qt>2*se){let Dt=ue.sub(ue.sub(pe)._mult(se/Qt)._round());this.updateDistance(pe,Dt),this.addCurrentVertex(Dt,Re,0,0,le),pe=Dt}}let Yt=pe&&Te,$t=Yt?g:j?"butt":w;if(Yt&&$t==="round"&&(xt<M?$t="miter":xt<=2&&($t="fakeround")),$t==="miter"&&xt>I&&($t="bevel"),$t==="bevel"&&(xt>2&&($t="flipbevel"),xt<I&&($t="miter")),pe&&this.updateDistance(pe,ue),$t==="miter")oe._mult(xt),this.addCurrentVertex(ue,oe,0,0,le);else if($t==="flipbevel"){if(xt>100)oe=et.mult(-1);else{let Qt=xt*Re.add(et).mag()/Re.sub(et).mag();oe._perp()._mult(Qt*(Rt?-1:1))}this.addCurrentVertex(ue,oe,0,0,le),this.addCurrentVertex(ue,oe.mult(-1),0,0,le)}else if($t==="bevel"||$t==="fakeround"){let Qt=-Math.sqrt(xt*xt-1),Dt=Rt?Qt:0,Ar=Rt?0:Qt;if(pe&&this.addCurrentVertex(ue,Re,Dt,Ar,le),$t==="fakeround"){let Rr=Math.round(180*Ht/Math.PI/20);for(let Cr=1;Cr<Rr;Cr++){let _r=Cr/Rr;if(_r!==.5){let Fn=_r-.5;_r+=_r*Fn*(_r-1)*((1.0904+xe*(xe*(3.55645-1.43519*xe)-3.2452))*Fn*Fn+(.848013+xe*(.215638*xe-1.06021)))}let mi=et.sub(Re)._mult(_r)._add(Re)._unit()._mult(Rt?-1:1);this.addHalfVertex(ue,mi.x,mi.y,!1,Rt,0,le)}}Te&&this.addCurrentVertex(ue,et,-Dt,-Ar,le)}else if($t==="butt")this.addCurrentVertex(ue,oe,0,0,le);else if($t==="square"){let Qt=pe?1:-1;this.addCurrentVertex(ue,oe,Qt,Qt,le)}else $t==="round"&&(pe&&(this.addCurrentVertex(ue,Re,0,0,le),this.addCurrentVertex(ue,Re,1,1,le,!0)),Te&&(this.addCurrentVertex(ue,et,-1,-1,le,!0),this.addCurrentVertex(ue,et,0,0,le)));if(Et&&Ne<$-1){let Qt=ue.dist(Te);if(Qt>2*se){let Dt=ue.add(Te.sub(ue)._mult(se/Qt)._round());this.updateDistance(ue,Dt),this.addCurrentVertex(Dt,et,0,0,le),ue=Dt}}}}addCurrentVertex(l,f,g,w,I,M=!1){let D=f.y*w-f.x,U=-f.y-f.x*w;this.addHalfVertex(l,f.x+f.y*g,f.y-f.x*g,M,!1,g,I),this.addHalfVertex(l,D,U,M,!0,-w,I),this.distance>a5/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,f,g,w,I,M))}addHalfVertex({x:l,y:f},g,w,I,M,D,U){let j=.5*(this.lineClips?this.scaledDistance*(a5-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(I?1:0),(f<<1)+(M?1:0),Math.round(63*g)+128,Math.round(63*w)+128,1+(D===0?0:D<0?-1:1)|(63&j)<<2,j>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let $=U.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,$,this.e2),U.primitiveLength++),M?this.e2=$:this.e1=$}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,f){this.distance+=l.dist(f),this.updateScaledDistance()}}let l5,c5;ur("LineBucket",eT,{omit:["layers","patternFeatures"]});var u5={get paint(){return c5=c5||new to({"line-opacity":new Mr(ce.paint_line["line-opacity"]),"line-color":new Mr(ce.paint_line["line-color"]),"line-translate":new yr(ce.paint_line["line-translate"]),"line-translate-anchor":new yr(ce.paint_line["line-translate-anchor"]),"line-width":new Mr(ce.paint_line["line-width"]),"line-gap-width":new Mr(ce.paint_line["line-gap-width"]),"line-offset":new Mr(ce.paint_line["line-offset"]),"line-blur":new Mr(ce.paint_line["line-blur"]),"line-dasharray":new jd(ce.paint_line["line-dasharray"]),"line-pattern":new pf(ce.paint_line["line-pattern"]),"line-gradient":new Af(ce.paint_line["line-gradient"])})},get layout(){return l5=l5||new to({"line-cap":new yr(ce.layout_line["line-cap"]),"line-join":new Mr(ce.layout_line["line-join"]),"line-miter-limit":new yr(ce.layout_line["line-miter-limit"]),"line-round-limit":new yr(ce.layout_line["line-round-limit"]),"line-sort-key":new Mr(ce.layout_line["line-sort-key"])})}};class sH extends Mr{possiblyEvaluate(l,f){return f=new an(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(l,f)}evaluate(l,f,g,w){return f=qt({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(l,f,g,w)}}let Ax;class oH extends Sn{constructor(l){super(l,u5),this.gradientVersion=0,Ax||(Ax=new sH(u5.paint.properties["line-width"].specification),Ax.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){let f=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof Nu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,f){super.recalculate(l,f),this.paint._values["line-floorwidth"]=Ax.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new eT(l)}queryRadius(l){let f=l,g=h5(Zm("line-width",this,f),Zm("line-gap-width",this,f)),w=Zm("line-offset",this,f);return g/2+Math.abs(w)+cx(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:l,feature:f,featureState:g,geometry:w,transform:I,pixelsToTileUnits:M}){let D=ux(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-I.bearingInRadians,M),U=M/2*h5(this.paint.get("line-width").evaluate(f,g),this.paint.get("line-gap-width").evaluate(f,g)),j=this.paint.get("line-offset").evaluate(f,g);return j&&(w=function($,Y){let se=[];for(let le=0;le<$.length;le++){let ue=$[le],pe=[];for(let Te=0;Te<ue.length;Te++){let Re=ue[Te-1],et=ue[Te],Ne=ue[Te+1],oe=Te===0?new B(0,0):et.sub(Re)._unit()._perp(),xe=Te===ue.length-1?new B(0,0):Ne.sub(et)._unit()._perp(),He=oe._add(xe)._unit(),xt=He.x*xe.x+He.y*xe.y;xt!==0&&He._mult(1/xt),pe.push(He._mult(Y)._add(et))}se.push(pe)}return se}(w,j*M)),function($,Y,se){for(let le=0;le<Y.length;le++){let ue=Y[le];if($.length>=3){for(let pe=0;pe<ue.length;pe++)if(Zd($,ue[pe]))return!0}if(yo($,ue,se))return!0}return!1}(D,w,U)}isTileClipped(){return!0}}function h5(h,l){return l>0?l+2*h:h}let aH=Bn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lH=Bn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Bn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let cH=Bn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Bn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let f5=Bn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),uH=Bn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function hH(h,l,f){return h.sections.forEach(g=>{g.text=function(w,I,M){let D=I.layout.get("text-transform").evaluate(M,{});return D==="uppercase"?w=w.toLocaleUpperCase():D==="lowercase"&&(w=w.toLocaleLowerCase()),Pa.applyArabicShaping&&(w=Pa.applyArabicShaping(w)),w}(g.text,l,f)}),h}Bn([{name:"triangle",components:3,type:"Uint16"}]),Bn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Bn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Bn([{type:"Float32",name:"offsetX"}]),Bn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Bn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let sg={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var d5,tT,p5,us=24,rT={};function fH(){return d5||(d5=1,rT.read=function(h,l,f,g,w){var I,M,D=8*w-g-1,U=(1<<D)-1,j=U>>1,$=-7,Y=f?w-1:0,se=f?-1:1,le=h[l+Y];for(Y+=se,I=le&(1<<-$)-1,le>>=-$,$+=D;$>0;I=256*I+h[l+Y],Y+=se,$-=8);for(M=I&(1<<-$)-1,I>>=-$,$+=g;$>0;M=256*M+h[l+Y],Y+=se,$-=8);if(I===0)I=1-j;else{if(I===U)return M?NaN:1/0*(le?-1:1);M+=Math.pow(2,g),I-=j}return(le?-1:1)*M*Math.pow(2,I-g)},rT.write=function(h,l,f,g,w,I){var M,D,U,j=8*I-w-1,$=(1<<j)-1,Y=$>>1,se=w===23?Math.pow(2,-24)-Math.pow(2,-77):0,le=g?0:I-1,ue=g?1:-1,pe=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(D=isNaN(l)?1:0,M=$):(M=Math.floor(Math.log(l)/Math.LN2),l*(U=Math.pow(2,-M))<1&&(M--,U*=2),(l+=M+Y>=1?se/U:se*Math.pow(2,1-Y))*U>=2&&(M++,U/=2),M+Y>=$?(D=0,M=$):M+Y>=1?(D=(l*U-1)*Math.pow(2,w),M+=Y):(D=l*Math.pow(2,Y-1)*Math.pow(2,w),M=0));w>=8;h[f+le]=255&D,le+=ue,D/=256,w-=8);for(M=M<<w|D,j+=w;j>0;h[f+le]=255&M,le+=ue,M/=256,j-=8);h[f+le-ue]|=128*pe}),rT}function A5(){if(p5)return tT;p5=1,tT=l;var h=fH();function l(oe){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(oe)?oe:new Uint8Array(oe||0),this.pos=0,this.type=0,this.length=this.buf.length}l.Varint=0,l.Fixed64=1,l.Bytes=2,l.Fixed32=5;var f=4294967296,g=1/f,w=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function I(oe){return oe.type===l.Bytes?oe.readVarint()+oe.pos:oe.pos+1}function M(oe,xe,He){return He?4294967296*xe+(oe>>>0):4294967296*(xe>>>0)+(oe>>>0)}function D(oe,xe,He){var xt=xe<=16383?1:xe<=2097151?2:xe<=268435455?3:Math.floor(Math.log(xe)/(7*Math.LN2));He.realloc(xt);for(var Ht=He.pos-1;Ht>=oe;Ht--)He.buf[Ht+xt]=He.buf[Ht]}function U(oe,xe){for(var He=0;He<oe.length;He++)xe.writeVarint(oe[He])}function j(oe,xe){for(var He=0;He<oe.length;He++)xe.writeSVarint(oe[He])}function $(oe,xe){for(var He=0;He<oe.length;He++)xe.writeFloat(oe[He])}function Y(oe,xe){for(var He=0;He<oe.length;He++)xe.writeDouble(oe[He])}function se(oe,xe){for(var He=0;He<oe.length;He++)xe.writeBoolean(oe[He])}function le(oe,xe){for(var He=0;He<oe.length;He++)xe.writeFixed32(oe[He])}function ue(oe,xe){for(var He=0;He<oe.length;He++)xe.writeSFixed32(oe[He])}function pe(oe,xe){for(var He=0;He<oe.length;He++)xe.writeFixed64(oe[He])}function Te(oe,xe){for(var He=0;He<oe.length;He++)xe.writeSFixed64(oe[He])}function Re(oe,xe){return(oe[xe]|oe[xe+1]<<8|oe[xe+2]<<16)+16777216*oe[xe+3]}function et(oe,xe,He){oe[He]=xe,oe[He+1]=xe>>>8,oe[He+2]=xe>>>16,oe[He+3]=xe>>>24}function Ne(oe,xe){return(oe[xe]|oe[xe+1]<<8|oe[xe+2]<<16)+(oe[xe+3]<<24)}return l.prototype={destroy:function(){this.buf=null},readFields:function(oe,xe,He){for(He=He||this.length;this.pos<He;){var xt=this.readVarint(),Ht=xt>>3,Et=this.pos;this.type=7&xt,oe(Ht,xe,this),this.pos===Et&&this.skip(xt)}return xe},readMessage:function(oe,xe){return this.readFields(oe,xe,this.readVarint()+this.pos)},readFixed32:function(){var oe=Re(this.buf,this.pos);return this.pos+=4,oe},readSFixed32:function(){var oe=Ne(this.buf,this.pos);return this.pos+=4,oe},readFixed64:function(){var oe=Re(this.buf,this.pos)+Re(this.buf,this.pos+4)*f;return this.pos+=8,oe},readSFixed64:function(){var oe=Re(this.buf,this.pos)+Ne(this.buf,this.pos+4)*f;return this.pos+=8,oe},readFloat:function(){var oe=h.read(this.buf,this.pos,!0,23,4);return this.pos+=4,oe},readDouble:function(){var oe=h.read(this.buf,this.pos,!0,52,8);return this.pos+=8,oe},readVarint:function(oe){var xe,He,xt=this.buf;return xe=127&(He=xt[this.pos++]),He<128?xe:(xe|=(127&(He=xt[this.pos++]))<<7,He<128?xe:(xe|=(127&(He=xt[this.pos++]))<<14,He<128?xe:(xe|=(127&(He=xt[this.pos++]))<<21,He<128?xe:function(Ht,Et,Rt){var Yt,$t,Qt=Rt.buf;if(Yt=(112&($t=Qt[Rt.pos++]))>>4,$t<128||(Yt|=(127&($t=Qt[Rt.pos++]))<<3,$t<128)||(Yt|=(127&($t=Qt[Rt.pos++]))<<10,$t<128)||(Yt|=(127&($t=Qt[Rt.pos++]))<<17,$t<128)||(Yt|=(127&($t=Qt[Rt.pos++]))<<24,$t<128)||(Yt|=(1&($t=Qt[Rt.pos++]))<<31,$t<128))return M(Ht,Yt,Et);throw new Error("Expected varint not more than 10 bytes")}(xe|=(15&(He=xt[this.pos]))<<28,oe,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var oe=this.readVarint();return oe%2==1?(oe+1)/-2:oe/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var oe=this.readVarint()+this.pos,xe=this.pos;return this.pos=oe,oe-xe>=12&&w?function(He,xt,Ht){return w.decode(He.subarray(xt,Ht))}(this.buf,xe,oe):function(He,xt,Ht){for(var Et="",Rt=xt;Rt<Ht;){var Yt,$t,Qt,Dt=He[Rt],Ar=null,Rr=Dt>239?4:Dt>223?3:Dt>191?2:1;if(Rt+Rr>Ht)break;Rr===1?Dt<128&&(Ar=Dt):Rr===2?(192&(Yt=He[Rt+1]))==128&&(Ar=(31&Dt)<<6|63&Yt)<=127&&(Ar=null):Rr===3?($t=He[Rt+2],(192&(Yt=He[Rt+1]))==128&&(192&$t)==128&&((Ar=(15&Dt)<<12|(63&Yt)<<6|63&$t)<=2047||Ar>=55296&&Ar<=57343)&&(Ar=null)):Rr===4&&($t=He[Rt+2],Qt=He[Rt+3],(192&(Yt=He[Rt+1]))==128&&(192&$t)==128&&(192&Qt)==128&&((Ar=(15&Dt)<<18|(63&Yt)<<12|(63&$t)<<6|63&Qt)<=65535||Ar>=1114112)&&(Ar=null)),Ar===null?(Ar=65533,Rr=1):Ar>65535&&(Ar-=65536,Et+=String.fromCharCode(Ar>>>10&1023|55296),Ar=56320|1023&Ar),Et+=String.fromCharCode(Ar),Rt+=Rr}return Et}(this.buf,xe,oe)},readBytes:function(){var oe=this.readVarint()+this.pos,xe=this.buf.subarray(this.pos,oe);return this.pos=oe,xe},readPackedVarint:function(oe,xe){if(this.type!==l.Bytes)return oe.push(this.readVarint(xe));var He=I(this);for(oe=oe||[];this.pos<He;)oe.push(this.readVarint(xe));return oe},readPackedSVarint:function(oe){if(this.type!==l.Bytes)return oe.push(this.readSVarint());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readSVarint());return oe},readPackedBoolean:function(oe){if(this.type!==l.Bytes)return oe.push(this.readBoolean());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readBoolean());return oe},readPackedFloat:function(oe){if(this.type!==l.Bytes)return oe.push(this.readFloat());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readFloat());return oe},readPackedDouble:function(oe){if(this.type!==l.Bytes)return oe.push(this.readDouble());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readDouble());return oe},readPackedFixed32:function(oe){if(this.type!==l.Bytes)return oe.push(this.readFixed32());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readFixed32());return oe},readPackedSFixed32:function(oe){if(this.type!==l.Bytes)return oe.push(this.readSFixed32());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readSFixed32());return oe},readPackedFixed64:function(oe){if(this.type!==l.Bytes)return oe.push(this.readFixed64());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readFixed64());return oe},readPackedSFixed64:function(oe){if(this.type!==l.Bytes)return oe.push(this.readSFixed64());var xe=I(this);for(oe=oe||[];this.pos<xe;)oe.push(this.readSFixed64());return oe},skip:function(oe){var xe=7&oe;if(xe===l.Varint)for(;this.buf[this.pos++]>127;);else if(xe===l.Bytes)this.pos=this.readVarint()+this.pos;else if(xe===l.Fixed32)this.pos+=4;else{if(xe!==l.Fixed64)throw new Error("Unimplemented type: "+xe);this.pos+=8}},writeTag:function(oe,xe){this.writeVarint(oe<<3|xe)},realloc:function(oe){for(var xe=this.length||16;xe<this.pos+oe;)xe*=2;if(xe!==this.length){var He=new Uint8Array(xe);He.set(this.buf),this.buf=He,this.length=xe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(oe){this.realloc(4),et(this.buf,oe,this.pos),this.pos+=4},writeSFixed32:function(oe){this.realloc(4),et(this.buf,oe,this.pos),this.pos+=4},writeFixed64:function(oe){this.realloc(8),et(this.buf,-1&oe,this.pos),et(this.buf,Math.floor(oe*g),this.pos+4),this.pos+=8},writeSFixed64:function(oe){this.realloc(8),et(this.buf,-1&oe,this.pos),et(this.buf,Math.floor(oe*g),this.pos+4),this.pos+=8},writeVarint:function(oe){(oe=+oe||0)>268435455||oe<0?function(xe,He){var xt,Ht;if(xe>=0?(xt=xe%4294967296|0,Ht=xe/4294967296|0):(Ht=~(-xe/4294967296),4294967295^(xt=~(-xe%4294967296))?xt=xt+1|0:(xt=0,Ht=Ht+1|0)),xe>=18446744073709552e3||xe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");He.realloc(10),function(Et,Rt,Yt){Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Et>>>=7,Yt.buf[Yt.pos++]=127&Et|128,Yt.buf[Yt.pos]=127&(Et>>>=7)}(xt,0,He),function(Et,Rt){var Yt=(7&Et)<<4;Rt.buf[Rt.pos++]|=Yt|((Et>>>=3)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et|((Et>>>=7)?128:0),Et&&(Rt.buf[Rt.pos++]=127&Et)))))}(Ht,He)}(oe,this):(this.realloc(4),this.buf[this.pos++]=127&oe|(oe>127?128:0),oe<=127||(this.buf[this.pos++]=127&(oe>>>=7)|(oe>127?128:0),oe<=127||(this.buf[this.pos++]=127&(oe>>>=7)|(oe>127?128:0),oe<=127||(this.buf[this.pos++]=oe>>>7&127))))},writeSVarint:function(oe){this.writeVarint(oe<0?2*-oe-1:2*oe)},writeBoolean:function(oe){this.writeVarint(!!oe)},writeString:function(oe){oe=String(oe),this.realloc(4*oe.length),this.pos++;var xe=this.pos;this.pos=function(xt,Ht,Et){for(var Rt,Yt,$t=0;$t<Ht.length;$t++){if((Rt=Ht.charCodeAt($t))>55295&&Rt<57344){if(!Yt){Rt>56319||$t+1===Ht.length?(xt[Et++]=239,xt[Et++]=191,xt[Et++]=189):Yt=Rt;continue}if(Rt<56320){xt[Et++]=239,xt[Et++]=191,xt[Et++]=189,Yt=Rt;continue}Rt=Yt-55296<<10|Rt-56320|65536,Yt=null}else Yt&&(xt[Et++]=239,xt[Et++]=191,xt[Et++]=189,Yt=null);Rt<128?xt[Et++]=Rt:(Rt<2048?xt[Et++]=Rt>>6|192:(Rt<65536?xt[Et++]=Rt>>12|224:(xt[Et++]=Rt>>18|240,xt[Et++]=Rt>>12&63|128),xt[Et++]=Rt>>6&63|128),xt[Et++]=63&Rt|128)}return Et}(this.buf,oe,this.pos);var He=this.pos-xe;He>=128&&D(xe,He,this),this.pos=xe-1,this.writeVarint(He),this.pos+=He},writeFloat:function(oe){this.realloc(4),h.write(this.buf,oe,this.pos,!0,23,4),this.pos+=4},writeDouble:function(oe){this.realloc(8),h.write(this.buf,oe,this.pos,!0,52,8),this.pos+=8},writeBytes:function(oe){var xe=oe.length;this.writeVarint(xe),this.realloc(xe);for(var He=0;He<xe;He++)this.buf[this.pos++]=oe[He]},writeRawMessage:function(oe,xe){this.pos++;var He=this.pos;oe(xe,this);var xt=this.pos-He;xt>=128&&D(He,xt,this),this.pos=He-1,this.writeVarint(xt),this.pos+=xt},writeMessage:function(oe,xe,He){this.writeTag(oe,l.Bytes),this.writeRawMessage(xe,He)},writePackedVarint:function(oe,xe){xe.length&&this.writeMessage(oe,U,xe)},writePackedSVarint:function(oe,xe){xe.length&&this.writeMessage(oe,j,xe)},writePackedBoolean:function(oe,xe){xe.length&&this.writeMessage(oe,se,xe)},writePackedFloat:function(oe,xe){xe.length&&this.writeMessage(oe,$,xe)},writePackedDouble:function(oe,xe){xe.length&&this.writeMessage(oe,Y,xe)},writePackedFixed32:function(oe,xe){xe.length&&this.writeMessage(oe,le,xe)},writePackedSFixed32:function(oe,xe){xe.length&&this.writeMessage(oe,ue,xe)},writePackedFixed64:function(oe,xe){xe.length&&this.writeMessage(oe,pe,xe)},writePackedSFixed64:function(oe,xe){xe.length&&this.writeMessage(oe,Te,xe)},writeBytesField:function(oe,xe){this.writeTag(oe,l.Bytes),this.writeBytes(xe)},writeFixed32Field:function(oe,xe){this.writeTag(oe,l.Fixed32),this.writeFixed32(xe)},writeSFixed32Field:function(oe,xe){this.writeTag(oe,l.Fixed32),this.writeSFixed32(xe)},writeFixed64Field:function(oe,xe){this.writeTag(oe,l.Fixed64),this.writeFixed64(xe)},writeSFixed64Field:function(oe,xe){this.writeTag(oe,l.Fixed64),this.writeSFixed64(xe)},writeVarintField:function(oe,xe){this.writeTag(oe,l.Varint),this.writeVarint(xe)},writeSVarintField:function(oe,xe){this.writeTag(oe,l.Varint),this.writeSVarint(xe)},writeStringField:function(oe,xe){this.writeTag(oe,l.Bytes),this.writeString(xe)},writeFloatField:function(oe,xe){this.writeTag(oe,l.Fixed32),this.writeFloat(xe)},writeDoubleField:function(oe,xe){this.writeTag(oe,l.Fixed64),this.writeDouble(xe)},writeBooleanField:function(oe,xe){this.writeVarintField(oe,!!xe)}},tT}var iT=a(A5());let nT=3;function dH(h,l,f){h===1&&f.readMessage(pH,l)}function pH(h,l,f){if(h===3){let{id:g,bitmap:w,width:I,height:M,left:D,top:U,advance:j}=f.readMessage(AH,{});l.push({id:g,bitmap:new Xm({width:I+2*nT,height:M+2*nT},w),metrics:{width:I,height:M,left:D,top:U,advance:j}})}}function AH(h,l,f){h===1?l.id=f.readVarint():h===2?l.bitmap=f.readBytes():h===3?l.width=f.readVarint():h===4?l.height=f.readVarint():h===5?l.left=f.readSVarint():h===6?l.top=f.readSVarint():h===7&&(l.advance=f.readVarint())}let mH=nT;function m5(h){let l=0,f=0;for(let M of h)l+=M.w*M.h,f=Math.max(f,M.w);h.sort((M,D)=>D.h-M.h);let g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),f),h:1/0}],w=0,I=0;for(let M of h)for(let D=g.length-1;D>=0;D--){let U=g[D];if(!(M.w>U.w||M.h>U.h)){if(M.x=U.x,M.y=U.y,I=Math.max(I,M.y+M.h),w=Math.max(w,M.x+M.w),M.w===U.w&&M.h===U.h){let j=g.pop();D<g.length&&(g[D]=j)}else M.h===U.h?(U.x+=M.w,U.w-=M.w):M.w===U.w?(U.y+=M.h,U.h-=M.h):(g.push({x:U.x+M.w,y:U.y,w:U.w-M.w,h:M.h}),U.y+=M.h,U.h-=M.h);break}}return{w,h:I,fill:l/(w*I)||0}}let Go=1;class sT{constructor(l,{pixelRatio:f,version:g,stretchX:w,stretchY:I,content:M,textFitWidth:D,textFitHeight:U}){this.paddedRect=l,this.pixelRatio=f,this.stretchX=w,this.stretchY=I,this.content=M,this.version=g,this.textFitWidth=D,this.textFitHeight=U}get tl(){return[this.paddedRect.x+Go,this.paddedRect.y+Go]}get br(){return[this.paddedRect.x+this.paddedRect.w-Go,this.paddedRect.y+this.paddedRect.h-Go]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Go)/this.pixelRatio,(this.paddedRect.h-2*Go)/this.pixelRatio]}}class g5{constructor(l,f){let g={},w={};this.haveRenderCallbacks=[];let I=[];this.addImages(l,g,I),this.addImages(f,w,I);let{w:M,h:D}=m5(I),U=new Ma({width:M||1,height:D||1});for(let j in l){let $=l[j],Y=g[j].paddedRect;Ma.copy($.data,U,{x:0,y:0},{x:Y.x+Go,y:Y.y+Go},$.data)}for(let j in f){let $=f[j],Y=w[j].paddedRect,se=Y.x+Go,le=Y.y+Go,ue=$.data.width,pe=$.data.height;Ma.copy($.data,U,{x:0,y:0},{x:se,y:le},$.data),Ma.copy($.data,U,{x:0,y:pe-1},{x:se,y:le-1},{width:ue,height:1}),Ma.copy($.data,U,{x:0,y:0},{x:se,y:le+pe},{width:ue,height:1}),Ma.copy($.data,U,{x:ue-1,y:0},{x:se-1,y:le},{width:1,height:pe}),Ma.copy($.data,U,{x:0,y:0},{x:se+ue,y:le},{width:1,height:pe})}this.image=U,this.iconPositions=g,this.patternPositions=w}addImages(l,f,g){for(let w in l){let I=l[w],M={x:0,y:0,w:I.data.width+2*Go,h:I.data.height+2*Go};g.push(M),f[w]=new sT(M,I),I.hasRenderCallback&&this.haveRenderCallbacks.push(w)}}patchUpdatedImages(l,f){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let g in l.updatedImages)this.patchUpdatedImage(this.iconPositions[g],l.getImage(g),f),this.patchUpdatedImage(this.patternPositions[g],l.getImage(g),f)}patchUpdatedImage(l,f,g){if(!l||!f||l.version===f.version)return;l.version=f.version;let[w,I]=l.tl;g.update(f.data,void 0,{x:w,y:I})}}var yf;ur("ImagePosition",sT),ur("ImageAtlas",g5),n.ah=void 0,(yf=n.ah||(n.ah={}))[yf.none=0]="none",yf[yf.horizontal=1]="horizontal",yf[yf.vertical=2]="vertical",yf[yf.horizontalOnly=3]="horizontalOnly";let mx=-17;class og{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(l,f,g){let w=new og;return w.scale=l||1,w.fontStack=f,w.verticalAlign=g||"bottom",w}static forImage(l,f){let g=new og;return g.imageName=l,g.verticalAlign=f||"bottom",g}}class DA{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,f){let g=new DA;for(let w=0;w<l.sections.length;w++){let I=l.sections[w];I.image?g.addImageSection(I):g.addTextSection(I,f)}return g}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let f="";for(let g=0;g<l.length;g++){let w=l.charCodeAt(g+1)||null,I=l.charCodeAt(g-1)||null;f+=w&&zd(w)&&!sg[l[g+1]]||I&&zd(I)&&!sg[l[g-1]]||!sg[l[g]]?l[g]:sg[l[g]]}return f}(this.text)}trim(){let l=0;for(let g=0;g<this.text.length&&_x[this.text.charCodeAt(g)];g++)l++;let f=this.text.length;for(let g=this.text.length-1;g>=0&&g>=l&&_x[this.text.charCodeAt(g)];g--)f--;this.text=this.text.substring(l,f),this.sectionIndex=this.sectionIndex.slice(l,f)}substring(l,f){let g=new DA;return g.text=this.text.substring(l,f),g.sectionIndex=this.sectionIndex.slice(l,f),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,f)=>Math.max(l,this.sections[f].scale),0)}getMaxImageSize(l){let f=0,g=0;for(let w=0;w<this.length();w++){let I=this.getSection(w);if(I.imageName){let M=l[I.imageName];if(!M)continue;let D=M.displaySize;f=Math.max(f,D[0]),g=Math.max(g,D[1])}}return{maxImageWidth:f,maxImageHeight:g}}addTextSection(l,f){this.text+=l.text,this.sections.push(og.forText(l.scale,l.fontStack||f,l.verticalAlign));let g=this.sections.length-1;for(let w=0;w<l.text.length;++w)this.sectionIndex.push(g)}addImageSection(l){let f=l.image?l.image.name:"";if(f.length===0)return void Oi("Can't add FormattedSection with an empty image.");let g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(og.forImage(f,l.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Oi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gx(h,l,f,g,w,I,M,D,U,j,$,Y,se,le,ue){let pe=DA.fromFeature(h,w),Te;Y===n.ah.vertical&&pe.verticalizePunctuation();let{processBidirectionalText:Re,processStyledBidirectionalText:et}=Pa;if(Re&&pe.sections.length===1){Te=[];let xe=Re(pe.toString(),oT(pe,j,I,l,g,le));for(let He of xe){let xt=new DA;xt.text=He,xt.sections=pe.sections;for(let Ht=0;Ht<He.length;Ht++)xt.sectionIndex.push(0);Te.push(xt)}}else if(et){Te=[];let xe=et(pe.text,pe.sectionIndex,oT(pe,j,I,l,g,le));for(let He of xe){let xt=new DA;xt.text=He[0],xt.sectionIndex=He[1],xt.sections=pe.sections,Te.push(xt)}}else Te=function(xe,He){let xt=[],Ht=xe.text,Et=0;for(let Rt of He)xt.push(xe.substring(Et,Rt)),Et=Rt;return Et<Ht.length&&xt.push(xe.substring(Et,Ht.length)),xt}(pe,oT(pe,j,I,l,g,le));let Ne=[],oe={positionedLines:Ne,text:pe.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return function(xe,He,xt,Ht,Et,Rt,Yt,$t,Qt,Dt,Ar,Rr){let Cr=0,_r=0,mi=0,Fn=0,hs=$t==="right"?1:$t==="left"?0:.5,io=us/Rr,Ba=0;for(let Ln of Et){Ln.trim();let Ss=Ln.getMaxScale(),Vs={positionedGlyphs:[],lineOffset:0};xe.positionedLines[Ba]=Vs;let js=Vs.positionedGlyphs,Io=0;if(!Ln.length()){_r+=Rt,++Ba;continue}let La=xH(Ht,Ln,io);for(let Wo=0;Wo<Ln.length();Wo++){let fs=Ln.getSection(Wo),Is=Ln.getSectionIndex(Wo),Ps=Ln.getCharCode(Wo),rs=bH(Qt,Ar,Ps),xn;if(fs.imageName){if(xe.iconsInText=!0,fs.scale=fs.scale*io,xn=wH(fs,rs,Ss,La,Ht),!xn)continue;Io=Math.max(Io,xn.imageOffset)}else if(xn=vH(fs,Ps,rs,La,He,xt),!xn)continue;let{rect:Ql,metrics:zA,baselineOffset:Jl}=xn;js.push({glyph:Ps,imageName:fs.imageName,x:Cr,y:_r+Jl+mx,vertical:rs,scale:fs.scale,fontStack:fs.fontStack,sectionIndex:Is,metrics:zA,rect:Ql}),rs?(xe.verticalizable=!0,Cr+=(fs.imageName?zA.advance:us)*fs.scale+Dt):Cr+=zA.advance*fs.scale+Dt}js.length!==0&&(mi=Math.max(Cr-Dt,mi),TH(js,0,js.length-1,hs)),Cr=0,Vs.lineOffset=Math.max(Io,(Ss-1)*us);let Cs=Rt*Ss+Io;_r+=Cs,Fn=Math.max(Cs,Fn),++Ba}let{horizontalAlign:Ho,verticalAlign:Us}=aT(Yt);(function(Ln,Ss,Vs,js,Io,La,Cs,Wo,fs){let Is=(Ss-Vs)*Io,Ps=0;Ps=La!==Cs?-Wo*js-mx:-js*fs*Cs+.5*Cs;for(let rs of Ln)for(let xn of rs.positionedGlyphs)xn.x+=Is,xn.y+=Ps})(xe.positionedLines,hs,Ho,Us,mi,Fn,Rt,_r,Et.length),xe.top+=-Us*_r,xe.bottom=xe.top+_r,xe.left+=-Ho*mi,xe.right=xe.left+mi}(oe,l,f,g,Te,M,D,U,Y,j,se,ue),!function(xe){for(let He of xe)if(He.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&oe}let _x={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gH={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},_H={40:!0};function _5(h,l,f,g,w,I){if(l.imageName){let M=g[l.imageName];return M?M.displaySize[0]*l.scale*us/I+w:0}{let M=f[l.fontStack],D=M&&M[h];return D?D.metrics.advance*l.scale+w:0}}function y5(h,l,f,g){let w=Math.pow(h-l,2);return g?h<l?w/2:2*w:w+Math.abs(f)*f}function yH(h,l,f){let g=0;return h===10&&(g-=1e4),f&&(g+=150),h!==40&&h!==65288||(g+=50),l!==41&&l!==65289||(g+=50),g}function x5(h,l,f,g,w,I){let M=null,D=y5(l,f,w,I);for(let U of g){let j=y5(l-U.x,f,w,I)+U.badness;j<=D&&(M=U,D=j)}return{index:h,x:l,priorBreak:M,badness:D}}function b5(h){return h?b5(h.priorBreak).concat(h.index):[]}function oT(h,l,f,g,w,I){if(!h)return[];let M=[],D=function(Y,se,le,ue,pe,Te){let Re=0;for(let et=0;et<Y.length();et++){let Ne=Y.getSection(et);Re+=_5(Y.getCharCode(et),Ne,ue,pe,se,Te)}return Re/Math.max(1,Math.ceil(Re/le))}(h,l,f,g,w,I),U=h.text.indexOf("\u200B")>=0,j=0;for(let Y=0;Y<h.length();Y++){let se=h.getSection(Y),le=h.getCharCode(Y);if(_x[le]||(j+=_5(le,se,g,w,l,I)),Y<h.length()-1){let ue=!(($=le)<11904)&&(!!oi["CJK Compatibility Forms"]($)||!!oi["CJK Compatibility"]($)||!!oi["CJK Strokes"]($)||!!oi["CJK Symbols and Punctuation"]($)||!!oi["Enclosed CJK Letters and Months"]($)||!!oi["Halfwidth and Fullwidth Forms"]($)||!!oi["Ideographic Description Characters"]($)||!!oi["Vertical Forms"]($)||ql.test(String.fromCodePoint($)));(gH[le]||ue||se.imageName||Y!==h.length()-2&&_H[h.getCharCode(Y+1)])&&M.push(x5(Y+1,j,D,M,yH(le,h.getCharCode(Y+1),ue&&U),!1))}}var $;return b5(x5(h.length(),j,D,M,0,!0))}function aT(h){let l=.5,f=.5;switch(h){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:l,verticalAlign:f}}function xH(h,l,f){let g=l.getMaxScale()*us,{maxImageWidth:w,maxImageHeight:I}=l.getMaxImageSize(h),M=Math.max(g,I*f);return{verticalLineContentWidth:Math.max(g,w*f),horizontalLineContentHeight:M}}function v5(h){switch(h){case"top":return 0;case"center":return .5;default:return 1}}function bH(h,l,f){return!(h===n.ah.horizontal||!l&&!rl(f)||l&&(_x[f]||(g=f,/\p{sc=Arab}/u.test(String.fromCodePoint(g)))));var g}function vH(h,l,f,g,w,I){let M=I[h.fontStack],D=function(j,$,Y,se){if(j&&j.rect)return j;let le=$[Y.fontStack],ue=le&&le[se];return ue?{rect:null,metrics:ue.metrics}:null}(M&&M[l],w,h,l);if(D===null)return null;let U;if(f)U=g.verticalLineContentWidth-h.scale*us;else{let j=v5(h.verticalAlign);U=(g.horizontalLineContentHeight-h.scale*us)*j}return{rect:D.rect,metrics:D.metrics,baselineOffset:U}}function wH(h,l,f,g,w){let I=w[h.imageName];if(!I)return null;let M=I.paddedRect,D=I.displaySize,U={width:D[0],height:D[1],left:Go,top:-3,advance:l?D[1]:D[0]},j;if(l)j=g.verticalLineContentWidth-D[1]*h.scale;else{let $=v5(h.verticalAlign);j=(g.horizontalLineContentHeight-D[1]*h.scale)*$}return{rect:M,metrics:U,baselineOffset:j,imageOffset:(l?D[0]:D[1])*h.scale-us*f}}function TH(h,l,f,g){if(g===0)return;let w=h[f],I=(h[f].x+w.metrics.advance*w.scale)*g;for(let M=l;M<=f;M++)h[M].x-=I}function EH(h,l,f){let{horizontalAlign:g,verticalAlign:w}=aT(f),I=l[0]-h.displaySize[0]*g,M=l[1]-h.displaySize[1]*w;return{image:h,top:M,bottom:M+h.displaySize[1],left:I,right:I+h.displaySize[0]}}function w5(h){var l,f;let g=h.left,w=h.top,I=h.right-g,M=h.bottom-w,D=(l=h.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",U=(f=h.image.textFitHeight)!==null&&f!==void 0?f:"stretchOrShrink",j=(h.image.content[2]-h.image.content[0])/(h.image.content[3]-h.image.content[1]);if(U==="proportional"){if(D==="stretchOnly"&&I/M<j||D==="proportional"){let $=Math.ceil(M*j);g*=$/I,I=$}}else if(D==="proportional"&&U==="stretchOnly"&&j!==0&&I/M>j){let $=Math.ceil(I/j);w*=$/M,M=$}return{x1:g,y1:w,x2:g+I,y2:w+M}}function T5(h,l,f,g,w,I){let M=h.image,D;if(M.content){let Te=M.content,Re=M.pixelRatio||1;D=[Te[0]/Re,Te[1]/Re,M.displaySize[0]-Te[2]/Re,M.displaySize[1]-Te[3]/Re]}let U=l.left*I,j=l.right*I,$,Y,se,le;f==="width"||f==="both"?(le=w[0]+U-g[3],Y=w[0]+j+g[1]):(le=w[0]+(U+j-M.displaySize[0])/2,Y=le+M.displaySize[0]);let ue=l.top*I,pe=l.bottom*I;return f==="height"||f==="both"?($=w[1]+ue-g[0],se=w[1]+pe+g[2]):($=w[1]+(ue+pe-M.displaySize[1])/2,se=$+M.displaySize[1]),{image:M,top:$,right:Y,bottom:se,left:le,collisionPadding:D}}let ag=255,$c=128,xf=ag*$c;function E5(h,l){let{expression:f}=l;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new an(h+1))};if(f.kind==="source")return{kind:"source"};{let{zoomStops:g,interpolationType:w}=f,I=0;for(;I<g.length&&g[I]<=h;)I++;I=Math.max(0,I-1);let M=I;for(;M<g.length&&g[M]<h+1;)M++;M=Math.min(g.length-1,M);let D=g[I],U=g[M];return f.kind==="composite"?{kind:"composite",minZoom:D,maxZoom:U,interpolationType:w}:{kind:"camera",minZoom:D,maxZoom:U,minSize:f.evaluate(new an(D)),maxSize:f.evaluate(new an(U)),interpolationType:w}}}function lT(h,l,f){let g="never",w=h.get(l);return w?g=w:h.get(f)&&(g="always"),g}let SH=rg.VectorTileFeature.types,CH=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function yx(h,l,f,g,w,I,M,D,U,j,$,Y,se){let le=D?Math.min(xf,Math.round(D[0])):0,ue=D?Math.min(xf,Math.round(D[1])):0;h.emplaceBack(l,f,Math.round(32*g),Math.round(32*w),I,M,(le<<1)+(U?1:0),ue,16*j,16*$,256*Y,256*se)}function cT(h,l,f){h.emplaceBack(l.x,l.y,f),h.emplaceBack(l.x,l.y,f),h.emplaceBack(l.x,l.y,f),h.emplaceBack(l.x,l.y,f)}function IH(h){for(let l of h.sections)if($m(l.text))return!0;return!1}class uT{constructor(l){this.layoutVertexArray=new Mt,this.indexArray=new Ut,this.programConfigurations=l,this.segments=new Gr,this.dynamicLayoutVertexArray=new Lt,this.opacityVertexArray=new Tt,this.hasVisibleVertices=!1,this.placedSymbolArray=new K}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,f,g,w){this.isEmpty()||(g&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,aH.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,lH.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,CH,!0),this.opacityVertexBuffer.itemSize=1),(g||w)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ur("SymbolBuffers",uT);class hT{constructor(l,f,g){this.layoutVertexArray=new l,this.layoutAttributes=f,this.indexArray=new g,this.segments=new Gr,this.collisionVertexArray=new Kt}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,cH.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ur("CollisionBuffers",hT);class kA{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(M=>M.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=E5(this.zoom,f["text-size"]),this.iconSizeData=E5(this.zoom,f["icon-size"]);let g=this.layers[0].layout,w=g.get("symbol-sort-key"),I=g.get("symbol-z-order");this.canOverlap=lT(g,"text-overlap","text-allow-overlap")!=="never"||lT(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=I!=="viewport-y"&&!w.isConstant(),this.sortFeaturesByY=(I==="viewport-y"||I==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(M=>n.ah[M])),this.stateDependentLayerIds=this.layers.filter(M=>M.isStateDependent()).map(M=>M.id),this.sourceID=l.sourceID}createArrays(){this.text=new uT(new ar(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new uT(new ar(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new fe,this.lineVertexArray=new Ae,this.symbolInstances=new ie,this.textAnchorOffsets=new Se}calculateGlyphDependencies(l,f,g,w,I){for(let M=0;M<l.length;M++)if(f[l.charCodeAt(M)]=!0,(g||w)&&I){let D=sg[l.charAt(M)];D&&(f[D.charCodeAt(0)]=!0)}}populate(l,f,g){let w=this.layers[0],I=w.layout,M=I.get("text-font"),D=I.get("text-field"),U=I.get("icon-image"),j=(D.value.kind!=="constant"||D.value.value instanceof Ks&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(M.value.kind!=="constant"||M.value.value.length>0),$=U.value.kind!=="constant"||!!U.value.value||Object.keys(U.parameters).length>0,Y=I.get("symbol-sort-key");if(this.features=[],!j&&!$)return;let se=f.iconDependencies,le=f.glyphDependencies,ue=f.availableImages,pe=new an(this.zoom);for(let{feature:Te,id:Re,index:et,sourceLayerIndex:Ne}of l){let oe=w._featureFilter.needGeometry,xe=ii(Te,oe);if(!w._featureFilter.filter(pe,xe,g))continue;let He,xt;if(oe||(xe.geometry=ti(Te)),j){let Et=w.getValueAndResolveTokens("text-field",xe,g,ue),Rt=Ks.factory(Et),Yt=this.hasRTLText=this.hasRTLText||IH(Rt);(!Yt||Pa.getRTLTextPluginStatus()==="unavailable"||Yt&&Pa.isParsed())&&(He=hH(Rt,w,xe))}if($){let Et=w.getValueAndResolveTokens("icon-image",xe,g,ue);xt=Et instanceof Ao?Et:Ao.fromString(Et)}if(!He&&!xt)continue;let Ht=this.sortFeaturesByKey?Y.evaluate(xe,{},g):void 0;if(this.features.push({id:Re,text:He,icon:xt,index:et,sourceLayerIndex:Ne,geometry:xe.geometry,properties:Te.properties,type:SH[Te.type],sortKey:Ht}),xt&&(se[xt.name]=!0),He){let Et=M.evaluate(xe,{},g).join(","),Rt=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(n.ah.vertical)>=0;for(let Yt of He.sections)if(Yt.image)se[Yt.image.name]=!0;else{let $t=Vc(He.toString()),Qt=Yt.fontStack||Et,Dt=le[Qt]=le[Qt]||{};this.calculateGlyphDependencies(Yt.text,Dt,Rt,this.allowVerticalPlacement,$t)}}}I.get("symbol-placement")==="line"&&(this.features=function(Te){let Re={},et={},Ne=[],oe=0;function xe(Et){Ne.push(Te[Et]),oe++}function He(Et,Rt,Yt){let $t=et[Et];return delete et[Et],et[Rt]=$t,Ne[$t].geometry[0].pop(),Ne[$t].geometry[0]=Ne[$t].geometry[0].concat(Yt[0]),$t}function xt(Et,Rt,Yt){let $t=Re[Rt];return delete Re[Rt],Re[Et]=$t,Ne[$t].geometry[0].shift(),Ne[$t].geometry[0]=Yt[0].concat(Ne[$t].geometry[0]),$t}function Ht(Et,Rt,Yt){let $t=Yt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${Et}:${$t.x}:${$t.y}`}for(let Et=0;Et<Te.length;Et++){let Rt=Te[Et],Yt=Rt.geometry,$t=Rt.text?Rt.text.toString():null;if(!$t){xe(Et);continue}let Qt=Ht($t,Yt),Dt=Ht($t,Yt,!0);if(Qt in et&&Dt in Re&&et[Qt]!==Re[Dt]){let Ar=xt(Qt,Dt,Yt),Rr=He(Qt,Dt,Ne[Ar].geometry);delete Re[Qt],delete et[Dt],et[Ht($t,Ne[Rr].geometry,!0)]=Rr,Ne[Ar].geometry=null}else Qt in et?He(Qt,Dt,Yt):Dt in Re?xt(Qt,Dt,Yt):(xe(Et),Re[Qt]=oe-1,et[Dt]=oe-1)}return Ne.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Re)=>Te.sortKey-Re.sortKey)}update(l,f,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,f,this.layers,g),this.icon.programConfigurations.updatePaintArrays(l,f,this.layers,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,f){let g=this.lineVertexArray.length;if(l.segment!==void 0){let w=l.dist(f[l.segment+1]),I=l.dist(f[l.segment]),M={};for(let D=l.segment+1;D<f.length;D++)M[D]={x:f[D].x,y:f[D].y,tileUnitDistanceFromAnchor:w},D<f.length-1&&(w+=f[D+1].dist(f[D]));for(let D=l.segment||0;D>=0;D--)M[D]={x:f[D].x,y:f[D].y,tileUnitDistanceFromAnchor:I},D>0&&(I+=f[D-1].dist(f[D]));for(let D=0;D<f.length;D++){let U=M[D];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(l,f,g,w,I,M,D,U,j,$,Y,se){let le=l.indexArray,ue=l.layoutVertexArray,pe=l.segments.prepareSegment(4*f.length,ue,le,this.canOverlap?M.sortKey:void 0),Te=this.glyphOffsetArray.length,Re=pe.vertexLength,et=this.allowVerticalPlacement&&D===n.ah.vertical?Math.PI/2:0,Ne=M.text&&M.text.sections;for(let oe=0;oe<f.length;oe++){let{tl:xe,tr:He,bl:xt,br:Ht,tex:Et,pixelOffsetTL:Rt,pixelOffsetBR:Yt,minFontScaleX:$t,minFontScaleY:Qt,glyphOffset:Dt,isSDF:Ar,sectionIndex:Rr}=f[oe],Cr=pe.vertexLength,_r=Dt[1];yx(ue,U.x,U.y,xe.x,_r+xe.y,Et.x,Et.y,g,Ar,Rt.x,Rt.y,$t,Qt),yx(ue,U.x,U.y,He.x,_r+He.y,Et.x+Et.w,Et.y,g,Ar,Yt.x,Rt.y,$t,Qt),yx(ue,U.x,U.y,xt.x,_r+xt.y,Et.x,Et.y+Et.h,g,Ar,Rt.x,Yt.y,$t,Qt),yx(ue,U.x,U.y,Ht.x,_r+Ht.y,Et.x+Et.w,Et.y+Et.h,g,Ar,Yt.x,Yt.y,$t,Qt),cT(l.dynamicLayoutVertexArray,U,et),le.emplaceBack(Cr,Cr+2,Cr+1),le.emplaceBack(Cr+1,Cr+2,Cr+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),oe!==f.length-1&&Rr===f[oe+1].sectionIndex||l.programConfigurations.populatePaintArrays(ue.length,M,M.index,{},se,Ne&&Ne[Rr])}l.placedSymbolArray.emplaceBack(U.x,U.y,Te,this.glyphOffsetArray.length-Te,Re,j,$,U.segment,g?g[0]:0,g?g[1]:0,w[0],w[1],D,0,!1,0,Y)}_addCollisionDebugVertex(l,f,g,w,I,M){return f.emplaceBack(0,0),l.emplaceBack(g.x,g.y,w,I,Math.round(M.x),Math.round(M.y))}addCollisionDebugVertices(l,f,g,w,I,M,D){let U=I.segments.prepareSegment(4,I.layoutVertexArray,I.indexArray),j=U.vertexLength,$=I.layoutVertexArray,Y=I.collisionVertexArray,se=D.anchorX,le=D.anchorY;this._addCollisionDebugVertex($,Y,M,se,le,new B(l,f)),this._addCollisionDebugVertex($,Y,M,se,le,new B(g,f)),this._addCollisionDebugVertex($,Y,M,se,le,new B(g,w)),this._addCollisionDebugVertex($,Y,M,se,le,new B(l,w)),U.vertexLength+=4;let ue=I.indexArray;ue.emplaceBack(j,j+1),ue.emplaceBack(j+1,j+2),ue.emplaceBack(j+2,j+3),ue.emplaceBack(j+3,j),U.primitiveLength+=4}addDebugCollisionBoxes(l,f,g,w){for(let I=l;I<f;I++){let M=this.collisionBoxArray.get(I);this.addCollisionDebugVertices(M.x1,M.y1,M.x2,M.y2,w?this.textCollisionBox:this.iconCollisionBox,M.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hT(er,f5.members,mt),this.iconCollisionBox=new hT(er,f5.members,mt);for(let l=0;l<this.symbolInstances.length;l++){let f=this.symbolInstances.get(l);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(l,f,g,w,I,M,D,U,j){let $={};for(let Y=f;Y<g;Y++){let se=l.get(Y);$.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.textFeatureIndex=se.featureIndex;break}for(let Y=w;Y<I;Y++){let se=l.get(Y);$.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.verticalTextFeatureIndex=se.featureIndex;break}for(let Y=M;Y<D;Y++){let se=l.get(Y);$.iconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.iconFeatureIndex=se.featureIndex;break}for(let Y=U;Y<j;Y++){let se=l.get(Y);$.verticalIconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},$.verticalIconFeatureIndex=se.featureIndex;break}return $}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){let g=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,f){let g=l.placedSymbolArray.get(f),w=g.vertexStartIndex+4*g.numGlyphs;for(let I=g.vertexStartIndex;I<w;I+=4)l.indexArray.emplaceBack(I,I+2,I+1),l.indexArray.emplaceBack(I+1,I+2,I+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let f=Math.sin(l),g=Math.cos(l),w=[],I=[],M=[];for(let D=0;D<this.symbolInstances.length;++D){M.push(D);let U=this.symbolInstances.get(D);w.push(0|Math.round(f*U.anchorX+g*U.anchorY)),I.push(U.featureIndex)}return M.sort((D,U)=>w[D]-w[U]||I[U]-I[D]),M}addToSortKeyRanges(l,f){let g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===f?g.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let f of this.symbolInstanceIndexes){let g=this.symbolInstances.get(f);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((w,I,M)=>{w>=0&&M.indexOf(w)===I&&this.addIndicesForPlacedSymbol(this.text,w)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let S5,C5;ur("SymbolBucket",kA,{omit:["layers","collisionBoxArray","features","compareText"]}),kA.MAX_GLYPHS=65535,kA.addDynamicAttributes=cT;var fT={get paint(){return C5=C5||new to({"icon-opacity":new Mr(ce.paint_symbol["icon-opacity"]),"icon-color":new Mr(ce.paint_symbol["icon-color"]),"icon-halo-color":new Mr(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mr(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mr(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new yr(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new yr(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mr(ce.paint_symbol["text-opacity"]),"text-color":new Mr(ce.paint_symbol["text-color"],{runtimeType:zr,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Mr(ce.paint_symbol["text-halo-color"]),"text-halo-width":new Mr(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Mr(ce.paint_symbol["text-halo-blur"]),"text-translate":new yr(ce.paint_symbol["text-translate"]),"text-translate-anchor":new yr(ce.paint_symbol["text-translate-anchor"])})},get layout(){return S5=S5||new to({"symbol-placement":new yr(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new yr(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new yr(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mr(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new yr(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new yr(ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new yr(ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new yr(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new yr(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new yr(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mr(ce.layout_symbol["icon-size"]),"icon-text-fit":new yr(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new yr(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mr(ce.layout_symbol["icon-image"]),"icon-rotate":new Mr(ce.layout_symbol["icon-rotate"]),"icon-padding":new Mr(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new yr(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Mr(ce.layout_symbol["icon-offset"]),"icon-anchor":new Mr(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new yr(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new yr(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new yr(ce.layout_symbol["text-rotation-alignment"]),"text-field":new Mr(ce.layout_symbol["text-field"]),"text-font":new Mr(ce.layout_symbol["text-font"]),"text-size":new Mr(ce.layout_symbol["text-size"]),"text-max-width":new Mr(ce.layout_symbol["text-max-width"]),"text-line-height":new yr(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Mr(ce.layout_symbol["text-letter-spacing"]),"text-justify":new Mr(ce.layout_symbol["text-justify"]),"text-radial-offset":new Mr(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new yr(ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Mr(ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Mr(ce.layout_symbol["text-anchor"]),"text-max-angle":new yr(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new yr(ce.layout_symbol["text-writing-mode"]),"text-rotate":new Mr(ce.layout_symbol["text-rotate"]),"text-padding":new yr(ce.layout_symbol["text-padding"]),"text-keep-upright":new yr(ce.layout_symbol["text-keep-upright"]),"text-transform":new Mr(ce.layout_symbol["text-transform"]),"text-offset":new Mr(ce.layout_symbol["text-offset"]),"text-allow-overlap":new yr(ce.layout_symbol["text-allow-overlap"]),"text-overlap":new yr(ce.layout_symbol["text-overlap"]),"text-ignore-placement":new yr(ce.layout_symbol["text-ignore-placement"]),"text-optional":new yr(ce.layout_symbol["text-optional"])})}};class I5{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:pi,this.defaultValue=l}evaluate(l){if(l.formattedSection){let f=this.defaultValue.property.overrides;if(f&&f.hasOverride(l.formattedSection))return f.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ur("FormatSectionOverride",I5,{omit:["defaultValue"]});class xx extends Sn{constructor(l){super(l,fT)}recalculate(l,f){if(super.recalculate(l,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let g=this.layout.get("text-writing-mode");if(g){let w=[];for(let I of g)w.indexOf(I)<0&&w.push(I);this.layout._values["text-writing-mode"]=w}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,f,g,w){let I=this.layout.get(l).evaluate(f,{},g,w),M=this._unevaluatedLayout._values[l];return M.isDataDriven()||Gu(M.value)||!I?I:function(D,U){return U.replace(/{([^{}]+)}/g,(j,$)=>D&&$ in D?String(D[$]):"")}(f.properties,I)}createBucket(l){return new kA(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let l of fT.paint.overridableProperties){if(!xx.hasPaintOverride(this.layout,l))continue;let f=this.paint.get(l),g=new I5(f),w=new Lc(g,f.property.specification),I=null;I=f.value.kind==="constant"||f.value.kind==="source"?new rf("source",w):new Oc("composite",w,f.value.zoomStops),this.paint._values[l]=new ha(f.property,I,f.parameters)}}_handleOverridablePaintPropertyUpdate(l,f,g){return!(!this.layout||f.isDataDriven()||g.isDataDriven())&&xx.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,f){let g=l.get("text-field"),w=fT.paint.properties[f],I=!1,M=D=>{for(let U of D)if(w.overrides&&w.overrides.hasOverride(U))return void(I=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Ks)M(g.value.value.sections);else if(g.value.kind==="source"){let D=j=>{I||(j instanceof Bl&&_n(j.value)===Ji?M(j.value.sections):j instanceof wa?M(j.sections):j.eachChild(D))},U=g.value;U._styleExpression&&D(U._styleExpression.expression)}return I}}let P5;var PH={get paint(){return P5=P5||new to({"background-color":new yr(ce.paint_background["background-color"]),"background-pattern":new jd(ce.paint_background["background-pattern"]),"background-opacity":new yr(ce.paint_background["background-opacity"])})}};class MH extends Sn{constructor(l){super(l,PH)}}let M5;var RH={get paint(){return M5=M5||new to({"raster-opacity":new yr(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new yr(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new yr(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new yr(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new yr(ce.paint_raster["raster-saturation"]),"raster-contrast":new yr(ce.paint_raster["raster-contrast"]),"raster-resampling":new yr(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new yr(ce.paint_raster["raster-fade-duration"])})}};class BH extends Sn{constructor(l){super(l,RH)}}class LH extends Sn{constructor(l){super(l,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class OH{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let DH={once:!0},dT=63710088e-1;class bf{constructor(l,f){if(isNaN(l)||isNaN(f))throw new Error(`Invalid LngLat object: (${l}, ${f})`);if(this.lng=+l,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bf(fr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){let f=Math.PI/180,g=this.lat*f,w=l.lat*f,I=Math.sin(g)*Math.sin(w)+Math.cos(g)*Math.cos(w)*Math.cos((l.lng-this.lng)*f);return dT*Math.acos(Math.min(I,1))}static convert(l){if(l instanceof bf)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new bf(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new bf(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let R5=2*Math.PI*dT;function B5(h){return R5*Math.cos(h*Math.PI/180)}function L5(h){return(180+h)/360}function O5(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function D5(h,l){return h/B5(l)}function pT(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}function k5(h,l){return h*B5(pT(l))}class lg{constructor(l,f,g=0){this.x=+l,this.y=+f,this.z=+g}static fromLngLat(l,f=0){let g=bf.convert(l);return new lg(L5(g.lng),O5(g.lat),D5(f,g.lat))}toLngLat(){return new bf(360*this.x-180,pT(this.y))}toAltitude(){return k5(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/R5*(l=pT(this.y),1/Math.cos(l*Math.PI/180));var l}}function F5(h,l,f){var g=2*Math.PI*6378137/256/Math.pow(2,f);return[h*g-2*Math.PI*6378137/2,l*g-2*Math.PI*6378137/2]}class AT{constructor(l,f,g){if(!function(w,I,M){return!(w<0||w>25||M<0||M>=Math.pow(2,w)||I<0||I>=Math.pow(2,w))}(l,f,g))throw new Error(`x=${f}, y=${g}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=f,this.y=g,this.key=FA(0,l,l,f,g)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,f,g){let w=(M=this.y,D=this.z,U=F5(256*(I=this.x),256*(M=Math.pow(2,D)-M-1),D),j=F5(256*(I+1),256*(M+1),D),U[0]+","+U[1]+","+j[0]+","+j[1]);var I,M,D,U,j;let $=function(Y,se,le){let ue,pe="";for(let Te=Y;Te>0;Te--)ue=1<<Te-1,pe+=(se&ue?1:0)+(le&ue?2:0);return pe}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,$).replace(/{bbox-epsg-3857}/g,w)}isChildOf(l){let f=this.z-l.z;return f>0&&l.x===this.x>>f&&l.y===this.y>>f}getTilePoint(l){let f=Math.pow(2,this.z);return new B((l.x*f-this.x)*ve,(l.y*f-this.y)*ve)}toString(){return`${this.z}/${this.x}/${this.y}`}}class N5{constructor(l,f){this.wrap=l,this.canonical=f,this.key=FA(l,f.z,f.z,f.x,f.y)}}class Ra{constructor(l,f,g,w,I){if(this.terrainRttPosMatrix32f=null,l<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${g}`);this.overscaledZ=l,this.wrap=f,this.canonical=new AT(g,+w,+I),this.key=FA(f,l,g,w,I)}clone(){return new Ra(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let f=this.canonical.z-l;return l>this.canonical.z?new Ra(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ra(l,this.wrap,l,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(l,f){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);let g=this.canonical.z-l;return l>this.canonical.z?FA(this.wrap*+f,l,this.canonical.z,this.canonical.x,this.canonical.y):FA(this.wrap*+f,l,l,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(l){if(l.wrap!==this.wrap)return!1;let f=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>f&&l.canonical.y===this.canonical.y>>f}children(l){if(this.overscaledZ>=l)return[new Ra(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let f=this.canonical.z+1,g=2*this.canonical.x,w=2*this.canonical.y;return[new Ra(f,this.wrap,f,g,w),new Ra(f,this.wrap,f,g+1,w),new Ra(f,this.wrap,f,g,w+1),new Ra(f,this.wrap,f,g+1,w+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new Ra(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new Ra(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new N5(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new lg(l.x-this.wrap,l.y))}}function FA(h,l,f,g,w){(h*=2)<0&&(h=-1*h-1);let I=1<<f;return(I*I*h+I*w+g).toString(36)+f.toString(36)+l.toString(36)}ur("CanonicalTileID",AT),ur("OverscaledTileID",Ra,{omit:["terrainRttPosMatrix32f"]});class z5{constructor(l,f,g,w=1,I=1,M=1,D=0){if(this.uid=l,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void Oi(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;let U=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=w,this.greenFactor=I,this.blueFactor=M,this.baseShift=D;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let j=0;j<U;j++)this.data[this._idx(-1,j)]=this.data[this._idx(0,j)],this.data[this._idx(U,j)]=this.data[this._idx(U-1,j)],this.data[this._idx(j,-1)]=this.data[this._idx(j,0)],this.data[this._idx(j,U)]=this.data[this._idx(j,U-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(U,-1)]=this.data[this._idx(U-1,0)],this.data[this._idx(-1,U)]=this.data[this._idx(0,U-1)],this.data[this._idx(U,U)]=this.data[this._idx(U-1,U-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let j=0;j<U;j++)for(let $=0;$<U;$++){let Y=this.get(j,$);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(l,f){let g=new Uint8Array(this.data.buffer),w=4*this._idx(l,f);return this.unpack(g[w],g[w+1],g[w+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,f){if(l<-1||l>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(l+1)}unpack(l,f,g){return l*this.redFactor+f*this.greenFactor+g*this.blueFactor-this.baseShift}getPixels(){return new Ma({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,f,g){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let w=f*this.dim,I=f*this.dim+this.dim,M=g*this.dim,D=g*this.dim+this.dim;switch(f){case-1:w=I-1;break;case 1:I=w+1}switch(g){case-1:M=D-1;break;case 1:D=M+1}let U=-f*this.dim,j=-g*this.dim;for(let $=M;$<D;$++)for(let Y=w;Y<I;Y++)this.data[this._idx(Y,$)]=l.data[this._idx(Y+U,$+j)]}}ur("DEMData",z5);class U5{constructor(l){this._stringToNumber={},this._numberToString=[];for(let f=0;f<l.length;f++){let g=l[f];this._stringToNumber[g]=f,this._numberToString[f]=g}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class V5{constructor(l,f,g,w,I){this.type="Feature",this._vectorTileFeature=l,l._z=f,l._x=g,l._y=w,this.properties=l.properties,this.id=I}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){let l={geometry:this.geometry};for(let f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(l[f]=this[f]);return l}}class j5{constructor(l,f){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new qu(ve,16,0),this.grid3D=new qu(ve,16,0),this.featureIndexArray=new ke,this.promoteId=f}insert(l,f,g,w,I,M){let D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,w,I);let U=M?this.grid3D:this.grid;for(let j=0;j<f.length;j++){let $=f[j],Y=[1/0,1/0,-1/0,-1/0];for(let se=0;se<$.length;se++){let le=$[se];Y[0]=Math.min(Y[0],le.x),Y[1]=Math.min(Y[1],le.y),Y[2]=Math.max(Y[2],le.x),Y[3]=Math.max(Y[3],le.y)}Y[0]<ve&&Y[1]<ve&&Y[2]>=0&&Y[3]>=0&&U.insert(D,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new rg.VectorTile(new iT(this.rawTileData)).layers,this.sourceLayerCoder=new U5(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,f,g,w){this.loadVTLayers();let I=l.params,M=ve/l.tileSize/l.scale,D=ca(I.filter),U=l.queryGeometry,j=l.queryPadding*M,$=H5(U),Y=this.grid.query($.minX-j,$.minY-j,$.maxX+j,$.maxY+j),se=H5(l.cameraQueryGeometry),le=this.grid3D.query(se.minX-j,se.minY-j,se.maxX+j,se.maxY+j,(Te,Re,et,Ne)=>function(oe,xe,He,xt,Ht){for(let Rt of oe)if(xe<=Rt.x&&He<=Rt.y&&xt>=Rt.x&&Ht>=Rt.y)return!0;let Et=[new B(xe,He),new B(xe,Ht),new B(xt,Ht),new B(xt,He)];if(oe.length>2){for(let Rt of Et)if(Zd(oe,Rt))return!0}for(let Rt=0;Rt<oe.length-1;Rt++)if(wG(oe[Rt],oe[Rt+1],Et))return!0;return!1}(l.cameraQueryGeometry,Te-j,Re-j,et+j,Ne+j));for(let Te of le)Y.push(Te);Y.sort(kH);let ue={},pe;for(let Te=0;Te<Y.length;Te++){let Re=Y[Te];if(Re===pe)continue;pe=Re;let et=this.featureIndexArray.get(Re),Ne=null;this.loadMatchingFeature(ue,et.bucketIndex,et.sourceLayerIndex,et.featureIndex,D,I.layers,I.availableImages,f,g,w,(oe,xe,He)=>(Ne||(Ne=ti(oe)),xe.queryIntersectsFeature({queryGeometry:U,feature:oe,featureState:He,geometry:Ne,zoom:this.z,transform:l.transform,pixelsToTileUnits:M,pixelPosMatrix:l.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:l.getElevation})))}return ue}loadMatchingFeature(l,f,g,w,I,M,D,U,j,$,Y){let se=this.bucketLayerIDs[f];if(M&&!se.some(Te=>M.has(Te)))return;let le=this.sourceLayerCoder.decode(g),ue=this.vtLayers[le].feature(w);if(I.needGeometry){let Te=ii(ue,!0);if(!I.filter(new an(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!I.filter(new an(this.tileID.overscaledZ),ue))return;let pe=this.getId(ue,le);for(let Te=0;Te<se.length;Te++){let Re=se[Te];if(M&&!M.has(Re))continue;let et=U[Re];if(!et)continue;let Ne={};pe&&$&&(Ne=$.getState(et.sourceLayer||"_geojsonTileLayer",pe));let oe=qt({},j[Re]);oe.paint=G5(oe.paint,et.paint,ue,Ne,D),oe.layout=G5(oe.layout,et.layout,ue,Ne,D);let xe=!Y||Y(ue,et,Ne);if(!xe)continue;let He=new V5(ue,this.z,this.x,this.y,pe);He.layer=oe;let xt=l[Re];xt===void 0&&(xt=l[Re]=[]),xt.push({featureIndex:w,feature:He,intersectionZ:xe})}}lookupSymbolFeatures(l,f,g,w,I,M,D,U){let j={};this.loadVTLayers();let $=ca(I);for(let Y of l)this.loadMatchingFeature(j,g,w,Y,$,M,D,U,f);return j}hasLayer(l){for(let f of this.bucketLayerIDs)for(let g of f)if(l===g)return!0;return!1}getId(l,f){var g;let w=l.id;return this.promoteId&&(w=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof w=="boolean"&&(w=Number(w)),w===void 0&&(!((g=l.properties)===null||g===void 0)&&g.cluster)&&this.promoteId&&(w=Number(l.properties.cluster_id))),w}}function G5(h,l,f,g,w){return wr(h,(I,M)=>{let D=l instanceof Yu?l.get(M):null;return D&&D.evaluate?D.evaluate(f,g,w):D})}function H5(h){let l=1/0,f=1/0,g=-1/0,w=-1/0;for(let I of h)l=Math.min(l,I.x),f=Math.min(f,I.y),g=Math.max(g,I.x),w=Math.max(w,I.y);return{minX:l,minY:f,maxX:g,maxY:w}}function kH(h,l){return l-h}function W5(h,l,f,g,w){let I=[];for(let M=0;M<h.length;M++){let D=h[M],U;for(let j=0;j<D.length-1;j++){let $=D[j],Y=D[j+1];$.x<l&&Y.x<l||($.x<l?$=new B(l,$.y+(l-$.x)/(Y.x-$.x)*(Y.y-$.y))._round():Y.x<l&&(Y=new B(l,$.y+(l-$.x)/(Y.x-$.x)*(Y.y-$.y))._round()),$.y<f&&Y.y<f||($.y<f?$=new B($.x+(f-$.y)/(Y.y-$.y)*(Y.x-$.x),f)._round():Y.y<f&&(Y=new B($.x+(f-$.y)/(Y.y-$.y)*(Y.x-$.x),f)._round()),$.x>=g&&Y.x>=g||($.x>=g?$=new B(g,$.y+(g-$.x)/(Y.x-$.x)*(Y.y-$.y))._round():Y.x>=g&&(Y=new B(g,$.y+(g-$.x)/(Y.x-$.x)*(Y.y-$.y))._round()),$.y>=w&&Y.y>=w||($.y>=w?$=new B($.x+(w-$.y)/(Y.y-$.y)*(Y.x-$.x),w)._round():Y.y>=w&&(Y=new B($.x+(w-$.y)/(Y.y-$.y)*(Y.x-$.x),w)._round()),U&&$.equals(U[U.length-1])||(U=[$],I.push(U)),U.push(Y)))))}}return I}ur("FeatureIndex",j5,{omit:["rawTileData","sourceLayerCoder"]});class vf extends B{constructor(l,f,g,w){super(l,f),this.angle=g,w!==void 0&&(this.segment=w)}clone(){return new vf(this.x,this.y,this.angle,this.segment)}}function $5(h,l,f,g,w){if(l.segment===void 0||f===0)return!0;let I=l,M=l.segment+1,D=0;for(;D>-f/2;){if(M--,M<0)return!1;D-=h[M].dist(I),I=h[M]}D+=h[M].dist(h[M+1]),M++;let U=[],j=0;for(;D<f/2;){let $=h[M],Y=h[M+1];if(!Y)return!1;let se=h[M-1].angleTo($)-$.angleTo(Y);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:D,angleDelta:se}),j+=se;D-U[0].distance>g;)j-=U.shift().angleDelta;if(j>w)return!1;M++,D+=$.dist(Y)}return!0}function q5(h){let l=0;for(let f=0;f<h.length-1;f++)l+=h[f].dist(h[f+1]);return l}function Z5(h,l,f){return h?.6*l*f:0}function X5(h,l){return Math.max(h?h.right-h.left:0,l?l.right-l.left:0)}function FH(h,l,f,g,w,I){let M=Z5(f,w,I),D=X5(f,g)*I,U=0,j=q5(h)/2;for(let $=0;$<h.length-1;$++){let Y=h[$],se=h[$+1],le=Y.dist(se);if(U+le>j){let ue=(j-U)/le,pe=na.number(Y.x,se.x,ue),Te=na.number(Y.y,se.y,ue),Re=new vf(pe,Te,se.angleTo(Y),$);return Re._round(),!M||$5(h,Re,D,M,l)?Re:void 0}U+=le}}function NH(h,l,f,g,w,I,M,D,U){let j=Z5(g,I,M),$=X5(g,w),Y=$*M,se=h[0].x===0||h[0].x===U||h[0].y===0||h[0].y===U;return l-Y<l/4&&(l=Y+l/4),Y5(h,se?l/2*D%l:($/2+2*I)*M*D%l,l,j,f,Y,se,!1,U)}function Y5(h,l,f,g,w,I,M,D,U){let j=I/2,$=q5(h),Y=0,se=l-f,le=[];for(let ue=0;ue<h.length-1;ue++){let pe=h[ue],Te=h[ue+1],Re=pe.dist(Te),et=Te.angleTo(pe);for(;se+f<Y+Re;){se+=f;let Ne=(se-Y)/Re,oe=na.number(pe.x,Te.x,Ne),xe=na.number(pe.y,Te.y,Ne);if(oe>=0&&oe<U&&xe>=0&&xe<U&&se-j>=0&&se+j<=$){let He=new vf(oe,xe,et,ue);He._round(),g&&!$5(h,He,I,g,w)||le.push(He)}}Y+=Re}return D||le.length||M||(le=Y5(h,Y/2,f,g,w,I,M,!0,U)),le}ur("Anchor",vf);let cg=Go;function K5(h,l,f,g){let w=[],I=h.image,M=I.pixelRatio,D=I.paddedRect.w-2*cg,U=I.paddedRect.h-2*cg,j={x1:h.left,y1:h.top,x2:h.right,y2:h.bottom},$=I.stretchX||[[0,D]],Y=I.stretchY||[[0,U]],se=(Dt,Ar)=>Dt+Ar[1]-Ar[0],le=$.reduce(se,0),ue=Y.reduce(se,0),pe=D-le,Te=U-ue,Re=0,et=le,Ne=0,oe=ue,xe=0,He=pe,xt=0,Ht=Te;if(I.content&&g){let Dt=I.content,Ar=Dt[2]-Dt[0],Rr=Dt[3]-Dt[1];(I.textFitWidth||I.textFitHeight)&&(j=w5(h)),Re=bx($,0,Dt[0]),Ne=bx(Y,0,Dt[1]),et=bx($,Dt[0],Dt[2]),oe=bx(Y,Dt[1],Dt[3]),xe=Dt[0]-Re,xt=Dt[1]-Ne,He=Ar-et,Ht=Rr-oe}let Et=j.x1,Rt=j.y1,Yt=j.x2-Et,$t=j.y2-Rt,Qt=(Dt,Ar,Rr,Cr)=>{let _r=vx(Dt.stretch-Re,et,Yt,Et),mi=wx(Dt.fixed-xe,He,Dt.stretch,le),Fn=vx(Ar.stretch-Ne,oe,$t,Rt),hs=wx(Ar.fixed-xt,Ht,Ar.stretch,ue),io=vx(Rr.stretch-Re,et,Yt,Et),Ba=wx(Rr.fixed-xe,He,Rr.stretch,le),Ho=vx(Cr.stretch-Ne,oe,$t,Rt),Us=wx(Cr.fixed-xt,Ht,Cr.stretch,ue),Ln=new B(_r,Fn),Ss=new B(io,Fn),Vs=new B(io,Ho),js=new B(_r,Ho),Io=new B(mi/M,hs/M),La=new B(Ba/M,Us/M),Cs=l*Math.PI/180;if(Cs){let Is=Math.sin(Cs),Ps=Math.cos(Cs),rs=[Ps,-Is,Is,Ps];Ln._matMult(rs),Ss._matMult(rs),js._matMult(rs),Vs._matMult(rs)}let Wo=Dt.stretch+Dt.fixed,fs=Ar.stretch+Ar.fixed;return{tl:Ln,tr:Ss,bl:js,br:Vs,tex:{x:I.paddedRect.x+cg+Wo,y:I.paddedRect.y+cg+fs,w:Rr.stretch+Rr.fixed-Wo,h:Cr.stretch+Cr.fixed-fs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Io,pixelOffsetBR:La,minFontScaleX:He/M/Yt,minFontScaleY:Ht/M/$t,isSDF:f}};if(g&&(I.stretchX||I.stretchY)){let Dt=Q5($,pe,le),Ar=Q5(Y,Te,ue);for(let Rr=0;Rr<Dt.length-1;Rr++){let Cr=Dt[Rr],_r=Dt[Rr+1];for(let mi=0;mi<Ar.length-1;mi++)w.push(Qt(Cr,Ar[mi],_r,Ar[mi+1]))}}else w.push(Qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:U+1}));return w}function bx(h,l,f){let g=0;for(let w of h)g+=Math.max(l,Math.min(f,w[1]))-Math.max(l,Math.min(f,w[0]));return g}function Q5(h,l,f){let g=[{fixed:-1,stretch:0}];for(let[w,I]of h){let M=g[g.length-1];g.push({fixed:w-M.stretch,stretch:M.stretch}),g.push({fixed:w-M.stretch,stretch:M.stretch+(I-w)})}return g.push({fixed:l+cg,stretch:f}),g}function vx(h,l,f,g){return h/l*f+g}function wx(h,l,f,g){return h-l*f/g}class Tx{constructor(l,f,g,w,I,M,D,U,j,$){var Y;if(this.boxStartIndex=l.length,j){let se=M.top,le=M.bottom,ue=M.collisionPadding;ue&&(se-=ue[1],le+=ue[3]);let pe=le-se;pe>0&&(pe=Math.max(10,pe),this.circleDiameter=pe)}else{let se=!((Y=M.image)===null||Y===void 0)&&Y.content&&(M.image.textFitWidth||M.image.textFitHeight)?w5(M):{x1:M.left,y1:M.top,x2:M.right,y2:M.bottom};se.y1=se.y1*D-U[0],se.y2=se.y2*D+U[2],se.x1=se.x1*D-U[3],se.x2=se.x2*D+U[1];let le=M.collisionPadding;if(le&&(se.x1-=le[0]*D,se.y1-=le[1]*D,se.x2+=le[2]*D,se.y2+=le[3]*D),$){let ue=new B(se.x1,se.y1),pe=new B(se.x2,se.y1),Te=new B(se.x1,se.y2),Re=new B(se.x2,se.y2),et=$*Math.PI/180;ue._rotate(et),pe._rotate(et),Te._rotate(et),Re._rotate(et),se.x1=Math.min(ue.x,pe.x,Te.x,Re.x),se.x2=Math.max(ue.x,pe.x,Te.x,Re.x),se.y1=Math.min(ue.y,pe.y,Te.y,Re.y),se.y2=Math.max(ue.y,pe.y,Te.y,Re.y)}l.emplaceBack(f.x,f.y,se.x1,se.y1,se.x2,se.y2,g,w,I)}this.boxEndIndex=l.length}}class zH{constructor(l=[],f=(g,w)=>g<w?-1:g>w?1:0){if(this.data=l,this.length=this.data.length,this.compare=f,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;let l=this.data[0],f=this.data.pop();return--this.length>0&&(this.data[0]=f,this._down(0)),l}peek(){return this.data[0]}_up(l){let{data:f,compare:g}=this,w=f[l];for(;l>0;){let I=l-1>>1,M=f[I];if(g(w,M)>=0)break;f[l]=M,l=I}f[l]=w}_down(l){let{data:f,compare:g}=this,w=this.length>>1,I=f[l];for(;l<w;){let M=1+(l<<1),D=M+1;if(D<this.length&&g(f[D],f[M])<0&&(M=D),g(f[M],I)>=0)break;f[l]=f[M],l=M}f[l]=I}}function UH(h,l=1,f=!1){let g=1/0,w=1/0,I=-1/0,M=-1/0,D=h[0];for(let le=0;le<D.length;le++){let ue=D[le];(!le||ue.x<g)&&(g=ue.x),(!le||ue.y<w)&&(w=ue.y),(!le||ue.x>I)&&(I=ue.x),(!le||ue.y>M)&&(M=ue.y)}let U=Math.min(I-g,M-w),j=U/2,$=new zH([],VH);if(U===0)return new B(g,w);for(let le=g;le<I;le+=U)for(let ue=w;ue<M;ue+=U)$.push(new NA(le+j,ue+j,j,h));let Y=function(le){let ue=0,pe=0,Te=0,Re=le[0];for(let et=0,Ne=Re.length,oe=Ne-1;et<Ne;oe=et++){let xe=Re[et],He=Re[oe],xt=xe.x*He.y-He.x*xe.y;pe+=(xe.x+He.x)*xt,Te+=(xe.y+He.y)*xt,ue+=3*xt}return new NA(pe/ue,Te/ue,0,le)}(h),se=$.length;for(;$.length;){let le=$.pop();(le.d>Y.d||!Y.d)&&(Y=le,f&&console.log("found best %d after %d probes",Math.round(1e4*le.d)/1e4,se)),le.max-Y.d<=l||(j=le.h/2,$.push(new NA(le.p.x-j,le.p.y-j,j,h)),$.push(new NA(le.p.x+j,le.p.y-j,j,h)),$.push(new NA(le.p.x-j,le.p.y+j,j,h)),$.push(new NA(le.p.x+j,le.p.y+j,j,h)),se+=4)}return f&&(console.log(`num probes: ${se}`),console.log(`best distance: ${Y.d}`)),Y.p}function VH(h,l){return l.max-h.max}function NA(h,l,f,g){this.p=new B(h,l),this.h=f,this.d=function(w,I){let M=!1,D=1/0;for(let U=0;U<I.length;U++){let j=I[U];for(let $=0,Y=j.length,se=Y-1;$<Y;se=$++){let le=j[$],ue=j[se];le.y>w.y!=ue.y>w.y&&w.x<(ue.x-le.x)*(w.y-le.y)/(ue.y-le.y)+le.x&&(M=!M),D=Math.min(D,BM(w,le,ue))}}return(M?1:-1)*Math.sqrt(D)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var ro;n.ay=void 0,(ro=n.ay||(n.ay={}))[ro.center=1]="center",ro[ro.left=2]="left",ro[ro.right=3]="right",ro[ro.top=4]="top",ro[ro.bottom=5]="bottom",ro[ro["top-left"]=6]="top-left",ro[ro["top-right"]=7]="top-right",ro[ro["bottom-left"]=8]="bottom-left",ro[ro["bottom-right"]=9]="bottom-right";let wf=7,mT=Number.POSITIVE_INFINITY;function J5(h,l){return l[1]!==mT?function(f,g,w){let I=0,M=0;switch(g=Math.abs(g),w=Math.abs(w),f){case"top-right":case"top-left":case"top":M=w-wf;break;case"bottom-right":case"bottom-left":case"bottom":M=-w+wf}switch(f){case"top-right":case"bottom-right":case"right":I=-g;break;case"top-left":case"bottom-left":case"left":I=g}return[I,M]}(h,l[0],l[1]):function(f,g){let w=0,I=0;g<0&&(g=0);let M=g/Math.SQRT2;switch(f){case"top-right":case"top-left":I=M-wf;break;case"bottom-right":case"bottom-left":I=-M+wf;break;case"bottom":I=-g+wf;break;case"top":I=g-wf}switch(f){case"top-right":case"bottom-right":w=-M;break;case"top-left":case"bottom-left":w=M;break;case"left":w=g;break;case"right":w=-g}return[w,I]}(h,l[0])}function eR(h,l,f){var g;let w=h.layout,I=(g=w.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(l,{},f);if(I){let D=I.values,U=[];for(let j=0;j<D.length;j+=2){let $=U[j]=D[j],Y=D[j+1].map(se=>se*us);$.startsWith("top")?Y[1]-=wf:$.startsWith("bottom")&&(Y[1]+=wf),U[j+1]=Y}return new Qs(U)}let M=w.get("text-variable-anchor");if(M){let D;D=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[w.get("text-radial-offset").evaluate(l,{},f)*us,mT]:w.get("text-offset").evaluate(l,{},f).map(j=>j*us);let U=[];for(let j of M)U.push(j,J5(j,D));return new Qs(U)}return null}function gT(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jH(h,l,f,g,w,I,M,D,U,j,$,Y){let se=I.textMaxSize.evaluate(l,{});se===void 0&&(se=M);let le=h.layers[0].layout,ue=le.get("icon-offset").evaluate(l,{},$),pe=rR(f.horizontal),Te=M/24,Re=h.tilePixelRatio*Te,et=h.tilePixelRatio*se/24,Ne=h.tilePixelRatio*D,oe=h.tilePixelRatio*le.get("symbol-spacing"),xe=le.get("text-padding")*h.tilePixelRatio,He=function(Rr,Cr,_r,mi=1){let Fn=Rr.get("icon-padding").evaluate(Cr,{},_r),hs=Fn&&Fn.values;return[hs[0]*mi,hs[1]*mi,hs[2]*mi,hs[3]*mi]}(le,l,$,h.tilePixelRatio),xt=le.get("text-max-angle")/180*Math.PI,Ht=le.get("text-rotation-alignment")!=="viewport"&&le.get("symbol-placement")!=="point",Et=le.get("icon-rotation-alignment")==="map"&&le.get("symbol-placement")!=="point",Rt=le.get("symbol-placement"),Yt=oe/2,$t=le.get("icon-text-fit"),Qt;g&&$t!=="none"&&(h.allowVerticalPlacement&&f.vertical&&(Qt=T5(g,f.vertical,$t,le.get("icon-text-fit-padding"),ue,Te)),pe&&(g=T5(g,pe,$t,le.get("icon-text-fit-padding"),ue,Te)));let Dt=$?Y.line.getGranularityForZoomLevel($.z):1,Ar=(Rr,Cr)=>{Cr.x<0||Cr.x>=ve||Cr.y<0||Cr.y>=ve||function(_r,mi,Fn,hs,io,Ba,Ho,Us,Ln,Ss,Vs,js,Io,La,Cs,Wo,fs,Is,Ps,rs,xn,Ql,zA,Jl,WH){let UA=_r.addToLineVertexArray(mi,Fn),Kd,VA,jA,GA,oR=0,aR=0,lR=0,cR=0,ET=-1,ST=-1,th={},uR=P("");if(_r.allowVerticalPlacement&&hs.vertical){let xo=Us.layout.get("text-rotate").evaluate(xn,{},Jl)+90;jA=new Tx(Ln,mi,Ss,Vs,js,hs.vertical,Io,La,Cs,xo),Ho&&(GA=new Tx(Ln,mi,Ss,Vs,js,Ho,fs,Is,Cs,xo))}if(io){let xo=Us.layout.get("icon-rotate").evaluate(xn,{}),Oa=Us.layout.get("icon-text-fit")!=="none",Qd=K5(io,xo,zA,Oa),tc=Ho?K5(Ho,xo,zA,Oa):void 0;VA=new Tx(Ln,mi,Ss,Vs,js,io,fs,Is,!1,xo),oR=4*Qd.length;let Jd=_r.iconSizeData,qc=null;Jd.kind==="source"?(qc=[$c*Us.layout.get("icon-size").evaluate(xn,{})],qc[0]>xf&&Oi(`${_r.layerIds[0]}: Value for "icon-size" is >= ${ag}. Reduce your "icon-size".`)):Jd.kind==="composite"&&(qc=[$c*Ql.compositeIconSizes[0].evaluate(xn,{},Jl),$c*Ql.compositeIconSizes[1].evaluate(xn,{},Jl)],(qc[0]>xf||qc[1]>xf)&&Oi(`${_r.layerIds[0]}: Value for "icon-size" is >= ${ag}. Reduce your "icon-size".`)),_r.addSymbols(_r.icon,Qd,qc,rs,Ps,xn,n.ah.none,mi,UA.lineStartIndex,UA.lineLength,-1,Jl),ET=_r.icon.placedSymbolArray.length-1,tc&&(aR=4*tc.length,_r.addSymbols(_r.icon,tc,qc,rs,Ps,xn,n.ah.vertical,mi,UA.lineStartIndex,UA.lineLength,-1,Jl),ST=_r.icon.placedSymbolArray.length-1)}let hR=Object.keys(hs.horizontal);for(let xo of hR){let Oa=hs.horizontal[xo];if(!Kd){uR=P(Oa.text);let tc=Us.layout.get("text-rotate").evaluate(xn,{},Jl);Kd=new Tx(Ln,mi,Ss,Vs,js,Oa,Io,La,Cs,tc)}let Qd=Oa.positionedLines.length===1;if(lR+=tR(_r,mi,Oa,Ba,Us,Cs,xn,Wo,UA,hs.vertical?n.ah.horizontal:n.ah.horizontalOnly,Qd?hR:[xo],th,ET,Ql,Jl),Qd)break}hs.vertical&&(cR+=tR(_r,mi,hs.vertical,Ba,Us,Cs,xn,Wo,UA,n.ah.vertical,["vertical"],th,ST,Ql,Jl));let $H=Kd?Kd.boxStartIndex:_r.collisionBoxArray.length,qH=Kd?Kd.boxEndIndex:_r.collisionBoxArray.length,ZH=jA?jA.boxStartIndex:_r.collisionBoxArray.length,XH=jA?jA.boxEndIndex:_r.collisionBoxArray.length,YH=VA?VA.boxStartIndex:_r.collisionBoxArray.length,KH=VA?VA.boxEndIndex:_r.collisionBoxArray.length,QH=GA?GA.boxStartIndex:_r.collisionBoxArray.length,JH=GA?GA.boxEndIndex:_r.collisionBoxArray.length,ec=-1,Sx=(xo,Oa)=>xo&&xo.circleDiameter?Math.max(xo.circleDiameter,Oa):Oa;ec=Sx(Kd,ec),ec=Sx(jA,ec),ec=Sx(VA,ec),ec=Sx(GA,ec);let fR=ec>-1?1:0;fR&&(ec*=WH/us),_r.glyphOffsetArray.length>=kA.MAX_GLYPHS&&Oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xn.sortKey!==void 0&&_r.addToSortKeyRanges(_r.symbolInstances.length,xn.sortKey);let eW=eR(Us,xn,Jl),[tW,rW]=function(xo,Oa){let Qd=xo.length,tc=Oa?.values;if(tc?.length>0)for(let Jd=0;Jd<tc.length;Jd+=2){let qc=tc[Jd+1];xo.emplaceBack(n.ay[tc[Jd]],qc[0],qc[1])}return[Qd,xo.length]}(_r.textAnchorOffsets,eW);_r.symbolInstances.emplaceBack(mi.x,mi.y,th.right>=0?th.right:-1,th.center>=0?th.center:-1,th.left>=0?th.left:-1,th.vertical||-1,ET,ST,uR,$H,qH,ZH,XH,YH,KH,QH,JH,Ss,lR,cR,oR,aR,fR,0,Io,ec,tW,rW)}(h,Cr,Rr,f,g,w,Qt,h.layers[0],h.collisionBoxArray,l.index,l.sourceLayerIndex,h.index,Re,[xe,xe,xe,xe],Ht,U,Ne,He,Et,ue,l,I,j,$,M)};if(Rt==="line")for(let Rr of W5(l.geometry,0,0,ve,ve)){let Cr=Yd(Rr,Dt),_r=NH(Cr,oe,xt,f.vertical||pe,g,24,et,h.overscaling,ve);for(let mi of _r)pe&&GH(h,pe.text,Yt,mi)||Ar(Cr,mi)}else if(Rt==="line-center"){for(let Rr of l.geometry)if(Rr.length>1){let Cr=Yd(Rr,Dt),_r=FH(Cr,xt,f.vertical||pe,g,24,et);_r&&Ar(Cr,_r)}}else if(l.type==="Polygon")for(let Rr of Ol(l.geometry,0)){let Cr=UH(Rr,16);Ar(Yd(Rr[0],Dt,!0),new vf(Cr.x,Cr.y,0))}else if(l.type==="LineString")for(let Rr of l.geometry){let Cr=Yd(Rr,Dt);Ar(Cr,new vf(Cr[0].x,Cr[0].y,0))}else if(l.type==="Point")for(let Rr of l.geometry)for(let Cr of Rr)Ar([Cr],new vf(Cr.x,Cr.y,0))}function tR(h,l,f,g,w,I,M,D,U,j,$,Y,se,le,ue){let pe=function(et,Ne,oe,xe,He,xt,Ht,Et){let Rt=xe.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,Yt=[];for(let $t of Ne.positionedLines)for(let Qt of $t.positionedGlyphs){if(!Qt.rect)continue;let Dt=Qt.rect||{},Ar=mH+1,Rr=!0,Cr=1,_r=0,mi=(He||Et)&&Qt.vertical,Fn=Qt.metrics.advance*Qt.scale/2;if(Et&&Ne.verticalizable&&(_r=$t.lineOffset/2-(Qt.imageName?-(us-Qt.metrics.width*Qt.scale)/2:(Qt.scale-1)*us)),Qt.imageName){let Is=Ht[Qt.imageName];Rr=Is.sdf,Cr=Is.pixelRatio,Ar=Go/Cr}let hs=He?[Qt.x+Fn,Qt.y]:[0,0],io=He?[0,0]:[Qt.x+Fn+oe[0],Qt.y+oe[1]-_r],Ba=[0,0];mi&&(Ba=io,io=[0,0]);let Ho=Qt.metrics.isDoubleResolution?2:1,Us=(Qt.metrics.left-Ar)*Qt.scale-Fn+io[0],Ln=(-Qt.metrics.top-Ar)*Qt.scale+io[1],Ss=Us+Dt.w/Ho*Qt.scale/Cr,Vs=Ln+Dt.h/Ho*Qt.scale/Cr,js=new B(Us,Ln),Io=new B(Ss,Ln),La=new B(Us,Vs),Cs=new B(Ss,Vs);if(mi){let Is=new B(-Fn,Fn-mx),Ps=-Math.PI/2,rs=us/2-Fn,xn=new B(5-mx-rs,-(Qt.imageName?rs:0)),Ql=new B(...Ba);js._rotateAround(Ps,Is)._add(xn)._add(Ql),Io._rotateAround(Ps,Is)._add(xn)._add(Ql),La._rotateAround(Ps,Is)._add(xn)._add(Ql),Cs._rotateAround(Ps,Is)._add(xn)._add(Ql)}if(Rt){let Is=Math.sin(Rt),Ps=Math.cos(Rt),rs=[Ps,-Is,Is,Ps];js._matMult(rs),Io._matMult(rs),La._matMult(rs),Cs._matMult(rs)}let Wo=new B(0,0),fs=new B(0,0);Yt.push({tl:js,tr:Io,bl:La,br:Cs,tex:Dt,writingMode:Ne.writingMode,glyphOffset:hs,sectionIndex:Qt.sectionIndex,isSDF:Rr,pixelOffsetTL:Wo,pixelOffsetBR:fs,minFontScaleX:0,minFontScaleY:0})}return Yt}(0,f,D,w,I,M,g,h.allowVerticalPlacement),Te=h.textSizeData,Re=null;Te.kind==="source"?(Re=[$c*w.layout.get("text-size").evaluate(M,{})],Re[0]>xf&&Oi(`${h.layerIds[0]}: Value for "text-size" is >= ${ag}. Reduce your "text-size".`)):Te.kind==="composite"&&(Re=[$c*le.compositeTextSizes[0].evaluate(M,{},ue),$c*le.compositeTextSizes[1].evaluate(M,{},ue)],(Re[0]>xf||Re[1]>xf)&&Oi(`${h.layerIds[0]}: Value for "text-size" is >= ${ag}. Reduce your "text-size".`)),h.addSymbols(h.text,pe,Re,D,I,M,j,l,U.lineStartIndex,U.lineLength,se,ue);for(let et of $)Y[et]=h.text.placedSymbolArray.length-1;return 4*pe.length}function rR(h){for(let l in h)return h[l];return null}function GH(h,l,f,g){let w=h.compareText;if(l in w){let I=w[l];for(let M=I.length-1;M>=0;M--)if(g.dist(I[M])<f)return!0}else w[l]=[];return w[l].push(g),!1}let iR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _T{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[f,g]=new Uint8Array(l,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");let w=g>>4;if(w!==1)throw new Error(`Got v${w} data when expected v1.`);let I=iR[15&g];if(!I)throw new Error("Unrecognized array type.");let[M]=new Uint16Array(l,2,1),[D]=new Uint32Array(l,4,1);return new _T(D,M,I,l)}constructor(l,f=64,g=Float64Array,w){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=g,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;let I=iR.indexOf(this.ArrayType),M=2*l*this.ArrayType.BYTES_PER_ELEMENT,D=l*this.IndexArrayType.BYTES_PER_ELEMENT,U=(8-D%8)%8;if(I<0)throw new Error(`Unexpected typed array class: ${g}.`);w&&w instanceof ArrayBuffer?(this.data=w,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+M+D+U),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+D+U,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+I]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=l)}add(l,f){let g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=l,this.coords[this._pos++]=f,g}finish(){let l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return yT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,f,g,w){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:I,coords:M,nodeSize:D}=this,U=[0,I.length-1,0],j=[];for(;U.length;){let $=U.pop()||0,Y=U.pop()||0,se=U.pop()||0;if(Y-se<=D){for(let Te=se;Te<=Y;Te++){let Re=M[2*Te],et=M[2*Te+1];Re>=l&&Re<=g&&et>=f&&et<=w&&j.push(I[Te])}continue}let le=se+Y>>1,ue=M[2*le],pe=M[2*le+1];ue>=l&&ue<=g&&pe>=f&&pe<=w&&j.push(I[le]),($===0?l<=ue:f<=pe)&&(U.push(se),U.push(le-1),U.push(1-$)),($===0?g>=ue:w>=pe)&&(U.push(le+1),U.push(Y),U.push(1-$))}return j}within(l,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:w,coords:I,nodeSize:M}=this,D=[0,w.length-1,0],U=[],j=g*g;for(;D.length;){let $=D.pop()||0,Y=D.pop()||0,se=D.pop()||0;if(Y-se<=M){for(let Te=se;Te<=Y;Te++)sR(I[2*Te],I[2*Te+1],l,f)<=j&&U.push(w[Te]);continue}let le=se+Y>>1,ue=I[2*le],pe=I[2*le+1];sR(ue,pe,l,f)<=j&&U.push(w[le]),($===0?l-g<=ue:f-g<=pe)&&(D.push(se),D.push(le-1),D.push(1-$)),($===0?l+g>=ue:f+g>=pe)&&(D.push(le+1),D.push(Y),D.push(1-$))}return U}}function yT(h,l,f,g,w,I){if(w-g<=f)return;let M=g+w>>1;nR(h,l,M,g,w,I),yT(h,l,f,g,M-1,1-I),yT(h,l,f,M+1,w,1-I)}function nR(h,l,f,g,w,I){for(;w>g;){if(w-g>600){let j=w-g+1,$=f-g+1,Y=Math.log(j),se=.5*Math.exp(2*Y/3),le=.5*Math.sqrt(Y*se*(j-se)/j)*($-j/2<0?-1:1);nR(h,l,f,Math.max(g,Math.floor(f-$*se/j+le)),Math.min(w,Math.floor(f+(j-$)*se/j+le)),I)}let M=l[2*f+I],D=g,U=w;for(ug(h,l,g,f),l[2*w+I]>M&&ug(h,l,g,w);D<U;){for(ug(h,l,D,U),D++,U--;l[2*D+I]<M;)D++;for(;l[2*U+I]>M;)U--}l[2*g+I]===M?ug(h,l,g,U):(U++,ug(h,l,U,w)),U<=f&&(g=U+1),f<=U&&(w=U-1)}}function ug(h,l,f,g){xT(h,f,g),xT(l,2*f,2*g),xT(l,2*f+1,2*g+1)}function xT(h,l,f){let g=h[l];h[l]=h[f],h[f]=g}function sR(h,l,f,g){let w=h-f,I=l-g;return w*w+I*I}var bT;n.ck=void 0,(bT=n.ck||(n.ck={})).create="create",bT.load="load",bT.fullLoad="fullLoad";let Ex=null,hg=[],vT=1e3/60,wT="loadTime",TT="fullLoadTime",HH={mark(h){performance.mark(h)},frame(h){let l=h;Ex!=null&&hg.push(l-Ex),Ex=l},clearMetrics(){Ex=null,hg=[],performance.clearMeasures(wT),performance.clearMeasures(TT);for(let h in n.ck)performance.clearMarks(n.ck[h])},getPerformanceMetrics(){performance.measure(wT,n.ck.create,n.ck.load),performance.measure(TT,n.ck.create,n.ck.fullLoad);let h=performance.getEntriesByName(wT)[0].duration,l=performance.getEntriesByName(TT)[0].duration,f=hg.length,g=1/(hg.reduce((I,M)=>I+M,0)/f/1e3),w=hg.filter(I=>I>vT).reduce((I,M)=>I+(M-vT)/vT,0);return{loadTime:h,fullLoadTime:l,fps:g,percentDroppedFrames:w/(f+w)*100,totalFrames:f}}};n.$=lg,n.A=Le,n.B=na,n.C=an,n.D=yr,n.E=ge,n.F=Fd,n.G=function(h){if(li==null){let l=h.navigator?h.navigator.userAgent:null;li=!!h.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return li},n.H=class{constructor(h,l){this.target=h,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new OH(()=>this.process()),this.subscription=Kn(this.target,"message",f=>this.receive(f),!1),this.globalScope=Ri(self)?h:window}registerMessageHandler(h,l){this.messageHandlers[h]=l}sendAsync(h,l){return new Promise((f,g)=>{let w=Math.round(1e18*Math.random()).toString(36).substring(0,10),I=l?Kn(l.signal,"abort",()=>{I?.unsubscribe(),delete this.resolveRejects[w];let U={id:w,type:"<cancel>",origin:location.origin,targetMapId:h.targetMapId,sourceMapId:this.mapId};this.target.postMessage(U)},DH):null;this.resolveRejects[w]={resolve:U=>{I?.unsubscribe(),f(U)},reject:U=>{I?.unsubscribe(),g(U)}};let M=[],D=Object.assign(Object.assign({},h),{id:w,sourceMapId:this.mapId,origin:location.origin,data:jo(h.data,M)});this.target.postMessage(D,{transfer:M})})}receive(h){let l=h.data,f=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[f];let g=this.abortControllers[f];return delete this.abortControllers[f],void(g&&g.abort())}if(Ri(self)||l.mustQueue)return this.tasks[f]=l,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,l)}}process(){if(this.taskQueue.length===0)return;let h=this.taskQueue.shift(),l=this.tasks[h];delete this.tasks[h],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(h,l)}processTask(h,l){return s(this,void 0,void 0,function*(){if(l.type==="<response>"){let w=this.resolveRejects[h];return delete this.resolveRejects[h],w?void(l.error?w.reject(tl(l.error)):w.resolve(tl(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(h,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let f=tl(l.data),g=new AbortController;this.abortControllers[h]=g;try{let w=yield this.messageHandlers[l.type](l.sourceMapId,f,g);this.completeTask(h,null,w)}catch(w){this.completeTask(h,w)}})}completeTask(h,l,f){let g=[];delete this.abortControllers[h];let w={id:h,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?jo(l):null,data:jo(f,g)};this.target.postMessage(w,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},n.I=sT,n.J=Ft,n.K=function(){var h=new Le(16);return Le!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},n.L=function(h,l,f){var g,w,I,M,D,U,j,$,Y,se,le,ue,pe=f[0],Te=f[1],Re=f[2];return l===h?(h[12]=l[0]*pe+l[4]*Te+l[8]*Re+l[12],h[13]=l[1]*pe+l[5]*Te+l[9]*Re+l[13],h[14]=l[2]*pe+l[6]*Te+l[10]*Re+l[14],h[15]=l[3]*pe+l[7]*Te+l[11]*Re+l[15]):(w=l[1],I=l[2],M=l[3],D=l[4],U=l[5],j=l[6],$=l[7],Y=l[8],se=l[9],le=l[10],ue=l[11],h[0]=g=l[0],h[1]=w,h[2]=I,h[3]=M,h[4]=D,h[5]=U,h[6]=j,h[7]=$,h[8]=Y,h[9]=se,h[10]=le,h[11]=ue,h[12]=g*pe+D*Te+Y*Re+l[12],h[13]=w*pe+U*Te+se*Re+l[13],h[14]=I*pe+j*Te+le*Re+l[14],h[15]=M*pe+$*Te+ue*Re+l[15]),h},n.M=function(h,l,f){var g=f[0],w=f[1],I=f[2];return h[0]=l[0]*g,h[1]=l[1]*g,h[2]=l[2]*g,h[3]=l[3]*g,h[4]=l[4]*w,h[5]=l[5]*w,h[6]=l[6]*w,h[7]=l[7]*w,h[8]=l[8]*I,h[9]=l[9]*I,h[10]=l[10]*I,h[11]=l[11]*I,h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15],h},n.N=function(h,l,f){var g=l[0],w=l[1],I=l[2],M=l[3],D=l[4],U=l[5],j=l[6],$=l[7],Y=l[8],se=l[9],le=l[10],ue=l[11],pe=l[12],Te=l[13],Re=l[14],et=l[15],Ne=f[0],oe=f[1],xe=f[2],He=f[3];return h[0]=Ne*g+oe*D+xe*Y+He*pe,h[1]=Ne*w+oe*U+xe*se+He*Te,h[2]=Ne*I+oe*j+xe*le+He*Re,h[3]=Ne*M+oe*$+xe*ue+He*et,h[4]=(Ne=f[4])*g+(oe=f[5])*D+(xe=f[6])*Y+(He=f[7])*pe,h[5]=Ne*w+oe*U+xe*se+He*Te,h[6]=Ne*I+oe*j+xe*le+He*Re,h[7]=Ne*M+oe*$+xe*ue+He*et,h[8]=(Ne=f[8])*g+(oe=f[9])*D+(xe=f[10])*Y+(He=f[11])*pe,h[9]=Ne*w+oe*U+xe*se+He*Te,h[10]=Ne*I+oe*j+xe*le+He*Re,h[11]=Ne*M+oe*$+xe*ue+He*et,h[12]=(Ne=f[12])*g+(oe=f[13])*D+(xe=f[14])*Y+(He=f[15])*pe,h[13]=Ne*w+oe*U+xe*se+He*Te,h[14]=Ne*I+oe*j+xe*le+He*Re,h[15]=Ne*M+oe*$+xe*ue+He*et,h},n.O=function(h,l){let f={};for(let g=0;g<l.length;g++){let w=l[g];w in h&&(f[w]=h[w])}return f},n.P=B,n.Q=bf,n.R=Ma,n.S=O5,n.T=Zl,n.U=L5,n.V=re,n.W=ee,n.X=ni,n.Y=Ra,n.Z=ve,n._=s,n.a=Vr,n.a$=function(h,l,f){var g=Math.sin(f),w=Math.cos(f),I=l[4],M=l[5],D=l[6],U=l[7],j=l[8],$=l[9],Y=l[10],se=l[11];return l!==h&&(h[0]=l[0],h[1]=l[1],h[2]=l[2],h[3]=l[3],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15]),h[4]=I*w+j*g,h[5]=M*w+$*g,h[6]=D*w+Y*g,h[7]=U*w+se*g,h[8]=j*w-I*g,h[9]=$*w-M*g,h[10]=Y*w-D*g,h[11]=se*w-U*g,h},n.a0=25,n.a1=AT,n.a2=h=>{let l=window.document.createElement("video");return l.muted=!0,new Promise(f=>{l.onloadstart=()=>{f(l)};for(let g of h){let w=window.document.createElement("source");$i(g)||(l.crossOrigin="Anonymous"),w.src=g,l.appendChild(w)}})},n.a3=We,n.a4=function(){return Ot++},n.a5=V,n.a6=kA,n.a7=ca,n.a8=ii,n.a9=V5,n.aA=gT,n.aB=aT,n.aC=_T,n.aD=Bn,n.aE=dx,n.aF=Ve,n.aG=Gr,n.aH=Ut,n.aI=function(h){return Math.pow(2,h)},n.aJ=85.051129,n.aK=D5,n.aL=fr,n.aM=ks,n.aN=k5,n.aO=function(h,l,f){return h[0]=l[0]*f,h[1]=l[1]*f,h[2]=l[2]*f,h},n.aP=function(h,l,f){return h[0]=l[0]+f[0],h[1]=l[1]+f[1],h[2]=l[2]+f[2],h},n.aQ=function(h){var l=new Le(3);return l[0]=h[0],l[1]=h[1],l[2]=h[2],l},n.aR=function(h,l,f){return h[0]=l[0]*f[0],h[1]=l[1]*f[1],h[2]=l[2]*f[2],h[3]=l[3]*f[3],h},n.aS=function(h,l,f){return h[0]=l[0]-f[0],h[1]=l[1]-f[1],h[2]=l[2]-f[2],h},n.aT=function(h,l){var f=l[0],g=l[1],w=l[2],I=f*f+g*g+w*w;return I>0&&(I=1/Math.sqrt(I)),h[0]=l[0]*I,h[1]=l[1]*I,h[2]=l[2]*I,h},n.aU=function(h,l,f){var g=l[0],w=l[1],I=l[2],M=f[0],D=f[1],U=f[2];return h[0]=w*U-I*D,h[1]=I*M-g*U,h[2]=g*D-w*M,h},n.aV=function(h,l){return h[0]*l[0]+h[1]*l[1]+h[2]*l[2]},n.aW=N5,n.aX=FA,n.aY=function(h,l,f,g,w){var I,M=1/Math.tan(l/2);return h[0]=M/f,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=M,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,w!=null&&w!==1/0?(h[10]=(w+g)*(I=1/(g-w)),h[14]=2*w*g*I):(h[10]=-1,h[14]=-2*g),h},n.aZ=function(h){var l=new Le(16);return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=h[6],l[7]=h[7],l[8]=h[8],l[9]=h[9],l[10]=h[10],l[11]=h[11],l[12]=h[12],l[13]=h[13],l[14]=h[14],l[15]=h[15],l},n.a_=function(h,l,f){var g=Math.sin(f),w=Math.cos(f),I=l[0],M=l[1],D=l[2],U=l[3],j=l[4],$=l[5],Y=l[6],se=l[7];return l!==h&&(h[8]=l[8],h[9]=l[9],h[10]=l[10],h[11]=l[11],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15]),h[0]=I*w+j*g,h[1]=M*w+$*g,h[2]=D*w+Y*g,h[3]=U*w+se*g,h[4]=j*w-I*g,h[5]=$*w-M*g,h[6]=Y*w-D*g,h[7]=se*w-U*g,h},n.aa=function(h){let l={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,g,w,I)=>{let M=w||I;return l[g]=!M||M.toLowerCase(),""}),l["max-age"]){let f=parseInt(l["max-age"],10);isNaN(f)?delete l["max-age"]:l["max-age"]=f}return l},n.ab=function(h){return Math.log(h)/Math.LN2},n.ac=function(h){var l=h[0],f=h[1];return l*l+f*f},n.ad=function(h){return h*Math.PI/180},n.ae=jt,n.af=function(h,l){let f=[];for(let g in h)g in l||f.push(g);return f},n.ag=function(h,l){let f=0,g=0;if(h.kind==="constant")g=h.layoutSize;else if(h.kind!=="source"){let{interpolationType:w,minZoom:I,maxZoom:M}=h,D=w?jt(Ns.interpolationFactor(w,l,I,M),0,1):0;h.kind==="camera"?g=na.number(h.minSize,h.maxSize,D):f=D}return{uSizeT:f,uSize:g}},n.ai=function(h,{uSize:l,uSizeT:f},{lowerSize:g,upperSize:w}){return h.kind==="source"?g/$c:h.kind==="composite"?na.number(g/$c,w/$c,f):l},n.aj=function(h,l){var f=l[0],g=l[1],w=l[2],I=l[3],M=l[4],D=l[5],U=l[6],j=l[7],$=l[8],Y=l[9],se=l[10],le=l[11],ue=l[12],pe=l[13],Te=l[14],Re=l[15],et=f*D-g*M,Ne=f*U-w*M,oe=f*j-I*M,xe=g*U-w*D,He=g*j-I*D,xt=w*j-I*U,Ht=$*pe-Y*ue,Et=$*Te-se*ue,Rt=$*Re-le*ue,Yt=Y*Te-se*pe,$t=Y*Re-le*pe,Qt=se*Re-le*Te,Dt=et*Qt-Ne*$t+oe*Yt+xe*Rt-He*Et+xt*Ht;return Dt?(h[0]=(D*Qt-U*$t+j*Yt)*(Dt=1/Dt),h[1]=(w*$t-g*Qt-I*Yt)*Dt,h[2]=(pe*xt-Te*He+Re*xe)*Dt,h[3]=(se*He-Y*xt-le*xe)*Dt,h[4]=(U*Rt-M*Qt-j*Et)*Dt,h[5]=(f*Qt-w*Rt+I*Et)*Dt,h[6]=(Te*oe-ue*xt-Re*Ne)*Dt,h[7]=($*xt-se*oe+le*Ne)*Dt,h[8]=(M*$t-D*Rt+j*Ht)*Dt,h[9]=(g*Rt-f*$t-I*Ht)*Dt,h[10]=(ue*He-pe*oe+Re*et)*Dt,h[11]=(Y*oe-$*He-le*et)*Dt,h[12]=(D*Et-M*Yt-U*Ht)*Dt,h[13]=(f*Yt-g*Et+w*Ht)*Dt,h[14]=(pe*Ne-ue*xe-Te*et)*Dt,h[15]=($*xe-Y*Ne+se*et)*Dt,h):null},n.ak=_e,n.al=function(h){return Math.hypot(h[0],h[1])},n.am=function(h){return h[0]=0,h[1]=0,h},n.an=function(h,l,f){return h[0]=l[0]*f,h[1]=l[1]*f,h},n.ao=cT,n.ap=X,n.aq=function(h,l,f,g){let w=l.y-h.y,I=l.x-h.x,M=g.y-f.y,D=g.x-f.x,U=M*I-D*w;if(U===0)return null;let j=(D*(h.y-f.y)-M*(h.x-f.x))/U;return new B(h.x+j*I,h.y+j*w)},n.ar=W5,n.as=Ni,n.at=Je,n.au=function(h){let l=1/0,f=1/0,g=-1/0,w=-1/0;for(let I of h)l=Math.min(l,I.x),f=Math.min(f,I.y),g=Math.max(g,I.x),w=Math.max(w,I.y);return[l,f,g,w]},n.av=us,n.aw=De,n.ax=function(h,l,f,g,w=!1){if(!f[0]&&!f[1])return[0,0];let I=w?g==="map"?-h.bearingInRadians:0:g==="viewport"?h.bearingInRadians:0;if(I){let M=Math.sin(I),D=Math.cos(I);f=[f[0]*D-f[1]*M,f[0]*M+f[1]*D]}return[w?f[0]:De(l,f[0],h.zoom),w?f[1]:De(l,f[1],h.zoom)]},n.az=lT,n.b=Qi,n.b$=h=>h.type==="symbol",n.b0=function(){let h=new Float32Array(16);return Je(h),h},n.b1=function(){let h=new Float64Array(16);return Je(h),h},n.b2=function(){return new Float64Array(16)},n.b3=function(h,l,f){let g=new Float64Array(4);return function(w,I,M,D){var U=.5*Math.PI/180;I*=U,M*=U,D*=U;var j=Math.sin(I),$=Math.cos(I),Y=Math.sin(M),se=Math.cos(M),le=Math.sin(D),ue=Math.cos(D);w[0]=j*se*ue-$*Y*le,w[1]=$*Y*ue+j*se*le,w[2]=$*se*le-j*Y*ue,w[3]=$*se*ue+j*Y*le}(g,h,l-90,f),g},n.b4=function(h,l,f,g){var w,I,M,D,U,j=l[0],$=l[1],Y=l[2],se=l[3],le=f[0],ue=f[1],pe=f[2],Te=f[3];return(I=j*le+$*ue+Y*pe+se*Te)<0&&(I=-I,le=-le,ue=-ue,pe=-pe,Te=-Te),1-I>me?(w=Math.acos(I),M=Math.sin(w),D=Math.sin((1-g)*w)/M,U=Math.sin(g*w)/M):(D=1-g,U=g),h[0]=D*j+U*le,h[1]=D*$+U*ue,h[2]=D*Y+U*pe,h[3]=D*se+U*Te,h},n.b5=function(h){let l=new Float64Array(9);var f,g,w,I,M,D,U,j,$,Y,se,le,ue,pe,Te,Re,et,Ne;Y=(w=(g=h)[0])*(U=w+w),se=(I=g[1])*U,ue=(M=g[2])*U,pe=M*(j=I+I),Re=(D=g[3])*U,et=D*j,Ne=D*($=M+M),(f=l)[0]=1-(le=I*j)-(Te=M*$),f[3]=se-Ne,f[6]=ue+et,f[1]=se+Ne,f[4]=1-Y-Te,f[7]=pe-Re,f[2]=ue-et,f[5]=pe+Re,f[8]=1-Y-le;let oe=ks(-Math.asin(jt(l[2],-1,1))),xe,He;return Math.hypot(l[5],l[8])<.001?(xe=0,He=-ks(Math.atan2(l[3],l[4]))):(xe=ks(l[5]===0&&l[8]===0?0:Math.atan2(l[5],l[8])),He=ks(l[1]===0&&l[0]===0?0:Math.atan2(l[1],l[0]))),{roll:xe,pitch:oe+90,bearing:He}},n.b6=function(h,l){return h.roll==l.roll&&h.pitch==l.pitch&&h.bearing==l.bearing},n.b7=bi,n.b8=he,n.b9=OA,n.bA=function(h,l){if(!h)return[{command:"setStyle",args:[l]}];let f=[];try{if(!Ke(h.version,l.version))return[{command:"setStyle",args:[l]}];Ke(h.center,l.center)||f.push({command:"setCenter",args:[l.center]}),Ke(h.centerAltitude,l.centerAltitude)||f.push({command:"setCenterAltitude",args:[l.centerAltitude]}),Ke(h.zoom,l.zoom)||f.push({command:"setZoom",args:[l.zoom]}),Ke(h.bearing,l.bearing)||f.push({command:"setBearing",args:[l.bearing]}),Ke(h.pitch,l.pitch)||f.push({command:"setPitch",args:[l.pitch]}),Ke(h.roll,l.roll)||f.push({command:"setRoll",args:[l.roll]}),Ke(h.sprite,l.sprite)||f.push({command:"setSprite",args:[l.sprite]}),Ke(h.glyphs,l.glyphs)||f.push({command:"setGlyphs",args:[l.glyphs]}),Ke(h.transition,l.transition)||f.push({command:"setTransition",args:[l.transition]}),Ke(h.light,l.light)||f.push({command:"setLight",args:[l.light]}),Ke(h.terrain,l.terrain)||f.push({command:"setTerrain",args:[l.terrain]}),Ke(h.sky,l.sky)||f.push({command:"setSky",args:[l.sky]}),Ke(h.projection,l.projection)||f.push({command:"setProjection",args:[l.projection]});let g={},w=[];(function(M,D,U,j){let $;for($ in D=D||{},M=M||{})Object.prototype.hasOwnProperty.call(M,$)&&(Object.prototype.hasOwnProperty.call(D,$)||Bt($,U,j));for($ in D)Object.prototype.hasOwnProperty.call(D,$)&&(Object.prototype.hasOwnProperty.call(M,$)?Ke(M[$],D[$])||(M[$].type==="geojson"&&D[$].type==="geojson"&&ut(M,D,$)?dt(U,{command:"setGeoJSONSourceData",args:[$,D[$].data]}):Pt($,D,U,j)):it($,D,U))})(h.sources,l.sources,w,g);let I=[];h.layers&&h.layers.forEach(M=>{"source"in M&&g[M.source]?f.push({command:"removeLayer",args:[M.id]}):I.push(M)}),f=f.concat(w),function(M,D,U){D=D||[];let j=(M=M||[]).map(rr),$=D.map(rr),Y=M.reduce(nr,{}),se=D.reduce(nr,{}),le=j.slice(),ue=Object.create(null),pe,Te,Re,et,Ne;for(let oe=0,xe=0;oe<j.length;oe++)pe=j[oe],Object.prototype.hasOwnProperty.call(se,pe)?xe++:(dt(U,{command:"removeLayer",args:[pe]}),le.splice(le.indexOf(pe,xe),1));for(let oe=0,xe=0;oe<$.length;oe++)pe=$[$.length-1-oe],le[le.length-1-oe]!==pe&&(Object.prototype.hasOwnProperty.call(Y,pe)?(dt(U,{command:"removeLayer",args:[pe]}),le.splice(le.lastIndexOf(pe,le.length-xe),1)):xe++,et=le[le.length-oe],dt(U,{command:"addLayer",args:[se[pe],et]}),le.splice(le.length-oe,0,pe),ue[pe]=!0);for(let oe=0;oe<$.length;oe++)if(pe=$[oe],Te=Y[pe],Re=se[pe],!ue[pe]&&!Ke(Te,Re))if(Ke(Te.source,Re.source)&&Ke(Te["source-layer"],Re["source-layer"])&&Ke(Te.type,Re.type)){for(Ne in zt(Te.layout,Re.layout,U,pe,null,"setLayoutProperty"),zt(Te.paint,Re.paint,U,pe,null,"setPaintProperty"),Ke(Te.filter,Re.filter)||dt(U,{command:"setFilter",args:[pe,Re.filter]}),Ke(Te.minzoom,Re.minzoom)&&Ke(Te.maxzoom,Re.maxzoom)||dt(U,{command:"setLayerZoomRange",args:[pe,Re.minzoom,Re.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?zt(Te[Ne],Re[Ne],U,pe,Ne.slice(6),"setPaintProperty"):Ke(Te[Ne],Re[Ne])||dt(U,{command:"setLayerProperty",args:[pe,Ne,Re[Ne]]}));for(Ne in Re)Object.prototype.hasOwnProperty.call(Re,Ne)&&!Object.prototype.hasOwnProperty.call(Te,Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?zt(Te[Ne],Re[Ne],U,pe,Ne.slice(6),"setPaintProperty"):Ke(Te[Ne],Re[Ne])||dt(U,{command:"setLayerProperty",args:[pe,Ne,Re[Ne]]}))}else dt(U,{command:"removeLayer",args:[pe]}),et=le[le.lastIndexOf(pe)+1],dt(U,{command:"addLayer",args:[Re,et]})}(I,l.layers,f)}catch(g){console.warn("Unable to compute style diff:",g),f=[{command:"setStyle",args:[l]}]}return f},n.bB=function(h){let l=[],f=h.id;return f===void 0&&l.push({message:`layers.${f}: missing required property "id"`}),h.render===void 0&&l.push({message:`layers.${f}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&l.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),l},n.bC=function h(l,f){if(Array.isArray(l)){if(!Array.isArray(f)||l.length!==f.length)return!1;for(let g=0;g<l.length;g++)if(!h(l[g],f[g]))return!1;return!0}if(typeof l=="object"&&l!==null&&f!==null){if(typeof f!="object"||Object.keys(l).length!==Object.keys(f).length)return!1;for(let g in l)if(!h(l[g],f[g]))return!1;return!0}return l===f},n.bD=wr,n.bE=Lr,n.bF=class extends Q{constructor(h,l){super(h,l),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},n.bG=$e,n.bH=class extends Q{constructor(h,l){super(h,l),this.current=Qe}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let l=1;l<16;l++)if(h[l]!==this.current[l]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},n.bI=we,n.bJ=class extends Q{constructor(h,l){super(h,l),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},n.bK=class extends Q{constructor(h,l){super(h,l),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},n.bL=je,n.bM=function(h,l){var f=Math.sin(l),g=Math.cos(l);return h[0]=g,h[1]=f,h[2]=0,h[3]=-f,h[4]=g,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},n.bN=function(h,l,f){var g=l[0],w=l[1],I=l[2];return h[0]=g*f[0]+w*f[3]+I*f[6],h[1]=g*f[1]+w*f[4]+I*f[7],h[2]=g*f[2]+w*f[5]+I*f[8],h},n.bO=function(h,l,f,g,w,I,M){var D=1/(l-f),U=1/(g-w),j=1/(I-M);return h[0]=-2*D,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*U,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*j,h[11]=0,h[12]=(l+f)*D,h[13]=(w+g)*U,h[14]=(M+I)*j,h[15]=1,h},n.bP=class extends $d{},n.bQ=uH,n.bR=class extends eh{},n.bS=G3,n.bT=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},n.bU=UM,n.bV=function(h,l,f){var g=l[0],w=l[1],I=l[2],M=f[3]*g+f[7]*w+f[11]*I+f[15];return h[0]=(f[0]*g+f[4]*w+f[8]*I+f[12])/(M=M||1),h[1]=(f[1]*g+f[5]*w+f[9]*I+f[13])/M,h[2]=(f[2]*g+f[6]*w+f[10]*I+f[14])/M,h},n.bW=class extends Ju{},n.bX=class extends C{},n.bY=function(h,l){return h[0]===l[0]&&h[1]===l[1]&&h[2]===l[2]&&h[3]===l[3]&&h[4]===l[4]&&h[5]===l[5]&&h[6]===l[6]&&h[7]===l[7]&&h[8]===l[8]&&h[9]===l[9]&&h[10]===l[10]&&h[11]===l[11]&&h[12]===l[12]&&h[13]===l[13]&&h[14]===l[14]&&h[15]===l[15]},n.bZ=function(h,l){var f=h[0],g=h[1],w=h[2],I=h[3],M=h[4],D=h[5],U=h[6],j=h[7],$=h[8],Y=h[9],se=h[10],le=h[11],ue=h[12],pe=h[13],Te=h[14],Re=h[15],et=l[0],Ne=l[1],oe=l[2],xe=l[3],He=l[4],xt=l[5],Ht=l[6],Et=l[7],Rt=l[8],Yt=l[9],$t=l[10],Qt=l[11],Dt=l[12],Ar=l[13],Rr=l[14],Cr=l[15];return Math.abs(f-et)<=me*Math.max(1,Math.abs(f),Math.abs(et))&&Math.abs(g-Ne)<=me*Math.max(1,Math.abs(g),Math.abs(Ne))&&Math.abs(w-oe)<=me*Math.max(1,Math.abs(w),Math.abs(oe))&&Math.abs(I-xe)<=me*Math.max(1,Math.abs(I),Math.abs(xe))&&Math.abs(M-He)<=me*Math.max(1,Math.abs(M),Math.abs(He))&&Math.abs(D-xt)<=me*Math.max(1,Math.abs(D),Math.abs(xt))&&Math.abs(U-Ht)<=me*Math.max(1,Math.abs(U),Math.abs(Ht))&&Math.abs(j-Et)<=me*Math.max(1,Math.abs(j),Math.abs(Et))&&Math.abs($-Rt)<=me*Math.max(1,Math.abs($),Math.abs(Rt))&&Math.abs(Y-Yt)<=me*Math.max(1,Math.abs(Y),Math.abs(Yt))&&Math.abs(se-$t)<=me*Math.max(1,Math.abs(se),Math.abs($t))&&Math.abs(le-Qt)<=me*Math.max(1,Math.abs(le),Math.abs(Qt))&&Math.abs(ue-Dt)<=me*Math.max(1,Math.abs(ue),Math.abs(Dt))&&Math.abs(pe-Ar)<=me*Math.max(1,Math.abs(pe),Math.abs(Ar))&&Math.abs(Te-Rr)<=me*Math.max(1,Math.abs(Te),Math.abs(Rr))&&Math.abs(Re-Cr)<=me*Math.max(1,Math.abs(Re),Math.abs(Cr))},n.b_=function(h,l){return h[0]=l[0],h[1]=l[1],h[2]=l[2],h[3]=l[3],h[4]=l[4],h[5]=l[5],h[6]=l[6],h[7]=l[7],h[8]=l[8],h[9]=l[9],h[10]=l[10],h[11]=l[11],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15],h},n.ba=eg,n.bb=LA,n.bc=rt,n.bd=tt,n.be=es,n.bf=function(h,l,f,g,w){return rt(g,w,jt((h-l)/(f-l),0,1))},n.bg=Xe,n.bh=function(){return new Float64Array(4)},n.bi=function(){return new Float64Array(3)},n.bj=function(h,l,f,g){var w=[],I=[];return w[0]=l[0]-f[0],w[1]=l[1]-f[1],w[2]=l[2]-f[2],I[0]=w[0]*Math.cos(g)-w[1]*Math.sin(g),I[1]=w[0]*Math.sin(g)+w[1]*Math.cos(g),I[2]=w[2],h[0]=I[0]+f[0],h[1]=I[1]+f[1],h[2]=I[2]+f[2],h},n.bk=function(h,l,f,g){var w=[],I=[];return w[0]=l[0]-f[0],w[1]=l[1]-f[1],w[2]=l[2]-f[2],I[0]=w[0],I[1]=w[1]*Math.cos(g)-w[2]*Math.sin(g),I[2]=w[1]*Math.sin(g)+w[2]*Math.cos(g),h[0]=I[0]+f[0],h[1]=I[1]+f[1],h[2]=I[2]+f[2],h},n.bl=function(h,l,f,g){var w=[],I=[];return w[0]=l[0]-f[0],w[1]=l[1]-f[1],w[2]=l[2]-f[2],I[0]=w[2]*Math.sin(g)+w[0]*Math.cos(g),I[1]=w[1],I[2]=w[2]*Math.cos(g)-w[0]*Math.sin(g),h[0]=I[0]+f[0],h[1]=I[1]+f[1],h[2]=I[2]+f[2],h},n.bm=function(h,l,f){var g=Math.sin(f),w=Math.cos(f),I=l[0],M=l[1],D=l[2],U=l[3],j=l[8],$=l[9],Y=l[10],se=l[11];return l!==h&&(h[4]=l[4],h[5]=l[5],h[6]=l[6],h[7]=l[7],h[12]=l[12],h[13]=l[13],h[14]=l[14],h[15]=l[15]),h[0]=I*w-j*g,h[1]=M*w-$*g,h[2]=D*w-Y*g,h[3]=U*w-se*g,h[8]=I*g+j*w,h[9]=M*g+$*w,h[10]=D*g+Y*w,h[11]=U*g+se*w,h},n.bn=function(h,l){let f=Xe(h,360),g=Xe(l,360),w=g-f,I=g>f?w-360:w+360;return Math.abs(w)<Math.abs(I)?w:I},n.bo=function(h){return h[0]=0,h[1]=0,h[2]=0,h},n.bp=function(h,l,f,g){let w=Math.sqrt(h*h+l*l),I=Math.sqrt(f*f+g*g);h/=w,l/=w,f/=I,g/=I;let M=Math.acos(h*f+l*g);return-l*f+h*g>0?M:-M},n.bq=function(h,l){return h[0]*l[0]+h[1]*l[1]+h[2]*l[2]+h[3]},n.br=dT,n.bs=function(h,l){let f=Xe(h,2*Math.PI),g=Xe(l,2*Math.PI);return Math.min(Math.abs(f-g),Math.abs(f-g+2*Math.PI),Math.abs(f-g-2*Math.PI))},n.bt=function(h){return Math.hypot(h[0],h[1],h[2])},n.bu=function(){let h={},l=ce.$version;for(let f in ce.$root){let g=ce.$root[f];if(g.required){let w=null;w=f==="version"?l:g.type==="array"?[]:{},w!=null&&(h[f]=w)}}return h},n.bv=ff,n.bw=si,n.bx=function(h){h=h.slice();let l=Object.create(null);for(let f=0;f<h.length;f++)l[h[f].id]=h[f];for(let f=0;f<h.length;f++)"ref"in h[f]&&(h[f]=Ye(h[f],l[h[f].ref]));return h},n.by=function(h){if(h.type==="custom")return new LH(h);switch(h.type){case"background":return new MH(h);case"circle":return new EG(h);case"fill":return new HG(h);case"fill-extrusion":return new QG(h);case"heatmap":return new CG(h);case"hillshade":return new PG(h);case"line":return new oH(h);case"raster":return new BH(h);case"symbol":return new xx(h)}},n.bz=Or,n.c=as,n.c0=h=>h.type==="circle",n.c1=h=>h.type==="heatmap",n.c2=h=>h.type==="line",n.c3=h=>h.type==="fill",n.c4=h=>h.type==="fill-extrusion",n.c5=h=>h.type==="hillshade",n.c6=h=>h.type==="raster",n.c7=h=>h.type==="background",n.c8=h=>h.type==="custom",n.c9=yt,n.cA=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},n.cB=function(h,l,f,g,w){return s(this,void 0,void 0,function*(){if(ee())try{return yield ni(h,l,f,g,w)}catch{}return function(I,M,D,U,j){let $=I.width,Y=I.height;fo&&Ds||(fo=new OffscreenCanvas($,Y),Ds=fo.getContext("2d",{willReadFrequently:!0})),fo.width=$,fo.height=Y,Ds.drawImage(I,0,0,$,Y);let se=Ds.getImageData(M,D,U,j);return Ds.clearRect(0,0,$,Y),se.data}(h,l,f,g,w)})},n.cC=z5,n.cD=a,n.cE=p,n.cF=i5,n.cG=A5,n.cH=tf,n.cI=Pa,n.ca=function(h,l,f){let g=Oe(l.x-f.x,l.y-f.y),w=Oe(h.x-f.x,h.y-f.y);var I,M;return ks(Math.atan2(g[0]*w[1]-g[1]*w[0],(I=g)[0]*(M=w)[0]+I[1]*M[1]))},n.cb=Xt,n.cc=function(h,l){return os[l]&&(h instanceof MouseEvent||h instanceof WheelEvent)},n.cd=function(h,l){return ea[l]&&"touches"in h},n.ce=function(h){return ea[h]||os[h]},n.cf=function(h,l,f){var g=l[0],w=l[1];return h[0]=f[0]*g+f[4]*w+f[12],h[1]=f[1]*g+f[5]*w+f[13],h},n.cg=function(h,l){let{x:f,y:g}=lg.fromLngLat(l);return!(h<0||h>25||g<0||g>=1||f<0||f>=1)},n.ch=function(h,l){return h[0]=l[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=l[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=l[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},n.ci=class extends cs{},n.cj=HH,n.cl=function(h){return h.message===Zs},n.cm=Tr,n.cn=function(h,l){Vr.REGISTERED_PROTOCOLS[h]=l},n.co=function(h){delete Vr.REGISTERED_PROTOCOLS[h]},n.cp=function(h,l){let f={};for(let w=0;w<h.length;w++){let I=l&&l[h[w].id]||Gm(h[w]);l&&(l[h[w].id]=I);let M=f[I];M||(M=f[I]=[]),M.push(h[w])}let g=[];for(let w in f)g.push(f[w]);return g},n.cq=ur,n.cr=U5,n.cs=j5,n.ct=g5,n.cu=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=ve/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;let l=h.bucket.layers[0],f=l.layout,g=l._unevaluatedLayout._values,w={layoutIconSize:g["icon-size"].possiblyEvaluate(new an(h.bucket.zoom+1),h.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new an(h.bucket.zoom+1),h.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new an(18))};if(h.bucket.textSizeData.kind==="composite"){let{minZoom:j,maxZoom:$}=h.bucket.textSizeData;w.compositeTextSizes=[g["text-size"].possiblyEvaluate(new an(j),h.canonical),g["text-size"].possiblyEvaluate(new an($),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){let{minZoom:j,maxZoom:$}=h.bucket.iconSizeData;w.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new an(j),h.canonical),g["icon-size"].possiblyEvaluate(new an($),h.canonical)]}let I=f.get("text-line-height")*us,M=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",D=f.get("text-keep-upright"),U=f.get("text-size");for(let j of h.bucket.features){let $=f.get("text-font").evaluate(j,{},h.canonical).join(","),Y=U.evaluate(j,{},h.canonical),se=w.layoutTextSize.evaluate(j,{},h.canonical),le=w.layoutIconSize.evaluate(j,{},h.canonical),ue={horizontal:{},vertical:void 0},pe=j.text,Te,Re=[0,0];if(pe){let oe=pe.toString(),xe=f.get("text-letter-spacing").evaluate(j,{},h.canonical)*us,He=CA(oe)?xe:0,xt=f.get("text-anchor").evaluate(j,{},h.canonical),Ht=eR(l,j,h.canonical);if(!Ht){let $t=f.get("text-radial-offset").evaluate(j,{},h.canonical);Re=$t?J5(xt,[$t*us,mT]):f.get("text-offset").evaluate(j,{},h.canonical).map(Qt=>Qt*us)}let Et=M?"center":f.get("text-justify").evaluate(j,{},h.canonical),Rt=f.get("symbol-placement")==="point"?f.get("text-max-width").evaluate(j,{},h.canonical)*us:1/0,Yt=()=>{h.bucket.allowVerticalPlacement&&Vc(oe)&&(ue.vertical=gx(pe,h.glyphMap,h.glyphPositions,h.imagePositions,$,Rt,I,xt,"left",He,Re,n.ah.vertical,!0,se,Y))};if(!M&&Ht){let $t=new Set;if(Et==="auto")for(let Dt=0;Dt<Ht.values.length;Dt+=2)$t.add(gT(Ht.values[Dt]));else $t.add(Et);let Qt=!1;for(let Dt of $t)if(!ue.horizontal[Dt])if(Qt)ue.horizontal[Dt]=ue.horizontal[0];else{let Ar=gx(pe,h.glyphMap,h.glyphPositions,h.imagePositions,$,Rt,I,"center",Dt,He,Re,n.ah.horizontal,!1,se,Y);Ar&&(ue.horizontal[Dt]=Ar,Qt=Ar.positionedLines.length===1)}Yt()}else{Et==="auto"&&(Et=gT(xt));let $t=gx(pe,h.glyphMap,h.glyphPositions,h.imagePositions,$,Rt,I,xt,Et,He,Re,n.ah.horizontal,!1,se,Y);$t&&(ue.horizontal[Et]=$t),Yt(),Vc(oe)&&M&&D&&(ue.vertical=gx(pe,h.glyphMap,h.glyphPositions,h.imagePositions,$,Rt,I,xt,Et,He,Re,n.ah.vertical,!1,se,Y))}}let et=!1;if(j.icon&&j.icon.name){let oe=h.imageMap[j.icon.name];oe&&(Te=EH(h.imagePositions[j.icon.name],f.get("icon-offset").evaluate(j,{},h.canonical),f.get("icon-anchor").evaluate(j,{},h.canonical)),et=!!oe.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=et:h.bucket.sdfIcons!==et&&Oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==h.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}let Ne=rR(ue.horizontal)||ue.vertical;h.bucket.iconsInText=!!Ne&&Ne.iconsInText,(Ne||Te)&&jH(h.bucket,j,ue,Te,h.imageMap,w,se,le,Re,et,h.canonical,h.subdivisionGranularity)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},n.cv=eT,n.cw=Z3,n.cx=J3,n.cy=rg,n.cz=iT,n.d=$i,n.e=qt,n.f=h=>s(void 0,void 0,void 0,function*(){if(h.byteLength===0)return createImageBitmap(new ImageData(1,1));let l=new Blob([new Uint8Array(h)],{type:"image/png"});try{return createImageBitmap(l)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),n.g=Jt,n.h=h=>new Promise((l,f)=>{let g=new Image;g.onload=()=>{l(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=Di})},g.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let w=new Blob([new Uint8Array(h)],{type:"image/png"});g.src=h.byteLength?URL.createObjectURL(w):Di}),n.i=Ri,n.j=(h,l)=>Ir(qt(h,{type:"json"}),l),n.k=de,n.l=ot,n.m=Ir,n.n=(h,l)=>Ir(qt(h,{type:"arrayBuffer"}),l),n.o=function(h){return new iT(h).readFields(dH,[])},n.p=m5,n.q=Xm,n.r=to,n.s=Kn,n.t=Es,n.u=oi,n.v=ce,n.w=Oi,n.x=el,n.y=$l,n.z=function([h,l,f]){return l+=90,l*=Math.PI/180,f*=Math.PI/180,{x:h*Math.cos(l)*Math.sin(f),y:h*Math.sin(l)*Math.sin(f),z:h*Math.cos(f)}}}),t("worker",["./shared"],function(n){"use strict";class s{constructor(de){this.keyCache={},de&&this.replace(de)}replace(de){this._layerConfigs={},this._layers={},this.update(de,[])}update(de,ge){for(let ze of de){this._layerConfigs[ze.id]=ze;let Ye=this._layers[ze.id]=n.by(ze);Ye._featureFilter=n.a7(Ye.filter),this.keyCache[ze.id]&&delete this.keyCache[ze.id]}for(let ze of ge)delete this.keyCache[ze],delete this._layerConfigs[ze],delete this._layers[ze];this.familiesBySource={};let ce=n.cp(Object.values(this._layerConfigs),this.keyCache);for(let ze of ce){let Ye=ze.map(ut=>this._layers[ut.id]),Ke=Ye[0];if(Ke.visibility==="none")continue;let dt=Ke.source||"",it=this.familiesBySource[dt];it||(it=this.familiesBySource[dt]={});let Bt=Ke.sourceLayer||"_geojsonTileLayer",Pt=it[Bt];Pt||(Pt=it[Bt]=[]),Pt.push(Ye)}}}class a{constructor(de){let ge={},ce=[];for(let dt in de){let it=de[dt],Bt=ge[dt]={};for(let Pt in it){let ut=it[+Pt];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;let zt={x:0,y:0,w:ut.bitmap.width+2,h:ut.bitmap.height+2};ce.push(zt),Bt[Pt]={rect:zt,metrics:ut.metrics}}}let{w:ze,h:Ye}=n.p(ce),Ke=new n.q({width:ze||1,height:Ye||1});for(let dt in de){let it=de[dt];for(let Bt in it){let Pt=it[+Bt];if(!Pt||Pt.bitmap.width===0||Pt.bitmap.height===0)continue;let ut=ge[dt][Bt].rect;n.q.copy(Pt.bitmap,Ke,{x:0,y:0},{x:ut.x+1,y:ut.y+1},Pt.bitmap)}}this.image=Ke,this.positions=ge}}n.cq("GlyphAtlas",a);class c{constructor(de){this.tileID=new n.Y(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),this.uid=de.uid,this.zoom=de.zoom,this.pixelRatio=de.pixelRatio,this.tileSize=de.tileSize,this.source=de.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=de.showCollisionBoxes,this.collectResourceTiming=!!de.collectResourceTiming,this.returnDependencies=!!de.returnDependencies,this.promoteId=de.promoteId,this.inFlightDependencies=[]}parse(de,ge,ce,ze,Ye){return n._(this,void 0,void 0,function*(){this.status="parsing",this.data=de,this.collisionBoxArray=new n.a5;let Ke=new n.cr(Object.keys(de.layers).sort()),dt=new n.cs(this.tileID,this.promoteId);dt.bucketLayerIDs=[];let it={},Bt={featureIndex:dt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce,subdivisionGranularity:Ye},Pt=ge.familiesBySource[this.source];for(let tr in Pt){let zr=de.layers[tr];if(!zr)continue;zr.version===1&&n.w(`Vector tile source "${this.source}" layer "${tr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let mn=Ke.encode(tr),ta=[];for(let Pr=0;Pr<zr.length;Pr++){let Vn=zr.feature(Pr),Ji=dt.getId(Vn,tr);ta.push({feature:Vn,id:Ji,index:Pr,sourceLayerIndex:mn})}for(let Pr of Pt[tr]){let Vn=Pr[0];Vn.source!==this.source&&n.w(`layer.source = ${Vn.source} does not equal this.source = ${this.source}`),Vn.minzoom&&this.zoom<Math.floor(Vn.minzoom)||Vn.maxzoom&&this.zoom>=Vn.maxzoom||Vn.visibility!=="none"&&(d(Pr,this.zoom,ce),(it[Vn.id]=Vn.createBucket({index:dt.bucketLayerIDs.length,layers:Pr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mn,sourceID:this.source})).populate(ta,Bt,this.tileID.canonical),dt.bucketLayerIDs.push(Pr.map(Ji=>Ji.id)))}}let ut=n.bD(Bt.glyphDependencies,tr=>Object.keys(tr).map(Number));this.inFlightDependencies.forEach(tr=>tr?.abort()),this.inFlightDependencies=[];let zt=Promise.resolve({});if(Object.keys(ut).length){let tr=new AbortController;this.inFlightDependencies.push(tr),zt=ze.sendAsync({type:"GG",data:{stacks:ut,source:this.source,tileID:this.tileID,type:"glyphs"}},tr)}let rr=Object.keys(Bt.iconDependencies),nr=Promise.resolve({});if(rr.length){let tr=new AbortController;this.inFlightDependencies.push(tr),nr=ze.sendAsync({type:"GI",data:{icons:rr,source:this.source,tileID:this.tileID,type:"icons"}},tr)}let We=Object.keys(Bt.patternDependencies),Dr=Promise.resolve({});if(We.length){let tr=new AbortController;this.inFlightDependencies.push(tr),Dr=ze.sendAsync({type:"GI",data:{icons:We,source:this.source,tileID:this.tileID,type:"patterns"}},tr)}let[Er,kr,pi]=yield Promise.all([zt,nr,Dr]),Gt=new a(Er),dr=new n.ct(kr,pi);for(let tr in it){let zr=it[tr];zr instanceof n.a6?(d(zr.layers,this.zoom,ce),n.cu({bucket:zr,glyphMap:Er,glyphPositions:Gt.positions,imageMap:kr,imagePositions:dr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Bt.subdivisionGranularity})):zr.hasPattern&&(zr instanceof n.cv||zr instanceof n.cw||zr instanceof n.cx)&&(d(zr.layers,this.zoom,ce),zr.addFeatures(Bt,this.tileID.canonical,dr.patternPositions))}return this.status="done",{buckets:Object.values(it).filter(tr=>!tr.isEmpty()),featureIndex:dt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gt.image,imageAtlas:dr,glyphMap:this.returnDependencies?Er:null,iconMap:this.returnDependencies?kr:null,glyphPositions:this.returnDependencies?Gt.positions:null}})}}function d(ot,de,ge){let ce=new n.C(de);for(let ze of ot)ze.recalculate(ce,ge)}class p{constructor(de,ge,ce){this.actor=de,this.layerIndex=ge,this.availableImages=ce,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(de,ge){return n._(this,void 0,void 0,function*(){let ce=yield n.n(de.request,ge);try{return{vectorTile:new n.cy.VectorTile(new n.cz(ce.data)),rawData:ce.data,cacheControl:ce.cacheControl,expires:ce.expires}}catch(ze){let Ye=new Uint8Array(ce.data),Ke=`Unable to parse the tile at ${de.request.url}, `;throw Ke+=Ye[0]===31&&Ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ze.message}`,new Error(Ke)}})}loadTile(de){return n._(this,void 0,void 0,function*(){let ge=de.uid,ce=!!(de&&de.request&&de.request.collectResourceTiming)&&new n.cA(de.request),ze=new c(de);this.loading[ge]=ze;let Ye=new AbortController;ze.abort=Ye;try{let Ke=yield this.loadVectorTile(de,Ye);if(delete this.loading[ge],!Ke)return null;let dt=Ke.rawData,it={};Ke.expires&&(it.expires=Ke.expires),Ke.cacheControl&&(it.cacheControl=Ke.cacheControl);let Bt={};if(ce){let ut=ce.finish();ut&&(Bt.resourceTiming=JSON.parse(JSON.stringify(ut)))}ze.vectorTile=Ke.vectorTile;let Pt=ze.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.actor,de.subdivisionGranularity);this.loaded[ge]=ze,this.fetching[ge]={rawTileData:dt,cacheControl:it,resourceTiming:Bt};try{let ut=yield Pt;return n.e({rawTileData:dt.slice(0)},ut,it,Bt)}finally{delete this.fetching[ge]}}catch(Ke){throw delete this.loading[ge],ze.status="done",this.loaded[ge]=ze,Ke}})}reloadTile(de){return n._(this,void 0,void 0,function*(){let ge=de.uid;if(!this.loaded||!this.loaded[ge])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let ce=this.loaded[ge];if(ce.showCollisionBoxes=de.showCollisionBoxes,ce.status==="parsing"){let ze=yield ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,de.subdivisionGranularity),Ye;if(this.fetching[ge]){let{rawTileData:Ke,cacheControl:dt,resourceTiming:it}=this.fetching[ge];delete this.fetching[ge],Ye=n.e({rawTileData:Ke.slice(0)},ze,dt,it)}else Ye=ze;return Ye}if(ce.status==="done"&&ce.vectorTile)return ce.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor,de.subdivisionGranularity)})}abortTile(de){return n._(this,void 0,void 0,function*(){let ge=this.loading,ce=de.uid;ge&&ge[ce]&&ge[ce].abort&&(ge[ce].abort.abort(),delete ge[ce])})}removeTile(de){return n._(this,void 0,void 0,function*(){this.loaded&&this.loaded[de.uid]&&delete this.loaded[de.uid]})}}class b{constructor(){this.loaded={}}loadTile(de){return n._(this,void 0,void 0,function*(){let{uid:ge,encoding:ce,rawImageData:ze,redFactor:Ye,greenFactor:Ke,blueFactor:dt,baseShift:it}=de,Bt=ze.width+2,Pt=ze.height+2,ut=n.b(ze)?new n.R({width:Bt,height:Pt},yield n.cB(ze,-1,-1,Bt,Pt)):ze,zt=new n.cC(ge,ut,ce,Ye,Ke,dt,it);return this.loaded=this.loaded||{},this.loaded[ge]=zt,zt})}removeTile(de){let ge=this.loaded,ce=de.uid;ge&&ge[ce]&&delete ge[ce]}}var T,B,z=function(){if(B)return T;function ot(ge,ce){if(ge.length!==0){de(ge[0],ce);for(var ze=1;ze<ge.length;ze++)de(ge[ze],!ce)}}function de(ge,ce){for(var ze=0,Ye=0,Ke=0,dt=ge.length,it=dt-1;Ke<dt;it=Ke++){var Bt=(ge[Ke][0]-ge[it][0])*(ge[it][1]+ge[Ke][1]),Pt=ze+Bt;Ye+=Math.abs(ze)>=Math.abs(Bt)?ze-Pt+Bt:Bt-Pt+ze,ze=Pt}ze+Ye>=0!=!!ce&&ge.reverse()}return B=1,T=function ge(ce,ze){var Ye,Ke=ce&&ce.type;if(Ke==="FeatureCollection")for(Ye=0;Ye<ce.features.length;Ye++)ge(ce.features[Ye],ze);else if(Ke==="GeometryCollection")for(Ye=0;Ye<ce.geometries.length;Ye++)ge(ce.geometries[Ye],ze);else if(Ke==="Feature")ge(ce.geometry,ze);else if(Ke==="Polygon")ot(ce.coordinates,ze);else if(Ke==="MultiPolygon")for(Ye=0;Ye<ce.coordinates.length;Ye++)ot(ce.coordinates[Ye],ze);return ce}}(),G=n.cD(z);let Z=n.cy.VectorTileFeature.prototype.toGeoJSON;class q{constructor(de){this._feature=de,this.extent=n.Z,this.type=de.type,this.properties=de.tags,"id"in de&&!isNaN(de.id)&&(this.id=parseInt(de.id,10))}loadGeometry(){if(this._feature.type===1){let de=[];for(let ge of this._feature.geometry)de.push([new n.P(ge[0],ge[1])]);return de}{let de=[];for(let ge of this._feature.geometry){let ce=[];for(let ze of ge)ce.push(new n.P(ze[0],ze[1]));de.push(ce)}return de}}toGeoJSON(de,ge,ce){return Z.call(this,de,ge,ce)}}class re{constructor(de){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.Z,this.length=de.length,this._features=de}feature(de){return new q(this._features[de])}}var ee,ae,me,Le={exports:{}},je=function(){if(me)return Le.exports;me=1;var ot=n.cG(),de=function(){if(ae)return ee;ae=1;var Pt=n.cE(),ut=n.cF().VectorTileFeature;function zt(nr,We){this.options=We||{},this.features=nr,this.length=nr.length}function rr(nr,We){this.id=typeof nr.id=="number"?nr.id:void 0,this.type=nr.type,this.rawGeometry=nr.type===1?[nr.geometry]:nr.geometry,this.properties=nr.tags,this.extent=We||4096}return ee=zt,zt.prototype.feature=function(nr){return new rr(this.features[nr],this.options.extent)},rr.prototype.loadGeometry=function(){var nr=this.rawGeometry;this.geometry=[];for(var We=0;We<nr.length;We++){for(var Dr=nr[We],Er=[],kr=0;kr<Dr.length;kr++)Er.push(new Pt(Dr[kr][0],Dr[kr][1]));this.geometry.push(Er)}return this.geometry},rr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var nr=this.geometry,We=1/0,Dr=-1/0,Er=1/0,kr=-1/0,pi=0;pi<nr.length;pi++)for(var Gt=nr[pi],dr=0;dr<Gt.length;dr++){var tr=Gt[dr];We=Math.min(We,tr.x),Dr=Math.max(Dr,tr.x),Er=Math.min(Er,tr.y),kr=Math.max(kr,tr.y)}return[We,Er,Dr,kr]},rr.prototype.toGeoJSON=ut.prototype.toGeoJSON,ee}();function ge(Pt){var ut=new ot;return function(zt,rr){for(var nr in zt.layers)rr.writeMessage(3,ce,zt.layers[nr])}(Pt,ut),ut.finish()}function ce(Pt,ut){var zt;ut.writeVarintField(15,Pt.version||1),ut.writeStringField(1,Pt.name||""),ut.writeVarintField(5,Pt.extent||4096);var rr={keys:[],values:[],keycache:{},valuecache:{}};for(zt=0;zt<Pt.length;zt++)rr.feature=Pt.feature(zt),ut.writeMessage(2,ze,rr);var nr=rr.keys;for(zt=0;zt<nr.length;zt++)ut.writeStringField(3,nr[zt]);var We=rr.values;for(zt=0;zt<We.length;zt++)ut.writeMessage(4,Bt,We[zt])}function ze(Pt,ut){var zt=Pt.feature;zt.id!==void 0&&ut.writeVarintField(1,zt.id),ut.writeMessage(2,Ye,Pt),ut.writeVarintField(3,zt.type),ut.writeMessage(4,it,zt)}function Ye(Pt,ut){var zt=Pt.feature,rr=Pt.keys,nr=Pt.values,We=Pt.keycache,Dr=Pt.valuecache;for(var Er in zt.properties){var kr=zt.properties[Er],pi=We[Er];if(kr!==null){pi===void 0&&(rr.push(Er),We[Er]=pi=rr.length-1),ut.writeVarint(pi);var Gt=typeof kr;Gt!=="string"&&Gt!=="boolean"&&Gt!=="number"&&(kr=JSON.stringify(kr));var dr=Gt+":"+kr,tr=Dr[dr];tr===void 0&&(nr.push(kr),Dr[dr]=tr=nr.length-1),ut.writeVarint(tr)}}}function Ke(Pt,ut){return(ut<<3)+(7&Pt)}function dt(Pt){return Pt<<1^Pt>>31}function it(Pt,ut){for(var zt=Pt.loadGeometry(),rr=Pt.type,nr=0,We=0,Dr=zt.length,Er=0;Er<Dr;Er++){var kr=zt[Er],pi=1;rr===1&&(pi=kr.length),ut.writeVarint(Ke(1,pi));for(var Gt=rr===3?kr.length-1:kr.length,dr=0;dr<Gt;dr++){dr===1&&rr!==1&&ut.writeVarint(Ke(2,Gt-1));var tr=kr[dr].x-nr,zr=kr[dr].y-We;ut.writeVarint(dt(tr)),ut.writeVarint(dt(zr)),nr+=tr,We+=zr}rr===3&&ut.writeVarint(Ke(7,1))}}function Bt(Pt,ut){var zt=typeof Pt;zt==="string"?ut.writeStringField(1,Pt):zt==="boolean"?ut.writeBooleanField(7,Pt):zt==="number"&&(Pt%1!=0?ut.writeDoubleField(3,Pt):Pt<0?ut.writeSVarintField(6,Pt):ut.writeVarintField(5,Pt))}return Le.exports=ge,Le.exports.fromVectorTileJs=ge,Le.exports.fromGeojsonVt=function(Pt,ut){ut=ut||{};var zt={};for(var rr in Pt)zt[rr]=new de(Pt[rr].features,ut),zt[rr].name=rr,zt[rr].version=ut.version,zt[rr].extent=ut.extent;return ge({layers:zt})},Le.exports.GeoJSONWrapper=de,Le.exports}(),Je=n.cD(je);let J={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ot=>ot},te=Math.fround||(X=new Float32Array(1),ot=>(X[0]=+ot,X[0]));var X;let ye=3,_e=5,Oe=6;class ve{constructor(de){this.options=Object.assign(Object.create(J),de),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(de){let{log:ge,minZoom:ce,maxZoom:ze}=this.options;ge&&console.time("total time");let Ye=`prepare ${de.length} points`;ge&&console.time(Ye),this.points=de;let Ke=[];for(let it=0;it<de.length;it++){let Bt=de[it];if(!Bt.geometry)continue;let[Pt,ut]=Bt.geometry.coordinates,zt=te(rt(Pt)),rr=te(tt(ut));Ke.push(zt,rr,1/0,it,-1,1),this.options.reduce&&Ke.push(0)}let dt=this.trees[ze+1]=this._createTree(Ke);ge&&console.timeEnd(Ye);for(let it=ze;it>=ce;it--){let Bt=+Date.now();dt=this.trees[it]=this._createTree(this._cluster(dt,it)),ge&&console.log("z%d: %d clusters in %dms",it,dt.numItems,+Date.now()-Bt)}return ge&&console.timeEnd("total time"),this}getClusters(de,ge){let ce=((de[0]+180)%360+360)%360-180,ze=Math.max(-90,Math.min(90,de[1])),Ye=de[2]===180?180:((de[2]+180)%360+360)%360-180,Ke=Math.max(-90,Math.min(90,de[3]));if(de[2]-de[0]>=360)ce=-180,Ye=180;else if(ce>Ye){let ut=this.getClusters([ce,ze,180,Ke],ge),zt=this.getClusters([-180,ze,Ye,Ke],ge);return ut.concat(zt)}let dt=this.trees[this._limitZoom(ge)],it=dt.range(rt(ce),tt(Ke),rt(Ye),tt(ze)),Bt=dt.data,Pt=[];for(let ut of it){let zt=this.stride*ut;Pt.push(Bt[zt+_e]>1?De(Bt,zt,this.clusterProps):this.points[Bt[zt+ye]])}return Pt}getChildren(de){let ge=this._getOriginId(de),ce=this._getOriginZoom(de),ze="No cluster with the specified id.",Ye=this.trees[ce];if(!Ye)throw new Error(ze);let Ke=Ye.data;if(ge*this.stride>=Ke.length)throw new Error(ze);let dt=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),it=Ye.within(Ke[ge*this.stride],Ke[ge*this.stride+1],dt),Bt=[];for(let Pt of it){let ut=Pt*this.stride;Ke[ut+4]===de&&Bt.push(Ke[ut+_e]>1?De(Ke,ut,this.clusterProps):this.points[Ke[ut+ye]])}if(Bt.length===0)throw new Error(ze);return Bt}getLeaves(de,ge,ce){let ze=[];return this._appendLeaves(ze,de,ge=ge||10,ce=ce||0,0),ze}getTile(de,ge,ce){let ze=this.trees[this._limitZoom(de)],Ye=Math.pow(2,de),{extent:Ke,radius:dt}=this.options,it=dt/Ke,Bt=(ce-it)/Ye,Pt=(ce+1+it)/Ye,ut={features:[]};return this._addTileFeatures(ze.range((ge-it)/Ye,Bt,(ge+1+it)/Ye,Pt),ze.data,ge,ce,Ye,ut),ge===0&&this._addTileFeatures(ze.range(1-it/Ye,Bt,1,Pt),ze.data,Ye,ce,Ye,ut),ge===Ye-1&&this._addTileFeatures(ze.range(0,Bt,it/Ye,Pt),ze.data,-1,ce,Ye,ut),ut.features.length?ut:null}getClusterExpansionZoom(de){let ge=this._getOriginZoom(de)-1;for(;ge<=this.options.maxZoom;){let ce=this.getChildren(de);if(ge++,ce.length!==1)break;de=ce[0].properties.cluster_id}return ge}_appendLeaves(de,ge,ce,ze,Ye){let Ke=this.getChildren(ge);for(let dt of Ke){let it=dt.properties;if(it&&it.cluster?Ye+it.point_count<=ze?Ye+=it.point_count:Ye=this._appendLeaves(de,it.cluster_id,ce,ze,Ye):Ye<ze?Ye++:de.push(dt),de.length===ce)break}return Ye}_createTree(de){let ge=new n.aC(de.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ce=0;ce<de.length;ce+=this.stride)ge.add(de[ce],de[ce+1]);return ge.finish(),ge.data=de,ge}_addTileFeatures(de,ge,ce,ze,Ye,Ke){for(let dt of de){let it=dt*this.stride,Bt=ge[it+_e]>1,Pt,ut,zt;if(Bt)Pt=Xe(ge,it,this.clusterProps),ut=ge[it],zt=ge[it+1];else{let We=this.points[ge[it+ye]];Pt=We.properties;let[Dr,Er]=We.geometry.coordinates;ut=rt(Dr),zt=tt(Er)}let rr={type:1,geometry:[[Math.round(this.options.extent*(ut*Ye-ce)),Math.round(this.options.extent*(zt*Ye-ze))]],tags:Pt},nr;nr=Bt||this.options.generateId?ge[it+ye]:this.points[ge[it+ye]].id,nr!==void 0&&(rr.id=nr),Ke.features.push(rr)}}_limitZoom(de){return Math.max(this.options.minZoom,Math.min(Math.floor(+de),this.options.maxZoom+1))}_cluster(de,ge){let{radius:ce,extent:ze,reduce:Ye,minPoints:Ke}=this.options,dt=ce/(ze*Math.pow(2,ge)),it=de.data,Bt=[],Pt=this.stride;for(let ut=0;ut<it.length;ut+=Pt){if(it[ut+2]<=ge)continue;it[ut+2]=ge;let zt=it[ut],rr=it[ut+1],nr=de.within(it[ut],it[ut+1],dt),We=it[ut+_e],Dr=We;for(let Er of nr){let kr=Er*Pt;it[kr+2]>ge&&(Dr+=it[kr+_e])}if(Dr>We&&Dr>=Ke){let Er,kr=zt*We,pi=rr*We,Gt=-1,dr=((ut/Pt|0)<<5)+(ge+1)+this.points.length;for(let tr of nr){let zr=tr*Pt;if(it[zr+2]<=ge)continue;it[zr+2]=ge;let mn=it[zr+_e];kr+=it[zr]*mn,pi+=it[zr+1]*mn,it[zr+4]=dr,Ye&&(Er||(Er=this._map(it,ut,!0),Gt=this.clusterProps.length,this.clusterProps.push(Er)),Ye(Er,this._map(it,zr)))}it[ut+4]=dr,Bt.push(kr/Dr,pi/Dr,1/0,dr,-1,Dr),Ye&&Bt.push(Gt)}else{for(let Er=0;Er<Pt;Er++)Bt.push(it[ut+Er]);if(Dr>1)for(let Er of nr){let kr=Er*Pt;if(!(it[kr+2]<=ge)){it[kr+2]=ge;for(let pi=0;pi<Pt;pi++)Bt.push(it[kr+pi])}}}}return Bt}_getOriginId(de){return de-this.points.length>>5}_getOriginZoom(de){return(de-this.points.length)%32}_map(de,ge,ce){if(de[ge+_e]>1){let Ke=this.clusterProps[de[ge+Oe]];return ce?Object.assign({},Ke):Ke}let ze=this.points[de[ge+ye]].properties,Ye=this.options.map(ze);return ce&&Ye===ze?Object.assign({},Ye):Ye}}function De(ot,de,ge){return{type:"Feature",id:ot[de+ye],properties:Xe(ot,de,ge),geometry:{type:"Point",coordinates:[(ce=ot[de],360*(ce-.5)),yt(ot[de+1])]}};var ce}function Xe(ot,de,ge){let ce=ot[de+_e],ze=ce>=1e4?`${Math.round(ce/1e3)}k`:ce>=1e3?Math.round(ce/100)/10+"k":ce,Ye=ot[de+Oe],Ke=Ye===-1?{}:Object.assign({},ge[Ye]);return Object.assign(Ke,{cluster:!0,cluster_id:ot[de+ye],point_count:ce,point_count_abbreviated:ze})}function rt(ot){return ot/360+.5}function tt(ot){let de=Math.sin(ot*Math.PI/180),ge=.5-.25*Math.log((1+de)/(1-de))/Math.PI;return ge<0?0:ge>1?1:ge}function yt(ot){let de=(180-360*ot)*Math.PI/180;return 360*Math.atan(Math.exp(de))/Math.PI-90}function Xt(ot,de,ge,ce){let ze=ce,Ye=de+(ge-de>>1),Ke,dt=ge-de,it=ot[de],Bt=ot[de+1],Pt=ot[ge],ut=ot[ge+1];for(let zt=de+3;zt<ge;zt+=3){let rr=jt(ot[zt],ot[zt+1],it,Bt,Pt,ut);if(rr>ze)Ke=zt,ze=rr;else if(rr===ze){let nr=Math.abs(zt-Ye);nr<dt&&(Ke=zt,dt=nr)}}ze>ce&&(Ke-de>3&&Xt(ot,de,Ke,ce),ot[Ke+2]=ze,ge-Ke>3&&Xt(ot,Ke,ge,ce))}function jt(ot,de,ge,ce,ze,Ye){let Ke=ze-ge,dt=Ye-ce;if(Ke!==0||dt!==0){let it=((ot-ge)*Ke+(de-ce)*dt)/(Ke*Ke+dt*dt);it>1?(ge=ze,ce=Ye):it>0&&(ge+=Ke*it,ce+=dt*it)}return Ke=ot-ge,dt=de-ce,Ke*Ke+dt*dt}function fr(ot,de,ge,ce){let ze={id:ot??null,type:de,geometry:ge,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(de==="Point"||de==="MultiPoint"||de==="LineString")qt(ze,ge);else if(de==="Polygon")qt(ze,ge[0]);else if(de==="MultiLineString")for(let Ye of ge)qt(ze,Ye);else if(de==="MultiPolygon")for(let Ye of ge)qt(ze,Ye[0]);return ze}function qt(ot,de){for(let ge=0;ge<de.length;ge+=3)ot.minX=Math.min(ot.minX,de[ge]),ot.minY=Math.min(ot.minY,de[ge+1]),ot.maxX=Math.max(ot.maxX,de[ge]),ot.maxY=Math.max(ot.maxY,de[ge+1])}function Ot(ot,de,ge,ce){if(!de.geometry)return;let ze=de.geometry.coordinates;if(ze&&ze.length===0)return;let Ye=de.geometry.type,Ke=Math.pow(ge.tolerance/((1<<ge.maxZoom)*ge.extent),2),dt=[],it=de.id;if(ge.promoteId?it=de.properties[ge.promoteId]:ge.generateId&&(it=ce||0),Ye==="Point")wr(ze,dt);else if(Ye==="MultiPoint")for(let Bt of ze)wr(Bt,dt);else if(Ye==="LineString")Lr(ze,dt,Ke,!1);else if(Ye==="MultiLineString"){if(ge.lineMetrics){for(let Bt of ze)dt=[],Lr(Bt,dt,Ke,!1),ot.push(fr(it,"LineString",dt,de.properties));return}Or(ze,dt,Ke,!1)}else if(Ye==="Polygon")Or(ze,dt,Ke,!0);else{if(Ye!=="MultiPolygon"){if(Ye==="GeometryCollection"){for(let Bt of de.geometry.geometries)Ot(ot,{id:it,geometry:Bt,properties:de.properties},ge,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Bt of ze){let Pt=[];Or(Bt,Pt,Ke,!0),dt.push(Pt)}}ot.push(fr(it,Ye,dt,de.properties))}function wr(ot,de){de.push(Zr(ot[0]),Oi(ot[1]),0)}function Lr(ot,de,ge,ce){let ze,Ye,Ke=0;for(let it=0;it<ot.length;it++){let Bt=Zr(ot[it][0]),Pt=Oi(ot[it][1]);de.push(Bt,Pt,0),it>0&&(Ke+=ce?(ze*Pt-Bt*Ye)/2:Math.sqrt(Math.pow(Bt-ze,2)+Math.pow(Pt-Ye,2))),ze=Bt,Ye=Pt}let dt=de.length-3;de[2]=1,Xt(de,0,dt,ge),de[dt+2]=1,de.size=Math.abs(Ke),de.start=0,de.end=de.size}function Or(ot,de,ge,ce){for(let ze=0;ze<ot.length;ze++){let Ye=[];Lr(ot[ze],Ye,ge,ce),de.push(Ye)}}function Zr(ot){return ot/360+.5}function Oi(ot){let de=Math.sin(ot*Math.PI/180),ge=.5-.25*Math.log((1+de)/(1-de))/Math.PI;return ge<0?0:ge>1?1:ge}function Jr(ot,de,ge,ce,ze,Ye,Ke,dt){if(ce/=de,Ye>=(ge/=de)&&Ke<ce)return ot;if(Ke<ge||Ye>=ce)return null;let it=[];for(let Bt of ot){let Pt=Bt.geometry,ut=Bt.type,zt=ze===0?Bt.minX:Bt.minY,rr=ze===0?Bt.maxX:Bt.maxY;if(zt>=ge&&rr<ce){it.push(Bt);continue}if(rr<ge||zt>=ce)continue;let nr=[];if(ut==="Point"||ut==="MultiPoint")Ri(Pt,nr,ge,ce,ze);else if(ut==="LineString")li(Pt,nr,ge,ce,ze,!1,dt.lineMetrics);else if(ut==="MultiLineString")Di(Pt,nr,ge,ce,ze,!1);else if(ut==="Polygon")Di(Pt,nr,ge,ce,ze,!0);else if(ut==="MultiPolygon")for(let We of Pt){let Dr=[];Di(We,Dr,ge,ce,ze,!0),Dr.length&&nr.push(Dr)}if(nr.length){if(dt.lineMetrics&&ut==="LineString"){for(let We of nr)it.push(fr(Bt.id,ut,We,Bt.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(nr.length===1?(ut="LineString",nr=nr[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=nr.length===3?"Point":"MultiPoint"),it.push(fr(Bt.id,ut,nr,Bt.tags))}}return it.length?it:null}function Ri(ot,de,ge,ce,ze){for(let Ye=0;Ye<ot.length;Ye+=3){let Ke=ot[Ye+ze];Ke>=ge&&Ke<=ce&&ni(de,ot[Ye],ot[Ye+1],ot[Ye+2])}}function li(ot,de,ge,ce,ze,Ye,Ke){let dt=Qi(ot),it=ze===0?fo:Ds,Bt,Pt,ut=ot.start;for(let Dr=0;Dr<ot.length-3;Dr+=3){let Er=ot[Dr],kr=ot[Dr+1],pi=ot[Dr+2],Gt=ot[Dr+3],dr=ot[Dr+4],tr=ze===0?Er:kr,zr=ze===0?Gt:dr,mn=!1;Ke&&(Bt=Math.sqrt(Math.pow(Er-Gt,2)+Math.pow(kr-dr,2))),tr<ge?zr>ge&&(Pt=it(dt,Er,kr,Gt,dr,ge),Ke&&(dt.start=ut+Bt*Pt)):tr>ce?zr<ce&&(Pt=it(dt,Er,kr,Gt,dr,ce),Ke&&(dt.start=ut+Bt*Pt)):ni(dt,Er,kr,pi),zr<ge&&tr>=ge&&(Pt=it(dt,Er,kr,Gt,dr,ge),mn=!0),zr>ce&&tr<=ce&&(Pt=it(dt,Er,kr,Gt,dr,ce),mn=!0),!Ye&&mn&&(Ke&&(dt.end=ut+Bt*Pt),de.push(dt),dt=Qi(ot)),Ke&&(ut+=Bt)}let zt=ot.length-3,rr=ot[zt],nr=ot[zt+1],We=ze===0?rr:nr;We>=ge&&We<=ce&&ni(dt,rr,nr,ot[zt+2]),zt=dt.length-3,Ye&&zt>=3&&(dt[zt]!==dt[0]||dt[zt+1]!==dt[1])&&ni(dt,dt[0],dt[1],dt[2]),dt.length&&de.push(dt)}function Qi(ot){let de=[];return de.size=ot.size,de.start=ot.start,de.end=ot.end,de}function Di(ot,de,ge,ce,ze,Ye){for(let Ke of ot)li(Ke,de,ge,ce,ze,Ye,!1)}function ni(ot,de,ge,ce){ot.push(de,ge,ce)}function fo(ot,de,ge,ce,ze,Ye){let Ke=(Ye-de)/(ce-de);return ni(ot,Ye,ge+(ze-ge)*Ke,1),Ke}function Ds(ot,de,ge,ce,ze,Ye){let Ke=(Ye-ge)/(ze-ge);return ni(ot,de+(ce-de)*Ke,Ye,1),Ke}function Kn(ot,de){let ge=[];for(let ce=0;ce<ot.length;ce++){let ze=ot[ce],Ye=ze.type,Ke;if(Ye==="Point"||Ye==="MultiPoint"||Ye==="LineString")Ke=ks(ze.geometry,de);else if(Ye==="MultiLineString"||Ye==="Polygon"){Ke=[];for(let dt of ze.geometry)Ke.push(ks(dt,de))}else if(Ye==="MultiPolygon"){Ke=[];for(let dt of ze.geometry){let it=[];for(let Bt of dt)it.push(ks(Bt,de));Ke.push(it)}}ge.push(fr(ze.id,Ye,Ke,ze.tags))}return ge}function ks(ot,de){let ge=[];ge.size=ot.size,ot.start!==void 0&&(ge.start=ot.start,ge.end=ot.end);for(let ce=0;ce<ot.length;ce+=3)ge.push(ot[ce]+de,ot[ce+1],ot[ce+2]);return ge}function ea(ot,de){if(ot.transformed)return ot;let ge=1<<ot.z,ce=ot.x,ze=ot.y;for(let Ye of ot.features){let Ke=Ye.geometry,dt=Ye.type;if(Ye.geometry=[],dt===1)for(let it=0;it<Ke.length;it+=2)Ye.geometry.push(os(Ke[it],Ke[it+1],de,ge,ce,ze));else for(let it=0;it<Ke.length;it++){let Bt=[];for(let Pt=0;Pt<Ke[it].length;Pt+=2)Bt.push(os(Ke[it][Pt],Ke[it][Pt+1],de,ge,ce,ze));Ye.geometry.push(Bt)}}return ot.transformed=!0,ot}function os(ot,de,ge,ce,ze,Ye){return[Math.round(ge*(ot*ce-ze)),Math.round(ge*(de*ce-Ye))]}function Zs(ot,de,ge,ce,ze){let Ye=de===ze.maxZoom?0:ze.tolerance/((1<<de)*ze.extent),Ke={features:[],numPoints:0,numSimplified:0,numFeatures:ot.length,source:null,x:ge,y:ce,z:de,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let dt of ot)as(Ke,dt,Ye,ze);return Ke}function as(ot,de,ge,ce){let ze=de.geometry,Ye=de.type,Ke=[];if(ot.minX=Math.min(ot.minX,de.minX),ot.minY=Math.min(ot.minY,de.minY),ot.maxX=Math.max(ot.maxX,de.maxX),ot.maxY=Math.max(ot.maxY,de.maxY),Ye==="Point"||Ye==="MultiPoint")for(let dt=0;dt<ze.length;dt+=3)Ke.push(ze[dt],ze[dt+1]),ot.numPoints++,ot.numSimplified++;else if(Ye==="LineString")Vr(Ke,ze,ot,ge,!1,!1);else if(Ye==="MultiLineString"||Ye==="Polygon")for(let dt=0;dt<ze.length;dt++)Vr(Ke,ze[dt],ot,ge,Ye==="Polygon",dt===0);else if(Ye==="MultiPolygon")for(let dt=0;dt<ze.length;dt++){let it=ze[dt];for(let Bt=0;Bt<it.length;Bt++)Vr(Ke,it[Bt],ot,ge,!0,Bt===0)}if(Ke.length){let dt=de.tags||null;if(Ye==="LineString"&&ce.lineMetrics){dt={};for(let Bt in de.tags)dt[Bt]=de.tags[Bt];dt.mapbox_clip_start=ze.start/ze.size,dt.mapbox_clip_end=ze.end/ze.size}let it={geometry:Ke,type:Ye==="Polygon"||Ye==="MultiPolygon"?3:Ye==="LineString"||Ye==="MultiLineString"?2:1,tags:dt};de.id!==null&&(it.id=de.id),ot.features.push(it)}}function Vr(ot,de,ge,ce,ze,Ye){let Ke=ce*ce;if(ce>0&&de.size<(ze?Ke:ce))return void(ge.numPoints+=de.length/3);let dt=[];for(let it=0;it<de.length;it+=3)(ce===0||de[it+2]>Ke)&&(ge.numSimplified++,dt.push(de[it],de[it+1])),ge.numPoints++;ze&&function(it,Bt){let Pt=0;for(let ut=0,zt=it.length,rr=zt-2;ut<zt;rr=ut,ut+=2)Pt+=(it[ut]-it[rr])*(it[ut+1]+it[rr+1]);if(Pt>0===Bt)for(let ut=0,zt=it.length;ut<zt/2;ut+=2){let rr=it[ut],nr=it[ut+1];it[ut]=it[zt-2-ut],it[ut+1]=it[zt-1-ut],it[zt-2-ut]=rr,it[zt-1-ut]=nr}}(dt,Ye),ot.push(dt)}let Jt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ft{constructor(de,ge){let ce=(ge=this.options=function(Ye,Ke){for(let dt in Ke)Ye[dt]=Ke[dt];return Ye}(Object.create(Jt),ge)).debug;if(ce&&console.time("preprocess data"),ge.maxZoom<0||ge.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ge.promoteId&&ge.generateId)throw new Error("promoteId and generateId cannot be used together.");let ze=function(Ye,Ke){let dt=[];if(Ye.type==="FeatureCollection")for(let it=0;it<Ye.features.length;it++)Ot(dt,Ye.features[it],Ke,it);else Ot(dt,Ye.type==="Feature"?Ye:{geometry:Ye},Ke);return dt}(de,ge);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ge.indexMaxZoom,ge.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ze=function(Ye,Ke){let dt=Ke.buffer/Ke.extent,it=Ye,Bt=Jr(Ye,1,-1-dt,dt,0,-1,2,Ke),Pt=Jr(Ye,1,1-dt,2+dt,0,-1,2,Ke);return(Bt||Pt)&&(it=Jr(Ye,1,-dt,1+dt,0,-1,2,Ke)||[],Bt&&(it=Kn(Bt,1).concat(it)),Pt&&(it=it.concat(Kn(Pt,-1)))),it}(ze,ge),ze.length&&this.splitTile(ze,0,0,0),ce&&(ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(de,ge,ce,ze,Ye,Ke,dt){let it=[de,ge,ce,ze],Bt=this.options,Pt=Bt.debug;for(;it.length;){ze=it.pop(),ce=it.pop(),ge=it.pop(),de=it.pop();let ut=1<<ge,zt=Tr(ge,ce,ze),rr=this.tiles[zt];if(!rr&&(Pt>1&&console.time("creation"),rr=this.tiles[zt]=Zs(de,ge,ce,ze,Bt),this.tileCoords.push({z:ge,x:ce,y:ze}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ge,ce,ze,rr.numFeatures,rr.numPoints,rr.numSimplified),console.timeEnd("creation"));let mn=`z${ge}`;this.stats[mn]=(this.stats[mn]||0)+1,this.total++}if(rr.source=de,Ye==null){if(ge===Bt.indexMaxZoom||rr.numPoints<=Bt.indexMaxPoints)continue}else{if(ge===Bt.maxZoom||ge===Ye)continue;if(Ye!=null){let mn=Ye-ge;if(ce!==Ke>>mn||ze!==dt>>mn)continue}}if(rr.source=null,de.length===0)continue;Pt>1&&console.time("clipping");let nr=.5*Bt.buffer/Bt.extent,We=.5-nr,Dr=.5+nr,Er=1+nr,kr=null,pi=null,Gt=null,dr=null,tr=Jr(de,ut,ce-nr,ce+Dr,0,rr.minX,rr.maxX,Bt),zr=Jr(de,ut,ce+We,ce+Er,0,rr.minX,rr.maxX,Bt);de=null,tr&&(kr=Jr(tr,ut,ze-nr,ze+Dr,1,rr.minY,rr.maxY,Bt),pi=Jr(tr,ut,ze+We,ze+Er,1,rr.minY,rr.maxY,Bt),tr=null),zr&&(Gt=Jr(zr,ut,ze-nr,ze+Dr,1,rr.minY,rr.maxY,Bt),dr=Jr(zr,ut,ze+We,ze+Er,1,rr.minY,rr.maxY,Bt),zr=null),Pt>1&&console.timeEnd("clipping"),it.push(kr||[],ge+1,2*ce,2*ze),it.push(pi||[],ge+1,2*ce,2*ze+1),it.push(Gt||[],ge+1,2*ce+1,2*ze),it.push(dr||[],ge+1,2*ce+1,2*ze+1)}}getTile(de,ge,ce){de=+de,ge=+ge,ce=+ce;let ze=this.options,{extent:Ye,debug:Ke}=ze;if(de<0||de>24)return null;let dt=1<<de,it=Tr(de,ge=ge+dt&dt-1,ce);if(this.tiles[it])return ea(this.tiles[it],Ye);Ke>1&&console.log("drilling down to z%d-%d-%d",de,ge,ce);let Bt,Pt=de,ut=ge,zt=ce;for(;!Bt&&Pt>0;)Pt--,ut>>=1,zt>>=1,Bt=this.tiles[Tr(Pt,ut,zt)];return Bt&&Bt.source?(Ke>1&&(console.log("found parent tile z%d-%d-%d",Pt,ut,zt),console.time("drilling down")),this.splitTile(Bt.source,Pt,ut,zt,de,ge,ce),Ke>1&&console.timeEnd("drilling down"),this.tiles[it]?ea(this.tiles[it],Ye):null):null}}function Tr(ot,de,ge){return 32*((1<<ot)*ge+de)+ot}function si(ot,de){return de?ot.properties[de]:ot.id}function Ir(ot,de){if(ot==null)return!0;if(ot.type==="Feature")return si(ot,de)!=null;if(ot.type==="FeatureCollection"){let ge=new Set;for(let ce of ot.features){let ze=si(ce,de);if(ze==null||ge.has(ze))return!1;ge.add(ze)}return!0}return!1}function $i(ot,de){let ge=new Map;if(ot!=null)if(ot.type==="Feature")ge.set(si(ot,de),ot);else for(let ce of ot.features)ge.set(si(ce,de),ce);return ge}class Qn extends p{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(de,ge){return n._(this,void 0,void 0,function*(){let ce=de.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let ze=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!ze)return null;let Ye=new re(ze.features),Ke=Je(Ye);return Ke.byteOffset===0&&Ke.byteLength===Ke.buffer.byteLength||(Ke=new Uint8Array(Ke)),{vectorTile:Ye,rawData:Ke.buffer}})}loadData(de){return n._(this,void 0,void 0,function*(){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.abort();let ce=!!(de&&de.request&&de.request.collectResourceTiming)&&new n.cA(de.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(de,this._pendingRequest),this._geoJSONIndex=de.cluster?new ve(function({superclusterOptions:Ke,clusterProperties:dt}){if(!dt||!Ke)return Ke;let it={},Bt={},Pt={accumulated:null,zoom:0},ut={properties:null},zt=Object.keys(dt);for(let rr of zt){let[nr,We]=dt[rr],Dr=n.cH(We),Er=n.cH(typeof nr=="string"?[nr,["accumulated"],["get",rr]]:nr);it[rr]=Dr.value,Bt[rr]=Er.value}return Ke.map=rr=>{ut.properties=rr;let nr={};for(let We of zt)nr[We]=it[We].evaluate(Pt,ut);return nr},Ke.reduce=(rr,nr)=>{ut.properties=nr;for(let We of zt)Pt.accumulated=rr[We],rr[We]=Bt[We].evaluate(Pt,ut)},Ke}(de)).load((yield this._pendingData).features):(ze=yield this._pendingData,new Ft(ze,de.geojsonVtOptions)),this.loaded={};let Ye={};if(ce){let Ke=ce.finish();Ke&&(Ye.resourceTiming={},Ye.resourceTiming[de.source]=JSON.parse(JSON.stringify(Ke)))}return Ye}catch(Ye){if(delete this._pendingRequest,n.cl(Ye))return{abandoned:!0};throw Ye}var ze})}getData(){return n._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(de){let ge=this.loaded;return ge&&ge[de.uid]?super.reloadTile(de):this.loadTile(de)}loadAndProcessGeoJSON(de,ge){return n._(this,void 0,void 0,function*(){let ce=yield this.loadGeoJSON(de,ge);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`);if(G(ce,!0),de.filter){let ze=n.cH(de.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(Ke=>ze.value.evaluate({zoom:0},Ke))}}return ce})}loadGeoJSON(de,ge){return n._(this,void 0,void 0,function*(){let{promoteId:ce}=de;if(de.request){let ze=yield n.j(de.request,ge);return this._dataUpdateable=Ir(ze.data,ce)?$i(ze.data,ce):void 0,ze.data}if(typeof de.data=="string")try{let ze=JSON.parse(de.data);return this._dataUpdateable=Ir(ze,ce)?$i(ze,ce):void 0,ze}catch{throw new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`)}if(!de.dataDiff)throw new Error(`Input data given to '${de.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${de.source}`);return function(ze,Ye,Ke){var dt,it,Bt,Pt;if(Ye.removeAll&&ze.clear(),Ye.remove)for(let ut of Ye.remove)ze.delete(ut);if(Ye.add)for(let ut of Ye.add){let zt=si(ut,Ke);zt!=null&&ze.set(zt,ut)}if(Ye.update)for(let ut of Ye.update){let zt=ze.get(ut.id);if(zt==null)continue;let rr=!ut.removeAllProperties&&(((dt=ut.removeProperties)===null||dt===void 0?void 0:dt.length)>0||((it=ut.addOrUpdateProperties)===null||it===void 0?void 0:it.length)>0);if((ut.newGeometry||ut.removeAllProperties||rr)&&(zt=Object.assign({},zt),ze.set(ut.id,zt),rr&&(zt.properties=Object.assign({},zt.properties))),ut.newGeometry&&(zt.geometry=ut.newGeometry),ut.removeAllProperties)zt.properties={};else if(((Bt=ut.removeProperties)===null||Bt===void 0?void 0:Bt.length)>0)for(let nr of ut.removeProperties)Object.prototype.hasOwnProperty.call(zt.properties,nr)&&delete zt.properties[nr];if(((Pt=ut.addOrUpdateProperties)===null||Pt===void 0?void 0:Pt.length)>0)for(let{key:nr,value:We}of ut.addOrUpdateProperties)zt.properties[nr]=We}}(this._dataUpdateable,de.dataDiff,ce),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(de){return n._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(de){return this._geoJSONIndex.getClusterExpansionZoom(de.clusterId)}getClusterChildren(de){return this._geoJSONIndex.getChildren(de.clusterId)}getClusterLeaves(de){return this._geoJSONIndex.getLeaves(de.clusterId,de.limit,de.offset)}}class Mn{constructor(de){this.self=de,this.actor=new n.H(de),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ge,ce)=>{if(this.externalWorkerSourceTypes[ge])throw new Error(`Worker source with name "${ge}" already registered.`);this.externalWorkerSourceTypes[ge]=ce},this.self.addProtocol=n.cn,this.self.removeProtocol=n.co,this.self.registerRTLTextPlugin=ge=>{n.cI.setMethods(ge)},this.actor.registerMessageHandler("LDT",(ge,ce)=>this._getDEMWorkerSource(ge,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RDT",(ge,ce)=>n._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ge,ce.source).removeTile(ce)})),this.actor.registerMessageHandler("GCEZ",(ge,ce)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,ce.type,ce.source).getClusterExpansionZoom(ce)})),this.actor.registerMessageHandler("GCC",(ge,ce)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,ce.type,ce.source).getClusterChildren(ce)})),this.actor.registerMessageHandler("GCL",(ge,ce)=>n._(this,void 0,void 0,function*(){return this._getWorkerSource(ge,ce.type,ce.source).getClusterLeaves(ce)})),this.actor.registerMessageHandler("LD",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).loadData(ce)),this.actor.registerMessageHandler("GD",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).getData()),this.actor.registerMessageHandler("LT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).loadTile(ce)),this.actor.registerMessageHandler("RT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).reloadTile(ce)),this.actor.registerMessageHandler("AT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).abortTile(ce)),this.actor.registerMessageHandler("RMT",(ge,ce)=>this._getWorkerSource(ge,ce.type,ce.source).removeTile(ce)),this.actor.registerMessageHandler("RS",(ge,ce)=>n._(this,void 0,void 0,function*(){if(!this.workerSources[ge]||!this.workerSources[ge][ce.type]||!this.workerSources[ge][ce.type][ce.source])return;let ze=this.workerSources[ge][ce.type][ce.source];delete this.workerSources[ge][ce.type][ce.source],ze.removeSource!==void 0&&ze.removeSource(ce)})),this.actor.registerMessageHandler("RM",ge=>n._(this,void 0,void 0,function*(){delete this.layerIndexes[ge],delete this.availableImages[ge],delete this.workerSources[ge],delete this.demWorkerSources[ge]})),this.actor.registerMessageHandler("SR",(ge,ce)=>n._(this,void 0,void 0,function*(){this.referrer=ce})),this.actor.registerMessageHandler("SRPS",(ge,ce)=>this._syncRTLPluginState(ge,ce)),this.actor.registerMessageHandler("IS",(ge,ce)=>n._(this,void 0,void 0,function*(){this.self.importScripts(ce)})),this.actor.registerMessageHandler("SI",(ge,ce)=>this._setImages(ge,ce)),this.actor.registerMessageHandler("UL",(ge,ce)=>n._(this,void 0,void 0,function*(){this._getLayerIndex(ge).update(ce.layers,ce.removedIds)})),this.actor.registerMessageHandler("SL",(ge,ce)=>n._(this,void 0,void 0,function*(){this._getLayerIndex(ge).replace(ce)}))}_setImages(de,ge){return n._(this,void 0,void 0,function*(){this.availableImages[de]=ge;for(let ce in this.workerSources[de]){let ze=this.workerSources[de][ce];for(let Ye in ze)ze[Ye].availableImages=ge}})}_syncRTLPluginState(de,ge){return n._(this,void 0,void 0,function*(){return yield n.cI.syncState(ge,this.self.importScripts)})}_getAvailableImages(de){let ge=this.availableImages[de];return ge||(ge=[]),ge}_getLayerIndex(de){let ge=this.layerIndexes[de];return ge||(ge=this.layerIndexes[de]=new s),ge}_getWorkerSource(de,ge,ce){if(this.workerSources[de]||(this.workerSources[de]={}),this.workerSources[de][ge]||(this.workerSources[de][ge]={}),!this.workerSources[de][ge][ce]){let ze={sendAsync:(Ye,Ke)=>(Ye.targetMapId=de,this.actor.sendAsync(Ye,Ke))};switch(ge){case"vector":this.workerSources[de][ge][ce]=new p(ze,this._getLayerIndex(de),this._getAvailableImages(de));break;case"geojson":this.workerSources[de][ge][ce]=new Qn(ze,this._getLayerIndex(de),this._getAvailableImages(de));break;default:this.workerSources[de][ge][ce]=new this.externalWorkerSourceTypes[ge](ze,this._getLayerIndex(de),this._getAvailableImages(de))}}return this.workerSources[de][ge][ce]}_getDEMWorkerSource(de,ge){return this.demWorkerSources[de]||(this.demWorkerSources[de]={}),this.demWorkerSources[de][ge]||(this.demWorkerSources[de][ge]=new b),this.demWorkerSources[de][ge]}}return n.i(self)&&(self.worker=new Mn(self)),Mn}),t("index",["exports","./shared"],function(n,s){"use strict";var a="5.3.1";function c(){var S=new s.A(4);return s.A!=Float32Array&&(S[1]=0,S[2]=0),S[0]=1,S[3]=1,S}let d,p,b={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(S,o,u){let _=requestAnimationFrame(C=>{v(),o(C)}),{unsubscribe:v}=s.s(S.signal,"abort",()=>{v(),cancelAnimationFrame(_),u(s.c())},!1)},frameAsync(S){return new Promise((o,u)=>{this.frame(S,o,u)})},getImageData(S,o=0){return this.getImageCanvasContext(S).getImageData(-o,-o,S.width+2*o,S.height+2*o)},getImageCanvasContext(S){let o=window.document.createElement("canvas"),u=o.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return o.width=S.width,o.height=S.height,u.drawImage(S,0,0,S.width,S.height),u},resolveURL:S=>(d||(d=document.createElement("a")),d.href=S,d.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(p==null&&(p=matchMedia("(prefers-reduced-motion: reduce)")),p.matches)}};class T{static testProp(o){if(!T.docStyle)return o[0];for(let u=0;u<o.length;u++)if(o[u]in T.docStyle)return o[u];return o[0]}static create(o,u,_){let v=window.document.createElement(o);return u!==void 0&&(v.className=u),_&&_.appendChild(v),v}static createNS(o,u){return window.document.createElementNS(o,u)}static disableDrag(){T.docStyle&&T.selectProp&&(T.userSelect=T.docStyle[T.selectProp],T.docStyle[T.selectProp]="none")}static enableDrag(){T.docStyle&&T.selectProp&&(T.docStyle[T.selectProp]=T.userSelect)}static setTransform(o,u){o.style[T.transformProp]=u}static addEventListener(o,u,_,v={}){o.addEventListener(u,_,"passive"in v?v:v.capture)}static removeEventListener(o,u,_,v={}){o.removeEventListener(u,_,"passive"in v?v:v.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",T.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",T.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",T.suppressClickInternal,!0)},0)}static getScale(o){let u=o.getBoundingClientRect();return{x:u.width/o.offsetWidth||1,y:u.height/o.offsetHeight||1,boundingClientRect:u}}static getPoint(o,u,_){let v=u.boundingClientRect;return new s.P((_.clientX-v.left)/u.x-o.clientLeft,(_.clientY-v.top)/u.y-o.clientTop)}static mousePos(o,u){let _=T.getScale(o);return T.getPoint(o,_,u)}static touchPos(o,u){let _=[],v=T.getScale(o);for(let C=0;C<u.length;C++)_.push(T.getPoint(o,v,u[C]));return _}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}static sanitize(o){let u=new DOMParser().parseFromString(o,"text/html").body||document.createElement("body"),_=u.querySelectorAll("script");for(let v of _)v.remove();return T.clean(u),u.innerHTML}static isPossiblyDangerous(o,u){let _=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(o)||!_.includes("javascript:")&&!_.includes("data:"))||!!o.startsWith("on")||void 0}static clean(o){let u=o.children;for(let _ of u)T.removeAttributes(_),T.clean(_)}static removeAttributes(o){for(let{name:u,value:_}of o.attributes)T.isPossiblyDangerous(u,_)&&o.removeAttribute(u)}}T.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,T.selectProp=T.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),T.transformProp=T.testProp(["transform","WebkitTransform"]);let B={supported:!1,testSupport:function(S){!Z&&G&&(q?re(S):z=S)}},z,G,Z=!1,q=!1;function re(S){let o=S.createTexture();S.bindTexture(S.TEXTURE_2D,o);try{if(S.texImage2D(S.TEXTURE_2D,0,S.RGBA,S.RGBA,S.UNSIGNED_BYTE,G),S.isContextLost())return;B.supported=!0}catch{}S.deleteTexture(o),Z=!0}var ee;typeof document<"u"&&(G=document.createElement("img"),G.onload=()=>{z&&re(z),z=null,q=!0},G.onerror=()=>{Z=!0,z=null},G.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(S){let o,u,_,v;S.resetRequestQueue=()=>{o=[],u=0,_=0,v={}},S.addThrottleControl=V=>{let H=_++;return v[H]=V,H},S.removeThrottleControl=V=>{delete v[V],O()},S.getImage=(V,H,K=!0)=>new Promise((ne,ie)=>{B.supported&&(V.headers||(V.headers={}),V.headers.accept="image/webp,*/*"),s.e(V,{type:"image"}),o.push({abortController:H,requestParameters:V,supportImageRefresh:K,state:"queued",onError:fe=>{ie(fe)},onSuccess:fe=>{ne(fe)}}),O()});let C=V=>s._(this,void 0,void 0,function*(){V.state="running";let{requestParameters:H,supportImageRefresh:K,onError:ne,onSuccess:ie,abortController:fe}=V,Ae=K===!1&&!s.i(self)&&!s.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((Me,ke)=>Me&&ke==="accept",!0));u++;let Ie=Ae?N(H,fe):s.m(H,fe);try{let Me=yield Ie;delete V.abortController,V.state="completed",Me.data instanceof HTMLImageElement||s.b(Me.data)?ie(Me):Me.data&&ie({data:yield(Se=Me.data,typeof createImageBitmap=="function"?s.f(Se):s.h(Se)),cacheControl:Me.cacheControl,expires:Me.expires})}catch(Me){delete V.abortController,ne(Me)}finally{u--,O()}var Se}),O=()=>{let V=(()=>{for(let H of Object.keys(v))if(v[H]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=u;H<V&&o.length>0;H++){let K=o.shift();K.abortController.signal.aborted?H--:C(K)}},N=(V,H)=>new Promise((K,ne)=>{let ie=new Image,fe=V.url,Ae=V.credentials;Ae&&Ae==="include"?ie.crossOrigin="use-credentials":(Ae&&Ae==="same-origin"||!s.d(fe))&&(ie.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{ie.src="",ne(s.c())}),ie.fetchPriority="high",ie.onload=()=>{ie.onerror=ie.onload=null,K({data:ie})},ie.onerror=()=>{ie.onerror=ie.onload=null,H.signal.aborted||ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ie.src=fe})}(ee||(ee={})),ee.resetRequestQueue();class ae{constructor(o){this._transformRequestFn=o}transformRequest(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function me(S){let o=[];if(typeof S=="string")o.push({id:"default",url:S});else if(S&&S.length>0){let u=[];for(let{id:_,url:v}of S){let C=`${_}${v}`;u.indexOf(C)===-1&&(u.push(C),o.push({id:_,url:v}))}}return o}function Le(S,o,u){try{let _=new URL(S);return _.pathname+=`${o}${u}`,_.toString()}catch{throw new Error(`Invalid sprite URL "${S}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class je{constructor(o,u,_,v){this.context=o,this.format=_,this.texture=o.gl.createTexture(),this.update(u,v)}update(o,u,_){let{width:v,height:C}=o,O=!(this.size&&this.size[0]===v&&this.size[1]===C||_),{context:N}=this,{gl:V}=N;if(this.useMipmap=!!(u&&u.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),N.pixelStoreUnpackFlipY.set(!1),N.pixelStoreUnpack.set(1),N.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!u||u.premultiply!==!1)),O)this.size=[v,C],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||s.b(o)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,o):V.texImage2D(V.TEXTURE_2D,0,this.format,v,C,0,this.format,V.UNSIGNED_BYTE,o.data);else{let{x:H,y:K}=_||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||s.b(o)?V.texSubImage2D(V.TEXTURE_2D,0,H,K,V.RGBA,V.UNSIGNED_BYTE,o):V.texSubImage2D(V.TEXTURE_2D,0,H,K,v,C,V.RGBA,V.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D),N.pixelStoreUnpackFlipY.setDefault(),N.pixelStoreUnpack.setDefault(),N.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(o,u,_){let{context:v}=this,{gl:C}=v;C.bindTexture(C.TEXTURE_2D,this.texture),_!==C.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=C.LINEAR),o!==this.filter&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,o),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,_||o),this.filter=o),u!==this.wrap&&(C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,u),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Je(S){let{userImage:o}=S;return!!(o&&o.render&&o.render())&&(S.data.replace(new Uint8Array(o.data.buffer)),!0)}class J extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(let{ids:u,promiseResolve:_}of this.requestors)_(this._getImagesForIds(u));this.requestors=[]}}getImage(o){let u=this.images[o];if(u&&!u.data&&u.spriteData){let _=u.spriteData;u.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),u.spriteData=null}return u}addImage(o,u){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let _=!0,v=u.data||u.spriteData;return this._validateStretch(u.stretchX,v&&v.width)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchX" value`))),_=!1),this._validateStretch(u.stretchY,v&&v.height)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "stretchY" value`))),_=!1),this._validateContent(u.content,u)||(this.fire(new s.k(new Error(`Image "${o}" has invalid "content" value`))),_=!1),_}_validateStretch(o,u){if(!o)return!0;let _=0;for(let v of o){if(v[0]<_||v[1]<v[0]||u<v[1])return!1;_=v[1]}return!0}_validateContent(o,u){if(!o)return!0;if(o.length!==4)return!1;let _=u.spriteData,v=_&&_.width||u.data.width,C=_&&_.height||u.data.height;return!(o[0]<0||v<o[0]||o[1]<0||C<o[1]||o[2]<0||v<o[2]||o[3]<0||C<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,u,_=!0){let v=this.getImage(o);if(_&&(v.data.width!==u.data.width||v.data.height!==u.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=v.version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){let u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((u,_)=>{let v=!0;if(!this.isLoaded())for(let C of o)this.images[C]||(v=!1);this.isLoaded()||v?u(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:u})})}_getImagesForIds(o){let u={};for(let _ of o){let v=this.getImage(_);v||(this.fire(new s.l("styleimagemissing",{id:_})),v=this.getImage(_)),v?u[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,textFitWidth:v.textFitWidth,textFitHeight:v.textFitHeight,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){let{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){let u=this.patterns[o],_=this.getImage(o);if(!_)return null;if(u&&u.position.version===_.version)return u.position;if(u)u.position.version=_.version;else{let v={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new s.I(v,_);this.patterns[o]={bin:v,position:C}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){let u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new je(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){let o=[];for(let C in this.patterns)o.push(this.patterns[C].bin);let{w:u,h:_}=s.p(o),v=this.atlasImage;v.resize({width:u||1,height:_||1});for(let C in this.patterns){let{bin:O}=this.patterns[C],N=O.x+1,V=O.y+1,H=this.getImage(C).data,K=H.width,ne=H.height;s.R.copy(H,v,{x:0,y:0},{x:N,y:V},{width:K,height:ne}),s.R.copy(H,v,{x:0,y:ne-1},{x:N,y:V-1},{width:K,height:1}),s.R.copy(H,v,{x:0,y:0},{x:N,y:V+ne},{width:K,height:1}),s.R.copy(H,v,{x:K-1,y:0},{x:N-1,y:V},{width:1,height:ne}),s.R.copy(H,v,{x:0,y:0},{x:N+K,y:V},{width:1,height:ne})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(let u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;let _=this.getImage(u);_||s.w(`Image with ID: "${u}" was not found`),Je(_)&&this.updateImage(u,_)}}}let te=1e20;function X(S,o,u,_,v,C,O,N,V){for(let H=o;H<o+_;H++)ye(S,u*C+H,C,v,O,N,V);for(let H=u;H<u+v;H++)ye(S,H*C+o,1,_,O,N,V)}function ye(S,o,u,_,v,C,O){C[0]=0,O[0]=-1e20,O[1]=te,v[0]=S[o];for(let N=1,V=0,H=0;N<_;N++){v[N]=S[o+N*u];let K=N*N;do{let ne=C[V];H=(v[N]-v[ne]+K-ne*ne)/(N-ne)/2}while(H<=O[V]&&--V>-1);V++,C[V]=N,O[V]=H,O[V+1]=te}for(let N=0,V=0;N<_;N++){for(;O[V+1]<N;)V++;let H=C[V],K=N-H;S[o+N*u]=v[H]+K*K}}class _e{constructor(o,u){this.requestManager=o,this.localIdeographFontFamily=u,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return s._(this,void 0,void 0,function*(){let u=[];for(let C in o)for(let O of o[C])u.push(this._getAndCacheGlyphsPromise(C,O));let _=yield Promise.all(u),v={};for(let{stack:C,id:O,glyph:N}of _)v[C]||(v[C]={}),v[C][O]=N&&{id:N.id,bitmap:N.bitmap.clone(),metrics:N.metrics};return v})}_getAndCacheGlyphsPromise(o,u){return s._(this,void 0,void 0,function*(){let _=this.entries[o];_||(_=this.entries[o]={glyphs:{},requests:{},ranges:{}});let v=_.glyphs[u];if(v!==void 0)return{stack:o,id:u,glyph:v};if(v=this._tinySDF(_,o,u),v)return _.glyphs[u]=v,{stack:o,id:u,glyph:v};let C=Math.floor(u/256);if(256*C>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[C])return{stack:o,id:u,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[C]){let N=_e.loadGlyphRange(o,C,this.url,this.requestManager);_.requests[C]=N}let O=yield _.requests[C];for(let N in O)this._doesCharSupportLocalGlyph(+N)||(_.glyphs[+N]=O[+N]);return _.ranges[C]=!0,{stack:o,id:u,glyph:O[u]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(o))||s.u["CJK Unified Ideographs"](o)||s.u["Hangul Syllables"](o)||s.u.Hiragana(o)||s.u.Katakana(o)||s.u["CJK Symbols and Punctuation"](o)||s.u["Halfwidth and Fullwidth Forms"](o))}_tinySDF(o,u,_){let v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(_))return;let C=o.tinySDF;if(!C){let N="400";/bold/i.test(u)?N="900":/medium/i.test(u)?N="500":/light/i.test(u)&&(N="200"),C=o.tinySDF=new _e.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:N})}let O=C.draw(String.fromCharCode(_));return{id:_,bitmap:new s.q({width:O.width||60,height:O.height||60},O.data),metrics:{width:O.glyphWidth/2||24,height:O.glyphHeight/2||24,left:O.glyphLeft/2+.5||0,top:O.glyphTop/2-27.5||-8,advance:O.glyphAdvance/2||24,isDoubleResolution:!0}}}}_e.loadGlyphRange=function(S,o,u,_){return s._(this,void 0,void 0,function*(){let v=256*o,C=v+255,O=_.transformRequest(u.replace("{fontstack}",S).replace("{range}",`${v}-${C}`),"Glyphs"),N=yield s.n(O,new AbortController);if(!N||!N.data)throw new Error(`Could not load glyph range. range: ${o}, ${v}-${C}`);let V={};for(let H of s.o(N.data))V[H.id]=H;return V})},_e.TinySDF=class{constructor({fontSize:S=24,buffer:o=3,radius:u=8,cutoff:_=.25,fontFamily:v="sans-serif",fontWeight:C="normal",fontStyle:O="normal"}={}){this.buffer=o,this.cutoff=_,this.radius=u;let N=this.size=S+4*o,V=this._createCanvas(N),H=this.ctx=V.getContext("2d",{willReadFrequently:!0});H.font=`${O} ${C} ${S}px ${v}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(N*N),this.gridInner=new Float64Array(N*N),this.f=new Float64Array(N),this.z=new Float64Array(N+1),this.v=new Uint16Array(N)}_createCanvas(S){let o=document.createElement("canvas");return o.width=o.height=S,o}draw(S){let{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:_,actualBoundingBoxLeft:v,actualBoundingBoxRight:C}=this.ctx.measureText(S),O=Math.ceil(u),N=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(C-v))),V=Math.min(this.size-this.buffer,O+Math.ceil(_)),H=N+2*this.buffer,K=V+2*this.buffer,ne=Math.max(H*K,0),ie=new Uint8ClampedArray(ne),fe={data:ie,width:H,height:K,glyphWidth:N,glyphHeight:V,glyphTop:O,glyphLeft:0,glyphAdvance:o};if(N===0||V===0)return fe;let{ctx:Ae,buffer:Ie,gridInner:Se,gridOuter:Me}=this;Ae.clearRect(Ie,Ie,N,V),Ae.fillText(S,Ie,Ie+O);let ke=Ae.getImageData(Ie,Ie,N,V);Me.fill(te,0,ne),Se.fill(0,0,ne);for(let Ve=0;Ve<V;Ve++)for(let Be=0;Be<N;Be++){let qe=ke.data[4*(Ve*N+Be)+3]/255;if(qe===0)continue;let Ge=(Ve+Ie)*H+Be+Ie;if(qe===1)Me[Ge]=0,Se[Ge]=te;else{let Ze=.5-qe;Me[Ge]=Ze>0?Ze*Ze:0,Se[Ge]=Ze<0?Ze*Ze:0}}X(Me,0,0,H,K,H,this.f,this.v,this.z),X(Se,Ie,Ie,N,V,H,this.f,this.v,this.z);for(let Ve=0;Ve<ne;Ve++){let Be=Math.sqrt(Me[Ve])-Math.sqrt(Se[Ve]);ie[Ve]=Math.round(255-255*(Be/this.radius+this.cutoff))}return fe}};class Oe{constructor(){this.specification=s.v.light.position}possiblyEvaluate(o,u){return s.z(o.expression.evaluate(u))}interpolate(o,u,_){return{x:s.B.number(o.x,u.x,_),y:s.B.number(o.y,u.y,_),z:s.B.number(o.z,u.z,_)}}}let ve;class De extends s.E{constructor(o){super(),ve=ve||new s.r({anchor:new s.D(s.v.light.anchor),position:new Oe,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(ve),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(s.t,o,u))for(let _ in o){let v=o[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,_){return(!_||_.validate!==!1)&&s.x(this,o.call(s.y,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}let Xe=new s.r({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class rt extends s.E{constructor(o){super(),this._transitionable=new s.T(Xe),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0))}setSky(o,u={}){if(!this._validate(s.F,o,u)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let _ in o){let v=o[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,_={}){return _?.validate!==!1&&s.x(this,o.call(s.y,s.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class tt{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,u){let _=o.join(",")+String(u);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(o,u)),this.dashEntry[_]}getDashRanges(o,u,_){let v=[],C=o.length%2==1?-o[o.length-1]*_:0,O=o[0]*_,N=!0;v.push({left:C,right:O,isDash:N,zeroLength:o[0]===0});let V=o[0];for(let H=1;H<o.length;H++){N=!N;let K=o[H];C=V*_,V+=K,O=V*_,v.push({left:C,right:O,isDash:N,zeroLength:K===0})}return v}addRoundDash(o,u,_){let v=u/2;for(let C=-_;C<=_;C++){let O=this.width*(this.nextRow+_+C),N=0,V=o[N];for(let H=0;H<this.width;H++){H/V.right>1&&(V=o[++N]);let K=Math.abs(H-V.left),ne=Math.abs(H-V.right),ie=Math.min(K,ne),fe,Ae=C/_*(v+1);if(V.isDash){let Ie=v-Math.abs(Ae);fe=Math.sqrt(ie*ie+Ie*Ie)}else fe=v-Math.sqrt(ie*ie+Ae*Ae);this.data[O+H]=Math.max(0,Math.min(255,fe+128))}}}addRegularDash(o){for(let N=o.length-1;N>=0;--N){let V=o[N],H=o[N+1];V.zeroLength?o.splice(N,1):H&&H.isDash===V.isDash&&(H.left=V.left,o.splice(N,1))}let u=o[0],_=o[o.length-1];u.isDash===_.isDash&&(u.left=_.left-this.width,_.right=u.right+this.width);let v=this.width*this.nextRow,C=0,O=o[C];for(let N=0;N<this.width;N++){N/O.right>1&&(O=o[++C]);let V=Math.abs(N-O.left),H=Math.abs(N-O.right),K=Math.min(V,H);this.data[v+N]=Math.max(0,Math.min(255,(O.isDash?K:-K)+128))}}addDash(o,u){let _=u?7:0,v=2*_+1;if(this.nextRow+v>this.height)return s.w("LineAtlas out of space"),null;let C=0;for(let N=0;N<o.length;N++)C+=o[N];if(C!==0){let N=this.width/C,V=this.getDashRanges(o,this.width,N);u?this.addRoundDash(V,N,_):this.addRegularDash(V)}let O={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:C};return this.nextRow+=v,this.dirty=!0,O}bind(o){let u=o.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}let yt="maplibre_preloaded_worker_pool";class Xt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Xt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[yt]}numActive(){return Object.keys(this.active).length}}let jt=Math.floor(b.hardwareConcurrency/2),fr,qt;function Ot(){return fr||(fr=new Xt),fr}Xt.workerCount=s.G(globalThis)?Math.max(Math.min(jt,3),1):1;class wr{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=u;let _=this.workerPool.acquire(u);for(let v=0;v<_.length;v++){let C=new s.H(_[v],u);C.name=`Worker ${v}`,this.actors.push(C)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,u){let _=[];for(let v of this.actors)_.push(v.sendAsync({type:o,data:u}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,u){for(let _ of this.actors)_.registerMessageHandler(o,u)}}function Lr(){return qt||(qt=new wr(Ot(),s.J),qt.registerMessageHandler("GR",(S,o,u)=>s.m(o,u))),qt}function Or(S,o){let u=s.K();return s.L(u,u,[1,1,0]),s.M(u,u,[.5*S.width,.5*S.height,1]),S.calculatePosMatrix?s.N(u,u,S.calculatePosMatrix(o.toUnwrapped())):u}function Zr(S,o,u,_,v,C,O){var N;let V=function(ie,fe,Ae){if(ie)for(let Ie of ie){let Se=fe[Ie];if(Se&&Se.source===Ae&&Se.type==="fill-extrusion")return!0}else for(let Ie in fe){let Se=fe[Ie];if(Se.source===Ae&&Se.type==="fill-extrusion")return!0}return!1}((N=v?.layers)!==null&&N!==void 0?N:null,o,S.id),H=C.maxPitchScaleFactor(),K=S.tilesIn(_,H,V);K.sort(Oi);let ne=[];for(let ie of K)ne.push({wrappedTileID:ie.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(o,u,S._state,ie.queryGeometry,ie.cameraQueryGeometry,ie.scale,v,C,H,Or(S.transform,ie.tileID),O?(fe,Ae)=>O(ie.tileID,fe,Ae):void 0)});return function(ie,fe){for(let Ae in ie)for(let Ie of ie[Ae])Jr(Ie,fe);return ie}(function(ie){let fe={},Ae={};for(let Ie of ie){let Se=Ie.queryResults,Me=Ie.wrappedTileID,ke=Ae[Me]=Ae[Me]||{};for(let Ve in Se){let Be=Se[Ve],qe=ke[Ve]=ke[Ve]||{},Ge=fe[Ve]=fe[Ve]||[];for(let Ze of Be)qe[Ze.featureIndex]||(qe[Ze.featureIndex]=!0,Ge.push(Ze))}}return fe}(ne),S)}function Oi(S,o){let u=S.tileID,_=o.tileID;return u.overscaledZ-_.overscaledZ||u.canonical.y-_.canonical.y||u.wrap-_.wrap||u.canonical.x-_.canonical.x}function Jr(S,o){let u=S.feature,_=o.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=_}function Ri(S,o,u){return s._(this,void 0,void 0,function*(){let _=S;if(S.url?_=(yield s.j(o.transformRequest(S.url,"Source"),u)).data:yield b.frameAsync(u),!_)return null;let v=s.O(s.e(_,S),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(v.vectorLayerIds=_.vector_layers.map(C=>C.id)),v})}class li{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof s.Q?new s.Q(o.lng,o.lat):s.Q.convert(o),this}setSouthWest(o){return this._sw=o instanceof s.Q?new s.Q(o.lng,o.lat):s.Q.convert(o),this}extend(o){let u=this._sw,_=this._ne,v,C;if(o instanceof s.Q)v=o,C=o;else{if(!(o instanceof li))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(li.convert(o)):this.extend(s.Q.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(s.Q.convert(o)):this;if(v=o._sw,C=o._ne,!v||!C)return this}return u||_?(u.lng=Math.min(v.lng,u.lng),u.lat=Math.min(v.lat,u.lat),_.lng=Math.max(C.lng,_.lng),_.lat=Math.max(C.lat,_.lat)):(this._sw=new s.Q(v.lng,v.lat),this._ne=new s.Q(C.lng,C.lat)),this}getCenter(){return new s.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.Q(this.getWest(),this.getNorth())}getSouthEast(){return new s.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){let{lng:u,lat:_}=s.Q.convert(o),v=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&v}static convert(o){return o instanceof li?o:o&&new li(o)}static fromLngLat(o,u=0){let _=360*u/40075017,v=_/Math.cos(Math.PI/180*o.lat);return new li(new s.Q(o.lng-v,o.lat-_),new s.Q(o.lng+v,o.lat+_))}adjustAntiMeridian(){let o=new s.Q(this._sw.lng,this._sw.lat),u=new s.Q(this._ne.lng,this._ne.lat);return new li(o,o.lng>u.lng?new s.Q(u.lng+360,u.lat):u)}}class Qi{constructor(o,u,_){this.bounds=li.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=_||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){let u=Math.pow(2,o.z),_=Math.floor(s.U(this.bounds.getWest())*u),v=Math.floor(s.S(this.bounds.getNorth())*u),C=Math.ceil(s.U(this.bounds.getEast())*u),O=Math.ceil(s.S(this.bounds.getSouth())*u);return o.x>=_&&o.x<C&&o.y>=v&&o.y<O}}class Di extends s.E{constructor(o,u,_,v){if(super(),this.id=o,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.O(u,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let o=yield Ri(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(s.e(this,o),o.bounds&&(this.tileBounds=new Qi(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new s.k(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(u,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};_.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((C,O)=>{o.reloadPromise={resolve:C,reject:O}})}else o.actor=this.dispatcher.getActor(),v="LT";o.abortController=new AbortController;try{let C=yield o.actor.sendAsync({type:v,data:_},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,C)}catch(C){if(delete o.abortController,o.aborted)return;if(C&&C.status!==404)throw C;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,u){if(u&&u.resourceTiming&&(o.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&o.setExpiryData(u),o.loadVectorData(u,this.map.painter),o.reloadPromise){let _=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(_.resolve).catch(_.reject)}}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ni extends s.E{constructor(o,u,_,v){super(),this.id=o,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},u),s.e(this,s.O(u,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(o=!1){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let u=yield Ri(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(s.e(this,u),u.bounds&&(this.tileBounds=new Qi(u.bounds,this.minzoom,this.maxzoom)),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:o})))}catch(u){this._tileJSONRequest=null,this.fire(new s.k(u))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load(!0)}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return s.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{let _=yield ee.getImage(this.map._requestManager.transformRequest(u,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&o.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});let v=this.map.painter.context,C=v.gl,O=_.data;o.texture=this.map.painter.getTileTexture(O.width),o.texture?o.texture.update(O,{useMipmap:!0}):(o.texture=new je(v,O,C.RGBA,{useMipmap:!0}),o.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(_){if(delete o.abortController,o.aborted)o.state="unloaded";else if(_)throw o.state="errored",_}})}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class fo extends ni{constructor(o,u,_,v){super(o,u,_,v),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(u,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{let v=yield ee.getImage(_,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(v&&v.data){let C=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&o.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});let O=s.b(C)&&s.V()?C:yield this.readImageNow(C),N={type:this.type,uid:o.uid,source:this.id,rawImageData:O,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();let V=yield o.actor.sendAsync({type:"LDT",data:N});o.dem=V,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(v){if(delete o.abortController,o.aborted)o.state="unloaded";else if(v)throw o.state="errored",v}})}readImageNow(o){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.W()){let u=o.width+2,_=o.height+2;try{return new s.R({width:u,height:_},yield s.X(o,-1,-1,u,_))}catch{}}return b.getImageData(o,1)})}_getNeighboringTiles(o){let u=o.canonical,_=Math.pow(2,u.z),v=(u.x-1+_)%_,C=u.x===0?o.wrap-1:o.wrap,O=(u.x+1+_)%_,N=u.x+1===_?o.wrap+1:o.wrap,V={};return V[new s.Y(o.overscaledZ,C,u.z,v,u.y).key]={backfilled:!1},V[new s.Y(o.overscaledZ,N,u.z,O,u.y).key]={backfilled:!1},u.y>0&&(V[new s.Y(o.overscaledZ,C,u.z,v,u.y-1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,o.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,N,u.z,O,u.y-1).key]={backfilled:!1}),u.y+1<_&&(V[new s.Y(o.overscaledZ,C,u.z,v,u.y+1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,o.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},V[new s.Y(o.overscaledZ,N,u.z,O,u.y+1).key]={backfilled:!1}),V}unloadTile(o){return s._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class Ds extends s.E{constructor(o,u,_,v){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(v),this._data=u.data,this._options=s.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:s.Z,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:s.Z,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(o){return o*(s.Z/this.tileSize)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return s._(this,void 0,void 0,function*(){let o=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}getCoordinatesFromGeometry(o){return o.type==="GeometryCollection"?o.geometries.map(u=>u.coordinates).flat(1/0):o.coordinates.flat(1/0)}getBounds(){return s._(this,void 0,void 0,function*(){let o=new li,u=yield this.getData(),_;switch(u.type){case"FeatureCollection":_=u.features.map(v=>this.getCoordinatesFromGeometry(v.geometry)).flat(1/0);break;case"Feature":_=this.getCoordinatesFromGeometry(u.geometry);break;default:_=this.getCoordinatesFromGeometry(u)}if(_.length==0)return o;for(let v=0;v<_.length-1;v+=2)o.extend([_[v],_[v+1]]);return o})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(o.clusterRadius)),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,u,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:u,offset:_}})}_updateWorkerData(o){return s._(this,void 0,void 0,function*(){let u=s.e({type:this.type},this.workerOptions);o?u.dataDiff=o:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(b.resolveURL(this._data),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.l("dataloading",{dataType:"source"}));try{let _=yield this.actor.sendAsync({type:"LD",data:u});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new s.l("dataabort",{dataType:"source"}));let v=null;_.resourceTiming&&_.resourceTiming[this.id]&&(v=_.resourceTiming[this.id].slice(0));let C={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&s.e(C,{resourceTiming:v}),this.fire(new s.l("data",Object.assign(Object.assign({},C),{sourceDataType:"metadata"}))),this.fire(new s.l("data",Object.assign(Object.assign({},C),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new s.l("dataabort",{dataType:"source"}));this.fire(new s.k(_))}})}loaded(){return this._pendingLoads===0}loadTile(o){return s._(this,void 0,void 0,function*(){let u=o.actor?"RT":"LT";o.actor=this.actor;let _={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};o.abortController=new AbortController;let v=yield this.actor.sendAsync({type:u,data:_},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(v,this.map.painter,u==="RT")})}abortTile(o){return s._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return s._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Kn extends s.E{constructor(o,u,_,v){super(),this.flippedWindingOrder=!1,this.id=o,this.dispatcher=_,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(o){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let u=yield ee.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,o&&(this.coordinates=o),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new s.k(u))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;let u=o.map(s.$.fromLngLat);var _;return this.tileID=function(v){let C=1/0,O=1/0,N=-1/0,V=-1/0;for(let ie of v)C=Math.min(C,ie.x),O=Math.min(O,ie.y),N=Math.max(N,ie.x),V=Math.max(V,ie.y);let H=Math.max(N-C,V-O),K=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),ne=Math.pow(2,K);return new s.a1(K,Math.floor((C+N)/2*ne),Math.floor((O+V)/2*ne))}(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(v=>this.tileID.getTilePoint(v)._round()),this.flippedWindingOrder=((_=this.tileCoords)[1].x-_[0].x)*(_[2].y-_[0].y)-(_[1].y-_[0].y)*(_[2].x-_[0].x)<0,this.fire(new s.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let o=this.map.painter.context,u=o.gl;this.texture||(this.texture=new je(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(let v in this.tiles){let C=this.tiles[v];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(o){let u=1/0,_=1/0,v=-1/0,C=-1/0;for(let N of o)u=Math.min(u,N.x),_=Math.min(_,N.y),v=Math.max(v,N.x),C=Math.max(C,N.y);let O={};for(let N=0;N<=s.a0;N++){let V=Math.pow(2,N),H=Math.floor(u*V),K=Math.floor(_*V),ne=Math.floor(v*V),ie=Math.floor(C*V);O[N]={minTileX:H,minTileY:K,maxTileX:ne,maxTileY:ie}}return O}}class ks extends Kn{constructor(o,u,_,v){super(o,u,_,v),this.roundZoom=!0,this.type="video",this.options=u}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;let o=this.options;this.urls=[];for(let u of o.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{let u=yield s.a2(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new s.k(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){let u=this.video.seekable;o<u.start(0)||o>u.end(0)?this.fire(new s.k(new s.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let o=this.map.painter.context,u=o.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new je(o,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let _=!1;for(let v in this.tiles){let C=this.tiles[v];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,_=!0)}_&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ea extends Kn{constructor(o,u,_,v){super(o,u,_,v),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(C=>!Array.isArray(C)||C.length!==2||C.some(O=>typeof O!="number"))||this.fire(new s.k(new s.a3(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.k(new s.a3(`sources.${o}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new s.k(new s.a3(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new s.k(new s.a3(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.k(new s.a3(`sources.${o}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let u=this.map.painter.context,_=u.gl;this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new je(u,this.canvas,_.RGBA,{premultiply:!0});let v=!1;for(let C in this.tiles){let O=this.tiles[C];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture,v=!0)}v&&this.fire(new s.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}let os={},Zs=S=>{switch(S){case"geojson":return Ds;case"image":return Kn;case"raster":return ni;case"raster-dem":return fo;case"vector":return Di;case"video":return ks;case"canvas":return ea}return os[S]},as="RTLPluginLoaded";class Vr extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Lr()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return s._(this,arguments,void 0,function*(u,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=b.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.l(as))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Jt=null;function Ft(){return Jt||(Jt=new Vr),Jt}class Tr{constructor(o,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=s.a4(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){let u=o+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,u,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(v,C){let O={};if(!C)return O;for(let N of v){let V=N.layerIds.map(H=>C.getLayer(H)).filter(Boolean);if(V.length!==0){N.layers=V,N.stateDependentLayerIds&&(N.stateDependentLayers=N.stateDependentLayerIds.map(H=>V.filter(K=>K.id===H)[0]));for(let H of V)O[H.id]=N}}return O}(o.buckets,u?.style),this.hasSymbolBuckets=!1;for(let v in this.buckets){let C=this.buckets[v];if(C instanceof s.a6){if(this.hasSymbolBuckets=!0,!_)break;C.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let v in this.buckets){let C=this.buckets[v];if(C instanceof s.a6&&C.hasRTLText){this.hasRTLText=!0,Ft().lazyLoad();break}}this.queryPadding=0;for(let v in this.buckets){let C=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(v).queryRadius(C))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new s.a5}unloadVectorData(){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(let _ in this.buckets){let v=this.buckets[_];v.uploadPending()&&v.upload(o)}let u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new je(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new je(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,_,v,C,O,N,V,H,K,ne){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:C,scale:O,tileSize:this.tileSize,pixelPosMatrix:K,transform:V,params:N,queryPadding:this.queryPadding*H,getElevation:ne},o,u,_):{}}querySourceFeatures(o,u){let _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;let v=_.loadVTLayers(),C=u&&u.sourceLayer?u.sourceLayer:"",O=v._geojsonTileLayer||v[C];if(!O)return;let N=s.a7(u&&u.filter),{z:V,x:H,y:K}=this.tileID.canonical,ne={z:V,x:H,y:K};for(let ie=0;ie<O.length;ie++){let fe=O.feature(ie);if(N.needGeometry){let Se=s.a8(fe,!0);if(!N.filter(new s.C(this.tileID.overscaledZ),Se,this.tileID.canonical))continue}else if(!N.filter(new s.C(this.tileID.overscaledZ),fe))continue;let Ae=_.getId(fe,C),Ie=new s.a9(fe,V,H,K,Ae);Ie.tile=ne,o.push(Ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){let u=this.expirationTime;if(o.cacheControl){let _=s.aa(o.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let _=Date.now(),v=!1;if(this.expirationTime>_)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{let C=this.expirationTime-u;C?this.expirationTime=_+Math.max(C,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;let _=this.latestFeatureIndex.loadVTLayers();for(let v in this.buckets){if(!u.style.hasLayer(v))continue;let C=this.buckets[v],O=C.layers[0].sourceLayer||"_geojsonTileLayer",N=_[O],V=o[O];if(!N||!V||Object.keys(V).length===0)continue;C.update(V,N,this.imageAtlas&&this.imageAtlas.patternPositions||{});let H=u&&u.style&&u.style.getLayer(v);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<b.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=b.now()+o}setDependencies(o,u){let _={};for(let v of u)_[v]=!0;this.dependencies[o]=_}hasDependency(o,u){for(let _ of o){let v=this.dependencies[_];if(v){for(let C of u)if(v[C])return!0}}return!1}}class si{constructor(o,u){this.max=o,this.onRemove=u,this.reset()}reset(){for(let o in this.data)for(let u of this.data[o])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(o,u,_){let v=o.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);let C={value:u,timeout:void 0};if(_!==void 0&&(C.timeout=setTimeout(()=>{this.remove(o,C)},_)),this.data[v].push(C),this.order.push(v),this.order.length>this.max){let O=this._getAndRemoveByKey(this.order[0]);O&&this.onRemove(O)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let u=this.data[o].shift();return u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),u.value}getByKey(o){let u=this.data[o];return u?u[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,u){if(!this.has(o))return this;let _=o.wrapped().key,v=u===void 0?0:this.data[_].indexOf(u),C=this.data[_][v];return this.data[_].splice(v,1),C.timeout&&clearTimeout(C.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(C.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(o){let u=[];for(let _ in this.data)for(let v of this.data[_])o(v.value)||u.push(v);for(let _ of u)this.remove(_.value.tileID,_)}}class Ir{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,_){let v=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][v]=this.stateChanges[o][v]||{},s.e(this.stateChanges[o][v],_),this.deletedStates[o]===null){this.deletedStates[o]={};for(let C in this.state[o])C!==v&&(this.deletedStates[o][C]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][v]===null){this.deletedStates[o][v]={};for(let C in this.state[o][v])_[C]||(this.deletedStates[o][v][C]=null)}else for(let C in _)this.deletedStates[o]&&this.deletedStates[o][v]&&this.deletedStates[o][v][C]===null&&delete this.deletedStates[o][v][C]}removeFeatureState(o,u,_){if(this.deletedStates[o]===null)return;let v=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},_&&u!==void 0)this.deletedStates[o][v]!==null&&(this.deletedStates[o][v]=this.deletedStates[o][v]||{},this.deletedStates[o][v][_]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][v])for(_ in this.deletedStates[o][v]={},this.stateChanges[o][v])this.deletedStates[o][v][_]=null;else this.deletedStates[o][v]=null;else this.deletedStates[o]=null}getState(o,u){let _=String(u),v=s.e({},(this.state[o]||{})[_],(this.stateChanges[o]||{})[_]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){let C=this.deletedStates[o][u];if(C===null)return{};for(let O in C)delete v[O]}return v}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){let _={};for(let v in this.stateChanges){this.state[v]=this.state[v]||{};let C={};for(let O in this.stateChanges[v])this.state[v][O]||(this.state[v][O]={}),s.e(this.state[v][O],this.stateChanges[v][O]),C[O]=this.state[v][O];_[v]=C}for(let v in this.deletedStates){this.state[v]=this.state[v]||{};let C={};if(this.deletedStates[v]===null)for(let O in this.state[v])C[O]={},this.state[v][O]={};else for(let O in this.deletedStates[v]){if(this.deletedStates[v][O]===null)this.state[v][O]={};else for(let N of Object.keys(this.deletedStates[v][O]))delete this.state[v][O][N];C[O]=this.state[v][O]}_[v]=_[v]||{},s.e(_[v],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(let v in o)o[v].setFeatureState(_,u)}}function $i(S,o,u){let _=o.intersectsFrustum(S);if(!u)return _;let v=o.intersectsPlane(u);return _===0||v===0?0:_===2&&v===2?2:1}function Qn(S,o,u,_,v){let C=S,O=Math.atan(o/u),N=Math.hypot(o,u);return C=S+s.ab(_/N/Math.max(.5,Math.cos(s.ad(v/2)))),C+=1*s.ab(Math.cos(O))/2,C+=s.ae(S-C,-0,0),C}function Mn(S,o){let u=(o.roundZoom?Math.round:Math.floor)(S.zoom+s.ab(S.tileSize/o.tileSize));return Math.max(0,u)}function ot(S,o){let u=S.getCameraFrustum(),_=S.getClippingPlane(),v=S.screenPointToMercatorCoordinate(S.getCameraPoint()),C=s.$.fromLngLat(S.center,S.elevation);v.z=C.z+Math.cos(S.pitchInRadians)*S.cameraToCenterDistance/S.worldSize;let O=S.getCoveringTilesDetailsProvider(),N=O.allowVariableZoom(S,o),V=Mn(S,o),H=o.minzoom||0,K=o.maxzoom!==void 0?o.maxzoom:S.maxZoom,ne=Math.min(Math.max(0,V),K),ie=Math.pow(2,ne),fe=[ie*v.x,ie*v.y,0],Ae=[ie*C.x,ie*C.y,0],Ie=Math.hypot(C.x-v.x,C.y-v.y),Se=Math.abs(C.z-v.z),Me=Math.hypot(Ie,Se),ke=qe=>({zoom:0,x:0,y:0,wrap:qe,fullyVisible:!1}),Ve=[],Be=[];if(S.renderWorldCopies&&O.allowWorldCopies())for(let qe=1;qe<=3;qe++)Ve.push(ke(-qe)),Ve.push(ke(qe));for(Ve.push(ke(0));Ve.length>0;){let qe=Ve.pop(),Ge=qe.x,Ze=qe.y,_t=qe.fullyVisible,At={x:Ge,y:Ze,z:qe.zoom},Mt=O.getTileAABB(At,qe.wrap,S.elevation,o);if(!_t){let Kt=$i(u,Mt,_);if(Kt===0)continue;_t=Kt===2}let Lt=O.distanceToTile2d(v.x,v.y,At,Mt),Tt=V;N&&(Tt=(o.calculateTileZoom||Qn)(S.zoom+s.ab(S.tileSize/o.tileSize),Lt,Se,Me,S.fov)),Tt=(o.roundZoom?Math.round:Math.floor)(Tt),Tt=Math.max(0,Tt);let er=Math.min(Tt,K);if(qe.wrap=O.getWrap(C,At,qe.wrap),qe.zoom>=er){if(qe.zoom<H)continue;let Kt=ne-qe.zoom,Ut=fe[0]-.5-(Ge<<Kt),mt=fe[1]-.5-(Ze<<Kt),Nt=o.reparseOverscaled?Math.max(qe.zoom,Tt):qe.zoom;Be.push({tileID:new s.Y(qe.zoom===K?Nt:qe.zoom,qe.wrap,qe.zoom,Ge,Ze),distanceSq:s.ac([Ae[0]-.5-Ge,Ae[1]-.5-Ze]),tileDistanceToCamera:Math.sqrt(Ut*Ut+mt*mt)})}else for(let Kt=0;Kt<4;Kt++)Ve.push({zoom:qe.zoom+1,x:(Ge<<1)+Kt%2,y:(Ze<<1)+(Kt>>1),wrap:qe.wrap,fullyVisible:_t})}return Be.sort((qe,Ge)=>qe.distanceSq-Ge.distanceSq).map(qe=>qe.tileID)}class de extends s.E{constructor(o,u,_){super(),this.id=o,this.dispatcher=_,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,C,O,N)=>{let V=new(Zs(C.type))(v,C,O,N);if(V.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${V.id}`);return V})(o,u,_,this),this._tiles={},this._cache=new si(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ir,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let o in this._tiles){let u=this._tiles[o];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,u,_){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,u,_)}catch(v){o.state="errored",v.status!==404?this._source.fire(new s.k(v,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new s.l("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let u in this._tiles){let _=this._tiles[u];_.upload(o),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(ge).map(o=>o.key)}getRenderableIds(o){let u=[];for(let _ in this._tiles)this._isIdRenderable(_,o)&&u.push(this._tiles[_]);return o?u.sort((_,v)=>{let C=_.tileID,O=v.tileID,N=new s.P(C.canonical.x,C.canonical.y)._rotate(-this.transform.bearingInRadians),V=new s.P(O.canonical.x,O.canonical.y)._rotate(-this.transform.bearingInRadians);return C.overscaledZ-O.overscaledZ||V.y-N.y||V.x-N.x}).map(_=>_.tileID.key):u.map(_=>_.tileID).sort(ge).map(_=>_.key)}hasRenderableParent(o){let u=this.findLoadedParent(o,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(o,u){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(u||!this._tiles[o].holdingForFade())}reload(o){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let u in this._tiles)(o||this._tiles[u].state!=="errored")&&this._reloadTile(u,"reloading")}}_reloadTile(o,u){return s._(this,void 0,void 0,function*(){let _=this._tiles[o];_&&(_.state!=="loading"&&(_.state=u),yield this._loadTile(_,o,u))})}_tileLoaded(o,u,_){o.timeAdded=b.now(),_==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new s.l("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){let u=this.getRenderableIds();for(let v=0;v<u.length;v++){let C=u[v];if(o.neighboringTiles&&o.neighboringTiles[C]){let O=this.getTileByID(C);_(o,O),_(O,o)}}function _(v,C){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let O=C.tileID.canonical.x-v.tileID.canonical.x,N=C.tileID.canonical.y-v.tileID.canonical.y,V=Math.pow(2,v.tileID.canonical.z),H=C.tileID.key;O===0&&N===0||Math.abs(N)>1||(Math.abs(O)>1&&(Math.abs(O+V)===1?O+=V:Math.abs(O-V)===1&&(O-=V)),C.dem&&v.dem&&(v.dem.backfillBorder(C.dem,O,N),v.neighboringTiles&&v.neighboringTiles[H]&&(v.neighboringTiles[H].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u,_,v){for(let C in this._tiles){let O=this._tiles[C];if(v[C]||!O.hasData()||O.tileID.overscaledZ<=u||O.tileID.overscaledZ>_)continue;let N=O.tileID;for(;O&&O.tileID.overscaledZ>u+1;){let H=O.tileID.scaledTo(O.tileID.overscaledZ-1);O=this._tiles[H.key],O&&O.hasData()&&(N=H)}let V=N;for(;V.overscaledZ>u;)if(V=V.scaledTo(V.overscaledZ-1),o[V.key]||o[V.canonical.key]){v[N.key]=N;break}}}findLoadedParent(o,u){if(o.key in this._loadedParentTiles){let _=this._loadedParentTiles[o.key];return _&&_.tileID.overscaledZ>=u?_:null}for(let _=o.overscaledZ-1;_>=u;_--){let v=o.scaledTo(_),C=this._getLoadedTile(v);if(C)return C}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){let u=this._tiles[o.key];return u&&u.hasData()?u:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){let u=Math.ceil(o.width/this._source.tileSize)+1,_=Math.ceil(o.height/this._source.tileSize)+1,v=Math.floor(u*_*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(C)}handleWrapJump(o){let u=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,u){let _={};for(let v in this._tiles){let C=this._tiles[v];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),_[C.tileID.key]=C}this._tiles=_;for(let v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(let v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}_updateCoveredAndRetainedTiles(o,u,_,v,C,O){let N={},V={},H=Object.keys(o),K=b.now();for(let ne of H){let ie=o[ne],fe=this._tiles[ne];if(!fe||fe.fadeEndTime!==0&&fe.fadeEndTime<=K)continue;let Ae=this.findLoadedParent(ie,u),Ie=this.findLoadedSibling(ie),Se=Ae||Ie||null;Se&&(this._addTile(Se.tileID),N[Se.tileID.key]=Se.tileID),V[ne]=ie}this._retainLoadedChildren(V,v,_,o);for(let ne in N)o[ne]||(this._coveredTiles[ne]=!0,o[ne]=N[ne]);if(O){let ne={},ie={};for(let fe of C)this._tiles[fe.key].hasData()?ne[fe.key]=fe:ie[fe.key]=fe;for(let fe in ie){let Ae=ie[fe].children(this._source.maxzoom);this._tiles[Ae[0].key]&&this._tiles[Ae[1].key]&&this._tiles[Ae[2].key]&&this._tiles[Ae[3].key]&&(ne[Ae[0].key]=o[Ae[0].key]=Ae[0],ne[Ae[1].key]=o[Ae[1].key]=Ae[1],ne[Ae[2].key]=o[Ae[2].key]=Ae[2],ne[Ae[3].key]=o[Ae[3].key]=Ae[3],delete ie[fe])}for(let fe in ie){let Ae=ie[fe],Ie=this.findLoadedParent(Ae,this._source.minzoom),Se=this.findLoadedSibling(Ae),Me=Ie||Se||null;if(Me){ne[Me.tileID.key]=o[Me.tileID.key]=Me.tileID;for(let ke in ne)ne[ke].isChildOf(Me.tileID)&&delete ne[ke]}}for(let fe in this._tiles)ne[fe]||(this._coveredTiles[fe]=!0)}}update(o,u){if(!this._sourceLoaded||this._paused)return;let _;this.transform=o,this.terrain=u,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new s.Y(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y)):(_=ot(o,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(_=_.filter(K=>this._source.hasTile(K)))):_=[];let v=Mn(o,this._source),C=Math.max(v-de.maxOverzooming,this._source.minzoom),O=Math.max(v+de.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let K={};for(let ne of _)if(ne.canonical.z>this._source.minzoom){let ie=ne.scaledTo(ne.canonical.z-1);K[ie.key]=ie;let fe=ne.scaledTo(Math.max(this._source.minzoom,Math.min(ne.canonical.z,5)));K[fe.key]=fe}_=_.concat(Object.values(K))}let N=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,N&&this.fire(new s.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let V=this._updateRetainedTiles(_,v);ce(this._source.type)&&this._updateCoveredAndRetainedTiles(V,C,O,v,_,u);for(let K in V)this._tiles[K].clearFadeHold();let H=s.af(this._tiles,V);for(let K of H){let ne=this._tiles[K];ne.hasSymbolBuckets&&!ne.holdingForFade()?ne.setHoldDuration(this.map._fadeDuration):ne.hasSymbolBuckets&&!ne.symbolFadeFinished()||this._removeTile(K)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,u){var _;let v={},C={},O=Math.max(u-de.maxOverzooming,this._source.minzoom),N=Math.max(u+de.maxUnderzooming,this._source.minzoom),V={};for(let H of o){let K=this._addTile(H);v[H.key]=H,K.hasData()||u<this._source.maxzoom&&(V[H.key]=H)}this._retainLoadedChildren(V,u,N,v);for(let H of o){let K=this._tiles[H.key];if(K.hasData())continue;if(u+1>this._source.maxzoom){let ie=H.children(this._source.maxzoom)[0],fe=this.getTile(ie);if(fe&&fe.hasData()){v[ie.key]=ie;continue}}else{let ie=H.children(this._source.maxzoom);if(v[ie[0].key]&&v[ie[1].key]&&v[ie[2].key]&&v[ie[3].key])continue}let ne=K.wasRequested();for(let ie=H.overscaledZ-1;ie>=O;--ie){let fe=H.scaledTo(ie);if(C[fe.key])break;if(C[fe.key]=!0,K=this.getTile(fe),!K&&ne&&(K=this._addTile(fe)),K){let Ae=K.hasData();if((Ae||!(!((_=this.map)===null||_===void 0)&&_.cancelPendingTileRequestsWhileZooming)||ne)&&(v[fe.key]=fe),ne=K.wasRequested(),Ae)break}}}return v}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let u=[],_,v=this._tiles[o].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){_=this._loadedParentTiles[v.key];break}u.push(v.key);let C=v.scaledTo(v.overscaledZ-1);if(_=this._getLoadedTile(C),_)break;v=C}for(let C of u)this._loadedParentTiles[C]=_}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let o in this._tiles){let u=this._tiles[o].tileID,_=this._getLoadedTile(u);this._loadedSiblingTiles[u.key]=_}}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,u)));let _=u;return u||(u=new Tr(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(u,o.key,u.state)),u.uses++,this._tiles[o.key]=u,_||this._source.fire(new s.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(o,u){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let _=u.getExpiryTimeout();_&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},_))}_removeTile(o){let u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(o){let u=o.sourceDataType;o.dataType==="source"&&u==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&u==="content"&&(this.reload(o.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,u,_){let v=[],C=this.transform;if(!C)return v;let O=_?C.getCameraQueryGeometry(o):o,N=o.map(Ae=>C.screenPointToMercatorCoordinate(Ae,this.terrain)),V=O.map(Ae=>C.screenPointToMercatorCoordinate(Ae,this.terrain)),H=this.getIds(),K=1/0,ne=1/0,ie=-1/0,fe=-1/0;for(let Ae of V)K=Math.min(K,Ae.x),ne=Math.min(ne,Ae.y),ie=Math.max(ie,Ae.x),fe=Math.max(fe,Ae.y);for(let Ae=0;Ae<H.length;Ae++){let Ie=this._tiles[H[Ae]];if(Ie.holdingForFade())continue;let Se=Ie.tileID,Me=Math.pow(2,C.zoom-Ie.tileID.overscaledZ),ke=u*Ie.queryPadding*s.Z/Ie.tileSize/Me,Ve=[Se.getTilePoint(new s.$(K,ne)),Se.getTilePoint(new s.$(ie,fe))];if(Ve[0].x-ke<s.Z&&Ve[0].y-ke<s.Z&&Ve[1].x+ke>=0&&Ve[1].y+ke>=0){let Be=N.map(Ge=>Se.getTilePoint(Ge)),qe=V.map(Ge=>Se.getTilePoint(Ge));v.push({tile:Ie,tileID:Se,queryGeometry:Be,cameraQueryGeometry:qe,scale:Me})}}return v}getVisibleCoordinates(o){let u=this.getRenderableIds(o).map(_=>this._tiles[_].tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(ce(this._source.type)){let o=b.now();for(let u in this._tiles)if(this._tiles[u].fadeEndTime>=o)return!0}return!1}setFeatureState(o,u,_){this._state.updateState(o=o||"_geojsonTileLayer",u,_)}removeFeatureState(o,u,_){this._state.removeFeatureState(o=o||"_geojsonTileLayer",u,_)}getFeatureState(o,u){return this._state.getState(o=o||"_geojsonTileLayer",u)}setDependencies(o,u,_){let v=this._tiles[o];v&&v.setDependencies(u,_)}reloadTilesForDependencies(o,u){for(let _ in this._tiles)this._tiles[_].hasDependency(o,u)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(o,u))}}function ge(S,o){let u=Math.abs(2*S.wrap)-+(S.wrap<0),_=Math.abs(2*o.wrap)-+(o.wrap<0);return S.overscaledZ-o.overscaledZ||_-u||o.canonical.y-S.canonical.y||o.canonical.x-S.canonical.x}function ce(S){return S==="raster"||S==="image"||S==="video"}de.maxOverzooming=10,de.maxUnderzooming=3;class ze{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.ae(o,0,1);let u=1,_=this._distances[u],v=o*this.paddedLength+this.padding;for(;_<v&&u<this._distances.length;)_=this._distances[++u];let C=u-1,O=this._distances[C],N=_-O,V=N>0?(v-O)/N:0;return this.points[C].mult(1-V).add(this.points[u].mult(V))}}function Ye(S,o){let u=!0;return S==="always"||S!=="never"&&o!=="never"||(u=!1),u}class Ke{constructor(o,u,_){let v=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(o/_),this.yCellCount=Math.ceil(u/_);for(let O=0;O<this.xCellCount*this.yCellCount;O++)v.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,_,v,C){this._forEachCell(u,_,v,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(C)}insertCircle(o,u,_,v){this._forEachCell(u-v,_-v,u+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(_),this.circles.push(v)}_insertBoxCell(o,u,_,v,C,O){this.boxCells[C].push(O)}_insertCircleCell(o,u,_,v,C,O){this.circleCells[C].push(O)}_query(o,u,_,v,C,O,N){if(_<0||o>this.width||v<0||u>this.height)return[];let V=[];if(o<=0&&u<=0&&this.width<=_&&this.height<=v){if(C)return[{key:null,x1:o,y1:u,x2:_,y2:v}];for(let H=0;H<this.boxKeys.length;H++)V.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){let K=this.circles[3*H],ne=this.circles[3*H+1],ie=this.circles[3*H+2];V.push({key:this.circleKeys[H],x1:K-ie,y1:ne-ie,x2:K+ie,y2:ne+ie})}}else this._forEachCell(o,u,_,v,this._queryCell,V,{hitTest:C,overlapMode:O,seenUids:{box:{},circle:{}}},N);return V}query(o,u,_,v){return this._query(o,u,_,v,!1,null)}hitTest(o,u,_,v,C,O){return this._query(o,u,_,v,!0,C,O).length>0}hitTestCircle(o,u,_,v,C){let O=o-_,N=o+_,V=u-_,H=u+_;if(N<0||O>this.width||H<0||V>this.height)return!1;let K=[];return this._forEachCell(O,V,N,H,this._queryCellCircle,K,{hitTest:!0,overlapMode:v,circle:{x:o,y:u,radius:_},seenUids:{box:{},circle:{}}},C),K.length>0}_queryCell(o,u,_,v,C,O,N,V){let{seenUids:H,hitTest:K,overlapMode:ne}=N,ie=this.boxCells[C];if(ie!==null){let Ae=this.bboxes;for(let Ie of ie)if(!H.box[Ie]){H.box[Ie]=!0;let Se=4*Ie,Me=this.boxKeys[Ie];if(o<=Ae[Se+2]&&u<=Ae[Se+3]&&_>=Ae[Se+0]&&v>=Ae[Se+1]&&(!V||V(Me))&&(!K||!Ye(ne,Me.overlapMode))&&(O.push({key:Me,x1:Ae[Se],y1:Ae[Se+1],x2:Ae[Se+2],y2:Ae[Se+3]}),K))return!0}}let fe=this.circleCells[C];if(fe!==null){let Ae=this.circles;for(let Ie of fe)if(!H.circle[Ie]){H.circle[Ie]=!0;let Se=3*Ie,Me=this.circleKeys[Ie];if(this._circleAndRectCollide(Ae[Se],Ae[Se+1],Ae[Se+2],o,u,_,v)&&(!V||V(Me))&&(!K||!Ye(ne,Me.overlapMode))){let ke=Ae[Se],Ve=Ae[Se+1],Be=Ae[Se+2];if(O.push({key:Me,x1:ke-Be,y1:Ve-Be,x2:ke+Be,y2:Ve+Be}),K)return!0}}}return!1}_queryCellCircle(o,u,_,v,C,O,N,V){let{circle:H,seenUids:K,overlapMode:ne}=N,ie=this.boxCells[C];if(ie!==null){let Ae=this.bboxes;for(let Ie of ie)if(!K.box[Ie]){K.box[Ie]=!0;let Se=4*Ie,Me=this.boxKeys[Ie];if(this._circleAndRectCollide(H.x,H.y,H.radius,Ae[Se+0],Ae[Se+1],Ae[Se+2],Ae[Se+3])&&(!V||V(Me))&&!Ye(ne,Me.overlapMode))return O.push(!0),!0}}let fe=this.circleCells[C];if(fe!==null){let Ae=this.circles;for(let Ie of fe)if(!K.circle[Ie]){K.circle[Ie]=!0;let Se=3*Ie,Me=this.circleKeys[Ie];if(this._circlesCollide(Ae[Se],Ae[Se+1],Ae[Se+2],H.x,H.y,H.radius)&&(!V||V(Me))&&!Ye(ne,Me.overlapMode))return O.push(!0),!0}}}_forEachCell(o,u,_,v,C,O,N,V){let H=this._convertToXCellCoord(o),K=this._convertToYCellCoord(u),ne=this._convertToXCellCoord(_),ie=this._convertToYCellCoord(v);for(let fe=H;fe<=ne;fe++)for(let Ae=K;Ae<=ie;Ae++)if(C.call(this,o,u,_,v,this.xCellCount*Ae+fe,O,N,V))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,_,v,C,O){let N=v-o,V=C-u,H=_+O;return H*H>N*N+V*V}_circleAndRectCollide(o,u,_,v,C,O,N){let V=(O-v)/2,H=Math.abs(o-(v+V));if(H>V+_)return!1;let K=(N-C)/2,ne=Math.abs(u-(C+K));if(ne>K+_)return!1;if(H<=V||ne<=K)return!0;let ie=H-V,fe=ne-K;return ie*ie+fe*fe<=_*_}}function dt(S,o,u){let _=s.K();if(!S){let{vecSouth:ne,vecEast:ie}=Bt(o),fe=c();fe[0]=ie[0],fe[1]=ie[1],fe[2]=ne[0],fe[3]=ne[1],v=fe,(K=(O=(C=fe)[0])*(H=C[3])-(V=C[2])*(N=C[1]))&&(v[0]=H*(K=1/K),v[1]=-N*K,v[2]=-V*K,v[3]=O*K),_[0]=fe[0],_[1]=fe[1],_[4]=fe[2],_[5]=fe[3]}var v,C,O,N,V,H,K;return s.M(_,_,[1/u,1/u,1]),_}function it(S,o,u,_){if(S){let v=s.K();if(!o){let{vecSouth:C,vecEast:O}=Bt(u);v[0]=O[0],v[1]=O[1],v[4]=C[0],v[5]=C[1]}return s.M(v,v,[_,_,1]),v}return u.pixelsToClipSpaceMatrix}function Bt(S){let o=Math.cos(S.rollInRadians),u=Math.sin(S.rollInRadians),_=Math.cos(S.pitchInRadians),v=Math.cos(S.bearingInRadians),C=Math.sin(S.bearingInRadians),O=s.ak();O[0]=-v*_*u-C*o,O[1]=-C*_*u+v*o;let N=s.al(O);N<1e-9?s.am(O):s.an(O,O,1/N);let V=s.ak();V[0]=v*_*o-C*u,V[1]=C*_*o+v*u;let H=s.al(V);return H<1e-9?s.am(V):s.an(V,V,1/H),{vecEast:V,vecSouth:O}}function Pt(S,o,u,_){let v;_?(v=[S,o,_(S,o),1],s.ap(v,v,u)):(v=[S,o,0,1],Vn(v,v,u));let C=v[3];return{point:new s.P(v[0]/C,v[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}function ut(S,o){return .5+S/o*.5}function zt(S,o){return S.x>=-o[0]&&S.x<=o[0]&&S.y>=-o[1]&&S.y<=o[1]}function rr(S,o,u,_,v,C,O,N,V,H,K,ne,ie){let fe=u?S.textSizeData:S.iconSizeData,Ae=s.ag(fe,o.transform.zoom),Ie=[256/o.width*2+1,256/o.height*2+1],Se=u?S.text.dynamicLayoutVertexArray:S.icon.dynamicLayoutVertexArray;Se.clear();let Me=S.lineVertexArray,ke=u?S.text.placedSymbolArray:S.icon.placedSymbolArray,Ve=o.transform.width/o.transform.height,Be=!1;for(let qe=0;qe<ke.length;qe++){let Ge=ke.get(qe);if(Ge.hidden||Ge.writingMode===s.ah.vertical&&!Be){Pr(Ge.numGlyphs,Se);continue}Be=!1;let Ze=new s.P(Ge.anchorX,Ge.anchorY),_t={getElevation:ie,pitchedLabelPlaneMatrix:_,lineVertexArray:Me,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:o.transform,tileAnchorPoint:Ze,unwrappedTileID:V,width:H,height:K,translation:ne},At=dr(Ge.anchorX,Ge.anchorY,_t);if(!zt(At.point,Ie)){Pr(Ge.numGlyphs,Se);continue}let Mt=ut(o.transform.cameraToCenterDistance,At.signedDistanceFromCamera),Lt=s.ai(fe,Ae,Ge),Tt=C?Lt*o.transform.getPitchedTextCorrection(Ge.anchorX,Ge.anchorY,V)/Mt:Lt*Mt,er=Dr({projectionContext:_t,pitchedLabelPlaneMatrixInverse:v,symbol:Ge,fontSize:Tt,flip:!1,keepUpright:O,glyphOffsetArray:S.glyphOffsetArray,dynamicLayoutVertexArray:Se,aspectRatio:Ve,rotateToLine:N});Be=er.useVertical,(er.notEnoughRoom||Be||er.needsFlipping&&Dr({projectionContext:_t,pitchedLabelPlaneMatrixInverse:v,symbol:Ge,fontSize:Tt,flip:!0,keepUpright:O,glyphOffsetArray:S.glyphOffsetArray,dynamicLayoutVertexArray:Se,aspectRatio:Ve,rotateToLine:N}).notEnoughRoom)&&Pr(Ge.numGlyphs,Se)}u?S.text.dynamicLayoutVertexBuffer.updateData(Se):S.icon.dynamicLayoutVertexBuffer.updateData(Se)}function nr(S,o,u,_,v,C,O,N){let V=C.glyphStartIndex+C.numGlyphs,H=C.lineStartIndex,K=C.lineStartIndex+C.lineLength,ne=o.getoffsetX(C.glyphStartIndex),ie=o.getoffsetX(V-1),fe=mn(S*ne,u,_,v,C.segment,H,K,N,O);if(!fe)return null;let Ae=mn(S*ie,u,_,v,C.segment,H,K,N,O);return Ae?N.projectionCache.anyProjectionOccluded?null:{first:fe,last:Ae}:null}function We(S,o,u,_){return S===s.ah.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*_?{useVertical:!0}:(S===s.ah.vertical?o.y<u.y:o.x>u.x)?{needsFlipping:!0}:null}function Dr(S){let{projectionContext:o,pitchedLabelPlaneMatrixInverse:u,symbol:_,fontSize:v,flip:C,keepUpright:O,glyphOffsetArray:N,dynamicLayoutVertexArray:V,aspectRatio:H,rotateToLine:K}=S,ne=v/24,ie=_.lineOffsetX*ne,fe=_.lineOffsetY*ne,Ae;if(_.numGlyphs>1){let Ie=_.glyphStartIndex+_.numGlyphs,Se=_.lineStartIndex,Me=_.lineStartIndex+_.lineLength,ke=nr(ne,N,ie,fe,C,_,K,o);if(!ke)return{notEnoughRoom:!0};let Ve=Gt(ke.first.point.x,ke.first.point.y,o,u),Be=Gt(ke.last.point.x,ke.last.point.y,o,u);if(O&&!C){let qe=We(_.writingMode,Ve,Be,H);if(qe)return qe}Ae=[ke.first];for(let qe=_.glyphStartIndex+1;qe<Ie-1;qe++)Ae.push(mn(ne*N.getoffsetX(qe),ie,fe,C,_.segment,Se,Me,o,K));Ae.push(ke.last)}else{if(O&&!C){let Se=pi(o.tileAnchorPoint.x,o.tileAnchorPoint.y,o).point,Me=_.lineStartIndex+_.segment+1,ke=new s.P(o.lineVertexArray.getx(Me),o.lineVertexArray.gety(Me)),Ve=pi(ke.x,ke.y,o),Be=Ve.signedDistanceFromCamera>0?Ve.point:Er(o.tileAnchorPoint,ke,Se,1,o),qe=Gt(Se.x,Se.y,o,u),Ge=Gt(Be.x,Be.y,o,u),Ze=We(_.writingMode,qe,Ge,H);if(Ze)return Ze}let Ie=mn(ne*N.getoffsetX(_.glyphStartIndex),ie,fe,C,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,o,K);if(!Ie||o.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Ae=[Ie]}for(let Ie of Ae)s.ao(V,Ie.point,Ie.angle);return{}}function Er(S,o,u,_,v){let C=S.add(S.sub(o)._unit()),O=pi(C.x,C.y,v).point,N=u.sub(O);return u.add(N._mult(_/N.mag()))}function kr(S,o,u){let _=o.projectionCache;if(_.projections[S])return _.projections[S];let v=new s.P(o.lineVertexArray.getx(S),o.lineVertexArray.gety(S)),C=pi(v.x,v.y,o);if(C.signedDistanceFromCamera>0)return _.projections[S]=C.point,_.anyProjectionOccluded=_.anyProjectionOccluded||C.isOccluded,C.point;let O=S-u.direction;return Er(u.distanceFromAnchor===0?o.tileAnchorPoint:new s.P(o.lineVertexArray.getx(O),o.lineVertexArray.gety(O)),v,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,o)}function pi(S,o,u){let _=S+u.translation[0],v=o+u.translation[1],C;return u.pitchWithMap?(C=Pt(_,v,u.pitchedLabelPlaneMatrix,u.getElevation),C.isOccluded=!1):(C=u.transform.projectTileCoordinates(_,v,u.unwrappedTileID,u.getElevation),C.point.x=(.5*C.point.x+.5)*u.width,C.point.y=(.5*-C.point.y+.5)*u.height),C}function Gt(S,o,u,_){if(u.pitchWithMap){let v=[S,o,0,1];return s.ap(v,v,_),u.transform.projectTileCoordinates(v[0]/v[3],v[1]/v[3],u.unwrappedTileID,u.getElevation).point}return{x:S/u.width*2-1,y:o/u.height*2-1}}function dr(S,o,u){return u.transform.projectTileCoordinates(S,o,u.unwrappedTileID,u.getElevation)}function tr(S,o,u){return S._unit()._perp()._mult(o*u)}function zr(S,o,u,_,v,C,O,N,V){if(N.projectionCache.offsets[S])return N.projectionCache.offsets[S];let H=u.add(o);if(S+V.direction<_||S+V.direction>=v)return N.projectionCache.offsets[S]=H,H;let K=kr(S+V.direction,N,V),ne=tr(K.sub(u),O,V.direction),ie=u.add(ne),fe=K.add(ne);return N.projectionCache.offsets[S]=s.aq(C,H,ie,fe)||H,N.projectionCache.offsets[S]}function mn(S,o,u,_,v,C,O,N,V){let H=_?S-o:S+o,K=H>0?1:-1,ne=0;_&&(K*=-1,ne=Math.PI),K<0&&(ne+=Math.PI);let ie,fe=K>0?C+v:C+v+1;N.projectionCache.cachedAnchorPoint?ie=N.projectionCache.cachedAnchorPoint:(ie=pi(N.tileAnchorPoint.x,N.tileAnchorPoint.y,N).point,N.projectionCache.cachedAnchorPoint=ie);let Ae,Ie,Se=ie,Me=ie,ke=0,Ve=0,Be=Math.abs(H),qe=[],Ge;for(;ke+Ve<=Be;){if(fe+=K,fe<C||fe>=O)return null;ke+=Ve,Me=Se,Ie=Ae;let At={absOffsetX:Be,direction:K,distanceFromAnchor:ke,previousVertex:Me};if(Se=kr(fe,N,At),u===0)qe.push(Me),Ge=Se.sub(Me);else{let Mt,Lt=Se.sub(Me);Mt=Lt.mag()===0?tr(kr(fe+K,N,At).sub(Se),u,K):tr(Lt,u,K),Ie||(Ie=Me.add(Mt)),Ae=zr(fe,Mt,Se,C,O,Ie,u,N,At),qe.push(Ie),Ge=Ae.sub(Ie)}Ve=Ge.mag()}let Ze=Ge._mult((Be-ke)/Ve)._add(Ie||Me),_t=ne+Math.atan2(Se.y-Me.y,Se.x-Me.x);return qe.push(Ze),{point:Ze,angle:V?_t:0,path:qe}}let ta=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pr(S,o){for(let u=0;u<S;u++){let _=o.length;o.resize(_+4),o.float32.set(ta,3*_)}}function Vn(S,o,u){let _=o[0],v=o[1];return S[0]=u[0]*_+u[4]*v+u[12],S[1]=u[1]*_+u[5]*v+u[13],S[3]=u[3]*_+u[7]*v+u[15],S}let Ji=100;class Ru{constructor(o,u=new Ke(o.width+200,o.height+200,25),_=new Ke(o.width+200,o.height+200,25)){this.transform=o,this.grid=u,this.ignoredGrid=_,this.pitchFactor=Math.cos(o.pitch*Math.PI/180)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Ji,this.screenBottomBoundary=o.height+Ji,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,u,_,v,C,O,N,V,H,K,ne,ie){let fe=this.projectAndGetPerspectiveRatio(o.anchorPointX+V[0],o.anchorPointY+V[1],C,K,ie),Ae=_*fe.perspectiveRatio,Ie;if(O||N)Ie=this._projectCollisionBox(o,Ae,v,C,O,N,V,fe,K,ne,ie);else{let Ge=fe.x+(ne?ne.x*Ae:0),Ze=fe.y+(ne?ne.y*Ae:0);Ie={allPointsOccluded:!1,box:[Ge+o.x1*Ae,Ze+o.y1*Ae,Ge+o.x2*Ae,Ze+o.y2*Ae]}}let[Se,Me,ke,Ve]=Ie.box,Be=O?Ie.allPointsOccluded:fe.isOccluded,qe=Be;return qe||(qe=fe.perspectiveRatio<this.perspectiveRatioCutoff),qe||(qe=!this.isInsideGrid(Se,Me,ke,Ve)),qe||u!=="always"&&this.grid.hitTest(Se,Me,ke,Ve,u,H)?{box:[Se,Me,ke,Ve],placeable:!1,offscreen:!1,occluded:Be}:{box:[Se,Me,ke,Ve],placeable:!0,offscreen:this.isOffscreen(Se,Me,ke,Ve),occluded:Be}}placeCollisionCircles(o,u,_,v,C,O,N,V,H,K,ne,ie,fe,Ae){let Ie=[],Se=new s.P(u.anchorX,u.anchorY),Me=this.getPerspectiveRatio(Se.x,Se.y,O,Ae),ke=(H?C*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,O)/Me:C*Me)/s.av,Ve={getElevation:Ae,pitchedLabelPlaneMatrix:N,lineVertexArray:_,pitchWithMap:H,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Se,unwrappedTileID:O,width:this.transform.width,height:this.transform.height,translation:fe},Be=nr(ke,v,u.lineOffsetX*ke,u.lineOffsetY*ke,!1,u,!1,Ve),qe=!1,Ge=!1,Ze=!0;if(Be){let _t=.5*ne*Me+ie,At=new s.P(-100,-100),Mt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Lt=new ze,Tt=Be.first,er=Be.last,Kt=[];for(let Nt=Tt.path.length-1;Nt>=1;Nt--)Kt.push(Tt.path[Nt]);for(let Nt=1;Nt<er.path.length;Nt++)Kt.push(er.path[Nt]);let Ut=2.5*_t;if(H){let Nt=this.projectPathToScreenSpace(Kt,Ve);Kt=Nt.some(Ii=>Ii.signedDistanceFromCamera<=0)?[]:Nt.map(Ii=>Ii.point)}let mt=[];if(Kt.length>0){let Nt=Kt[0].clone(),Ii=Kt[0].clone();for(let Gr=1;Gr<Kt.length;Gr++)Nt.x=Math.min(Nt.x,Kt[Gr].x),Nt.y=Math.min(Nt.y,Kt[Gr].y),Ii.x=Math.max(Ii.x,Kt[Gr].x),Ii.y=Math.max(Ii.y,Kt[Gr].y);mt=Nt.x>=At.x&&Ii.x<=Mt.x&&Nt.y>=At.y&&Ii.y<=Mt.y?[Kt]:Ii.x<At.x||Nt.x>Mt.x||Ii.y<At.y||Nt.y>Mt.y?[]:s.ar([Kt],At.x,At.y,Mt.x,Mt.y)}for(let Nt of mt){Lt.reset(Nt,.25*_t);let Ii=0;Ii=Lt.length<=.5*_t?1:Math.ceil(Lt.paddedLength/Ut)+1;for(let Gr=0;Gr<Ii;Gr++){let ki=Gr/Math.max(Ii-1,1),Wi=Lt.lerp(ki),Fi=Wi.x+Ji,ji=Wi.y+Ji;Ie.push(Fi,ji,_t,0);let yi=Fi-_t,m=ji-_t,A=Fi+_t,x=ji+_t;if(Ze=Ze&&this.isOffscreen(yi,m,A,x),Ge=Ge||this.isInsideGrid(yi,m,A,x),o!=="always"&&this.grid.hitTestCircle(Fi,ji,_t,o,K)&&(qe=!0,!V))return{circles:[],offscreen:!1,collisionDetected:qe}}}}return{circles:!V&&qe||!Ge||Me<this.perspectiveRatioCutoff?[]:Ie,offscreen:Ze,collisionDetected:qe}}projectPathToScreenSpace(o,u){let _=function(v,C){let O=s.K();return s.aj(O,C.pitchedLabelPlaneMatrix),v.map(N=>{let V=Pt(N.x,N.y,O,C.getElevation),H=C.transform.projectTileCoordinates(V.point.x,V.point.y,C.unwrappedTileID,C.getElevation);return H.point.x=(.5*H.point.x+.5)*C.width,H.point.y=(.5*-H.point.y+.5)*C.height,H})}(o,u);return function(v){let C=0,O=0,N=0,V=0;for(let H=0;H<v.length;H++)v[H].isOccluded?(N=H+1,V=0):(V++,V>O&&(O=V,C=N));return v.slice(C,C+O)}(_)}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],_=1/0,v=1/0,C=-1/0,O=-1/0;for(let K of o){let ne=new s.P(K.x+Ji,K.y+Ji);_=Math.min(_,ne.x),v=Math.min(v,ne.y),C=Math.max(C,ne.x),O=Math.max(O,ne.y),u.push(ne)}let N=this.grid.query(_,v,C,O).concat(this.ignoredGrid.query(_,v,C,O)),V={},H={};for(let K of N){let ne=K.key;if(V[ne.bucketInstanceId]===void 0&&(V[ne.bucketInstanceId]={}),V[ne.bucketInstanceId][ne.featureIndex])continue;let ie=[new s.P(K.x1,K.y1),new s.P(K.x2,K.y1),new s.P(K.x2,K.y2),new s.P(K.x1,K.y2)];s.as(u,ie)&&(V[ne.bucketInstanceId][ne.featureIndex]=!0,H[ne.bucketInstanceId]===void 0&&(H[ne.bucketInstanceId]=[]),H[ne.bucketInstanceId].push(ne.featureIndex))}return H}insertCollisionBox(o,u,_,v,C,O){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:C,collisionGroupID:O,overlapMode:u},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,_,v,C,O){let N=_?this.ignoredGrid:this.grid,V={bucketInstanceId:v,featureIndex:C,collisionGroupID:O,overlapMode:u};for(let H=0;H<o.length;H+=4)N.insertCircle(V,o[H],o[H+1],o[H+2])}projectAndGetPerspectiveRatio(o,u,_,v,C){if(C){let O;v?(O=[o,u,v(o,u),1],s.ap(O,O,C)):(O=[o,u,0,1],Vn(O,O,C));let N=O[3];return{x:(O[0]/N+1)/2*this.transform.width+Ji,y:(-O[1]/N+1)/2*this.transform.height+Ji,perspectiveRatio:.5+this.transform.cameraToCenterDistance/N*.5,isOccluded:!1,signedDistanceFromCamera:N}}{let O=this.transform.projectTileCoordinates(o,u,_,v);return{x:(O.point.x+1)/2*this.transform.width+Ji,y:(1-O.point.y)/2*this.transform.height+Ji,perspectiveRatio:.5+this.transform.cameraToCenterDistance/O.signedDistanceFromCamera*.5,isOccluded:O.isOccluded,signedDistanceFromCamera:O.signedDistanceFromCamera}}}getPerspectiveRatio(o,u,_,v){let C=this.transform.projectTileCoordinates(o,u,_,v);return .5+this.transform.cameraToCenterDistance/C.signedDistanceFromCamera*.5}isOffscreen(o,u,_,v){return _<Ji||o>=this.screenRightBoundary||v<Ji||u>this.screenBottomBoundary}isInsideGrid(o,u,_,v){return _>=0&&o<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let o=s.at([]);return s.L(o,o,[-100,-100,0]),o}_projectCollisionBox(o,u,_,v,C,O,N,V,H,K,ne){let ie=1,fe=0,Ae=0,Ie=1,Se=o.anchorPointX+N[0],Me=o.anchorPointY+N[1];if(O&&!C){let Kt=this.projectAndGetPerspectiveRatio(Se+1,Me,v,H,ne),Ut=Kt.x-V.x,mt=Math.atan((Kt.y-V.y)/Ut)+(Ut<0?Math.PI:0),Nt=Math.sin(mt),Ii=Math.cos(mt);ie=Ii,fe=Nt,Ae=-Nt,Ie=Ii}else if(!O&&C){let Kt=Bt(this.transform);ie=Kt.vecEast[0],fe=Kt.vecEast[1],Ae=Kt.vecSouth[0],Ie=Kt.vecSouth[1]}let ke=V.x,Ve=V.y,Be=u;C&&(ke=Se,Ve=Me,Be=Math.pow(2,-(this.transform.zoom-_.overscaledZ)),Be*=this.transform.getPitchedTextCorrection(Se,Me,v),K||(Be*=s.ae(.5+V.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),K&&(ke+=ie*K.x*Be+Ae*K.y*Be,Ve+=fe*K.x*Be+Ie*K.y*Be);let qe=o.x1*Be,Ge=o.x2*Be,Ze=(qe+Ge)/2,_t=o.y1*Be,At=o.y2*Be,Mt=(_t+At)/2,Lt=[{offsetX:qe,offsetY:_t},{offsetX:Ze,offsetY:_t},{offsetX:Ge,offsetY:_t},{offsetX:Ge,offsetY:Mt},{offsetX:Ge,offsetY:At},{offsetX:Ze,offsetY:At},{offsetX:qe,offsetY:At},{offsetX:qe,offsetY:Mt}],Tt=[];for(let{offsetX:Kt,offsetY:Ut}of Lt)Tt.push(new s.P(ke+ie*Kt+Ae*Ut,Ve+fe*Kt+Ie*Ut));let er=!1;if(C){let Kt=Tt.map(Ut=>this.projectAndGetPerspectiveRatio(Ut.x,Ut.y,v,H,ne));er=Kt.some(Ut=>!Ut.isOccluded),Tt=Kt.map(Ut=>new s.P(Ut.x,Ut.y))}else er=!0;return{box:s.au(Tt),allPointsOccluded:!er}}}class Cl{constructor(o,u,_,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class St{constructor(o,u,_,v,C){this.text=new Cl(o?o.text:null,u,_,C),this.icon=new Cl(o?o.icon:null,u,v,C)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xr{constructor(o,u,_){this.text=o,this.icon=u,this.skipFade=_}}class ri{constructor(o,u,_,v,C){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=C}}class Fs{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:_=>_.collisionGroupID===u}}return this.collisionGroups[o]}}function jn(S,o,u,_,v){let{horizontalAlign:C,verticalAlign:O}=s.aB(S);return new s.P(-(C-.5)*o+_[0]*v,-(O-.5)*u+_[1]*v)}class po{constructor(o,u,_,v,C){this.transform=o.clone(),this.terrain=u,this.collisionIndex=new Ru(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Fs(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){let u=this.terrain;return u?(_,v)=>u.getElevation(o,_,v):null}getBucketParts(o,u,_,v){let C=_.getBucket(u),O=_.latestFeatureIndex;if(!C||!O||u.id!==C.layerIds[0])return;let N=_.collisionBoxArray,V=C.layers[0].layout,H=C.layers[0].paint,K=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),ne=_.tileSize/s.Z,ie=_.tileID.toUnwrapped(),fe=V.get("text-rotation-alignment")==="map",Ae=s.aw(_,1,this.transform.zoom),Ie=s.ax(this.collisionIndex.transform,_,H.get("text-translate"),H.get("text-translate-anchor")),Se=s.ax(this.collisionIndex.transform,_,H.get("icon-translate"),H.get("icon-translate-anchor")),Me=dt(fe,this.transform,Ae);this.retainedQueryData[C.bucketInstanceId]=new ri(C.bucketInstanceId,O,C.sourceLayerIndex,C.index,_.tileID);let ke={bucket:C,layout:V,translationText:Ie,translationIcon:Se,unwrappedTileID:ie,pitchedLabelPlaneMatrix:Me,scale:K,textPixelRatio:ne,holdingForFade:_.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:s.ag(C.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(v)for(let Ve of C.sortKeyRanges){let{sortKey:Be,symbolInstanceStart:qe,symbolInstanceEnd:Ge}=Ve;o.push({sortKey:Be,symbolInstanceStart:qe,symbolInstanceEnd:Ge,parameters:ke})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:ke})}attemptAnchorPlacement(o,u,_,v,C,O,N,V,H,K,ne,ie,fe,Ae,Ie,Se,Me,ke,Ve,Be){let qe=s.ay[o.textAnchor],Ge=[o.textOffset0,o.textOffset1],Ze=jn(qe,_,v,Ge,C),_t=this.collisionIndex.placeCollisionBox(u,ie,V,H,K,N,O,Se,ne.predicate,Ve,Ze,Be);if((!ke||this.collisionIndex.placeCollisionBox(ke,ie,V,H,K,N,O,Me,ne.predicate,Ve,Ze,Be).placeable)&&_t.placeable){let At;if(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(At=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[fe.crossTileID]={textOffset:Ge,width:_,height:v,anchor:qe,textBoxScale:C,prevAnchor:At},this.markUsedJustification(Ae,qe,fe,Ie),Ae.allowVerticalPlacement&&(this.markUsedOrientation(Ae,Ie,fe),this.placedOrientations[fe.crossTileID]=Ie),{shift:Ze,placedGlyphBoxes:_t}}}placeLayerBucketPart(o,u,_){let{bucket:v,layout:C,translationText:O,translationIcon:N,unwrappedTileID:V,pitchedLabelPlaneMatrix:H,textPixelRatio:K,holdingForFade:ne,collisionBoxArray:ie,partiallyEvaluatedTextSize:fe,collisionGroup:Ae}=o.parameters,Ie=C.get("text-optional"),Se=C.get("icon-optional"),Me=s.az(C,"text-overlap","text-allow-overlap"),ke=Me==="always",Ve=s.az(C,"icon-overlap","icon-allow-overlap"),Be=Ve==="always",qe=C.get("text-rotation-alignment")==="map",Ge=C.get("text-pitch-alignment")==="map",Ze=C.get("icon-text-fit")!=="none",_t=C.get("symbol-z-order")==="viewport-y",At=ke&&(Be||!v.hasIconData()||Se),Mt=Be&&(ke||!v.hasTextData()||Ie);!v.collisionArrays&&ie&&v.deserializeCollisionBoxes(ie);let Lt=this.retainedQueryData[v.bucketInstanceId].tileID,Tt=this._getTerrainElevationFunc(Lt),er=this.transform.getFastPathSimpleProjectionMatrix(Lt),Kt=(Ut,mt,Nt)=>{var Ii,Gr;if(u[Ut.crossTileID])return;if(ne)return void(this.placements[Ut.crossTileID]=new Xr(!1,!1,!1));let ki=!1,Wi=!1,Fi=!0,ji=null,yi={box:null,placeable:!1,offscreen:null,occluded:!1},m={placeable:!1},A=null,x=null,E=null,P=0,R=0,k=0;mt.textFeatureIndex?P=mt.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(P=Ut.featureIndex),mt.verticalTextFeatureIndex&&(R=mt.verticalTextFeatureIndex);let F=mt.textBox;if(F){let we=nt=>{let It=s.ah.horizontal;if(v.allowVerticalPlacement&&!nt&&this.prevPlacement){let wt=this.prevPlacement.placedOrientations[Ut.crossTileID];wt&&(this.placedOrientations[Ut.crossTileID]=wt,It=wt,this.markUsedOrientation(v,It,Ut))}return It},$e=(nt,It)=>{if(v.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(let wt of v.writingModes)if(wt===s.ah.vertical?(yi=It(),m=yi):yi=nt(),yi&&yi.placeable)break}else yi=nt()},Qe=Ut.textAnchorOffsetStartIndex,Ue=Ut.textAnchorOffsetEndIndex;if(Ue===Qe){let nt=(It,wt)=>{let at=this.collisionIndex.placeCollisionBox(It,Me,K,Lt,V,Ge,qe,O,Ae.predicate,Tt,void 0,er);return at&&at.placeable&&(this.markUsedOrientation(v,wt,Ut),this.placedOrientations[Ut.crossTileID]=wt),at};$e(()=>nt(F,s.ah.horizontal),()=>{let It=mt.verticalTextBox;return v.allowVerticalPlacement&&Ut.numVerticalGlyphVertices>0&&It?nt(It,s.ah.vertical):{box:null,offscreen:null}}),we(yi&&yi.placeable)}else{let nt=s.ay[(Gr=(Ii=this.prevPlacement)===null||Ii===void 0?void 0:Ii.variableOffsets[Ut.crossTileID])===null||Gr===void 0?void 0:Gr.anchor],It=(at,bt,ft)=>{let ar=at.x2-at.x1,mr=at.y2-at.y1,sr=Ut.textBoxScale,lr=Ze&&Ve==="never"?bt:null,di=null,ti=Me==="never"?1:2,ii="never";nt&&ti++;for(let Hr=0;Hr<ti;Hr++){for(let Ur=Qe;Ur<Ue;Ur++){let jr=v.textAnchorOffsets.get(Ur);if(nt&&jr.textAnchor!==nt)continue;let Ni=this.attemptAnchorPlacement(jr,at,ar,mr,sr,qe,Ge,K,Lt,V,Ae,ii,Ut,v,ft,O,N,lr,Tt);if(Ni&&(di=Ni.placedGlyphBoxes,di&&di.placeable))return ki=!0,ji=Ni.shift,di}nt?nt=null:ii=Me}return _&&!di&&(di={box:this.collisionIndex.placeCollisionBox(F,"always",K,Lt,V,Ge,qe,O,Ae.predicate,Tt,void 0,er).box,offscreen:!1,placeable:!1,occluded:!1}),di};$e(()=>It(F,mt.iconBox,s.ah.horizontal),()=>{let at=mt.verticalTextBox;return v.allowVerticalPlacement&&(!yi||!yi.placeable)&&Ut.numVerticalGlyphVertices>0&&at?It(at,mt.verticalIconBox,s.ah.vertical):{box:null,occluded:!0,offscreen:null}}),yi&&(ki=yi.placeable,Fi=yi.offscreen);let wt=we(yi&&yi.placeable);if(!ki&&this.prevPlacement){let at=this.prevPlacement.variableOffsets[Ut.crossTileID];at&&(this.variableOffsets[Ut.crossTileID]=at,this.markUsedJustification(v,at.anchor,Ut,wt))}}}if(A=yi,ki=A&&A.placeable,Fi=A&&A.offscreen,Ut.useRuntimeCollisionCircles){let we=v.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex),$e=s.ai(v.textSizeData,fe,we),Qe=C.get("text-padding");x=this.collisionIndex.placeCollisionCircles(Me,we,v.lineVertexArray,v.glyphOffsetArray,$e,V,H,_,Ge,Ae.predicate,Ut.collisionCircleDiameter,Qe,O,Tt),x.circles.length&&x.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),ki=ke||x.circles.length>0&&!x.collisionDetected,Fi=Fi&&x.offscreen}if(mt.iconFeatureIndex&&(k=mt.iconFeatureIndex),mt.iconBox){let we=$e=>this.collisionIndex.placeCollisionBox($e,Ve,K,Lt,V,Ge,qe,N,Ae.predicate,Tt,Ze&&ji?ji:void 0,er);m&&m.placeable&&mt.verticalIconBox?(E=we(mt.verticalIconBox),Wi=E.placeable):(E=we(mt.iconBox),Wi=E.placeable),Fi=Fi&&E.offscreen}let W=Ie||Ut.numHorizontalGlyphVertices===0&&Ut.numVerticalGlyphVertices===0,Q=Se||Ut.numIconVertices===0;W||Q?Q?W||(Wi=Wi&&ki):ki=Wi&&ki:Wi=ki=Wi&&ki;let he=Wi&&E.placeable;if(ki&&A.placeable&&this.collisionIndex.insertCollisionBox(A.box,Me,C.get("text-ignore-placement"),v.bucketInstanceId,m&&m.placeable&&R?R:P,Ae.ID),he&&this.collisionIndex.insertCollisionBox(E.box,Ve,C.get("icon-ignore-placement"),v.bucketInstanceId,k,Ae.ID),x&&ki&&this.collisionIndex.insertCollisionCircles(x.circles,Me,C.get("text-ignore-placement"),v.bucketInstanceId,P,Ae.ID),_&&this.storeCollisionData(v.bucketInstanceId,Nt,mt,A,E,x),Ut.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ut.crossTileID]=new Xr((ki||At)&&!A?.occluded,(Wi||Mt)&&!E?.occluded,Fi||v.justReloaded),u[Ut.crossTileID]=!0};if(_t){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ut=v.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let mt=Ut.length-1;mt>=0;--mt){let Nt=Ut[mt];Kt(v.symbolInstances.get(Nt),v.collisionArrays[Nt],Nt)}}else for(let Ut=o.symbolInstanceStart;Ut<o.symbolInstanceEnd;Ut++)Kt(v.symbolInstances.get(Ut),v.collisionArrays[Ut],Ut);v.justReloaded=!1}storeCollisionData(o,u,_,v,C,O){if(_.textBox||_.iconBox){let N,V;this.collisionBoxArrays.has(o)?N=this.collisionBoxArrays.get(o):(N=new Map,this.collisionBoxArrays.set(o,N)),N.has(u)?V=N.get(u):(V={text:null,icon:null},N.set(u,V)),_.textBox&&(V.text=v.box),_.iconBox&&(V.icon=C.box)}if(O){let N=this.collisionCircleArrays[o];N===void 0&&(N=this.collisionCircleArrays[o]=[]);for(let V=0;V<O.circles.length;V+=4)N.push(O.circles[V+0]-Ji),N.push(O.circles[V+1]-Ji),N.push(O.circles[V+2]),N.push(O.collisionDetected?1:0)}}markUsedJustification(o,u,_,v){let C;C=v===s.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.aA(u)];let O=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(let N of O)N>=0&&(o.text.placedSymbolArray.get(N).crossTileID=C>=0&&N!==C?0:_.crossTileID)}markUsedOrientation(o,u,_){let v=u===s.ah.horizontal||u===s.ah.horizontalOnly?u:0,C=u===s.ah.vertical?u:0,O=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(let N of O)o.text.placedSymbolArray.get(N).placedOrientation=v;_.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=C)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,_=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let v=u?u.symbolFadeChange(o):1,C=u?u.opacities:{},O=u?u.variableOffsets:{},N=u?u.placedOrientations:{};for(let V in this.placements){let H=this.placements[V],K=C[V];K?(this.opacities[V]=new St(K,v,H.text,H.icon),_=_||H.text!==K.text.placed||H.icon!==K.icon.placed):(this.opacities[V]=new St(null,v,H.text,H.icon,H.skipFade),_=_||H.text||H.icon)}for(let V in C){let H=C[V];if(!this.opacities[V]){let K=new St(H,v,!1,!1);K.isHidden()||(this.opacities[V]=K,_=_||H.text.placed||H.icon.placed)}}for(let V in O)this.variableOffsets[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.variableOffsets[V]=O[V]);for(let V in N)this.placedOrientations[V]||!this.opacities[V]||this.opacities[V].isHidden()||(this.placedOrientations[V]=N[V]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){let _={};for(let v of u){let C=v.getBucket(o);C&&v.latestFeatureIndex&&o.id===C.layerIds[0]&&this.updateBucketOpacities(C,v.tileID,_,v.collisionBoxArray)}}updateBucketOpacities(o,u,_,v){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let C=o.layers[0],O=C.layout,N=new St(null,0,!1,!1,!0),V=O.get("text-allow-overlap"),H=O.get("icon-allow-overlap"),K=C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ne=O.get("text-rotation-alignment")==="map",ie=O.get("text-pitch-alignment")==="map",fe=O.get("icon-text-fit")!=="none",Ae=new St(null,0,V&&(H||!o.hasIconData()||O.get("icon-optional")),H&&(V||!o.hasTextData()||O.get("text-optional")),!0);!o.collisionArrays&&v&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(v);let Ie=(Me,ke,Ve)=>{for(let Be=0;Be<ke/4;Be++)Me.opacityVertexArray.emplaceBack(Ve);Me.hasVisibleVertices=Me.hasVisibleVertices||Ve!==ba},Se=this.collisionBoxArrays.get(o.bucketInstanceId);for(let Me=0;Me<o.symbolInstances.length;Me++){let ke=o.symbolInstances.get(Me),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:Be,crossTileID:qe}=ke,Ge=this.opacities[qe];_[qe]?Ge=N:Ge||(Ge=Ae,this.opacities[qe]=Ge),_[qe]=!0;let Ze=ke.numIconVertices>0,_t=this.placedOrientations[ke.crossTileID],At=_t===s.ah.vertical,Mt=_t===s.ah.horizontal||_t===s.ah.horizontalOnly;if(Ve>0||Be>0){let Tt=Ad(Ge.text);Ie(o.text,Ve,At?ba:Tt),Ie(o.text,Be,Mt?ba:Tt);let er=Ge.text.isHidden();[ke.rightJustifiedTextSymbolIndex,ke.centerJustifiedTextSymbolIndex,ke.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(o.text.placedSymbolArray.get(mt).hidden=er||At?1:0)}),ke.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ke.verticalPlacedTextSymbolIndex).hidden=er||Mt?1:0);let Kt=this.variableOffsets[ke.crossTileID];Kt&&this.markUsedJustification(o,Kt.anchor,ke,_t);let Ut=this.placedOrientations[ke.crossTileID];Ut&&(this.markUsedJustification(o,"left",ke,Ut),this.markUsedOrientation(o,Ut,ke))}if(Ze){let Tt=Ad(Ge.icon),er=!(fe&&ke.verticalPlacedIconSymbolIndex&&At);ke.placedIconSymbolIndex>=0&&(Ie(o.icon,ke.numIconVertices,er?Tt:ba),o.icon.placedSymbolArray.get(ke.placedIconSymbolIndex).hidden=Ge.icon.isHidden()),ke.verticalPlacedIconSymbolIndex>=0&&(Ie(o.icon,ke.numVerticalIconVertices,er?ba:Tt),o.icon.placedSymbolArray.get(ke.verticalPlacedIconSymbolIndex).hidden=Ge.icon.isHidden())}let Lt=Se&&Se.has(Me)?Se.get(Me):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let Tt=o.collisionArrays[Me];if(Tt){let er=new s.P(0,0);if(Tt.textBox||Tt.verticalTextBox){let Kt=!0;if(K){let Ut=this.variableOffsets[qe];Ut?(er=jn(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale),ne&&er._rotate(ie?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Kt=!1}if(Tt.textBox||Tt.verticalTextBox){let Ut;Tt.textBox&&(Ut=At),Tt.verticalTextBox&&(Ut=Mt),Jn(o.textCollisionBox.collisionVertexArray,Ge.text.placed,!Kt||Ut,Lt.text,er.x,er.y)}}if(Tt.iconBox||Tt.verticalIconBox){let Kt=!!(!Mt&&Tt.verticalIconBox),Ut;Tt.iconBox&&(Ut=Kt),Tt.verticalIconBox&&(Ut=!Kt),Jn(o.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Ut,Lt.icon,fe?er.x:0,fe?er.y:0)}}}}if(o.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);o.bucketInstanceId in this.collisionCircleArrays&&(o.collisionCircleArray=this.collisionCircleArrays[o.bucketInstanceId],delete this.collisionCircleArrays[o.bucketInstanceId])}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){let _=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*_>o}setStale(){this.stale=!0}}function Jn(S,o,u,_,v,C){_&&_.length!==0||(_=[0,0,0,0]);let O=_[0]-Ji,N=_[1]-Ji,V=_[2]-Ji,H=_[3]-Ji;S.emplaceBack(o?1:0,u?1:0,v||0,C||0,O,N),S.emplaceBack(o?1:0,u?1:0,v||0,C||0,V,N),S.emplaceBack(o?1:0,u?1:0,v||0,C||0,V,H),S.emplaceBack(o?1:0,u?1:0,v||0,C||0,O,H)}let xi=Math.pow(2,25),Il=Math.pow(2,24),Xs=Math.pow(2,17),Bu=Math.pow(2,16),Ys=Math.pow(2,9),Lh=Math.pow(2,8),Tc=Math.pow(2,1);function Ad(S){if(S.opacity===0&&!S.placed)return 0;if(S.opacity===1&&S.placed)return 4294967295;let o=S.placed?1:0,u=Math.floor(127*S.opacity);return u*xi+o*Il+u*Xs+o*Bu+u*Ys+o*Lh+u*Tc+o}let ba=0;class Pl{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,_,v,C){let O=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(O,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((N,V)=>N.sortKey-V.sortKey));this._currentPartIndex<O.length;)if(u.placeLayerBucketPart(O[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,C())return!0;return!1}}class Gn{constructor(o,u,_,v,C,O,N,V){this.placement=new po(o,u,O,N,V),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(o,u,_){let v=b.now(),C=()=>!this._forceFullPlacement&&b.now()-v>2;for(;this._currentPlacementIndex>=0;){let O=u[o[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=N)&&(!O.maxzoom||O.maxzoom>N)){if(this._inProgressLayer||(this._inProgressLayer=new Pl(O)),this._inProgressLayer.continuePlacement(_[O.source],this.placement,this._showCollisionBoxes,O,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let Ec=512/s.Z/2;class hA{constructor(o,u,_){this.tileID=o,this.bucketInstanceId=_,this._symbolsByKey={};let v=new Map;for(let C=0;C<u.length;C++){let O=u.get(C),N=O.key,V=v.get(N);V?V.push(O):v.set(N,[O])}for(let[C,O]of v){let N={positions:O.map(V=>({x:Math.floor(V.anchorX*Ec),y:Math.floor(V.anchorY*Ec)})),crossTileIDs:O.map(V=>V.crossTileID)};if(N.positions.length>128){let V=new s.aC(N.positions.length,16,Uint16Array);for(let{x:H,y:K}of N.positions)V.add(H,K);V.finish(),delete N.positions,N.index=V}this._symbolsByKey[C]=N}}getScaledCoordinates(o,u){let{x:_,y:v,z:C}=this.tileID.canonical,{x:O,y:N,z:V}=u.canonical,H=Ec/Math.pow(2,V-C),K=(N*s.Z+o.anchorY)*H,ne=v*s.Z*Ec;return{x:Math.floor((O*s.Z+o.anchorX)*H-_*s.Z*Ec),y:Math.floor(K-ne)}}findMatches(o,u,_){let v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let C=0;C<o.length;C++){let O=o.get(C);if(O.crossTileID)continue;let N=this._symbolsByKey[O.key];if(!N)continue;let V=this.getScaledCoordinates(O,u);if(N.index){let H=N.index.range(V.x-v,V.y-v,V.x+v,V.y+v).sort();for(let K of H){let ne=N.crossTileIDs[K];if(!_[ne]){_[ne]=!0,O.crossTileID=ne;break}}}else if(N.positions)for(let H=0;H<N.positions.length;H++){let K=N.positions[H],ne=N.crossTileIDs[H];if(Math.abs(K.x-V.x)<=v&&Math.abs(K.y-V.y)<=v&&!_[ne]){_[ne]=!0,O.crossTileID=ne;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Fm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fA{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let u=Math.round((o-this.lng)/360);if(u!==0)for(let _ in this.indexes){let v=this.indexes[_],C={};for(let O in v){let N=v[O];N.tileID=N.tileID.unwrapTo(N.tileID.wrap+u),C[N.tileID.key]=N}this.indexes[_]=C}this.lng=o}addBucket(o,u,_){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let C=0;C<u.symbolInstances.length;C++)u.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});let v=this.usedCrossTileIDs[o.overscaledZ];for(let C in this.indexes){let O=this.indexes[C];if(Number(C)>o.overscaledZ)for(let N in O){let V=O[N];V.tileID.isChildOf(o)&&V.findMatches(u.symbolInstances,o,v)}else{let N=O[o.scaledTo(Number(C)).key];N&&N.findMatches(u.symbolInstances,o,v)}}for(let C=0;C<u.symbolInstances.length;C++){let O=u.symbolInstances.get(C);O.crossTileID||(O.crossTileID=_.generate(),v[O.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new hA(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(let _ of u.getCrossTileIDsLists())for(let v of _)delete this.usedCrossTileIDs[o][v]}removeStaleBuckets(o){let u=!1;for(let _ in this.indexes){let v=this.indexes[_];for(let C in v)o[v[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[C]),delete v[C],u=!0)}return u}}class md{constructor(){this.layerIndexes={},this.crossTileIDs=new Fm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,_){let v=this.layerIndexes[o.id];v===void 0&&(v=this.layerIndexes[o.id]=new fA);let C=!1,O={};v.handleWrapJump(_);for(let N of u){let V=N.getBucket(o);V&&o.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(N.tileID,V,this.crossTileIDs)&&(C=!0),O[V.bucketInstanceId]=!0)}return v.removeStaleBuckets(O)&&(C=!0),C}pruneUnusedLayers(o){let u={};o.forEach(_=>{u[_]=!0});for(let _ in this.layerIndexes)u[_]||delete this.layerIndexes[_]}}var Oh="void main() {fragColor=vec4(1.0);}";let ra={prelude:ci(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ci("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ci("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ci(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ci(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ci(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ci(Oh,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ci(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ci("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ci("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ci(Oh,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ci(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ci(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ci(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ci(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ci(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ci(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ci(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ci(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ci(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ci(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ci("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ci("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ci("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ci("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ci(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ci("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ci(S,o){let u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=o.match(/in ([\w]+) ([\w]+)/g),v=S.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=C?C.concat(v):v,N={};return{fragmentSource:S=S.replace(u,(V,H,K,ne,ie)=>(N[ie]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
in ${K} ${ne} ${ie};
#else
uniform ${K} ${ne} u_${ie};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ie}
    ${K} ${ne} ${ie} = u_${ie};
#endif
`)),vertexSource:o=o.replace(u,(V,H,K,ne,ie)=>{let fe=ne==="float"?"vec2":"vec4",Ae=ie.match(/color/)?"color":fe;return N[ie]?H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${K} ${fe} a_${ie};
out ${K} ${ne} ${ie};
#else
uniform ${K} ${ne} u_${ie};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = a_${ie};
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${ie} = unpack_mix_${Ae}(a_${ie}, u_${ie}_t);
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${ie}
uniform lowp float u_${ie}_t;
in ${K} ${fe} a_${ie};
#else
uniform ${K} ${ne} u_${ie};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ie}
    ${K} ${ne} ${ie} = a_${ie};
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ie}
    ${K} ${ne} ${ie} = unpack_mix_${Ae}(a_${ie}, u_${ie}_t);
#else
    ${K} ${ne} ${ie} = u_${ie};
#endif
`}),staticAttributes:_,staticUniforms:O}}class Sc{constructor(o,u,_){this.vertexBuffer=o,this.indexBuffer=u,this.segments=_}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ml=s.aD([{name:"a_pos",type:"Int16",components:2}]);let Za="#define PROJECTION_MERCATOR",Lu="mercator";class bi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Lu}get shaderDefine(){return Za}get shaderPreludeCode(){return ra.projectionMercator}get vertexShaderPreludeCode(){return ra.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aE.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(o){}getMeshFromTileID(o,u,_,v,C){if(this._cachedMesh)return this._cachedMesh;let O=new s.aF;O.emplaceBack(0,0),O.emplaceBack(s.Z,0),O.emplaceBack(0,s.Z),O.emplaceBack(s.Z,s.Z);let N=o.createVertexBuffer(O,Ml.members),V=s.aG.simpleSegment(0,0,4,2),H=new s.aH;H.emplaceBack(1,0,2),H.emplaceBack(1,2,3);let K=o.createIndexBuffer(H);return this._cachedMesh=new Sc(N,K,V),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(o){}}function zo(S,o){let u=s.ae(o.lat,-85.051129,s.aJ);return new s.P(s.U(o.lng)*S,s.S(u)*S)}function Dh(S,o){return new s.$(o.x/S,o.y/S).toLngLat()}function Ou(S){return S.cameraToCenterDistance*Math.min(.85*Math.tan(s.ad(90-S.pitch)),Math.tan(s.ad(89.25-S.pitch)))}function Ks(S,o){let u=S.canonical,_=o/s.aI(u.z),v=u.x+Math.pow(2,u.z)*S.wrap,C=s.at(new Float64Array(16));return s.L(C,C,[v*_,u.y*_,0]),s.M(C,C,[_/s.Z,_/s.Z,1]),C}function vs(S,o,u,_,v){let C=s.$.fromLngLat(S,o),O=v*s.aK(1,S.lat),N=O*Math.cos(s.ad(u)),V=Math.sqrt(O*O-N*N),H=V*Math.sin(s.ad(-_)),K=V*Math.cos(s.ad(-_));return new s.$(C.x+H,C.y+K,C.z+N)}class gn{constructor(o=0,u=0,_=0,v=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=_,this.right=v}interpolate(o,u,_){return u.top!=null&&o.top!=null&&(this.top=s.B.number(o.top,u.top,_)),u.bottom!=null&&o.bottom!=null&&(this.bottom=s.B.number(o.bottom,u.bottom,_)),u.left!=null&&o.left!=null&&(this.left=s.B.number(o.left,u.left,_)),u.right!=null&&o.right!=null&&(this.right=s.B.number(o.right,u.right,_)),this}getCenter(o,u){let _=s.ae((this.left+o-this.right)/2,0,o),v=s.ae((this.top+u-this.bottom)/2,0,u);return new s.P(_,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new gn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gd(S,o){if(!S.renderWorldCopies||S.lngRange)return;let u=o.lng-S.center.lng;o.lng+=u>180?-360:u<-180?360:0}function Qs(S){return Math.max(0,Math.floor(S))}class Ao{constructor(o,u,_,v,C,O){this._callbacks=o,this._tileSize=512,this._renderWorldCopies=O===void 0||!!O,this._minZoom=u||0,this._maxZoom=_||22,this._minPitch=v??0,this._maxPitch=C??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Qs(this._zoom),this._scale=s.aI(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new gn,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(o,u,_){this._latRange=o.latRange,this._lngRange=o.lngRange,this._width=o.width,this._height=o.height,this._center=o.center,this._elevation=o.elevation,this._minElevationForCurrentTile=o.minElevationForCurrentTile,this._zoom=o.zoom,this._tileZoom=Qs(this._zoom),this._scale=s.aI(this._zoom),this._bearingInRadians=o.bearingInRadians,this._fovInRadians=o.fovInRadians,this._pitchInRadians=o.pitchInRadians,this._rollInRadians=o.rollInRadians,this._unmodified=o.unmodified,this._edgeInsets=new gn(o.padding.top,o.padding.bottom,o.padding.left,o.padding.right),this._minZoom=o.minZoom,this._maxZoom=o.maxZoom,this._minPitch=o.minPitch,this._maxPitch=o.maxPitch,this._renderWorldCopies=o.renderWorldCopies,this._cameraToCenterDistance=o.cameraToCenterDistance,this._nearZ=o.nearZ,this._farZ=o.farZ,this._autoCalculateNearFarZ=!_&&o.autoCalculateNearFarZ,u&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(o){this._minElevationForCurrentTile=o}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(o){this._minZoom!==o&&(this._minZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(o){this._minPitch!==o&&(this._minPitch=o,this.setPitch(Math.max(this.pitch,o)))}get maxPitch(){return this._maxPitch}setMaxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.setPitch(Math.min(this.pitch,o)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(o){let u=s.aL(o,-180,180)*Math.PI/180;var _,v,C,O,N,V,H,K,ne;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=c(),_=this._rotationMatrix,C=-this._bearingInRadians,O=(v=this._rotationMatrix)[0],N=v[1],V=v[2],H=v[3],K=Math.sin(C),ne=Math.cos(C),_[0]=O*ne+V*K,_[1]=N*ne+H*K,_[2]=O*-K+V*ne,_[3]=N*-K+H*ne)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(o){let u=s.ae(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(o){let u=o/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aM(this._fovInRadians)}setFov(o){o=s.ae(o,.1,150),this.fov!==o&&(this._unmodified=!1,this._fovInRadians=s.ad(o),this._calcMatrices())}get zoom(){return this._zoom}setZoom(o){let u=this.getConstrained(this._center,o).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=s.aI(u),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(o,u){this._autoCalculateNearFarZ=!1,this._nearZ=o,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,_){this._unmodified=!1,this._edgeInsets.interpolate(o,u,_),this._constrain(),this._calcMatrices()}resize(o,u,_=!0){this._width=o,this._height=u,_&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new li([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(o){o?(this._lngRange=[o.getWest(),o.getEast()],this._latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,s.aJ])}getConstrained(o,u){return this._callbacks.getConstrained(o,u)}getCameraQueryGeometry(o,u){if(u.length===1)return[u[0],o];{let _=o.x,v=o.y,C=o.x,O=o.y;for(let N of u)_=Math.min(_,N.x),v=Math.min(v,N.y),C=Math.max(C,N.x),O=Math.max(O,N.y);return[new s.P(_,v),new s.P(C,v),new s.P(C,O),new s.P(_,O),new s.P(_,v)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let o=this._unmodified,{center:u,zoom:_}=this.getConstrained(this.center,this.zoom);this.setCenter(u),this.setZoom(_),this._unmodified=o,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let o=s.at(new Float64Array(16));s.M(o,o,[this._width/2,-this._height/2,1]),s.L(o,o,[1,-1,0]),this._clipSpaceToPixelsMatrix=o,o=s.at(new Float64Array(16)),s.M(o,o,[1,-1,1]),s.L(o,o,[-1,-1,0]),s.M(o,o,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=o,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(o,u,_,v){let C=_!==void 0?_:this.bearing,O=v=v!==void 0?v:this.pitch,N=s.$.fromLngLat(o,u),V=-Math.cos(s.ad(O)),H=Math.sin(s.ad(O)),K=H*Math.sin(s.ad(C)),ne=-H*Math.cos(s.ad(C)),ie=this.elevation,fe=u-ie,Ae;V*fe>=0||Math.abs(V)<.1?(Ae=1e4,ie=u+Ae*V):Ae=-fe/V;let Ie,Se,Me=s.aN(1,N.y),ke=0;do{if(ke+=1,ke>10)break;Se=Ae/Me,Ie=new s.$(N.x+K*Se,N.y+ne*Se),Me=1/Ie.meterInMercatorCoordinateUnits()}while(Math.abs(Ae-Se*Me)>1e-12);return{center:Ie.toLngLat(),elevation:ie,zoom:s.ab(this.height/2/Math.tan(this.fovInRadians/2)/Se/this.tileSize)}}recalculateZoomAndCenter(o){if(this.elevation-o==0)return;let u=s.aK(1,this.center.lat)*this.worldSize,_=this.cameraToCenterDistance/u,v=s.$.fromLngLat(this.center,this.elevation),C=vs(this.center,this.elevation,this.pitch,this.bearing,_);this._elevation=o;let O=this.calculateCenterFromCameraLngLatAlt(C.toLngLat(),s.aN(C.z,v.y),this.bearing,this.pitch);this._elevation=O.elevation,this._center=O.center,this.setZoom(O.zoom)}getCameraPoint(){let o=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(o*Math.sin(this.rollInRadians),o*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let o=s.aK(1,this.center.lat)*this.worldSize;return vs(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/o).toLngLat()}getMercatorTileCoordinates(o){if(!o)return[0,0,1,1];let u=o.canonical.z>=0?1<<o.canonical.z:Math.pow(2,o.canonical.z);return[o.canonical.x/u,o.canonical.y/u,1/u/s.Z,1/u/s.Z]}}class es{constructor(o,u){this.min=o,this.max=u,this.center=s.aO([],s.aP([],this.min,this.max),.5)}quadrant(o){let u=[o%2==0,o<2],_=s.aQ(this.min),v=s.aQ(this.max);for(let C=0;C<u.length;C++)_[C]=u[C]?this.min[C]:this.center[C],v[C]=u[C]?this.center[C]:this.max[C];return v[2]=this.max[2],new es(_,v)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersectsFrustum(o){let u=!0;for(let _=0;_<o.planes.length;_++){let v=this.intersectsPlane(o.planes[_]);if(v===0)return 0;v===1&&(u=!1)}return u?2:o.aabb.min[0]>this.max[0]||o.aabb.min[1]>this.max[1]||o.aabb.min[2]>this.max[2]||o.aabb.max[0]<this.min[0]||o.aabb.max[1]<this.min[1]||o.aabb.max[2]<this.min[2]?0:1}intersectsPlane(o){let u=o[3],_=o[3];for(let v=0;v<3;v++)o[v]>0?(u+=o[v]*this.min[v],_+=o[v]*this.max[v]):(_+=o[v]*this.min[v],u+=o[v]*this.max[v]);return u>=0?2:_<0?0:1}}class Nm{distanceToTile2d(o,u,_,v){let C=v.distanceX([o,u]),O=v.distanceY([o,u]);return Math.hypot(C,O)}getWrap(o,u,_){return _}getTileAABB(o,u,_,v){var C,O;let N=_,V=_;if(v.terrain){let K=new s.Y(o.z,u,o.z,o.x,o.y),ne=v.terrain.getMinMaxElevation(K);N=(C=ne.minElevation)!==null&&C!==void 0?C:_,V=(O=ne.maxElevation)!==null&&O!==void 0?O:_}let H=1<<o.z;return new es([u+o.x/H,o.y/H,N],[u+(o.x+1)/H,(o.y+1)/H,V])}allowVariableZoom(o,u){let _=o.fov*(Math.abs(Math.cos(o.rollInRadians))*o.height+Math.abs(Math.sin(o.rollInRadians))*o.width)/o.height,v=s.ae(78.5-_/2,0,60);return!!u.terrain||o.pitch>v}allowWorldCopies(){return!0}recalculateCache(){}}class Rl{constructor(o,u,_){this.points=o,this.planes=u,this.aabb=_}static fromInvProjectionMatrix(o,u=1,_=0){let v=Math.pow(2,_),C=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{let K=1/(H=s.ap([],H,o))[3]/u*v;return s.aR(H,H,[K,K,1/H[3],K])}),O=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{let K=s.aS([],C[H[0]],C[H[1]]),ne=s.aS([],C[H[2]],C[H[1]]),ie=s.aT([],s.aU([],K,ne)),fe=-s.aV(ie,C[H[1]]);return ie.concat(fe)}),N=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],V=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let H of C)for(let K=0;K<3;K++)N[K]=Math.min(N[K],H[K]),V[K]=Math.max(V[K],H[K]);return new Rl(C,O,new es(N,V))}}class _n{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,_){return this._helper.interpolatePadding(o,u,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,_=!0){this._helper.resize(o,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o,u){}constructor(o,u,_,v,C){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ao({calcMatrices:()=>{this._calcMatrices()},getConstrained:(O,N)=>this.getConstrained(O,N)},o,u,_,v,C),this._coveringTilesDetailsProvider=new Nm}clone(){let o=new _n;return o.apply(this),o}apply(o,u,_){this._helper.apply(o,u,_)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(o){let u=[new s.aW(0,o)];if(this._helper._renderWorldCopies){let _=this.screenPointToMercatorCoordinate(new s.P(0,0)),v=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),C=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),O=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),N=Math.floor(Math.min(_.x,v.x,C.x,O.x)),V=Math.floor(Math.max(_.x,v.x,C.x,O.x)),H=1;for(let K=N-H;K<=V+H;K++)K!==0&&u.push(new s.aW(K,o))}return u}getCameraFrustum(){return Rl.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){let u=this.screenPointToLocation(this.centerPoint,o),_=o?o.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(_)}setLocationAtPoint(o,u){let _=s.aK(this.elevation,this.center.lat),v=this.screenPointToMercatorCoordinateAtZ(u,_),C=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,_),O=s.$.fromLngLat(o),N=new s.$(O.x-(v.x-C.x),O.y-(v.y-C.y));this.setCenter(N?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(o,u){return u?this.coordinatePoint(s.$.fromLngLat(o),u.getElevationForLngLatZoom(o,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.$.fromLngLat(o))}screenPointToLocation(o,u){var _;return(_=this.screenPointToMercatorCoordinate(o,u))===null||_===void 0?void 0:_.toLngLat()}screenPointToMercatorCoordinate(o,u){if(u){let _=u.pointCoordinate(o);if(_!=null)return _}return this.screenPointToMercatorCoordinateAtZ(o)}screenPointToMercatorCoordinateAtZ(o,u){let _=u||0,v=[o.x,o.y,0,1],C=[o.x,o.y,1,1];s.ap(v,v,this._pixelMatrixInverse),s.ap(C,C,this._pixelMatrixInverse);let O=v[3],N=C[3],V=v[1]/O,H=C[1]/N,K=v[2]/O,ne=C[2]/N,ie=K===ne?0:(_-K)/(ne-K);return new s.$(s.B.number(v[0]/O,C[0]/N,ie)/this.worldSize,s.B.number(V,H,ie)/this.worldSize,_)}coordinatePoint(o,u=0,_=this._pixelMatrix){let v=[o.x*this.worldSize,o.y*this.worldSize,u,1];return s.ap(v,v,_),new s.P(v[0]/v[3],v[1]/v[3])}getBounds(){let o=Math.max(0,this._helper._height/2-Ou(this));return new li().extend(this.screenPointToLocation(new s.P(0,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,o))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(o,u){return u?u.pointCoordinate(o)!=null:o.y>this.height/2-Ou(this)}calculatePosMatrix(o,u=!1,_){var v;let C=(v=o.key)!==null&&v!==void 0?v:s.aX(o.wrap,o.canonical.z,o.canonical.z,o.canonical.x,o.canonical.y),O=u?this._alignedPosMatrixCache:this._posMatrixCache;if(O.has(C)){let H=O.get(C);return _?H.f32:H.f64}let N=Ks(o,this.worldSize);s.N(N,u?this._alignedProjMatrix:this._viewProjMatrix,N);let V={f64:N,f32:new Float32Array(N)};return O.set(C,V),_?V.f32:V.f64}calculateFogMatrix(o){let u=o.key,_=this._fogMatrixCacheF32;if(_.has(u))return _.get(u);let v=Ks(o,this.worldSize);return s.N(v,this._fogMatrix,v),_.set(u,new Float32Array(v)),_.get(u)}getConstrained(o,u){u=s.ae(+u,this.minZoom,this.maxZoom);let _={center:new s.Q(o.lng,o.lat),zoom:u},v=this._helper._lngRange;this._helper._renderWorldCopies||v!==null||(v=[-179.9999999999,180-1e-10]);let C=this.tileSize*s.aI(_.zoom),O=0,N=C,V=0,H=C,K=0,ne=0,{x:ie,y:fe}=this.size;if(this._helper._latRange){let Ve=this._helper._latRange;O=s.S(Ve[1])*C,N=s.S(Ve[0])*C,N-O<fe&&(K=fe/(N-O))}v&&(V=s.aL(s.U(v[0])*C,0,C),H=s.aL(s.U(v[1])*C,0,C),H<V&&(H+=C),H-V<ie&&(ne=ie/(H-V)));let{x:Ae,y:Ie}=zo(C,o),Se,Me,ke=Math.max(ne||0,K||0);if(ke){let Ve=new s.P(ne?(H+V)/2:Ae,K?(N+O)/2:Ie);return _.center=Dh(C,Ve).wrap(),_.zoom+=s.ab(ke),_}if(this._helper._latRange){let Ve=fe/2;Ie-Ve<O&&(Me=O+Ve),Ie+Ve>N&&(Me=N-Ve)}if(v){let Ve=(V+H)/2,Be=Ae;this._helper._renderWorldCopies&&(Be=s.aL(Ae,Ve-C/2,Ve+C/2));let qe=ie/2;Be-qe<V&&(Se=V+qe),Be+qe>H&&(Se=H-qe)}if(Se!==void 0||Me!==void 0){let Ve=new s.P(Se??Ae,Me??Ie);_.center=Dh(C,Ve).wrap()}return _}calculateCenterFromCameraLngLatAlt(o,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,_,v)}_calculateNearFarZIfNeeded(o,u,_){if(!this._helper.autoCalculateNearFarZ)return;let v=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),C=o-v*this._helper._pixelPerMeter/Math.cos(u),O=v<0?C:o,N=Math.PI/2+this.pitchInRadians,V=s.ad(this.fov)*(Math.abs(Math.cos(s.ad(this.roll)))*this.height+Math.abs(Math.sin(s.ad(this.roll)))*this.width)/this.height*(.5+_.y/this.height),H=Math.sin(V)*O/Math.sin(s.ae(Math.PI-N-V,.01,Math.PI-.01)),K=Ou(this),ne=Math.atan(K/this._helper.cameraToCenterDistance),ie=s.ad(.75),fe=ne>ie?2*ne*(.5+_.y/(2*K)):ie,Ae=Math.sin(fe)*O/Math.sin(s.ae(Math.PI-N-fe,.01,Math.PI-.01)),Ie=Math.min(H,Ae);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*Ie+O),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let o=this.centerOffset,u=zo(this.worldSize,this.center),_=u.x,v=u.y;this._helper._pixelPerMeter=s.aK(1,this.center.lat)*this.worldSize;let C=s.ad(Math.min(this.pitch,89.25)),O=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(C)),N;this._calculateNearFarZIfNeeded(O,C,o),N=new Float64Array(16),s.aY(N,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.aj(this._invProjMatrix,N),N[8]=2*-o.x/this._helper._width,N[9]=2*o.y/this._helper._height,this._projectionMatrix=s.aZ(N),s.M(N,N,[1,-1,1]),s.L(N,N,[0,0,-this._helper.cameraToCenterDistance]),s.a_(N,N,-this.rollInRadians),s.a$(N,N,this.pitchInRadians),s.a_(N,N,-this.bearingInRadians),s.L(N,N,[-_,-v,0]),this._mercatorMatrix=s.M([],N,[this.worldSize,this.worldSize,this.worldSize]),s.M(N,N,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,N),s.L(N,N,[0,0,-this.elevation]),this._viewProjMatrix=N,this._invViewProjMatrix=s.aj([],N);let V=[0,0,-1,1];s.ap(V,V,this._invViewProjMatrix),this._cameraPosition=[V[0]/V[3],V[1]/V[3],V[2]/V[3]],this._fogMatrix=new Float64Array(16),s.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,O,this._helper._farZ),this._fogMatrix[8]=2*-o.x/this.width,this._fogMatrix[9]=2*o.y/this.height,s.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.L(this._fogMatrix,this._fogMatrix,[-_,-v,0]),s.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,N);let H=this._helper._width%2/2,K=this._helper._height%2/2,ne=Math.cos(this.bearingInRadians),ie=Math.sin(-this.bearingInRadians),fe=_-Math.round(_)+ne*H+ie*K,Ae=v-Math.round(v)+ne*K+ie*H,Ie=new Float64Array(N);if(s.L(Ie,Ie,[fe>.5?fe-1:fe,Ae>.5?Ae-1:Ae,0]),this._alignedProjMatrix=Ie,N=s.aj(new Float64Array(16),this._pixelMatrix),!N)throw new Error("failed to invert matrix");this._pixelMatrixInverse=N,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let o=this.screenPointToMercatorCoordinate(new s.P(0,0)),u=[o.x*this.worldSize,o.y*this.worldSize,0,1];return s.ap(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let o=s.aK(1,this.center.lat)*this.worldSize;return vs(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/o).toLngLat()}lngLatToCameraDepth(o,u){let _=s.$.fromLngLat(o),v=[_.x*this.worldSize,_.y*this.worldSize,u,1];return s.ap(v,v,this._viewProjMatrix),v[2]/v[3]}getProjectionData(o){let{overscaledTileID:u,aligned:_,applyTerrainMatrix:v}=o,C=this._helper.getMercatorTileCoordinates(u),O=u?this.calculatePosMatrix(u,_,!0):null,N;return N=u&&u.terrainRttPosMatrix32f&&v?u.terrainRttPosMatrix32f:O||s.b0(),{mainMatrix:N,tileMercatorCoords:C,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:N}}isLocationOccluded(o){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(o,u,_){return 1}transformLightDirection(o){return s.aQ(o)}getRayDirectionFromPixel(o){throw new Error("Not implemented.")}projectTileCoordinates(o,u,_,v){let C=this.calculatePosMatrix(_),O;v?(O=[o,u,v(o,u),1],s.ap(O,O,C)):(O=[o,u,0,1],Vn(O,O,C));let N=O[3];return{point:new s.P(O[0]/N,O[1]/N),signedDistanceFromCamera:N,isOccluded:!1}}populateCache(o){for(let u of o)this.calculatePosMatrix(u)}getMatrixForModel(o,u){let _=s.$.fromLngLat(o,u),v=_.meterInMercatorCoordinateUnits(),C=s.b1();return s.L(C,C,[_.x,_.y,_.z]),s.a_(C,C,Math.PI),s.a$(C,C,Math.PI/2),s.M(C,C,[-v,v,v]),C}getProjectionDataForCustomLayer(o=!0){let u=new s.Y(0,0,0,0,0),_=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:o}),v=Ks(u,this.worldSize);s.N(v,this._viewProjMatrix,v),_.tileMercatorCoords=[0,0,1,1];let C=[s.Z,s.Z,this.worldSize/this._helper.pixelsPerMeter],O=s.b2();return s.M(O,v,C),_.fallbackMatrix=O,_.mainMatrix=O,_}getFastPathSimpleProjectionMatrix(o){return this.calculatePosMatrix(o)}}function Du(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Bl(S){if(S.useSlerp)if(S.k<1){let o=s.b3(S.startEulerAngles.roll,S.startEulerAngles.pitch,S.startEulerAngles.bearing),u=s.b3(S.endEulerAngles.roll,S.endEulerAngles.pitch,S.endEulerAngles.bearing),_=new Float64Array(4);s.b4(_,o,u,S.k);let v=s.b5(_);S.tr.setRoll(v.roll),S.tr.setPitch(v.pitch),S.tr.setBearing(v.bearing)}else S.tr.setRoll(S.endEulerAngles.roll),S.tr.setPitch(S.endEulerAngles.pitch),S.tr.setBearing(S.endEulerAngles.bearing);else S.tr.setRoll(s.B.number(S.startEulerAngles.roll,S.endEulerAngles.roll,S.k)),S.tr.setPitch(s.B.number(S.startEulerAngles.pitch,S.endEulerAngles.pitch,S.k)),S.tr.setBearing(s.B.number(S.startEulerAngles.bearing,S.endEulerAngles.bearing,S.k))}function kh(S,o,u,_,v){let C=v.padding,O=zo(v.worldSize,u.getNorthWest()),N=zo(v.worldSize,u.getNorthEast()),V=zo(v.worldSize,u.getSouthEast()),H=zo(v.worldSize,u.getSouthWest()),K=s.ad(-_),ne=O.rotate(K),ie=N.rotate(K),fe=V.rotate(K),Ae=H.rotate(K),Ie=new s.P(Math.max(ne.x,ie.x,Ae.x,fe.x),Math.max(ne.y,ie.y,Ae.y,fe.y)),Se=new s.P(Math.min(ne.x,ie.x,Ae.x,fe.x),Math.min(ne.y,ie.y,Ae.y,fe.y)),Me=Ie.sub(Se),ke=(v.width-(C.left+C.right+o.left+o.right))/Me.x,Ve=(v.height-(C.top+C.bottom+o.top+o.bottom))/Me.y;if(Ve<0||ke<0)return void Du();let Be=Math.min(s.ab(v.scale*Math.min(ke,Ve)),S.maxZoom),qe=s.P.convert(S.offset),Ge=new s.P((o.left-o.right)/2,(o.top-o.bottom)/2).rotate(s.ad(_)),Ze=qe.add(Ge).mult(v.scale/s.aI(Be));return{center:Dh(v.worldSize,O.add(V).div(2).sub(Ze)),zoom:Be,bearing:_}}class mo{get useGlobeControls(){return!1}handlePanInertia(o,u){return{easingOffset:o,easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(o,u){o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta),o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta)}handleMapControlsPan(o,u,_){o.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(_,o.around)}cameraForBoxAndBearing(o,u,_,v,C){return kh(o,u,_,v,C)}handleJumpToCenterZoom(o,u){o.zoom!==(u.zoom!==void 0?+u.zoom:o.zoom)&&o.setZoom(+u.zoom),u.center!==void 0&&o.setCenter(s.Q.convert(u.center))}handleEaseTo(o,u){let _=o.zoom,v=o.padding,C={roll:o.roll,pitch:o.pitch,bearing:o.bearing},O={roll:u.roll===void 0?o.roll:u.roll,pitch:u.pitch===void 0?o.pitch:u.pitch,bearing:u.bearing===void 0?o.bearing:u.bearing},N=u.zoom!==void 0,V=!o.isPaddingEqual(u.padding),H=!1,K=N?+u.zoom:o.zoom,ne=o.centerPoint.add(u.offsetAsPoint),ie=o.screenPointToLocation(ne),{center:fe,zoom:Ae}=o.getConstrained(s.Q.convert(u.center||ie),K??_);gd(o,fe);let Ie=zo(o.worldSize,ie),Se=zo(o.worldSize,fe).sub(Ie),Me=s.aI(Ae-_);return H=Ae!==_,{easeFunc:ke=>{if(H&&o.setZoom(s.B.number(_,Ae,ke)),s.b6(C,O)||Bl({startEulerAngles:C,endEulerAngles:O,tr:o,k:ke,useSlerp:C.roll!=O.roll}),V&&(o.interpolatePadding(v,u.padding,ke),ne=o.centerPoint.add(u.offsetAsPoint)),u.around)o.setLocationAtPoint(u.around,u.aroundPoint);else{let Ve=s.aI(o.zoom-_),Be=Ae>_?Math.min(2,Me):Math.max(.5,Me),qe=Math.pow(Be,1-ke),Ge=Dh(o.worldSize,Ie.add(Se.mult(ke*qe)).mult(Ve));o.setLocationAtPoint(o.renderWorldCopies?Ge.wrap():Ge,ne)}},isZooming:H,elevationCenter:fe}}handleFlyTo(o,u){let _=u.zoom!==void 0,v=o.zoom,C=o.getConstrained(s.Q.convert(u.center||u.locationAtOffset),_?+u.zoom:v),O=C.center,N=C.zoom;gd(o,O);let V=zo(o.worldSize,u.locationAtOffset),H=zo(o.worldSize,O).sub(V),K=H.mag(),ne=s.aI(N-v),ie;if(u.minZoom!==void 0){let fe=Math.min(+u.minZoom,v,N),Ae=o.getConstrained(O,fe).zoom;ie=s.aI(Ae-v)}return{easeFunc:(fe,Ae,Ie,Se)=>{o.setZoom(fe===1?N:v+s.ab(Ae));let Me=fe===1?O:Dh(o.worldSize,V.add(H.mult(Ie)).mult(Ae));o.setLocationAtPoint(o.renderWorldCopies?Me.wrap():Me,Se)},scaleOfZoom:ne,targetCenter:O,scaleOfMinZoom:ie,pixelPathLength:K}}}class fn{constructor(o,u,_){this.blendFunction=o,this.blendColor=u,this.mask=_}}fn.Replace=[1,0],fn.disabled=new fn(fn.Replace,s.b7.transparent,[!1,!1,!1,!1]),fn.unblended=new fn(fn.Replace,s.b7.transparent,[!0,!0,!0,!0]),fn.alphaBlended=new fn([1,771],s.b7.transparent,[!0,!0,!0,!0]);let va=2305;class Bi{constructor(o,u,_){this.enable=o,this.mode=u,this.frontFace=_}}Bi.disabled=new Bi(!1,1029,va),Bi.backCCW=new Bi(!0,1029,va),Bi.frontCCW=new Bi(!0,1028,va);class ei{constructor(o,u,_){this.func=o,this.mask=u,this.range=_}}ei.ReadOnly=!1,ei.ReadWrite=!0,ei.disabled=new ei(519,ei.ReadOnly,[0,1]);let ku=7680;class _i{constructor(o,u,_,v,C,O){this.test=o,this.ref=u,this.mask=_,this.fail=v,this.depthFail=C,this.pass=O}}_i.disabled=new _i({func:519,mask:0},0,0,ku,ku,ku);let Fu=new WeakMap;function ia(S){var o;if(Fu.has(S))return Fu.get(S);{let u=(o=S.getParameter(S.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return Fu.set(S,u),u}}class Fh{get awaitingQuery(){return!!this._readbackQueue}constructor(o){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=o;let u=o.context,_=u.gl;this._texFormat=_.RGBA,this._texType=_.UNSIGNED_BYTE;let v=new s.aF;v.emplaceBack(-1,-1),v.emplaceBack(2,-1),v.emplaceBack(-1,2);let C=new s.aH;C.emplaceBack(0,1,2),this._fullscreenTriangle=new Sc(u.createVertexBuffer(v,Ml.members),u.createIndexBuffer(C),s.aG.simpleSegment(0,0,v.length,C.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(_.TEXTURE1);let O=_.createTexture();_.bindTexture(_.TEXTURE_2D,O),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.NEAREST),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.NEAREST),_.texImage2D(_.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(O),ia(_)&&(this._pbo=_.createBuffer(),_.bindBuffer(_.PIXEL_PACK_BUFFER,this._pbo),_.bufferData(_.PIXEL_PACK_BUFFER,4,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null))}destroy(){let o=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),o.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(o,u){let _=this._updateCount;return this._readbackQueue?_>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():_>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(o,u),this._updateCount++,this._measuredError}_bindFramebuffer(){let o=this._cachedRenderContext.context,u=o.gl;o.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),o.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(o,u){let _=this._cachedRenderContext.context,v=_.gl;if(this._bindFramebuffer(),_.viewport.set([0,0,this._texWidth,this._texHeight]),_.clear({color:s.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(_,v.TRIANGLES,ei.disabled,_i.disabled,fn.unblended,Bi.disabled,((C,O)=>({u_input:C,u_output_expected:O}))(o,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ia(v)){v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.readBuffer(v.COLOR_ATTACHMENT0),v.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),v.bindBuffer(v.PIXEL_PACK_BUFFER,null);let C=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:C}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let o=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ia(o)){let u=o.clientWaitSync(this._readbackQueue.sync,0,0);if(u===o.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===o.TIMEOUT_EXPIRED)return;o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),o.bindBuffer(o.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),o.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Fh._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(o){let u=0;return u+=o[0]/256,u+=o[1]/65536,u+=o[2]/16777216,o[3]<127&&(u=-u),u/128}}let Nh=s.Z/128;function _d(S,o){let u=S.granularity!==void 0?Math.max(S.granularity,1):1,_=u+(S.generateBorders?2:0),v=u+(S.extendToNorthPole||S.generateBorders?1:0)+(S.extendToSouthPole||S.generateBorders?1:0),C=_+1,O=v+1,N=S.generateBorders?-1:0,V=S.generateBorders||S.extendToNorthPole?-1:0,H=u+(S.generateBorders?1:0),K=u+(S.generateBorders||S.extendToSouthPole?1:0),ne=C*O,ie=_*v*6,fe=C*O>65536;if(fe&&o==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let Ae=fe||o==="32bit",Ie=new Int16Array(2*ne),Se=0;for(let Ve=V;Ve<=K;Ve++)for(let Be=N;Be<=H;Be++){let qe=Be/u*s.Z;Be===-1&&(qe=-64),Be===u+1&&(qe=s.Z+Nh);let Ge=Ve/u*s.Z;Ve===-1&&(Ge=S.extendToNorthPole?s.b9:-64),Ve===u+1&&(Ge=S.extendToSouthPole?s.ba:s.Z+Nh),Ie[Se++]=qe,Ie[Se++]=Ge}let Me=Ae?new Uint32Array(ie):new Uint16Array(ie),ke=0;for(let Ve=0;Ve<v;Ve++)for(let Be=0;Be<_;Be++){let qe=Be+1+Ve*C,Ge=Be+(Ve+1)*C,Ze=Be+1+(Ve+1)*C;Me[ke++]=Be+Ve*C,Me[ke++]=Ge,Me[ke++]=qe,Me[ke++]=qe,Me[ke++]=Ge,Me[ke++]=Ze}return{vertices:Ie.buffer.slice(0),indices:Me.buffer.slice(0),uses32bitIndices:Ae}}let zh=new s.aE({fill:new s.bb(128,2),line:new s.bb(512,0),tile:new s.bb(128,32),stencil:new s.bb(128,1),circle:3});class Uh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ra.projectionGlobe}get vertexShaderPreludeCode(){return ra.projectionMercator.vertexSource}get subdivisionGranularity(){return zh}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(o){this._errorMeasurement||(this._errorMeasurement=new Fh(o));let u=s.S(this._errorQueryLatitudeDegrees),_=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,v=this._errorMeasurement.updateErrorLoop(u,_),C=b.now();v!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=v,this._errorMeasurementLastChangeTime=C);let O=Math.min(Math.max((C-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.bd(O))}_getMeshKey(o){return`${o.granularity.toString(36)}_${o.generateBorders?"b":""}${o.extendToNorthPole?"n":""}${o.extendToSouthPole?"s":""}`}getMeshFromTileID(o,u,_,v,C){let O=(C==="stencil"?zh.stencil:zh.tile).getGranularityForZoomLevel(u.z);return this._getMesh(o,{granularity:O,generateBorders:_,extendToNorthPole:u.y===0&&v,extendToSouthPole:u.y===(1<<u.z)-1&&v})}_getMesh(o,u){let _=this._getMeshKey(u);if(_ in this._tileMeshCache)return this._tileMeshCache[_];let v=function(C,O){let N=_d(O,"16bit"),V=s.aF.deserialize({arrayBuffer:N.vertices,length:N.vertices.byteLength/2/2}),H=s.aH.deserialize({arrayBuffer:N.indices,length:N.indices.byteLength/2/3});return new Sc(C.createVertexBuffer(V,Ml.members),C.createIndexBuffer(H),s.aG.simpleSegment(0,0,V.length,H.length))}(o,u);return this._tileMeshCache[_]=v,v}recalculate(o){}hasTransition(){let o=b.now(),u=!1;return u=u||(o-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(o){this._errorQueryLatitudeDegrees=o}}let yd=new s.r({type:new s.D(s.v.projection.type)});class Nu extends s.E{constructor(o){super(),this._transitionable=new s.T(yd),this.setProjection(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.C(0)),this._mercatorProjection=new bi,this._verticalPerspectiveProjection=new Uh}get transitionState(){let o=this.properties.get("type");if(typeof o=="string"&&o==="mercator")return 0;if(typeof o=="string"&&o==="vertical-perspective")return 1;if(o instanceof s.be){if(o.from==="vertical-perspective"&&o.to==="mercator")return 1-o.transition;if(o.from==="mercator"&&o.to==="vertical-perspective")return o.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(o){this._mercatorProjection.updateGPUdependent(o),this._verticalPerspectiveProjection.updateGPUdependent(o)}getMeshFromTileID(o,u,_,v,C){return this.currentProjection.getMeshFromTileID(o,u,_,v,C)}setProjection(o){this._transitionable.setValue("type",o?.type||"mercator")}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}setErrorQueryLatitudeDegrees(o){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(o),this._mercatorProjection.setErrorQueryLatitudeDegrees(o)}}function zm(S){let o=xd(S.worldSize,S.center.lat);return 2*Math.PI*o}function Cc(S,o,u,_,v){let C=1/(1<<v),O=o/s.Z*C+_*C,N=s.bg((S/s.Z*C+u*C)*Math.PI*2+Math.PI,2*Math.PI),V=2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI,H=Math.cos(V),K=new Float64Array(3);return K[0]=Math.sin(N)*H,K[1]=Math.sin(V),K[2]=Math.cos(N)*H,K}function ws(S){return function(o,u){let _=Math.cos(u),v=new Float64Array(3);return v[0]=Math.sin(o)*_,v[1]=Math.sin(u),v[2]=Math.cos(o)*_,v}(S.lng*Math.PI/180,S.lat*Math.PI/180)}function xd(S,o){return S/(2*Math.PI)/Math.cos(o*Math.PI/180)}function Um(S){let o=Math.asin(S[1])/Math.PI*180,u=Math.sqrt(S[0]*S[0]+S[2]*S[2]);if(u>1e-6){let _=S[0]/u,v=Math.acos(S[2]/u),C=(_>0?v:-v)/Math.PI*180;return new s.Q(s.aL(C,-180,180),o)}return new s.Q(0,o)}function Ns(S){return Math.cos(S*Math.PI/180)}function Hn(S,o){let u=Ns(S),_=Ns(o);return s.ab(_/u)}function na(S,o){let u=S.rotate(o.bearingInRadians),_=o.zoom+Hn(o.center.lat,0),v=s.bc(1/Ns(o.center.lat),1/Ns(Math.min(Math.abs(o.center.lat),60)),s.bf(_,7,3,0,1)),C=360/zm({worldSize:o.worldSize,center:{lat:o.center.lat}});return new s.Q(o.center.lng-u.x*C*v,s.ae(o.center.lat+u.y*C,-85.051129,s.aJ))}function zu(S){let o=.5*S,u=Math.sin(o),_=Math.cos(o);return Math.log(u+_)-Math.log(_-u)}function dA(S,o,u,_){let v=S.lat+u*_;if(Math.abs(u)>1){let C=(Math.sign(S.lat+u)!==Math.sign(S.lat)?-Math.abs(S.lat):Math.abs(S.lat))*Math.PI/180,O=Math.abs(S.lat+u)*Math.PI/180,N=zu(C+_*(O-C)),V=zu(C),H=zu(O);return new s.Q(S.lng+o*((N-V)/(H-V)),v)}return new s.Q(S.lng+o*_,v)}class Vm{constructor(o){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=o}recalculateCache(){if(!this._hadAnyChanges)return;let o=this._cachePrevious;this._cachePrevious=this._cache,this._cache=o,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(o,u,_,v){let C=`${o.z}_${o.x}_${o.y}`,O=this._cache.get(C);if(O)return O;let N=this._cachePrevious.get(C);if(N)return this._cache.set(C,N),N;let V=this._aabbFactory(o,u,_,v);return this._cache.set(C,V),this._hadAnyChanges=!0,V}}function Xa(S,o,u){let _=S-o;return _<0?-_:Math.max(0,_-u)}function pA(S,o,u,_,v){let C=S-u,O;return O=C<0?Math.min(-C,1+C-v):C>1?Math.min(Math.max(C-v,0),1-C):0,Math.max(O,Xa(o,_,v))}class AA{constructor(){this._aabbCache=new Vm(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(o,u,_,v){let C=1<<_.z,O=1/C,N=_.x/C,V=_.y/C,H=2;return H=Math.min(H,pA(o,u,N,V,O)),H=Math.min(H,pA(o,u,N+.5,-V-O,O)),H=Math.min(H,pA(o,u,N+.5,2-V-O,O)),H}getWrap(o,u,_){let v=1<<u.z,C=1/v,O=u.x/v,N=Xa(o.x,O,C),V=Xa(o.x,O-1,C),H=Xa(o.x,O+1,C),K=Math.min(N,V,H);return K===H?1:K===V?-1:0}allowVariableZoom(o,u){return Mn(o,u)>4}allowWorldCopies(){return!1}getTileAABB(o,u,_,v){return this._aabbCache.getTileAABB(o,u,_,v)}_computeTileAABB(o,u,_,v){if(o.z<=0)return new es([-1,-1,-1],[1,1,1]);if(o.z===1)return new es([o.x===0?-1:0,o.y===0?0:-1,-1],[o.x===0?0:1,o.y===0?1:0,1]);{let C=[Cc(0,0,o.x,o.y,o.z),Cc(s.Z,0,o.x,o.y,o.z),Cc(s.Z,s.Z,o.x,o.y,o.z),Cc(0,s.Z,o.x,o.y,o.z)],O=[1,1,1],N=[-1,-1,-1];for(let V of C)for(let H=0;H<3;H++)O[H]=Math.min(O[H],V[H]),N[H]=Math.max(N[H],V[H]);if(o.y===0||o.y===(1<<o.z)-1){let V=[0,o.y===0?1:-1,0];for(let H=0;H<3;H++)O[H]=Math.min(O[H],V[H]),N[H]=Math.max(N[H],V[H])}return new es(O,N)}}}class Vh{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,_){return this._helper.interpolatePadding(o,u,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u){this._helper.resize(o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o){}constructor(){this._cachedClippingPlane=s.bh(),this._projectionMatrix=s.b1(),this._globeViewProjMatrix32f=s.b0(),this._globeViewProjMatrixNoCorrection=s.b1(),this._globeViewProjMatrixNoCorrectionInverted=s.b1(),this._globeProjMatrixInverted=s.b1(),this._cameraPosition=s.bi(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ao({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,u)=>this.getConstrained(o,u)}),this._coveringTilesDetailsProvider=new AA}clone(){let o=new Vh;return o.apply(this),o}apply(o,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(o)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let o=s.bi();return o[0]=this._cameraPosition[0],o[1]=this._cameraPosition[1],o[2]=this._cameraPosition[2],o}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(o){let{overscaledTileID:u,applyGlobeMatrix:_}=o,v=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:v,clippingPlane:this._cachedClippingPlane,projectionTransition:_?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(o){let u=this.pitchInRadians,_=this.cameraToCenterDistance/o,v=Math.sin(u)*_,C=Math.cos(u)*_+1,O=1/Math.sqrt(v*v+C*C)*1,N=-v,V=C,H=Math.sqrt(N*N+V*V);N/=H,V/=H;let K=[0,N,V];return s.bj(K,K,[0,0,0],-this.bearingInRadians),s.bk(K,K,[0,0,0],-1*this.center.lat*Math.PI/180),s.bl(K,K,[0,0,0],this.center.lng*Math.PI/180),s.aO(K,K,.25),[...K,.25*-O]}isLocationOccluded(o){return!this.isSurfacePointVisible(ws(o))}transformLightDirection(o){let u=this._helper._center.lng*Math.PI/180,_=this._helper._center.lat*Math.PI/180,v=Math.cos(_),C=[Math.sin(u)*v,Math.sin(_),Math.cos(u)*v],O=[C[2],0,-C[0]],N=[0,0,0];s.aU(N,O,C),s.aT(O,O),s.aT(N,N);let V=[0,0,0];return s.aT(V,[O[0]*o[0]+N[0]*o[1]+C[0]*o[2],O[1]*o[0]+N[1]*o[1]+C[1]*o[2],O[2]*o[0]+N[2]*o[1]+C[2]*o[2]]),V}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(o,u,_){let v=function(N,V,H){let K=1/(1<<H.z);return new s.$(N/s.Z*K+H.x*K,V/s.Z*K+H.y*K)}(o,u,_.canonical),C=(O=v.y,[s.bg(v.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-O*Math.PI*2))-.5*Math.PI]);var O;return this.getCircleRadiusCorrection()/Math.cos(C[1])}projectTileCoordinates(o,u,_,v){let C=_.canonical,O=Cc(o,u,C.x,C.y,C.z),N=1+(v?v(o,u):0)/s.br,V=[O[0]*N,O[1]*N,O[2]*N,1];s.ap(V,V,this._globeViewProjMatrixNoCorrection);let H=this._cachedClippingPlane,K=H[0]*O[0]+H[1]*O[1]+H[2]*O[2]+H[3]<0;return{point:new s.P(V[0]/V[3],V[1]/V[3]),signedDistanceFromCamera:V[3],isOccluded:K}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let o=xd(this.worldSize,this.center.lat),u=s.b2(),_=s.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*o),s.aY(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let v=this.centerOffset;u[8]=2*-v.x/this._helper._width,u[9]=2*v.y/this._helper._height,this._projectionMatrix=s.aZ(u),this._globeProjMatrixInverted=s.b2(),s.aj(this._globeProjMatrixInverted,u),s.L(u,u,[0,0,-this.cameraToCenterDistance]),s.a_(u,u,this.rollInRadians),s.a$(u,u,-this.pitchInRadians),s.a_(u,u,this.bearingInRadians),s.L(u,u,[0,0,-o]);let C=s.bi();C[0]=o,C[1]=o,C[2]=o,s.a$(_,u,this.center.lat*Math.PI/180),s.bm(_,_,-this.center.lng*Math.PI/180),s.M(_,_,C),this._globeViewProjMatrixNoCorrection=_,s.a$(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bm(u,u,-this.center.lng*Math.PI/180),s.M(u,u,C),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=s.b2(),s.aj(this._globeViewProjMatrixNoCorrectionInverted,_);let O=s.bi();this._cameraPosition=s.bi(),this._cameraPosition[2]=this.cameraToCenterDistance/o,s.bj(this._cameraPosition,this._cameraPosition,O,-this.rollInRadians),s.bk(this._cameraPosition,this._cameraPosition,O,this.pitchInRadians),s.bj(this._cameraPosition,this._cameraPosition,O,-this.bearingInRadians),s.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bk(this._cameraPosition,this._cameraPosition,O,-this.center.lat*Math.PI/180),s.bl(this._cameraPosition,this._cameraPosition,O,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(o);let N=s.aZ(this._globeViewProjMatrixNoCorrectionInverted);s.M(N,N,[1,1,-1]),this._cachedFrustum=Rl.fromInvProjectionMatrix(N)}calculateFogMatrix(o){s.w("calculateFogMatrix is not supported on globe projection.");let u=s.b2();return s.at(u),u}getVisibleUnwrappedCoordinates(o){return[new s.aW(0,o)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){o&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){if(!this._globeViewProjMatrixNoCorrection)return 1;let _=ws(o);s.aO(_,_,1+u/s.br);let v=s.bh();return s.ap(v,[_[0],_[1],_[2],1],this._globeViewProjMatrixNoCorrection),v[2]/v[3]}populateCache(o){}getBounds(){let o=.5*this.width,u=.5*this.height,_=[new s.P(0,0),new s.P(o,0),new s.P(this.width,0),new s.P(this.width,u),new s.P(this.width,this.height),new s.P(o,this.height),new s.P(0,this.height),new s.P(0,u)],v=[];for(let ne of _)v.push(this.unprojectScreenPoint(ne));let C=0,O=0,N=0,V=0,H=this.center;for(let ne of v){let ie=s.bn(H.lng,ne.lng),fe=s.bn(H.lat,ne.lat);ie<O&&(O=ie),ie>C&&(C=ie),fe<V&&(V=fe),fe>N&&(N=fe)}let K=[H.lng+O,H.lat+V,H.lng+C,H.lat+N];return this.isSurfacePointOnScreen([0,1,0])&&(K[3]=90,K[0]=-180,K[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(K[1]=-90,K[0]=-180,K[2]=180),new li(K)}getConstrained(o,u){let _=s.ae(o.lat,-85.051129,s.aJ),v=s.ae(+u,this.minZoom+Hn(0,_),this.maxZoom);return{center:new s.Q(o.lng,_),zoom:v}}calculateCenterFromCameraLngLatAlt(o,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,_,v)}setLocationAtPoint(o,u){let _=ws(this.unprojectScreenPoint(u)),v=ws(o),C=s.bi();s.bo(C);let O=s.bi();s.bl(O,_,C,-this.center.lng*Math.PI/180),s.bk(O,O,C,this.center.lat*Math.PI/180);let N=v[0]*v[0]+v[2]*v[2],V=O[0]*O[0];if(N<V)return;let H=Math.sqrt(N-V),K=-H,ne=s.bp(v[0],v[2],O[0],H),ie=s.bp(v[0],v[2],O[0],K),fe=s.bi();s.bl(fe,v,C,-ne);let Ae=s.bp(fe[1],fe[2],O[1],O[2]),Ie=s.bi();s.bl(Ie,v,C,-ie);let Se=s.bp(Ie[1],Ie[2],O[1],O[2]),Me=.5*Math.PI,ke=Ae>=-Me&&Ae<=Me,Ve=Se>=-Me&&Se<=Me,Be,qe;if(ke&&Ve){let At=this.center.lng*Math.PI/180,Mt=this.center.lat*Math.PI/180;s.bs(ne,At)+s.bs(Ae,Mt)<s.bs(ie,At)+s.bs(Se,Mt)?(Be=ne,qe=Ae):(Be=ie,qe=Se)}else if(ke)Be=ne,qe=Ae;else{if(!Ve)return;Be=ie,qe=Se}let Ge=Be/Math.PI*180,Ze=qe/Math.PI*180,_t=this.center.lat;this.setCenter(new s.Q(Ge,s.ae(Ze,-90,90))),this.setZoom(this.zoom+Hn(_t,this.center.lat))}locationToScreenPoint(o,u){let _=ws(o);if(u){let v=u.getElevationForLngLatZoom(o,this._helper._tileZoom);s.aO(_,_,1+v/s.br)}return this._projectSurfacePointToScreen(_)}_projectSurfacePointToScreen(o){let u=s.bh();return s.ap(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new s.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(o,u){if(u){let _=u.pointCoordinate(o);if(_)return _}return s.$.fromLngLat(this.unprojectScreenPoint(o))}screenPointToLocation(o,u){var _;return(_=this.screenPointToMercatorCoordinate(o,u))===null||_===void 0?void 0:_.toLngLat()}isPointOnMapSurface(o,u){let _=this._cameraPosition,v=this.getRayDirectionFromPixel(o);return!!this.rayPlanetIntersection(_,v)}getRayDirectionFromPixel(o){let u=s.bh();u[0]=o.x/this.width*2-1,u[1]=-1*(o.y/this.height*2-1),u[2]=1,u[3]=1,s.ap(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];let _=s.bi();_[0]=u[0]-this._cameraPosition[0],_[1]=u[1]-this._cameraPosition[1],_[2]=u[2]-this._cameraPosition[2];let v=s.bi();return s.aT(v,_),v}isSurfacePointVisible(o){let u=this._cachedClippingPlane;return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]+u[3]>=0}isSurfacePointOnScreen(o){if(!this.isSurfacePointVisible(o))return!1;let u=s.bh();return s.ap(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(o,u){let _=s.aV(o,u),v=s.bi(),C=s.bi();s.aO(C,u,_),s.aS(v,o,C);let O=1-s.aV(v,v);if(O<0)return null;let N=s.aV(o,o)-1,V=-_+(_<0?1:-1)*Math.sqrt(O),H=N/V,K=V;return{tMin:Math.min(H,K),tMax:Math.max(H,K)}}unprojectScreenPoint(o){let u=this._cameraPosition,_=this.getRayDirectionFromPixel(o),v=this.rayPlanetIntersection(u,_);if(v){let H=s.bi();s.aP(H,u,[_[0]*v.tMin,_[1]*v.tMin,_[2]*v.tMin]);let K=s.bi();return s.aT(K,H),Um(K)}let C=this._cachedClippingPlane[0]*_[0]+this._cachedClippingPlane[1]*_[1]+this._cachedClippingPlane[2]*_[2],O=-s.bq(this._cachedClippingPlane,u)/C,N=s.bi();if(O>0)s.aP(N,u,[_[0]*O,_[1]*O,_[2]*O]);else{let H=s.bi();s.aP(H,u,[2*_[0],2*_[1],2*_[2]]);let K=s.bq(this._cachedClippingPlane,H);s.aS(N,H,[this._cachedClippingPlane[0]*K,this._cachedClippingPlane[1]*K,this._cachedClippingPlane[2]*K])}let V=s.bi();return s.aT(V,N),Um(V)}getMatrixForModel(o,u){let _=s.Q.convert(o),v=1/s.br,C=s.b1();return s.bm(C,C,_.lng/180*Math.PI),s.a$(C,C,-_.lat/180*Math.PI),s.L(C,C,[0,0,1+u/s.br]),s.a$(C,C,.5*Math.PI),s.M(C,C,[v,v,v]),C}getProjectionDataForCustomLayer(o=!0){let u=this.getProjectionData({overscaledTileID:new s.Y(0,0,0,0,0),applyGlobeMatrix:o});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(o){}}class jh{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,_){return this._helper.interpolatePadding(o,u,_)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,_=!0){this._helper.resize(o,u,_)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(o,u){this._globeness=o,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ao({calcMatrices:()=>{this._calcMatrices()},getConstrained:(o,u)=>this.getConstrained(o,u)}),this._globeness=1,this._mercatorTransform=new _n,this._verticalPerspectiveTransform=new Vh}clone(){let o=new jh;return o._globeness=this._globeness,o._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,o.apply(this),o}apply(o){this._helper.apply(o),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(o){let u=this._mercatorTransform.getProjectionData(o),_=this._verticalPerspectiveTransform.getProjectionData(o);return{mainMatrix:this.isGlobeRendering?_.mainMatrix:u.mainMatrix,clippingPlane:_.clippingPlane,tileMercatorCoords:_.tileMercatorCoords,projectionTransition:o.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(o){return this.currentTransform.isLocationOccluded(o)}transformLightDirection(o){return this.currentTransform.transformLightDirection(o)}getPixelScale(){return s.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(o,u,_){let v=this._mercatorTransform.getPitchedTextCorrection(o,u,_),C=this._verticalPerspectiveTransform.getPitchedTextCorrection(o,u,_);return s.bc(v,C,this._globeness)}projectTileCoordinates(o,u,_,v){return this.currentTransform.projectTileCoordinates(o,u,_,v)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(o){return this.currentTransform.calculateFogMatrix(o)}getVisibleUnwrappedCoordinates(o){return this.currentTransform.getVisibleUnwrappedCoordinates(o)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(o){this._mercatorTransform.recalculateZoomAndCenter(o),this._verticalPerspectiveTransform.recalculateZoomAndCenter(o)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){return this.currentTransform.lngLatToCameraDepth(o,u)}populateCache(o){this._mercatorTransform.populateCache(o),this._verticalPerspectiveTransform.populateCache(o)}getBounds(){return this.currentTransform.getBounds()}getConstrained(o,u){return this.currentTransform.getConstrained(o,u)}calculateCenterFromCameraLngLatAlt(o,u,_,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,_,v)}setLocationAtPoint(o,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(o,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(o,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(o,u){return this.currentTransform.locationToScreenPoint(o,u)}screenPointToMercatorCoordinate(o,u){return this.currentTransform.screenPointToMercatorCoordinate(o,u)}screenPointToLocation(o,u){return this.currentTransform.screenPointToLocation(o,u)}isPointOnMapSurface(o,u){return this.currentTransform.isPointOnMapSurface(o,u)}getRayDirectionFromPixel(o){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(o)}getMatrixForModel(o,u){return this.currentTransform.getMatrixForModel(o,u)}getProjectionDataForCustomLayer(o=!0){let u=this._mercatorTransform.getProjectionDataForCustomLayer(o);if(!this.isGlobeRendering)return u;let _=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(o);return _.fallbackMatrix=u.mainMatrix,_}getFastPathSimpleProjectionMatrix(o){return this.currentTransform.getFastPathSimpleProjectionMatrix(o)}}class go{get useGlobeControls(){return!0}handlePanInertia(o,u){let _=na(o,u);return Math.abs(_.lng-u.center.lng)>180&&(_.lng=u.center.lng+179.5*Math.sign(_.lng-u.center.lng)),{easingCenter:_,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(o,u){let _=o.around,v=u.screenPointToLocation(_);o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta);let C=u.zoom;o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta);let O=u.zoom-C;if(O===0)return;let N=s.bn(u.center.lng,v.lng),V=N/(Math.abs(N/180)+1),H=s.bn(u.center.lat,v.lat),K=u.getRayDirectionFromPixel(_),ne=u.cameraPosition,ie=-1*s.aV(ne,K),fe=s.bi();s.aP(fe,ne,[K[0]*ie,K[1]*ie,K[2]*ie]);let Ae=s.bt(fe)-1,Ie=Math.exp(.5*-Math.max(Ae-.3,0)),Se=xd(u.worldSize,u.center.lat)/Math.min(u.width,u.height),Me=s.bf(Se,.9,.5,1,.25),ke=(1-s.aI(-O))*Math.min(Ie,Me),Ve=u.center.lat,Be=u.zoom,qe=new s.Q(u.center.lng+V*ke,s.ae(u.center.lat+H*ke,-85.051129,s.aJ));u.setLocationAtPoint(v,_);let Ge=u.center,Ze=s.bf(Math.abs(N),45,85,0,1),_t=s.bf(Se,.75,.35,0,1),At=Math.pow(Math.max(Ze,_t),.25),Mt=s.bn(Ge.lng,qe.lng),Lt=s.bn(Ge.lat,qe.lat);u.setCenter(new s.Q(Ge.lng+Mt*At,Ge.lat+Lt*At).wrap()),u.setZoom(Be+Hn(Ve,u.center.lat))}handleMapControlsPan(o,u,_){if(!o.panDelta)return;let v=u.center.lat,C=u.zoom;u.setCenter(na(o.panDelta,u).wrap()),u.setZoom(C+Hn(v,u.center.lat))}cameraForBoxAndBearing(o,u,_,v,C){let O=kh(o,u,_,v,C),N=u.left/C.width*2-1,V=(C.width-u.right)/C.width*2-1,H=u.top/C.height*-2+1,K=(C.height-u.bottom)/C.height*-2+1,ne=s.bn(_.getWest(),_.getEast())<0,ie=ne?_.getEast():_.getWest(),fe=ne?_.getWest():_.getEast(),Ae=Math.max(_.getNorth(),_.getSouth()),Ie=Math.min(_.getNorth(),_.getSouth()),Se=ie+.5*s.bn(ie,fe),Me=Ae+.5*s.bn(Ae,Ie),ke=C.clone();ke.setCenter(O.center),ke.setBearing(O.bearing),ke.setPitch(0),ke.setRoll(0),ke.setZoom(O.zoom);let Ve=ke.modelViewProjectionMatrix,Be=[ws(_.getNorthWest()),ws(_.getNorthEast()),ws(_.getSouthWest()),ws(_.getSouthEast()),ws(new s.Q(fe,Me)),ws(new s.Q(ie,Me)),ws(new s.Q(Se,Ae)),ws(new s.Q(Se,Ie))],qe=ws(O.center),Ge=Number.POSITIVE_INFINITY;for(let Ze of Be)N<0&&(Ge=go.getLesserNonNegativeNonNull(Ge,go.solveVectorScale(Ze,qe,Ve,"x",N))),V>0&&(Ge=go.getLesserNonNegativeNonNull(Ge,go.solveVectorScale(Ze,qe,Ve,"x",V))),H>0&&(Ge=go.getLesserNonNegativeNonNull(Ge,go.solveVectorScale(Ze,qe,Ve,"y",H))),K<0&&(Ge=go.getLesserNonNegativeNonNull(Ge,go.solveVectorScale(Ze,qe,Ve,"y",K)));if(Number.isFinite(Ge)&&Ge!==0)return O.zoom=ke.zoom+s.ab(Ge),O;Du()}handleJumpToCenterZoom(o,u){let _=o.center.lat,v=o.getConstrained(u.center?s.Q.convert(u.center):o.center,o.zoom).center;o.setCenter(v.wrap());let C=u.zoom!==void 0?+u.zoom:o.zoom+Hn(_,v.lat);o.zoom!==C&&o.setZoom(C)}handleEaseTo(o,u){let _=o.zoom,v=o.center,C=o.padding,O={roll:o.roll,pitch:o.pitch,bearing:o.bearing},N={roll:u.roll===void 0?o.roll:u.roll,pitch:u.pitch===void 0?o.pitch:u.pitch,bearing:u.bearing===void 0?o.bearing:u.bearing},V=u.zoom!==void 0,H=!o.isPaddingEqual(u.padding),K=!1,ne=u.center?s.Q.convert(u.center):v,ie=o.getConstrained(ne,_).center;gd(o,ie);let fe=o.clone();fe.setCenter(ie),fe.setZoom(V?+u.zoom:_+Hn(v.lat,ne.lat)),fe.setBearing(u.bearing);let Ae=new s.P(s.ae(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),s.ae(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));fe.setLocationAtPoint(ie,Ae);let Ie=(u.offset&&u.offsetAsPoint.mag())>0?fe.center:ie,Se=V?+u.zoom:_+Hn(v.lat,Ie.lat),Me=_+Hn(v.lat,0),ke=Se+Hn(Ie.lat,0),Ve=s.bn(v.lng,Ie.lng),Be=s.bn(v.lat,Ie.lat),qe=s.aI(ke-Me);return K=Se!==_,{easeFunc:Ge=>{if(s.b6(O,N)||Bl({startEulerAngles:O,endEulerAngles:N,tr:o,k:Ge,useSlerp:O.roll!=N.roll}),H&&o.interpolatePadding(C,u.padding,Ge),u.around)s.w("Easing around a point is not supported under globe projection."),o.setLocationAtPoint(u.around,u.aroundPoint);else{let Ze=ke>Me?Math.min(2,qe):Math.max(.5,qe),_t=Math.pow(Ze,1-Ge),At=dA(v,Ve,Be,Ge*_t);o.setCenter(At.wrap())}if(K){let Ze=s.B.number(Me,ke,Ge)+Hn(0,o.center.lat);o.setZoom(Ze)}},isZooming:K,elevationCenter:Ie}}handleFlyTo(o,u){let _=u.zoom!==void 0,v=o.center,C=o.zoom,O=o.padding,N=!o.isPaddingEqual(u.padding),V=o.getConstrained(s.Q.convert(u.center||u.locationAtOffset),C).center,H=_?+u.zoom:o.zoom+Hn(o.center.lat,V.lat),K=o.clone();K.setCenter(V),K.setZoom(H),K.setBearing(u.bearing);let ne=new s.P(s.ae(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),s.ae(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));K.setLocationAtPoint(V,ne);let ie=K.center;gd(o,ie);let fe=function(Be,qe,Ge){let Ze=ws(qe),_t=ws(Ge),At=s.aV(Ze,_t),Mt=Math.acos(At),Lt=zm(Be);return Mt/(2*Math.PI)*Lt}(o,v,ie),Ae=C+Hn(v.lat,0),Ie=H+Hn(ie.lat,0),Se=s.aI(Ie-Ae),Me;if(typeof u.minZoom=="number"){let Be=+u.minZoom+Hn(ie.lat,0),qe=Math.min(Be,Ae,Ie)+Hn(0,ie.lat),Ge=o.getConstrained(ie,qe).zoom+Hn(ie.lat,0);Me=s.aI(Ge-Ae)}let ke=s.bn(v.lng,ie.lng),Ve=s.bn(v.lat,ie.lat);return{easeFunc:(Be,qe,Ge,Ze)=>{let _t=dA(v,ke,Ve,Ge);N&&o.interpolatePadding(O,u.padding,Be);let At=Be===1?ie:_t;o.setCenter(At.wrap());let Mt=Ae+s.ab(qe);o.setZoom(Be===1?H:Mt+Hn(0,At.lat))},scaleOfZoom:Se,targetCenter:ie,scaleOfMinZoom:Me,pixelPathLength:fe}}static solveVectorScale(o,u,_,v,C){let O=v==="x"?[_[0],_[4],_[8],_[12]]:[_[1],_[5],_[9],_[13]],N=[_[3],_[7],_[11],_[15]],V=o[0]*O[0]+o[1]*O[1]+o[2]*O[2],H=o[0]*N[0]+o[1]*N[1]+o[2]*N[2],K=u[0]*O[0]+u[1]*O[1]+u[2]*O[2],ne=u[0]*N[0]+u[1]*N[1]+u[2]*N[2];return K+C*H===V+C*ne||N[3]*(V-K)+O[3]*(ne-H)+V*ne==K*H?null:(K+O[3]-C*ne-C*N[3])/(K-V-C*ne+C*H)}static getLesserNonNegativeNonNull(o,u){return u!==null&&u>=0&&u<o?u:o}}class bd{constructor(o){this._globe=o,this._mercatorCameraHelper=new mo,this._verticalPerspectiveCameraHelper=new go}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(o,u){return this.currentHelper.handlePanInertia(o,u)}handleMapControlsRollPitchBearingZoom(o,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(o,u)}handleMapControlsPan(o,u,_){this.currentHelper.handleMapControlsPan(o,u,_)}cameraForBoxAndBearing(o,u,_,v,C){return this.currentHelper.cameraForBoxAndBearing(o,u,_,v,C)}handleJumpToCenterZoom(o,u){this.currentHelper.handleJumpToCenterZoom(o,u)}handleEaseTo(o,u){return this.currentHelper.handleEaseTo(o,u)}handleFlyTo(o,u){return this.currentHelper.handleFlyTo(o,u)}}let Ya=(S,o)=>s.x(S,o&&o.filter(u=>u.identifier!=="source.canvas")),Gh=s.bu();class wa extends s.E{constructor(o,u={}){super(),this._rtlPluginLoaded=()=>{for(let _ in this.sourceCaches){let v=this.sourceCaches[_].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[_].reload()}},this.map=o,this.dispatcher=new wr(Ot(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,v)=>this.getGlyphs(_,v)),this.dispatcher.registerMessageHandler("GI",(_,v)=>this.getImages(_,v)),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new _e(o._requestManager,u.localIdeographFontFamily),this.lineAtlas=new tt(256,512),this.crossTileSymbolIndex=new md,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bv,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.bw()),Ft().on(as,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let v=this.sourceCaches[_.sourceId];if(!v)return;let C=v.getSource();if(C&&C.vectorLayerIds)for(let O in this._layers){let N=this._layers[O];N.source===C.id&&this._validateLayer(N)}})}loadURL(o,u={},_){this.fire(new s.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;let v=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;let C=this._loadStyleRequest;s.j(v,this._loadStyleRequest).then(O=>{this._loadStyleRequest=null,this._load(O.data,u,_)}).catch(O=>{this._loadStyleRequest=null,O&&!C.signal.aborted&&this.fire(new s.k(O))})}loadJSON(o,u={},_){this.fire(new s.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,b.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(o,u,_)}).catch(()=>{})}loadEmpty(){this.fire(new s.l("dataloading",{dataType:"style"})),this._load(Gh,{validate:!1})}_load(o,u,_){var v,C;let O=u.transformStyle?u.transformStyle(_,o):o;if(!u.validate||!Ya(this,s.y(O))){this._loaded=!0,this.stylesheet=O;for(let N in O.sources)this.addSource(N,O.sources[N],{validate:!1});O.sprite?this._loadSprite(O.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(O.glyphs),this._createLayers(),this.light=new De(this.stylesheet.light),this._setProjectionInternal(((v=this.stylesheet.projection)===null||v===void 0?void 0:v.type)||"mercator"),this.sky=new rt(this.stylesheet.sky),this.map.setTerrain((C=this.stylesheet.terrain)!==null&&C!==void 0?C:null),this.fire(new s.l("data",{dataType:"style"})),this.fire(new s.l("style.load"))}}_createLayers(){let o=s.bx(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(u=>u.id),this._layers={},this._serializedLayers=null;for(let u of o){let _=s.by(u);_.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=_}}_loadSprite(o,u=!1,_=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(C,O,N,V){return s._(this,void 0,void 0,function*(){let H=me(C),K=N>1?"@2x":"",ne={},ie={};for(let{id:fe,url:Ae}of H){let Ie=O.transformRequest(Le(Ae,K,".json"),"SpriteJSON");ne[fe]=s.j(Ie,V);let Se=O.transformRequest(Le(Ae,K,".png"),"SpriteImage");ie[fe]=ee.getImage(Se,V)}return yield Promise.all([...Object.values(ne),...Object.values(ie)]),function(fe,Ae){return s._(this,void 0,void 0,function*(){let Ie={};for(let Se in fe){Ie[Se]={};let Me=b.getImageCanvasContext((yield Ae[Se]).data),ke=(yield fe[Se]).data;for(let Ve in ke){let{width:Be,height:qe,x:Ge,y:Ze,sdf:_t,pixelRatio:At,stretchX:Mt,stretchY:Lt,content:Tt,textFitWidth:er,textFitHeight:Kt}=ke[Ve];Ie[Se][Ve]={data:null,pixelRatio:At,sdf:_t,stretchX:Mt,stretchY:Lt,content:Tt,textFitWidth:er,textFitHeight:Kt,spriteData:{width:Be,height:qe,x:Ge,y:Ze,context:Me}}}}return Ie})}(ne,ie)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(C=>{if(this._spriteRequest=null,C)for(let O in C){this._spritesImagesIds[O]=[];let N=this._spritesImagesIds[O]?this._spritesImagesIds[O].filter(V=>!(V in C)):[];for(let V of N)this.imageManager.removeImage(V),this._changedImages[V]=!0;for(let V in C[O]){let H=O==="default"?V:`${O}:${V}`;this._spritesImagesIds[O].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,C[O][V],!1):this.imageManager.addImage(H,C[O][V]),u&&(this._changedImages[H]=!0)}}}).catch(C=>{this._spriteRequest=null,v=C,this.fire(new s.k(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"})),_&&_(v)})}_unloadSprite(){for(let o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}_validateLayer(o){let u=this.sourceCaches[o.source];if(!u)return;let _=o.sourceLayer;if(!_)return;let v=u.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.k(new Error(`Source layer "${_}" does not exist on source "${v.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,u=!1){let _=this._serializedAllLayers();if(!o||o.length===0)return Object.values(u?s.bz(_):_);let v=[];for(let C of o)if(_[C]){let O=u?s.bz(_[C]):_[C];v.push(O)}return v}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};let u=Object.keys(this._layers);for(let _ of u){let v=this._layers[_];v.type!=="custom"&&(o[_]=v.serialize())}return o}hasTransitions(){var o,u,_;if(!((o=this.light)===null||o===void 0)&&o.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((_=this.projection)===null||_===void 0)&&_.hasTransition())return!0;for(let v in this.sourceCaches)if(this.sourceCaches[v].hasTransition())return!0;for(let v in this._layers)if(this._layers[v].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;let u=this._changed;if(u){let v=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(v.length||C.length)&&this._updateWorkerLayers(v,C);for(let O in this._updatedSources){let N=this._updatedSources[O];if(N==="reload")this._reloadSource(O);else{if(N!=="clear")throw new Error(`Invalid action ${N}`);this._clearSource(O)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let O in this._updatedPaintProps)this._layers[O].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}let _={};for(let v in this.sourceCaches){let C=this.sourceCaches[v];_[v]=C.used,C.used=!1}for(let v of this._order){let C=this._layers[v];C.recalculate(o,this._availableImages),!C.isHidden(o.zoom)&&C.source&&(this.sourceCaches[C.source].used=!0)}for(let v in _){let C=this.sourceCaches[v];!!_[v]!=!!C.used&&C.fire(new s.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(o),this.sky.recalculate(o),this.projection.recalculate(o),this.z=o.zoom,u&&this.fire(new s.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let o=Object.keys(this._changedImages);if(o.length){for(let u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,u={}){var _;this._checkLoaded();let v=this.serialize();if(o=u.transformStyle?u.transformStyle(v,o):o,((_=u.validate)===null||_===void 0||_)&&Ya(this,s.y(o)))return!1;(o=s.bz(o)).layers=s.bx(o.layers);let C=s.bA(v,o),O=this._getOperationsToPerform(C);if(O.unimplemented.length>0)throw new Error(`Unimplemented: ${O.unimplemented.join(", ")}.`);if(O.operations.length===0)return!1;for(let N of O.operations)N();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){let u=[],_=[];for(let v of o)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":u.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":u.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setSky":u.push(()=>this.setSky.apply(this,v.args));break;case"setProjection":this.setProjection.apply(this,v.args);break;case"setTransition":u.push(()=>{});break;default:_.push(v.command)}return{operations:u,unimplemented:_}}addImage(o,u){if(this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,u),this._afterImageUpdated(o)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new s.k(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,u,_={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(s.y.source,`sources.${o}`,u,null,_))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let v=this.sourceCaches[o]=new de(o,u,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:o})),v.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===o)return this.fire(new s.k(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));let u=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],u.fire(new s.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,u){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);let _=this.sourceCaches[o].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(u),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,u,_={}){this._checkLoaded();let v=o.id;if(this.getLayer(v))return void this.fire(new s.k(new Error(`Layer "${v}" already exists on this map.`)));let C;if(o.type==="custom"){if(Ya(this,s.bB(o)))return;C=s.by(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(v,o.source),o=s.bz(o),o=s.e(o,{source:v})),this._validate(s.y.layer,`layers.${v}`,o,{arrayIndex:-1},_))return;C=s.by(o),this._validateLayer(C),C.setEventedParent(this,{layer:{id:v}})}let O=u?this._order.indexOf(u):this._order.length;if(u&&O===-1)this.fire(new s.k(new Error(`Cannot add layer "${v}" before non-existing layer "${u}".`)));else{if(this._order.splice(O,0,v),this._layerOrderChanged=!0,this._layers[v]=C,this._removedLayers[v]&&C.source&&C.type!=="custom"){let N=this._removedLayers[v];delete this._removedLayers[v],N.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.k(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;let _=this._order.indexOf(o);this._order.splice(_,1);let v=u?this._order.indexOf(u):this._order.length;u&&v===-1?this.fire(new s.k(new Error(`Cannot move layer "${o}" before non-existing layer "${u}".`))):(this._order.splice(v,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();let u=this._layers[o];if(!u)return void this.fire(new s.k(new Error(`Cannot remove non-existing layer "${o}".`)));u.setEventedParent(null);let _=this._order.indexOf(o);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,u,_){this._checkLoaded();let v=this.getLayer(o);v?v.minzoom===u&&v.maxzoom===_||(u!=null&&(v.minzoom=u),_!=null&&(v.maxzoom=_),this._updateLayer(v)):this.fire(new s.k(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,u,_={}){this._checkLoaded();let v=this.getLayer(o);if(v){if(!s.bC(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.y.filter,`layers.${v.id}.filter`,u,null,_)||(v.filter=s.bz(u),this._updateLayer(v)))}else this.fire(new s.k(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return s.bz(this.getLayer(o).filter)}setLayoutProperty(o,u,_,v={}){this._checkLoaded();let C=this.getLayer(o);C?s.bC(C.getLayoutProperty(u),_)||(C.setLayoutProperty(u,_,v),this._updateLayer(C)):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,u){let _=this.getLayer(o);if(_)return _.getLayoutProperty(u);this.fire(new s.k(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,u,_,v={}){this._checkLoaded();let C=this.getLayer(o);C?s.bC(C.getPaintProperty(u),_)||(C.setPaintProperty(u,_,v)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new s.k(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,u){return this.getLayer(o).getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();let _=o.source,v=o.sourceLayer,C=this.sourceCaches[_];if(C===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));let O=C.getSource().type;O==="geojson"&&v?this.fire(new s.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||v?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),C.setFeatureState(v,o.id,u)):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,u){this._checkLoaded();let _=o.source,v=this.sourceCaches[_];if(v===void 0)return void this.fire(new s.k(new Error(`The source '${_}' does not exist in the map's style.`)));let C=v.getSource().type,O=C==="vector"?o.sourceLayer:void 0;C!=="vector"||O?u&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new s.k(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(O,o.id,u):this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();let u=o.source,_=o.sourceLayer,v=this.sourceCaches[u];if(v!==void 0)return v.getSource().type!=="vector"||_?(o.id===void 0&&this.fire(new s.k(new Error("The feature id parameter must be provided."))),v.getFeatureState(_,o.id)):void this.fire(new s.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let o=s.bD(this.sourceCaches,C=>C.serialize()),u=this._serializeByIds(this._order,!0),_=this.map.getTerrain()||void 0,v=this.stylesheet;return s.bE({version:v.version,name:v.name,metadata:v.metadata,light:v.light,sky:v.sky,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,projection:v.projection,sources:o,layers:u,terrain:_},C=>C!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){let u=O=>this._layers[O].type==="fill-extrusion",_={},v=[];for(let O=this._order.length-1;O>=0;O--){let N=this._order[O];if(u(N)){_[N]=O;for(let V of o){let H=V[N];if(H)for(let K of H)v.push(K)}}}v.sort((O,N)=>N.intersectionZ-O.intersectionZ);let C=[];for(let O=this._order.length-1;O>=0;O--){let N=this._order[O];if(u(N))for(let V=v.length-1;V>=0;V--){let H=v[V].feature;if(_[H.layer.id]<O)break;C.push(H),v.pop()}else for(let V of o){let H=V[N];if(H)for(let K of H)C.push(K.feature)}}return C}queryRenderedFeatures(o,u,_){u&&u.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",u.filter,null,u);let v={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new s.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let H of u.layers){let K=this._layers[H];if(!K)return this.fire(new s.k(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];v[K.source]=!0}}let C=[];u.availableImages=this._availableImages;let O=this._serializedAllLayers(),N=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,V=Object.assign(Object.assign({},u),{layers:N});for(let H in this.sourceCaches)u.layers&&!v[H]||C.push(Zr(this.sourceCaches[H],this._layers,O,o,V,_,this.map.terrain?(K,ne,ie)=>this.map.terrain.getElevation(K,ne,ie):void 0));return this.placement&&C.push(function(H,K,ne,ie,fe,Ae,Ie){let Se={},Me=Ae.queryRenderedSymbols(ie),ke=[];for(let Ve of Object.keys(Me).map(Number))ke.push(Ie[Ve]);ke.sort(Oi);for(let Ve of ke){let Be=Ve.featureIndex.lookupSymbolFeatures(Me[Ve.bucketInstanceId],K,Ve.bucketIndex,Ve.sourceLayerIndex,fe.filter,fe.layers,fe.availableImages,H);for(let qe in Be){let Ge=Se[qe]=Se[qe]||[],Ze=Be[qe];Ze.sort((_t,At)=>{let Mt=Ve.featureSortOrder;if(Mt){let Lt=Mt.indexOf(_t.featureIndex);return Mt.indexOf(At.featureIndex)-Lt}return At.featureIndex-_t.featureIndex});for(let _t of Ze)Ge.push(_t)}}return function(Ve,Be,qe){for(let Ge in Ve)for(let Ze of Ve[Ge])Jr(Ze,qe[Be[Ge].source]);return Ve}(Se,H,ne)}(this._layers,O,this.sourceCaches,o,V,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(o,u){u&&u.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",u.filter,null,u);let _=this.sourceCaches[o];return _?function(v,C){let O=v.getRenderableIds().map(H=>v.getTileByID(H)),N=[],V={};for(let H=0;H<O.length;H++){let K=O[H],ne=K.tileID.canonical.key;V[ne]||(V[ne]=!0,K.querySourceFeatures(N,C))}return N}(_,u):[]}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();let _=this.light.getLight(),v=!1;for(let O in o)if(!s.bC(o[O],_[O])){v=!0;break}if(!v)return;let C={now:b.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(C)}getProjection(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.projection}setProjection(o){if(this._checkLoaded(),this.projection){if(this.projection.name===o.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=o,this._setProjectionInternal(o.type)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,u={}){this._checkLoaded();let _=this.getSky(),v=!1;if(!o&&!_)return;if(o&&!_)v=!0;else if(!o&&_)v=!0;else for(let O in o)if(!s.bC(o[O],_[O])){v=!0;break}if(!v)return;let C={now:b.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,u),this.sky.updateTransitions(C)}_setProjectionInternal(o){let u=function(_){if(Array.isArray(_)){let v=new Nu({type:_});return{projection:v,transform:new jh,cameraHelper:new bd(v)}}switch(_){case"mercator":return{projection:new bi,transform:new _n,cameraHelper:new mo};case"globe":{let v=new Nu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new jh,cameraHelper:new bd(v)}}case"vertical-perspective":return{projection:new Uh,transform:new Vh,cameraHelper:new go};default:return s.w(`Unknown projection name: ${_}. Falling back to mercator projection.`),{projection:new bi,transform:new _n,cameraHelper:new mo}}}(o);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(let _ in this.sourceCaches)this.sourceCaches[_].reload()}_validate(o,u,_,v,C={}){return(!C||C.validate!==!1)&&Ya(this,o.call(s.y,s.e({key:u,style:this.serialize(),value:_,styleSpec:s.v},v)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ft().off(as,this._rtlPluginLoaded);for(let u in this._layers)this._layers[u].setEventedParent(null);for(let u in this.sourceCaches){let _=this.sourceCaches[u];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(let u in this.sourceCaches)this.sourceCaches[u].update(o,this.map.terrain)}_generateCollisionBoxes(){for(let o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,u,_,v,C=!1){let O=!1,N=!1,V={};for(let H of this._order){let K=this._layers[H];if(K.type!=="symbol")continue;if(!V[K.source]){let ie=this.sourceCaches[K.source];V[K.source]=ie.getRenderableIds(!0).map(fe=>ie.getTileByID(fe)).sort((fe,Ae)=>Ae.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(Ae.tileID)?-1:1))}let ne=this.crossTileSymbolIndex.addLayer(K,V[K.source],o.center.lng);O=O||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(b.now(),o.zoom))&&(this.pauseablePlacement=new Gn(o,this.map.terrain,this._order,C,u,_,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(b.now()),N=!0),O&&this.pauseablePlacement.placement.setStale()),N||O)for(let H of this._order){let K=this._layers[H];K.type==="symbol"&&this.placement.updateLayerOpacities(K,V[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(b.now())}_releaseSymbolFadeTiles(){for(let o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,u){return s._(this,void 0,void 0,function*(){let _=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();let v=this.sourceCaches[u.source];return v&&v.setDependencies(u.tileID.key,u.type,u.icons),_})}getGlyphs(o,u){return s._(this,void 0,void 0,function*(){let _=yield this.glyphManager.getGlyphs(u.stacks),v=this.sourceCaches[u.source];return v&&v.setDependencies(u.tileID.key,u.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,u={}){this._checkLoaded(),o&&this._validate(s.y.glyphs,"glyphs",o,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,u,_={},v){this._checkLoaded();let C=[{id:o,url:u}],O=[...me(this.stylesheet.sprite),...C];this._validate(s.y.sprite,"sprite",O,null,_)||(this.stylesheet.sprite=O,this._loadSprite(C,!0,v))}removeSprite(o){this._checkLoaded();let u=me(this.stylesheet.sprite);if(u.find(_=>_.id===o)){if(this._spritesImagesIds[o])for(let _ of this._spritesImagesIds[o])this.imageManager.removeImage(_),this._changedImages[_]=!0;u.splice(u.findIndex(_=>_.id===o),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.l("data",{dataType:"style"}))}else this.fire(new s.k(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return me(this.stylesheet.sprite)}setSprite(o,u={},_){this._checkLoaded(),o&&this._validate(s.y.sprite,"sprite",o,null,u)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,_):(this._unloadSprite(),_&&_(null)))}}var Uu=s.aD([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ta{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,_,v,C,O,N,V,H){this.context=o;let K=this.boundPaintVertexBuffers.length!==v.length;for(let ne=0;!K&&ne<v.length;ne++)this.boundPaintVertexBuffers[ne]!==v[ne]&&(K=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==_||K||this.boundIndexBuffer!==C||this.boundVertexOffset!==O||this.boundDynamicVertexBuffer!==N||this.boundDynamicVertexBuffer2!==V||this.boundDynamicVertexBuffer3!==H?this.freshBind(u,_,v,C,O,N,V,H):(o.bindVertexArray.set(this.vao),N&&N.bind(),C&&C.dynamicDraw&&C.bind(),V&&V.bind(),H&&H.bind())}freshBind(o,u,_,v,C,O,N,V){let H=o.numAttributes,K=this.context,ne=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=C,this.boundDynamicVertexBuffer=O,this.boundDynamicVertexBuffer2=N,this.boundDynamicVertexBuffer3=V,u.enableAttributes(ne,o);for(let ie of _)ie.enableAttributes(ne,o);O&&O.enableAttributes(ne,o),N&&N.enableAttributes(ne,o),V&&V.enableAttributes(ne,o),u.bind(),u.setVertexAttribPointers(ne,o,C);for(let ie of _)ie.bind(),ie.setVertexAttribPointers(ne,o,C);O&&(O.bind(),O.setVertexAttribPointers(ne,o,C)),v&&v.bind(),N&&(N.bind(),N.setVertexAttribPointers(ne,o,C)),V&&(V.bind(),V.setVertexAttribPointers(ne,o,C)),K.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let gt=(S,o,u,_,v)=>({u_texture:0,u_ele_delta:S,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):s.b7.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:v?0:u?u.calculateFogBlendOpacity(_):0,u_horizon_color:u?u.properties.get("horizon-color"):s.b7.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:v?1:0}),Wt={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function or(S){let o=[];for(let u=0;u<S.length;u++){if(S[u]===null)continue;let _=S[u].split(" ");o.push(_.pop())}return o}class Br{constructor(o,u,_,v,C,O,N,V){let H=o.gl;this.program=H.createProgram();let K=or(u.staticAttributes),ne=_?_.getBinderAttributes():[],ie=K.concat(ne),fe=ra.prelude.staticUniforms?or(ra.prelude.staticUniforms):[],Ae=N.staticUniforms?or(N.staticUniforms):[],Ie=u.staticUniforms?or(u.staticUniforms):[],Se=_?_.getBinderUniforms():[],Me=fe.concat(Ae).concat(Ie).concat(Se),ke=[];for(let At of Me)ke.indexOf(At)<0&&ke.push(At);let Ve=_?_.defines():[];ia(H)&&Ve.unshift("#version 300 es"),C&&Ve.push("#define OVERDRAW_INSPECTOR;"),O&&Ve.push("#define TERRAIN3D;"),V&&Ve.push(V);let Be=Ve.concat(ra.prelude.fragmentSource,N.fragmentSource,u.fragmentSource).join(`
`),qe=Ve.concat(ra.prelude.vertexSource,N.vertexSource,u.vertexSource).join(`
`);ia(H)||(Be=function(At){return At.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Be),qe=function(At){return At.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(qe));let Ge=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Ge,Be),H.compileShader(Ge),!H.getShaderParameter(Ge,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(Ge)}`);H.attachShader(this.program,Ge);let Ze=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(Ze,qe),H.compileShader(Ze),!H.getShaderParameter(Ze,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(Ze)}`);H.attachShader(this.program,Ze),this.attributes={};let _t={};this.numAttributes=ie.length;for(let At=0;At<this.numAttributes;At++)ie[At]&&(H.bindAttribLocation(this.program,At,ie[At]),this.attributes[ie[At]]=At);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(Ze),H.deleteShader(Ge);for(let At=0;At<ke.length;At++){let Mt=ke[At];if(Mt&&!_t[Mt]){let Lt=H.getUniformLocation(this.program,Mt);Lt&&(_t[Mt]=Lt)}}this.fixedUniforms=v(o,_t),this.terrainUniforms=((At,Mt)=>({u_depth:new s.bF(At,Mt.u_depth),u_terrain:new s.bF(At,Mt.u_terrain),u_terrain_dim:new s.b8(At,Mt.u_terrain_dim),u_terrain_matrix:new s.bH(At,Mt.u_terrain_matrix),u_terrain_unpack:new s.bI(At,Mt.u_terrain_unpack),u_terrain_exaggeration:new s.b8(At,Mt.u_terrain_exaggeration)}))(o,_t),this.projectionUniforms=((At,Mt)=>({u_projection_matrix:new s.bH(At,Mt.u_projection_matrix),u_projection_tile_mercator_coords:new s.bI(At,Mt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bI(At,Mt.u_projection_clipping_plane),u_projection_transition:new s.b8(At,Mt.u_projection_transition),u_projection_fallback_matrix:new s.bH(At,Mt.u_projection_fallback_matrix)}))(o,_t),this.binderUniforms=_?_.getUniforms(o,_t):[]}draw(o,u,_,v,C,O,N,V,H,K,ne,ie,fe,Ae,Ie,Se,Me,ke,Ve){let Be=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(_),o.setStencilMode(v),o.setColorMode(C),o.setCullFace(O),V){o.activeTexture.set(Be.TEXTURE2),Be.bindTexture(Be.TEXTURE_2D,V.depthTexture),o.activeTexture.set(Be.TEXTURE3),Be.bindTexture(Be.TEXTURE_2D,V.texture);for(let Ge in this.terrainUniforms)this.terrainUniforms[Ge].set(V[Ge])}if(H)for(let Ge in H)this.projectionUniforms[Wt[Ge]].set(H[Ge]);if(N)for(let Ge in this.fixedUniforms)this.fixedUniforms[Ge].set(N[Ge]);Se&&Se.setUniforms(o,this.binderUniforms,Ae,{zoom:Ie});let qe=0;switch(u){case Be.LINES:qe=2;break;case Be.TRIANGLES:qe=3;break;case Be.LINE_STRIP:qe=1}for(let Ge of fe.get()){let Ze=Ge.vaos||(Ge.vaos={});(Ze[K]||(Ze[K]=new Ta)).bind(o,this,ne,Se?Se.getPaintVertexBuffers():[],ie,Ge.vertexOffset,Me,ke,Ve),Be.drawElements(u,Ge.primitiveLength*qe,Be.UNSIGNED_SHORT,Ge.primitiveOffset*qe*2)}}}function y(S,o,u){let _=1/s.aw(u,1,o.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),C=u.tileSize*Math.pow(2,o.transform.tileZoom)/v,O=C*(u.tileID.canonical.x+u.tileID.wrap*v),N=C*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[_,S.fromScale,S.toScale],u_fade:S.t,u_pixel_coord_upper:[O>>16,N>>16],u_pixel_coord_lower:[65535&O,65535&N]}}let qi=(S,o,u,_)=>{let v=S.style.light,C=v.properties.get("position"),O=[C.x,C.y,C.z],N=s.bL();v.properties.get("anchor")==="viewport"&&s.bM(N,S.transform.bearingInRadians),s.bN(O,O,N);let V=S.transform.transformLightDirection(O),H=v.properties.get("color");return{u_lightpos:O,u_lightpos_globe:V,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+o,u_opacity:u,u_fill_translate:_}},Ei=(S,o,u,_,v,C,O)=>s.e(qi(S,o,u,_),y(C,S,O),{u_height_factor:-Math.pow(2,v.overscaledZ)/O.tileSize/8}),Ee=(S,o,u,_)=>s.e(y(o,S,u),{u_fill_translate:_}),En=(S,o)=>({u_world:S,u_fill_translate:o}),Js=(S,o,u,_,v)=>s.e(Ee(S,o,u,v),{u_world:_}),Wn=(S,o,u,_,v)=>{let C=S.transform,O,N,V=0;if(u.paint.get("circle-pitch-alignment")==="map"){let H=s.aw(o,1,C.zoom);O=!0,N=[H,H],V=H/(s.Z*Math.pow(2,o.tileID.overscaledZ))*2*Math.PI*v}else O=!1,N=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+O,u_device_pixel_ratio:S.pixelRatio,u_extrude_scale:N,u_globe_extrude_scale:V,u_translate:_}},Ui=S=>({u_pixel_extrude_scale:[1/S.width,1/S.height]}),dn=S=>({u_viewport_size:[S.width,S.height]}),kn=(S,o=1)=>({u_color:S,u_overlay:0,u_overlay_scale:o}),vi=(S,o,u,_)=>{let v=s.aw(S,1,o)/(s.Z*Math.pow(2,S.tileID.overscaledZ))*2*Math.PI*_;return{u_extrude_scale:s.aw(S,1,o),u_intensity:u,u_globe_extrude_scale:v}},Si=(S,o,u,_)=>{let v=s.K();s.bO(v,0,S.width,S.height,0,0,1);let C=S.context.gl;return{u_matrix:v,u_world:[C.drawingBufferWidth,C.drawingBufferHeight],u_image:u,u_color_ramp:_,u_opacity:o.paint.get("heatmap-opacity")}},Ic=(S,o,u)=>{let _=u.paint.get("hillshade-shadow-color"),v=u.paint.get("hillshade-highlight-color"),C=u.paint.get("hillshade-accent-color"),O=u.paint.get("hillshade-illumination-direction")*(Math.PI/180);return u.paint.get("hillshade-illumination-anchor")==="viewport"&&(O+=S.transform.bearingInRadians),{u_image:0,u_latrange:Ll(0,o.tileID),u_light:[u.paint.get("hillshade-exaggeration"),O],u_shadow:_,u_highlight:v,u_accent:C}},mA=(S,o)=>{let u=o.stride,_=s.K();return s.bO(_,0,s.Z,-8192,0,0,1),s.L(_,_,[0,-8192,0]),{u_matrix:_,u_image:1,u_dimension:[u,u],u_zoom:S.overscaledZ,u_unpack:o.getUnpackVector()}};function Ll(S,o){let u=Math.pow(2,o.canonical.z),_=o.canonical.y;return[new s.$(0,_/u).toLngLat().lat,new s.$(0,(_+1)/u).toLngLat().lat]}let Pc=(S,o,u,_)=>{let v=S.transform;return{u_translation:gA(S,o,u),u_ratio:_/s.aw(o,1,v.zoom),u_device_pixel_ratio:S.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},_o=(S,o,u,_,v)=>s.e(Pc(S,o,u,_),{u_image:0,u_image_height:v}),sa=(S,o,u,_,v)=>{let C=S.transform,O=Ol(o,C);return{u_translation:gA(S,o,u),u_texsize:o.imageAtlasTexture.size,u_ratio:_/s.aw(o,1,C.zoom),u_device_pixel_ratio:S.pixelRatio,u_image:0,u_scale:[O,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},oa=(S,o,u,_,v,C)=>{let O=S.lineAtlas,N=Ol(o,S.transform),V=u.layout.get("line-cap")==="round",H=O.getDash(v.from,V),K=O.getDash(v.to,V),ne=H.width*C.fromScale,ie=K.width*C.toScale;return s.e(Pc(S,o,u,_),{u_patternscale_a:[N/ne,-H.height/2],u_patternscale_b:[N/ie,-K.height/2],u_sdfgamma:O.width/(256*Math.min(ne,ie)*S.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:K.y,u_mix:C.t})};function Ol(S,o){return 1/s.aw(S,1,o.tileZoom)}function gA(S,o,u){return s.ax(S.transform,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}let Dl=(S,o,u,_,v)=>{return{u_tl_parent:S,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(O=_.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(C=_.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:Yr(_.paint.get("raster-hue-rotate")),u_coords_top:[v[0].x,v[0].y,v[1].x,v[1].y],u_coords_bottom:[v[3].x,v[3].y,v[2].x,v[2].y]};var C,O};function Yr(S){S*=Math.PI/180;let o=Math.sin(S),u=Math.cos(S);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}let Pe=(S,o,u,_,v,C,O,N,V,H,K,ne,ie)=>{let fe=O.transform;return{u_is_size_zoom_constant:+(S==="constant"||S==="source"),u_is_size_feature_constant:+(S==="constant"||S==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:fe.cameraToCenterDistance,u_pitch:fe.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:fe.width/fe.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_label_plane_matrix:N,u_coord_matrix:V,u_is_text:+K,u_pitch_with_map:+_,u_is_along_line:v,u_is_variable_anchor:C,u_texsize:ne,u_texture:0,u_translation:H,u_pitched_scale:ie}},Fr=(S,o,u,_,v,C,O,N,V,H,K,ne,ie,fe)=>{let Ae=O.transform;return s.e(Pe(S,o,u,_,v,C,O,N,V,H,K,ne,fe),{u_gamma_scale:_?Math.cos(Ae.pitch*Math.PI/180)*Ae.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:1})},Hh=(S,o,u,_,v,C,O,N,V,H,K,ne,ie)=>s.e(Fr(S,o,u,_,v,C,O,N,V,H,!0,K,0,ie),{u_texsize_icon:ne,u_texture_icon:1}),_A=(S,o)=>({u_opacity:S,u_color:o}),Wh=(S,o,u,_,v)=>s.e(function(C,O,N,V){let H=N.imageManager.getPattern(C.from.toString()),K=N.imageManager.getPattern(C.to.toString()),{width:ne,height:ie}=N.imageManager.getPixelSize(),fe=Math.pow(2,V.tileID.overscaledZ),Ae=V.tileSize*Math.pow(2,N.transform.tileZoom)/fe,Ie=Ae*(V.tileID.canonical.x+V.tileID.wrap*fe),Se=Ae*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[ne,ie],u_mix:O.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/s.aw(V,1,N.transform.tileZoom),u_pixel_coord_upper:[Ie>>16,Se>>16],u_pixel_coord_lower:[65535&Ie,65535&Se]}}(u,v,o,_),{u_opacity:S}),aa=(S,o)=>{},vd={fillExtrusion:(S,o)=>({u_lightpos:new s.bJ(S,o.u_lightpos),u_lightpos_globe:new s.bJ(S,o.u_lightpos_globe),u_lightintensity:new s.b8(S,o.u_lightintensity),u_lightcolor:new s.bJ(S,o.u_lightcolor),u_vertical_gradient:new s.b8(S,o.u_vertical_gradient),u_opacity:new s.b8(S,o.u_opacity),u_fill_translate:new s.bK(S,o.u_fill_translate)}),fillExtrusionPattern:(S,o)=>({u_lightpos:new s.bJ(S,o.u_lightpos),u_lightpos_globe:new s.bJ(S,o.u_lightpos_globe),u_lightintensity:new s.b8(S,o.u_lightintensity),u_lightcolor:new s.bJ(S,o.u_lightcolor),u_vertical_gradient:new s.b8(S,o.u_vertical_gradient),u_height_factor:new s.b8(S,o.u_height_factor),u_opacity:new s.b8(S,o.u_opacity),u_fill_translate:new s.bK(S,o.u_fill_translate),u_image:new s.bF(S,o.u_image),u_texsize:new s.bK(S,o.u_texsize),u_pixel_coord_upper:new s.bK(S,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(S,o.u_pixel_coord_lower),u_scale:new s.bJ(S,o.u_scale),u_fade:new s.b8(S,o.u_fade)}),fill:(S,o)=>({u_fill_translate:new s.bK(S,o.u_fill_translate)}),fillPattern:(S,o)=>({u_image:new s.bF(S,o.u_image),u_texsize:new s.bK(S,o.u_texsize),u_pixel_coord_upper:new s.bK(S,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(S,o.u_pixel_coord_lower),u_scale:new s.bJ(S,o.u_scale),u_fade:new s.b8(S,o.u_fade),u_fill_translate:new s.bK(S,o.u_fill_translate)}),fillOutline:(S,o)=>({u_world:new s.bK(S,o.u_world),u_fill_translate:new s.bK(S,o.u_fill_translate)}),fillOutlinePattern:(S,o)=>({u_world:new s.bK(S,o.u_world),u_image:new s.bF(S,o.u_image),u_texsize:new s.bK(S,o.u_texsize),u_pixel_coord_upper:new s.bK(S,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(S,o.u_pixel_coord_lower),u_scale:new s.bJ(S,o.u_scale),u_fade:new s.b8(S,o.u_fade),u_fill_translate:new s.bK(S,o.u_fill_translate)}),circle:(S,o)=>({u_camera_to_center_distance:new s.b8(S,o.u_camera_to_center_distance),u_scale_with_map:new s.bF(S,o.u_scale_with_map),u_pitch_with_map:new s.bF(S,o.u_pitch_with_map),u_extrude_scale:new s.bK(S,o.u_extrude_scale),u_device_pixel_ratio:new s.b8(S,o.u_device_pixel_ratio),u_globe_extrude_scale:new s.b8(S,o.u_globe_extrude_scale),u_translate:new s.bK(S,o.u_translate)}),collisionBox:(S,o)=>({u_pixel_extrude_scale:new s.bK(S,o.u_pixel_extrude_scale)}),collisionCircle:(S,o)=>({u_viewport_size:new s.bK(S,o.u_viewport_size)}),debug:(S,o)=>({u_color:new s.bG(S,o.u_color),u_overlay:new s.bF(S,o.u_overlay),u_overlay_scale:new s.b8(S,o.u_overlay_scale)}),depth:aa,clippingMask:aa,heatmap:(S,o)=>({u_extrude_scale:new s.b8(S,o.u_extrude_scale),u_intensity:new s.b8(S,o.u_intensity),u_globe_extrude_scale:new s.b8(S,o.u_globe_extrude_scale)}),heatmapTexture:(S,o)=>({u_matrix:new s.bH(S,o.u_matrix),u_world:new s.bK(S,o.u_world),u_image:new s.bF(S,o.u_image),u_color_ramp:new s.bF(S,o.u_color_ramp),u_opacity:new s.b8(S,o.u_opacity)}),hillshade:(S,o)=>({u_image:new s.bF(S,o.u_image),u_latrange:new s.bK(S,o.u_latrange),u_light:new s.bK(S,o.u_light),u_shadow:new s.bG(S,o.u_shadow),u_highlight:new s.bG(S,o.u_highlight),u_accent:new s.bG(S,o.u_accent)}),hillshadePrepare:(S,o)=>({u_matrix:new s.bH(S,o.u_matrix),u_image:new s.bF(S,o.u_image),u_dimension:new s.bK(S,o.u_dimension),u_zoom:new s.b8(S,o.u_zoom),u_unpack:new s.bI(S,o.u_unpack)}),line:(S,o)=>({u_translation:new s.bK(S,o.u_translation),u_ratio:new s.b8(S,o.u_ratio),u_device_pixel_ratio:new s.b8(S,o.u_device_pixel_ratio),u_units_to_pixels:new s.bK(S,o.u_units_to_pixels)}),lineGradient:(S,o)=>({u_translation:new s.bK(S,o.u_translation),u_ratio:new s.b8(S,o.u_ratio),u_device_pixel_ratio:new s.b8(S,o.u_device_pixel_ratio),u_units_to_pixels:new s.bK(S,o.u_units_to_pixels),u_image:new s.bF(S,o.u_image),u_image_height:new s.b8(S,o.u_image_height)}),linePattern:(S,o)=>({u_translation:new s.bK(S,o.u_translation),u_texsize:new s.bK(S,o.u_texsize),u_ratio:new s.b8(S,o.u_ratio),u_device_pixel_ratio:new s.b8(S,o.u_device_pixel_ratio),u_image:new s.bF(S,o.u_image),u_units_to_pixels:new s.bK(S,o.u_units_to_pixels),u_scale:new s.bJ(S,o.u_scale),u_fade:new s.b8(S,o.u_fade)}),lineSDF:(S,o)=>({u_translation:new s.bK(S,o.u_translation),u_ratio:new s.b8(S,o.u_ratio),u_device_pixel_ratio:new s.b8(S,o.u_device_pixel_ratio),u_units_to_pixels:new s.bK(S,o.u_units_to_pixels),u_patternscale_a:new s.bK(S,o.u_patternscale_a),u_patternscale_b:new s.bK(S,o.u_patternscale_b),u_sdfgamma:new s.b8(S,o.u_sdfgamma),u_image:new s.bF(S,o.u_image),u_tex_y_a:new s.b8(S,o.u_tex_y_a),u_tex_y_b:new s.b8(S,o.u_tex_y_b),u_mix:new s.b8(S,o.u_mix)}),raster:(S,o)=>({u_tl_parent:new s.bK(S,o.u_tl_parent),u_scale_parent:new s.b8(S,o.u_scale_parent),u_buffer_scale:new s.b8(S,o.u_buffer_scale),u_fade_t:new s.b8(S,o.u_fade_t),u_opacity:new s.b8(S,o.u_opacity),u_image0:new s.bF(S,o.u_image0),u_image1:new s.bF(S,o.u_image1),u_brightness_low:new s.b8(S,o.u_brightness_low),u_brightness_high:new s.b8(S,o.u_brightness_high),u_saturation_factor:new s.b8(S,o.u_saturation_factor),u_contrast_factor:new s.b8(S,o.u_contrast_factor),u_spin_weights:new s.bJ(S,o.u_spin_weights),u_coords_top:new s.bI(S,o.u_coords_top),u_coords_bottom:new s.bI(S,o.u_coords_bottom)}),symbolIcon:(S,o)=>({u_is_size_zoom_constant:new s.bF(S,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bF(S,o.u_is_size_feature_constant),u_size_t:new s.b8(S,o.u_size_t),u_size:new s.b8(S,o.u_size),u_camera_to_center_distance:new s.b8(S,o.u_camera_to_center_distance),u_pitch:new s.b8(S,o.u_pitch),u_rotate_symbol:new s.bF(S,o.u_rotate_symbol),u_aspect_ratio:new s.b8(S,o.u_aspect_ratio),u_fade_change:new s.b8(S,o.u_fade_change),u_label_plane_matrix:new s.bH(S,o.u_label_plane_matrix),u_coord_matrix:new s.bH(S,o.u_coord_matrix),u_is_text:new s.bF(S,o.u_is_text),u_pitch_with_map:new s.bF(S,o.u_pitch_with_map),u_is_along_line:new s.bF(S,o.u_is_along_line),u_is_variable_anchor:new s.bF(S,o.u_is_variable_anchor),u_texsize:new s.bK(S,o.u_texsize),u_texture:new s.bF(S,o.u_texture),u_translation:new s.bK(S,o.u_translation),u_pitched_scale:new s.b8(S,o.u_pitched_scale)}),symbolSDF:(S,o)=>({u_is_size_zoom_constant:new s.bF(S,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bF(S,o.u_is_size_feature_constant),u_size_t:new s.b8(S,o.u_size_t),u_size:new s.b8(S,o.u_size),u_camera_to_center_distance:new s.b8(S,o.u_camera_to_center_distance),u_pitch:new s.b8(S,o.u_pitch),u_rotate_symbol:new s.bF(S,o.u_rotate_symbol),u_aspect_ratio:new s.b8(S,o.u_aspect_ratio),u_fade_change:new s.b8(S,o.u_fade_change),u_label_plane_matrix:new s.bH(S,o.u_label_plane_matrix),u_coord_matrix:new s.bH(S,o.u_coord_matrix),u_is_text:new s.bF(S,o.u_is_text),u_pitch_with_map:new s.bF(S,o.u_pitch_with_map),u_is_along_line:new s.bF(S,o.u_is_along_line),u_is_variable_anchor:new s.bF(S,o.u_is_variable_anchor),u_texsize:new s.bK(S,o.u_texsize),u_texture:new s.bF(S,o.u_texture),u_gamma_scale:new s.b8(S,o.u_gamma_scale),u_device_pixel_ratio:new s.b8(S,o.u_device_pixel_ratio),u_is_halo:new s.bF(S,o.u_is_halo),u_translation:new s.bK(S,o.u_translation),u_pitched_scale:new s.b8(S,o.u_pitched_scale)}),symbolTextAndIcon:(S,o)=>({u_is_size_zoom_constant:new s.bF(S,o.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bF(S,o.u_is_size_feature_constant),u_size_t:new s.b8(S,o.u_size_t),u_size:new s.b8(S,o.u_size),u_camera_to_center_distance:new s.b8(S,o.u_camera_to_center_distance),u_pitch:new s.b8(S,o.u_pitch),u_rotate_symbol:new s.bF(S,o.u_rotate_symbol),u_aspect_ratio:new s.b8(S,o.u_aspect_ratio),u_fade_change:new s.b8(S,o.u_fade_change),u_label_plane_matrix:new s.bH(S,o.u_label_plane_matrix),u_coord_matrix:new s.bH(S,o.u_coord_matrix),u_is_text:new s.bF(S,o.u_is_text),u_pitch_with_map:new s.bF(S,o.u_pitch_with_map),u_is_along_line:new s.bF(S,o.u_is_along_line),u_is_variable_anchor:new s.bF(S,o.u_is_variable_anchor),u_texsize:new s.bK(S,o.u_texsize),u_texsize_icon:new s.bK(S,o.u_texsize_icon),u_texture:new s.bF(S,o.u_texture),u_texture_icon:new s.bF(S,o.u_texture_icon),u_gamma_scale:new s.b8(S,o.u_gamma_scale),u_device_pixel_ratio:new s.b8(S,o.u_device_pixel_ratio),u_is_halo:new s.bF(S,o.u_is_halo),u_translation:new s.bK(S,o.u_translation),u_pitched_scale:new s.b8(S,o.u_pitched_scale)}),background:(S,o)=>({u_opacity:new s.b8(S,o.u_opacity),u_color:new s.bG(S,o.u_color)}),backgroundPattern:(S,o)=>({u_opacity:new s.b8(S,o.u_opacity),u_image:new s.bF(S,o.u_image),u_pattern_tl_a:new s.bK(S,o.u_pattern_tl_a),u_pattern_br_a:new s.bK(S,o.u_pattern_br_a),u_pattern_tl_b:new s.bK(S,o.u_pattern_tl_b),u_pattern_br_b:new s.bK(S,o.u_pattern_br_b),u_texsize:new s.bK(S,o.u_texsize),u_mix:new s.b8(S,o.u_mix),u_pattern_size_a:new s.bK(S,o.u_pattern_size_a),u_pattern_size_b:new s.bK(S,o.u_pattern_size_b),u_scale_a:new s.b8(S,o.u_scale_a),u_scale_b:new s.b8(S,o.u_scale_b),u_pixel_coord_upper:new s.bK(S,o.u_pixel_coord_upper),u_pixel_coord_lower:new s.bK(S,o.u_pixel_coord_lower),u_tile_units_to_pixels:new s.b8(S,o.u_tile_units_to_pixels)}),terrain:(S,o)=>({u_texture:new s.bF(S,o.u_texture),u_ele_delta:new s.b8(S,o.u_ele_delta),u_fog_matrix:new s.bH(S,o.u_fog_matrix),u_fog_color:new s.bG(S,o.u_fog_color),u_fog_ground_blend:new s.b8(S,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.b8(S,o.u_fog_ground_blend_opacity),u_horizon_color:new s.bG(S,o.u_horizon_color),u_horizon_fog_blend:new s.b8(S,o.u_horizon_fog_blend),u_is_globe_mode:new s.b8(S,o.u_is_globe_mode)}),terrainDepth:(S,o)=>({u_ele_delta:new s.b8(S,o.u_ele_delta)}),terrainCoords:(S,o)=>({u_texture:new s.bF(S,o.u_texture),u_terrain_coords_id:new s.b8(S,o.u_terrain_coords_id),u_ele_delta:new s.b8(S,o.u_ele_delta)}),projectionErrorMeasurement:(S,o)=>({u_input:new s.b8(S,o.u_input),u_output_expected:new s.b8(S,o.u_output_expected)}),atmosphere:(S,o)=>({u_sun_pos:new s.bJ(S,o.u_sun_pos),u_atmosphere_blend:new s.b8(S,o.u_atmosphere_blend),u_globe_position:new s.bJ(S,o.u_globe_position),u_globe_radius:new s.b8(S,o.u_globe_radius),u_inv_proj_matrix:new s.bH(S,o.u_inv_proj_matrix)}),sky:(S,o)=>({u_sky_color:new s.bG(S,o.u_sky_color),u_horizon_color:new s.bG(S,o.u_horizon_color),u_horizon:new s.bK(S,o.u_horizon),u_horizon_normal:new s.bK(S,o.u_horizon_normal),u_sky_horizon_blend:new s.b8(S,o.u_sky_horizon_blend),u_sky_blend:new s.b8(S,o.u_sky_blend)})};class be{constructor(o,u,_){this.context=o;let v=o.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){let u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let wd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yA{constructor(o,u,_,v){this.length=u.length,this.attributes=_,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=o;let C=o.gl;this.buffer=C.createBuffer(),o.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let _=0;_<this.attributes.length;_++){let v=u.attributes[this.attributes[_].name];v!==void 0&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,u,_){for(let v=0;v<this.attributes.length;v++){let C=this.attributes[v],O=u.attributes[C.name];O!==void 0&&o.vertexAttribPointer(O,C.components,o[wd[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ci{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kl extends Ci{getDefault(){return s.b7.transparent}set(o){let u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Td extends Ci{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class jm extends Ci{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class xA extends Ci{getDefault(){return[!0,!0,!0,!0]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class bA extends Ci{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class vA extends Ci{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class la extends Ci{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class ts extends Ci{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class $h extends Ci{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class qh extends Ci{getDefault(){return[0,1]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Zh extends Ci{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class Vu extends Ci{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Ed extends Ci{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class Fl extends Ci{getDefault(){let o=this.gl;return[o.ONE,o.ZERO]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Mc extends Ci{getDefault(){return s.b7.transparent}set(o){let u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Ai extends Ci{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Xh extends Ci{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class Sd extends Ci{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Cd extends Ci{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Nl extends Ci{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Yh extends Ci{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class ju extends Ci{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class zl extends Ci{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Rc extends Ci{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class wA extends Ci{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Bc extends Ci{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Ul extends Ci{getDefault(){return null}set(o){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Id extends Ci{getDefault(){return null}set(o){var u;if(o===this.current&&!this.dirty)return;let _=this.gl;ia(_)?_.bindVertexArray(o):(u=_.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Kh extends Ci{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class wi extends Ci{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Qh extends Ci{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Pd extends Ci{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class ls extends Pd{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Uo extends Pd{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class zs extends Pd{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}let Jh="Framebuffer is not complete";class Md{constructor(o,u,_,v,C){this.context=o,this.width=u,this.height=_;let O=o.gl,N=this.framebuffer=O.createFramebuffer();if(this.colorAttachment=new ls(o,N),v)this.depthAttachment=C?new zs(o,N):new Uo(o,N);else if(C)throw new Error("Stencil cannot be set without depth");if(O.checkFramebufferStatus(O.FRAMEBUFFER)!==O.FRAMEBUFFER_COMPLETE)throw new Error(Jh)}destroy(){let o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){let _=this.depthAttachment.get();_&&o.deleteRenderbuffer(_)}o.deleteFramebuffer(this.framebuffer)}}class ef{constructor(o){var u,_;if(this.gl=o,this.clearColor=new kl(this),this.clearDepth=new Td(this),this.clearStencil=new jm(this),this.colorMask=new xA(this),this.depthMask=new bA(this),this.stencilMask=new vA(this),this.stencilFunc=new la(this),this.stencilOp=new ts(this),this.stencilTest=new $h(this),this.depthRange=new qh(this),this.depthTest=new Zh(this),this.depthFunc=new Vu(this),this.blend=new Ed(this),this.blendFunc=new Fl(this),this.blendColor=new Mc(this),this.blendEquation=new Ai(this),this.cullFace=new Xh(this),this.cullFaceSide=new Sd(this),this.frontFace=new Cd(this),this.program=new Nl(this),this.activeTexture=new Yh(this),this.viewport=new ju(this),this.bindFramebuffer=new zl(this),this.bindRenderbuffer=new Rc(this),this.bindTexture=new wA(this),this.bindVertexBuffer=new Bc(this),this.bindElementBuffer=new Ul(this),this.bindVertexArray=new Id(this),this.pixelStoreUnpack=new Kh(this),this.pixelStoreUnpackPremultiplyAlpha=new wi(this),this.pixelStoreUnpackFlipY=new Qh(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),ia(o)){this.HALF_FLOAT=o.HALF_FLOAT;let v=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=o.RGBA16F)!==null&&u!==void 0?u:v?.RGBA16F_EXT,this.RGB16F=(_=o.RGB16F)!==null&&_!==void 0?_:v?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");let v=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=v?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new be(this,o,u)}createVertexBuffer(o,u,_){return new yA(this,o,u,_)}createRenderbuffer(o,u,_){let v=this.gl,C=v.createRenderbuffer();return this.bindRenderbuffer.set(C),v.renderbufferStorage(v.RENDERBUFFER,o,u,_),this.bindRenderbuffer.set(null),C}createFramebuffer(o,u,_,v){return new Md(this,o,u,_,v)}clear({color:o,depth:u,stencil:_}){let v=this.gl,C=0;o&&(C|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(C|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),_!==void 0&&(C|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),v.clear(C)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){s.bC(o.blendFunction,fn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return ia(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var u;return ia(this.gl)?this.gl.deleteVertexArray(o):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}let Lc;function Gu(S,o,u,_,v){let C=S.context,O=S.transform,N=C.gl,V=S.useProgram("collisionBox"),H=[],K=0,ne=0;for(let Me=0;Me<_.length;Me++){let ke=_[Me],Ve=o.getTile(ke).getBucket(u);if(!Ve)continue;let Be=v?Ve.textCollisionBox:Ve.iconCollisionBox,qe=Ve.collisionCircleArray;qe.length>0&&(H.push({circleArray:qe,circleOffset:ne,coord:ke}),K+=qe.length/4,ne=K),Be&&V.draw(C,N.LINES,ei.disabled,_i.disabled,S.colorModeForRenderPass(),Bi.disabled,Ui(S.transform),S.style.map.terrain&&S.style.map.terrain.getTerrainData(ke),O.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,S.transform.zoom,null,null,Be.collisionVertexBuffer)}if(!v||!H.length)return;let ie=S.useProgram("collisionCircle"),fe=new s.bP;fe.resize(4*K),fe._trim();let Ae=0;for(let Me of H)for(let ke=0;ke<Me.circleArray.length/4;ke++){let Ve=4*ke,Be=Me.circleArray[Ve+0],qe=Me.circleArray[Ve+1],Ge=Me.circleArray[Ve+2],Ze=Me.circleArray[Ve+3];fe.emplace(Ae++,Be,qe,Ge,Ze,0),fe.emplace(Ae++,Be,qe,Ge,Ze,1),fe.emplace(Ae++,Be,qe,Ge,Ze,2),fe.emplace(Ae++,Be,qe,Ge,Ze,3)}(!Lc||Lc.length<2*K)&&(Lc=function(Me){let ke=2*Me,Ve=new s.bR;Ve.resize(ke),Ve._trim();for(let Be=0;Be<ke;Be++){let qe=6*Be;Ve.uint16[qe+0]=4*Be+0,Ve.uint16[qe+1]=4*Be+1,Ve.uint16[qe+2]=4*Be+2,Ve.uint16[qe+3]=4*Be+2,Ve.uint16[qe+4]=4*Be+3,Ve.uint16[qe+5]=4*Be+0}return Ve}(K));let Ie=C.createIndexBuffer(Lc,!0),Se=C.createVertexBuffer(fe,s.bQ.members,!0);for(let Me of H){let ke=dn(S.transform);ie.draw(C,N.TRIANGLES,ei.disabled,_i.disabled,S.colorModeForRenderPass(),Bi.disabled,ke,S.style.map.terrain&&S.style.map.terrain.getTerrainData(Me.coord),null,u.id,Se,Ie,s.aG.simpleSegment(0,2*Me.circleOffset,Me.circleArray.length,Me.circleArray.length/2),null,S.transform.zoom,null,null,null)}Se.destroy(),Ie.destroy()}let tf=s.at(new Float32Array(16));function rf(S,o,u,_,v,C){let{horizontalAlign:O,verticalAlign:N}=s.aB(S);return new s.P((-(O-.5)*o/v+_[0])*C,(-(N-.5)*u/v+_[1])*C)}function Oc(S,o,u,_,v,C){let O=o.tileAnchorPoint.add(new s.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let N=_.mult(C);u||(N=N.rotate(-v));let V=O.add(N);return Pt(V.x,V.y,o.pitchedLabelPlaneMatrix,o.getElevation).point}if(u){let N=pi(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(S),V=Math.atan(N.y/N.x)+(N.x<0?Math.PI:0);return S.add(_.rotate(V))}return S.add(_)}function Ka(S,o,u,_,v,C,O,N,V,H,K,ne){let ie=S.text.placedSymbolArray,fe=S.text.dynamicLayoutVertexArray,Ae=S.icon.dynamicLayoutVertexArray,Ie={};fe.clear();for(let Se=0;Se<ie.length;Se++){let Me=ie.get(Se),ke=Me.hidden||!Me.crossTileID||S.allowVerticalPlacement&&!Me.placedOrientation?null:_[Me.crossTileID];if(ke){let Ve=new s.P(Me.anchorX,Me.anchorY),Be={getElevation:ne,width:v.width,height:v.height,pitchedLabelPlaneMatrix:C,pitchWithMap:u,transform:v,tileAnchorPoint:Ve,translation:H,unwrappedTileID:K},qe=u?dr(Ve.x,Ve.y,Be):pi(Ve.x,Ve.y,Be),Ge=ut(v.cameraToCenterDistance,qe.signedDistanceFromCamera),Ze=s.ai(S.textSizeData,N,Me)*Ge/s.av;u&&(Ze*=S.tilePixelRatio/O);let{width:_t,height:At,anchor:Mt,textOffset:Lt,textBoxScale:Tt}=ke,er=rf(Mt,_t,At,Lt,Tt,Ze),Kt=v.getPitchedTextCorrection(Ve.x+H[0],Ve.y+H[1],K),Ut=Oc(qe.point,Be,o,er,-v.bearingInRadians,Kt),mt=S.allowVerticalPlacement&&Me.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let Nt=0;Nt<Me.numGlyphs;Nt++)s.ao(fe,Ut,mt);V&&Me.associatedIconIndex>=0&&(Ie[Me.associatedIconIndex]={shiftedAnchor:Ut,angle:mt})}else Pr(Me.numGlyphs,fe)}if(V){Ae.clear();let Se=S.icon.placedSymbolArray;for(let Me=0;Me<Se.length;Me++){let ke=Se.get(Me);if(ke.hidden)Pr(ke.numGlyphs,Ae);else{let Ve=Ie[Me];if(Ve)for(let Be=0;Be<ke.numGlyphs;Be++)s.ao(Ae,Ve.shiftedAnchor,Ve.angle);else Pr(ke.numGlyphs,Ae)}}S.icon.dynamicLayoutVertexBuffer.updateData(Ae)}S.text.dynamicLayoutVertexBuffer.updateData(fe)}function Hu(S,o,u){return u.iconsInText&&o?"symbolTextAndIcon":S?"symbolSDF":"symbolIcon"}function Dc(S,o,u,_,v,C,O,N,V,H,K,ne,ie){let fe=S.context,Ae=fe.gl,Ie=S.transform,Se=N==="map",Me=V==="map",ke=N!=="viewport"&&u.layout.get("symbol-placement")!=="point",Ve=Se&&!Me&&!ke,Be=!u.layout.get("symbol-sort-key").isConstant(),qe=!1,Ge=S.getDepthModeForSublayer(0,ei.ReadOnly),Ze=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_t=[],At=Ie.getCircleRadiusCorrection();for(let Mt of _){let Lt=o.getTile(Mt),Tt=Lt.getBucket(u);if(!Tt)continue;let er=v?Tt.text:Tt.icon;if(!er||!er.segments.get().length||!er.hasVisibleVertices)continue;let Kt=er.programConfigurations.get(u.id),Ut=v||Tt.sdfIcons,mt=v?Tt.textSizeData:Tt.iconSizeData,Nt=Me||Ie.pitch!==0,Ii=S.useProgram(Hu(Ut,v,Tt),Kt),Gr=s.ag(mt,Ie.zoom),ki=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Mt),Wi,Fi,ji,yi,m=[0,0],A=null;if(v)Fi=Lt.glyphAtlasTexture,ji=Ae.LINEAR,Wi=Lt.glyphAtlasTexture.size,Tt.iconsInText&&(m=Lt.imageAtlasTexture.size,A=Lt.imageAtlasTexture,yi=Nt||S.options.rotating||S.options.zooming||mt.kind==="composite"||mt.kind==="camera"?Ae.LINEAR:Ae.NEAREST);else{let nt=u.layout.get("icon-size").constantOr(0)!==1||Tt.iconsNeedLinear;Fi=Lt.imageAtlasTexture,ji=Ut||S.options.rotating||S.options.zooming||nt||Nt?Ae.LINEAR:Ae.NEAREST,Wi=Lt.imageAtlasTexture.size}let x=s.aw(Lt,1,S.transform.zoom),E=dt(Se,S.transform,x),P=s.K();s.aj(P,E);let R=it(Me,Se,S.transform,x),k=s.ax(Ie,Lt,C,O),F=Ie.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!ie,applyTerrainMatrix:!0}),W=Ze&&Tt.hasTextData(),Q=u.layout.get("icon-text-fit")!=="none"&&W&&Tt.hasIconData();if(ke){let nt=S.style.map.terrain?(wt,at)=>S.style.map.terrain.getElevation(Mt,wt,at):null,It=u.layout.get("text-rotation-alignment")==="map";rr(Tt,S,v,E,P,Me,H,It,Mt.toUnwrapped(),Ie.width,Ie.height,k,nt)}let he=v&&Ze||Q,we=ke||he?tf:Me?E:S.transform.clipSpaceToPixelsMatrix,$e=Ut&&u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Qe;Qe=Ut?Tt.iconsInText?Hh(mt.kind,Gr,Ve,Me,ke,he,S,we,R,k,Wi,m,At):Fr(mt.kind,Gr,Ve,Me,ke,he,S,we,R,k,v,Wi,0,At):Pe(mt.kind,Gr,Ve,Me,ke,he,S,we,R,k,v,Wi,At);let Ue={program:Ii,buffers:er,uniformValues:Qe,projectionData:F,atlasTexture:Fi,atlasTextureIcon:A,atlasInterpolation:ji,atlasInterpolationIcon:yi,isSDF:Ut,hasHalo:$e};if(Be&&Tt.canOverlap){qe=!0;let nt=er.segments.get();for(let It of nt)_t.push({segments:new s.aG([It]),sortKey:It.sortKey,state:Ue,terrainData:ki})}else _t.push({segments:er.segments,sortKey:0,state:Ue,terrainData:ki})}qe&&_t.sort((Mt,Lt)=>Mt.sortKey-Lt.sortKey);for(let Mt of _t){let Lt=Mt.state;if(fe.activeTexture.set(Ae.TEXTURE0),Lt.atlasTexture.bind(Lt.atlasInterpolation,Ae.CLAMP_TO_EDGE),Lt.atlasTextureIcon&&(fe.activeTexture.set(Ae.TEXTURE1),Lt.atlasTextureIcon&&Lt.atlasTextureIcon.bind(Lt.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),Lt.isSDF){let Tt=Lt.uniformValues;Lt.hasHalo&&(Tt.u_is_halo=1,Vl(Lt.buffers,Mt.segments,u,S,Lt.program,Ge,K,ne,Tt,Lt.projectionData,Mt.terrainData)),Tt.u_is_halo=0}Vl(Lt.buffers,Mt.segments,u,S,Lt.program,Ge,K,ne,Lt.uniformValues,Lt.projectionData,Mt.terrainData)}}function Vl(S,o,u,_,v,C,O,N,V,H,K){let ne=_.context;v.draw(ne,ne.gl.TRIANGLES,C,O,N,Bi.backCCW,V,K,H,u.id,S.layoutVertexBuffer,S.indexBuffer,o,u.paint,_.transform.zoom,S.programConfigurations.get(u.id),S.dynamicLayoutVertexBuffer,S.opacityVertexBuffer)}function jl(S,o,u,_,v){let C=S.context,O=C.gl,N=_i.disabled,V=new fn([O.ONE,O.ONE],s.b7.transparent,[!0,!0,!0,!0]),H=o.getBucket(u);if(!H)return;let K=_.key,ne=u.heatmapFbos.get(K);ne||(ne=Rd(C,o.tileSize,o.tileSize),u.heatmapFbos.set(K,ne)),C.bindFramebuffer.set(ne.framebuffer),C.viewport.set([0,0,o.tileSize,o.tileSize]),C.clear({color:s.b7.transparent});let ie=H.programConfigurations.get(u.id),fe=S.useProgram("heatmap",ie,!v),Ae=S.transform.getProjectionData({overscaledTileID:o.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ie=S.style.map.terrain.getTerrainData(_);fe.draw(C,O.TRIANGLES,ei.disabled,N,V,Bi.disabled,vi(o,S.transform.zoom,u.paint.get("heatmap-intensity"),1),Ie,Ae,u.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,u.paint,S.transform.zoom,ie)}function ca(S,o,u,_,v){let C=S.context,O=C.gl,N=S.transform;C.setColorMode(S.colorModeForRenderPass());let V=nf(C,o),H=u.key,K=o.heatmapFbos.get(H);if(!K)return;C.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,K.colorAttachment.get()),C.activeTexture.set(O.TEXTURE1),V.bind(O.LINEAR,O.CLAMP_TO_EDGE);let ne=N.getProjectionData({overscaledTileID:u,applyTerrainMatrix:v,applyGlobeMatrix:!_});S.useProgram("heatmapTexture").draw(C,O.TRIANGLES,ei.disabled,_i.disabled,S.colorModeForRenderPass(),Bi.disabled,Si(S,o,0,1),null,ne,o.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments,o.paint,N.zoom),K.destroy(),o.heatmapFbos.delete(H)}function Rd(S,o,u){var _,v;let C=S.gl,O=C.createTexture();C.bindTexture(C.TEXTURE_2D,O),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.LINEAR),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.LINEAR);let N=(_=S.HALF_FLOAT)!==null&&_!==void 0?_:C.UNSIGNED_BYTE,V=(v=S.RGBA16F)!==null&&v!==void 0?v:C.RGBA;C.texImage2D(C.TEXTURE_2D,0,V,o,u,0,C.RGBA,N,null);let H=S.createFramebuffer(o,u,!1,!1);return H.colorAttachment.set(O),H}function nf(S,o){return o.colorRampTexture||(o.colorRampTexture=new je(S,o.colorRamp,S.gl.RGBA)),o.colorRampTexture}function Gl(S,o,u,_,v){if(!u||!_||!_.imageAtlas)return;let C=_.imageAtlas.patternPositions,O=C[u.to.toString()],N=C[u.from.toString()];if(!O&&N&&(O=N),!N&&O&&(N=O),!O||!N){let V=v.getPaintProperty(o);O=C[V],N=C[V]}O&&N&&S.setConstantPatternPositions(O,N)}function sf(S,o,u,_,v,C,O,N){let V=S.context.gl,H="fill-pattern",K=u.paint.get(H),ne=K&&K.constantOr(1),ie=u.getCrossfadeParameters(),fe,Ae,Ie,Se,Me,ke=S.transform,Ve=u.paint.get("fill-translate"),Be=u.paint.get("fill-translate-anchor");O?(Ae=ne&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",fe=V.LINES):(Ae=ne?"fillPattern":"fill",fe=V.TRIANGLES);let qe=K.constantOr(null);for(let Ge of _){let Ze=o.getTile(Ge);if(ne&&!Ze.patternsLoaded())continue;let _t=Ze.getBucket(u);if(!_t)continue;let At=_t.programConfigurations.get(u.id),Mt=S.useProgram(Ae,At),Lt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Ge);ne&&(S.context.activeTexture.set(V.TEXTURE0),Ze.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),At.updatePaintBuffers(ie)),Gl(At,H,qe,Ze,u);let Tt=ke.getProjectionData({overscaledTileID:Ge,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),er=s.ax(ke,Ze,Ve,Be);if(O){Se=_t.indexBuffer2,Me=_t.segments2;let Ut=[V.drawingBufferWidth,V.drawingBufferHeight];Ie=Ae==="fillOutlinePattern"&&ne?Js(S,ie,Ze,Ut,er):En(Ut,er)}else Se=_t.indexBuffer,Me=_t.segments,Ie=ne?Ee(S,ie,Ze,er):{u_fill_translate:er};let Kt;if(S.renderPass==="translucent"&&N){let[Ut]=S.getStencilConfigForOverlapAndUpdateStencilID(_);Kt=Ut[Ge.overscaledZ]}else Kt=S.stencilModeForClipping(Ge);Mt.draw(S.context,fe,v,Kt,C,Bi.backCCW,Ie,Lt,Tt,u.id,_t.layoutVertexBuffer,Se,Me,u.paint,S.transform.zoom,At)}}function of(S,o,u,_,v,C,O,N){let V=S.context,H=V.gl,K="fill-extrusion-pattern",ne=u.paint.get(K),ie=ne.constantOr(1),fe=u.getCrossfadeParameters(),Ae=u.paint.get("fill-extrusion-opacity"),Ie=ne.constantOr(null),Se=S.transform;for(let Me of _){let ke=o.getTile(Me),Ve=ke.getBucket(u);if(!Ve)continue;let Be=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Me),qe=Ve.programConfigurations.get(u.id),Ge=S.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",qe);ie&&(S.context.activeTexture.set(H.TEXTURE0),ke.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),qe.updatePaintBuffers(fe));let Ze=Se.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!N,applyTerrainMatrix:!0});Gl(qe,K,Ie,ke,u);let _t=s.ax(Se,ke,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),At=u.paint.get("fill-extrusion-vertical-gradient"),Mt=ie?Ei(S,At,Ae,_t,Me,fe,ke):qi(S,At,Ae,_t);Ge.draw(V,V.gl.TRIANGLES,v,C,O,Bi.backCCW,Mt,Be,Ze,u.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,u.paint,S.transform.zoom,qe,S.style.map.terrain&&Ve.centroidVertexBuffer)}}function Wu(S,o,u,_,v,C,O,N,V){var H;let K=S.style.projection,ne=S.context,ie=S.transform,fe=ne.gl,Ae=S.useProgram("hillshade"),Ie=!S.options.moving;for(let Se of _){let Me=o.getTile(Se),ke=Me.fbo;if(!ke)continue;let Ve=K.getMeshFromTileID(ne,Se.canonical,N,!0,"raster"),Be=(H=S.style.map.terrain)===null||H===void 0?void 0:H.getTerrainData(Se);ne.activeTexture.set(fe.TEXTURE0),fe.bindTexture(fe.TEXTURE_2D,ke.colorAttachment.get());let qe=ie.getProjectionData({overscaledTileID:Se,aligned:Ie,applyGlobeMatrix:!V,applyTerrainMatrix:!0});Ae.draw(ne,fe.TRIANGLES,C,v[Se.overscaledZ],O,Bi.backCCW,Ic(S,Me,u),Be,qe,u.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}let kc=[new s.P(0,0),new s.P(s.Z,0),new s.P(s.Z,s.Z),new s.P(0,s.Z)];function Fc(S,o,u,_,v,C,O,N,V=!1,H=!1){let K=_[_.length-1].overscaledZ,ne=S.context,ie=ne.gl,fe=S.useProgram("raster"),Ae=S.transform,Ie=S.style.projection,Se=S.colorModeForRenderPass(),Me=!S.options.moving;for(let ke of _){let Ve=S.getDepthModeForSublayer(ke.overscaledZ-K,u.paint.get("raster-opacity")===1?ei.ReadWrite:ei.ReadOnly,ie.LESS),Be=o.getTile(ke);Be.registerFadeDuration(u.paint.get("raster-fade-duration"));let qe=o.findLoadedParent(ke,0),Ge=o.findLoadedSibling(ke),Ze=Gm(Be,qe||Ge||null,o,u,S.transform,S.style.map.terrain),_t,At,Mt=u.paint.get("raster-resampling")==="nearest"?ie.NEAREST:ie.LINEAR;ne.activeTexture.set(ie.TEXTURE0),Be.texture.bind(Mt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),ne.activeTexture.set(ie.TEXTURE1),qe?(qe.texture.bind(Mt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),_t=Math.pow(2,qe.tileID.overscaledZ-Be.tileID.overscaledZ),At=[Be.tileID.canonical.x*_t%1,Be.tileID.canonical.y*_t%1]):Be.texture.bind(Mt,ie.CLAMP_TO_EDGE,ie.LINEAR_MIPMAP_NEAREST),Be.texture.useMipmap&&ne.extTextureFilterAnisotropic&&S.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);let Lt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(ke),Tt=Ae.getProjectionData({overscaledTileID:ke,aligned:Me,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),er=Dl(At||[0,0],_t||1,Ze,u,N),Kt=Ie.getMeshFromTileID(ne,ke.canonical,C,O,"raster");fe.draw(ne,ie.TRIANGLES,Ve,v?v[ke.overscaledZ]:_i.disabled,Se,V?Bi.frontCCW:Bi.backCCW,er,Lt,Tt,u.id,Kt.vertexBuffer,Kt.indexBuffer,Kt.segments)}}function Gm(S,o,u,_,v,C){let O=_.paint.get("raster-fade-duration");if(!C&&O>0){let N=b.now(),V=(N-S.timeAdded)/O,H=o?(N-o.timeAdded)/O:-1,K=u.getSource(),ne=Mn(v,{tileSize:K.tileSize,roundZoom:K.roundZoom}),ie=!o||Math.abs(o.tileID.overscaledZ-ne)>Math.abs(S.tileID.overscaledZ-ne),fe=ie&&S.refreshedUponExpiration?1:s.ae(ie?V:1-H,0,1);return S.refreshedUponExpiration&&V>=1&&(S.refreshedUponExpiration=!1),o?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}let TA=new s.b7(1,0,0,1),Rn=new s.b7(0,1,0,1),Hl=new s.b7(0,0,1,1),So=new s.b7(1,0,1,1),Bd=new s.b7(0,1,1,1);function Wl(S,o,u,_){Ea(S,0,o+u/2,S.transform.width,u,_)}function Ld(S,o,u,_){Ea(S,o-u/2,0,u,S.transform.height,_)}function Ea(S,o,u,_,v,C){let O=S.context,N=O.gl;N.enable(N.SCISSOR_TEST),N.scissor(o*S.pixelRatio,u*S.pixelRatio,_*S.pixelRatio,v*S.pixelRatio),O.clear({color:C}),N.disable(N.SCISSOR_TEST)}function $u(S,o,u){let _=S.context,v=_.gl,C=S.useProgram("debug"),O=ei.disabled,N=_i.disabled,V=S.colorModeForRenderPass(),H="$debug",K=S.style.map.terrain&&S.style.map.terrain.getTerrainData(u);_.activeTexture.set(v.TEXTURE0);let ne=o.getTileByID(u.key).latestRawTileData,ie=Math.floor((ne&&ne.byteLength||0)/1024),fe=o.getTile(u).tileSize,Ae=512/Math.min(fe,512)*(u.overscaledZ/S.transform.zoom)*.5,Ie=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Ie+=` => ${u.overscaledZ}`),function(Me,ke){Me.initDebugOverlayCanvas();let Ve=Me.debugOverlayCanvas,Be=Me.context.gl,qe=Me.debugOverlayCanvas.getContext("2d");qe.clearRect(0,0,Ve.width,Ve.height),qe.shadowColor="white",qe.shadowBlur=2,qe.lineWidth=1.5,qe.strokeStyle="white",qe.textBaseline="top",qe.font="bold 36px Open Sans, sans-serif",qe.fillText(ke,5,5),qe.strokeText(ke,5,5),Me.debugOverlayTexture.update(Ve),Me.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(S,`${Ie} ${ie}kB`);let Se=S.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(_,v.TRIANGLES,O,N,fn.alphaBlended,Bi.disabled,kn(s.b7.transparent,Ae),null,Se,H,S.debugBuffer,S.quadTriangleIndexBuffer,S.debugSegments),C.draw(_,v.LINE_STRIP,O,N,V,Bi.disabled,kn(s.b7.red),K,Se,H,S.debugBuffer,S.tileBorderIndexBuffer,S.debugSegments)}function Qa(S,o,u,_){let{isRenderingGlobe:v}=_,C=S.context,O=C.gl,N=S.transform,V=S.colorModeForRenderPass(),H=S.getDepthModeFor3D(),K=S.useProgram("terrain");C.bindFramebuffer.set(null),C.viewport.set([0,0,S.width,S.height]);for(let ne of u){let ie=o.getTerrainMesh(ne.tileID),fe=S.renderToTexture.getTexture(ne),Ae=o.getTerrainData(ne.tileID);C.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,fe.texture);let Ie=o.getMeshFrameDelta(N.zoom),Se=N.calculateFogMatrix(ne.tileID.toUnwrapped()),Me=gt(Ie,Se,S.style.sky,N.pitch,v),ke=N.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(C,O.TRIANGLES,H,_i.disabled,V,Bi.backCCW,Me,Ae,ke,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}}function Od(S,o){if(!o.mesh){let u=new s.aF;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);let _=new s.aH;_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),o.mesh=new Sc(S.createVertexBuffer(u,Ml.members),S.createIndexBuffer(_),s.aG.simpleSegment(0,0,u.length,_.length))}return o.mesh}class af{constructor(o,u){this.context=new ef(o),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.at(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=de.maxUnderzooming+de.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new md}resize(o,u,_){if(this.width=Math.floor(o*_),this.height=Math.floor(u*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let v of this.style._order)this.style._layers[v].resize()}setup(){let o=this.context,u=new s.aF;u.emplaceBack(0,0),u.emplaceBack(s.Z,0),u.emplaceBack(0,s.Z),u.emplaceBack(s.Z,s.Z),this.tileExtentBuffer=o.createVertexBuffer(u,Ml.members),this.tileExtentSegments=s.aG.simpleSegment(0,0,4,2);let _=new s.aF;_.emplaceBack(0,0),_.emplaceBack(s.Z,0),_.emplaceBack(0,s.Z),_.emplaceBack(s.Z,s.Z),this.debugBuffer=o.createVertexBuffer(_,Ml.members),this.debugSegments=s.aG.simpleSegment(0,0,4,5);let v=new s.bW;v.emplaceBack(0,0,0,0),v.emplaceBack(s.Z,0,s.Z,0),v.emplaceBack(0,s.Z,0,s.Z),v.emplaceBack(s.Z,s.Z,s.Z,s.Z),this.rasterBoundsBuffer=o.createVertexBuffer(v,Uu.members),this.rasterBoundsSegments=s.aG.simpleSegment(0,0,4,2);let C=new s.aF;C.emplaceBack(0,0),C.emplaceBack(s.Z,0),C.emplaceBack(0,s.Z),C.emplaceBack(s.Z,s.Z),this.rasterBoundsBufferPosOnly=o.createVertexBuffer(C,Ml.members),this.rasterBoundsSegmentsPosOnly=s.aG.simpleSegment(0,0,4,5);let O=new s.aF;O.emplaceBack(0,0),O.emplaceBack(1,0),O.emplaceBack(0,1),O.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(O,Ml.members),this.viewportSegments=s.aG.simpleSegment(0,0,4,2);let N=new s.bX;N.emplaceBack(0),N.emplaceBack(1),N.emplaceBack(3),N.emplaceBack(2),N.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(N);let V=new s.aH;V.emplaceBack(1,0,2),V.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(V);let H=this.context.gl;this.stencilClearMode=new _i({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.tileExtentMesh=new Sc(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let _=s.K();s.bO(_,0,this.width,this.height,0,0,1),s.M(_,_,[u.drawingBufferWidth,u.drawingBufferHeight,0]);let v={mainMatrix:_,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:_};this.useProgram("clippingMask",null,!0).draw(o,u.TRIANGLES,ei.disabled,this.stencilClearMode,fn.disabled,Bi.disabled,null,null,v,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,u,_){if(this.currentStencilSource===o.source||!o.isTileClipped()||!u||!u.length)return;this.currentStencilSource=o.source,this.nextStencilID+u.length>256&&this.clearStencil();let v=this.context;v.setColorMode(fn.disabled),v.setDepthMode(ei.disabled);let C={};for(let O of u)C[O.key]=this.nextStencilID++;this._renderTileMasks(C,u,_,!0),this._renderTileMasks(C,u,_,!1),this._tileClippingMaskIDs=C}_renderTileMasks(o,u,_,v){let C=this.context,O=C.gl,N=this.style.projection,V=this.transform,H=this.useProgram("clippingMask");for(let K of u){let ne=o[K.key],ie=this.style.map.terrain&&this.style.map.terrain.getTerrainData(K),fe=N.getMeshFromTileID(this.context,K.canonical,v,!0,"stencil"),Ae=V.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!0,applyTerrainMatrix:!0});H.draw(C,O.TRIANGLES,ei.disabled,new _i({func:O.ALWAYS,mask:0},ne,255,O.KEEP,O.KEEP,O.REPLACE),fn.disabled,_?Bi.disabled:Bi.backCCW,null,ie,Ae,"$clipping",fe.vertexBuffer,fe.indexBuffer,fe.segments)}}_renderTilesDepthBuffer(){let o=this.context,u=o.gl,_=this.style.projection,v=this.transform,C=this.useProgram("depth"),O=this.getDepthModeFor3D(),N=ot(v,{tileSize:v.tileSize});for(let V of N){let H=this.style.map.terrain&&this.style.map.terrain.getTerrainData(V),K=_.getMeshFromTileID(this.context,V.canonical,!0,!0,"raster"),ne=v.getProjectionData({overscaledTileID:V,applyGlobeMatrix:!0,applyTerrainMatrix:!0});C.draw(o,u.TRIANGLES,O,_i.disabled,fn.disabled,Bi.backCCW,null,H,ne,"$clipping",K.vertexBuffer,K.indexBuffer,K.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,u=this.context.gl;return new _i({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){let u=this.context.gl;return new _i({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(o){let u=this.context.gl,_=o.sort((O,N)=>N.overscaledZ-O.overscaledZ),v=_[_.length-1].overscaledZ,C=_[0].overscaledZ-v+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();let O={};for(let N=0;N<C;N++)O[N+v]=new _i({func:u.GEQUAL,mask:255},N+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=C,[O,_]}return[{[v]:_i.disabled},_]}stencilConfigForOverlapTwoPass(o){let u=this.context.gl,_=o.sort((O,N)=>N.overscaledZ-O.overscaledZ),v=_[_.length-1].overscaledZ,C=_[0].overscaledZ-v+1;if(this.clearStencil(),C>1){let O={},N={};for(let V=0;V<C;V++)O[V+v]=new _i({func:u.GREATER,mask:255},C+1+V,255,u.KEEP,u.KEEP,u.REPLACE),N[V+v]=new _i({func:u.GREATER,mask:255},1+V,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*C+1,[O,N,_]}return this.nextStencilID=3,[{[v]:new _i({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[v]:new _i({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},_]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new fn([o.CONSTANT_COLOR,o.ONE],new s.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fn.unblended:fn.alphaBlended}getDepthModeForSublayer(o,u,_){if(!this.opaquePassEnabledForLayer())return ei.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new ei(_||this.context.gl.LEQUAL,u,[v,v])}getDepthModeFor3D(){return new ei(this.context.gl.LEQUAL,ei.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){var _,v;this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(b.now()),this.imageManager.beginFrame();let C=this.style._order,O=this.style.sourceCaches,N={},V={},H={},K={isRenderingToTexture:!1,isRenderingGlobe:((_=o.projection)===null||_===void 0?void 0:_.transitionState)>0};for(let ie in O){let fe=O[ie];fe.used&&fe.prepare(this.context),N[ie]=fe.getVisibleCoordinates(!1),V[ie]=N[ie].slice().reverse(),H[ie]=fe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ie=0;ie<C.length;ie++)if(this.style._layers[C[ie]].is3D()){this.opaquePassCutoff=ie;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let ie of C){let fe=this.style._layers[ie];if(!fe.hasOffscreenPass()||fe.isHidden(this.transform.zoom))continue;let Ae=V[fe.source];(fe.type==="custom"||Ae.length)&&this.renderLayer(this,O[fe.source],fe,Ae,K)}if((v=this.style.projection)===null||v===void 0||v.updateGPUdependent({context:this.context,useProgram:ie=>this.useProgram(ie)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?s.b7.black:s.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(ie,fe){let Ae=ie.context,Ie=Ae.gl,Se=((Ge,Ze,_t)=>{let At=Math.cos(Ze.rollInRadians),Mt=Math.sin(Ze.rollInRadians),Lt=Ou(Ze),Tt=Ze.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ge.properties.get("sky-color"),u_horizon_color:Ge.properties.get("horizon-color"),u_horizon:[(Ze.width/2-Lt*Mt)*_t,(Ze.height/2+Lt*At)*_t],u_horizon_normal:[-Mt,At],u_sky_horizon_blend:Ge.properties.get("sky-horizon-blend")*Ze.height/2*_t,u_sky_blend:Tt}})(fe,ie.style.map.transform,ie.pixelRatio),Me=new ei(Ie.LEQUAL,ei.ReadWrite,[0,1]),ke=_i.disabled,Ve=ie.colorModeForRenderPass(),Be=ie.useProgram("sky"),qe=Od(Ae,fe);Be.draw(Ae,Ie.TRIANGLES,Me,ke,Ve,Bi.disabled,Se,null,void 0,"sky",qe.vertexBuffer,qe.indexBuffer,qe.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){let ie=this.style._layers[C[this.currentLayer]],fe=O[ie.source],Ae=N[ie.source];this._renderTileClippingMasks(ie,Ae,!1),this.renderLayer(this,fe,ie,Ae,K)}this.renderPass="translucent";let ne=!1;for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){let ie=this.style._layers[C[this.currentLayer]],fe=O[ie.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ie,K))continue;this.opaquePassEnabledForLayer()||ne||(ne=!0,K.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let Ae=(ie.type==="symbol"?H:V)[ie.source];this._renderTileClippingMasks(ie,N[ie.source],!1),this.renderLayer(this,fe,ie,Ae,K)}if(K.isRenderingGlobe&&function(ie,fe,Ae){let Ie=ie.context,Se=Ie.gl,Me=ie.useProgram("atmosphere"),ke=new ei(Se.LEQUAL,ei.ReadOnly,[0,1]),Ve=ie.transform,Be=function(Tt,er){let Kt=Tt.properties.get("position"),Ut=[-Kt.x,-Kt.y,-Kt.z],mt=s.at(new Float64Array(16));return Tt.properties.get("anchor")==="map"&&(s.a_(mt,mt,er.rollInRadians),s.a$(mt,mt,-er.pitchInRadians),s.a_(mt,mt,er.bearingInRadians),s.a$(mt,mt,er.center.lat*Math.PI/180),s.bm(mt,mt,-er.center.lng*Math.PI/180)),s.bV(Ut,Ut,mt),Ut}(Ae,ie.transform),qe=Ve.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ge=fe.properties.get("atmosphere-blend")*qe.projectionTransition;if(Ge===0)return;let Ze=xd(Ve.worldSize,Ve.center.lat),_t=Ve.inverseProjectionMatrix,At=new Float64Array(4);At[3]=1,s.ap(At,At,Ve.modelViewProjectionMatrix),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1,s.ap(At,At,_t),At[0]/=At[3],At[1]/=At[3],At[2]/=At[3],At[3]=1;let Mt=((Tt,er,Kt,Ut,mt)=>({u_sun_pos:Tt,u_atmosphere_blend:er,u_globe_position:Kt,u_globe_radius:Ut,u_inv_proj_matrix:mt}))(Be,Ge,[At[0],At[1],At[2]],Ze,_t),Lt=Od(Ie,fe);Me.draw(Ie,Se.TRIANGLES,ke,_i.disabled,fn.alphaBlended,Bi.disabled,Mt,null,null,"atmosphere",Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let ie=function(fe,Ae){let Ie=null,Se=Object.values(fe._layers).flatMap(Be=>Be.source&&!Be.isHidden(Ae)?[fe.sourceCaches[Be.source]]:[]),Me=Se.filter(Be=>Be.getSource().type==="vector"),ke=Se.filter(Be=>Be.getSource().type!=="vector"),Ve=Be=>{(!Ie||Ie.getSource().maxzoom<Be.getSource().maxzoom)&&(Ie=Be)};return Me.forEach(Be=>Ve(Be)),Ie||ke.forEach(Be=>Ve(Be)),Ie}(this.style,this.transform.zoom);ie&&function(fe,Ae,Ie){for(let Se=0;Se<Ie.length;Se++)$u(fe,Ae,Ie[Se])}(this,ie,ie.getVisibleCoordinates())}this.options.showPadding&&function(ie){let fe=ie.transform.padding;Wl(ie,ie.transform.height-(fe.top||0),3,TA),Wl(ie,fe.bottom||0,3,Rn),Ld(ie,fe.left||0,3,Hl),Ld(ie,ie.transform.width-(fe.right||0),3,So);let Ae=ie.transform.centerPoint;(function(Ie,Se,Me,ke){Ea(Ie,Se-1,Me-10,2,20,ke),Ea(Ie,Se-10,Me-1,20,2,ke)})(ie,Ae.x,ie.transform.height-Ae.y,Bd)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;let u=this.terrainFacilitator.matrix,_=this.transform.modelViewProjectionMatrix,v=this.terrainFacilitator.dirty;v||(v=o?!s.bY(u,_):!s.bZ(u,_)),v||(v=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),v&&(s.b_(u,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(C,O){let N=C.context,V=N.gl,H=C.transform,K=fn.unblended,ne=new ei(V.LEQUAL,ei.ReadWrite,[0,1]),ie=O.sourceCache.getRenderableTiles(),fe=C.useProgram("terrainDepth");N.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),N.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),N.clear({color:s.b7.transparent,depth:1});for(let Ae of ie){let Ie=O.getTerrainMesh(Ae.tileID),Se=O.getTerrainData(Ae.tileID),Me=H.getProjectionData({overscaledTileID:Ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ke={u_ele_delta:O.getMeshFrameDelta(H.zoom)};fe.draw(N,V.TRIANGLES,ne,_i.disabled,K,Bi.backCCW,ke,Se,Me,"terrain",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}N.bindFramebuffer.set(null),N.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain),function(C,O){let N=C.context,V=N.gl,H=C.transform,K=fn.unblended,ne=new ei(V.LEQUAL,ei.ReadWrite,[0,1]),ie=O.getCoordsTexture(),fe=O.sourceCache.getRenderableTiles(),Ae=C.useProgram("terrainCoords");N.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),N.viewport.set([0,0,C.width/devicePixelRatio,C.height/devicePixelRatio]),N.clear({color:s.b7.transparent,depth:1}),O.coordsIndex=[];for(let Ie of fe){let Se=O.getTerrainMesh(Ie.tileID),Me=O.getTerrainData(Ie.tileID);N.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,ie.texture);let ke={u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0,u_ele_delta:O.getMeshFrameDelta(H.zoom)},Ve=H.getProjectionData({overscaledTileID:Ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Ae.draw(N,V.TRIANGLES,ne,_i.disabled,K,Bi.backCCW,ke,Me,Ve,"terrain",Se.vertexBuffer,Se.indexBuffer,Se.segments),O.coordsIndex.push(Ie.tileID.key)}N.bindFramebuffer.set(null),N.viewport.set([0,0,C.width,C.height])}(this,this.style.map.terrain))}renderLayer(o,u,_,v,C){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||(v||[]).length)&&(this.id=_.id,s.b$(_)?function(O,N,V,H,K,ne){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ie}=ne,fe=_i.disabled,Ae=O.colorModeForRenderPass();(V._unevaluatedLayout.hasValue("text-variable-anchor")||V._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Ie,Se,Me,ke,Ve,Be,qe,Ge,Ze){let _t=Se.transform,At=Se.style.map.terrain,Mt=Ve==="map",Lt=Be==="map";for(let Tt of Ie){let er=ke.getTile(Tt),Kt=er.getBucket(Me);if(!Kt||!Kt.text||!Kt.text.segments.get().length)continue;let Ut=s.ag(Kt.textSizeData,_t.zoom),mt=s.aw(er,1,Se.transform.zoom),Nt=dt(Mt,Se.transform,mt),Ii=Me.layout.get("icon-text-fit")!=="none"&&Kt.hasIconData();if(Ut){let Gr=Math.pow(2,_t.zoom-er.tileID.overscaledZ),ki=At?(Wi,Fi)=>At.getElevation(Tt,Wi,Fi):null;Ka(Kt,Mt,Lt,Ze,_t,Nt,Gr,Ut,Ii,s.ax(_t,er,qe,Ge),Tt.toUnwrapped(),ki)}}}(H,O,V,N,V.layout.get("text-rotation-alignment"),V.layout.get("text-pitch-alignment"),V.paint.get("text-translate"),V.paint.get("text-translate-anchor"),K),V.paint.get("icon-opacity").constantOr(1)!==0&&Dc(O,N,V,H,!1,V.paint.get("icon-translate"),V.paint.get("icon-translate-anchor"),V.layout.get("icon-rotation-alignment"),V.layout.get("icon-pitch-alignment"),V.layout.get("icon-keep-upright"),fe,Ae,ie),V.paint.get("text-opacity").constantOr(1)!==0&&Dc(O,N,V,H,!0,V.paint.get("text-translate"),V.paint.get("text-translate-anchor"),V.layout.get("text-rotation-alignment"),V.layout.get("text-pitch-alignment"),V.layout.get("text-keep-upright"),fe,Ae,ie),N.map.showCollisionBoxes&&(Gu(O,N,V,H,!0),Gu(O,N,V,H,!1))}(o,u,_,v,this.style.placement.variableOffsets,C):s.c0(_)?function(O,N,V,H,K){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=K,ie=V.paint.get("circle-opacity"),fe=V.paint.get("circle-stroke-width"),Ae=V.paint.get("circle-stroke-opacity"),Ie=!V.layout.get("circle-sort-key").isConstant();if(ie.constantOr(1)===0&&(fe.constantOr(1)===0||Ae.constantOr(1)===0))return;let Se=O.context,Me=Se.gl,ke=O.transform,Ve=O.getDepthModeForSublayer(0,ei.ReadOnly),Be=_i.disabled,qe=O.colorModeForRenderPass(),Ge=[],Ze=ke.getCircleRadiusCorrection();for(let _t=0;_t<H.length;_t++){let At=H[_t],Mt=N.getTile(At),Lt=Mt.getBucket(V);if(!Lt)continue;let Tt=V.paint.get("circle-translate"),er=V.paint.get("circle-translate-anchor"),Kt=s.ax(ke,Mt,Tt,er),Ut=Lt.programConfigurations.get(V.id),mt=O.useProgram("circle",Ut),Nt=Lt.layoutVertexBuffer,Ii=Lt.indexBuffer,Gr=O.style.map.terrain&&O.style.map.terrain.getTerrainData(At),ki={programConfiguration:Ut,program:mt,layoutVertexBuffer:Nt,indexBuffer:Ii,uniformValues:Wn(O,Mt,V,Kt,Ze),terrainData:Gr,projectionData:ke.getProjectionData({overscaledTileID:At,applyGlobeMatrix:!ne,applyTerrainMatrix:!0})};if(Ie){let Wi=Lt.segments.get();for(let Fi of Wi)Ge.push({segments:new s.aG([Fi]),sortKey:Fi.sortKey,state:ki})}else Ge.push({segments:Lt.segments,sortKey:0,state:ki})}Ie&&Ge.sort((_t,At)=>_t.sortKey-At.sortKey);for(let _t of Ge){let{programConfiguration:At,program:Mt,layoutVertexBuffer:Lt,indexBuffer:Tt,uniformValues:er,terrainData:Kt,projectionData:Ut}=_t.state;Mt.draw(Se,Me.TRIANGLES,Ve,Be,qe,Bi.backCCW,er,Kt,Ut,V.id,Lt,Tt,_t.segments,V.paint,O.transform.zoom,At)}}(o,u,_,v,C):s.c1(_)?function(O,N,V,H,K){if(V.paint.get("heatmap-opacity")===0)return;let ne=O.context,{isRenderingToTexture:ie,isRenderingGlobe:fe}=K;if(O.style.map.terrain){for(let Ae of H){let Ie=N.getTile(Ae);N.hasRenderableParent(Ae)||(O.renderPass==="offscreen"?jl(O,Ie,V,Ae,fe):O.renderPass==="translucent"&&ca(O,V,Ae,ie,fe))}ne.viewport.set([0,0,O.width,O.height])}else O.renderPass==="offscreen"?function(Ae,Ie,Se,Me){let ke=Ae.context,Ve=ke.gl,Be=Ae.transform,qe=_i.disabled,Ge=new fn([Ve.ONE,Ve.ONE],s.b7.transparent,[!0,!0,!0,!0]);(function(Ze,_t,At){let Mt=Ze.gl;Ze.activeTexture.set(Mt.TEXTURE1),Ze.viewport.set([0,0,_t.width/4,_t.height/4]);let Lt=At.heatmapFbos.get(s.bS);Lt?(Mt.bindTexture(Mt.TEXTURE_2D,Lt.colorAttachment.get()),Ze.bindFramebuffer.set(Lt.framebuffer)):(Lt=Rd(Ze,_t.width/4,_t.height/4),At.heatmapFbos.set(s.bS,Lt))})(ke,Ae,Se),ke.clear({color:s.b7.transparent});for(let Ze=0;Ze<Me.length;Ze++){let _t=Me[Ze];if(Ie.hasRenderableParent(_t))continue;let At=Ie.getTile(_t),Mt=At.getBucket(Se);if(!Mt)continue;let Lt=Mt.programConfigurations.get(Se.id),Tt=Ae.useProgram("heatmap",Lt),er=Be.getProjectionData({overscaledTileID:_t,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Kt=Be.getCircleRadiusCorrection();Tt.draw(ke,Ve.TRIANGLES,ei.disabled,qe,Ge,Bi.backCCW,vi(At,Be.zoom,Se.paint.get("heatmap-intensity"),Kt),null,er,Se.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,Se.paint,Be.zoom,Lt)}ke.viewport.set([0,0,Ae.width,Ae.height])}(O,N,V,H):O.renderPass==="translucent"&&function(Ae,Ie){let Se=Ae.context,Me=Se.gl;Se.setColorMode(Ae.colorModeForRenderPass());let ke=Ie.heatmapFbos.get(s.bS);ke&&(Se.activeTexture.set(Me.TEXTURE0),Me.bindTexture(Me.TEXTURE_2D,ke.colorAttachment.get()),Se.activeTexture.set(Me.TEXTURE1),nf(Se,Ie).bind(Me.LINEAR,Me.CLAMP_TO_EDGE),Ae.useProgram("heatmapTexture").draw(Se,Me.TRIANGLES,ei.disabled,_i.disabled,Ae.colorModeForRenderPass(),Bi.disabled,Si(Ae,Ie,0,1),null,null,Ie.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments,Ie.paint,Ae.transform.zoom))}(O,V)}(o,u,_,v,C):s.c2(_)?function(O,N,V,H,K){if(O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=K,ie=V.paint.get("line-opacity"),fe=V.paint.get("line-width");if(ie.constantOr(1)===0||fe.constantOr(1)===0)return;let Ae=O.getDepthModeForSublayer(0,ei.ReadOnly),Ie=O.colorModeForRenderPass(),Se=V.paint.get("line-dasharray"),Me=V.paint.get("line-pattern"),ke=Me.constantOr(1),Ve=V.paint.get("line-gradient"),Be=V.getCrossfadeParameters(),qe=ke?"linePattern":Se?"lineSDF":Ve?"lineGradient":"line",Ge=O.context,Ze=Ge.gl,_t=O.transform,At=!0;for(let Mt of H){let Lt=N.getTile(Mt);if(ke&&!Lt.patternsLoaded())continue;let Tt=Lt.getBucket(V);if(!Tt)continue;let er=Tt.programConfigurations.get(V.id),Kt=O.context.program.get(),Ut=O.useProgram(qe,er),mt=At||Ut.program!==Kt,Nt=O.style.map.terrain&&O.style.map.terrain.getTerrainData(Mt),Ii=Me.constantOr(null);if(Ii&&Lt.imageAtlas){let ji=Lt.imageAtlas,yi=ji.patternPositions[Ii.to.toString()],m=ji.patternPositions[Ii.from.toString()];yi&&m&&er.setConstantPatternPositions(yi,m)}let Gr=_t.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!ne,applyTerrainMatrix:!0}),ki=_t.getPixelScale(),Wi=ke?sa(O,Lt,V,ki,Be):Se?oa(O,Lt,V,ki,Se,Be):Ve?_o(O,Lt,V,ki,Tt.lineClipsArray.length):Pc(O,Lt,V,ki);if(ke)Ge.activeTexture.set(Ze.TEXTURE0),Lt.imageAtlasTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),er.updatePaintBuffers(Be);else if(Se&&(mt||O.lineAtlas.dirty))Ge.activeTexture.set(Ze.TEXTURE0),O.lineAtlas.bind(Ge);else if(Ve){let ji=Tt.gradients[V.id],yi=ji.texture;if(V.gradientVersion!==ji.version){let m=256;if(V.stepInterpolant){let A=N.getSource().maxzoom,x=Mt.canonical.z===A?Math.ceil(1<<O.transform.maxZoom-Mt.canonical.z):1;m=s.ae(s.bT(Tt.maxLineLength/s.Z*1024*x),256,Ge.maxTextureSize)}ji.gradient=s.bU({expression:V.gradientExpression(),evaluationKey:"lineProgress",resolution:m,image:ji.gradient||void 0,clips:Tt.lineClipsArray}),ji.texture?ji.texture.update(ji.gradient):ji.texture=new je(Ge,ji.gradient,Ze.RGBA),ji.version=V.gradientVersion,yi=ji.texture}Ge.activeTexture.set(Ze.TEXTURE0),yi.bind(V.stepInterpolant?Ze.NEAREST:Ze.LINEAR,Ze.CLAMP_TO_EDGE)}let Fi;if(ne){let[ji]=O.getStencilConfigForOverlapAndUpdateStencilID(H);Fi=ji[Mt.overscaledZ]}else Fi=O.stencilModeForClipping(Mt);Ut.draw(Ge,Ze.TRIANGLES,Ae,Fi,Ie,Bi.disabled,Wi,Nt,Gr,V.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,V.paint,O.transform.zoom,er,Tt.layoutVertexBuffer2),At=!1}}(o,u,_,v,C):s.c3(_)?function(O,N,V,H,K){let ne=V.paint.get("fill-color"),ie=V.paint.get("fill-opacity");if(ie.constantOr(1)===0)return;let{isRenderingToTexture:fe}=K,Ae=O.colorModeForRenderPass(),Ie=V.paint.get("fill-pattern"),Se=O.opaquePassEnabledForLayer()&&!Ie.constantOr(1)&&ne.constantOr(s.b7.transparent).a===1&&ie.constantOr(0)===1?"opaque":"translucent";if(O.renderPass===Se){let Me=O.getDepthModeForSublayer(1,O.renderPass==="opaque"?ei.ReadWrite:ei.ReadOnly);sf(O,N,V,H,Me,Ae,!1,fe)}if(O.renderPass==="translucent"&&V.paint.get("fill-antialias")){let Me=O.getDepthModeForSublayer(V.getPaintProperty("fill-outline-color")?2:0,ei.ReadOnly);sf(O,N,V,H,Me,Ae,!0,fe)}}(o,u,_,v,C):s.c4(_)?function(O,N,V,H,K){let ne=V.paint.get("fill-extrusion-opacity");if(ne===0)return;let{isRenderingToTexture:ie}=K;if(O.renderPass==="translucent"){let fe=new ei(O.context.gl.LEQUAL,ei.ReadWrite,O.depthRangeFor3D);if(ne!==1||V.paint.get("fill-extrusion-pattern").constantOr(1))of(O,N,V,H,fe,_i.disabled,fn.disabled,ie),of(O,N,V,H,fe,O.stencilModeFor3D(),O.colorModeForRenderPass(),ie);else{let Ae=O.colorModeForRenderPass();of(O,N,V,H,fe,_i.disabled,Ae,ie)}}}(o,u,_,v,C):s.c5(_)?function(O,N,V,H,K){if(O.renderPass!=="offscreen"&&O.renderPass!=="translucent")return;let{isRenderingToTexture:ne}=K,ie=O.context,fe=O.style.projection.useSubdivision,Ae=O.getDepthModeForSublayer(0,ei.ReadOnly),Ie=O.colorModeForRenderPass();if(O.renderPass==="offscreen")(function(Se,Me,ke,Ve,Be,qe,Ge){let Ze=Se.context,_t=Ze.gl;for(let At of ke){let Mt=Me.getTile(At),Lt=Mt.dem;if(!Lt||!Lt.data||!Mt.needsHillshadePrepare)continue;let Tt=Lt.dim,er=Lt.stride,Kt=Lt.getPixels();if(Ze.activeTexture.set(_t.TEXTURE1),Ze.pixelStoreUnpackPremultiplyAlpha.set(!1),Mt.demTexture=Mt.demTexture||Se.getTileTexture(er),Mt.demTexture){let mt=Mt.demTexture;mt.update(Kt,{premultiply:!1}),mt.bind(_t.NEAREST,_t.CLAMP_TO_EDGE)}else Mt.demTexture=new je(Ze,Kt,_t.RGBA,{premultiply:!1}),Mt.demTexture.bind(_t.NEAREST,_t.CLAMP_TO_EDGE);Ze.activeTexture.set(_t.TEXTURE0);let Ut=Mt.fbo;if(!Ut){let mt=new je(Ze,{width:Tt,height:Tt,data:null},_t.RGBA);mt.bind(_t.LINEAR,_t.CLAMP_TO_EDGE),Ut=Mt.fbo=Ze.createFramebuffer(Tt,Tt,!0,!1),Ut.colorAttachment.set(mt.texture)}Ze.bindFramebuffer.set(Ut.framebuffer),Ze.viewport.set([0,0,Tt,Tt]),Se.useProgram("hillshadePrepare").draw(Ze,_t.TRIANGLES,Be,qe,Ge,Bi.disabled,mA(Mt.tileID,Lt),null,null,Ve.id,Se.rasterBoundsBuffer,Se.quadTriangleIndexBuffer,Se.rasterBoundsSegments),Mt.needsHillshadePrepare=!1}})(O,N,H,V,Ae,_i.disabled,Ie),ie.viewport.set([0,0,O.width,O.height]);else if(O.renderPass==="translucent")if(fe){let[Se,Me,ke]=O.stencilConfigForOverlapTwoPass(H);Wu(O,N,V,ke,Se,Ae,Ie,!1,ne),Wu(O,N,V,ke,Me,Ae,Ie,!0,ne)}else{let[Se,Me]=O.getStencilConfigForOverlapAndUpdateStencilID(H);Wu(O,N,V,Me,Se,Ae,Ie,!1,ne)}}(o,u,_,v,C):s.c6(_)?function(O,N,V,H,K){if(O.renderPass!=="translucent"||V.paint.get("raster-opacity")===0||!H.length)return;let{isRenderingToTexture:ne}=K,ie=N.getSource(),fe=O.style.projection.useSubdivision;if(ie instanceof Kn)Fc(O,N,V,H,null,!1,!1,ie.tileCoords,ie.flippedWindingOrder,ne);else if(fe){let[Ae,Ie,Se]=O.stencilConfigForOverlapTwoPass(H);Fc(O,N,V,Se,Ae,!1,!0,kc,!1,ne),Fc(O,N,V,Se,Ie,!0,!0,kc,!1,ne)}else{let[Ae,Ie]=O.getStencilConfigForOverlapAndUpdateStencilID(H);Fc(O,N,V,Ie,Ae,!1,!0,kc,!1,ne)}}(o,u,_,v,C):s.c7(_)?function(O,N,V,H,K){let ne=V.paint.get("background-color"),ie=V.paint.get("background-opacity");if(ie===0)return;let{isRenderingToTexture:fe}=K,Ae=O.context,Ie=Ae.gl,Se=O.style.projection,Me=O.transform,ke=Me.tileSize,Ve=V.paint.get("background-pattern");if(O.isPatternMissing(Ve))return;let Be=!Ve&&ne.a===1&&ie===1&&O.opaquePassEnabledForLayer()?"opaque":"translucent";if(O.renderPass!==Be)return;let qe=_i.disabled,Ge=O.getDepthModeForSublayer(0,Be==="opaque"?ei.ReadWrite:ei.ReadOnly),Ze=O.colorModeForRenderPass(),_t=O.useProgram(Ve?"backgroundPattern":"background"),At=H||ot(Me,{tileSize:ke,terrain:O.style.map.terrain});Ve&&(Ae.activeTexture.set(Ie.TEXTURE0),O.imageManager.bind(O.context));let Mt=V.getCrossfadeParameters();for(let Lt of At){let Tt=Me.getProjectionData({overscaledTileID:Lt,applyGlobeMatrix:!fe,applyTerrainMatrix:!0}),er=Ve?Wh(ie,O,Ve,{tileID:Lt,tileSize:ke},Mt):_A(ie,ne),Kt=O.style.map.terrain&&O.style.map.terrain.getTerrainData(Lt),Ut=Se.getMeshFromTileID(Ae,Lt.canonical,!1,!0,"raster");_t.draw(Ae,Ie.TRIANGLES,Ge,qe,Ze,Bi.backCCW,er,Kt,Tt,V.id,Ut.vertexBuffer,Ut.indexBuffer,Ut.segments)}}(o,0,_,v,C):s.c8(_)&&function(O,N,V,H){let{isRenderingGlobe:K}=H,ne=O.context,ie=V.implementation,fe=O.style.projection,Ae=O.transform,Ie=Ae.getProjectionDataForCustomLayer(K),Se={farZ:Ae.farZ,nearZ:Ae.nearZ,fov:Ae.fov*Math.PI/180,modelViewProjectionMatrix:Ae.modelViewProjectionMatrix,projectionMatrix:Ae.projectionMatrix,shaderData:{variantName:fe.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${fe.shaderPreludeCode.vertexSource}`,define:fe.shaderDefine},defaultProjectionData:Ie},Me=ie.renderingMode?ie.renderingMode:"2d";if(O.renderPass==="offscreen"){let ke=ie.prerender;ke&&(O.setCustomLayerDefaults(),ne.setColorMode(O.colorModeForRenderPass()),ke.call(ie,ne.gl,Se),ne.setDirty(),O.setBaseState())}else if(O.renderPass==="translucent"){O.setCustomLayerDefaults(),ne.setColorMode(O.colorModeForRenderPass()),ne.setStencilMode(_i.disabled);let ke=Me==="3d"?O.getDepthModeFor3D():O.getDepthModeForSublayer(0,ei.ReadOnly);ne.setDepthMode(ke),ie.render(ne.gl,Se),ne.setDirty(),O.setBaseState(),ne.bindFramebuffer.set(null)}}(o,0,_,C))}saveTileTexture(o){let u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){let u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;let u=this.imageManager.getPattern(o.from.toString()),_=this.imageManager.getPattern(o.to.toString());return!u||!_}useProgram(o,u,_=!1){this.cache=this.cache||{};let v=!!this.style.map.terrain,C=this.style.projection,O=o+(u?u.cacheKey:"")+`/${_?Lu:C.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(v?"/terrain":"");return this.cache[O]||(this.cache[O]=new Br(this.context,ra[o],u,vd[o],this._showOverdrawInspector,v,_?ra.projectionMercator:C.shaderPreludeCode,_?Za:C.shaderDefine)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new je(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:o,drawingBufferHeight:u}=this.context.gl;return this.width!==o||this.height!==u}}function lf(S,o){let u,_=!1,v=null,C=null,O=()=>{v=null,_&&(S.apply(C,u),v=setTimeout(O,o),_=!1)};return(...N)=>(_=!0,C=this,u=N,v||O(),v)}class Ja{constructor(o){this._getCurrentHash=()=>{let u=window.location.hash.replace("#","");if(this._hashName){let _;return u.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(_=v)}),(_&&_[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{let u=this._getCurrentHash();if(!this._isValidHash(u))return!1;let _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:_,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{let u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{let u=this._getCurrentHash();if(u.length===0)return;let _=u.join("/"),v=_;v.split("&").length>0&&(v=v.split("&")[0]),this._hashName&&(v=`${this._hashName}=${_}`);let C=window.location.hash.replace(v,"");C.startsWith("#&")?C=C.slice(0,1)+C.slice(2):C==="#"&&(C="");let O=window.location.href.replace(/(#.+)?$/,C);O=O.replace("&&","&"),window.history.replaceState(window.history.state,null,O)},this._updateHash=lf(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){let u=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,v),O=Math.round(u.lng*C)/C,N=Math.round(u.lat*C)/C,V=this._map.getBearing(),H=this._map.getPitch(),K="";if(K+=o?`/${O}/${N}/${_}`:`${_}/${N}/${O}`,(V||H)&&(K+="/"+Math.round(10*V)/10),H&&(K+=`/${Math.round(H)}`),this._hashName){let ne=this._hashName,ie=!1,fe=window.location.hash.slice(1).split("&").map(Ae=>{let Ie=Ae.split("=")[0];return Ie===ne?(ie=!0,`${Ie}=${K}`):Ae}).filter(Ae=>Ae);return ie||fe.push(`${ne}=${K}`),`#${fe.join("&")}`}return`#${K}`}_isValidHash(o){if(o.length<3||o.some(isNaN))return!1;try{new s.Q(+o[2],+o[1])}catch{return!1}let u=+o[0],_=+(o[3]||0),v=+(o[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&_>=-180&&_<=180&&v>=this._map.getMinPitch()&&v<=this._map.getMaxPitch()}}let Nc={linearity:.3,easing:s.c9(0,0,.3,1)},Sa=s.e({deceleration:2500,maxSpeed:1400},Nc),Dd=s.e({deceleration:20,maxSpeed:1400},Nc),EA=s.e({deceleration:1e3,maxSpeed:360},Nc),kd=s.e({deceleration:1e3,maxSpeed:90},Nc),cf=s.e({deceleration:1e3,maxSpeed:360},Nc);class uf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:b.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,u=b.now();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let u={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:C}of this._inertiaBuffer)u.zoom+=C.zoomDelta||0,u.bearing+=C.bearingDelta||0,u.pitch+=C.pitchDelta||0,u.roll+=C.rollDelta||0,C.panDelta&&u.pan._add(C.panDelta),C.around&&(u.around=C.around),C.pinchAround&&(u.pinchAround=C.pinchAround);let _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){let C=Vi(u.pan.mag(),_,s.e({},Sa,o||{})),O=u.pan.mult(C.amount/u.pan.mag()),N=this._map.cameraHelper.handlePanInertia(O,this._map.transform);v.center=N.easingCenter,v.offset=N.easingOffset,Ca(v,C)}if(u.zoom){let C=Vi(u.zoom,_,Dd);v.zoom=this._map.transform.zoom+C.amount,Ca(v,C)}if(u.bearing){let C=Vi(u.bearing,_,EA);v.bearing=this._map.transform.bearing+s.ae(C.amount,-179,179),Ca(v,C)}if(u.pitch){let C=Vi(u.pitch,_,kd);v.pitch=this._map.transform.pitch+C.amount,Ca(v,C)}if(u.roll){let C=Vi(u.roll,_,cf);v.roll=this._map.transform.roll+s.ae(C.amount,-179,179),Ca(v,C)}if(v.zoom||v.bearing){let C=u.pinchAround===void 0?u.around:u.pinchAround;v.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),s.e(v,{noMoveStart:!0})}}function Ca(S,o){(!S.duration||S.duration<o.duration)&&(S.duration=o.duration,S.easing=o.easing)}function Vi(S,o,u){let{maxSpeed:_,linearity:v,deceleration:C}=u,O=s.ae(S*v/(o/1e3),-_,_),N=Math.abs(O)/(C*v);return{easing:u.easing,duration:1e3*N,amount:O*(N/2)}}class Ts extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_,v={}){_=_ instanceof MouseEvent?_:new MouseEvent(o,_);let C=T.mousePos(u.getCanvas(),_),O=u.unproject(C);super(o,s.e({point:C,lngLat:O,originalEvent:_},v)),this._defaultPrevented=!1,this.target=u}}class zc extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_){let v=o==="touchend"?_.changedTouches:_.touches,C=T.touchPos(u.getCanvasContainer(),v),O=C.map(V=>u.unproject(V)),N=C.reduce((V,H,K,ne)=>V.add(H.div(ne.length)),new s.P(0,0));super(o,{points:C,point:N,lngLats:O,lngLat:u.unproject(N),originalEvent:_}),this._defaultPrevented=!1}}class Co extends s.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,_){super(o,{originalEvent:_}),this._defaultPrevented=!1}}class ua{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Co(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new Ts(o.type,this._map,o))}mouseup(o){this._map.fire(new Ts(o.type,this._map,o))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ts(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Ts(o.type,this._map,o))}mouseover(o){this._map.fire(new Ts(o.type,this._map,o))}mouseout(o){this._map.fire(new Ts(o.type,this._map,o))}touchstart(o){return this._firePreventable(new zc(o.type,this._map,o))}touchmove(o){this._map.fire(new zc(o.type,this._map,o))}touchend(o){this._map.fire(new zc(o.type,this._map,o))}touchcancel(o){this._map.fire(new zc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class SA{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Ts(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ts("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Ts(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class eo{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.screenPointToLocation(s.P.convert(o),this._map.terrain)}}class $l{constructor(o,u){this._map=o,this._tr=new eo(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&o.button===0&&(T.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;let _=u;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;let v=this._startPos;this._lastPos=_,this._box||(this._box=T.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));let C=Math.min(v.x,_.x),O=Math.max(v.x,_.x),N=Math.min(v.y,_.y),V=Math.max(v.y,_.y);T.setTransform(this._box,`translate(${C}px,${N}px)`),this._box.style.width=O-C+"px",this._box.style.height=V-N+"px"}mouseupWindow(o,u){if(!this._active||o.button!==0)return;let _=this._startPos,v=u;if(this.reset(),T.suppressClick(),_.x!==v.x||_.y!==v.y)return this._map.fire(new s.l("boxzoomend",{originalEvent:o})),{cameraAnimation:C=>C.fitScreenCoordinates(_,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(T.remove(this._box),this._box=null),T.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new s.l(o,{originalEvent:u}))}}function Es(S,o){if(S.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${S.length}, points ${o.length}`);let u={};for(let _=0;_<S.length;_++)u[S[_].identifier]=o[_];return u}class Fd{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,u,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){let C=new s.P(0,0);for(let O of v)C._add(O);return C.div(v.length)}(u),this.touches=Es(_,u)))}touchmove(o,u,_){if(this.aborted||!this.centroid)return;let v=Es(_,u);for(let C in this.touches){let O=v[C];(!O||O.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(o,u,_){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ia{constructor(o){this.singleTap=new Fd(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,u,_){this.singleTap.touchstart(o,u,_)}touchmove(o,u,_){this.singleTap.touchmove(o,u,_)}touchend(o,u,_){let v=this.singleTap.touchend(o,u,_);if(v){let C=o.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(v)<30;if(C&&O||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Hm{constructor(o){this._tr=new eo(o),this._zoomIn=new Ia({numTouches:1,numTaps:2}),this._zoomOut=new Ia({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,_){this._zoomIn.touchstart(o,u,_),this._zoomOut.touchstart(o,u,_)}touchmove(o,u,_){this._zoomIn.touchmove(o,u,_),this._zoomOut.touchmove(o,u,_)}touchend(o,u,_){let v=this._zoomIn.touchend(o,u,_),C=this._zoomOut.touchend(o,u,_),O=this._tr;return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:O.zoom+1,around:O.unproject(v)},{originalEvent:o})}):C?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:N=>N.easeTo({duration:300,zoom:O.zoom-1,around:O.unproject(C)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class el{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){let u=this._moveFunction(...o);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(o,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,u){if(!this.isEnabled())return;let _=this._lastPoint;if(!_)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);let v=Array.isArray(u)?u[0]:u;return!this._moved&&v.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(_,v))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&T.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let qu={0:1,2:2};class yn{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){let u=T.mouseButton(o);this._eventButton=u}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(u,_){let v=qu[_];return u.buttons===void 0||(u.buttons&v)!==v}(o,this._eventButton)}isValidEndEvent(o){return T.mouseButton(o)===this._eventButton}}class ur{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}class hf{constructor(o=new yn({checkCorrectEvent:()=>!0}),u=new ur){this.mouseMoveStateManager=o,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(o,u,_){return o instanceof MouseEvent?u(o):typeof TouchEvent<"u"&&o instanceof TouchEvent?_(o):void 0}startMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}let Vo=S=>{S.mousedown=S.dragStart,S.mousemoveWindow=S.dragMove,S.mouseup=S.dragEnd,S.contextmenu=o=>{o.preventDefault()}};class Uc{constructor(o,u){this._clickTolerance=o.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,u,_){return this._calculateTransform(o,u,_)}touchmove(o,u,_){if(this._active){if(!this._shouldBePrevented(_.length))return o.preventDefault(),this._calculateTransform(o,u,_);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,u,_){this._calculateTransform(o,u,_),this._active&&this._shouldBePrevented(_.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,_){_.length>0&&(this._active=!0);let v=Es(_,u),C=new s.P(0,0),O=new s.P(0,0),N=0;for(let H in v){let K=v[H],ne=this._touches[H];ne&&(C._add(K),O._add(K.sub(ne)),N++,v[H]=K)}if(this._touches=v,this._shouldBePrevented(N)||!O.mag())return;let V=O.div(N);return this._sum._add(V),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(N),panDelta:V}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,u,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,_){if(!this._firstTwoTouches)return;o.preventDefault();let[v,C]=this._firstTwoTouches,O=tl(_,u,v),N=tl(_,u,C);if(!O||!N)return;let V=this._aroundCenter?null:O.add(N).div(2);return this._move([O,N],V,o)}touchend(o,u,_){if(!this._firstTwoTouches)return;let[v,C]=this._firstTwoTouches,O=tl(_,u,v),N=tl(_,u,C);O&&N||(this._active&&T.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function tl(S,o,u){for(let _=0;_<S.length;_++)if(S[_].identifier===u)return o[_]}function ff(S,o){return Math.log(S/o)/Math.LN2}class oi extends jo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){let _=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(ff(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ff(this._distance,_),pinchAround:u}}}function Vc(S,o){return 180*S.angleWith(o)/Math.PI}class CA extends jo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u,_){let v=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Vc(this._vector,v),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let u=25/(Math.PI*this._minDiameter)*360,_=Vc(o,this._startVector);return Math.abs(_)<u}}function Zu(S){return Math.abs(S.y)>Math.abs(S.x)}class Nd extends jo{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,u,_){super.touchstart(o,u,_),this._currentTouchCount=_.length}_start(o){this._lastPoints=o,Zu(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let v=o[0].sub(this._lastPoints[0]),C=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,C,_.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+C.y)/2*-.5}):void 0}gestureBeginsVertically(o,u,_){if(this._valid!==void 0)return this._valid;let v=o.mag()>=2,C=u.mag()>=2;if(!v&&!C)return;if(!v||!C)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;let O=o.y>0==u.y>0;return Zu(o)&&Zu(u)&&O}}let IA={panStep:100,bearingStep:15,pitchStep:10};class ql{constructor(o){this._tr=new eo(o);let u=IA;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,_=0,v=0,C=0,O=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?_=-1:(o.preventDefault(),C=-1);break;case 39:o.shiftKey?_=1:(o.preventDefault(),C=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),O=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:N=>{let V=this._tr;N.easeTo({duration:300,easeId:"keyboardHandler",easing:rl,zoom:u?Math.round(V.zoom)+u*(o.shiftKey?2:1):V.zoom,bearing:V.bearing+_*this._bearingStep,pitch:V.pitch+v*this._pitchStep,offset:[-C*this._panStep,-O*this._panStep],center:V.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rl(S){return S*(2-S)}let zd=4.000244140625;class jc{constructor(o,u){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=o,this._tr=new eo(o),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let u=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,_=b.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,u!==0&&u%zd==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=T.mousePos(this._map.getCanvas(),o),_=this._tr;this._aroundPoint=this._aroundCenter?_.transform.locationToScreenPoint(s.Q.convert(_.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let N=o.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=N),typeof this._targetZoom=="number"&&(this._targetZoom+=N)}if(this._delta!==0){let N=this._type==="wheel"&&Math.abs(this._delta)>zd?this._wheelZoomRate:this._defaultZoomRate,V=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&V!==0&&(V=1/V);let H=typeof this._targetZoom!="number"?o.scale:s.aI(this._targetZoom);this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,s.ab(H*V))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let u=typeof this._targetZoom!="number"?o.zoom:this._targetZoom,_=this._startZoom,v=this._easing,C,O=!1;if(this._type==="wheel"&&_&&v){let N=b.now()-this._lastWheelEventTime,V=Math.min((N+5)/200,1),H=v(V);C=s.B.number(_,u,H),V<1?this._frameId||(this._frameId=!0):O=!0}else C=u,O=!0;return this._active=!0,O&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=C,{noInertia:!0,needsRenderFrame:!O,zoomDelta:C-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=s.cb;if(this._prevEase){let _=this._prevEase,v=(b.now()-_.start)/_.duration,C=_.easing(v+.01)-_.easing(v),O=.27/Math.sqrt(C*C+1e-4)*.01,N=Math.sqrt(.0729-O*O);u=s.c9(O,N,.25,1)}return this._prevEase={start:b.now(),duration:o,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ud{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wm{constructor(o){this._tr=new eo(o),this.reset()}reset(){this._active=!1}dblclick(o,u){return o.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $m{constructor(){this._tap=new Ia({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,u,_){if(!this._swipePoint)if(this._tapTime){let v=u[0],C=o.timeStamp-this._tapTime<500,O=this._tapPoint.dist(v)<30;C&&O?_.length>0&&(this._swipePoint=v,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(o,u,_)}touchmove(o,u,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;let v=u[0],C=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(o,u,_)}touchend(o,u,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{let v=this._tap.touchend(o,u,_);v&&(this._tapTime=o.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pa{constructor(o,u,_){this._el=o,this._mousePan=u,this._touchPan=_}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class an{constructor(o,u,_,v){this._pitchWithRotate=o.pitchWithRotate,this._rollEnabled=o.rollEnabled,this._mouseRotate=u,this._mousePitch=_,this._mouseRoll=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Xu{constructor(o,u,_,v){this._el=o,this._touchZoom=u,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class df{constructor(o,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=T.create("div","maplibregl-cooperative-gesture-screen",o);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=u,this._container.appendChild(v);let C=document.createElement("div");C.className="maplibregl-mobile-message",C.textContent=_,this._container.appendChild(C),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(T.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,u){this._enabled&&(this._map.fire(new s.l("cooperativegestureprevented",{gestureType:o,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let Zl=S=>S.zoom||S.drag||S.roll||S.pitch||S.rotate;class Vd extends s.l{}function Gc(S){return S.panDelta&&S.panDelta.mag()||S.zoomDelta||S.bearingDelta||S.pitchDelta||S.rollDelta}class qm{constructor(o,u){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,C)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let O=v.type==="renderFrame"?void 0:v,N={needsRenderFrame:!1},V={},H={};for(let{handlerName:ie,handler:fe,allowed:Ae}of this._handlers){if(!fe.isEnabled())continue;let Ie;if(this._blockedByActive(H,Ae,ie))fe.reset();else if(fe[C||v.type]){if(s.cc(v,C||v.type)){let Se=T.mousePos(this._map.getCanvas(),v);Ie=fe[C||v.type](v,Se)}else if(s.cd(v,C||v.type)){let Se=this._getMapTouches(v.touches),Me=T.touchPos(this._map.getCanvas(),Se);Ie=fe[C||v.type](v,Me,Se)}else s.ce(C||v.type)||(Ie=fe[C||v.type](v));this.mergeHandlerResult(N,V,Ie,ie,O),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()}(Ie||fe.isActive())&&(H[ie]=fe)}let K={};for(let ie in this._previousActiveHandlers)H[ie]||(K[ie]=O);this._previousActiveHandlers=H,(Object.keys(K).length||Gc(N))&&(this._changes.push([N,V,K]),this._triggerRenderFrame()),(Object.keys(H).length||Gc(N))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:ne}=N;ne&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ne(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new uf(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);let _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,C,O]of this._listeners)T.addEventListener(v,C,v===document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(let[o,u,_]of this._listeners)T.removeEventListener(o,u,o===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(o){let u=this._map,_=u.getCanvasContainer();this._add("mapEvent",new ua(u,o));let v=u.boxZoom=new $l(u,o);this._add("boxZoom",v),o.interactive&&o.boxZoom&&v.enable();let C=u.cooperativeGestures=new df(u,o.cooperativeGestures);this._add("cooperativeGestures",C),o.cooperativeGestures&&C.enable();let O=new Hm(u),N=new Wm(u);u.doubleClickZoom=new Ud(N,O),this._add("tapZoom",O),this._add("clickZoom",N),o.interactive&&o.doubleClickZoom&&u.doubleClickZoom.enable();let V=new $m;this._add("tapDragZoom",V);let H=u.touchPitch=new Nd(u);this._add("touchPitch",H),o.interactive&&o.touchPitch&&u.touchPitch.enable(o.touchPitch);let K=()=>u.project(u.getCenter()),ne=function({enable:Be,clickTolerance:qe,aroundCenter:Ge=!0,minPixelCenterThreshold:Ze=100,rotateDegreesPerPixelMoved:_t=.8},At){let Mt=new yn({checkCorrectEvent:Lt=>T.mouseButton(Lt)===0&&Lt.ctrlKey||T.mouseButton(Lt)===2&&!Lt.ctrlKey});return new el({clickTolerance:qe,move:(Lt,Tt)=>{let er=At();if(Ge&&Math.abs(er.y-Lt.y)>Ze)return{bearingDelta:s.ca(new s.P(Lt.x,Tt.y),Tt,er)};let Kt=(Tt.x-Lt.x)*_t;return Ge&&Tt.y<er.y&&(Kt=-Kt),{bearingDelta:Kt}},moveStateManager:Mt,enable:Be,assignEvents:Vo})}(o,K),ie=function({enable:Be,clickTolerance:qe,pitchDegreesPerPixelMoved:Ge=-.5}){let Ze=new yn({checkCorrectEvent:_t=>T.mouseButton(_t)===0&&_t.ctrlKey||T.mouseButton(_t)===2});return new el({clickTolerance:qe,move:(_t,At)=>({pitchDelta:(At.y-_t.y)*Ge}),moveStateManager:Ze,enable:Be,assignEvents:Vo})}(o),fe=function({enable:Be,clickTolerance:qe,rollDegreesPerPixelMoved:Ge=.3},Ze){let _t=new yn({checkCorrectEvent:At=>T.mouseButton(At)===2&&At.ctrlKey});return new el({clickTolerance:qe,move:(At,Mt)=>{let Lt=Ze(),Tt=(Mt.x-At.x)*Ge;return Mt.y<Lt.y&&(Tt=-Tt),{rollDelta:Tt}},moveStateManager:_t,enable:Be,assignEvents:Vo})}(o,K);u.dragRotate=new an(o,ne,ie,fe),this._add("mouseRotate",ne,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate","mouseRoll"]),this._add("mouseRoll",fe,["mousePitch"]),o.interactive&&o.dragRotate&&u.dragRotate.enable();let Ae=function({enable:Be,clickTolerance:qe}){let Ge=new yn({checkCorrectEvent:Ze=>T.mouseButton(Ze)===0&&!Ze.ctrlKey});return new el({clickTolerance:qe,move:(Ze,_t)=>({around:_t,panDelta:_t.sub(Ze)}),activateOnStart:!0,moveStateManager:Ge,enable:Be,assignEvents:Vo})}(o),Ie=new Uc(o,u);u.dragPan=new Pa(_,Ae,Ie),this._add("mousePan",Ae),this._add("touchPan",Ie,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&u.dragPan.enable(o.dragPan);let Se=new CA,Me=new oi;u.touchZoomRotate=new Xu(_,Me,Se,V),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&u.touchZoomRotate.enable(o.touchZoomRotate);let ke=u.scrollZoom=new jc(u,()=>this._triggerRenderFrame());this._add("scrollZoom",ke,["mousePan"]),o.interactive&&o.scrollZoom&&u.scrollZoom.enable(o.scrollZoom);let Ve=u.keyboard=new ql(u);this._add("keyboard",Ve),o.interactive&&o.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new SA(u))}_add(o,u,_){this._handlers.push({handlerName:o,handler:u,allowed:_}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zl(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,u,_){for(let v in o)if(v!==_&&(!u||u.indexOf(v)<0))return!0;return!1}_getMapTouches(o){let u=[];for(let _ of o)this._el.contains(_.target)&&u.push(_);return u}mergeHandlerResult(o,u,_,v,C){if(!_)return;s.e(o,_);let O={handlerName:v,originalEvent:_.originalEvent||C};_.zoomDelta!==void 0&&(u.zoom=O),_.panDelta!==void 0&&(u.drag=O),_.rollDelta!==void 0&&(u.roll=O),_.pitchDelta!==void 0&&(u.pitch=O),_.bearingDelta!==void 0&&(u.rotate=O)}_applyChanges(){let o={},u={},_={};for(let[v,C,O]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.rollDelta&&(o.rollDelta=(o.rollDelta||0)+v.rollDelta),v.around!==void 0&&(o.around=v.around),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),s.e(u,C),s.e(_,O);this._updateMapTransform(o,u,_),this._changes=[]}_updateMapTransform(o,u,_){let v=this._map,C=v._getTransformForUpdate(),O=v.terrain;if(!(Gc(o)||O&&this._terrainMovement))return this._fireEvents(u,_,!0);v._stop(!0);let{panDelta:N,zoomDelta:V,bearingDelta:H,pitchDelta:K,rollDelta:ne,around:ie,pinchAround:fe}=o;fe!==void 0&&(ie=fe),ie=ie||v.transform.centerPoint,O&&!C.isPointOnMapSurface(ie)&&(ie=C.centerPoint);let Ae={panDelta:N,zoomDelta:V,rollDelta:ne,pitchDelta:K,bearingDelta:H,around:ie};this._map.cameraHelper.useGlobeControls&&!C.isPointOnMapSurface(ie)&&(ie=C.centerPoint);let Ie=ie.distSqr(C.centerPoint)<.01?C.center:C.screenPointToLocation(N?ie.sub(N):ie);O?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Ae,C),this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?C.setCenter(C.screenPointToLocation(C.centerPoint.sub(N))):this._map.cameraHelper.handleMapControlsPan(Ae,C,Ie):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Ae,C,Ie))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Ae,C),this._map.cameraHelper.handleMapControlsPan(Ae,C,Ie)),v._applyUpdatedTransform(C),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,_,!0)}_fireEvents(o,u,_){let v=Zl(this._eventsInProgress),C=Zl(o),O={};for(let ne in o){let{originalEvent:ie}=o[ne];this._eventsInProgress[ne]||(O[`${ne}start`]=ie),this._eventsInProgress[ne]=o[ne]}!v&&C&&this._fireEvent("movestart",C.originalEvent);for(let ne in O)this._fireEvent(ne,O[ne]);C&&this._fireEvent("move",C.originalEvent);for(let ne in o){let{originalEvent:ie}=o[ne];this._fireEvent(ne,ie)}let N={},V;for(let ne in this._eventsInProgress){let{handlerName:ie,originalEvent:fe}=this._eventsInProgress[ne];this._handlersById[ie].isActive()||(delete this._eventsInProgress[ne],V=u[ie]||fe,N[`${ne}end`]=V)}for(let ne in N)this._fireEvent(ne,N[ne]);let H=Zl(this._eventsInProgress),K=(v||C)&&!H;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let ne=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ne.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ne)}if(_&&K){this._updatingCamera=!0;let ne=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ie=fe=>fe!==0&&-this._bearingSnap<fe&&fe<this._bearingSnap;!ne||!ne.essential&&b.prefersReducedMotion?(this._map.fire(new s.l("moveend",{originalEvent:V})),ie(this._map.getBearing())&&this._map.resetNorth()):(ie(ne.bearing||this._map.getBearing())&&(ne.bearing=0),ne.freezeElevation=!0,this._map.easeTo(ne,{originalEvent:V})),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new s.l(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Vd("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ha extends s.E{constructor(o,u,_){super(),this._renderFrameCallback=()=>{let v=Math.min((b.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=_.bearingSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(o,u){o.apply(this.transform),this.transform=o,this.cameraHelper=u}getCenter(){return new s.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(o,u){return this.jumpTo({elevation:o},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(o){this._centerClampedToGround=o}panBy(o,u,_){return o=s.P.convert(o).mult(-1),this.panTo(this.transform.center,s.e({offset:o},u),_)}panTo(o,u,_){return this.easeTo(s.e({center:o},u),_)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,_){return this.easeTo(s.e({zoom:o},u),_)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(o,u){return o!=this.transform.fov&&(this.transform.setFov(o),this.fire(new s.l("movestart",u)).fire(new s.l("move",u)).fire(new s.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,_){return this.easeTo(s.e({bearing:o},u),_)}resetNorth(o,u){return this.rotateTo(0,s.e({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}getRoll(){return this.transform.roll}setRoll(o,u){return this.jumpTo({roll:o},u),this}cameraForBounds(o,u){o=li.convert(o).adjustAntiMeridian();let _=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),_,u)}_cameraForBoxAndBearing(o,u,_,v){let C={top:0,bottom:0,right:0,left:0};if(typeof(v=s.e({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){let H=v.padding;v.padding={top:H,bottom:H,right:H,left:H}}let O=s.e(C,v.padding);v.padding=O;let N=this.transform,V=new li(o,u);return this.cameraHelper.cameraForBoxAndBearing(v,O,V,_,N)}fitBounds(o,u,_){return this._fitInternal(this.cameraForBounds(o,u),u,_)}fitScreenCoordinates(o,u,_,v,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(o)),this.transform.screenPointToLocation(s.P.convert(u)),_,v),v,C)}_fitInternal(o,u,_){return o?(delete(u=s.e(o,u)).padding,u.linear?this.easeTo(u,_):this.flyTo(u,_)):this}jumpTo(o,u){this.stop();let _=this._getTransformForUpdate(),v=!1,C=!1,O=!1,N=_.zoom;this.cameraHelper.handleJumpToCenterZoom(_,o);let V=_.zoom!==N;return"elevation"in o&&_.elevation!==+o.elevation&&_.setElevation(+o.elevation),"bearing"in o&&_.bearing!==+o.bearing&&(v=!0,_.setBearing(+o.bearing)),"pitch"in o&&_.pitch!==+o.pitch&&(C=!0,_.setPitch(+o.pitch)),"roll"in o&&_.roll!==+o.roll&&(O=!0,_.setRoll(+o.roll)),o.padding==null||_.isPaddingEqual(o.padding)||_.setPadding(o.padding),this._applyUpdatedTransform(_),this.fire(new s.l("movestart",u)).fire(new s.l("move",u)),V&&this.fire(new s.l("zoomstart",u)).fire(new s.l("zoom",u)).fire(new s.l("zoomend",u)),v&&this.fire(new s.l("rotatestart",u)).fire(new s.l("rotate",u)).fire(new s.l("rotateend",u)),C&&this.fire(new s.l("pitchstart",u)).fire(new s.l("pitch",u)).fire(new s.l("pitchend",u)),O&&this.fire(new s.l("rollstart",u)).fire(new s.l("roll",u)).fire(new s.l("rollend",u)),this.fire(new s.l("moveend",u))}calculateCameraOptionsFromTo(o,u,_,v=0){let C=s.$.fromLngLat(o,u),O=s.$.fromLngLat(_,v),N=O.x-C.x,V=O.y-C.y,H=O.z-C.z,K=Math.hypot(N,V,H);if(K===0)throw new Error("Can't calculate camera options with same From and To");let ne=Math.hypot(N,V),ie=s.ab(this.transform.cameraToCenterDistance/K/this.transform.tileSize),fe=180*Math.atan2(N,-V)/Math.PI,Ae=180*Math.acos(ne/K)/Math.PI;return Ae=H<0?90-Ae:90+Ae,{center:O.toLngLat(),elevation:v,zoom:ie,pitch:Ae,bearing:fe}}calculateCameraOptionsFromCameraLngLatAltRotation(o,u,_,v,C){let O=this.transform.calculateCenterFromCameraLngLatAlt(o,u,_,v);return{center:O.center,elevation:O.elevation,zoom:O.zoom,bearing:_,pitch:v,roll:C}}easeTo(o,u){this._stop(!1,o.easeId),((o=s.e({offset:[0,0],duration:500,easing:s.cb},o)).animate===!1||!o.essential&&b.prefersReducedMotion)&&(o.duration=0);let _=this._getTransformForUpdate(),v=this.getBearing(),C=_.pitch,O=_.roll,N="bearing"in o?this._normalizeBearing(o.bearing,v):v,V="pitch"in o?+o.pitch:C,H="roll"in o?this._normalizeBearing(o.roll,O):O,K="padding"in o?o.padding:_.padding,ne=s.P.convert(o.offset),ie,fe;o.around&&(ie=s.Q.convert(o.around),fe=_.locationToScreenPoint(ie));let Ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Ie=this.cameraHelper.handleEaseTo(_,{bearing:N,pitch:V,roll:H,padding:K,around:ie,aroundPoint:fe,offsetAsPoint:ne,offset:o.offset,zoom:o.zoom,center:o.center});return this._rotating=this._rotating||v!==N,this._pitching=this._pitching||V!==C,this._rolling=this._rolling||H!==O,this._padding=!_.isPaddingEqual(K),this._zooming=this._zooming||Ie.isZooming,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,Ae),this.terrain&&this._prepareElevation(Ie.elevationCenter),this._ease(Se=>{Ie.easeFunc(Se),this.terrain&&!o.freezeElevation&&this._updateElevation(Se),this._applyUpdatedTransform(_),this._fireMoveEvents(u)},Se=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u,Se)},o),this}_prepareEase(o,u,_={}){this._moving=!0,u||_.moving||this.fire(new s.l("movestart",o)),this._zooming&&!_.zooming&&this.fire(new s.l("zoomstart",o)),this._rotating&&!_.rotating&&this.fire(new s.l("rotatestart",o)),this._pitching&&!_.pitching&&this.fire(new s.l("pitchstart",o)),this._rolling&&!_.rolling&&this.fire(new s.l("rollstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&u!==this._elevationTarget){let _=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(_-(u-(_*o+this._elevationStart))/(1-o)),this._elevationTarget=u}this.transform.setElevation(s.B.number(this._elevationStart,this._elevationTarget,o))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){if(!this.terrain&&o.elevation>=0&&o.pitch<=90)return{};let u=o.getCameraLngLat(),_=o.getCameraAltitude(),v=this.terrain?this.terrain.getElevationForLngLatZoom(u,o.zoom):0;if(_<v){let C=this.calculateCameraOptionsFromTo(u,v,o.center,o.elevation);return{pitch:C.pitch,zoom:C.zoom}}return{}}_applyUpdatedTransform(o){let u=[];if(u.push(v=>this._elevateCameraIfInsideTerrain(v)),this.transformCameraUpdate&&u.push(v=>this.transformCameraUpdate(v)),!u.length)return;let _=o.clone();for(let v of u){let C=_.clone(),{center:O,zoom:N,roll:V,pitch:H,bearing:K,elevation:ne}=v(C);O&&C.setCenter(O),ne!==void 0&&C.setElevation(ne),N!==void 0&&C.setZoom(N),V!==void 0&&C.setRoll(V),H!==void 0&&C.setPitch(H),K!==void 0&&C.setBearing(K),_.apply(C)}this.transform.apply(_)}_fireMoveEvents(o){this.fire(new s.l("move",o)),this._zooming&&this.fire(new s.l("zoom",o)),this._rotating&&this.fire(new s.l("rotate",o)),this._pitching&&this.fire(new s.l("pitch",o)),this._rolling&&this.fire(new s.l("roll",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;let _=this._zooming,v=this._rotating,C=this._pitching,O=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,_&&this.fire(new s.l("zoomend",o)),v&&this.fire(new s.l("rotateend",o)),C&&this.fire(new s.l("pitchend",o)),O&&this.fire(new s.l("rollend",o)),this.fire(new s.l("moveend",o))}flyTo(o,u){if(!o.essential&&b.prefersReducedMotion){let Tt=s.O(o,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Tt,u)}this.stop(),o=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.cb},o);let _=this._getTransformForUpdate(),v=_.bearing,C=_.pitch,O=_.roll,N=_.padding,V="bearing"in o?this._normalizeBearing(o.bearing,v):v,H="pitch"in o?+o.pitch:C,K="roll"in o?this._normalizeBearing(o.roll,O):O,ne="padding"in o?o.padding:_.padding,ie=s.P.convert(o.offset),fe=_.centerPoint.add(ie),Ae=_.screenPointToLocation(fe),Ie=this.cameraHelper.handleFlyTo(_,{bearing:V,pitch:H,roll:K,padding:ne,locationAtOffset:Ae,offsetAsPoint:ie,center:o.center,minZoom:o.minZoom,zoom:o.zoom}),Se=o.curve,Me=Math.max(_.width,_.height),ke=Me/Ie.scaleOfZoom,Ve=Ie.pixelPathLength;typeof Ie.scaleOfMinZoom=="number"&&(Se=Math.sqrt(Me/Ie.scaleOfMinZoom/Ve*2));let Be=Se*Se;function qe(Tt){let er=(ke*ke-Me*Me+(Tt?-1:1)*Be*Be*Ve*Ve)/(2*(Tt?ke:Me)*Be*Ve);return Math.log(Math.sqrt(er*er+1)-er)}function Ge(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function Ze(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}let _t=qe(!1),At=function(Tt){return Ze(_t)/Ze(_t+Se*Tt)},Mt=function(Tt){return Me*((Ze(_t)*(Ge(er=_t+Se*Tt)/Ze(er))-Ge(_t))/Be)/Ve;var er},Lt=(qe(!0)-_t)/Se;if(Math.abs(Ve)<2e-6||!isFinite(Lt)){if(Math.abs(Me-ke)<1e-6)return this.easeTo(o,u);let Tt=ke<Me?-1:1;Lt=Math.abs(Math.log(ke/Me))/Se,Mt=()=>0,At=er=>Math.exp(Tt*Se*er)}return o.duration="duration"in o?+o.duration:1e3*Lt/("screenSpeed"in o?+o.screenSpeed/Se:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=v!==V,this._pitching=H!==C,this._rolling=K!==O,this._padding=!_.isPaddingEqual(ne),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Ie.targetCenter),this._ease(Tt=>{let er=Tt*Lt,Kt=1/At(er),Ut=Mt(er);this._rotating&&_.setBearing(s.B.number(v,V,Tt)),this._pitching&&_.setPitch(s.B.number(C,H,Tt)),this._rolling&&_.setRoll(s.B.number(O,K,Tt)),this._padding&&(_.interpolatePadding(N,ne,Tt),fe=_.centerPoint.add(ie)),Ie.easeFunc(Tt,Kt,Ut,fe),this.terrain&&!o.freezeElevation&&this._updateElevation(Tt),this._applyUpdatedTransform(_),this._fireMoveEvents(u)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){var _;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,u)}return o||(_=this.handlers)===null||_===void 0||_.stop(!1),this}_ease(o,u,_){_.animate===!1||_.duration===0?(o(1),u()):(this._easeStart=b.now(),this._easeOptions=_,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,u){o=s.aL(o,-180,180);let _=Math.abs(o-u);return Math.abs(o-360-u)<_&&(o-=360),Math.abs(o+360-u)<_&&(o+=360),o}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(s.Q.convert(o),this.transform.tileZoom):null}}let Yu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class yr{constructor(o=Yu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=T.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=T.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=T.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,u){let _=this._map._getUIString(`AttributionControl.${u}`);o.title=_,o.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let u=this._map.style.sourceCaches;for(let v in u){let C=u[v];if(C.used||C.usedForTerrain){let O=C.getSource();O.attribution&&o.indexOf(O.attribution)<0&&o.push(O.attribution)}}o=o.filter(v=>String(v).trim()),o.sort((v,C)=>v.length-C.length),o=o.filter((v,C)=>{for(let O=C+1;O<o.length;O++)if(o[O].indexOf(v)>=0)return!1;return!0});let _=o.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,o.length?(this._innerContainer.innerHTML=T.sanitize(_),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Mr{constructor(o={}){this._updateCompact=()=>{let u=this._container.children;if(u.length){let _=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=T.create("div","maplibregl-ctrl");let u=T.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){T.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class pf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){let u=this._currentlyRunning,_=u?this._queue.concat(u):this._queue;for(let v of _)if(v.id===o)return void(v.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let u=this._currentlyRunning=this._queue;this._queue=[];for(let _ of u)if(!_.cancelled&&(_.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var jd=s.aD([{name:"a_pos3d",type:"Int16",components:3}]);class Af extends s.E{constructor(o){super(),this._lastTilesetChange=b.now(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=o._source.tileSize*2**this.deltaZoom,o.usedForTerrain=!0,o.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,u){this.sourceCache.update(o,u),this._renderableTilesKeys=[];let _={};for(let v of ot(o,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))_[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.terrainRttPosMatrix32f=new Float64Array(16),s.bO(v.terrainRttPosMatrix32f,0,s.Z,s.Z,0,0,1),this._tiles[v.key]=new Tr(v,this.tileSize),this._lastTilesetChange=b.now());for(let v in this._tiles)_[v]||delete this._tiles[v]}freeRtt(o){for(let u in this._tiles){let _=this._tiles[u];(!o||_.tileID.equals(o)||_.tileID.isChildOf(o)||o.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o,u){return u?this._getTerrainCoordsForTileRanges(o,u):this._getTerrainCoordsForRegularTile(o)}_getTerrainCoordsForRegularTile(o){let u={};for(let _ of this._renderableTilesKeys){let v=this._tiles[_].tileID,C=o.clone(),O=s.b2();if(v.canonical.equals(o.canonical))s.bO(O,0,s.Z,s.Z,0,0,1);else if(v.canonical.isChildOf(o.canonical)){let N=v.canonical.z-o.canonical.z,V=v.canonical.x-(v.canonical.x>>N<<N),H=v.canonical.y-(v.canonical.y>>N<<N),K=s.Z>>N;s.bO(O,0,K,K,0,0,1),s.L(O,O,[-V*K,-H*K,0])}else{if(!o.canonical.isChildOf(v.canonical))continue;{let N=o.canonical.z-v.canonical.z,V=o.canonical.x-(o.canonical.x>>N<<N),H=o.canonical.y-(o.canonical.y>>N<<N),K=s.Z>>N;s.bO(O,0,s.Z,s.Z,0,0,1),s.L(O,O,[V*K,H*K,0]),s.M(O,O,[1/2**N,1/2**N,0])}}C.terrainRttPosMatrix32f=new Float32Array(O),u[_]=C}return u}_getTerrainCoordsForTileRanges(o,u){let _={};for(let v of this._renderableTilesKeys){let C=this._tiles[v].tileID;if(!this._isWithinTileRanges(C,u))continue;let O=o.clone(),N=s.b2();if(C.canonical.z===o.canonical.z){let V=o.canonical.x-C.canonical.x,H=o.canonical.y-C.canonical.y;s.bO(N,0,s.Z,s.Z,0,0,1),s.L(N,N,[V*s.Z,H*s.Z,0])}else if(C.canonical.z>o.canonical.z){let V=C.canonical.z-o.canonical.z,H=C.canonical.x-(C.canonical.x>>V<<V),K=C.canonical.y-(C.canonical.y>>V<<V),ne=o.canonical.x-(C.canonical.x>>V),ie=o.canonical.y-(C.canonical.y>>V),fe=s.Z>>V;s.bO(N,0,fe,fe,0,0,1),s.L(N,N,[-H*fe+ne*s.Z,-K*fe+ie*s.Z,0])}else{let V=o.canonical.z-C.canonical.z,H=o.canonical.x-(o.canonical.x>>V<<V),K=o.canonical.y-(o.canonical.y>>V<<V),ne=(o.canonical.x>>V)-C.canonical.x,ie=(o.canonical.y>>V)-C.canonical.y,fe=s.Z<<V;s.bO(N,0,fe,fe,0,0,1),s.L(N,N,[H*s.Z+ne*fe,K*s.Z+ie*fe,0])}O.terrainRttPosMatrix32f=new Float32Array(N),_[v]=O}return _}getSourceTile(o,u){let _=this.sourceCache._source,v=o.overscaledZ-this.deltaZoom;if(v>_.maxzoom&&(v=_.maxzoom),v<_.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(v).key);let C=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!C||!C.dem)&&u)for(;v>=_.minzoom&&(!C||!C.dem);)C=this.sourceCache.getTileByID(o.scaledTo(v--).key);return C}anyTilesAfterTime(o=Date.now()){return this._lastTilesetChange>=o}_isWithinTileRanges(o,u){return u[o.canonical.z]&&o.canonical.x>=u[o.canonical.z].minTileX&&o.canonical.x<=u[o.canonical.z].maxTileX&&o.canonical.y>=u[o.canonical.z].minTileY&&o.canonical.y<=u[o.canonical.z].maxTileY}}class to{constructor(o,u,_){this._meshCache={},this.painter=o,this.sourceCache=new Af(u),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,u,_,v=s.Z){var C;if(!(u>=0&&u<v&&_>=0&&_<v))return 0;let O=this.getTerrainData(o),N=(C=O.tile)===null||C===void 0?void 0:C.dem;if(!N)return 0;let V=s.cf([],[u/v*s.Z,_/v*s.Z],O.u_terrain_matrix),H=[V[0]*N.dim,V[1]*N.dim],K=Math.floor(H[0]),ne=Math.floor(H[1]),ie=H[0]-K,fe=H[1]-ne;return N.get(K,ne)*(1-ie)*(1-fe)+N.get(K+1,ne)*ie*(1-fe)+N.get(K,ne+1)*(1-ie)*fe+N.get(K+1,ne+1)*ie*fe}getElevationForLngLatZoom(o,u){if(!s.cg(u,o.wrap()))return 0;let{tileID:_,mercatorX:v,mercatorY:C}=this._getOverscaledTileIDFromLngLatZoom(o,u);return this.getElevation(_,v%s.Z,C%s.Z,s.Z)}getElevation(o,u,_,v=s.Z){return this.getDEMElevation(o,u,_,v)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){let v=this.painter.context,C=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new je(v,C,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new je(v,new s.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.at([])}let u=this.sourceCache.getSourceTile(o,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){let v=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new je(v,u.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),u.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}let _=u&&u+u.tileID.key+o.key;if(_&&!this._demMatrixCache[_]){let v=this.sourceCache.sourceCache._source.maxzoom,C=o.canonical.z-u.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=v?C=o.canonical.z-v:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let O=o.canonical.x-(o.canonical.x>>C<<C),N=o.canonical.y-(o.canonical.y>>C<<C),V=s.ch(new Float64Array(16),[1/(s.Z<<C),1/(s.Z<<C),0]);s.L(V,V,[O*s.Z,N*s.Z,0]),this._demMatrixCache[o.key]={matrix:V,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(o){let u=this.painter,_=u.width/devicePixelRatio,v=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new je(u.context,{width:_,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new je(u.context,{width:_,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(_,v,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,_,v))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let C=0,O=0;C<this._coordsTextureSize;C++)for(let N=0;N<this._coordsTextureSize;N++,O+=4)u[O+0]=255&N,u[O+1]=255&C,u[O+2]=N>>8<<4|C>>8,u[O+3]=0;let _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),v=new je(o,_,o.gl.RGBA,{premultiply:!1});return v.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);let u=new Uint8Array(4),_=this.painter.context,v=_.gl,C=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),O=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),N=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(C,N-O-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null);let V=u[0]+(u[2]>>4<<8),H=u[1]+((15&u[2])<<8),K=this.coordsIndex[255-u[3]],ne=K&&this.sourceCache.getTileByID(K);if(!ne)return null;let ie=this._coordsTextureSize,fe=(1<<ne.tileID.canonical.z)*ie;return new s.$((ne.tileID.canonical.x*ie+V)/fe+ne.tileID.wrap,(ne.tileID.canonical.y*ie+H)/fe,this.getElevation(ne.tileID,V,H,ie))}depthAtPoint(o){let u=new Uint8Array(4),_=this.painter.context,v=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),_.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(o){var u;let _=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,v=_&&o.canonical.y===0,C=_&&o.canonical.y===(1<<o.canonical.z)-1,O=`m_${v?"n":""}_${C?"s":""}`;if(this._meshCache[O])return this._meshCache[O];let N=this.painter.context,V=new s.ci,H=new s.aH,K=this.meshSize,ne=s.Z/K,ie=K*K;for(let Ze=0;Ze<=K;Ze++)for(let _t=0;_t<=K;_t++)V.emplaceBack(_t*ne,Ze*ne,0);for(let Ze=0;Ze<ie;Ze+=K+1)for(let _t=0;_t<K;_t++)H.emplaceBack(_t+Ze,K+_t+Ze+1,K+_t+Ze+2),H.emplaceBack(_t+Ze,K+_t+Ze+2,_t+Ze+1);let fe=V.length,Ae=fe+(K+1),Ie=(K+1)*K,Se=v?s.b9:0,Me=v?0:1,ke=C?s.ba:s.Z,Ve=C?0:1;for(let Ze=0;Ze<=K;Ze++)V.emplaceBack(Ze*ne,Se,Me);for(let Ze=0;Ze<=K;Ze++)V.emplaceBack(Ze*ne,ke,Ve);for(let Ze=0;Ze<K;Ze++)H.emplaceBack(Ie+Ze,Ae+Ze,Ae+Ze+1),H.emplaceBack(Ie+Ze,Ae+Ze+1,Ie+Ze+1),H.emplaceBack(0+Ze,fe+Ze+1,fe+Ze),H.emplaceBack(0+Ze,0+Ze+1,fe+Ze+1);let Be=V.length,qe=Be+2*(K+1);for(let Ze of[0,1])for(let _t=0;_t<=K;_t++)for(let At of[0,1])V.emplaceBack(Ze*s.Z,_t*ne,At);for(let Ze=0;Ze<2*K;Ze+=2)H.emplaceBack(Be+Ze,Be+Ze+1,Be+Ze+3),H.emplaceBack(Be+Ze,Be+Ze+3,Be+Ze+2),H.emplaceBack(qe+Ze,qe+Ze+3,qe+Ze+1),H.emplaceBack(qe+Ze,qe+Ze+2,qe+Ze+3);let Ge=new Sc(N.createVertexBuffer(V,jd.members),N.createIndexBuffer(H),s.aG.simpleSegment(0,0,V.length,H.length));return this._meshCache[O]=Ge,Ge}getMeshFrameDelta(o){return 2*Math.PI*s.br/Math.pow(2,Math.max(o,0))/5}getMinTileElevationForLngLatZoom(o,u){var _;let{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(o,u);return(_=this.getMinMaxElevation(v).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(o){let u=this.getTerrainData(o).tile,_={minElevation:null,maxElevation:null};return u&&u.dem&&(_.minElevation=u.dem.min*this.exaggeration,_.maxElevation=u.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(o,u){let _=s.$.fromLngLat(o.wrap()),v=(1<<u)*s.Z,C=_.x*v,O=_.y*v,N=Math.floor(C/s.Z),V=Math.floor(O/s.Z);return{tileID:new s.Y(u,0,u,N,V),mercatorX:C,mercatorY:O}}}class Gd{constructor(o,u,_){this._context=o,this._size=u,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){let u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new je(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(_.texture),{id:o,fbo:u,texture:_,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>o.id!==u),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(let u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(let o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}let Sn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class PA{constructor(o,u){this.painter=o,this.terrain=u,this.pool=new Gd(o.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(_=>!o._layers[_].isHidden(u)),this._coordsAscending={};for(let _ in o.sourceCaches){this._coordsAscending[_]={};let v=o.sourceCaches[_].getVisibleCoordinates(),C=o.sourceCaches[_].getSource(),O=C instanceof Kn?C.terrainTileRanges:null;for(let N of v){let V=this.terrain.sourceCache.getTerrainCoords(N,O);for(let H in V)this._coordsAscending[_][H]||(this._coordsAscending[_][H]=[]),this._coordsAscending[_][H].push(V[H])}}this._coordsAscendingStr={};for(let _ of o._order){let v=o._layers[_],C=v.source;if(Sn[v.type]&&!this._coordsAscendingStr[C]){this._coordsAscendingStr[C]={};for(let O in this._coordsAscending[C])this._coordsAscendingStr[C][O]=this._coordsAscending[C][O].map(N=>N.key).sort().join()}}for(let _ of this._renderableTiles)for(let v in this._coordsAscendingStr){let C=this._coordsAscendingStr[v][_.tileID.key];C&&C!==_.rttCoords[v]&&(_.rtt=[])}}renderLayer(o,u){if(o.isHidden(this.painter.transform.zoom))return!1;let _=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),v=o.type,C=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Sn[v]&&(this._prevType&&Sn[this._prevType]||this._stacks.push([]),this._prevType=v,this._stacks[this._stacks.length-1].push(o.id),!O))return!0;if(Sn[this._prevType]||Sn[v]&&O){this._prevType=v;let N=this._stacks.length-1,V=this._stacks[N]||[];for(let H of this._renderableTiles){if(this.pool.isFull()&&(Qa(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[N]){let ne=this.pool.getObjectForId(H.rtt[N].id);if(ne.stamp===H.rtt[N].stamp){this.pool.useObject(ne);continue}}let K=this.pool.getOrCreateFreeObject();this.pool.useObject(K),this.pool.stampObject(K),H.rtt[N]={id:K.id,stamp:K.stamp},C.context.bindFramebuffer.set(K.fbo.framebuffer),C.context.clear({color:s.b7.transparent,stencil:0}),C.currentStencilSource=void 0;for(let ne=0;ne<V.length;ne++){let ie=C.style._layers[V[ne]],fe=ie.source?this._coordsAscending[ie.source][H.tileID.key]:[H.tileID];C.context.viewport.set([0,0,K.fbo.width,K.fbo.height]),C._renderTileClippingMasks(ie,fe,!0),C.renderLayer(C,C.style.sourceCaches[ie.source],ie,fe,_),ie.source&&(H.rttCoords[ie.source]=this._coordsAscendingStr[ie.source][H.tileID.key])}}return Qa(this.painter,this.terrain,this._rttTiles,_),this._rttTiles=[],this.pool.freeAllObjects(),Sn[v]}return!1}}let Ku={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Cn=a,Bn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Yu,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},MA={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Qu{constructor(o,u,_=!1){this.mousedown=C=>{this.startMove(C,T.mousePos(this.element,C)),T.addEventListener(window,"mousemove",this.mousemove),T.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.move(C,T.mousePos(this.element,C))},this.mouseup=C=>{this._rotatePitchHanlder.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=T.touchPos(this.element,C.targetTouches)[0],this.startMove(C,this._startPos),T.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=T.touchPos(this.element,C.targetTouches)[0],this.move(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;let v=new hf;this._rotatePitchHanlder=new el({clickTolerance:3,move:(C,O)=>{let N=u.getBoundingClientRect(),V=new s.P((N.bottom-N.top)/2,(N.right-N.left)/2);return{bearingDelta:s.ca(new s.P(C.x,O.y),O,V),pitchDelta:_?-.5*(O.y-C.y):void 0}},moveStateManager:v,enable:!0,assignEvents:()=>{}}),this.map=o,T.addEventListener(u,"mousedown",this.mousedown),T.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),T.addEventListener(u,"touchcancel",this.reset)}startMove(o,u){this._rotatePitchHanlder.dragStart(o,u),T.disableDrag()}move(o,u){let _=this.map,{bearingDelta:v,pitchDelta:C}=this._rotatePitchHanlder.dragMove(o,u)||{};v&&_.setBearing(_.getBearing()+v),C&&_.setPitch(_.getPitch()+C)}off(){let o=this.element;T.removeEventListener(o,"mousedown",this.mousedown),T.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend),T.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){T.enableDrag(),T.removeEventListener(window,"mousemove",this.mousemove),T.removeEventListener(window,"mouseup",this.mouseup),T.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),T.removeEventListener(window,"touchend",this.touchend)}}let cs;function Ju(S,o,u){let _=new s.Q(S.lng,S.lat);if(S=new s.Q(S.lng,S.lat),o){let v=new s.Q(S.lng-360,S.lat),C=new s.Q(S.lng+360,S.lat),O=u.locationToScreenPoint(S).distSqr(o);u.locationToScreenPoint(v).distSqr(o)<O?S=v:u.locationToScreenPoint(C).distSqr(o)<O&&(S=C)}for(;Math.abs(S.lng-u.center.lng)>180;){let v=u.locationToScreenPoint(S);if(v.x>=0&&v.y>=0&&v.x<=u.width&&v.y<=u.height)break;S.lng>u.center.lng?S.lng-=360:S.lng+=360}return S.lng!==_.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(S))?S:_}let Hc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mf(S,o,u){let _=S.classList;for(let v in Hc)_.remove(`maplibregl-${u}-anchor-${v}`);_.add(`maplibregl-${u}-anchor-${o}`)}class Xl extends s.E{constructor(o){if(super(),this._onKeyPress=u=>{let _=u.code,v=u.charCode||u.keyCode;_!=="Space"&&_!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=u=>{let _=u.originalEvent.target,v=this._element;this._popup&&(_===v||v.contains(_))&&this.togglePopup()},this._update=u=>{var _;if(!this._map)return;let v=this._map.loaded()&&!this._map.isMoving();(u?.type==="terrain"||u?.type==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ju(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let C="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?C=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(C=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let O="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?O="rotateX(0deg)":this._pitchAlignment==="map"&&(O=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),T.setTransform(this._element,`${Hc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${O} ${C}`),b.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){let _=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.l("dragstart"))),this.fire(new s.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=s.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=T.create("div");let u=T.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${_}px`),u.setAttributeNS(null,"width",`${v}px`),u.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);let C=T.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");let O=T.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");let N=T.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");let V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let Me of V){let ke=T.createNS("http://www.w3.org/2000/svg","ellipse");ke.setAttributeNS(null,"opacity","0.04"),ke.setAttributeNS(null,"cx","10.5"),ke.setAttributeNS(null,"cy","5.80029008"),ke.setAttributeNS(null,"rx",Me.rx),ke.setAttributeNS(null,"ry",Me.ry),N.appendChild(ke)}let H=T.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);let K=T.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(K);let ne=T.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"fill","#000000");let ie=T.createNS("http://www.w3.org/2000/svg","path");ie.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ne.appendChild(ie);let fe=T.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),fe.setAttributeNS(null,"fill","#FFFFFF");let Ae=T.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");let Ie=T.createNS("http://www.w3.org/2000/svg","circle");Ie.setAttributeNS(null,"fill","#000000"),Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"cx","5.5"),Ie.setAttributeNS(null,"cy","5.5"),Ie.setAttributeNS(null,"r","5.4999962");let Se=T.createNS("http://www.w3.org/2000/svg","circle");Se.setAttributeNS(null,"fill","#FFFFFF"),Se.setAttributeNS(null,"cx","5.5"),Se.setAttributeNS(null,"cy","5.5"),Se.setAttributeNS(null,"r","5.4999962"),Ae.appendChild(Ie),Ae.appendChild(Se),O.appendChild(N),O.appendChild(H),O.appendChild(ne),O.appendChild(fe),O.appendChild(Ae),u.appendChild(O),u.setAttributeNS(null,"height",_*this._scale+"px"),u.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(u),this._offset=s.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),mf(this._element,this._anchor,"marker"),o&&o.className)for(let u of o.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),o.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),T.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.Q.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let v=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){let o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var u,_;if(!(!((u=this._map)===null||u===void 0)&&u.terrain)){let ne=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ne&&(this._element.style.opacity=ne))}if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let v=this._map,C=v.terrain.depthAtPoint(this._pos),O=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,O)-C<.006)return void(this._element.style.opacity=this._opacity);let N=-this._offset.y/v.transform.pixelsPerMeter,V=Math.sin(v.getPitch()*Math.PI/180)*N,H=v.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),K=v.transform.lngLatToCameraDepth(this._lngLat,O+V)-H>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&K&&this._popup.remove(),this._element.style.opacity=K?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=s.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,u){return(this._opacity===void 0||o===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}let Hd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Wc=0,Yl=!1,Wd={maxWidth:100,unit:"metric"};function gf(S,o,u){let _=u&&u.maxWidth||100,v=S._container.clientHeight/2,C=S._container.clientWidth/2,O=S.unproject([C-_/2,v]),N=S.unproject([C+_/2,v]),V=Math.round(S.project(N).x-S.project(O).x),H=Math.min(_,V,S._container.clientWidth),K=O.distanceTo(N);if(u&&u.unit==="imperial"){let ne=3.2808*K;ne>5280?Kl(o,H,ne/5280,S._getUIString("ScaleControl.Miles")):Kl(o,H,ne,S._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Kl(o,H,K/1852,S._getUIString("ScaleControl.NauticalMiles")):K>=1e3?Kl(o,H,K/1e3,S._getUIString("ScaleControl.Kilometers")):Kl(o,H,K,S._getUIString("ScaleControl.Meters"))}function Kl(S,o,u,_){let v=function(C){let O=Math.pow(10,`${Math.floor(C)}`.length-1),N=C/O;return N=N>=10?10:N>=5?5:N>=3?3:N>=2?2:N>=1?1:function(V){let H=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*H)/H}(N),O*N}(u);S.style.width=o*(v/u)+"px",S.innerHTML=`${v}&nbsp;${_}`}let $d={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},qd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function eh(S){if(S){if(typeof S=="number"){let o=Math.round(Math.abs(S)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,S),"top-left":new s.P(o,o),"top-right":new s.P(-o,o),bottom:new s.P(0,-S),"bottom-left":new s.P(o,-o),"bottom-right":new s.P(-o,-o),left:new s.P(S,0),right:new s.P(-S,0)}}if(S instanceof s.P||Array.isArray(S)){let o=s.P.convert(S);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:s.P.convert(S.center||[0,0]),top:s.P.convert(S.top||[0,0]),"top-left":s.P.convert(S["top-left"]||[0,0]),"top-right":s.P.convert(S["top-right"]||[0,0]),bottom:s.P.convert(S.bottom||[0,0]),"bottom-left":s.P.convert(S["bottom-left"]||[0,0]),"bottom-right":s.P.convert(S["bottom-right"]||[0,0]),left:s.P.convert(S.left||[0,0]),right:s.P.convert(S.right||[0,0])}}return eh(new s.P(0,0))}let _f=a;n.AJAXError=s.cm,n.Event=s.l,n.Evented=s.E,n.LngLat=s.Q,n.MercatorCoordinate=s.$,n.Point=s.P,n.addProtocol=s.cn,n.config=s.a,n.removeProtocol=s.co,n.AttributionControl=yr,n.BoxZoomHandler=$l,n.CanvasSource=ea,n.CooperativeGesturesHandler=df,n.DoubleClickZoomHandler=Ud,n.DragPanHandler=Pa,n.DragRotateHandler=an,n.EdgeInsets=gn,n.FullscreenControl=class extends s.E{constructor(S={}){super(),this._onFullscreenChange=()=>{var o;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=u?.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,S&&S.container&&(S.container instanceof HTMLElement?this._container=S.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(S){return this._map=S,this._container||(this._container=this._map.getContainer()),this._controlContainer=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){T.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let S=this._fullscreenButton=T.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);T.create("span","maplibregl-ctrl-icon",S).setAttribute("aria-hidden","true"),S.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let S=this._getTitle();this._fullscreenButton.setAttribute("aria-label",S),this._fullscreenButton.title=S}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},n.GeoJSONSource=Ds,n.GeolocateControl=class extends s.E{constructor(S){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new s.l("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.l("geolocate",o)),this._finish()}},this._updateCamera=o=>{let u=new s.Q(o.coords.longitude,o.coords.latitude),_=o.coords.accuracy,v=this._map.getBearing(),C=s.e({bearing:v},this.options.fitBoundsOptions),O=li.fromLngLat(u,_);this._map.fitBounds(O,C,{geolocateSource:!0})},this._updateMarker=o=>{if(o){let u=new s.Q(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Yl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.l("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=T.create("button","maplibregl-ctrl-geolocate",this._container),T.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{let u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=T.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Xl({element:this._dotElement}),this._circleElement=T.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.l("trackuserlocationend")),this.fire(new s.l("userlocationlostfocus")))})}},this.options=s.e({},Hd,S)}onAdd(S){return this._map=S,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(o=!1){if(cs!==void 0&&!o)return cs;if(window.navigator.permissions===void 0)return cs=!!window.navigator.geolocation,cs;try{cs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{cs=!!window.navigator.geolocation}return cs})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),T.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wc=0,Yl=!1}_isOutOfMapMaxBounds(S){let o=this._map.getMaxBounds(),u=S.coords;return o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let S=this._map.getBounds(),o=S.getSouthEast(),u=S.getNorthEast(),_=o.distanceTo(u),v=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wc--,Yl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.l("trackuserlocationstart")),this.fire(new s.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let S;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wc++,Wc>1?(S={maximumAge:6e5,timeout:0},Yl=!0):(S=this.options.positionOptions,Yl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,S)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},n.GlobeControl=class{constructor(){this._toggleProjection=()=>{var S;let o=(S=this._map.getProjection())===null||S===void 0?void 0:S.type;this._map.setProjection(o!=="mercator"&&o?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var S;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((S=this._map.getProjection())===null||S===void 0?void 0:S.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(S){return this._map=S,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=T.create("button","maplibregl-ctrl-globe",this._container),T.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){T.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},n.Hash=Ja,n.ImageSource=Kn,n.KeyboardHandler=ql,n.LngLatBounds=li,n.LogoControl=Mr,n.Map=class extends ha{constructor(S){var o,u;s.cj.mark(s.ck.create);let _=Object.assign(Object.assign(Object.assign({},Bn),S),{canvasContextAttributes:Object.assign(Object.assign({},Bn.canvasContextAttributes),S.canvasContextAttributes)});if(_.minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let v=new _n,C=new mo;if(_.minZoom!==void 0&&v.setMinZoom(_.minZoom),_.maxZoom!==void 0&&v.setMaxZoom(_.maxZoom),_.minPitch!==void 0&&v.setMinPitch(_.minPitch),_.maxPitch!==void 0&&v.setMaxPitch(_.maxPitch),_.renderWorldCopies!==void 0&&v.setRenderWorldCopies(_.renderWorldCopies),super(v,C,{bearingSnap:_.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new pf,this._controls=[],this._mapId=s.a4(),this._contextLost=N=>{N.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.l("webglcontextlost",{originalEvent:N}))},this._contextRestored=N=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.l("webglcontextrestored",{originalEvent:N}))},this._onMapScroll=N=>{if(N.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},_.canvasContextAttributes),this._trackResize=_.trackResize===!0,this._bearingSnap=_.bearingSnap,this._centerClampedToGround=_.centerClampedToGround,this._refreshExpiredTiles=_.refreshExpiredTiles===!0,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions===!0,this._collectResourceTiming=_.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ku),_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=_.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new ae(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let N=!1,V=lf(H=>{this._trackResize&&!this._removed&&(this.resize(H),this.redraw())},50);this._resizeObserver=new ResizeObserver(H=>{N?V(H):N=!0}),this._resizeObserver.observe(this._container)}this.handlers=new qm(this,_),this._hash=_.hash&&new Ja(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch,roll:_.roll}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,s.e({},_.fitBoundsOptions,{duration:0}))));let O=typeof _.style=="string"||((u=(o=_.style)===null||o===void 0?void 0:o.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,O),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new yr(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Mr,_.logoPosition),this.on("style.load",()=>{if(O||this._resizeTransform(),this.transform.unmodified){let N=s.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(N)}}),this.on("data",N=>{this._update(N.dataType==="style"),this.fire(new s.l(`${N.dataType}data`,N))}),this.on("dataloading",N=>{this.fire(new s.l(`${N.dataType}dataloading`,N))}),this.on("dataabort",N=>{this.fire(new s.l("sourcedataabort",N))})}_getMapId(){return this._mapId}addControl(S,o){if(o===void 0&&(o=S.getDefaultPosition?S.getDefaultPosition():"top-right"),!S||!S.onAdd)return this.fire(new s.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=S.onAdd(this);this._controls.push(S);let _=this._controlPositions[o];return o.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}removeControl(S){if(!S||!S.onRemove)return this.fire(new s.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(S);return o>-1&&this._controls.splice(o,1),S.onRemove(this),this}hasControl(S){return this._controls.indexOf(S)>-1}calculateCameraOptionsFromTo(S,o,u,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(S,o,u,_)}resize(S,o=!0){let[u,_]=this._containerDimensions(),v=this._getClampedPixelRatio(u,_);if(this._resizeCanvas(u,_,v),this.painter.resize(u,_,v),this.painter.overLimit()){let O=this.painter.context.gl;this._maxCanvasSize=[O.drawingBufferWidth,O.drawingBufferHeight];let N=this._getClampedPixelRatio(u,_);this._resizeCanvas(u,_,N),this.painter.resize(u,_,N)}this._resizeTransform(o);let C=!this._moving;return C&&(this.stop(),this.fire(new s.l("movestart",S)).fire(new s.l("move",S))),this.fire(new s.l("resize",S)),C&&this.fire(new s.l("moveend",S)),this}_resizeTransform(S=!0){var o;let[u,_]=this._containerDimensions();this.transform.resize(u,_,S),(o=this._requestedCameraState)===null||o===void 0||o.resize(u,_,S)}_getClampedPixelRatio(S,o){let{0:u,1:_}=this._maxCanvasSize,v=this.getPixelRatio(),C=S*v,O=o*v;return Math.min(C>u?u/C:1,O>_?_/O:1)*v}getPixelRatio(){var S;return(S=this._overridePixelRatio)!==null&&S!==void 0?S:devicePixelRatio}setPixelRatio(S){this._overridePixelRatio=S,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(S){return this.transform.setMaxBounds(li.convert(S)),this._update()}setMinZoom(S){if((S=S??-2)>=-2&&S<=this.transform.maxZoom)return this.transform.setMinZoom(S),this._update(),this.getZoom()<S&&this.setZoom(S),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(S){if((S=S??22)>=this.transform.minZoom)return this.transform.setMaxZoom(S),this._update(),this.getZoom()>S&&this.setZoom(S),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(S){if((S=S??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(S>=0&&S<=this.transform.maxPitch)return this.transform.setMinPitch(S),this._update(),this.getPitch()<S&&this.setPitch(S),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(S){if((S=S??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(S>=this.transform.minPitch)return this.transform.setMaxPitch(S),this._update(),this.getPitch()>S&&this.setPitch(S),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(S){return this.transform.setRenderWorldCopies(S),this._update()}project(S){return this.transform.locationToScreenPoint(s.Q.convert(S),this.style&&this.terrain)}unproject(S){return this.transform.screenPointToLocation(s.P.convert(S),this.terrain)}isMoving(){var S;return this._moving||((S=this.handlers)===null||S===void 0?void 0:S.isMoving())}isZooming(){var S;return this._zooming||((S=this.handlers)===null||S===void 0?void 0:S.isZooming())}isRotating(){var S;return this._rotating||((S=this.handlers)===null||S===void 0?void 0:S.isRotating())}_createDelegatedListener(S,o,u){if(S==="mouseenter"||S==="mouseover"){let _=!1;return{layers:o,listener:u,delegates:{mousemove:C=>{let O=o.filter(V=>this.getLayer(V)),N=O.length!==0?this.queryRenderedFeatures(C.point,{layers:O}):[];N.length?_||(_=!0,u.call(this,new Ts(S,this,C.originalEvent,{features:N}))):_=!1},mouseout:()=>{_=!1}}}}if(S==="mouseleave"||S==="mouseout"){let _=!1;return{layers:o,listener:u,delegates:{mousemove:O=>{let N=o.filter(V=>this.getLayer(V));(N.length!==0?this.queryRenderedFeatures(O.point,{layers:N}):[]).length?_=!0:_&&(_=!1,u.call(this,new Ts(S,this,O.originalEvent)))},mouseout:O=>{_&&(_=!1,u.call(this,new Ts(S,this,O.originalEvent)))}}}}{let _=v=>{let C=o.filter(N=>this.getLayer(N)),O=C.length!==0?this.queryRenderedFeatures(v.point,{layers:C}):[];O.length&&(v.features=O,u.call(this,v),delete v.features)};return{layers:o,listener:u,delegates:{[S]:_}}}}_saveDelegatedListener(S,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[S]=this._delegatedListeners[S]||[],this._delegatedListeners[S].push(o)}_removeDelegatedListener(S,o,u){if(!this._delegatedListeners||!this._delegatedListeners[S])return;let _=this._delegatedListeners[S];for(let v=0;v<_.length;v++){let C=_[v];if(C.listener===u&&C.layers.length===o.length&&C.layers.every(O=>o.includes(O))){for(let O in C.delegates)this.off(O,C.delegates[O]);return void _.splice(v,1)}}}on(S,o,u){if(u===void 0)return super.on(S,o);let _=typeof o=="string"?[o]:o,v=this._createDelegatedListener(S,_,u);this._saveDelegatedListener(S,v);for(let C in v.delegates)this.on(C,v.delegates[C]);return{unsubscribe:()=>{this._removeDelegatedListener(S,_,u)}}}once(S,o,u){if(u===void 0)return super.once(S,o);let _=typeof o=="string"?[o]:o,v=this._createDelegatedListener(S,_,u);for(let C in v.delegates){let O=v.delegates[C];v.delegates[C]=(...N)=>{this._removeDelegatedListener(S,_,u),O(...N)}}this._saveDelegatedListener(S,v);for(let C in v.delegates)this.once(C,v.delegates[C]);return this}off(S,o,u){return u===void 0?super.off(S,o):(this._removeDelegatedListener(S,typeof o=="string"?[o]:o,u),this)}queryRenderedFeatures(S,o){if(!this.style)return[];let u,_=S instanceof s.P||Array.isArray(S),v=_?S:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(_?{}:S)||{},v instanceof s.P||typeof v[0]=="number")u=[s.P.convert(v)];else{let C=s.P.convert(v[0]),O=s.P.convert(v[1]);u=[C,new s.P(O.x,C.y),O,new s.P(C.x,O.y),C]}return this.style.queryRenderedFeatures(u,o,this.transform)}querySourceFeatures(S,o){return this.style.querySourceFeatures(S,o)}setStyle(S,o){return(o=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&S?(this._diffStyle(S,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(S,o))}setTransformRequest(S){return this._requestManager.setTransformRequest(S),this}_getUIString(S){let o=this._locale[S];if(o==null)throw new Error(`Missing UI string '${S}'`);return o}_updateStyle(S,o){var u,_;if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(S,o));let v=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!S)),S?(this.style=new wa(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof S=="string"?this.style.loadURL(S,o,v):this.style.loadJSON(S,o,v),this):((_=(u=this.style)===null||u===void 0?void 0:u.projection)===null||_===void 0||_.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(S,o){if(typeof S=="string"){let u=this._requestManager.transformRequest(S,"Style");s.j(u,new AbortController).then(_=>{this._updateDiff(_.data,o)}).catch(_=>{_&&this.fire(new s.k(_))})}else typeof S=="object"&&this._updateDiff(S,o)}_updateDiff(S,o){try{this.style.setState(S,o)&&this._update(!0)}catch(u){s.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(S,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(S,o){return this._lazyInitEmptyStyle(),this.style.addSource(S,o),this._update(!0)}isSourceLoaded(S){let o=this.style&&this.style.sourceCaches[S];if(o!==void 0)return o.loaded();this.fire(new s.k(new Error(`There is no source with ID '${S}'`)))}setTerrain(S){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),S){let o=this.style.sourceCaches[S.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${S.source}`);this.terrain===null&&o.reload();for(let u in this.style._layers){let _=this.style._layers[u];_.type==="hillshade"&&_.source===S.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new to(this.painter,o,S),this.painter.renderToTexture=new PA(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var _;u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==S.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((_=u.source)===null||_===void 0?void 0:_.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.l("terrain",{terrain:S})),this}getTerrain(){var S,o;return(o=(S=this.terrain)===null||S===void 0?void 0:S.options)!==null&&o!==void 0?o:null}areTilesLoaded(){let S=this.style&&this.style.sourceCaches;for(let o in S){let u=S[o]._tiles;for(let _ in u){let v=u[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(S){return this.style.removeSource(S),this._update(!0)}getSource(S){return this.style.getSource(S)}addImage(S,o,u={}){let{pixelRatio:_=1,sdf:v=!1,stretchX:C,stretchY:O,content:N,textFitWidth:V,textFitHeight:H}=u;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||s.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:K,height:ne,data:ie}=o,fe=o;return this.style.addImage(S,{data:new s.R({width:K,height:ne},new Uint8Array(ie)),pixelRatio:_,stretchX:C,stretchY:O,content:N,textFitWidth:V,textFitHeight:H,sdf:v,version:0,userImage:fe}),fe.onAdd&&fe.onAdd(this,S),this}}{let{width:K,height:ne,data:ie}=b.getImageData(o);this.style.addImage(S,{data:new s.R({width:K,height:ne},ie),pixelRatio:_,stretchX:C,stretchY:O,content:N,textFitWidth:V,textFitHeight:H,sdf:v,version:0})}}updateImage(S,o){let u=this.style.getImage(S);if(!u)return this.fire(new s.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let _=o instanceof HTMLImageElement||s.b(o)?b.getImageData(o):o,{width:v,height:C,data:O}=_;if(v===void 0||C===void 0)return this.fire(new s.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==u.data.width||C!==u.data.height)return this.fire(new s.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let N=!(o instanceof HTMLImageElement||s.b(o));return u.data.replace(O,N),this.style.updateImage(S,u),this}getImage(S){return this.style.getImage(S)}hasImage(S){return S?!!this.style.getImage(S):(this.fire(new s.k(new Error("Missing required image id"))),!1)}removeImage(S){this.style.removeImage(S)}loadImage(S){return ee.getImage(this._requestManager.transformRequest(S,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(S,o){return this._lazyInitEmptyStyle(),this.style.addLayer(S,o),this._update(!0)}moveLayer(S,o){return this.style.moveLayer(S,o),this._update(!0)}removeLayer(S){return this.style.removeLayer(S),this._update(!0)}getLayer(S){return this.style.getLayer(S)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(S,o,u){return this.style.setLayerZoomRange(S,o,u),this._update(!0)}setFilter(S,o,u={}){return this.style.setFilter(S,o,u),this._update(!0)}getFilter(S){return this.style.getFilter(S)}setPaintProperty(S,o,u,_={}){return this.style.setPaintProperty(S,o,u,_),this._update(!0)}getPaintProperty(S,o){return this.style.getPaintProperty(S,o)}setLayoutProperty(S,o,u,_={}){return this.style.setLayoutProperty(S,o,u,_),this._update(!0)}getLayoutProperty(S,o){return this.style.getLayoutProperty(S,o)}setGlyphs(S,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(S,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(S,o,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(S,o,u,_=>{_||this._update(!0)}),this}removeSprite(S){return this._lazyInitEmptyStyle(),this.style.removeSprite(S),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(S,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(S,o,u=>{u||this._update(!0)}),this}setLight(S,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(S,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(S,o={}){return this._lazyInitEmptyStyle(),this.style.setSky(S,o),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(S,o){return this.style.setFeatureState(S,o),this._update()}removeFeatureState(S,o){return this.style.removeFeatureState(S,o),this._update()}getFeatureState(S){return this.style.getFeatureState(S)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let S=0,o=0;return this._container&&(S=this._container.clientWidth||400,o=this._container.clientHeight||300),[S,o]}_setupContainer(){let S=this._container;S.classList.add("maplibregl-map");let o=this._canvasContainer=T.create("div","maplibregl-canvas-container",S);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=T.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let u=this._containerDimensions(),_=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],_);let v=this._controlContainer=T.create("div","maplibregl-control-container",S),C=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(O=>{C[O]=T.create("div",`maplibregl-ctrl-${O} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(S,o,u){this._canvas.width=Math.floor(u*S),this._canvas.height=Math.floor(u*o),this._canvas.style.width=`${S}px`,this._canvas.style.height=`${o}px`}_setupPainter(){let S=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),o=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{o={requestedAttributes:S},_&&(o.statusMessage=_.statusMessage,o.type=_.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,S):this._canvas.getContext("webgl2",S)||this._canvas.getContext("webgl",S),!u){let _="Failed to initialize WebGL";throw o?(o.message=_,new Error(JSON.stringify(o))):new Error(_)}this.painter=new af(u,this.transform),B.testSupport(u)}migrateProjection(S,o){super.migrateProjection(S,o),this.painter.transform=S,this.fire(new s.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(S){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||S,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(S){return this._update(),this._renderTaskQueue.add(S)}_cancelRenderFrame(S){this._renderTaskQueue.remove(S)}_render(S){var o,u,_,v,C;let O=this._idleTriggered?this._fadeDuration:0,N=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(S),this._removed)return;let V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let ne=this.transform.zoom,ie=b.now();this.style.zoomHistory.update(ne,ie);let fe=new s.C(ne,{now:ie,fadeDuration:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ae=fe.crossFadingFactor();Ae===1&&Ae===this._crossFadingFactor||(V=!0,this._crossFadingFactor=Ae),this.style.update(fe)}let H=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==N;(_=this.style.projection)===null||_===void 0||_.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((v=this.style.projection)===null||v===void 0?void 0:v.transitionState,(C=this.style.projection)===null||C===void 0?void 0:C.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||H)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,O,this._crossSourceCollisions,H),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:O,showPadding:this.showPadding}),this.fire(new s.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cj.mark(s.ck.load),this.fire(new s.l("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let K=this._sourcesDirty||this._styleDirty||this._placementDirty;return K||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.l("idle")),!this._loaded||this._fullyLoaded||K||(this._fullyLoaded=!0,s.cj.mark(s.ck.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var S;this._hash&&this._hash.remove();for(let u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ee.removeThrottleControl(this._imageQueueHandle),(S=this._resizeObserver)===null||S===void 0||S.disconnect();let o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),T.remove(this._canvasContainer),T.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cj.clearMetrics(),this._removed=!0,this.fire(new s.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,b.frame(this._frameRequest,S=>{s.cj.frame(S),this._frameRequest=null;try{this._render(S)}catch(o){if(!s.cl(o)&&!function(u){return u.message===Jh}(o))throw o}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(S){this._showTileBoundaries!==S&&(this._showTileBoundaries=S,this._update())}get showPadding(){return!!this._showPadding}set showPadding(S){this._showPadding!==S&&(this._showPadding=S,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(S){this._showCollisionBoxes!==S&&(this._showCollisionBoxes=S,S?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(S){this._showOverdrawInspector!==S&&(this._showOverdrawInspector=S,this._update())}get repaint(){return!!this._repaint}set repaint(S){this._repaint!==S&&(this._repaint=S,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(S){this._vertices=S,this._update()}get version(){return Cn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(S){return this._lazyInitEmptyStyle(),this.style.setProjection(S),this._update(!0)}},n.MapMouseEvent=Ts,n.MapTouchEvent=zc,n.MapWheelEvent=Co,n.Marker=Xl,n.NavigationControl=class{constructor(S){this._updateZoomButtons=()=>{let o=this._map.getZoom(),u=o===this._map.getMaxZoom(),_=o===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(o,u)=>{let _=this._map._getUIString(`NavigationControl.${u}`);o.title=_,o.setAttribute("aria-label",_)},this.options=s.e({},MA,S),this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),T.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),T.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=T.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(S){return this._map=S,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){T.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(S,o){let u=T.create("button",S,this._container);return u.type="button",u.addEventListener("click",o),u}},n.Popup=class extends s.E{constructor(S){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&T.remove(this._content),this._container&&(T.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.l("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=T.create("div","maplibregl-popup",this._map.getContainer()),this._tip=T.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let N of this.options.className.split(" "))this._container.classList.add(N);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ju(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!o)return;let _=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationToScreenPoint(this._lngLat));let v=this.options.anchor,C=eh(this.options.offset);if(!v){let N=this._container.offsetWidth,V=this._container.offsetHeight,H;H=_.y+C.bottom.y<V?["top"]:_.y>this._map.transform.height-V?["bottom"]:[],_.x<N/2?H.push("left"):_.x>this._map.transform.width-N/2&&H.push("right"),v=H.length===0?"bottom":H.join("-")}let O=_.add(C[v]);this.options.subpixelPositioning||(O=O.round()),T.setTransform(this._container,`${Hc[v]} translate(${O.x}px,${O.y}px)`),mf(this._container,v,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=s.e(Object.create($d),S)}addTo(S){return this._map&&this.remove(),this._map=S,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(S){return this._lngLat=s.Q.convert(S),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(S){return this.setDOMContent(document.createTextNode(S))}setHTML(S){let o=document.createDocumentFragment(),u=document.createElement("body"),_;for(u.innerHTML=S;_=u.firstChild,_;)o.appendChild(_);return this.setDOMContent(o)}getMaxWidth(){var S;return(S=this._container)===null||S===void 0?void 0:S.style.maxWidth}setMaxWidth(S){return this.options.maxWidth=S,this._update(),this}setDOMContent(S){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=T.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(S),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(S){return this._container&&this._container.classList.add(S),this}removeClassName(S){return this._container&&this._container.classList.remove(S),this}setOffset(S){return this.options.offset=S,this._update(),this}toggleClassName(S){if(this._container)return this._container.classList.toggle(S)}setSubpixelPositioning(S){this.options.subpixelPositioning=S}_createCloseButton(){this.options.closeButton&&(this._closeButton=T.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let S=this._container.querySelector(qd);S&&S.focus()}},n.RasterDEMTileSource=fo,n.RasterTileSource=ni,n.ScaleControl=class{constructor(S){this._onMove=()=>{gf(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,gf(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Wd),S)}getDefaultPosition(){return"bottom-left"}onAdd(S){return this._map=S,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-scale",S.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){T.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},n.ScrollZoomHandler=jc,n.Style=wa,n.TerrainControl=class{constructor(S){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=S}onAdd(S){return this._map=S,this._container=T.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=T.create("button","maplibregl-ctrl-terrain",this._container),T.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){T.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},n.TwoFingersTouchPitchHandler=Nd,n.TwoFingersTouchRotateHandler=CA,n.TwoFingersTouchZoomHandler=oi,n.TwoFingersTouchZoomRotateHandler=Xu,n.VectorTileSource=Di,n.VideoSource=ks,n.addSourceType=(S,o)=>s._(void 0,void 0,void 0,function*(){if(Zs(S))throw new Error(`A source type called "${S}" already exists.`);((u,_)=>{os[u]=_})(S,o)}),n.clearPrewarmedResources=function(){let S=fr;S&&(S.isPreloaded()&&S.numActive()===1?(S.release(yt),fr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.createTileMesh=_d,n.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},n.getRTLTextPluginStatus=function(){return Ft().getRTLTextPluginStatus()},n.getVersion=function(){return _f},n.getWorkerCount=function(){return Xt.workerCount},n.getWorkerUrl=function(){return s.a.WORKER_URL},n.importScriptInWorkers=function(S){return Lr().broadcast("IS",S)},n.prewarm=function(){Ot().acquire(yt)},n.setMaxParallelImageRequests=function(S){s.a.MAX_PARALLEL_IMAGE_REQUESTS=S},n.setRTLTextPlugin=function(S,o){return Ft().setRTLTextPlugin(S,o)},n.setWorkerCount=function(S){Xt.workerCount=S},n.setWorkerUrl=function(S){s.a.WORKER_URL=S}});var i=r;return i})});var Fk=Gs((I1,Pv)=>{(function(r){"use strict";var e="Compound",t="Identifier",i="MemberExpression",n="Literal",s="ThisExpression",a="CallExpression",c="UnaryExpression",d="BinaryExpression",p="LogicalExpression",b="ConditionalExpression",T="ArrayExpression",B=46,z=44,G=39,Z=34,q=40,re=41,ee=91,ae=93,me=63,Le=59,je=58,Je=function(qt,Ot){var wr=new Error(qt+" at character "+Ot);throw wr.index=Ot,wr.description=qt,wr},J=!0,te={"-":J,"!":J,"~":J,"+":J},X={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ye=function(qt){var Ot=0,wr;for(var Lr in qt)(wr=Lr.length)>Ot&&qt.hasOwnProperty(Lr)&&(Ot=wr);return Ot},_e=ye(te),Oe=ye(X),ve={true:!0,false:!1,null:null},De="this",Xe=function(qt){return X[qt]||0},rt=function(qt,Ot,wr){var Lr=qt==="||"||qt==="&&"?p:d;return{type:Lr,operator:qt,left:Ot,right:wr}},tt=function(qt){return qt>=48&&qt<=57},yt=function(qt){return qt===36||qt===95||qt>=65&&qt<=90||qt>=97&&qt<=122||qt>=128&&!X[String.fromCharCode(qt)]},Xt=function(qt){return qt===36||qt===95||qt>=65&&qt<=90||qt>=97&&qt<=122||qt>=48&&qt<=57||qt>=128&&!X[String.fromCharCode(qt)]},jt=function(qt){for(var Ot=0,wr=qt.charAt,Lr=qt.charCodeAt,Or=function(Jt){return wr.call(qt,Jt)},Zr=function(Jt){return Lr.call(qt,Jt)},Oi=qt.length,Jr=function(){for(var Jt=Zr(Ot);Jt===32||Jt===9||Jt===10||Jt===13;)Jt=Zr(++Ot)},Ri=function(){var Jt=Qi(),Ft,Tr;if(Jr(),Zr(Ot)===me){if(Ot++,Ft=Ri(),Ft||Je("Expected expression",Ot),Jr(),Zr(Ot)===je)return Ot++,Tr=Ri(),Tr||Je("Expected expression",Ot),{type:b,test:Jt,consequent:Ft,alternate:Tr};Je("Expected :",Ot)}else return Jt},li=function(){Jr();for(var Jt,Ft=qt.substr(Ot,Oe),Tr=Ft.length;Tr>0;){if(X.hasOwnProperty(Ft)&&(!yt(Zr(Ot))||Ot+Ft.length<qt.length&&!Xt(Zr(Ot+Ft.length))))return Ot+=Tr,Ft;Ft=Ft.substr(0,--Tr)}return!1},Qi=function(){var Jt,Ft,Tr,si,Ir,$i,Qn,Mn,ot,de;if(Qn=Di(),Tr=li(),!Tr)return Qn;for($i={value:Tr,prec:Xe(Tr)},Mn=Di(),Mn||Je("Expected expression after "+Tr,Ot),Ir=[Qn,$i,Mn];(Tr=li())&&(si=Xe(Tr),si!==0);){for($i={value:Tr,prec:si},de=Tr;Ir.length>2&&si<=Ir[Ir.length-2].prec;)Mn=Ir.pop(),Tr=Ir.pop().value,Qn=Ir.pop(),Ft=rt(Tr,Qn,Mn),Ir.push(Ft);Ft=Di(),Ft||Je("Expected expression after "+de,Ot),Ir.push($i,Ft)}for(ot=Ir.length-1,Ft=Ir[ot];ot>1;)Ft=rt(Ir[ot-1].value,Ir[ot-2],Ft),ot-=2;return Ft},Di=function(){var Jt,Ft,Tr;if(Jr(),Jt=Zr(Ot),tt(Jt)||Jt===B)return ni();if(Jt===G||Jt===Z)return fo();if(Jt===ee)return os();for(Ft=qt.substr(Ot,_e),Tr=Ft.length;Tr>0;){if(te.hasOwnProperty(Ft)&&(!yt(Zr(Ot))||Ot+Ft.length<qt.length&&!Xt(Zr(Ot+Ft.length))))return Ot+=Tr,{type:c,operator:Ft,argument:Di(),prefix:!0};Ft=Ft.substr(0,--Tr)}return yt(Jt)||Jt===q?ks():!1},ni=function(){for(var Jt="",Ft,Tr;tt(Zr(Ot));)Jt+=Or(Ot++);if(Zr(Ot)===B)for(Jt+=Or(Ot++);tt(Zr(Ot));)Jt+=Or(Ot++);if(Ft=Or(Ot),Ft==="e"||Ft==="E"){for(Jt+=Or(Ot++),Ft=Or(Ot),(Ft==="+"||Ft==="-")&&(Jt+=Or(Ot++));tt(Zr(Ot));)Jt+=Or(Ot++);tt(Zr(Ot-1))||Je("Expected exponent ("+Jt+Or(Ot)+")",Ot)}return Tr=Zr(Ot),yt(Tr)?Je("Variable names cannot start with a number ("+Jt+Or(Ot)+")",Ot):Tr===B&&Je("Unexpected period",Ot),{type:n,value:parseFloat(Jt),raw:Jt}},fo=function(){for(var Jt="",Ft=Or(Ot++),Tr=!1,si;Ot<Oi;)if(si=Or(Ot++),si===Ft){Tr=!0;break}else if(si==="\\")switch(si=Or(Ot++),si){case"n":Jt+=`
`;break;case"r":Jt+="\r";break;case"t":Jt+="	";break;case"b":Jt+="\b";break;case"f":Jt+="\f";break;case"v":Jt+="\v";break;default:Jt+=si}else Jt+=si;return Tr||Je('Unclosed quote after "'+Jt+'"',Ot),{type:n,value:Jt,raw:Ft+Jt+Ft}},Ds=function(){var Jt=Zr(Ot),Ft=Ot,Tr;for(yt(Jt)?Ot++:Je("Unexpected "+Or(Ot),Ot);Ot<Oi&&(Jt=Zr(Ot),Xt(Jt));)Ot++;return Tr=qt.slice(Ft,Ot),ve.hasOwnProperty(Tr)?{type:n,value:ve[Tr],raw:Tr}:Tr===De?{type:s}:{type:t,name:Tr}},Kn=function(Jt){for(var Ft,Tr=[],si,Ir=!1,$i=0;Ot<Oi;)if(Jr(),Ft=Zr(Ot),Ft===Jt){Ir=!0,Ot++,Jt===re&&$i&&$i>=Tr.length&&Je("Unexpected token "+String.fromCharCode(Jt),Ot);break}else if(Ft===z){if(Ot++,$i++,$i!==Tr.length){if(Jt===re)Je("Unexpected token ,",Ot);else if(Jt===ae)for(var Qn=Tr.length;Qn<$i;Qn++)Tr.push(null)}}else si=Ri(),(!si||si.type===e)&&Je("Expected comma",Ot),Tr.push(si);return Ir||Je("Expected "+String.fromCharCode(Jt),Ot),Tr},ks=function(){var Jt,Ft;for(Jt=Zr(Ot),Jt===q?Ft=ea():Ft=Ds(),Jr(),Jt=Zr(Ot);Jt===B||Jt===ee||Jt===q;)Ot++,Jt===B?(Jr(),Ft={type:i,computed:!1,object:Ft,property:Ds()}):Jt===ee?(Ft={type:i,computed:!0,object:Ft,property:Ri()},Jr(),Jt=Zr(Ot),Jt!==ae&&Je("Unclosed [",Ot),Ot++):Jt===q&&(Ft={type:a,arguments:Kn(re),callee:Ft}),Jr(),Jt=Zr(Ot);return Ft},ea=function(){Ot++;var Jt=Ri();if(Jr(),Zr(Ot)===re)return Ot++,Jt;Je("Unclosed (",Ot)},os=function(){return Ot++,{type:T,elements:Kn(ae)}},Zs=[],as,Vr;Ot<Oi;)as=Zr(Ot),as===Le||as===z?Ot++:(Vr=Ri())?Zs.push(Vr):Ot<Oi&&Je('Unexpected "'+Or(Ot)+'"',Ot);return Zs.length===1?Zs[0]:{type:e,body:Zs}};if(jt.version="0.3.5",jt.toString=function(){return"JavaScript Expression Parser (JSEP) v"+jt.version},jt.addUnaryOp=function(qt){return _e=Math.max(qt.length,_e),te[qt]=J,this},jt.addBinaryOp=function(qt,Ot){return Oe=Math.max(qt.length,Oe),X[qt]=Ot,this},jt.addLiteral=function(qt,Ot){return ve[qt]=Ot,this},jt.removeUnaryOp=function(qt){return delete te[qt],qt.length===_e&&(_e=ye(te)),this},jt.removeAllUnaryOps=function(){return te={},_e=0,this},jt.removeBinaryOp=function(qt){return delete X[qt],qt.length===Oe&&(Oe=ye(X)),this},jt.removeAllBinaryOps=function(){return X={},Oe=0,this},jt.removeLiteral=function(qt){return delete ve[qt],this},jt.removeAllLiterals=function(){return ve={},this},typeof I1>"u"){var fr=r.jsep;r.jsep=jt,jt.noConflict=function(){return r.jsep===jt&&(r.jsep=fr),jt}}else typeof Pv<"u"&&Pv.exports?I1=Pv.exports=jt:I1.parse=jt})(I1)});var QF=Gs((cke,K4)=>{"use strict";K4.exports=Wv;K4.exports.default=Wv;function Wv(r,e,t){t=t||2;var i=e&&e.length,n=i?e[0]*t:r.length,s=XF(r,0,n,t,!0),a=[];if(!s||s.next===s.prev)return a;var c,d,p,b,T,B,z;if(i&&(s=vse(r,e,s,t)),r.length>80*t){c=p=r[0],d=b=r[1];for(var G=t;G<n;G+=t)T=r[G],B=r[G+1],T<c&&(c=T),B<d&&(d=B),T>p&&(p=T),B>b&&(b=B);z=Math.max(p-c,b-d),z=z!==0?32767/z:0}return Q1(s,a,t,c,d,z,0),a}function XF(r,e,t,i,n){var s,a;if(n===Y4(r,e,t,i)>0)for(s=e;s<t;s+=i)a=ZF(s,r[s],r[s+1],a);else for(s=t-i;s>=e;s-=i)a=ZF(s,r[s],r[s+1],a);return a&&$v(a,a.next)&&(ey(a),a=a.next),a}function jp(r,e){if(!r)return r;e||(e=r);var t=r,i;do if(i=!1,!t.steiner&&($v(t,t.next)||Yn(t.prev,t,t.next)===0)){if(ey(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Q1(r,e,t,i,n,s,a){if(r){!a&&s&&Cse(r,i,n,s);for(var c=r,d,p;r.prev!==r.next;){if(d=r.prev,p=r.next,s?yse(r,i,n,s):_se(r)){e.push(d.i/t|0),e.push(r.i/t|0),e.push(p.i/t|0),ey(r),r=p.next,c=p.next;continue}if(r=p,r===c){a?a===1?(r=xse(jp(r),e,t),Q1(r,e,t,i,n,s,2)):a===2&&bse(r,e,t,i,n,s):Q1(jp(r),e,t,i,n,s,1);break}}}}function _se(r){var e=r.prev,t=r,i=r.next;if(Yn(e,t,i)>=0)return!1;for(var n=e.x,s=t.x,a=i.x,c=e.y,d=t.y,p=i.y,b=n<s?n<a?n:a:s<a?s:a,T=c<d?c<p?c:p:d<p?d:p,B=n>s?n>a?n:a:s>a?s:a,z=c>d?c>p?c:p:d>p?d:p,G=i.next;G!==e;){if(G.x>=b&&G.x<=B&&G.y>=T&&G.y<=z&&W0(n,c,s,d,a,p,G.x,G.y)&&Yn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function yse(r,e,t,i){var n=r.prev,s=r,a=r.next;if(Yn(n,s,a)>=0)return!1;for(var c=n.x,d=s.x,p=a.x,b=n.y,T=s.y,B=a.y,z=c<d?c<p?c:p:d<p?d:p,G=b<T?b<B?b:B:T<B?T:B,Z=c>d?c>p?c:p:d>p?d:p,q=b>T?b>B?b:B:T>B?T:B,re=Z4(z,G,e,t,i),ee=Z4(Z,q,e,t,i),ae=r.prevZ,me=r.nextZ;ae&&ae.z>=re&&me&&me.z<=ee;){if(ae.x>=z&&ae.x<=Z&&ae.y>=G&&ae.y<=q&&ae!==n&&ae!==a&&W0(c,b,d,T,p,B,ae.x,ae.y)&&Yn(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,me.x>=z&&me.x<=Z&&me.y>=G&&me.y<=q&&me!==n&&me!==a&&W0(c,b,d,T,p,B,me.x,me.y)&&Yn(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ae&&ae.z>=re;){if(ae.x>=z&&ae.x<=Z&&ae.y>=G&&ae.y<=q&&ae!==n&&ae!==a&&W0(c,b,d,T,p,B,ae.x,ae.y)&&Yn(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;me&&me.z<=ee;){if(me.x>=z&&me.x<=Z&&me.y>=G&&me.y<=q&&me!==n&&me!==a&&W0(c,b,d,T,p,B,me.x,me.y)&&Yn(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function xse(r,e,t){var i=r;do{var n=i.prev,s=i.next.next;!$v(n,s)&&YF(n,i,i.next,s)&&J1(n,s)&&J1(s,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),ey(i),ey(i.next),i=r=s),i=i.next}while(i!==r);return jp(i)}function bse(r,e,t,i,n,s){var a=r;do{for(var c=a.next.next;c!==a.prev;){if(a.i!==c.i&&Mse(a,c)){var d=KF(a,c);a=jp(a,a.next),d=jp(d,d.next),Q1(a,e,t,i,n,s,0),Q1(d,e,t,i,n,s,0);return}c=c.next}a=a.next}while(a!==r)}function vse(r,e,t,i){var n=[],s,a,c,d,p;for(s=0,a=e.length;s<a;s++)c=e[s]*i,d=s<a-1?e[s+1]*i:r.length,p=XF(r,c,d,i,!1),p===p.next&&(p.steiner=!0),n.push(Pse(p));for(n.sort(wse),s=0;s<n.length;s++)t=Tse(n[s],t);return t}function wse(r,e){return r.x-e.x}function Tse(r,e){var t=Ese(r,e);if(!t)return e;var i=KF(t,r);return jp(i,i.next),jp(t,t.next)}function Ese(r,e){var t=e,i=r.x,n=r.y,s=-1/0,a;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){var c=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(c<=i&&c>s&&(s=c,a=t.x<t.next.x?t:t.next,c===i))return a}t=t.next}while(t!==e);if(!a)return null;var d=a,p=a.x,b=a.y,T=1/0,B;t=a;do i>=t.x&&t.x>=p&&i!==t.x&&W0(n<b?i:s,n,p,b,n<b?s:i,n,t.x,t.y)&&(B=Math.abs(n-t.y)/(i-t.x),J1(t,r)&&(B<T||B===T&&(t.x>a.x||t.x===a.x&&Sse(a,t)))&&(a=t,T=B)),t=t.next;while(t!==d);return a}function Sse(r,e){return Yn(r.prev,r,e.prev)<0&&Yn(e.next,r,r.next)<0}function Cse(r,e,t,i){var n=r;do n.z===0&&(n.z=Z4(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,Ise(n)}function Ise(r){var e,t,i,n,s,a,c,d,p=1;do{for(t=r,r=null,s=null,a=0;t;){for(a++,i=t,c=0,e=0;e<p&&(c++,i=i.nextZ,!!i);e++);for(d=p;c>0||d>0&&i;)c!==0&&(d===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,c--):(n=i,i=i.nextZ,d--),s?s.nextZ=n:r=n,n.prevZ=s,s=n;t=i}s.nextZ=null,p*=2}while(a>1);return r}function Z4(r,e,t,i,n){return r=(r-t)*n|0,e=(e-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function Pse(r){var e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function W0(r,e,t,i,n,s,a,c){return(n-a)*(e-c)>=(r-a)*(s-c)&&(r-a)*(i-c)>=(t-a)*(e-c)&&(t-a)*(s-c)>=(n-a)*(i-c)}function Mse(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!Rse(r,e)&&(J1(r,e)&&J1(e,r)&&Bse(r,e)&&(Yn(r.prev,r,e.prev)||Yn(r,e.prev,e))||$v(r,e)&&Yn(r.prev,r,r.next)>0&&Yn(e.prev,e,e.next)>0)}function Yn(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function $v(r,e){return r.x===e.x&&r.y===e.y}function YF(r,e,t,i){var n=Hv(Yn(r,e,t)),s=Hv(Yn(r,e,i)),a=Hv(Yn(t,i,r)),c=Hv(Yn(t,i,e));return!!(n!==s&&a!==c||n===0&&Gv(r,t,e)||s===0&&Gv(r,i,e)||a===0&&Gv(t,r,i)||c===0&&Gv(t,e,i))}function Gv(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Hv(r){return r>0?1:r<0?-1:0}function Rse(r,e){var t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&YF(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function J1(r,e){return Yn(r.prev,r,r.next)<0?Yn(r,e,r.next)>=0&&Yn(r,r.prev,e)>=0:Yn(r,e,r.prev)<0||Yn(r,r.next,e)<0}function Bse(r,e){var t=r,i=!1,n=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&n<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function KF(r,e){var t=new X4(r.i,r.x,r.y),i=new X4(e.i,e.x,e.y),n=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=n,n.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function ZF(r,e,t,i){var n=new X4(r,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function ey(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function X4(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Wv.deviation=function(r,e,t,i){var n=e&&e.length,s=n?e[0]*t:r.length,a=Math.abs(Y4(r,0,s,t));if(n)for(var c=0,d=e.length;c<d;c++){var p=e[c]*t,b=c<d-1?e[c+1]*t:r.length;a-=Math.abs(Y4(r,p,b,t))}var T=0;for(c=0;c<i.length;c+=3){var B=i[c]*t,z=i[c+1]*t,G=i[c+2]*t;T+=Math.abs((r[B]-r[G])*(r[z+1]-r[B+1])-(r[B]-r[z])*(r[G+1]-r[B+1]))}return a===0&&T===0?0:Math.abs((T-a)/a)};function Y4(r,e,t,i){for(var n=0,s=e,a=t-i;s<t;s+=i)n+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return n}Wv.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,n=0;n<r.length;n++){for(var s=0;s<r[n].length;s++)for(var a=0;a<e;a++)t.vertices.push(r[n][s][a]);n>0&&(i+=r[n-1].length,t.holes.push(i))}return t}});var ww=Gs(wh=>{"use strict";var g9=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",Hoe=g9+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",_9="["+g9+"]["+Hoe+"]*",Woe=new RegExp("^"+_9+"$"),$oe=function(r,e){let t=[],i=e.exec(r);for(;i;){let n=[];n.startIndex=e.lastIndex-i[0].length;let s=i.length;for(let a=0;a<s;a++)n.push(i[a]);t.push(n),i=e.exec(r)}return t},qoe=function(r){let e=Woe.exec(r);return!(e===null||typeof e>"u")};wh.isExist=function(r){return typeof r<"u"};wh.isEmptyObject=function(r){return Object.keys(r).length===0};wh.merge=function(r,e,t){if(e){let i=Object.keys(e),n=i.length;for(let s=0;s<n;s++)t==="strict"?r[i[s]]=[e[i[s]]]:r[i[s]]=e[i[s]]}};wh.getValue=function(r){return wh.isExist(r)?r:""};wh.isName=qoe;wh.getAllMatches=$oe;wh.nameRegexp=_9});var dI=Gs(w9=>{"use strict";var fI=ww(),Zoe={allowBooleanAttributes:!1,unpairedTags:[]};w9.validate=function(r,e){e=Object.assign({},Zoe,e);let t=[],i=!1,n=!1;r[0]==="\uFEFF"&&(r=r.substr(1));for(let s=0;s<r.length;s++)if(r[s]==="<"&&r[s+1]==="?"){if(s+=2,s=x9(r,s),s.err)return s}else if(r[s]==="<"){let a=s;if(s++,r[s]==="!"){s=b9(r,s);continue}else{let c=!1;r[s]==="/"&&(c=!0,s++);let d="";for(;s<r.length&&r[s]!==">"&&r[s]!==" "&&r[s]!=="	"&&r[s]!==`
`&&r[s]!=="\r";s++)d+=r[s];if(d=d.trim(),d[d.length-1]==="/"&&(d=d.substring(0,d.length-1),s--),!rae(d)){let T;return d.trim().length===0?T="Invalid space after '<'.":T="Tag '"+d+"' is an invalid name.",ys("InvalidTag",T,Ko(r,s))}let p=Koe(r,s);if(p===!1)return ys("InvalidAttr","Attributes for '"+d+"' have open quote.",Ko(r,s));let b=p.value;if(s=p.index,b[b.length-1]==="/"){let T=s-b.length;b=b.substring(0,b.length-1);let B=v9(b,e);if(B===!0)i=!0;else return ys(B.err.code,B.err.msg,Ko(r,T+B.err.line))}else if(c)if(p.tagClosed){if(b.trim().length>0)return ys("InvalidTag","Closing tag '"+d+"' can't have attributes or invalid starting.",Ko(r,a));if(t.length===0)return ys("InvalidTag","Closing tag '"+d+"' has not been opened.",Ko(r,a));{let T=t.pop();if(d!==T.tagName){let B=Ko(r,T.tagStartPos);return ys("InvalidTag","Expected closing tag '"+T.tagName+"' (opened in line "+B.line+", col "+B.col+") instead of closing tag '"+d+"'.",Ko(r,a))}t.length==0&&(n=!0)}}else return ys("InvalidTag","Closing tag '"+d+"' doesn't have proper closing.",Ko(r,s));else{let T=v9(b,e);if(T!==!0)return ys(T.err.code,T.err.msg,Ko(r,s-b.length+T.err.line));if(n===!0)return ys("InvalidXml","Multiple possible root nodes found.",Ko(r,s));e.unpairedTags.indexOf(d)!==-1||t.push({tagName:d,tagStartPos:a}),i=!0}for(s++;s<r.length;s++)if(r[s]==="<")if(r[s+1]==="!"){s++,s=b9(r,s);continue}else if(r[s+1]==="?"){if(s=x9(r,++s),s.err)return s}else break;else if(r[s]==="&"){let T=eae(r,s);if(T==-1)return ys("InvalidChar","char '&' is not expected.",Ko(r,s));s=T}else if(n===!0&&!y9(r[s]))return ys("InvalidXml","Extra text at the end",Ko(r,s));r[s]==="<"&&s--}}else{if(y9(r[s]))continue;return ys("InvalidChar","char '"+r[s]+"' is not expected.",Ko(r,s))}if(i){if(t.length==1)return ys("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",Ko(r,t[0].tagStartPos));if(t.length>0)return ys("InvalidXml","Invalid '"+JSON.stringify(t.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return ys("InvalidXml","Start tag expected.",1);return!0};function y9(r){return r===" "||r==="	"||r===`
`||r==="\r"}function x9(r,e){let t=e;for(;e<r.length;e++)if(r[e]=="?"||r[e]==" "){let i=r.substr(t,e-t);if(e>5&&i==="xml")return ys("InvalidXml","XML declaration allowed only at the start of the document.",Ko(r,e));if(r[e]=="?"&&r[e+1]==">"){e++;break}else continue}return e}function b9(r,e){if(r.length>e+5&&r[e+1]==="-"&&r[e+2]==="-"){for(e+=3;e<r.length;e++)if(r[e]==="-"&&r[e+1]==="-"&&r[e+2]===">"){e+=2;break}}else if(r.length>e+8&&r[e+1]==="D"&&r[e+2]==="O"&&r[e+3]==="C"&&r[e+4]==="T"&&r[e+5]==="Y"&&r[e+6]==="P"&&r[e+7]==="E"){let t=1;for(e+=8;e<r.length;e++)if(r[e]==="<")t++;else if(r[e]===">"&&(t--,t===0))break}else if(r.length>e+9&&r[e+1]==="["&&r[e+2]==="C"&&r[e+3]==="D"&&r[e+4]==="A"&&r[e+5]==="T"&&r[e+6]==="A"&&r[e+7]==="["){for(e+=8;e<r.length;e++)if(r[e]==="]"&&r[e+1]==="]"&&r[e+2]===">"){e+=2;break}}return e}var Xoe='"',Yoe="'";function Koe(r,e){let t="",i="",n=!1;for(;e<r.length;e++){if(r[e]===Xoe||r[e]===Yoe)i===""?i=r[e]:i!==r[e]||(i="");else if(r[e]===">"&&i===""){n=!0;break}t+=r[e]}return i!==""?!1:{value:t,index:e,tagClosed:n}}var Qoe=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function v9(r,e){let t=fI.getAllMatches(r,Qoe),i={};for(let n=0;n<t.length;n++){if(t[n][1].length===0)return ys("InvalidAttr","Attribute '"+t[n][2]+"' has no space in starting.",by(t[n]));if(t[n][3]!==void 0&&t[n][4]===void 0)return ys("InvalidAttr","Attribute '"+t[n][2]+"' is without value.",by(t[n]));if(t[n][3]===void 0&&!e.allowBooleanAttributes)return ys("InvalidAttr","boolean attribute '"+t[n][2]+"' is not allowed.",by(t[n]));let s=t[n][2];if(!tae(s))return ys("InvalidAttr","Attribute '"+s+"' is an invalid name.",by(t[n]));if(!i.hasOwnProperty(s))i[s]=1;else return ys("InvalidAttr","Attribute '"+s+"' is repeated.",by(t[n]))}return!0}function Joe(r,e){let t=/\d/;for(r[e]==="x"&&(e++,t=/[\da-fA-F]/);e<r.length;e++){if(r[e]===";")return e;if(!r[e].match(t))break}return-1}function eae(r,e){if(e++,r[e]===";")return-1;if(r[e]==="#")return e++,Joe(r,e);let t=0;for(;e<r.length;e++,t++)if(!(r[e].match(/\w/)&&t<20)){if(r[e]===";")break;return-1}return e}function ys(r,e,t){return{err:{code:r,msg:e,line:t.line||t,col:t.col}}}function tae(r){return fI.isName(r)}function rae(r){return fI.isName(r)}function Ko(r,e){let t=r.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function by(r){return r.startIndex+r[1].length}});var E9=Gs(pI=>{var T9={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(r,e,t){return r}},iae=function(r){return Object.assign({},T9,r)};pI.buildOptions=iae;pI.defaultOptions=T9});var C9=Gs((L9e,S9)=>{"use strict";var AI=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};S9.exports=AI});var P9=Gs((O9e,I9)=>{var nae=ww();function sae(r,e){let t={};if(r[e+3]==="O"&&r[e+4]==="C"&&r[e+5]==="T"&&r[e+6]==="Y"&&r[e+7]==="P"&&r[e+8]==="E"){e=e+9;let i=1,n=!1,s=!1,a="";for(;e<r.length;e++)if(r[e]==="<"&&!s){if(n&&lae(r,e)){e+=7;let c,d;[c,d,e]=oae(r,e+1),d.indexOf("&")===-1&&(t[fae(c)]={regx:RegExp(`&${c};`,"g"),val:d})}else if(n&&cae(r,e))e+=8;else if(n&&uae(r,e))e+=8;else if(n&&hae(r,e))e+=9;else if(aae)s=!0;else throw new Error("Invalid DOCTYPE");i++,a=""}else if(r[e]===">"){if(s?r[e-1]==="-"&&r[e-2]==="-"&&(s=!1,i--):i--,i===0)break}else r[e]==="["?n=!0:a+=r[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function oae(r,e){let t="";for(;e<r.length&&r[e]!=="'"&&r[e]!=='"';e++)t+=r[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");let i=r[e++],n="";for(;e<r.length&&r[e]!==i;e++)n+=r[e];return[t,n,e]}function aae(r,e){return r[e+1]==="!"&&r[e+2]==="-"&&r[e+3]==="-"}function lae(r,e){return r[e+1]==="!"&&r[e+2]==="E"&&r[e+3]==="N"&&r[e+4]==="T"&&r[e+5]==="I"&&r[e+6]==="T"&&r[e+7]==="Y"}function cae(r,e){return r[e+1]==="!"&&r[e+2]==="E"&&r[e+3]==="L"&&r[e+4]==="E"&&r[e+5]==="M"&&r[e+6]==="E"&&r[e+7]==="N"&&r[e+8]==="T"}function uae(r,e){return r[e+1]==="!"&&r[e+2]==="A"&&r[e+3]==="T"&&r[e+4]==="T"&&r[e+5]==="L"&&r[e+6]==="I"&&r[e+7]==="S"&&r[e+8]==="T"}function hae(r,e){return r[e+1]==="!"&&r[e+2]==="N"&&r[e+3]==="O"&&r[e+4]==="T"&&r[e+5]==="A"&&r[e+6]==="T"&&r[e+7]==="I"&&r[e+8]==="O"&&r[e+9]==="N"}function fae(r){if(nae.isName(r))return r;throw new Error(`Invalid entity name ${r}`)}I9.exports=sae});var R9=Gs((D9e,M9)=>{var dae=/^[-+]?0x[a-fA-F0-9]+$/,pae=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,Aae={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function mae(r,e={}){if(e=Object.assign({},Aae,e),!r||typeof r!="string")return r;let t=r.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return r;if(r==="0")return 0;if(e.hex&&dae.test(t))return _ae(t,16);if(t.search(/[eE]/)!==-1){let i=t.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(i){if(e.leadingZeros)t=(i[1]||"")+i[3];else if(!(i[2]==="0"&&i[3][0]==="."))return r;return e.eNotation?Number(t):r}else return r}else{let i=pae.exec(t);if(i){let n=i[1],s=i[2],a=gae(i[3]);if(!e.leadingZeros&&s.length>0&&n&&t[2]!==".")return r;if(!e.leadingZeros&&s.length>0&&!n&&t[1]!==".")return r;if(e.leadingZeros&&s===r)return 0;{let c=Number(t),d=""+c;return d.search(/[eE]/)!==-1?e.eNotation?c:r:t.indexOf(".")!==-1?d==="0"&&a===""||d===a||n&&d==="-"+a?c:r:s?a===d||n+a===d?c:r:t===d||t===n+d?c:r}}else return r}}function gae(r){return r&&r.indexOf(".")!==-1&&(r=r.replace(/0+$/,""),r==="."?r="0":r[0]==="."?r="0"+r:r[r.length-1]==="."&&(r=r.substr(0,r.length-1))),r}function _ae(r,e){if(parseInt)return parseInt(r,e);if(Number.parseInt)return Number.parseInt(r,e);if(window&&window.parseInt)return window.parseInt(r,e);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}M9.exports=mae});var mI=Gs((k9e,B9)=>{function yae(r){return typeof r=="function"?r:Array.isArray(r)?e=>{for(let t of r)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}B9.exports=yae});var D9=Gs((F9e,O9)=>{"use strict";var L9=ww(),vy=C9(),xae=P9(),bae=R9(),vae=mI(),gI=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=wae,this.parseXml=Iae,this.parseTextData=Tae,this.resolveNameSpace=Eae,this.buildAttributesMap=Cae,this.isItStopNode=Bae,this.replaceEntitiesValue=Mae,this.readStopNodeData=Oae,this.saveTextToParentTag=Rae,this.addChild=Pae,this.ignoreAttributesFn=vae(this.options.ignoreAttributes)}};function wae(r){let e=Object.keys(r);for(let t=0;t<e.length;t++){let i=e[t];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:r[i]}}}function Tae(r,e,t,i,n,s,a){if(r!==void 0&&(this.options.trimValues&&!i&&(r=r.trim()),r.length>0)){a||(r=this.replaceEntitiesValue(r));let c=this.options.tagValueProcessor(e,r,t,n,s);return c==null?r:typeof c!=typeof r||c!==r?c:this.options.trimValues?yI(r,this.options.parseTagValue,this.options.numberParseOptions):r.trim()===r?yI(r,this.options.parseTagValue,this.options.numberParseOptions):r}}function Eae(r){if(this.options.removeNSPrefix){let e=r.split(":"),t=r.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(r=t+e[1])}return r}var Sae=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function Cae(r,e,t){if(this.options.ignoreAttributes!==!0&&typeof r=="string"){let i=L9.getAllMatches(r,Sae),n=i.length,s={};for(let a=0;a<n;a++){let c=this.resolveNameSpace(i[a][1]);if(this.ignoreAttributesFn(c,e))continue;let d=i[a][4],p=this.options.attributeNamePrefix+c;if(c.length)if(this.options.transformAttributeName&&(p=this.options.transformAttributeName(p)),p==="__proto__"&&(p="#__proto__"),d!==void 0){this.options.trimValues&&(d=d.trim()),d=this.replaceEntitiesValue(d);let b=this.options.attributeValueProcessor(c,d,e);b==null?s[p]=d:typeof b!=typeof d||b!==d?s[p]=b:s[p]=yI(d,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[p]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){let a={};return a[this.options.attributesGroupName]=s,a}return s}}var Iae=function(r){r=r.replace(/\r\n?/g,`
`);let e=new vy("!xml"),t=e,i="",n="";for(let s=0;s<r.length;s++)if(r[s]==="<")if(r[s+1]==="/"){let c=Wp(r,">",s,"Closing Tag is not closed."),d=r.substring(s+2,c).trim();if(this.options.removeNSPrefix){let T=d.indexOf(":");T!==-1&&(d=d.substr(T+1))}this.options.transformTagName&&(d=this.options.transformTagName(d)),t&&(i=this.saveTextToParentTag(i,t,n));let p=n.substring(n.lastIndexOf(".")+1);if(d&&this.options.unpairedTags.indexOf(d)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${d}>`);let b=0;p&&this.options.unpairedTags.indexOf(p)!==-1?(b=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):b=n.lastIndexOf("."),n=n.substring(0,b),t=this.tagsNodeStack.pop(),i="",s=c}else if(r[s+1]==="?"){let c=_I(r,s,!1,"?>");if(!c)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,t,n),!(this.options.ignoreDeclaration&&c.tagName==="?xml"||this.options.ignorePiTags)){let d=new vy(c.tagName);d.add(this.options.textNodeName,""),c.tagName!==c.tagExp&&c.attrExpPresent&&(d[":@"]=this.buildAttributesMap(c.tagExp,n,c.tagName)),this.addChild(t,d,n)}s=c.closeIndex+1}else if(r.substr(s+1,3)==="!--"){let c=Wp(r,"-->",s+4,"Comment is not closed.");if(this.options.commentPropName){let d=r.substring(s+4,c-2);i=this.saveTextToParentTag(i,t,n),t.add(this.options.commentPropName,[{[this.options.textNodeName]:d}])}s=c}else if(r.substr(s+1,2)==="!D"){let c=xae(r,s);this.docTypeEntities=c.entities,s=c.i}else if(r.substr(s+1,2)==="!["){let c=Wp(r,"]]>",s,"CDATA is not closed.")-2,d=r.substring(s+9,c);i=this.saveTextToParentTag(i,t,n);let p=this.parseTextData(d,t.tagname,n,!0,!1,!0,!0);p==null&&(p=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:d}]):t.add(this.options.textNodeName,p),s=c+2}else{let c=_I(r,s,this.options.removeNSPrefix),d=c.tagName,p=c.rawTagName,b=c.tagExp,T=c.attrExpPresent,B=c.closeIndex;this.options.transformTagName&&(d=this.options.transformTagName(d)),t&&i&&t.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,t,n,!1));let z=t;if(z&&this.options.unpairedTags.indexOf(z.tagname)!==-1&&(t=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),d!==e.tagname&&(n+=n?"."+d:d),this.isItStopNode(this.options.stopNodes,n,d)){let G="";if(b.length>0&&b.lastIndexOf("/")===b.length-1)d[d.length-1]==="/"?(d=d.substr(0,d.length-1),n=n.substr(0,n.length-1),b=d):b=b.substr(0,b.length-1),s=c.closeIndex;else if(this.options.unpairedTags.indexOf(d)!==-1)s=c.closeIndex;else{let q=this.readStopNodeData(r,p,B+1);if(!q)throw new Error(`Unexpected end of ${p}`);s=q.i,G=q.tagContent}let Z=new vy(d);d!==b&&T&&(Z[":@"]=this.buildAttributesMap(b,n,d)),G&&(G=this.parseTextData(G,d,n,!0,T,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),Z.add(this.options.textNodeName,G),this.addChild(t,Z,n)}else{if(b.length>0&&b.lastIndexOf("/")===b.length-1){d[d.length-1]==="/"?(d=d.substr(0,d.length-1),n=n.substr(0,n.length-1),b=d):b=b.substr(0,b.length-1),this.options.transformTagName&&(d=this.options.transformTagName(d));let G=new vy(d);d!==b&&T&&(G[":@"]=this.buildAttributesMap(b,n,d)),this.addChild(t,G,n),n=n.substr(0,n.lastIndexOf("."))}else{let G=new vy(d);this.tagsNodeStack.push(t),d!==b&&T&&(G[":@"]=this.buildAttributesMap(b,n,d)),this.addChild(t,G,n),t=G}i="",s=B}}else i+=r[s];return e.child};function Pae(r,e,t){let i=this.options.updateTag(e.tagname,t,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),r.addChild(e))}var Mae=function(r){if(this.options.processEntities){for(let e in this.docTypeEntities){let t=this.docTypeEntities[e];r=r.replace(t.regx,t.val)}for(let e in this.lastEntities){let t=this.lastEntities[e];r=r.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){let t=this.htmlEntities[e];r=r.replace(t.regex,t.val)}r=r.replace(this.ampEntity.regex,this.ampEntity.val)}return r};function Rae(r,e,t,i){return r&&(i===void 0&&(i=e.child.length===0),r=this.parseTextData(r,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),r!==void 0&&r!==""&&e.add(this.options.textNodeName,r),r=""),r}function Bae(r,e,t){let i="*."+t;for(let n in r){let s=r[n];if(i===s||e===s)return!0}return!1}function Lae(r,e,t=">"){let i,n="";for(let s=e;s<r.length;s++){let a=r[s];if(i)a===i&&(i="");else if(a==='"'||a==="'")i=a;else if(a===t[0])if(t[1]){if(r[s+1]===t[1])return{data:n,index:s}}else return{data:n,index:s};else a==="	"&&(a=" ");n+=a}}function Wp(r,e,t,i){let n=r.indexOf(e,t);if(n===-1)throw new Error(i);return n+e.length-1}function _I(r,e,t,i=">"){let n=Lae(r,e+1,i);if(!n)return;let s=n.data,a=n.index,c=s.search(/\s/),d=s,p=!0;c!==-1&&(d=s.substring(0,c),s=s.substring(c+1).trimStart());let b=d;if(t){let T=d.indexOf(":");T!==-1&&(d=d.substr(T+1),p=d!==n.data.substr(T+1))}return{tagName:d,tagExp:s,closeIndex:a,attrExpPresent:p,rawTagName:b}}function Oae(r,e,t){let i=t,n=1;for(;t<r.length;t++)if(r[t]==="<")if(r[t+1]==="/"){let s=Wp(r,">",t,`${e} is not closed`);if(r.substring(t+2,s).trim()===e&&(n--,n===0))return{tagContent:r.substring(i,t),i:s};t=s}else if(r[t+1]==="?")t=Wp(r,"?>",t+1,"StopNode is not closed.");else if(r.substr(t+1,3)==="!--")t=Wp(r,"-->",t+3,"StopNode is not closed.");else if(r.substr(t+1,2)==="![")t=Wp(r,"]]>",t,"StopNode is not closed.")-2;else{let s=_I(r,t,">");s&&((s&&s.tagName)===e&&s.tagExp[s.tagExp.length-1]!=="/"&&n++,t=s.closeIndex)}}function yI(r,e,t){if(e&&typeof r=="string"){let i=r.trim();return i==="true"?!0:i==="false"?!1:bae(r,t)}else return L9.isExist(r)?r:""}O9.exports=gI});var N9=Gs(F9=>{"use strict";function Dae(r,e){return k9(r,e)}function k9(r,e,t){let i,n={};for(let s=0;s<r.length;s++){let a=r[s],c=kae(a),d="";if(t===void 0?d=c:d=t+"."+c,c===e.textNodeName)i===void 0?i=a[c]:i+=""+a[c];else{if(c===void 0)continue;if(a[c]){let p=k9(a[c],e,d),b=Nae(p,e);a[":@"]?Fae(p,a[":@"],d,e):Object.keys(p).length===1&&p[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?p=p[e.textNodeName]:Object.keys(p).length===0&&(e.alwaysCreateTextNode?p[e.textNodeName]="":p=""),n[c]!==void 0&&n.hasOwnProperty(c)?(Array.isArray(n[c])||(n[c]=[n[c]]),n[c].push(p)):e.isArray(c,d,b)?n[c]=[p]:n[c]=p}}}return typeof i=="string"?i.length>0&&(n[e.textNodeName]=i):i!==void 0&&(n[e.textNodeName]=i),n}function kae(r){let e=Object.keys(r);for(let t=0;t<e.length;t++){let i=e[t];if(i!==":@")return i}}function Fae(r,e,t,i){if(e){let n=Object.keys(e),s=n.length;for(let a=0;a<s;a++){let c=n[a];i.isArray(c,t+"."+c,!0,!0)?r[c]=[e[c]]:r[c]=e[c]}}}function Nae(r,e){let{textNodeName:t}=e,i=Object.keys(r).length;return!!(i===0||i===1&&(r[t]||typeof r[t]=="boolean"||r[t]===0))}F9.prettify=Dae});var U9=Gs((z9e,z9)=>{var{buildOptions:zae}=E9(),Uae=D9(),{prettify:Vae}=N9(),jae=dI(),xI=class{constructor(e){this.externalEntities={},this.options=zae(e)}parse(e,t){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});let s=jae.validate(e,t);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}let i=new Uae(this.options);i.addExternalEntities(this.externalEntities);let n=i.parseXml(e);return this.options.preserveOrder||n===void 0?n:Vae(n,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};z9.exports=xI});var W9=Gs((U9e,H9)=>{var Gae=`
`;function Hae(r,e){let t="";return e.format&&e.indentBy.length>0&&(t=Gae),j9(r,e,"",t)}function j9(r,e,t,i){let n="",s=!1;for(let a=0;a<r.length;a++){let c=r[a],d=Wae(c);if(d===void 0)continue;let p="";if(t.length===0?p=d:p=`${t}.${d}`,d===e.textNodeName){let G=c[d];$ae(p,e)||(G=e.tagValueProcessor(d,G),G=G9(G,e)),s&&(n+=i),n+=G,s=!1;continue}else if(d===e.cdataPropName){s&&(n+=i),n+=`<![CDATA[${c[d][0][e.textNodeName]}]]>`,s=!1;continue}else if(d===e.commentPropName){n+=i+`<!--${c[d][0][e.textNodeName]}-->`,s=!0;continue}else if(d[0]==="?"){let G=V9(c[":@"],e),Z=d==="?xml"?"":i,q=c[d][0][e.textNodeName];q=q.length!==0?" "+q:"",n+=Z+`<${d}${q}${G}?>`,s=!0;continue}let b=i;b!==""&&(b+=e.indentBy);let T=V9(c[":@"],e),B=i+`<${d}${T}`,z=j9(c[d],e,p,b);e.unpairedTags.indexOf(d)!==-1?e.suppressUnpairedNode?n+=B+">":n+=B+"/>":(!z||z.length===0)&&e.suppressEmptyNode?n+=B+"/>":z&&z.endsWith(">")?n+=B+`>${z}${i}</${d}>`:(n+=B+">",z&&i!==""&&(z.includes("/>")||z.includes("</"))?n+=i+e.indentBy+z+i:n+=z,n+=`</${d}>`),s=!0}return n}function Wae(r){let e=Object.keys(r);for(let t=0;t<e.length;t++){let i=e[t];if(r.hasOwnProperty(i)&&i!==":@")return i}}function V9(r,e){let t="";if(r&&!e.ignoreAttributes)for(let i in r){if(!r.hasOwnProperty(i))continue;let n=e.attributeValueProcessor(i,r[i]);n=G9(n,e),n===!0&&e.suppressBooleanAttributes?t+=` ${i.substr(e.attributeNamePrefix.length)}`:t+=` ${i.substr(e.attributeNamePrefix.length)}="${n}"`}return t}function $ae(r,e){r=r.substr(0,r.length-e.textNodeName.length-1);let t=r.substr(r.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===r||e.stopNodes[i]==="*."+t)return!0;return!1}function G9(r,e){if(r&&r.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){let i=e.entities[t];r=r.replace(i.regex,i.val)}return r}H9.exports=Hae});var q9=Gs((V9e,$9)=>{"use strict";var qae=W9(),Zae=mI(),Xae={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(r,e){return e},attributeValueProcessor:function(r,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ad(r){this.options=Object.assign({},Xae,r),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=Zae(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Qae),this.processTextOrObjNode=Yae,this.options.format?(this.indentate=Kae,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ad.prototype.build=function(r){return this.options.preserveOrder?qae(r,this.options):(Array.isArray(r)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(r={[this.options.arrayNodeName]:r}),this.j2x(r,0,[]).val)};ad.prototype.j2x=function(r,e,t){let i="",n="",s=t.join(".");for(let a in r)if(Object.prototype.hasOwnProperty.call(r,a))if(typeof r[a]>"u")this.isAttribute(a)&&(n+="");else if(r[a]===null)this.isAttribute(a)||a===this.options.cdataPropName?n+="":a[0]==="?"?n+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if(r[a]instanceof Date)n+=this.buildTextValNode(r[a],a,"",e);else if(typeof r[a]!="object"){let c=this.isAttribute(a);if(c&&!this.ignoreAttributesFn(c,s))i+=this.buildAttrPairStr(c,""+r[a]);else if(!c)if(a===this.options.textNodeName){let d=this.options.tagValueProcessor(a,""+r[a]);n+=this.replaceEntitiesValue(d)}else n+=this.buildTextValNode(r[a],a,"",e)}else if(Array.isArray(r[a])){let c=r[a].length,d="",p="";for(let b=0;b<c;b++){let T=r[a][b];if(!(typeof T>"u"))if(T===null)a[0]==="?"?n+=this.indentate(e)+"<"+a+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+a+"/"+this.tagEndChar;else if(typeof T=="object")if(this.options.oneListGroup){let B=this.j2x(T,e+1,t.concat(a));d+=B.val,this.options.attributesGroupName&&T.hasOwnProperty(this.options.attributesGroupName)&&(p+=B.attrStr)}else d+=this.processTextOrObjNode(T,a,e,t);else if(this.options.oneListGroup){let B=this.options.tagValueProcessor(a,T);B=this.replaceEntitiesValue(B),d+=B}else d+=this.buildTextValNode(T,a,"",e)}this.options.oneListGroup&&(d=this.buildObjectNode(d,a,p,e)),n+=d}else if(this.options.attributesGroupName&&a===this.options.attributesGroupName){let c=Object.keys(r[a]),d=c.length;for(let p=0;p<d;p++)i+=this.buildAttrPairStr(c[p],""+r[a][c[p]])}else n+=this.processTextOrObjNode(r[a],a,e,t);return{attrStr:i,val:n}};ad.prototype.buildAttrPairStr=function(r,e){return e=this.options.attributeValueProcessor(r,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+r:" "+r+'="'+e+'"'};function Yae(r,e,t,i){let n=this.j2x(r,t+1,i.concat(e));return r[this.options.textNodeName]!==void 0&&Object.keys(r).length===1?this.buildTextValNode(r[this.options.textNodeName],e,n.attrStr,t):this.buildObjectNode(n.val,e,n.attrStr,t)}ad.prototype.buildObjectNode=function(r,e,t,i){if(r==="")return e[0]==="?"?this.indentate(i)+"<"+e+t+"?"+this.tagEndChar:this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let n="</"+e+this.tagEndChar,s="";return e[0]==="?"&&(s="?",n=""),(t||t==="")&&r.indexOf("<")===-1?this.indentate(i)+"<"+e+t+s+">"+r+n:this.options.commentPropName!==!1&&e===this.options.commentPropName&&s.length===0?this.indentate(i)+`<!--${r}-->`+this.newLine:this.indentate(i)+"<"+e+t+s+this.tagEndChar+r+this.indentate(i)+n}};ad.prototype.closeTag=function(r){let e="";return this.options.unpairedTags.indexOf(r)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${r}`,e};ad.prototype.buildTextValNode=function(r,e,t,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${r}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${r}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+t+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(e,r);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+t+">"+n+"</"+e+this.tagEndChar}};ad.prototype.replaceEntitiesValue=function(r){if(r&&r.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){let t=this.options.entities[e];r=r.replace(t.regex,t.val)}return r};function Kae(r){return this.options.indentBy.repeat(r)}function Qae(r){return r.startsWith(this.options.attributeNamePrefix)&&r!==this.options.textNodeName?r.substr(this.attrPrefixLen):!1}$9.exports=ad});var X9=Gs((j9e,Z9)=>{"use strict";var Jae=dI(),ele=U9(),tle=q9();Z9.exports={XMLParser:ele,XMLValidator:Jae,XMLBuilder:tle}});var MI=Gs((oz,Iy)=>{(function(r,e){typeof define=="function"&&define.amd?define([],e):typeof dR=="function"&&typeof Iy=="object"&&Iy&&Iy.exports?Iy.exports=e():(r.dcodeIO=r.dcodeIO||{}).Long=e()})(oz,function(){"use strict";function r(te,X,ye){this.low=te|0,this.high=X|0,this.unsigned=!!ye}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function e(te){return(te&&te.__isLong__)===!0}r.isLong=e;var t={},i={};function n(te,X){var ye,_e,Oe;return X?(te>>>=0,(Oe=0<=te&&te<256)&&(_e=i[te],_e)?_e:(ye=a(te,(te|0)<0?-1:0,!0),Oe&&(i[te]=ye),ye)):(te|=0,(Oe=-128<=te&&te<128)&&(_e=t[te],_e)?_e:(ye=a(te,te<0?-1:0,!1),Oe&&(t[te]=ye),ye))}r.fromInt=n;function s(te,X){if(isNaN(te)||!isFinite(te))return X?re:q;if(X){if(te<0)return re;if(te>=z)return je}else{if(te<=-G)return Je;if(te+1>=G)return Le}return te<0?s(-te,X).neg():a(te%B|0,te/B|0,X)}r.fromNumber=s;function a(te,X,ye){return new r(te,X,ye)}r.fromBits=a;var c=Math.pow;function d(te,X,ye){if(te.length===0)throw Error("empty string");if(te==="NaN"||te==="Infinity"||te==="+Infinity"||te==="-Infinity")return q;if(typeof X=="number"?(ye=X,X=!1):X=!!X,ye=ye||10,ye<2||36<ye)throw RangeError("radix");var _e;if((_e=te.indexOf("-"))>0)throw Error("interior hyphen");if(_e===0)return d(te.substring(1),X,ye).neg();for(var Oe=s(c(ye,8)),ve=q,De=0;De<te.length;De+=8){var Xe=Math.min(8,te.length-De),rt=parseInt(te.substring(De,De+Xe),ye);if(Xe<8){var tt=s(c(ye,Xe));ve=ve.mul(tt).add(s(rt))}else ve=ve.mul(Oe),ve=ve.add(s(rt))}return ve.unsigned=X,ve}r.fromString=d;function p(te){return te instanceof r?te:typeof te=="number"?s(te):typeof te=="string"?d(te):a(te.low,te.high,te.unsigned)}r.fromValue=p;var b=65536,T=1<<24,B=b*b,z=B*B,G=z/2,Z=n(T),q=n(0);r.ZERO=q;var re=n(0,!0);r.UZERO=re;var ee=n(1);r.ONE=ee;var ae=n(1,!0);r.UONE=ae;var me=n(-1);r.NEG_ONE=me;var Le=a(-1,2147483647,!1);r.MAX_VALUE=Le;var je=a(-1,-1,!0);r.MAX_UNSIGNED_VALUE=je;var Je=a(0,-2147483648,!1);r.MIN_VALUE=Je;var J=r.prototype;return J.toInt=function(){return this.unsigned?this.low>>>0:this.low},J.toNumber=function(){return this.unsigned?(this.high>>>0)*B+(this.low>>>0):this.high*B+(this.low>>>0)},J.toString=function(X){if(X=X||10,X<2||36<X)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Je)){var ye=s(X),_e=this.div(ye),Oe=_e.mul(ye).sub(this);return _e.toString(X)+Oe.toInt().toString(X)}else return"-"+this.neg().toString(X);for(var ve=s(c(X,6),this.unsigned),De=this,Xe="";;){var rt=De.div(ve),tt=De.sub(rt.mul(ve)).toInt()>>>0,yt=tt.toString(X);if(De=rt,De.isZero())return yt+Xe;for(;yt.length<6;)yt="0"+yt;Xe=""+yt+Xe}},J.getHighBits=function(){return this.high},J.getHighBitsUnsigned=function(){return this.high>>>0},J.getLowBits=function(){return this.low},J.getLowBitsUnsigned=function(){return this.low>>>0},J.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Je)?64:this.neg().getNumBitsAbs();for(var X=this.high!=0?this.high:this.low,ye=31;ye>0&&!(X&1<<ye);ye--);return this.high!=0?ye+33:ye+1},J.isZero=function(){return this.high===0&&this.low===0},J.isNegative=function(){return!this.unsigned&&this.high<0},J.isPositive=function(){return this.unsigned||this.high>=0},J.isOdd=function(){return(this.low&1)===1},J.isEven=function(){return(this.low&1)===0},J.equals=function(X){return e(X)||(X=p(X)),this.unsigned!==X.unsigned&&this.high>>>31===1&&X.high>>>31===1?!1:this.high===X.high&&this.low===X.low},J.eq=J.equals,J.notEquals=function(X){return!this.eq(X)},J.neq=J.notEquals,J.lessThan=function(X){return this.comp(X)<0},J.lt=J.lessThan,J.lessThanOrEqual=function(X){return this.comp(X)<=0},J.lte=J.lessThanOrEqual,J.greaterThan=function(X){return this.comp(X)>0},J.gt=J.greaterThan,J.greaterThanOrEqual=function(X){return this.comp(X)>=0},J.gte=J.greaterThanOrEqual,J.compare=function(X){if(e(X)||(X=p(X)),this.eq(X))return 0;var ye=this.isNegative(),_e=X.isNegative();return ye&&!_e?-1:!ye&&_e?1:this.unsigned?X.high>>>0>this.high>>>0||X.high===this.high&&X.low>>>0>this.low>>>0?-1:1:this.sub(X).isNegative()?-1:1},J.comp=J.compare,J.negate=function(){return!this.unsigned&&this.eq(Je)?Je:this.not().add(ee)},J.neg=J.negate,J.add=function(X){e(X)||(X=p(X));var ye=this.high>>>16,_e=this.high&65535,Oe=this.low>>>16,ve=this.low&65535,De=X.high>>>16,Xe=X.high&65535,rt=X.low>>>16,tt=X.low&65535,yt=0,Xt=0,jt=0,fr=0;return fr+=ve+tt,jt+=fr>>>16,fr&=65535,jt+=Oe+rt,Xt+=jt>>>16,jt&=65535,Xt+=_e+Xe,yt+=Xt>>>16,Xt&=65535,yt+=ye+De,yt&=65535,a(jt<<16|fr,yt<<16|Xt,this.unsigned)},J.subtract=function(X){return e(X)||(X=p(X)),this.add(X.neg())},J.sub=J.subtract,J.multiply=function(X){if(this.isZero()||(e(X)||(X=p(X)),X.isZero()))return q;if(this.eq(Je))return X.isOdd()?Je:q;if(X.eq(Je))return this.isOdd()?Je:q;if(this.isNegative())return X.isNegative()?this.neg().mul(X.neg()):this.neg().mul(X).neg();if(X.isNegative())return this.mul(X.neg()).neg();if(this.lt(Z)&&X.lt(Z))return s(this.toNumber()*X.toNumber(),this.unsigned);var ye=this.high>>>16,_e=this.high&65535,Oe=this.low>>>16,ve=this.low&65535,De=X.high>>>16,Xe=X.high&65535,rt=X.low>>>16,tt=X.low&65535,yt=0,Xt=0,jt=0,fr=0;return fr+=ve*tt,jt+=fr>>>16,fr&=65535,jt+=Oe*tt,Xt+=jt>>>16,jt&=65535,jt+=ve*rt,Xt+=jt>>>16,jt&=65535,Xt+=_e*tt,yt+=Xt>>>16,Xt&=65535,Xt+=Oe*rt,yt+=Xt>>>16,Xt&=65535,Xt+=ve*Xe,yt+=Xt>>>16,Xt&=65535,yt+=ye*tt+_e*rt+Oe*Xe+ve*De,yt&=65535,a(jt<<16|fr,yt<<16|Xt,this.unsigned)},J.mul=J.multiply,J.divide=function(X){if(e(X)||(X=p(X)),X.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?re:q;var ye,_e,Oe;if(this.unsigned){if(X.unsigned||(X=X.toUnsigned()),X.gt(this))return re;if(X.gt(this.shru(1)))return ae;Oe=re}else{if(this.eq(Je)){if(X.eq(ee)||X.eq(me))return Je;if(X.eq(Je))return ee;var ve=this.shr(1);return ye=ve.div(X).shl(1),ye.eq(q)?X.isNegative()?ee:me:(_e=this.sub(X.mul(ye)),Oe=ye.add(_e.div(X)),Oe)}else if(X.eq(Je))return this.unsigned?re:q;if(this.isNegative())return X.isNegative()?this.neg().div(X.neg()):this.neg().div(X).neg();if(X.isNegative())return this.div(X.neg()).neg();Oe=q}for(_e=this;_e.gte(X);){ye=Math.max(1,Math.floor(_e.toNumber()/X.toNumber()));for(var De=Math.ceil(Math.log(ye)/Math.LN2),Xe=De<=48?1:c(2,De-48),rt=s(ye),tt=rt.mul(X);tt.isNegative()||tt.gt(_e);)ye-=Xe,rt=s(ye,this.unsigned),tt=rt.mul(X);rt.isZero()&&(rt=ee),Oe=Oe.add(rt),_e=_e.sub(tt)}return Oe},J.div=J.divide,J.modulo=function(X){return e(X)||(X=p(X)),this.sub(this.div(X).mul(X))},J.mod=J.modulo,J.not=function(){return a(~this.low,~this.high,this.unsigned)},J.and=function(X){return e(X)||(X=p(X)),a(this.low&X.low,this.high&X.high,this.unsigned)},J.or=function(X){return e(X)||(X=p(X)),a(this.low|X.low,this.high|X.high,this.unsigned)},J.xor=function(X){return e(X)||(X=p(X)),a(this.low^X.low,this.high^X.high,this.unsigned)},J.shiftLeft=function(X){return e(X)&&(X=X.toInt()),(X&=63)===0?this:X<32?a(this.low<<X,this.high<<X|this.low>>>32-X,this.unsigned):a(0,this.low<<X-32,this.unsigned)},J.shl=J.shiftLeft,J.shiftRight=function(X){return e(X)&&(X=X.toInt()),(X&=63)===0?this:X<32?a(this.low>>>X|this.high<<32-X,this.high>>X,this.unsigned):a(this.high>>X-32,this.high>=0?0:-1,this.unsigned)},J.shr=J.shiftRight,J.shiftRightUnsigned=function(X){if(e(X)&&(X=X.toInt()),X&=63,X===0)return this;var ye=this.high;if(X<32){var _e=this.low;return a(_e>>>X|ye<<32-X,ye>>>X,this.unsigned)}else return X===32?a(ye,0,this.unsigned):a(ye>>>X-32,0,this.unsigned)},J.shru=J.shiftRightUnsigned,J.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},J.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},J.toBytes=function(te){return te?this.toBytesLE():this.toBytesBE()},J.toBytesLE=function(){var te=this.high,X=this.low;return[X&255,X>>>8&255,X>>>16&255,X>>>24&255,te&255,te>>>8&255,te>>>16&255,te>>>24&255]},J.toBytesBE=function(){var te=this.high,X=this.low;return[te>>>24&255,te>>>16&255,te>>>8&255,te&255,X>>>24&255,X>>>16&255,X>>>8&255,X&255]},r})});var Xj=Gs(xM=>{xM.read=function(r,e,t,i,n){var s,a,c=n*8-i-1,d=(1<<c)-1,p=d>>1,b=-7,T=t?n-1:0,B=t?-1:1,z=r[e+T];for(T+=B,s=z&(1<<-b)-1,z>>=-b,b+=c;b>0;s=s*256+r[e+T],T+=B,b-=8);for(a=s&(1<<-b)-1,s>>=-b,b+=i;b>0;a=a*256+r[e+T],T+=B,b-=8);if(s===0)s=1-p;else{if(s===d)return a?NaN:(z?-1:1)*(1/0);a=a+Math.pow(2,i),s=s-p}return(z?-1:1)*a*Math.pow(2,s-i)};xM.write=function(r,e,t,i,n,s){var a,c,d,p=s*8-n-1,b=(1<<p)-1,T=b>>1,B=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=i?0:s-1,G=i?1:-1,Z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,a=b):(a=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-a))<1&&(a--,d*=2),a+T>=1?e+=B/d:e+=B*Math.pow(2,1-T),e*d>=2&&(a++,d/=2),a+T>=b?(c=0,a=b):a+T>=1?(c=(e*d-1)*Math.pow(2,n),a=a+T):(c=e*Math.pow(2,T-1)*Math.pow(2,n),a=0));n>=8;r[t+z]=c&255,z+=G,c/=256,n-=8);for(a=a<<n|c,p+=n;p>0;r[t+z]=a&255,z+=G,a/=256,p-=8);r[t+z-G]|=Z*128}});var tG=Gs((XYe,eG)=>{"use strict";eG.exports=on;var k3=Xj();function on(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}on.Varint=0;on.Fixed64=1;on.Bytes=2;on.Fixed32=5;var bM=65536*65536,Yj=1/bM,bAe=12,Jj=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");on.prototype={destroy:function(){this.buf=null},readFields:function(r,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),n=i>>3,s=this.pos;this.type=i&7,r(n,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=F3(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Qj(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=F3(this.buf,this.pos)+F3(this.buf,this.pos+4)*bM;return this.pos+=8,r},readSFixed64:function(){var r=F3(this.buf,this.pos)+Qj(this.buf,this.pos+4)*bM;return this.pos+=8,r},readFloat:function(){var r=k3.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=k3.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,vAe(t,r,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2===1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=bAe&&Jj?kAe(this.buf,e,r):DAe(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==on.Bytes)return r.push(this.readVarint(e));var t=Bh(this);for(r=r||[];this.pos<t;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==on.Bytes)return r.push(this.readSVarint());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==on.Bytes)return r.push(this.readBoolean());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==on.Bytes)return r.push(this.readFloat());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==on.Bytes)return r.push(this.readDouble());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==on.Bytes)return r.push(this.readFixed32());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==on.Bytes)return r.push(this.readSFixed32());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==on.Bytes)return r.push(this.readFixed64());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==on.Bytes)return r.push(this.readSFixed64());var e=Bh(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=r&7;if(e===on.Varint)for(;this.buf[this.pos++]>127;);else if(e===on.Bytes)this.pos=this.readVarint()+this.pos;else if(e===on.Fixed32)this.pos+=4;else if(e===on.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Om(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Om(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Om(this.buf,r&-1,this.pos),Om(this.buf,Math.floor(r*Yj),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Om(this.buf,r&-1,this.pos),Om(this.buf,Math.floor(r*Yj),this.pos+4),this.pos+=8},writeVarint:function(r){if(r=+r||0,r>268435455||r<0){wAe(r,this);return}this.realloc(4),this.buf[this.pos++]=r&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=r>>>7&127)))},writeSVarint:function(r){this.writeVarint(r<0?-r*2-1:r*2)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(r.length*4),this.pos++;var e=this.pos;this.pos=FAe(this.buf,r,this.pos);var t=this.pos-e;t>=128&&Kj(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(r){this.realloc(4),k3.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),k3.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=r[t]},writeRawMessage:function(r,e){this.pos++;var t=this.pos;r(e,this);var i=this.pos-t;i>=128&&Kj(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(r,e,t){this.writeTag(r,on.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,SAe,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,CAe,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,MAe,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,IAe,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,PAe,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,RAe,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,BAe,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,LAe,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,OAe,e)},writeBytesField:function(r,e){this.writeTag(r,on.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,on.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,on.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,on.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,on.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,on.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,on.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,on.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,on.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,on.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};function vAe(r,e,t){var i=t.buf,n,s;if(s=i[t.pos++],n=(s&112)>>4,s<128||(s=i[t.pos++],n|=(s&127)<<3,s<128)||(s=i[t.pos++],n|=(s&127)<<10,s<128)||(s=i[t.pos++],n|=(s&127)<<17,s<128)||(s=i[t.pos++],n|=(s&127)<<24,s<128)||(s=i[t.pos++],n|=(s&1)<<31,s<128))return Lm(r,n,e);throw new Error("Expected varint not more than 10 bytes")}function Bh(r){return r.type===on.Bytes?r.readVarint()+r.pos:r.pos+1}function Lm(r,e,t){return t?e*4294967296+(r>>>0):(e>>>0)*4294967296+(r>>>0)}function wAe(r,e){var t,i;if(r>=0?(t=r%4294967296|0,i=r/4294967296|0):(t=~(-r%4294967296),i=~(-r/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),TAe(t,i,e),EAe(i,e)}function TAe(r,e,t){t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos++]=r&127|128,r>>>=7,t.buf[t.pos]=r&127}function EAe(r,e){var t=(r&7)<<4;e.buf[e.pos++]|=t|((r>>>=3)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127|((r>>>=7)?128:0),r&&(e.buf[e.pos++]=r&127)))))}function Kj(r,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var n=t.pos-1;n>=r;n--)t.buf[n+i]=t.buf[n]}function SAe(r,e){for(var t=0;t<r.length;t++)e.writeVarint(r[t])}function CAe(r,e){for(var t=0;t<r.length;t++)e.writeSVarint(r[t])}function IAe(r,e){for(var t=0;t<r.length;t++)e.writeFloat(r[t])}function PAe(r,e){for(var t=0;t<r.length;t++)e.writeDouble(r[t])}function MAe(r,e){for(var t=0;t<r.length;t++)e.writeBoolean(r[t])}function RAe(r,e){for(var t=0;t<r.length;t++)e.writeFixed32(r[t])}function BAe(r,e){for(var t=0;t<r.length;t++)e.writeSFixed32(r[t])}function LAe(r,e){for(var t=0;t<r.length;t++)e.writeFixed64(r[t])}function OAe(r,e){for(var t=0;t<r.length;t++)e.writeSFixed64(r[t])}function F3(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+r[e+3]*16777216}function Om(r,e,t){r[t]=e,r[t+1]=e>>>8,r[t+2]=e>>>16,r[t+3]=e>>>24}function Qj(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function DAe(r,e,t){for(var i="",n=e;n<t;){var s=r[n],a=null,c=s>239?4:s>223?3:s>191?2:1;if(n+c>t)break;var d,p,b;c===1?s<128&&(a=s):c===2?(d=r[n+1],(d&192)===128&&(a=(s&31)<<6|d&63,a<=127&&(a=null))):c===3?(d=r[n+1],p=r[n+2],(d&192)===128&&(p&192)===128&&(a=(s&15)<<12|(d&63)<<6|p&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):c===4&&(d=r[n+1],p=r[n+2],b=r[n+3],(d&192)===128&&(p&192)===128&&(b&192)===128&&(a=(s&15)<<18|(d&63)<<12|(p&63)<<6|b&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,c=1):a>65535&&(a-=65536,i+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),i+=String.fromCharCode(a),n+=c}return i}function kAe(r,e,t){return Jj.decode(r.subarray(e,t))}function FAe(r,e,t){for(var i=0,n,s;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(s)if(n<56320){r[t++]=239,r[t++]=191,r[t++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||i+1===e.length?(r[t++]=239,r[t++]=191,r[t++]=189):s=n;continue}else s&&(r[t++]=239,r[t++]=191,r[t++]=189,s=null);n<128?r[t++]=n:(n<2048?r[t++]=n>>6|192:(n<65536?r[t++]=n>>12|224:(r[t++]=n>>18|240,r[t++]=n>>12&63|128),r[t++]=n>>6&63|128),r[t++]=n&63|128)}return t}});var km=Tf(MT());var ZT=Tf(MT(),1),cW=Object.defineProperty,WR=r=>{throw TypeError(r)},uW=(r,e,t)=>e in r?cW(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xr=(r,e,t)=>uW(r,typeof e!="symbol"?e+"":e,t),$R=(r,e,t)=>e.has(r)||WR("Cannot "+t),ds=(r,e,t)=>($R(r,e,"read from private field"),t?t.call(r):e.get(r)),RT=(r,e,t)=>e.has(r)?WR("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Cx=(r,e,t,i)=>($R(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t);function Nn(){}function hW(r,e){for(let t in e)r[t]=e[t];return r}function qR(r){return r()}function AR(){return Object.create(null)}function oh(r){r.forEach(qR)}function ZR(r){return typeof r=="function"}function If(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}var Ix;function Po(r,e){return r===e?!0:(Ix||(Ix=document.createElement("a")),Ix.href=e,r===Ix.href)}function fW(r){return Object.keys(r).length===0}function dW(r,e,t,i){if(r){let n=XR(r,e,t,i);return r[0](n)}}function XR(r,e,t,i){return r[1]&&i?hW(t.ctx.slice(),r[1](i(e))):t.ctx}function pW(r,e,t,i){return r[2],e.dirty}function AW(r,e,t,i,n,s){if(n){let a=XR(e,t,i,s);r.p(a,n)}}function mW(r){if(r.ctx.length>32){let e=[],t=r.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function Nx(r){return r??""}function Gi(r,e){r.appendChild(e)}function zn(r,e,t){r.insertBefore(e,t||null)}function On(r){r.parentNode&&r.parentNode.removeChild(r)}function pn(r){return document.createElement(r)}function ic(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Sf(r){return document.createTextNode(r)}function ka(){return Sf(" ")}function gW(){return Sf("")}function Hs(r,e,t,i){return r.addEventListener(e,t,i),()=>r.removeEventListener(e,t,i)}function _W(r){return function(e){return e.preventDefault(),r.call(this,e)}}function kt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function yW(r){return Array.from(r.childNodes)}function yg(r,e){e=""+e,r.data!==e&&(r.data=e)}function mR(r,e){r.value=e??""}function Yc(r,e,t){r.classList.toggle(e,!!t)}function xW(r,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:i})}var xg;function _g(r){xg=r}function YR(){if(!xg)throw new Error("Function called outside component initialization");return xg}function bW(r){YR().$$.on_destroy.push(r)}function KR(){let r=YR();return(e,t,{cancelable:i=!1}={})=>{let n=r.$$.callbacks[e];if(n){let s=xW(e,t,{cancelable:i});return n.slice().forEach(a=>{a.call(r,s)}),!s.defaultPrevented}return!0}}function vW(r,e){let t=r.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}var WA=[],DT=[],$A=[],gR=[],wW=Promise.resolve(),kT=!1;function TW(){kT||(kT=!0,wW.then(QR))}function FT(r){$A.push(r)}var BT=new Set,HA=0;function QR(){if(HA!==0)return;let r=xg;do{try{for(;HA<WA.length;){let e=WA[HA];HA++,_g(e),EW(e.$$)}}catch(e){throw WA.length=0,HA=0,e}for(_g(null),WA.length=0,HA=0;DT.length;)DT.pop()();for(let e=0;e<$A.length;e+=1){let t=$A[e];BT.has(t)||(BT.add(t),t())}$A.length=0}while(WA.length);for(;gR.length;)gR.pop()();kT=!1,BT.clear(),_g(r)}function EW(r){if(r.fragment!==null){r.update(),oh(r.before_update);let e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(FT)}}function SW(r){let e=[],t=[];$A.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),$A=e}var Lx=new Set,tp;function Ox(){tp={r:0,c:[],p:tp}}function Dx(){tp.r||oh(tp.c),tp=tp.p}function ps(r,e){r&&r.i&&(Lx.delete(r),r.i(e))}function no(r,e,t,i){if(r&&r.o){if(Lx.has(r))return;Lx.add(r),tp.c.push(()=>{Lx.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function _R(r){return r?.length!==void 0?r:Array.from(r)}function CW(r,e){no(r,1,1,()=>{e.delete(r.key)})}function IW(r,e,t,i,n,s,a,c,d,p,b,T){let B=r.length,z=s.length,G=B,Z={};for(;G--;)Z[r[G].key]=G;let q=[],re=new Map,ee=new Map,ae=[];for(G=z;G--;){let Je=T(n,s,G),J=t(Je),te=a.get(J);te?ae.push(()=>te.p(Je,e)):(te=p(J,Je),te.c()),re.set(J,q[G]=te),J in Z&&ee.set(J,Math.abs(G-Z[J]))}let me=new Set,Le=new Set;function je(Je){ps(Je,1),Je.m(c,b),a.set(Je.key,Je),b=Je.first,z--}for(;B&&z;){let Je=q[z-1],J=r[B-1],te=Je.key,X=J.key;Je===J?(b=Je.first,B--,z--):re.has(X)?!a.has(te)||me.has(te)?je(Je):Le.has(X)?B--:ee.get(te)>ee.get(X)?(Le.add(te),je(Je)):(me.add(X),B--):(d(J,a),B--)}for(;B--;){let Je=r[B];re.has(Je.key)||d(Je,a)}for(;z;)je(q[z-1]);return oh(ae),q}function Cf(r){r&&r.c()}function ih(r,e,t){let{fragment:i,after_update:n}=r.$$;i&&i.m(e,t),FT(()=>{let s=r.$$.on_mount.map(qR).filter(ZR);r.$$.on_destroy?r.$$.on_destroy.push(...s):oh(s),r.$$.on_mount=[]}),n.forEach(FT)}function nh(r,e){let t=r.$$;t.fragment!==null&&(SW(t.after_update),oh(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function PW(r,e){r.$$.dirty[0]===-1&&(WA.push(r),TW(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Pf(r,e,t,i,n,s,a=null,c=[-1]){let d=xg;_g(r);let p=r.$$={fragment:null,ctx:[],props:s,update:Nn,not_equal:n,bound:AR(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:AR(),dirty:c,skip_bound:!1,root:e.target||d.$$.root};a&&a(p.root);let b=!1;if(p.ctx=t?t(r,e.props||{},(T,B,...z)=>{let G=z.length?z[0]:B;return p.ctx&&n(p.ctx[T],p.ctx[T]=G)&&(!p.skip_bound&&p.bound[T]&&p.bound[T](G),b&&PW(r,T)),B}):[],p.update(),b=!0,oh(p.before_update),p.fragment=i?i(p.ctx):!1,e.target){if(e.hydrate){let T=yW(e.target);p.fragment&&p.fragment.l(T),T.forEach(On)}else p.fragment&&p.fragment.c();e.intro&&ps(r.$$.fragment),ih(r,e.target,e.anchor),QR()}_g(d)}var Qc=class{constructor(){xr(this,"$$"),xr(this,"$$set")}$destroy(){nh(this,1),this.$destroy=Nn}$on(e,t){if(!ZR(t))return Nn;let i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{let n=i.indexOf(t);n!==-1&&i.splice(n,1)}}$set(e){this.$$set&&!fW(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}},MW="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(MW);function RW(r){let e,t;return{c(){e=ic("svg"),t=ic("path"),kt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),kt(e,"viewBox","0 0 14 14"),kt(e,"width","13"),kt(e,"height","13"),kt(e,"class","svelte-en2qvf")},m(i,n){zn(i,e,n),Gi(e,t)},p:Nn,i:Nn,o:Nn,d(i){i&&On(e)}}}var zx=class extends Qc{constructor(e){super(),Pf(this,e,null,RW,If,{})}};function BW(r){let e,t;return{c(){e=ic("svg"),t=ic("path"),kt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),kt(e,"viewBox","0 0 30 30"),kt(e,"fill","none"),kt(e,"xmlns","http://www.w3.org/2000/svg"),kt(e,"class","svelte-d2loi5")},m(i,n){zn(i,e,n),Gi(e,t)},p:Nn,i:Nn,o:Nn,d(i){i&&On(e)}}}var Ux=class extends Qc{constructor(e){super(),Pf(this,e,null,BW,If,{})}};function LW(r){let e,t;return{c(){e=pn("img"),Po(e.src,t=r[3]+"area.svg")||kt(e,"src",t),kt(e,"alt",r[7]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(i,n){zn(i,e,n)},p(i,n){n&8&&!Po(e.src,t=i[3]+"area.svg")&&kt(e,"src",t),n&128&&kt(e,"alt",i[7]),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function OW(r){let e,t;return{c(){e=pn("img"),Po(e.src,t=r[3]+"reverse.svg")||kt(e,"src",t),kt(e,"alt",r[7]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(i,n){zn(i,e,n)},p(i,n){n&8&&!Po(e.src,t=i[3]+"reverse.svg")&&kt(e,"src",t),n&128&&kt(e,"alt",i[7]),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function DW(r){let e,t;return{c(){e=pn("img"),Po(e.src,t=r[3]+"poi.svg")||kt(e,"src",t),kt(e,"alt",r[7]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(i,n){zn(i,e,n)},p(i,n){n&8&&!Po(e.src,t=i[3]+"poi.svg")&&kt(e,"src",t),n&128&&kt(e,"alt",i[7]),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function kW(r){let e,t;return{c(){e=pn("img"),Po(e.src,t=r[3]+"postal_code.svg")||kt(e,"src",t),kt(e,"alt",r[7]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(i,n){zn(i,e,n)},p(i,n){n&8&&!Po(e.src,t=i[3]+"postal_code.svg")&&kt(e,"src",t),n&128&&kt(e,"alt",i[7]),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function FW(r){let e,t;return{c(){e=pn("img"),Po(e.src,t=r[3]+"street.svg")||kt(e,"src",t),kt(e,"alt",r[7]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(i,n){zn(i,e,n)},p(i,n){n&8&&!Po(e.src,t=i[3]+"street.svg")&&kt(e,"src",t),n&128&&kt(e,"alt",i[7]),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function NW(r){let e,t;return{c(){e=pn("img"),Po(e.src,t=r[3]+"road.svg")||kt(e,"src",t),kt(e,"alt",r[7]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(i,n){zn(i,e,n)},p(i,n){n&8&&!Po(e.src,t=i[3]+"road.svg")&&kt(e,"src",t),n&128&&kt(e,"alt",i[7]),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function zW(r){let e,t;return{c(){e=pn("img"),Po(e.src,t=r[3]+"housenumber.svg")||kt(e,"src",t),kt(e,"alt",r[7]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(i,n){zn(i,e,n)},p(i,n){n&8&&!Po(e.src,t=i[3]+"housenumber.svg")&&kt(e,"src",t),n&128&&kt(e,"alt",i[7]),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function UW(r){let e,t,i,n;return{c(){e=pn("img"),Po(e.src,t=r[5])||kt(e,"src",t),kt(e,"alt",r[4]),kt(e,"title",r[7]),kt(e,"class","svelte-w9y5n9")},m(s,a){zn(s,e,a),i||(n=Hs(e,"error",r[14]),i=!0)},p(s,a){a&32&&!Po(e.src,t=s[5])&&kt(e,"src",t),a&16&&kt(e,"alt",s[4]),a&128&&kt(e,"title",s[7])},d(s){s&&On(e),i=!1,n()}}}function VW(r){let e,t;return{c(){e=pn("div"),kt(e,"class","sprite-icon svelte-w9y5n9"),kt(e,"style",t=`
        width: ${r[6].width/il}px;
        height: ${r[6].height/il}px;
        background-image: url(${r[3]}sprite${NT}.png);
        background-position: -${r[6].x/il}px -${r[6].y/il}px;
        background-size: ${Xc.width/il}px ${Xc.height/il}px;
      `),kt(e,"title",r[7])},m(i,n){zn(i,e,n)},p(i,n){n&72&&t!==(t=`
        width: ${i[6].width/il}px;
        height: ${i[6].height/il}px;
        background-image: url(${i[3]}sprite${NT}.png);
        background-position: -${i[6].x/il}px -${i[6].y/il}px;
        background-size: ${Xc.width/il}px ${Xc.height/il}px;
      `)&&kt(e,"style",t),n&128&&kt(e,"title",i[7])},d(i){i&&On(e)}}}function yR(r){let e,t;return{c(){e=pn("span"),t=Sf(r[7]),kt(e,"class","secondary svelte-w9y5n9")},m(i,n){zn(i,e,n),Gi(e,t)},p(i,n){n&128&&yg(t,i[7])},d(i){i&&On(e)}}}function jW(r){let e,t,i,n,s,a,c,d,p,b=(r[8]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",T,B,z=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[8],G,Z,q=(r[8]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",re,ee,ae,me,Le,je;function Je(ye,_e){return _e&1&&(t=null),_e&1&&(i=null),_e&1&&(n=null),_e&1&&(s=null),Xc&&ye[6]?VW:ye[5]?UW:ye[0].address?zW:(t==null&&(t=!!ye[0].id.startsWith("road.")),t?NW:(i==null&&(i=!!ye[0].id.startsWith("address.")),i?FW:(n==null&&(n=!!ye[0].id.startsWith("postal_code.")),n?kW:(s==null&&(s=!!ye[0].id.startsWith("poi.")),s?DW:ye[8]?OW:LW))))}let J=Je(r,-1),te=J(r),X=z&&yR(r);return{c(){e=pn("li"),te.c(),a=ka(),c=pn("span"),d=pn("span"),p=pn("span"),T=Sf(b),B=ka(),X&&X.c(),G=ka(),Z=pn("span"),re=Sf(q),kt(p,"class","primary svelte-w9y5n9"),kt(d,"class","svelte-w9y5n9"),kt(Z,"class","line2 svelte-w9y5n9"),kt(c,"class","texts svelte-w9y5n9"),kt(e,"tabindex","-1"),kt(e,"role","option"),kt(e,"aria-selected",ee=r[1]==="selected"),kt(e,"aria-checked",ae=r[1]==="picked"),kt(e,"class",me=Nx(r[1])+" svelte-w9y5n9")},m(ye,_e){zn(ye,e,_e),te.m(e,null),Gi(e,a),Gi(e,c),Gi(c,d),Gi(d,p),Gi(p,T),Gi(d,B),X&&X.m(d,null),Gi(c,G),Gi(c,Z),Gi(Z,re),Le||(je=[Hs(e,"mouseenter",r[13]),Hs(e,"focus",r[15]),Hs(e,"click",r[16])],Le=!0)},p(ye,[_e]){J===(J=Je(ye,_e))&&te?te.p(ye,_e):(te.d(1),te=J(ye),te&&(te.c(),te.m(e,a))),_e&257&&b!==(b=(ye[8]?ye[0].place_name:ye[0].place_name.replace(/,.*/,""))+"")&&yg(T,b),_e&293&&(z=ye[2]==="always"||ye[2]!=="never"&&!ye[0].address&&!ye[0].id.startsWith("road.")&&!ye[0].id.startsWith("address.")&&!ye[0].id.startsWith("postal_code.")&&(!ye[0].id.startsWith("poi.")||!ye[5])&&!ye[8]),z?X?X.p(ye,_e):(X=yR(ye),X.c(),X.m(d,null)):X&&(X.d(1),X=null),_e&257&&q!==(q=(ye[8]?"":ye[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&yg(re,q),_e&2&&ee!==(ee=ye[1]==="selected")&&kt(e,"aria-selected",ee),_e&2&&ae!==(ae=ye[1]==="picked")&&kt(e,"aria-checked",ae),_e&2&&me!==(me=Nx(ye[1])+" svelte-w9y5n9")&&kt(e,"class",me)},i:Nn,o:Nn,d(ye){ye&&On(e),te.d(),X&&X.d(),Le=!1,oh(je)}}}var JR=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,NT=JR?"@2x":"",il=JR?2:1,Xc,Px;function GW(r,e,t){let i,n,s,{feature:a}=e,{style:c="default"}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:b}=e,T=KR(),B,z,G,Z;function q(){Px??(Px=fetch(`${b}sprite${NT}.json`).then(J=>J.json()).then(J=>{Xc=J}).catch(()=>{Xc=null}))}function re(){z&&p.add(z),ee()}function ee(){Xc!==void 0?ae():(q(),Px?.then(ae))}function ae(){do{if(Z--,t(4,B=i?.[Z]),t(6,G=B?Xc?.icons[B]:void 0),G)break;t(5,z=B?b+B.replace(/ /g,"_")+".svg":void 0)}while(Z>-1&&(!z||p.has(z)))}function me(J){vW.call(this,r,J)}let Le=()=>re(),je=()=>T("select",void 0),Je=J=>{document.activeElement!==J.target&&T("select",void 0)};return r.$$set=J=>{"feature"in J&&t(0,a=J.feature),"style"in J&&t(1,c=J.style),"showPlaceType"in J&&t(2,d=J.showPlaceType),"missingIconsCache"in J&&t(11,p=J.missingIconsCache),"iconsBaseUrl"in J&&t(3,b=J.iconsBaseUrl)},r.$$.update=()=>{var J,te,X,ye,_e;r.$$.dirty&1&&t(12,i=(J=a.properties)==null?void 0:J.categories),r.$$.dirty&1&&t(8,n=a.place_type[0]==="reverse"),r.$$.dirty&1&&t(7,s=((X=(te=a.properties)==null?void 0:te.categories)==null?void 0:X.join(", "))??((_e=(ye=a.properties)==null?void 0:ye.place_type_name)==null?void 0:_e[0])??a.place_type[0]),r.$$.dirty&4096&&(Z=i?.length??0,ee())},[a,c,d,b,B,z,G,s,n,T,re,p,i,me,Le,je,Je]}var zT=class extends Qc{constructor(e){super(),Pf(this,e,GW,jW,If,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}};function HW(r){let e;return{c(){e=pn("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',kt(e,"class","svelte-7cmwmc")},m(t,i){zn(t,e,i)},p:Nn,i:Nn,o:Nn,d(t){t&&On(e)}}}var UT=class extends Qc{constructor(e){super(),Pf(this,e,null,HW,If,{})}};function WW(r){let e,t,i;return{c(){e=ic("svg"),t=ic("path"),kt(t,"stroke-width","4"),kt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),kt(t,"class","svelte-gzo3ar"),kt(e,"width",i=r[0]==="list"?20:void 0),kt(e,"viewBox","0 0 70 85"),kt(e,"fill","none"),kt(e,"class","svelte-gzo3ar"),Yc(e,"in-map",r[0]!=="list"),Yc(e,"list-icon",r[0]==="list")},m(n,s){zn(n,e,s),Gi(e,t)},p(n,[s]){s&1&&i!==(i=n[0]==="list"?20:void 0)&&kt(e,"width",i),s&1&&Yc(e,"in-map",n[0]!=="list"),s&1&&Yc(e,"list-icon",n[0]==="list")},i:Nn,o:Nn,d(n){n&&On(e)}}}function $W(r,e,t){let{displayIn:i}=e;return r.$$set=n=>{"displayIn"in n&&t(0,i=n.displayIn)},[i]}var VT=class extends Qc{constructor(e){super(),Pf(this,e,$W,WW,If,{displayIn:0})}};function qW(r){let e,t;return{c(){e=ic("svg"),t=ic("path"),kt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),kt(e,"viewBox","0 0 60.006 21.412"),kt(e,"width","14"),kt(e,"height","20"),kt(e,"class","svelte-en2qvf")},m(i,n){zn(i,e,n),Gi(e,t)},p:Nn,i:Nn,o:Nn,d(i){i&&On(e)}}}var jT=class extends Qc{constructor(e){super(),Pf(this,e,null,qW,If,{})}};function ZW(r){let e,t,i;return{c(){e=ic("svg"),t=ic("circle"),i=ic("path"),kt(t,"cx","4.789"),kt(t,"cy","4.787"),kt(t,"r","3.85"),kt(t,"class","svelte-1aq105l"),kt(i,"d","M12.063 12.063 7.635 7.635"),kt(i,"class","svelte-1aq105l"),kt(e,"xmlns","http://www.w3.org/2000/svg"),kt(e,"width","13"),kt(e,"height","13"),kt(e,"viewBox","0 0 13 13"),kt(e,"class","svelte-1aq105l")},m(n,s){zn(n,e,s),Gi(e,t),Gi(e,i)},p:Nn,i:Nn,o:Nn,d(n){n&&On(e)}}}var GT=class extends Qc{constructor(e){super(),Pf(this,e,null,ZW,If,{})}};function XW(r,e,t){let i=e[1],n=e[0],s=i-n;return r===i&&t?r:((r-n)%s+s)%s+n}function Vx(r){let e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}var fg;async function YW(r,e,t){let i=r?.getCenterAndZoom();for(let n of e??[])if(!(i&&(n.minZoom!=null&&n.minZoom>i[0]||n.maxZoom!=null&&n.maxZoom<i[0]))){if(n.type==="fixed")return n.coordinates.join(",");e:if(n.type==="client-geolocation"){if(fg&&n.cachedLocationExpiry&&fg.time+n.cachedLocationExpiry>Date.now()){if(!fg.coords)break e;return fg.coords}let s;try{return s=await new Promise((a,c)=>{t.signal.addEventListener("abort",()=>{c(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{a([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{c(d)},n)}),s}catch{}finally{n.cachedLocationExpiry&&(fg={time:Date.now(),coords:s})}if(t.signal.aborted)return}if(n.type==="server-geolocation")return"ip";if(i&&n.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}var KW=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,xR=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,bR=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,vR=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,wR=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,TR=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function QW(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){let e=this.decimalCoordinates.split(",").map(z=>Number(z.trim())),t=Number(e[0]),i=Number(e[1]),n=Math.abs(t),s=Math.abs(i),a=t>0?"N":"S",c=i>0?"E":"W",d;r=="DD"&&(d=`${n}\xB0 ${a}, ${s}\xB0 ${c}`);let p=Math.floor(n),b=Math.floor(s),T=(n-p)*60,B=(s-b)*60;if(r=="DM"){let z=ER(T,3).toFixed(3).padStart(6,"0"),G=ER(B,3).toFixed(3).padStart(6,"0");z.endsWith(".000")&&G.endsWith(".000")&&(z=z.replace(/\.000$/,""),G=G.replace(/\.000$/,"")),d=`${p}\xB0 ${z}' ${a}, ${b}\xB0 ${G}' ${c}`}if(r=="DMS"){let z=Math.floor(T),G=Math.floor(B),Z=((T-z)*60).toFixed(1).padStart(4,"0"),q=((B-G)*60).toFixed(1).padStart(4,"0"),re=z.toString().padStart(2,"0"),ee=G.toString().padStart(2,"0");Z.endsWith(".0")&&q.endsWith(".0")&&(Z=Z.replace(/\.0$/,""),q=q.replace(/\.0$/,"")),d=`${p}\xB0 ${re}' ${Z}" ${a}, ${b}\xB0 ${ee}' ${q}" ${c}`}return d}else throw new Error("no decimal coordinates to convert")}function ER(r,e){let t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function XT(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,i=null,n="",s="",a=null,c=[],d=!1;if(KW.test(r))throw new Error("invalid coordinate value");if(xR.test(r))if(c=xR.exec(r),d=dg(c),d)t=Math.abs(c[1])+c[2]/60,Number(c[1])<0&&(t*=-1),i=Math.abs(c[3])+c[4]/60,Number(c[3])<0&&(i*=-1),a="DM";else throw new Error("invalid coordinate format");else if(bR.test(r))if(c=bR.exec(r),d=dg(c),d){if(t=c[2],i=c[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),a="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");c[1]?(n=c[1],s=c[5]):c[4]&&(n=c[4],s=c[8])}else throw new Error("invalid decimal coordinate format");else if(vR.test(r))if(c=vR.exec(r),d=dg(c),d)t=Math.abs(parseInt(c[2])),c[4]&&(t+=c[4]/60,a="DM"),c[6]&&(t+=c[6].replace(",",".")/3600,a="DMS"),parseInt(c[2])<0&&(t=-1*t),i=Math.abs(parseInt(c[9])),c[11]&&(i+=c[11]/60),c[13]&&(i+=c[13].replace(",",".")/3600),parseInt(c[9])<0&&(i=-1*i),c[1]?(n=c[1],s=c[8]):c[7]&&(n=c[7],s=c[14]);else throw new Error("invalid DMS coordinates format");else if(wR.test(r))if(c=wR.exec(r),d=dg(c),d)t=Math.abs(parseInt(c[2])),c[4]&&(t+=c[4]/60,a="DM"),c[6]&&(t+=c[6]/3600,a="DMS"),parseInt(c[2])<0&&(t=-1*t),i=Math.abs(parseInt(c[10])),c[12]&&(i+=c[12]/60),c[14]&&(i+=c[14]/3600),parseInt(c[10])<0&&(i=-1*i),c[1]?(n=c[1],s=c[9]):c[8]&&(n=c[8],s=c[16]);else throw new Error("invalid DMS coordinates format");else if(TR.test(r)){if(c=TR.exec(r),d=dg(c),c.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(c[2])),c[4]&&(t+=c[4].replace(",",".")/60,a="DM"),c[6]&&(t+=c[6].replace(",",".")/3600,a="DMS"),parseInt(c[2])<0&&(t=-1*t),i=Math.abs(parseInt(c[10])),c[12]&&(i+=c[12].replace(",",".")/60),c[14]&&(i+=c[14].replace(",",".")/3600),parseInt(c[10])<0&&(i=-1*i),c[1]?(n=c[1],s=c[9]):c[8]&&(n=c[8],s=c[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(n&&!s||!n&&s)throw new Error("invalid coordinates value");if(n&&n==s)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let p=/S|SOUTH/i;p.test(n)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(s)&&i>0&&(i=-1*i);let b=c[0].trim(),T,B,z=/[,/;\u0020]/g,G=b.match(z);if(G==null){let re=Math.floor(r.length/2);T=b.substring(0,re).trim(),B=b.substring(re).trim()}else{let re;G.length%2==1?re=Math.floor(G.length/2):re=G.length/2-1;let ee=0;if(re==0)ee=b.indexOf(G[0]),T=b.substring(0,ee).trim(),B=b.substring(ee+1).trim();else{let ae=0,me=0;for(;ae<=re;)ee=b.indexOf(G[ae],me),me=ee+1,ae++;T=b.substring(0,ee).trim(),B=b.substring(ee+1).trim()}}let Z=T.split(".");if(Z.length==2&&Z[1]==0&&Z[1].length!=2)throw new Error("invalid coordinates format");let q=B.split(".");if(q.length==2&&q[1]==0&&q[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(T)||/^\d+$/.test(B))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:b,verbatimLatitude:T,verbatimLongitude:B,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:a,closeEnough:JW,toCoordinateFormat:QW})}else throw new Error("coordinates pattern match failed")}function dg(r){if(!isNaN(r[0]))return!1;let e=[...r];if(e.shift(),e.length%2>0)return!1;let t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,n=e.length/2;for(let s=0;s<n;s++){let a=e[s],c=e[s+n],d=t.test(a)&&t.test(c),p=i.test(a)&&i.test(c),b=a==c;if(!(a==null&&c==null)){if(a==null||c==null)return!1;if(d||p||b)continue;return!1}}return!0}function SR(r,e){let t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function JW(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){let e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return SR(this.decimalLatitude,Number(e[0]))&&SR(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}var e$=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});XT.to=e$;var t$=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:"40.123\xB0 N 74.123\xB0 W",verbatimLatitude:"40.123\xB0 N",verbatimLongitude:"74.123\xB0 W"},{verbatimCoordinates:'40\xB0 7\xB4 22.8" N 74\xB0 7\xB4 22.8" W',verbatimLatitude:'40\xB0 7\xB4 22.8" N',verbatimLongitude:'74\xB0 7\xB4 22.8" W'},{verbatimCoordinates:"40\xB0 7.38\u2019 , -74\xB0 7.38\u2019",verbatimLatitude:"40\xB0 7.38\u2019",verbatimLongitude:"-74\xB0 7.38\u2019"},{verbatimCoordinates:"N40\xB07\u201922.8\u2019\u2019, W74\xB07\u201922.8\u2019\u2019",verbatimLatitude:"N40\xB07\u201922.8\u2019\u2019",verbatimLongitude:"W74\xB07\u201922.8\u2019\u2019"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:`40\xB07'22.8"N, 74\xB07'22.8"W`,verbatimLatitude:`40\xB07'22.8"N`,verbatimLongitude:`74\xB07'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123\xB0,-74.123\xB0",verbatimLatitude:"40.123\xB0",verbatimLongitude:"-74.123\xB0"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40\xB07\u201922.8"N, 74\xB07\u201922.8"W',verbatimLatitude:'40\xB07\u201922.8"N',verbatimLongitude:'74\xB07\u201922.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40\xB07\u201923"N 74\xB07\u201923"W',verbatimLatitude:'40\xB07\u201923"N',verbatimLongitude:'74\xB07\u201923"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40\xB07\u201923"S 74\xB07\u201923"E',verbatimLatitude:'40\xB07\u201923"S',verbatimLongitude:'74\xB07\u201923"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40\xB07\u201923" -74\xB07\u201923"',verbatimLatitude:'40\xB07\u201923"',verbatimLongitude:'-74\xB07\u201923"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7\u2019 23" N 74d 7\u2019 23" W',verbatimLatitude:'40d 7\u2019 23" N',verbatimLongitude:'74d 7\u2019 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40\xB0 7.38, -74\xB0 7.38",verbatimLatitude:"40\xB0 7.38",verbatimLongitude:"-74\xB0 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],r$={decimalLatitude:40.123,decimalLongitude:-74.123},i$=[{verbatimCoordinates:`50\xB04'17.698"south, 14\xB024'2.826"east`,verbatimLatitude:`50\xB04'17.698"south`,verbatimLongitude:`14\xB024'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40\xB026\u203247\u2033N 79\xB058\u203236\u2033W",verbatimLatitude:"40\xB026\u203247\u2033N",verbatimLongitude:"79\xB058\u203236\u2033W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26\u2032 47\u2033 N 79d 58\u2032 36\u2033 W",verbatimLatitude:"40d 26\u2032 47\u2033 N",verbatimLongitude:"79d 58\u2032 36\u2033 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195\xB0 79,948862\xB0",verbatimLatitude:"40,446195\xB0",verbatimLongitude:"79,948862\xB0",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40\xB0 26.7717, -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18\xB024S 22\xB045E",verbatimLatitude:"18\xB024S",verbatimLongitude:"22\xB045E",decimalLatitude:-18.4,decimalLongitude:22.75}],n$=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245\xB0 S / 28.2344\xB0 E",verbatimLatitude:"-23.3245\xB0 S",verbatimLongitude:"28.2344\xB0 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40\xB0 26.7717 -79\xB0 56.93172",verbatimLatitude:"40\xB0 26.7717",verbatimLongitude:"-79\xB0 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 \xB0  E22.45634 \xB0",verbatimLatitude:"S23.43563 \xB0",verbatimLongitude:"E22.45634 \xB0",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372\xB0 S 23,07771\xB0 E",verbatimLatitude:"27,71372\xB0 S",verbatimLongitude:"23,07771\xB0 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48\xB0 30,6410', E 18\xB0 57,4583'",verbatimLatitude:"N 48\xB0 30,6410'",verbatimLongitude:"E 18\xB0 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function s$(){let r=[];return t$.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...r$})}),[...r,...i$,...n$]}var o$=s$();XT.formats=o$.map(r=>r.verbatimCoordinates);var a$=XT;function CR(r,e,t){let i=r.slice();return i[97]=e[t],i[99]=t,i}function IR(r){let e,t;return e=new UT({}),{c(){Cf(e.$$.fragment)},m(i,n){ih(e,i,n),t=!0},i(i){t||(ps(e.$$.fragment,i),t=!0)},o(i){no(e.$$.fragment,i),t=!1},d(i){nh(e,i)}}}function PR(r){let e,t,i,n,s;return t=new jT({}),{c(){e=pn("button"),Cf(t.$$.fragment),kt(e,"type","button"),kt(e,"title",r[10]),kt(e,"class","svelte-bz0zu3"),Yc(e,"active",r[0])},m(a,c){zn(a,e,c),ih(t,e,null),i=!0,n||(s=Hs(e,"click",r[79]),n=!0)},p(a,c){(!i||c[0]&1024)&&kt(e,"title",a[10]),(!i||c[0]&1)&&Yc(e,"active",a[0])},i(a){i||(ps(t.$$.fragment,a),i=!0)},o(a){no(t.$$.fragment,a),i=!1},d(a){a&&On(e),nh(t),n=!1,s()}}}function l$(r){let e,t=[],i=new Map,n,s,a,c=_R(r[13]),d=p=>p[97].id+(p[97].address?","+p[97].address:"");for(let p=0;p<c.length;p+=1){let b=CR(r,c,p),T=d(b);i.set(T,t[p]=MR(T,b))}return{c(){e=pn("ul");for(let p=0;p<t.length;p+=1)t[p].c();kt(e,"class","options svelte-bz0zu3"),kt(e,"role","listbox")},m(p,b){zn(p,e,b);for(let T=0;T<t.length;T+=1)t[T]&&t[T].m(e,null);n=!0,s||(a=[Hs(e,"mouseleave",r[27]),Hs(e,"blur",r[83]),Hs(e,"keydown",r[23])],s=!0)},p(p,b){b[0]&102823936&&(c=_R(p[13]),Ox(),t=IW(t,b,d,1,p,c,i,e,CW,MR,null,CR),Dx())},i(p){if(!n){for(let b=0;b<c.length;b+=1)ps(t[b]);n=!0}},o(p){for(let b=0;b<t.length;b+=1)no(t[b]);n=!1},d(p){p&&On(e);for(let b=0;b<t.length;b+=1)t[b].d();s=!1,oh(a)}}}function c$(r){let e,t,i,n,s,a;return t=new Ux({}),{c(){e=pn("div"),Cf(t.$$.fragment),i=ka(),n=pn("div"),s=Sf(r[8]),kt(n,"class","svelte-bz0zu3"),kt(e,"class","no-results svelte-bz0zu3")},m(c,d){zn(c,e,d),ih(t,e,null),Gi(e,i),Gi(e,n),Gi(n,s),a=!0},p(c,d){(!a||d[0]&256)&&yg(s,c[8])},i(c){a||(ps(t.$$.fragment,c),a=!0)},o(c){no(t.$$.fragment,c),a=!1},d(c){c&&On(e),nh(t)}}}function u$(r){let e="",t;return{c(){t=Sf(e)},m(i,n){zn(i,t,n)},p:Nn,i:Nn,o:Nn,d(i){i&&On(t)}}}function h$(r){let e,t,i,n,s,a,c,d,p,b,T;return t=new Ux({}),d=new zx({}),{c(){e=pn("div"),Cf(t.$$.fragment),i=ka(),n=pn("div"),s=Sf(r[7]),a=ka(),c=pn("button"),Cf(d.$$.fragment),kt(n,"class","svelte-bz0zu3"),kt(c,"class","svelte-bz0zu3"),kt(e,"class","error svelte-bz0zu3")},m(B,z){zn(B,e,z),ih(t,e,null),Gi(e,i),Gi(e,n),Gi(n,s),Gi(e,a),Gi(e,c),ih(d,c,null),p=!0,b||(T=Hs(c,"click",r[80]),b=!0)},p(B,z){(!p||z[0]&128)&&yg(s,B[7])},i(B){p||(ps(t.$$.fragment,B),ps(d.$$.fragment,B),p=!0)},o(B){no(t.$$.fragment,B),no(d.$$.fragment,B),p=!1},d(B){B&&On(e),nh(t),nh(d),b=!1,T()}}}function MR(r,e){var t;let i,n,s;function a(){return e[81](e[99])}function c(){return e[82](e[97])}return n=new zT({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((t=e[14])==null?void 0:t.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),n.$on("mouseenter",a),n.$on("select",c),{key:r,first:null,c(){i=gW(),Cf(n.$$.fragment),this.first=i},m(d,p){zn(d,i,p),ih(n,d,p),s=!0},p(d,p){var b;e=d;let T={};p[0]&8192&&(T.feature=e[97]),p[0]&2048&&(T.showPlaceType=e[11]),p[0]&57344&&(T.style=e[15]===e[99]?"selected":((b=e[14])==null?void 0:b.id)===e[97].id?"picked":"default"),p[0]&4096&&(T.iconsBaseUrl=e[12]),n.$set(T)},i(d){s||(ps(n.$$.fragment,d),s=!0)},o(d){no(n.$$.fragment,d),s=!1},d(d){d&&On(i),nh(n,d)}}}function f$(r){let e,t,i,n,s,a,c,d,p,b,T,B,z,G,Z,q,re,ee,ae,me,Le,je=!1;s=new GT({}),T=new zx({});let Je=r[20]&&IR(),J=r[6]==="button"&&PR(r),te=r[70].default,X=dW(te,r,r[69],null),ye=[h$,u$,c$,l$],_e=[];function Oe(ve,De){var Xe,rt;return ve[19]?0:!ve[16]&&!ve[4]?1:((Xe=ve[13])==null?void 0:Xe.length)===0?2:(rt=ve[13])!=null&&rt.length&&(ve[16]||ve[4])?3:-1}return~(q=Oe(r))&&(re=_e[q]=ye[q](r)),{c(){e=ka(),t=pn("form"),i=pn("div"),n=pn("button"),Cf(s.$$.fragment),a=ka(),c=pn("input"),d=ka(),p=pn("div"),b=pn("button"),Cf(T.$$.fragment),B=ka(),Je&&Je.c(),z=ka(),J&&J.c(),G=ka(),X&&X.c(),Z=ka(),re&&re.c(),kt(n,"class","search-button svelte-bz0zu3"),kt(n,"type","button"),kt(c,"placeholder",r[9]),kt(c,"aria-label",r[9]),kt(c,"class","svelte-bz0zu3"),kt(b,"type","button"),kt(b,"title",r[3]),kt(b,"class","svelte-bz0zu3"),kt(p,"class","clear-button-container svelte-bz0zu3"),Yc(p,"displayable",r[1]!==""),kt(i,"class","input-group svelte-bz0zu3"),kt(t,"class",ee=Nx(r[2])+" svelte-bz0zu3"),Yc(t,"can-collapse",r[5]&&r[1]==="")},m(ve,De){zn(ve,e,De),zn(ve,t,De),Gi(t,i),Gi(i,n),ih(s,n,null),Gi(i,a),Gi(i,c),r[72](c),mR(c,r[1]),Gi(i,d),Gi(i,p),Gi(p,b),ih(T,b,null),Gi(p,B),Je&&Je.m(p,null),Gi(i,z),J&&J.m(i,null),Gi(i,G),X&&X.m(i,null),Gi(t,Z),~q&&_e[q].m(t,null),ae=!0,me||(Le=[Hs(n,"click",r[71]),Hs(c,"input",r[73]),Hs(c,"focus",r[74]),Hs(c,"blur",r[75]),Hs(c,"click",r[76]),Hs(c,"keydown",r[23]),Hs(c,"input",r[24]),Hs(c,"change",r[77]),Hs(b,"click",r[78]),Hs(t,"submit",_W(r[22]))],me=!0)},p(ve,De){(!ae||De[0]&512)&&kt(c,"placeholder",ve[9]),(!ae||De[0]&512)&&kt(c,"aria-label",ve[9]),De[0]&2&&c.value!==ve[1]&&mR(c,ve[1]),(!ae||De[0]&8)&&kt(b,"title",ve[3]),ve[20]?Je?De[0]&1048576&&ps(Je,1):(Je=IR(),Je.c(),ps(Je,1),Je.m(p,null)):Je&&(Ox(),no(Je,1,1,()=>{Je=null}),Dx()),(!ae||De[0]&2)&&Yc(p,"displayable",ve[1]!==""),ve[6]==="button"?J?(J.p(ve,De),De[0]&64&&ps(J,1)):(J=PR(ve),J.c(),ps(J,1),J.m(i,G)):J&&(Ox(),no(J,1,1,()=>{J=null}),Dx()),X&&X.p&&(!ae||De[2]&128)&&AW(X,te,ve,ve[69],ae?pW(te,ve[69],De,null):mW(ve[69]),null);let Xe=q;q=Oe(ve),q===Xe?~q&&_e[q].p(ve,De):(re&&(Ox(),no(_e[Xe],1,1,()=>{_e[Xe]=null}),Dx()),~q?(re=_e[q],re?re.p(ve,De):(re=_e[q]=ye[q](ve),re.c()),ps(re,1),re.m(t,null)):re=null),(!ae||De[0]&4&&ee!==(ee=Nx(ve[2])+" svelte-bz0zu3"))&&kt(t,"class",ee),(!ae||De[0]&38)&&Yc(t,"can-collapse",ve[5]&&ve[1]==="")},i(ve){ae||(ps(je),ps(s.$$.fragment,ve),ps(T.$$.fragment,ve),ps(Je),ps(J),ps(X,ve),ps(re),ae=!0)},o(ve){no(je),no(s.$$.fragment,ve),no(T.$$.fragment,ve),no(Je),no(J),no(X,ve),no(re),ae=!1},d(ve){ve&&(On(e),On(t)),nh(s),r[72](null),nh(T),Je&&Je.d(),J&&J.d(),X&&X.d(ve),~q&&_e[q].d(),me=!1,oh(Le)}}}function d$(r,e,t){let i,n,s,{$$slots:a={},$$scope:c}=e,d={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13},{class:p=void 0}=e,{apiKey:b}=e,{bbox:T=void 0}=e,{clearButtonTitle:B="clear"}=e,{clearOnBlur:z=!1}=e,{clearListOnPick:G=!1}=e,{keepListOpen:Z=!1}=e,{collapsed:q=!1}=e,{country:re=void 0}=e,{debounceSearch:ee=200}=e,{enableReverse:ae="never"}=e,{errorMessage:me="Something went wrong\u2026"}=e,{filter:Le=()=>!0}=e,{flyTo:je=!0}=e,{fuzzyMatch:Je=!0}=e,{language:J=void 0}=e,{limit:te=void 0}=e,X=41415112612,{reverseGeocodingLimit:ye=X}=e,{mapController:_e=void 0}=e,{minLength:Oe=2}=e,{noResultsMessage:ve="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:De="Search"}=e,{proximity:Xe=[{type:"server-geolocation"}]}=e,{reverseActive:rt=ae==="always"}=e,{reverseButtonTitle:tt="toggle reverse geocoding"}=e,{searchValue:yt=""}=e,{pickedResultStyle:Xt="full-geometry"}=e,{showPlaceType:jt="if-needed"}=e,{showResultsWhileTyping:fr=!0}=e,{selectFirst:qt=!0}=e,{flyToSelected:Ot=!1}=e,{markerOnSelected:wr=!0}=e,{types:Lr=void 0}=e,Or=[],{reverseGeocodingTypes:Zr=Or}=e,{exhaustiveReverseGeocoding:Oi=!1}=e,{excludeTypes:Jr=!1}=e,Ri=void 0,{reverseGeocodingExcludeTypes:li=Ri}=e,{zoom:Qi=d}=e,{apiUrl:Di="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ni={}}=e,{iconsBaseUrl:fo="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.6/icons/"}=e,{adjustUrlQuery:Ds=()=>{}}=e,{adjustUrl:Kn=()=>{}}=e;function ks(St){si.focus(St)}function ea(){si.blur()}function os(St,Xr=!0,ri=!1){t(1,yt=St),Xr?(t(15,Ir=-1),Ke()):(nr(void 0,!ri,ri),setTimeout(()=>{si.focus(),si.select()}))}function Zs(){t(13,Vr=void 0),t(14,Ft=void 0),t(15,Ir=-1)}function as(){t(64,Jt=[]),t(14,Ft=void 0)}let Vr,Jt,Ft,Tr="",si,Ir=-1,$i,Qn=[],Mn,ot,de,ge,ce=!1,ze=new Set,Ye=KR();bW(()=>{_e&&(_e.setEventHandler(void 0),_e.indicateReverse(!1),_e.setSelectedMarker(-1),_e.setFeatures(void 0,void 0,!1))});function Ke(St){if(t(17,ce=!1),ot&&(clearTimeout(ot),ot=void 0),Ir>-1&&Vr)t(14,Ft=Vr[Ir]),t(1,yt=Ft.place_type[0]==="reverse"?Ft.place_name:Ft.place_name.replace(/,.*/,"")),t(19,$i=void 0),t(64,Jt=void 0),t(15,Ir=-1);else if(yt){let Xr=St||!dt(yt);it(yt,{exact:!0}).then(()=>{t(64,Jt=Vr),t(14,Ft=void 0),Xr&&Bt()}).catch(ri=>t(19,$i=ri))}}function dt(St){try{return a$(St,6)}catch{return!1}}async function it(St,{byId:Xr=!1,exact:ri=!1}={}){var Fs,jn,po;t(19,$i=void 0),Mn?.abort();let Jn=new AbortController;t(20,Mn=Jn);try{let xi=dt(St),Il=new URL(Di+"/"+encodeURIComponent(xi?xi.decimalLongitude+","+xi.decimalLatitude:St)+".json"),Xs=Il.searchParams;J!==void 0&&Xs.set("language",Array.isArray(J)?J.join(","):J??"");let[Bu]=_e?.getCenterAndZoom()??[],Ys=(Fs=!xi||Zr===Or?Lr:Zr)==null?void 0:Fs.map(Gn=>typeof Gn=="string"?Gn:Bu===void 0||(Gn[0]??0)<=Bu&&Bu<(Gn[1]??1/0)?Gn[2]:void 0).filter(Gn=>Gn!==void 0);Ys&&(Ys=[...new Set(Ys)],Xs.set("types",Ys.join(",")));let Lh=!xi||li===Ri?Jr:li;if(Lh&&Xs.set("excludeTypes",String(Lh)),T&&Xs.set("bbox",T.map(Gn=>Gn.toFixed(6)).join(",")),re&&Xs.set("country",Array.isArray(re)?re.join(","):re),!Xr&&!xi){let Gn=await YW(_e,Xe,Jn);Gn&&Xs.set("proximity",Gn),(ri||!fr)&&Xs.set("autocomplete","false"),Xs.set("fuzzyMatch",String(Je))}let Tc=ye===X?te:ye;Tc!==void 0&&Tc>1&&Ys?.length!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),xi?(Tc===1||Tc!==void 0&&(Oi||Ys?.length===1))&&Xs.set("limit",String(Tc)):te!==void 0&&Xs.set("limit",String(te)),b&&Xs.set("key",b),Ds(Xs),Kn(Il);let Ad=Il.searchParams.get("types")===""&&Il.searchParams.get("excludeTypes")!=="true",ba=Il.toString();if(ba===Tr){Xr?(G&&t(13,Vr=void 0),t(14,Ft=Qn[0])):(t(13,Vr=Qn),((jn=Vr[Ir])==null?void 0:jn.id)!==n?.id&&t(15,Ir=-1));return}Tr=ba;let Pl;if(Ad)Pl={type:"FeatureCollection",features:[]};else{let Gn=await fetch(ba,{signal:Jn.signal,...ni});if(!Gn.ok)throw new Error(await Gn.text());Pl=await Gn.json()}Ye("response",{url:ba,featureCollection:Pl}),Xr?(G&&t(13,Vr=void 0),t(14,Ft=Pl.features[0]),Qn=[Ft]):(t(13,Vr=Pl.features.filter(Le)),xi&&Vr.unshift({type:"Feature",properties:{},id:"reverse_"+xi.decimalLongitude+"_"+xi.decimalLatitude,text:xi.decimalLatitude+", "+xi.decimalLongitude,place_name:xi.decimalLatitude+", "+xi.decimalLongitude,place_type:["reverse"],center:[xi.decimalLongitude,xi.decimalLatitude],bbox:[xi.decimalLongitude,xi.decimalLatitude,xi.decimalLongitude,xi.decimalLatitude],geometry:{type:"Point",coordinates:[xi.decimalLongitude,xi.decimalLatitude]}}),Qn=Vr,((po=Vr[Ir])==null?void 0:po.id)!==n?.id&&t(15,Ir=-1),xi&&si.focus())}catch(xi){if(xi&&typeof xi=="object"&&"name"in xi&&xi.name==="AbortError")return;throw xi}finally{Jn===Mn&&t(20,Mn=void 0)}}function Bt(){var St;if(!(Jt!=null&&Jt.length)||!je)return;let Xr=[180,90,-180,-90],ri=!Jt.some(jn=>!jn.matching_text),Fs;for(let jn of Jt){let po=ut(jn);if(Fs=Fs===void 0?po:po===void 0?Fs:Math.max(Fs,po),ri||!jn.matching_text)for(let Jn of[0,1,2,3])Xr[Jn]=Math[Jn<2?"min":"max"](Xr[Jn],((St=jn.bbox)==null?void 0:St[Jn])??jn.center[Jn%2])}_e&&Jt.length>0&&(Ft&&Xr[0]===Xr[2]&&Xr[1]===Xr[3]?_e.flyTo(Ft.center,ut(Ft)):_e.fitBounds(Vx(Xr),50,Fs))}function Pt(){!Ft||!_e||(!Ft.bbox||Ft.bbox[0]===Ft.bbox[2]&&Ft.bbox[1]===Ft.bbox[3]?_e.flyTo(Ft.center,ut(Ft)):_e.fitBounds(Vx(Ft.bbox),50,ut(Ft)))}function ut(St){var Xr;if(!St.bbox||St.bbox[0]!==St.bbox[2]&&St.bbox[1]!==St.bbox[3])return;let ri=St.id.replace(/\..*/,"");return(Array.isArray((Xr=St.properties)==null?void 0:Xr.categories)?St.properties.categories.reduce((Fs,jn)=>{let po=Qi[ri+"."+jn];return Fs===void 0?po:po===void 0?Fs:Math.max(Fs,po)},void 0):void 0)??Qi[ri]}function zt(St){t(0,rt=ae==="always"),t(13,Vr=void 0),t(14,Ft=void 0),t(15,Ir=-1),os(St[1].toFixed(6)+", "+XW(St[0],[-180,180],!0).toFixed(6),!1,!0)}function rr(St){if(!Vr)return;let Xr=St.key==="ArrowDown"?1:St.key==="ArrowUp"?-1:0;Xr&&(si.focus(),t(17,ce=!0),St.preventDefault(),Ft&&Ir===-1&&t(15,Ir=Vr.findIndex(ri=>ri.id===Ft?.id)),Ir===(Ft||qt?0:-1)&&Xr===-1&&t(15,Ir=Vr.length),t(15,Ir+=Xr),Ir>=Vr.length&&t(15,Ir=-1),Ir<0&&(Ft||qt)&&t(15,Ir=0))}function nr(St,Xr=!0,ri=!1){if(t(19,$i=void 0),t(14,Ft=void 0),t(17,ce=!0),fr||ri){if(ot&&clearTimeout(ot),yt.length<Oe)return;let Fs=yt;ot=window.setTimeout(()=>{it(Fs).catch(jn=>t(19,$i=jn))},Xr?ee:0)}else t(13,Vr=void 0),t(19,$i=void 0)}function We(St){Ft&&Ft?.id===St?.id?Pt():(t(14,Ft=St),t(1,yt=St.place_name))}function Dr(St){t(15,Ir=St)}function Er(){(!qt||Ft)&&t(15,Ir=-1),Ot&&Pt()}let kr=()=>si.focus();function pi(St){DT[St?"unshift":"push"](()=>{si=St,t(18,si)})}function Gt(){yt=this.value,t(1,yt),t(17,ce),t(31,z),t(16,de)}let dr=()=>t(17,ce=!0),tr=()=>t(17,ce=!1),zr=()=>t(17,ce=!0),mn=()=>t(14,Ft=void 0),ta=()=>{t(1,yt=""),t(14,Ft=void 0),si.focus()},Pr=()=>t(0,rt=!rt),Vn=()=>t(19,$i=void 0),Ji=St=>Dr(St),Ru=St=>We(St),Cl=()=>{};return r.$$set=St=>{"class"in St&&t(2,p=St.class),"apiKey"in St&&t(29,b=St.apiKey),"bbox"in St&&t(30,T=St.bbox),"clearButtonTitle"in St&&t(3,B=St.clearButtonTitle),"clearOnBlur"in St&&t(31,z=St.clearOnBlur),"clearListOnPick"in St&&t(32,G=St.clearListOnPick),"keepListOpen"in St&&t(4,Z=St.keepListOpen),"collapsed"in St&&t(5,q=St.collapsed),"country"in St&&t(33,re=St.country),"debounceSearch"in St&&t(34,ee=St.debounceSearch),"enableReverse"in St&&t(6,ae=St.enableReverse),"errorMessage"in St&&t(7,me=St.errorMessage),"filter"in St&&t(35,Le=St.filter),"flyTo"in St&&t(36,je=St.flyTo),"fuzzyMatch"in St&&t(37,Je=St.fuzzyMatch),"language"in St&&t(38,J=St.language),"limit"in St&&t(39,te=St.limit),"reverseGeocodingLimit"in St&&t(40,ye=St.reverseGeocodingLimit),"mapController"in St&&t(41,_e=St.mapController),"minLength"in St&&t(42,Oe=St.minLength),"noResultsMessage"in St&&t(8,ve=St.noResultsMessage),"placeholder"in St&&t(9,De=St.placeholder),"proximity"in St&&t(43,Xe=St.proximity),"reverseActive"in St&&t(0,rt=St.reverseActive),"reverseButtonTitle"in St&&t(10,tt=St.reverseButtonTitle),"searchValue"in St&&t(1,yt=St.searchValue),"pickedResultStyle"in St&&t(44,Xt=St.pickedResultStyle),"showPlaceType"in St&&t(11,jt=St.showPlaceType),"showResultsWhileTyping"in St&&t(45,fr=St.showResultsWhileTyping),"selectFirst"in St&&t(46,qt=St.selectFirst),"flyToSelected"in St&&t(47,Ot=St.flyToSelected),"markerOnSelected"in St&&t(48,wr=St.markerOnSelected),"types"in St&&t(49,Lr=St.types),"reverseGeocodingTypes"in St&&t(50,Zr=St.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in St&&t(51,Oi=St.exhaustiveReverseGeocoding),"excludeTypes"in St&&t(52,Jr=St.excludeTypes),"reverseGeocodingExcludeTypes"in St&&t(53,li=St.reverseGeocodingExcludeTypes),"zoom"in St&&t(54,Qi=St.zoom),"apiUrl"in St&&t(55,Di=St.apiUrl),"fetchParameters"in St&&t(56,ni=St.fetchParameters),"iconsBaseUrl"in St&&t(12,fo=St.iconsBaseUrl),"adjustUrlQuery"in St&&t(57,Ds=St.adjustUrlQuery),"adjustUrl"in St&&t(58,Kn=St.adjustUrl),"$$scope"in St&&t(69,c=St.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&64&&t(0,rt=ae==="always"),r.$$.dirty[0]&16384|r.$$.dirty[1]&8192&&Xt!=="marker-only"&&Ft&&!Ft.address&&Ft.geometry.type==="Point"&&Ft.place_type[0]!=="reverse"&&it(Ft.id,{byId:!0}).catch(St=>t(19,$i=St)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1058|r.$$.dirty[2]&8&&(_e&&Ft&&Ft.id!==ge&&je&&(Pt(),G&&t(13,Vr=void 0),t(64,Jt=void 0),t(15,Ir=-1)),t(65,ge=Ft?.id)),r.$$.dirty[0]&196608|r.$$.dirty[1]&1&&setTimeout(()=>{t(16,de=ce),z&&!de&&t(1,yt="")}),r.$$.dirty[0]&8194|r.$$.dirty[1]&2048&&yt.length<Oe&&(t(13,Vr=void 0),t(19,$i=void 0),t(64,Jt=Vr)),r.$$.dirty[0]&57344|r.$$.dirty[1]&32768&&qt&&Vr!=null&&Vr.length&&Ir==-1&&!Ft&&t(15,Ir=0),r.$$.dirty[0]&8192|r.$$.dirty[2]&4&&Jt!==Vr&&t(64,Jt=void 0),r.$$.dirty[0]&73729|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&_e&&_e.setEventHandler(St=>{switch(St.type){case"mapClick":rt&&zt(St.coordinates);break;case"markerClick":{let Xr=Vr?.find(ri=>ri.id===St.id);Xr&&We(Xr)}break;case"markerMouseEnter":Jt&&t(15,Ir=de?Vr?.findIndex(Xr=>Xr.id===St.id)??-1:-1);break;case"markerMouseLeave":Jt&&t(15,Ir=-1);break}}),r.$$.dirty[0]&40960&&t(66,n=Vr?.[Ir]),r.$$.dirty[1]&66592|r.$$.dirty[2]&16&&_e&&n&&je&&Ot&&_e.flyTo(n.center,ut(n)),r.$$.dirty[1]&8192&&t(68,i=Xt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&132096|r.$$.dirty[2]&64&&(wr||_e==null||_e.setFeatures(void 0,void 0,i)),r.$$.dirty[0]&16384|r.$$.dirty[1]&132096|r.$$.dirty[2]&84&&_e&&wr&&!Jt&&(_e.setFeatures(n?[n]:void 0,Ft,i),_e.setSelectedMarker(n?0:-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1024|r.$$.dirty[2]&68&&_e&&_e.setFeatures(Jt,Ft,i),r.$$.dirty[0]&32768|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&Jt&&_e&&_e.setSelectedMarker(Ir),r.$$.dirty[0]&2|r.$$.dirty[1]&1024&&_e){let St=dt(yt);_e.setReverseMarker(St?[St.decimalLongitude,St.decimalLatitude]:void 0)}r.$$.dirty[2]&16&&Ye("select",{feature:n}),r.$$.dirty[0]&16384&&Ye("pick",{feature:Ft}),r.$$.dirty[0]&73744&&t(67,s=!!(Vr!=null&&Vr.length)&&(de||Z)),r.$$.dirty[2]&32&&Ye("optionsvisibilitychange",{optionsVisible:s}),r.$$.dirty[0]&8192&&Ye("featureslisted",{features:Vr}),r.$$.dirty[2]&4&&Ye("featuresmarked",{features:Jt}),r.$$.dirty[0]&1&&Ye("reversetoggle",{reverse:rt}),r.$$.dirty[0]&2&&Ye("querychange",{query:yt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1024&&_e&&_e.indicateReverse(rt)},[rt,yt,p,B,Z,q,ae,me,ve,De,tt,jt,fo,Vr,Ft,Ir,de,ce,si,$i,Mn,ze,Ke,rr,nr,We,Dr,Er,d,b,T,z,G,re,ee,Le,je,Je,J,te,ye,_e,Oe,Xe,Xt,fr,qt,Ot,wr,Lr,Zr,Oi,Jr,li,Qi,Di,ni,Ds,Kn,ks,ea,os,Zs,as,Jt,ge,n,s,i,c,a,kr,pi,Gt,dr,tr,zr,mn,ta,Pr,Vn,Ji,Ru,Cl]}var p$=class extends Qc{constructor(r){super(),Pf(this,r,d$,f$,If,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function bg(r,e,t={}){let i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=r,i}function YT(r,e,t={}){for(let i of r){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let n=0;n<i[i.length-1].length;n++)if(i[i.length-1][n]!==i[0][n])throw new Error("First and last Position are not equivalent.")}return bg({type:"Polygon",coordinates:r},e,t)}function vg(r,e={}){let t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function eB(r,e,t={}){return bg({type:"MultiPolygon",coordinates:r},e,t)}var A$=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,LT=Math.ceil,sl=Math.floor,fa="[BigNumber Error] ",RR=fa+"Number primitive has more than 15 significant digits: ",rc=1e14,ui=14,BR=9007199254740991,OT=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Ef=1e7,Da=1e9;function tB(r){var e,t,i,n=ee.prototype={constructor:ee,toString:null,valueOf:null},s=new ee(1),a=20,c=4,d=-7,p=21,b=-1e7,T=1e7,B=!1,z=1,G=0,Z={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xA0",suffix:""},q="0123456789abcdefghijklmnopqrstuvwxyz",re=!0;function ee(J,te){var X,ye,_e,Oe,ve,De,Xe,rt,tt=this;if(!(tt instanceof ee))return new ee(J,te);if(te==null){if(J&&J._isBigNumber===!0){tt.s=J.s,!J.c||J.e>T?tt.c=tt.e=null:J.e<b?tt.c=[tt.e=0]:(tt.e=J.e,tt.c=J.c.slice());return}if((De=typeof J=="number")&&J*0==0){if(tt.s=1/J<0?(J=-J,-1):1,J===~~J){for(Oe=0,ve=J;ve>=10;ve/=10,Oe++);Oe>T?tt.c=tt.e=null:(tt.e=Oe,tt.c=[J]);return}rt=String(J)}else{if(!A$.test(rt=String(J)))return i(tt,rt,De);tt.s=rt.charCodeAt(0)==45?(rt=rt.slice(1),-1):1}(Oe=rt.indexOf("."))>-1&&(rt=rt.replace(".","")),(ve=rt.search(/e/i))>0?(Oe<0&&(Oe=ve),Oe+=+rt.slice(ve+1),rt=rt.substring(0,ve)):Oe<0&&(Oe=rt.length)}else{if(qn(te,2,q.length,"Base"),te==10&&re)return tt=new ee(J),je(tt,a+tt.e+1,c);if(rt=String(J),De=typeof J=="number"){if(J*0!=0)return i(tt,rt,De,te);if(tt.s=1/J<0?(rt=rt.slice(1),-1):1,ee.DEBUG&&rt.replace(/^0\.0*|\./,"").length>15)throw Error(RR+J)}else tt.s=rt.charCodeAt(0)===45?(rt=rt.slice(1),-1):1;for(X=q.slice(0,te),Oe=ve=0,Xe=rt.length;ve<Xe;ve++)if(X.indexOf(ye=rt.charAt(ve))<0){if(ye=="."){if(ve>Oe){Oe=Xe;continue}}else if(!_e&&(rt==rt.toUpperCase()&&(rt=rt.toLowerCase())||rt==rt.toLowerCase()&&(rt=rt.toUpperCase()))){_e=!0,ve=-1,Oe=0;continue}return i(tt,String(J),De,te)}De=!1,rt=t(rt,te,10,tt.s),(Oe=rt.indexOf("."))>-1?rt=rt.replace(".",""):Oe=rt.length}for(ve=0;rt.charCodeAt(ve)===48;ve++);for(Xe=rt.length;rt.charCodeAt(--Xe)===48;);if(rt=rt.slice(ve,++Xe)){if(Xe-=ve,De&&ee.DEBUG&&Xe>15&&(J>BR||J!==sl(J)))throw Error(RR+tt.s*J);if((Oe=Oe-ve-1)>T)tt.c=tt.e=null;else if(Oe<b)tt.c=[tt.e=0];else{if(tt.e=Oe,tt.c=[],ve=(Oe+1)%ui,Oe<0&&(ve+=ui),ve<Xe){for(ve&&tt.c.push(+rt.slice(0,ve)),Xe-=ui;ve<Xe;)tt.c.push(+rt.slice(ve,ve+=ui));ve=ui-(rt=rt.slice(ve)).length}else ve-=Xe;for(;ve--;rt+="0");tt.c.push(+rt)}}else tt.c=[tt.e=0]}ee.clone=tB,ee.ROUND_UP=0,ee.ROUND_DOWN=1,ee.ROUND_CEIL=2,ee.ROUND_FLOOR=3,ee.ROUND_HALF_UP=4,ee.ROUND_HALF_DOWN=5,ee.ROUND_HALF_EVEN=6,ee.ROUND_HALF_CEIL=7,ee.ROUND_HALF_FLOOR=8,ee.EUCLID=9,ee.config=ee.set=function(J){var te,X;if(J!=null)if(typeof J=="object"){if(J.hasOwnProperty(te="DECIMAL_PLACES")&&(X=J[te],qn(X,0,Da,te),a=X),J.hasOwnProperty(te="ROUNDING_MODE")&&(X=J[te],qn(X,0,8,te),c=X),J.hasOwnProperty(te="EXPONENTIAL_AT")&&(X=J[te],X&&X.pop?(qn(X[0],-1e9,0,te),qn(X[1],0,Da,te),d=X[0],p=X[1]):(qn(X,-1e9,Da,te),d=-(p=X<0?-X:X))),J.hasOwnProperty(te="RANGE"))if(X=J[te],X&&X.pop)qn(X[0],-1e9,-1,te),qn(X[1],1,Da,te),b=X[0],T=X[1];else if(qn(X,-1e9,Da,te),X)b=-(T=X<0?-X:X);else throw Error(fa+te+" cannot be zero: "+X);if(J.hasOwnProperty(te="CRYPTO"))if(X=J[te],X===!!X)if(X)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))B=X;else throw B=!X,Error(fa+"crypto unavailable");else B=X;else throw Error(fa+te+" not true or false: "+X);if(J.hasOwnProperty(te="MODULO_MODE")&&(X=J[te],qn(X,0,9,te),z=X),J.hasOwnProperty(te="POW_PRECISION")&&(X=J[te],qn(X,0,Da,te),G=X),J.hasOwnProperty(te="FORMAT"))if(X=J[te],typeof X=="object")Z=X;else throw Error(fa+te+" not an object: "+X);if(J.hasOwnProperty(te="ALPHABET"))if(X=J[te],typeof X=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(X))re=X.slice(0,10)=="0123456789",q=X;else throw Error(fa+te+" invalid: "+X)}else throw Error(fa+"Object expected: "+J);return{DECIMAL_PLACES:a,ROUNDING_MODE:c,EXPONENTIAL_AT:[d,p],RANGE:[b,T],CRYPTO:B,MODULO_MODE:z,POW_PRECISION:G,FORMAT:Z,ALPHABET:q}},ee.isBigNumber=function(J){if(!J||J._isBigNumber!==!0)return!1;if(!ee.DEBUG)return!0;var te,X,ye=J.c,_e=J.e,Oe=J.s;e:if({}.toString.call(ye)=="[object Array]"){if((Oe===1||Oe===-1)&&_e>=-1e9&&_e<=Da&&_e===sl(_e)){if(ye[0]===0){if(_e===0&&ye.length===1)return!0;break e}if(te=(_e+1)%ui,te<1&&(te+=ui),String(ye[0]).length==te){for(te=0;te<ye.length;te++)if(X=ye[te],X<0||X>=rc||X!==sl(X))break e;if(X!==0)return!0}}}else if(ye===null&&_e===null&&(Oe===null||Oe===1||Oe===-1))return!0;throw Error(fa+"Invalid BigNumber: "+J)},ee.maximum=ee.max=function(){return me(arguments,-1)},ee.minimum=ee.min=function(){return me(arguments,1)},ee.random=function(){var J=9007199254740992,te=Math.random()*J&2097151?function(){return sl(Math.random()*J)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(X){var ye,_e,Oe,ve,De,Xe=0,rt=[],tt=new ee(s);if(X==null?X=a:qn(X,0,Da),ve=LT(X/ui),B)if(crypto.getRandomValues){for(ye=crypto.getRandomValues(new Uint32Array(ve*=2));Xe<ve;)De=ye[Xe]*131072+(ye[Xe+1]>>>11),De>=9e15?(_e=crypto.getRandomValues(new Uint32Array(2)),ye[Xe]=_e[0],ye[Xe+1]=_e[1]):(rt.push(De%1e14),Xe+=2);Xe=ve/2}else if(crypto.randomBytes){for(ye=crypto.randomBytes(ve*=7);Xe<ve;)De=(ye[Xe]&31)*281474976710656+ye[Xe+1]*1099511627776+ye[Xe+2]*4294967296+ye[Xe+3]*16777216+(ye[Xe+4]<<16)+(ye[Xe+5]<<8)+ye[Xe+6],De>=9e15?crypto.randomBytes(7).copy(ye,Xe):(rt.push(De%1e14),Xe+=7);Xe=ve/7}else throw B=!1,Error(fa+"crypto unavailable");if(!B)for(;Xe<ve;)De=te(),De<9e15&&(rt[Xe++]=De%1e14);for(ve=rt[--Xe],X%=ui,ve&&X&&(De=OT[ui-X],rt[Xe]=sl(ve/De)*De);rt[Xe]===0;rt.pop(),Xe--);if(Xe<0)rt=[Oe=0];else{for(Oe=-1;rt[0]===0;rt.splice(0,1),Oe-=ui);for(Xe=1,De=rt[0];De>=10;De/=10,Xe++);Xe<ui&&(Oe-=ui-Xe)}return tt.e=Oe,tt.c=rt,tt}}(),ee.sum=function(){for(var J=1,te=arguments,X=new ee(te[0]);J<te.length;)X=X.plus(te[J++]);return X},t=function(){var J="0123456789";function te(X,ye,_e,Oe){for(var ve,De=[0],Xe,rt=0,tt=X.length;rt<tt;){for(Xe=De.length;Xe--;De[Xe]*=ye);for(De[0]+=Oe.indexOf(X.charAt(rt++)),ve=0;ve<De.length;ve++)De[ve]>_e-1&&(De[ve+1]==null&&(De[ve+1]=0),De[ve+1]+=De[ve]/_e|0,De[ve]%=_e)}return De.reverse()}return function(X,ye,_e,Oe,ve){var De,Xe,rt,tt,yt,Xt,jt,fr,qt=X.indexOf("."),Ot=a,wr=c;for(qt>=0&&(tt=G,G=0,X=X.replace(".",""),fr=new ee(ye),Xt=fr.pow(X.length-qt),G=tt,fr.c=te(rh(nl(Xt.c),Xt.e,"0"),10,_e,J),fr.e=fr.c.length),jt=te(X,ye,_e,ve?(De=q,J):(De=J,q)),rt=tt=jt.length;jt[--tt]==0;jt.pop());if(!jt[0])return De.charAt(0);if(qt<0?--rt:(Xt.c=jt,Xt.e=rt,Xt.s=Oe,Xt=e(Xt,fr,Ot,wr,_e),jt=Xt.c,yt=Xt.r,rt=Xt.e),Xe=rt+Ot+1,qt=jt[Xe],tt=_e/2,yt=yt||Xe<0||jt[Xe+1]!=null,yt=wr<4?(qt!=null||yt)&&(wr==0||wr==(Xt.s<0?3:2)):qt>tt||qt==tt&&(wr==4||yt||wr==6&&jt[Xe-1]&1||wr==(Xt.s<0?8:7)),Xe<1||!jt[0])X=yt?rh(De.charAt(1),-Ot,De.charAt(0)):De.charAt(0);else{if(jt.length=Xe,yt)for(--_e;++jt[--Xe]>_e;)jt[Xe]=0,Xe||(++rt,jt=[1].concat(jt));for(tt=jt.length;!jt[--tt];);for(qt=0,X="";qt<=tt;X+=De.charAt(jt[qt++]));X=rh(X,rt,De.charAt(0))}return X}}(),e=function(){function J(ye,_e,Oe){var ve,De,Xe,rt,tt=0,yt=ye.length,Xt=_e%Ef,jt=_e/Ef|0;for(ye=ye.slice();yt--;)Xe=ye[yt]%Ef,rt=ye[yt]/Ef|0,ve=jt*Xe+rt*Xt,De=Xt*Xe+ve%Ef*Ef+tt,tt=(De/Oe|0)+(ve/Ef|0)+jt*rt,ye[yt]=De%Oe;return tt&&(ye=[tt].concat(ye)),ye}function te(ye,_e,Oe,ve){var De,Xe;if(Oe!=ve)Xe=Oe>ve?1:-1;else for(De=Xe=0;De<Oe;De++)if(ye[De]!=_e[De]){Xe=ye[De]>_e[De]?1:-1;break}return Xe}function X(ye,_e,Oe,ve){for(var De=0;Oe--;)ye[Oe]-=De,De=ye[Oe]<_e[Oe]?1:0,ye[Oe]=De*ve+ye[Oe]-_e[Oe];for(;!ye[0]&&ye.length>1;ye.splice(0,1));}return function(ye,_e,Oe,ve,De){var Xe,rt,tt,yt,Xt,jt,fr,qt,Ot,wr,Lr,Or,Zr,Oi,Jr,Ri,li,Qi=ye.s==_e.s?1:-1,Di=ye.c,ni=_e.c;if(!Di||!Di[0]||!ni||!ni[0])return new ee(!ye.s||!_e.s||(Di?ni&&Di[0]==ni[0]:!ni)?NaN:Di&&Di[0]==0||!ni?Qi*0:Qi/0);for(qt=new ee(Qi),Ot=qt.c=[],rt=ye.e-_e.e,Qi=Oe+rt+1,De||(De=rc,rt=ol(ye.e/ui)-ol(_e.e/ui),Qi=Qi/ui|0),tt=0;ni[tt]==(Di[tt]||0);tt++);if(ni[tt]>(Di[tt]||0)&&rt--,Qi<0)Ot.push(1),yt=!0;else{for(Oi=Di.length,Ri=ni.length,tt=0,Qi+=2,Xt=sl(De/(ni[0]+1)),Xt>1&&(ni=J(ni,Xt,De),Di=J(Di,Xt,De),Ri=ni.length,Oi=Di.length),Zr=Ri,wr=Di.slice(0,Ri),Lr=wr.length;Lr<Ri;wr[Lr++]=0);li=ni.slice(),li=[0].concat(li),Jr=ni[0],ni[1]>=De/2&&Jr++;do{if(Xt=0,Xe=te(ni,wr,Ri,Lr),Xe<0){if(Or=wr[0],Ri!=Lr&&(Or=Or*De+(wr[1]||0)),Xt=sl(Or/Jr),Xt>1)for(Xt>=De&&(Xt=De-1),jt=J(ni,Xt,De),fr=jt.length,Lr=wr.length;te(jt,wr,fr,Lr)==1;)Xt--,X(jt,Ri<fr?li:ni,fr,De),fr=jt.length,Xe=1;else Xt==0&&(Xe=Xt=1),jt=ni.slice(),fr=jt.length;if(fr<Lr&&(jt=[0].concat(jt)),X(wr,jt,Lr,De),Lr=wr.length,Xe==-1)for(;te(ni,wr,Ri,Lr)<1;)Xt++,X(wr,Ri<Lr?li:ni,Lr,De),Lr=wr.length}else Xe===0&&(Xt++,wr=[0]);Ot[tt++]=Xt,wr[0]?wr[Lr++]=Di[Zr]||0:(wr=[Di[Zr]],Lr=1)}while((Zr++<Oi||wr[0]!=null)&&Qi--);yt=wr[0]!=null,Ot[0]||Ot.splice(0,1)}if(De==rc){for(tt=1,Qi=Ot[0];Qi>=10;Qi/=10,tt++);je(qt,Oe+(qt.e=tt+rt*ui-1)+1,ve,yt)}else qt.e=rt,qt.r=+yt;return qt}}();function ae(J,te,X,ye){var _e,Oe,ve,De,Xe;if(X==null?X=c:qn(X,0,8),!J.c)return J.toString();if(_e=J.c[0],ve=J.e,te==null)Xe=nl(J.c),Xe=ye==1||ye==2&&(ve<=d||ve>=p)?Rx(Xe,ve):rh(Xe,ve,"0");else if(J=je(new ee(J),te,X),Oe=J.e,Xe=nl(J.c),De=Xe.length,ye==1||ye==2&&(te<=Oe||Oe<=d)){for(;De<te;Xe+="0",De++);Xe=Rx(Xe,Oe)}else if(te-=ve,Xe=rh(Xe,Oe,"0"),Oe+1>De){if(--te>0)for(Xe+=".";te--;Xe+="0");}else if(te+=Oe-De,te>0)for(Oe+1==De&&(Xe+=".");te--;Xe+="0");return J.s<0&&_e?"-"+Xe:Xe}function me(J,te){for(var X,ye,_e=1,Oe=new ee(J[0]);_e<J.length;_e++)ye=new ee(J[_e]),(!ye.s||(X=ep(Oe,ye))===te||X===0&&Oe.s===te)&&(Oe=ye);return Oe}function Le(J,te,X){for(var ye=1,_e=te.length;!te[--_e];te.pop());for(_e=te[0];_e>=10;_e/=10,ye++);return(X=ye+X*ui-1)>T?J.c=J.e=null:X<b?J.c=[J.e=0]:(J.e=X,J.c=te),J}i=function(){var J=/^(-?)0([xbo])(?=\w[\w.]*$)/i,te=/^([^.]+)\.$/,X=/^\.([^.]+)$/,ye=/^-?(Infinity|NaN)$/,_e=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Oe,ve,De,Xe){var rt,tt=De?ve:ve.replace(_e,"");if(ye.test(tt))Oe.s=isNaN(tt)?null:tt<0?-1:1;else{if(!De&&(tt=tt.replace(J,function(yt,Xt,jt){return rt=(jt=jt.toLowerCase())=="x"?16:jt=="b"?2:8,!Xe||Xe==rt?Xt:yt}),Xe&&(rt=Xe,tt=tt.replace(te,"$1").replace(X,"0.$1")),ve!=tt))return new ee(tt,rt);if(ee.DEBUG)throw Error(fa+"Not a"+(Xe?" base "+Xe:"")+" number: "+ve);Oe.s=null}Oe.c=Oe.e=null}}();function je(J,te,X,ye){var _e,Oe,ve,De,Xe,rt,tt,yt=J.c,Xt=OT;if(yt){e:{for(_e=1,De=yt[0];De>=10;De/=10,_e++);if(Oe=te-_e,Oe<0)Oe+=ui,ve=te,Xe=yt[rt=0],tt=sl(Xe/Xt[_e-ve-1]%10);else if(rt=LT((Oe+1)/ui),rt>=yt.length)if(ye){for(;yt.length<=rt;yt.push(0));Xe=tt=0,_e=1,Oe%=ui,ve=Oe-ui+1}else break e;else{for(Xe=De=yt[rt],_e=1;De>=10;De/=10,_e++);Oe%=ui,ve=Oe-ui+_e,tt=ve<0?0:sl(Xe/Xt[_e-ve-1]%10)}if(ye=ye||te<0||yt[rt+1]!=null||(ve<0?Xe:Xe%Xt[_e-ve-1]),ye=X<4?(tt||ye)&&(X==0||X==(J.s<0?3:2)):tt>5||tt==5&&(X==4||ye||X==6&&(Oe>0?ve>0?Xe/Xt[_e-ve]:0:yt[rt-1])%10&1||X==(J.s<0?8:7)),te<1||!yt[0])return yt.length=0,ye?(te-=J.e+1,yt[0]=Xt[(ui-te%ui)%ui],J.e=-te||0):yt[0]=J.e=0,J;if(Oe==0?(yt.length=rt,De=1,rt--):(yt.length=rt+1,De=Xt[ui-Oe],yt[rt]=ve>0?sl(Xe/Xt[_e-ve]%Xt[ve])*De:0),ye)for(;;)if(rt==0){for(Oe=1,ve=yt[0];ve>=10;ve/=10,Oe++);for(ve=yt[0]+=De,De=1;ve>=10;ve/=10,De++);Oe!=De&&(J.e++,yt[0]==rc&&(yt[0]=1));break}else{if(yt[rt]+=De,yt[rt]!=rc)break;yt[rt--]=0,De=1}for(Oe=yt.length;yt[--Oe]===0;yt.pop());}J.e>T?J.c=J.e=null:J.e<b&&(J.c=[J.e=0])}return J}function Je(J){var te,X=J.e;return X===null?J.toString():(te=nl(J.c),te=X<=d||X>=p?Rx(te,X):rh(te,X,"0"),J.s<0?"-"+te:te)}return n.absoluteValue=n.abs=function(){var J=new ee(this);return J.s<0&&(J.s=1),J},n.comparedTo=function(J,te){return ep(this,new ee(J,te))},n.decimalPlaces=n.dp=function(J,te){var X,ye,_e,Oe=this;if(J!=null)return qn(J,0,Da),te==null?te=c:qn(te,0,8),je(new ee(Oe),J+Oe.e+1,te);if(!(X=Oe.c))return null;if(ye=((_e=X.length-1)-ol(this.e/ui))*ui,_e=X[_e])for(;_e%10==0;_e/=10,ye--);return ye<0&&(ye=0),ye},n.dividedBy=n.div=function(J,te){return e(this,new ee(J,te),a,c)},n.dividedToIntegerBy=n.idiv=function(J,te){return e(this,new ee(J,te),0,1)},n.exponentiatedBy=n.pow=function(J,te){var X,ye,_e,Oe,ve,De,Xe,rt,tt,yt=this;if(J=new ee(J),J.c&&!J.isInteger())throw Error(fa+"Exponent not an integer: "+Je(J));if(te!=null&&(te=new ee(te)),De=J.e>14,!yt.c||!yt.c[0]||yt.c[0]==1&&!yt.e&&yt.c.length==1||!J.c||!J.c[0])return tt=new ee(Math.pow(+Je(yt),De?J.s*(2-Mx(J)):+Je(J))),te?tt.mod(te):tt;if(Xe=J.s<0,te){if(te.c?!te.c[0]:!te.s)return new ee(NaN);ye=!Xe&&yt.isInteger()&&te.isInteger(),ye&&(yt=yt.mod(te))}else{if(J.e>9&&(yt.e>0||yt.e<-1||(yt.e==0?yt.c[0]>1||De&&yt.c[1]>=24e7:yt.c[0]<8e13||De&&yt.c[0]<=9999975e7)))return Oe=yt.s<0&&Mx(J)?-0:0,yt.e>-1&&(Oe=1/Oe),new ee(Xe?1/Oe:Oe);G&&(Oe=LT(G/ui+2))}for(De?(X=new ee(.5),Xe&&(J.s=1),rt=Mx(J)):(_e=Math.abs(+Je(J)),rt=_e%2),tt=new ee(s);;){if(rt){if(tt=tt.times(yt),!tt.c)break;Oe?tt.c.length>Oe&&(tt.c.length=Oe):ye&&(tt=tt.mod(te))}if(_e){if(_e=sl(_e/2),_e===0)break;rt=_e%2}else if(J=J.times(X),je(J,J.e+1,1),J.e>14)rt=Mx(J);else{if(_e=+Je(J),_e===0)break;rt=_e%2}yt=yt.times(yt),Oe?yt.c&&yt.c.length>Oe&&(yt.c.length=Oe):ye&&(yt=yt.mod(te))}return ye?tt:(Xe&&(tt=s.div(tt)),te?tt.mod(te):Oe?je(tt,G,c,ve):tt)},n.integerValue=function(J){var te=new ee(this);return J==null?J=c:qn(J,0,8),je(te,te.e+1,J)},n.isEqualTo=n.eq=function(J,te){return ep(this,new ee(J,te))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(J,te){return ep(this,new ee(J,te))>0},n.isGreaterThanOrEqualTo=n.gte=function(J,te){return(te=ep(this,new ee(J,te)))===1||te===0},n.isInteger=function(){return!!this.c&&ol(this.e/ui)>this.c.length-2},n.isLessThan=n.lt=function(J,te){return ep(this,new ee(J,te))<0},n.isLessThanOrEqualTo=n.lte=function(J,te){return(te=ep(this,new ee(J,te)))===-1||te===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(J,te){var X,ye,_e,Oe,ve=this,De=ve.s;if(J=new ee(J,te),te=J.s,!De||!te)return new ee(NaN);if(De!=te)return J.s=-te,ve.plus(J);var Xe=ve.e/ui,rt=J.e/ui,tt=ve.c,yt=J.c;if(!Xe||!rt){if(!tt||!yt)return tt?(J.s=-te,J):new ee(yt?ve:NaN);if(!tt[0]||!yt[0])return yt[0]?(J.s=-te,J):new ee(tt[0]?ve:c==3?-0:0)}if(Xe=ol(Xe),rt=ol(rt),tt=tt.slice(),De=Xe-rt){for((Oe=De<0)?(De=-De,_e=tt):(rt=Xe,_e=yt),_e.reverse(),te=De;te--;_e.push(0));_e.reverse()}else for(ye=(Oe=(De=tt.length)<(te=yt.length))?De:te,De=te=0;te<ye;te++)if(tt[te]!=yt[te]){Oe=tt[te]<yt[te];break}if(Oe&&(_e=tt,tt=yt,yt=_e,J.s=-J.s),te=(ye=yt.length)-(X=tt.length),te>0)for(;te--;tt[X++]=0);for(te=rc-1;ye>De;){if(tt[--ye]<yt[ye]){for(X=ye;X&&!tt[--X];tt[X]=te);--tt[X],tt[ye]+=rc}tt[ye]-=yt[ye]}for(;tt[0]==0;tt.splice(0,1),--rt);return tt[0]?Le(J,tt,rt):(J.s=c==3?-1:1,J.c=[J.e=0],J)},n.modulo=n.mod=function(J,te){var X,ye,_e=this;return J=new ee(J,te),!_e.c||!J.s||J.c&&!J.c[0]?new ee(NaN):!J.c||_e.c&&!_e.c[0]?new ee(_e):(z==9?(ye=J.s,J.s=1,X=e(_e,J,0,3),J.s=ye,X.s*=ye):X=e(_e,J,0,z),J=_e.minus(X.times(J)),!J.c[0]&&z==1&&(J.s=_e.s),J)},n.multipliedBy=n.times=function(J,te){var X,ye,_e,Oe,ve,De,Xe,rt,tt,yt,Xt,jt,fr,qt,Ot,wr=this,Lr=wr.c,Or=(J=new ee(J,te)).c;if(!Lr||!Or||!Lr[0]||!Or[0])return!wr.s||!J.s||Lr&&!Lr[0]&&!Or||Or&&!Or[0]&&!Lr?J.c=J.e=J.s=null:(J.s*=wr.s,!Lr||!Or?J.c=J.e=null:(J.c=[0],J.e=0)),J;for(ye=ol(wr.e/ui)+ol(J.e/ui),J.s*=wr.s,Xe=Lr.length,yt=Or.length,Xe<yt&&(fr=Lr,Lr=Or,Or=fr,_e=Xe,Xe=yt,yt=_e),_e=Xe+yt,fr=[];_e--;fr.push(0));for(qt=rc,Ot=Ef,_e=yt;--_e>=0;){for(X=0,Xt=Or[_e]%Ot,jt=Or[_e]/Ot|0,ve=Xe,Oe=_e+ve;Oe>_e;)rt=Lr[--ve]%Ot,tt=Lr[ve]/Ot|0,De=jt*rt+tt*Xt,rt=Xt*rt+De%Ot*Ot+fr[Oe]+X,X=(rt/qt|0)+(De/Ot|0)+jt*tt,fr[Oe--]=rt%qt;fr[Oe]=X}return X?++ye:fr.splice(0,1),Le(J,fr,ye)},n.negated=function(){var J=new ee(this);return J.s=-J.s||null,J},n.plus=function(J,te){var X,ye=this,_e=ye.s;if(J=new ee(J,te),te=J.s,!_e||!te)return new ee(NaN);if(_e!=te)return J.s=-te,ye.minus(J);var Oe=ye.e/ui,ve=J.e/ui,De=ye.c,Xe=J.c;if(!Oe||!ve){if(!De||!Xe)return new ee(_e/0);if(!De[0]||!Xe[0])return Xe[0]?J:new ee(De[0]?ye:_e*0)}if(Oe=ol(Oe),ve=ol(ve),De=De.slice(),_e=Oe-ve){for(_e>0?(ve=Oe,X=Xe):(_e=-_e,X=De),X.reverse();_e--;X.push(0));X.reverse()}for(_e=De.length,te=Xe.length,_e-te<0&&(X=Xe,Xe=De,De=X,te=_e),_e=0;te;)_e=(De[--te]=De[te]+Xe[te]+_e)/rc|0,De[te]=rc===De[te]?0:De[te]%rc;return _e&&(De=[_e].concat(De),++ve),Le(J,De,ve)},n.precision=n.sd=function(J,te){var X,ye,_e,Oe=this;if(J!=null&&J!==!!J)return qn(J,1,Da),te==null?te=c:qn(te,0,8),je(new ee(Oe),J,te);if(!(X=Oe.c))return null;if(_e=X.length-1,ye=_e*ui+1,_e=X[_e]){for(;_e%10==0;_e/=10,ye--);for(_e=X[0];_e>=10;_e/=10,ye++);}return J&&Oe.e+1>ye&&(ye=Oe.e+1),ye},n.shiftedBy=function(J){return qn(J,-9007199254740991,BR),this.times("1e"+J)},n.squareRoot=n.sqrt=function(){var J,te,X,ye,_e,Oe=this,ve=Oe.c,De=Oe.s,Xe=Oe.e,rt=a+4,tt=new ee("0.5");if(De!==1||!ve||!ve[0])return new ee(!De||De<0&&(!ve||ve[0])?NaN:ve?Oe:1/0);if(De=Math.sqrt(+Je(Oe)),De==0||De==1/0?(te=nl(ve),(te.length+Xe)%2==0&&(te+="0"),De=Math.sqrt(+te),Xe=ol((Xe+1)/2)-(Xe<0||Xe%2),De==1/0?te="5e"+Xe:(te=De.toExponential(),te=te.slice(0,te.indexOf("e")+1)+Xe),X=new ee(te)):X=new ee(De+""),X.c[0]){for(Xe=X.e,De=Xe+rt,De<3&&(De=0);;)if(_e=X,X=tt.times(_e.plus(e(Oe,_e,rt,1))),nl(_e.c).slice(0,De)===(te=nl(X.c)).slice(0,De))if(X.e<Xe&&--De,te=te.slice(De-3,De+1),te=="9999"||!ye&&te=="4999"){if(!ye&&(je(_e,_e.e+a+2,0),_e.times(_e).eq(Oe))){X=_e;break}rt+=4,De+=4,ye=1}else{(!+te||!+te.slice(1)&&te.charAt(0)=="5")&&(je(X,X.e+a+2,1),J=!X.times(X).eq(Oe));break}}return je(X,X.e+a+1,c,J)},n.toExponential=function(J,te){return J!=null&&(qn(J,0,Da),J++),ae(this,J,te,1)},n.toFixed=function(J,te){return J!=null&&(qn(J,0,Da),J=J+this.e+1),ae(this,J,te)},n.toFormat=function(J,te,X){var ye,_e=this;if(X==null)J!=null&&te&&typeof te=="object"?(X=te,te=null):J&&typeof J=="object"?(X=J,J=te=null):X=Z;else if(typeof X!="object")throw Error(fa+"Argument not an object: "+X);if(ye=_e.toFixed(J,te),_e.c){var Oe,ve=ye.split("."),De=+X.groupSize,Xe=+X.secondaryGroupSize,rt=X.groupSeparator||"",tt=ve[0],yt=ve[1],Xt=_e.s<0,jt=Xt?tt.slice(1):tt,fr=jt.length;if(Xe&&(Oe=De,De=Xe,Xe=Oe,fr-=Oe),De>0&&fr>0){for(Oe=fr%De||De,tt=jt.substr(0,Oe);Oe<fr;Oe+=De)tt+=rt+jt.substr(Oe,De);Xe>0&&(tt+=rt+jt.slice(Oe)),Xt&&(tt="-"+tt)}ye=yt?tt+(X.decimalSeparator||"")+((Xe=+X.fractionGroupSize)?yt.replace(new RegExp("\\d{"+Xe+"}\\B","g"),"$&"+(X.fractionGroupSeparator||"")):yt):tt}return(X.prefix||"")+ye+(X.suffix||"")},n.toFraction=function(J){var te,X,ye,_e,Oe,ve,De,Xe,rt,tt,yt,Xt,jt=this,fr=jt.c;if(J!=null&&(De=new ee(J),!De.isInteger()&&(De.c||De.s!==1)||De.lt(s)))throw Error(fa+"Argument "+(De.isInteger()?"out of range: ":"not an integer: ")+Je(De));if(!fr)return new ee(jt);for(te=new ee(s),rt=X=new ee(s),ye=Xe=new ee(s),Xt=nl(fr),Oe=te.e=Xt.length-jt.e-1,te.c[0]=OT[(ve=Oe%ui)<0?ui+ve:ve],J=!J||De.comparedTo(te)>0?Oe>0?te:rt:De,ve=T,T=1/0,De=new ee(Xt),Xe.c[0]=0;tt=e(De,te,0,1),_e=X.plus(tt.times(ye)),_e.comparedTo(J)!=1;)X=ye,ye=_e,rt=Xe.plus(tt.times(_e=rt)),Xe=_e,te=De.minus(tt.times(_e=te)),De=_e;return _e=e(J.minus(X),ye,0,1),Xe=Xe.plus(_e.times(rt)),X=X.plus(_e.times(ye)),Xe.s=rt.s=jt.s,Oe=Oe*2,yt=e(rt,ye,Oe,c).minus(jt).abs().comparedTo(e(Xe,X,Oe,c).minus(jt).abs())<1?[rt,ye]:[Xe,X],T=ve,yt},n.toNumber=function(){return+Je(this)},n.toPrecision=function(J,te){return J!=null&&qn(J,1,Da),ae(this,J,te,2)},n.toString=function(J){var te,X=this,ye=X.s,_e=X.e;return _e===null?ye?(te="Infinity",ye<0&&(te="-"+te)):te="NaN":(J==null?te=_e<=d||_e>=p?Rx(nl(X.c),_e):rh(nl(X.c),_e,"0"):J===10&&re?(X=je(new ee(X),a+_e+1,c),te=rh(nl(X.c),X.e,"0")):(qn(J,2,q.length,"Base"),te=t(rh(nl(X.c),_e,"0"),10,J,ye,!0)),ye<0&&X.c[0]&&(te="-"+te)),te},n.valueOf=n.toJSON=function(){return Je(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,r!=null&&ee.set(r),ee}function ol(r){var e=r|0;return r>0||r===e?e:e-1}function nl(r){for(var e,t,i=1,n=r.length,s=r[0]+"";i<n;){for(e=r[i++]+"",t=ui-e.length;t--;e="0"+e);s+=e}for(n=s.length;s.charCodeAt(--n)===48;);return s.slice(0,n+1||1)}function ep(r,e){var t,i,n=r.c,s=e.c,a=r.s,c=e.s,d=r.e,p=e.e;if(!a||!c)return null;if(t=n&&!n[0],i=s&&!s[0],t||i)return t?i?0:-c:a;if(a!=c)return a;if(t=a<0,i=d==p,!n||!s)return i?0:!n^t?1:-1;if(!i)return d>p^t?1:-1;for(c=(d=n.length)<(p=s.length)?d:p,a=0;a<c;a++)if(n[a]!=s[a])return n[a]>s[a]^t?1:-1;return d==p?0:d>p^t?1:-1}function qn(r,e,t,i){if(r<e||r>t||r!==sl(r))throw Error(fa+(i||"Argument")+(typeof r=="number"?r<e||r>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function Mx(r){var e=r.c.length-1;return ol(r.e/ui)==e&&r.c[e]%2!=0}function Rx(r,e){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(e<0?"e":"e+")+e}function rh(r,e,t){var i,n;if(e<0){for(n=t+".";++e;n+=t);r=n+r}else if(i=r.length,++e>i){for(n=t,e-=i;--e;n+=t);r+=n}else e<i&&(r=r.slice(0,e)+"."+r.slice(e));return r}var Kc=tB(),m$=class{constructor(r){xr(this,"key"),xr(this,"left",null),xr(this,"right",null),this.key=r}},pg=class extends m${constructor(r){super(r)}},g$=class{constructor(){xr(this,"size",0),xr(this,"modificationCount",0),xr(this,"splayCount",0)}splay(r){let e=this.root;if(e==null)return this.compare(r,r),-1;let t=null,i=null,n=null,s=null,a=e,c=this.compare,d;for(;;)if(d=c(a.key,r),d>0){let p=a.left;if(p==null||(d=c(p.key,r),d>0&&(a.left=p.right,p.right=a,a=p,p=a.left,p==null)))break;t==null?i=a:t.left=a,t=a,a=p}else if(d<0){let p=a.right;if(p==null||(d=c(p.key,r),d<0&&(a.right=p.left,p.left=a,a=p,p=a.right,p==null)))break;n==null?s=a:n.right=a,n=a,a=p}else break;return n!=null&&(n.right=a.left,a.left=s),t!=null&&(t.left=a.right,a.right=i),this.root!==a&&(this.root=a,this.splayCount++),d}splayMin(r){let e=r,t=e.left;for(;t!=null;){let i=t;e.left=i.right,i.right=e,e=i,t=e.left}return e}splayMax(r){let e=r,t=e.right;for(;t!=null;){let i=t;e.right=i.left,i.left=e,e=i,t=e.right}return e}_delete(r){if(this.root==null||this.splay(r)!=0)return null;let e=this.root,t=e,i=e.left;if(this.size--,i==null)this.root=e.right;else{let n=e.right;e=this.splayMax(i),e.right=n,this.root=e}return this.modificationCount++,t}addNewRoot(r,e){this.size++,this.modificationCount++;let t=this.root;if(t==null){this.root=r;return}e<0?(r.left=t,r.right=t.right,t.right=null):(r.right=t,r.left=t.left,t.left=null),this.root=r}_first(){let r=this.root;return r==null?null:(this.root=this.splayMin(r),this.root)}_last(){let r=this.root;return r==null?null:(this.root=this.splayMax(r),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(r){return this.validKey(r)&&this.splay(r)==0}defaultCompare(){return(r,e)=>r<e?-1:r>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:r=>{this.root=r},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:r=>{this.splayCount=r},splay:r=>this.splay(r),has:r=>this.has(r)}}},LR,OR,jx=class mg extends g${constructor(e,t){super(),xr(this,"root",null),xr(this,"compare"),xr(this,"validKey"),xr(this,LR,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=t??(i=>i!=null&&i!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(let t of e)this.delete(t)}forEach(e){let t=this[Symbol.iterator](),i;for(;i=t.next(),!i.done;)e(i.value,i.value,this)}add(e){let t=this.splay(e);return t!=0&&this.addNewRoot(new pg(e),t),this}addAndReturn(e){let t=this.splay(e);return t!=0&&this.addNewRoot(new pg(e),t),this.root.key}addAll(e){for(let t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let t=this.root.left;if(t==null)return null;let i=t.right;for(;i!=null;)t=i,i=t.right;return t.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let t=this.root.right;if(t==null)return null;let i=t.left;for(;i!=null;)t=i,i=t.left;return t.key}retainAll(e){let t=new mg(this.compare,this.validKey),i=this.modificationCount;for(let n of e){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(n)&&this.splay(n)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){let t=new mg(this.compare,this.validKey);for(let i of this)e.has(i)&&t.add(i);return t}difference(e){let t=new mg(this.compare,this.validKey);for(let i of this)e.has(i)||t.add(i);return t}union(e){let t=this.clone();return t.addAll(e),t}clone(){let e=new mg(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(n,s){let a,c;do{if(a=n.left,c=n.right,a!=null){let d=new pg(a.key);s.left=d,t(a,d)}if(c!=null){let d=new pg(c.key);s.right=d,n=c,s=d}}while(c!=null)}let i=new pg(e.key);return t(e,i),i}toSet(){return this.clone()}entries(){return new y$(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(OR=Symbol.iterator,LR=Symbol.toStringTag,OR)](){return new _$(this.wrap())}},rB=class{constructor(r){xr(this,"tree"),xr(this,"path",new Array),xr(this,"modificationCount",null),xr(this,"splayCount"),this.tree=r,this.splayCount=r.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;let r=this.path[this.path.length-1];return this.getValue(r)}rebuildPath(r){this.path.splice(0,this.path.length),this.tree.splay(r),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(r){for(;r!=null;)this.path.push(r),r=r.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let r=this.path[this.path.length-1],e=r.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===r;)r=this.path.pop();return this.path.length>0}},_$=class extends rB{getValue(r){return r.key}},y$=class extends rB{getValue(r){return[r.key,r.key]}},iB=r=>()=>r,HT=r=>{let e=r?(t,i)=>i.minus(t).abs().isLessThanOrEqualTo(r):iB(!1);return(t,i)=>e(t,i)?0:t.comparedTo(i)};function x$(r){let e=r?(t,i,n,s,a)=>t.exponentiatedBy(2).isLessThanOrEqualTo(s.minus(i).exponentiatedBy(2).plus(a.minus(n).exponentiatedBy(2)).times(r)):iB(!1);return(t,i,n)=>{let s=t.x,a=t.y,c=n.x,d=n.y,p=a.minus(d).times(i.x.minus(c)).minus(s.minus(c).times(i.y.minus(d)));return e(p,s,a,c,d)?0:p.comparedTo(0)}}var b$=r=>r,v$=r=>{if(r){let e=new jx(HT(r)),t=new jx(HT(r)),i=(s,a)=>a.addAndReturn(s),n=s=>({x:i(s.x,e),y:i(s.y,t)});return n({x:new Kc(0),y:new Kc(0)}),n}return b$},WT=r=>({set:e=>{sh=WT(e)},reset:()=>WT(r),compare:HT(r),snap:v$(r),orient:x$(r)}),sh=WT(),Ag=(r,e)=>r.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(r.ur.x)&&r.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(r.ur.y),$T=(r,e)=>{if(e.ur.x.isLessThan(r.ll.x)||r.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(r.ll.y)||r.ur.y.isLessThan(e.ll.y))return null;let t=r.ll.x.isLessThan(e.ll.x)?e.ll.x:r.ll.x,i=r.ur.x.isLessThan(e.ur.x)?r.ur.x:e.ur.x,n=r.ll.y.isLessThan(e.ll.y)?e.ll.y:r.ll.y,s=r.ur.y.isLessThan(e.ur.y)?r.ur.y:e.ur.y;return{ll:{x:t,y:n},ur:{x:i,y:s}}},kx=(r,e)=>r.x.times(e.y).minus(r.y.times(e.x)),nB=(r,e)=>r.x.times(e.x).plus(r.y.times(e.y)),Gx=r=>nB(r,r).sqrt(),w$=(r,e,t)=>{let i={x:e.x.minus(r.x),y:e.y.minus(r.y)},n={x:t.x.minus(r.x),y:t.y.minus(r.y)};return kx(n,i).div(Gx(n)).div(Gx(i))},T$=(r,e,t)=>{let i={x:e.x.minus(r.x),y:e.y.minus(r.y)},n={x:t.x.minus(r.x),y:t.y.minus(r.y)};return nB(n,i).div(Gx(n)).div(Gx(i))},DR=(r,e,t)=>e.y.isZero()?null:{x:r.x.plus(e.x.div(e.y).times(t.minus(r.y))),y:t},kR=(r,e,t)=>e.x.isZero()?null:{x:t,y:r.y.plus(e.y.div(e.x).times(t.minus(r.x)))},E$=(r,e,t,i)=>{if(e.x.isZero())return kR(t,i,r.x);if(i.x.isZero())return kR(r,e,t.x);if(e.y.isZero())return DR(t,i,r.y);if(i.y.isZero())return DR(r,e,t.y);let n=kx(e,i);if(n.isZero())return null;let s={x:t.x.minus(r.x),y:t.y.minus(r.y)},a=kx(s,e).div(n),c=kx(s,i).div(n),d=r.x.plus(c.times(e.x)),p=t.x.plus(a.times(i.x)),b=r.y.plus(c.times(e.y)),T=t.y.plus(a.times(i.y)),B=d.plus(p).div(2),z=b.plus(T).div(2);return{x:B,y:z}},Zc=class sB{constructor(e,t){xr(this,"point"),xr(this,"isLeft"),xr(this,"segment"),xr(this,"otherSE"),xr(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}static compare(e,t){let i=sB.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Wx.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");let t=e.point.events;for(let i=0,n=t.length;i<n;i++){let s=t[i];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){let e=this.point.events.length;for(let t=0;t<e;t++){let i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let n=t+1;n<e;n++){let s=this.point.events[n];s.consumedBy===void 0&&i.otherSE.point.events===s.otherSE.point.events&&i.segment.consume(s.segment)}}}getAvailableLinkedEvents(){let e=[];for(let t=0,i=this.point.events.length;t<i;t++){let n=this.point.events[t];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){let t=new Map,i=n=>{let s=n.otherSE;t.set(n,{sine:w$(this.point,e.point,s.point),cosine:T$(this.point,e.point,s.point)})};return(n,s)=>{t.has(n)||i(n),t.has(s)||i(s);let{sine:a,cosine:c}=t.get(n),{sine:d,cosine:p}=t.get(s);return a.isGreaterThanOrEqualTo(0)&&d.isGreaterThanOrEqualTo(0)?c.isLessThan(p)?1:c.isGreaterThan(p)?-1:0:a.isLessThan(0)&&d.isLessThan(0)?c.isLessThan(p)?-1:c.isGreaterThan(p)?1:0:d.isLessThan(a)?-1:d.isGreaterThan(a)?1:0}}},S$=class qT{constructor(e){xr(this,"events"),xr(this,"poly"),xr(this,"_isExteriorRing"),xr(this,"_enclosingRing"),this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}static factory(e){let t=[];for(let i=0,n=e.length;i<n;i++){let s=e[i];if(!s.isInResult()||s.ringOut)continue;let a=null,c=s.leftSE,d=s.rightSE,p=[c],b=c.point,T=[];for(;a=c,c=d,p.push(c),c.point!==b;)for(;;){let B=c.getAvailableLinkedEvents();if(B.length===0){let Z=p[0].point,q=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${Z.x}, ${Z.y}]. Last matching segment found ends at [${q.x}, ${q.y}].`)}if(B.length===1){d=B[0].otherSE;break}let z=null;for(let Z=0,q=T.length;Z<q;Z++)if(T[Z].point===c.point){z=Z;break}if(z!==null){let Z=T.splice(z)[0],q=p.splice(Z.index);q.unshift(q[0].otherSE),t.push(new qT(q.reverse()));continue}T.push({index:p.length,point:c.point});let G=c.getLeftmostComparator(a);d=B.sort(G)[0].otherSE;break}t.push(new qT(p))}return t}getGeom(){let e=this.events[0].point,t=[e];for(let p=1,b=this.events.length-1;p<b;p++){let T=this.events[p].point,B=this.events[p+1].point;sh.orient(T,e,B)!==0&&(t.push(T),e=T)}if(t.length===1)return null;let i=t[0],n=t[1];sh.orient(i,e,n)===0&&t.shift(),t.push(t[0]);let s=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,d=[];for(let p=a;p!=c;p+=s)d.push([t[p].x.toNumber(),t[p].y.toNumber()]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){let e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,t;let i=this.events[0];for(let a=1,c=this.events.length;a<c;a++){let d=this.events[a];Zc.compare(i,d)>0&&(i=d)}let n=i.segment.prevInResult(),s=n?n.prevInResult():null;for(;;){if(!n)return null;if(!s)return n.ringOut;if(s.ringOut!==n.ringOut)return((e=s.ringOut)==null?void 0:e.enclosingRing())!==n.ringOut?n.ringOut:(t=n.ringOut)==null?void 0:t.enclosingRing();n=s.prevInResult(),s=n?n.prevInResult():null}}},FR=class{constructor(r){xr(this,"exteriorRing"),xr(this,"interiorRings"),this.exteriorRing=r,r.poly=this,this.interiorRings=[]}addInterior(r){this.interiorRings.push(r),r.poly=this}getGeom(){let r=this.exteriorRing.getGeom();if(r===null)return null;let e=[r];for(let t=0,i=this.interiorRings.length;t<i;t++){let n=this.interiorRings[t].getGeom();n!==null&&e.push(n)}return e}},C$=class{constructor(r){xr(this,"rings"),xr(this,"polys"),this.rings=r,this.polys=this._composePolys(r)}getGeom(){let r=[];for(let e=0,t=this.polys.length;e<t;e++){let i=this.polys[e].getGeom();i!==null&&r.push(i)}return r}_composePolys(r){var e;let t=[];for(let i=0,n=r.length;i<n;i++){let s=r[i];if(!s.poly)if(s.isExteriorRing())t.push(new FR(s));else{let a=s.enclosingRing();a!=null&&a.poly||t.push(new FR(a)),(e=a?.poly)==null||e.addInterior(s)}}return t}},I$=class{constructor(r,e=Wx.compare){xr(this,"queue"),xr(this,"tree"),xr(this,"segments"),this.queue=r,this.tree=new jx(e),this.segments=[]}process(r){let e=r.segment,t=[];if(r.consumedBy)return r.isLeft?this.queue.delete(r.otherSE):this.tree.delete(e),t;r.isLeft&&this.tree.add(e);let i=e,n=e;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(r.isLeft){let s=null;if(i){let c=i.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(s=c),!i.isAnEndpoint(c))){let d=this._splitSafely(i,c);for(let p=0,b=d.length;p<b;p++)t.push(d[p])}}let a=null;if(n){let c=n.getIntersection(e);if(c!==null&&(e.isAnEndpoint(c)||(a=c),!n.isAnEndpoint(c))){let d=this._splitSafely(n,c);for(let p=0,b=d.length;p<b;p++)t.push(d[p])}}if(s!==null||a!==null){let c=null;s===null?c=a:a===null?c=s:c=Zc.comparePoints(s,a)<=0?s:a,this.queue.delete(e.rightSE),t.push(e.rightSE);let d=e.split(c);for(let p=0,b=d.length;p<b;p++)t.push(d[p])}t.length>0?(this.tree.delete(e),t.push(r)):(this.segments.push(e),e.prev=i)}else{if(i&&n){let s=i.getIntersection(n);if(s!==null){if(!i.isAnEndpoint(s)){let a=this._splitSafely(i,s);for(let c=0,d=a.length;c<d;c++)t.push(a[c])}if(!n.isAnEndpoint(s)){let a=this._splitSafely(n,s);for(let c=0,d=a.length;c<d;c++)t.push(a[c])}}}this.tree.delete(e)}return t}_splitSafely(r,e){this.tree.delete(r);let t=r.rightSE;this.queue.delete(t);let i=r.split(e);return i.push(t),r.consumedBy===void 0&&this.tree.add(r),i}},P$=class{constructor(){xr(this,"type"),xr(this,"numMultiPolys")}run(r,e,t){gg.type=r;let i=[new zR(e,!0)];for(let d=0,p=t.length;d<p;d++)i.push(new zR(t[d],!1));if(gg.numMultiPolys=i.length,gg.type==="difference"){let d=i[0],p=1;for(;p<i.length;)$T(i[p].bbox,d.bbox)!==null?p++:i.splice(p,1)}if(gg.type==="intersection")for(let d=0,p=i.length;d<p;d++){let b=i[d];for(let T=d+1,B=i.length;T<B;T++)if($T(b.bbox,i[T].bbox)===null)return[]}let n=new jx(Zc.compare);for(let d=0,p=i.length;d<p;d++){let b=i[d].getSweepEvents();for(let T=0,B=b.length;T<B;T++)n.add(b[T])}let s=new I$(n),a=null;for(n.size!=0&&(a=n.first(),n.delete(a));a;){let d=s.process(a);for(let p=0,b=d.length;p<b;p++){let T=d[p];T.consumedBy===void 0&&n.add(T)}n.size!=0?(a=n.first(),n.delete(a)):a=null}sh.reset();let c=S$.factory(s.segments);return new C$(c).getGeom()}},gg=new P$,Hx=gg,M$=0,Wx=class Fx{constructor(e,t,i,n){xr(this,"id"),xr(this,"leftSE"),xr(this,"rightSE"),xr(this,"rings"),xr(this,"windings"),xr(this,"ringOut"),xr(this,"consumedBy"),xr(this,"prev"),xr(this,"_prevInResult"),xr(this,"_beforeState"),xr(this,"_afterState"),xr(this,"_isInResult"),this.id=++M$,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=n}static compare(e,t){let i=e.leftSE.point.x,n=t.leftSE.point.x,s=e.rightSE.point.x,a=t.rightSE.point.x;if(a.isLessThan(i))return 1;if(s.isLessThan(n))return-1;let c=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,b=t.rightSE.point.y;if(i.isLessThan(n)){if(d.isLessThan(c)&&d.isLessThan(p))return 1;if(d.isGreaterThan(c)&&d.isGreaterThan(p))return-1;let T=e.comparePoint(t.leftSE.point);if(T<0)return 1;if(T>0)return-1;let B=t.comparePoint(e.rightSE.point);return B!==0?B:-1}if(i.isGreaterThan(n)){if(c.isLessThan(d)&&c.isLessThan(b))return-1;if(c.isGreaterThan(d)&&c.isGreaterThan(b))return 1;let T=t.comparePoint(e.leftSE.point);if(T!==0)return T;let B=e.comparePoint(t.rightSE.point);return B<0?1:B>0?-1:1}if(c.isLessThan(d))return-1;if(c.isGreaterThan(d))return 1;if(s.isLessThan(a)){let T=t.comparePoint(e.rightSE.point);if(T!==0)return T}if(s.isGreaterThan(a)){let T=e.comparePoint(t.rightSE.point);if(T<0)return 1;if(T>0)return-1}if(!s.eq(a)){let T=p.minus(c),B=s.minus(i),z=b.minus(d),G=a.minus(n);if(T.isGreaterThan(B)&&z.isLessThan(G))return 1;if(T.isLessThan(B)&&z.isGreaterThan(G))return-1}return s.isGreaterThan(a)?1:s.isLessThan(a)||p.isLessThan(b)?-1:p.isGreaterThan(b)?1:e.id<t.id?-1:e.id>t.id?1:0}static fromRing(e,t,i){let n,s,a,c=Zc.comparePoints(e,t);if(c<0)n=e,s=t,a=1;else if(c>0)n=t,s=e,a=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);let d=new Zc(n,!0),p=new Zc(s,!1);return new Fx(d,p,[i],[a])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){let e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return sh.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){let t=this.bbox(),i=e.bbox(),n=$T(t,i);if(n===null)return null;let s=this.leftSE.point,a=this.rightSE.point,c=e.leftSE.point,d=e.rightSE.point,p=Ag(t,c)&&this.comparePoint(c)===0,b=Ag(i,s)&&e.comparePoint(s)===0,T=Ag(t,d)&&this.comparePoint(d)===0,B=Ag(i,a)&&e.comparePoint(a)===0;if(b&&p)return B&&!T?a:!B&&T?d:null;if(b)return T&&s.x.eq(d.x)&&s.y.eq(d.y)?null:s;if(p)return B&&a.x.eq(c.x)&&a.y.eq(c.y)?null:c;if(B&&T)return null;if(B)return a;if(T)return d;let z=E$(s,this.vector(),c,e.vector());return z===null||!Ag(n,z)?null:sh.snap(z)}split(e){let t=[],i=e.events!==void 0,n=new Zc(e,!0),s=new Zc(e,!1),a=this.rightSE;this.replaceRightSE(s),t.push(s),t.push(n);let c=new Fx(n,a,this.rings.slice(),this.windings.slice());return Zc.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),Zc.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(n.checkForConsuming(),s.checkForConsuming()),t}swapEvents(){let e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;let n=Fx.compare(t,i);if(n!==0){if(n>0){let s=t;t=i,i=s}if(t.prev===i){let s=t;t=i,i=s}for(let s=0,a=i.rings.length;s<a;s++){let c=i.rings[s],d=i.windings[s],p=t.rings.indexOf(c);p===-1?(t.rings.push(c),t.windings.push(d)):t.windings[p]+=d}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{let e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;let e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};let t=this._afterState.rings,i=this._afterState.windings,n=this._afterState.multiPolys;for(let c=0,d=this.rings.length;c<d;c++){let p=this.rings[c],b=this.windings[c],T=t.indexOf(p);T===-1?(t.push(p),i.push(b)):i[T]+=b}let s=[],a=[];for(let c=0,d=t.length;c<d;c++){if(i[c]===0)continue;let p=t[c],b=p.poly;if(a.indexOf(b)===-1)if(p.isExterior)s.push(b);else{a.indexOf(b)===-1&&a.push(b);let T=s.indexOf(p.poly);T!==-1&&s.splice(T,1)}}for(let c=0,d=s.length;c<d;c++){let p=s[c].multiPoly;n.indexOf(p)===-1&&n.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;let e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Hx.type){case"union":{let i=e.length===0,n=t.length===0;this._isInResult=i!==n;break}case"intersection":{let i,n;e.length<t.length?(i=e.length,n=t.length):(i=t.length,n=e.length),this._isInResult=n===Hx.numMultiPolys&&i<n;break}case"xor":{let i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{let i=n=>n.length===1&&n[0].isSubject;this._isInResult=i(e)!==i(t);break}}return this._isInResult}},NR=class{constructor(r,e,t){if(xr(this,"poly"),xr(this,"isExterior"),xr(this,"segments"),xr(this,"bbox"),!Array.isArray(r)||r.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof r[0][0]!="number"||typeof r[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let i=sh.snap({x:new Kc(r[0][0]),y:new Kc(r[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let n=i;for(let s=1,a=r.length;s<a;s++){if(typeof r[s][0]!="number"||typeof r[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let c=sh.snap({x:new Kc(r[s][0]),y:new Kc(r[s][1])});c.x.eq(n.x)&&c.y.eq(n.y)||(this.segments.push(Wx.fromRing(n,c,this)),c.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.x),c.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.y),c.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.x),c.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.y),n=c)}(!i.x.eq(n.x)||!i.y.eq(n.y))&&this.segments.push(Wx.fromRing(n,i,this))}getSweepEvents(){let r=[];for(let e=0,t=this.segments.length;e<t;e++){let i=this.segments[e];r.push(i.leftSE),r.push(i.rightSE)}return r}},R$=class{constructor(r,e){if(xr(this,"multiPoly"),xr(this,"exteriorRing"),xr(this,"interiorRings"),xr(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new NR(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,i=r.length;t<i;t++){let n=new NR(r[t],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=e}getSweepEvents(){let r=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){let i=this.interiorRings[e].getSweepEvents();for(let n=0,s=i.length;n<s;n++)r.push(i[n])}return r}},zR=class{constructor(r,e){if(xr(this,"isSubject"),xr(this,"polys"),xr(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof r[0][0][0]=="number"&&(r=[r])}catch{}this.polys=[],this.bbox={ll:{x:new Kc(Number.POSITIVE_INFINITY),y:new Kc(Number.POSITIVE_INFINITY)},ur:{x:new Kc(Number.NEGATIVE_INFINITY),y:new Kc(Number.NEGATIVE_INFINITY)}};for(let t=0,i=r.length;t<i;t++){let n=new R$(r[t],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=e}getSweepEvents(){let r=[];for(let e=0,t=this.polys.length;e<t;e++){let i=this.polys[e].getSweepEvents();for(let n=0,s=i.length;n<s;n++)r.push(i[n])}return r}},B$=(r,...e)=>Hx.run("union",r,e),L$=(r,...e)=>Hx.run("difference",r,e);sh.set;function oB(r,e,t){if(r!==null)for(var i,n,s,a,c,d,p,b=0,T=0,B,z=r.type,G=z==="FeatureCollection",Z=z==="Feature",q=G?r.features.length:1,re=0;re<q;re++){p=G?r.features[re].geometry:Z?r.geometry:r,B=p?p.type==="GeometryCollection":!1,c=B?p.geometries.length:1;for(var ee=0;ee<c;ee++){var ae=0,me=0;if(a=B?p.geometries[ee]:p,a!==null){d=a.coordinates;var Le=a.type;switch(b=0,Le){case null:break;case"Point":if(e(d,T,re,ae,me)===!1)return!1;T++,ae++;break;case"LineString":case"MultiPoint":for(i=0;i<d.length;i++){if(e(d[i],T,re,ae,me)===!1)return!1;T++,Le==="MultiPoint"&&ae++}Le==="LineString"&&ae++;break;case"Polygon":case"MultiLineString":for(i=0;i<d.length;i++){for(n=0;n<d[i].length-b;n++){if(e(d[i][n],T,re,ae,me)===!1)return!1;T++}Le==="MultiLineString"&&ae++,Le==="Polygon"&&me++}Le==="Polygon"&&ae++;break;case"MultiPolygon":for(i=0;i<d.length;i++){for(me=0,n=0;n<d[i].length;n++){for(s=0;s<d[i][n].length-b;s++){if(e(d[i][n][s],T,re,ae,me)===!1)return!1;T++}me++}ae++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(oB(a.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function KT(r,e){var t,i,n,s,a,c,d,p,b,T,B=0,z=r.type==="FeatureCollection",G=r.type==="Feature",Z=z?r.features.length:1;for(t=0;t<Z;t++){for(c=z?r.features[t].geometry:G?r.geometry:r,p=z?r.features[t].properties:G?r.properties:{},b=z?r.features[t].bbox:G?r.bbox:void 0,T=z?r.features[t].id:G?r.id:void 0,d=c?c.type==="GeometryCollection":!1,a=d?c.geometries.length:1,n=0;n<a;n++){if(s=d?c.geometries[n]:c,s===null){if(e(null,B,p,b,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(s,B,p,b,T)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(e(s.geometries[i],B,p,b,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}B++}}function O$(r,e){KT(r,function(t,i,n,s,a){var c=t===null?null:t.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return e(bg(t,n,{bbox:s,id:a}),i,0)===!1?!1:void 0}var d;switch(c){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var b=t.coordinates[p],T={type:d,coordinates:b};if(e(bg(T,n),i,p)===!1)return!1}})}function D$(r,e={}){let t=[];if(KT(r,n=>{t.push(n.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");let i=B$(t[0],...t.slice(1));return i.length===0?null:i.length===1?YT(i[0],e.properties):eB(i,e.properties)}var aB=D$;function k$(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;let t=[1/0,1/0,-1/0,-1/0];return oB(r,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var UR=k$;function F$(r){let e=[];if(KT(r,n=>{e.push(n.coordinates)}),e.length<2)throw new Error("Must have at least two features");let t=r.features[0].properties||{},i=L$(e[0],...e.slice(1));return i.length===0?null:i.length===1?YT(i[0],t):eB(i,t)}var N$=F$;function z$(r){if(!r)throw new Error("geojson is required");var e=[];return O$(r,function(t){e.push(t)}),vg(e)}var U$=z$;function VR(r,e){let t=N$(vg([YT([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};let i=Vx(UR(r)),n=(i[2]-i[0])/360/1e3,s=i[0]<-180,a=i[2]>180,c=U$(r);if(c.features.length>1&&(s||a))for(let d of c.features){let p=Vx(UR(d));if(a&&p[0]<-180+n)for(let b of d.geometry.coordinates)for(let T of b)T[0]+=360-n;if(s&&p[2]>180-n)for(let b of d.geometry.coordinates)for(let T of b)T[0]-=360-n}e(vg([c.features.length<2?r:aB(c)??r,t]))}var jR={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Bx="mtlr-gc-full-geom",GR="mtlr-gc-full-geom-fill",HR="mtlr-gc-full-geom-line";function V$(r,e,t=!0,i=!0,n={},s={},a=jR){let c,d=[],p,b,T;function B(){if(!r.loaded){r.once("load",B);return}let q=a?a===!0?jR:a:void 0;if(!(q!=null&&q.fill)&&!(q!=null&&q.line))return;let re=r.getSource(Bx);if(re)re.setData(T??vg([]));else if(T)r.addSource(Bx,{type:"geojson",data:T});else return;!r.getLayer(GR)&&q!=null&&q.fill&&r.addLayer({...q?.fill,id:GR,type:"fill",source:Bx}),!r.getLayer(HR)&&q!=null&&q.line&&r.addLayer({...q?.line,id:HR,type:"line",source:Bx})}function z(q){T=q,B()}r.on("styledata",()=>{setTimeout(()=>{T&&B()})});let G=q=>{c?.({type:"mapClick",coordinates:[q.lngLat.lng,q.lngLat.lat]})};function Z(q=!1){if(!e)throw new Error;let re=document.createElement("div");return q&&re.classList.add("marker-interactive"),new VT({props:{displayIn:"maplibre"},target:re}),new e.Marker({element:re,offset:[1,-13]})}return{setEventHandler(q){q?(c=q,r.on("click",G)):(c=void 0,r.off("click",G))},flyTo(q,re){r.flyTo({center:q,...re?{zoom:re}:{},...n})},fitBounds(q,re,ee){r.fitBounds([[q[0],q[1]],[q[2],q[3]]],{padding:re,...ee?{maxZoom:ee}:{},...s})},indicateReverse(q){r.getCanvasContainer().style.cursor=q?"crosshair":""},setReverseMarker(q){!e||!t||(b?q?b.setLngLat(q):(b.remove(),b=void 0):q&&(t instanceof Function?b=t(r)??void 0:(b=(typeof t=="object"?new e.Marker(t):Z()).setLngLat(q).addTo(r),b.getElement().classList.add("marker-reverse"))))},setFeatures(q,re,ee){for(let ae of d)ae.remove();if(d.length=0,z(void 0),!!e){e:if(re){let ae=!1;if(re.geometry.type==="GeometryCollection"){let me=re.geometry.geometries.filter(Le=>Le.type==="Polygon"||Le.type==="MultiPolygon");t:if(me.length>0){let Le=aB(vg(me.map(je=>bg(je))));if(!Le)break t;VR({...re,geometry:Le.geometry},z),ae=!0}else{let Le=re.geometry.geometries.filter(je=>je.type==="LineString"||je.type==="MultiLineString");Le.length>0&&(z({...re,geometry:{type:"GeometryCollection",geometries:Le}}),ae=!0)}}if(!ae){if(re.geometry.type==="Polygon"||re.geometry.type==="MultiPolygon")VR(re,z);else if(re.geometry.type==="LineString"||re.geometry.type==="MultiLineString"){z(re);break e}}if(!ee&&!re.geometry.type.endsWith("Point"))break e;if(t instanceof Function){let me=t(r,re);me&&d.push(me)}else t&&d.push(typeof t=="object"?new e.Marker(t):Z().setLngLat(re.center).addTo(r))}if(i)for(let ae of q??[]){if(ae===re)continue;let me;if(i instanceof Function){if(me=i(r,ae),!me)continue}else me=(typeof i=="object"?new e.Marker(i):Z(!0)).setLngLat(ae.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(ae.place_type[0]==="reverse"?ae.place_name:ae.place_name.replace(/,.*/,""))).addTo(r);let Le=me.getElement();Le.addEventListener("click",je=>{je.stopPropagation(),c?.({type:"markerClick",id:ae.id})}),Le.addEventListener("mouseenter",()=>{c?.({type:"markerMouseEnter",id:ae.id}),me.togglePopup()}),Le.addEventListener("mouseleave",()=>{c?.({type:"markerMouseLeave",id:ae.id}),me.togglePopup()}),d.push(me)}}},setSelectedMarker(q){p&&p.getElement().classList.toggle("marker-selected",!1),p=q>-1?d[q]:void 0,p?.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){let q=r.getCenter();return[r.getZoom(),q.lng,q.lat]}}}function j$(r,e,t){var i,n,s;class a{constructor(re,ee){xr(this,"type"),xr(this,"target"),this.type=ee,this.target=re}}class c extends a{constructor(re,ee){super(re,"select"),xr(this,"feature"),Object.assign(this,ee)}}class d extends a{constructor(re,ee){super(re,"featureslisted"),xr(this,"features"),this.features=ee}}class p extends a{constructor(re,ee){super(re,"featuresmarked"),xr(this,"features"),this.features=ee}}class b extends a{constructor(re,ee){super(re,"optionsvisibilitychange"),xr(this,"optionsVisible"),this.optionsVisible=ee}}class T extends a{constructor(re,ee){super(re,"pick"),xr(this,"feature"),this.feature=ee}}class B extends a{constructor(re,ee){super(re,"querychange"),xr(this,"query"),this.query=ee}}class z extends a{constructor(re,ee,ae){super(re,"response"),xr(this,"url"),xr(this,"featureCollection"),this.url=ee,this.featureCollection=ae}}class G extends a{constructor(re,ee){super(re,"reversetoggle"),xr(this,"reverse"),this.reverse=ee}}class Z extends r{constructor(re={}){super(),RT(this,i),RT(this,n),RT(this,s),Cx(this,n,re)}onAddInt(re){let ee=document.createElement("div");ee.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";let{marker:ae,showResultMarkers:me,flyTo:Le,fullGeometryStyle:je,...Je}=ds(this,n),J=typeof Le=="boolean"?{}:Le,te={mapController:V$(re,e,ae,me,J,J,je),flyTo:Le===void 0?!0:!!Le,apiKey:"",...t?.(re,ee),...Je};if(!te.apiKey)throw new Error("no apiKey provided");return Cx(this,i,new p$({target:ee,props:te})),ds(this,i).$on("select",X=>{this.fire(new c(this,X.detail))}),ds(this,i).$on("pick",X=>{this.fire(new T(this,X.detail.feature))}),ds(this,i).$on("featureslisted",X=>{this.fire(new d(this,X.detail.features))}),ds(this,i).$on("featuresmarked",X=>{this.fire(new p(this,X.detail.features))}),ds(this,i).$on("response",X=>{this.fire(new z(this,X.detail.url,X.detail.featureCollection))}),ds(this,i).$on("optionsvisibilitychange",X=>{this.fire(new b(this,X.detail.optionsVisible))}),ds(this,i).$on("reversetoggle",X=>{this.fire(new G(this,X.detail.reverse))}),ds(this,i).$on("querychange",X=>{this.fire(new B(this,X.detail.query))}),Cx(this,s,ee),ee}on(re,ee){return super.on(re,ee)}once(re,ee){return super.once(re,ee)}off(re,ee){return super.off(re,ee)}listens(re){return super.listens(re)}setOptions(re){var ee;Object.assign(ds(this,n),re);let{marker:ae,showResultMarkers:me,flyTo:Le,fullGeometryStyle:je,...Je}=ds(this,n);(ee=ds(this,i))==null||ee.$set(Je)}setQuery(re,ee=!0){var ae;(ae=ds(this,i))==null||ae.setQuery(re,ee)}clearMap(){var re;(re=ds(this,i))==null||re.clearMap()}clearList(){var re;(re=ds(this,i))==null||re.clearList()}setReverseMode(re){var ee;(ee=ds(this,i))==null||ee.$set({reverseActive:re})}focus(re){var ee;(ee=ds(this,i))==null||ee.focus(re)}blur(){var re;(re=ds(this,i))==null||re.blur()}onRemove(){var re,ee,ae;(re=ds(this,i))==null||re.$destroy(),Cx(this,i,void 0),(ae=(ee=ds(this,s))==null?void 0:ee.parentNode)==null||ae.removeChild(ds(this,s))}}return i=new WeakMap,n=new WeakMap,s=new WeakMap,{MapLibreBasedGeocodingControl:Z,events:{SelectEvent:c,FeaturesListedEvent:d,FeaturesMarkedEvent:p,OptionsVisibilityChangeEvent:b,PickEvent:T,QueryChangeEvent:B,ResponseEvent:z,ReverseToggleEvent:G}}}var{MapLibreBasedGeocodingControl:G$,events:Mf}=j$(ZT.Evented,ZT),$x=class extends G${onAdd(e){return super.onAddInt(e)}},U0e=Mf.SelectEvent,V0e=Mf.FeaturesListedEvent,j0e=Mf.FeaturesMarkedEvent,G0e=Mf.OptionsVisibilityChangeEvent,H0e=Mf.PickEvent,W0e=Mf.QueryChangeEvent,$0e=Mf.ResponseEvent,q0e=Mf.ReverseToggleEvent;var H$=Object.prototype.toString,ZA=Array.isArray||function(e){return H$.call(e)==="[object Array]"};function JT(r){return typeof r=="function"}function W$(r){return ZA(r)?"array":typeof r}function QT(r){return r.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function lB(r,e){return r!=null&&typeof r=="object"&&e in r}function $$(r,e){return r!=null&&typeof r!="object"&&r.hasOwnProperty&&r.hasOwnProperty(e)}var q$=RegExp.prototype.test;function Z$(r,e){return q$.call(r,e)}var X$=/\S/;function Y$(r){return!Z$(X$,r)}var K$={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Q$(r){return String(r).replace(/[&<>"'`=\/]/g,function(t){return K$[t]})}var J$=/\s*/,eq=/\s+/,cB=/\s*=/,tq=/\s*\}/,rq=/#|\^|\/|>|\{|&|=|!/;function iq(r,e){if(!r)return[];var t=!1,i=[],n=[],s=[],a=!1,c=!1,d="",p=0;function b(){if(a&&!c)for(;s.length;)delete n[s.pop()];else s=[];a=!1,c=!1}var T,B,z;function G(J){if(typeof J=="string"&&(J=J.split(eq,2)),!ZA(J)||J.length!==2)throw new Error("Invalid tags: "+J);T=new RegExp(QT(J[0])+"\\s*"),B=new RegExp("\\s*"+QT(J[1])),z=new RegExp("\\s*"+QT("}"+J[1]))}G(e||al.tags);for(var Z=new Tg(r),q,re,ee,ae,me,Le;!Z.eos();){if(q=Z.pos,ee=Z.scanUntil(T),ee)for(var je=0,Je=ee.length;je<Je;++je)ae=ee.charAt(je),Y$(ae)?(s.push(n.length),d+=ae):(c=!0,t=!0,d+=" "),n.push(["text",ae,q,q+1]),q+=1,ae===`
`&&(b(),d="",p=0,t=!1);if(!Z.scan(T))break;if(a=!0,re=Z.scan(rq)||"name",Z.scan(J$),re==="="?(ee=Z.scanUntil(cB),Z.scan(cB),Z.scanUntil(B)):re==="{"?(ee=Z.scanUntil(z),Z.scan(tq),Z.scanUntil(B),re="&"):ee=Z.scanUntil(B),!Z.scan(B))throw new Error("Unclosed tag at "+Z.pos);if(re==">"?me=[re,ee,q,Z.pos,d,p,t]:me=[re,ee,q,Z.pos],p++,n.push(me),re==="#"||re==="^")i.push(me);else if(re==="/"){if(Le=i.pop(),!Le)throw new Error('Unopened section "'+ee+'" at '+q);if(Le[1]!==ee)throw new Error('Unclosed section "'+Le[1]+'" at '+q)}else re==="name"||re==="{"||re==="&"?c=!0:re==="="&&G(ee)}if(b(),Le=i.pop(),Le)throw new Error('Unclosed section "'+Le[1]+'" at '+Z.pos);return sq(nq(n))}function nq(r){for(var e=[],t,i,n=0,s=r.length;n<s;++n)t=r[n],t&&(t[0]==="text"&&i&&i[0]==="text"?(i[1]+=t[1],i[3]=t[3]):(e.push(t),i=t));return e}function sq(r){for(var e=[],t=e,i=[],n,s,a=0,c=r.length;a<c;++a)switch(n=r[a],n[0]){case"#":case"^":t.push(n),i.push(n),t=n[4]=[];break;case"/":s=i.pop(),s[5]=n[2],t=i.length>0?i[i.length-1][4]:e;break;default:t.push(n)}return e}function Tg(r){this.string=r,this.tail=r,this.pos=0}Tg.prototype.eos=function(){return this.tail===""};Tg.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var i=t[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i};Tg.prototype.scanUntil=function(e){var t=this.tail.search(e),i;switch(t){case-1:i=this.tail,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=i.length,i};function qA(r,e){this.view=r,this.cache={".":this.view},this.parent=e}qA.prototype.push=function(e){return new qA(e,this)};qA.prototype.lookup=function(e){var t=this.cache,i;if(t.hasOwnProperty(e))i=t[e];else{for(var n=this,s,a,c,d=!1;n;){if(e.indexOf(".")>0)for(s=n.view,a=e.split("."),c=0;s!=null&&c<a.length;)c===a.length-1&&(d=lB(s,a[c])||$$(s,a[c])),s=s[a[c++]];else s=n.view[e],d=lB(n.view,e);if(d){i=s;break}n=n.parent}t[e]=i}return JT(i)&&(i=i.call(this.view)),i};function $o(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}$o.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};$o.prototype.parse=function(e,t){var i=this.templateCache,n=e+":"+(t||al.tags).join(":"),s=typeof i<"u",a=s?i.get(n):void 0;return a==null&&(a=iq(e,t),s&&i.set(n,a)),a};$o.prototype.render=function(e,t,i,n){var s=this.getConfigTags(n),a=this.parse(e,s),c=t instanceof qA?t:new qA(t,void 0);return this.renderTokens(a,c,i,e,n)};$o.prototype.renderTokens=function(e,t,i,n,s){for(var a="",c,d,p,b=0,T=e.length;b<T;++b)p=void 0,c=e[b],d=c[0],d==="#"?p=this.renderSection(c,t,i,n,s):d==="^"?p=this.renderInverted(c,t,i,n,s):d===">"?p=this.renderPartial(c,t,i,s):d==="&"?p=this.unescapedValue(c,t):d==="name"?p=this.escapedValue(c,t,s):d==="text"&&(p=this.rawValue(c)),p!==void 0&&(a+=p);return a};$o.prototype.renderSection=function(e,t,i,n,s){var a=this,c="",d=t.lookup(e[1]);function p(B){return a.render(B,t,i,s)}if(d){if(ZA(d))for(var b=0,T=d.length;b<T;++b)c+=this.renderTokens(e[4],t.push(d[b]),i,n,s);else if(typeof d=="object"||typeof d=="string"||typeof d=="number")c+=this.renderTokens(e[4],t.push(d),i,n,s);else if(JT(d)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");d=d.call(t.view,n.slice(e[3],e[5]),p),d!=null&&(c+=d)}else c+=this.renderTokens(e[4],t,i,n,s);return c}};$o.prototype.renderInverted=function(e,t,i,n,s){var a=t.lookup(e[1]);if(!a||ZA(a)&&a.length===0)return this.renderTokens(e[4],t,i,n,s)};$o.prototype.indentPartial=function(e,t,i){for(var n=t.replace(/[^ \t]/g,""),s=e.split(`
`),a=0;a<s.length;a++)s[a].length&&(a>0||!i)&&(s[a]=n+s[a]);return s.join(`
`)};$o.prototype.renderPartial=function(e,t,i,n){if(i){var s=this.getConfigTags(n),a=JT(i)?i(e[1]):i[e[1]];if(a!=null){var c=e[6],d=e[5],p=e[4],b=a;d==0&&p&&(b=this.indentPartial(a,p,c));var T=this.parse(b,s);return this.renderTokens(T,t,i,b,n)}}};$o.prototype.unescapedValue=function(e,t){var i=t.lookup(e[1]);if(i!=null)return i};$o.prototype.escapedValue=function(e,t,i){var n=this.getConfigEscape(i)||al.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&n===al.escape?String(s):n(s)};$o.prototype.rawValue=function(e){return e[1]};$o.prototype.getConfigTags=function(e){return ZA(e)?e:e&&typeof e=="object"?e.tags:void 0};$o.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!ZA(e))return e.escape};var al={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(r){wg.templateCache=r},get templateCache(){return wg.templateCache}},wg=new $o;al.clearCache=function(){return wg.clearCache()};al.parse=function(e,t){return wg.parse(e,t)};al.render=function(e,t,i,n){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+W$(e)+'" was given as the first argument for mustache#render(template, view, partials)');return wg.render(e,t,i,n)};al.escape=Q$;al.Scanner=Tg;al.Context=qA;al.Writer=$o;var uB=al;var KA=Math.pow,bo=(r,e,t)=>new Promise((i,n)=>{var s=d=>{try{c(t.next(d))}catch(p){n(p)}},a=d=>{try{c(t.throw(d))}catch(p){n(p)}},c=d=>d.done?i(d.value):Promise.resolve(d.value).then(s,a);c((t=t.apply(r,e)).next())}),Na=Uint8Array,YA=Uint16Array,oq=Int32Array,dB=new Na([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pB=new Na([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),aq=new Na([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),AB=function(r,e){for(var t=new YA(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var n=new oq(t[30]),i=1;i<30;++i)for(var s=t[i];s<t[i+1];++s)n[s]=s-t[i]<<5|i;return{b:t,r:n}},mB=AB(dB,2),gB=mB.b,lq=mB.r;gB[28]=258,lq[258]=28;var _B=AB(pB,0),cq=_B.b,ume=_B.r,rE=new YA(32768);for(en=0;en<32768;++en)ah=(en&43690)>>1|(en&21845)<<1,ah=(ah&52428)>>2|(ah&13107)<<2,ah=(ah&61680)>>4|(ah&3855)<<4,rE[en]=((ah&65280)>>8|(ah&255)<<8)>>1;var ah,en,Cg=function(r,e,t){for(var i=r.length,n=0,s=new YA(e);n<i;++n)r[n]&&++s[r[n]-1];var a=new YA(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var c;if(t){c=new YA(1<<e);var d=15-e;for(n=0;n<i;++n)if(r[n])for(var p=n<<4|r[n],b=e-r[n],T=a[r[n]-1]++<<b,B=T|(1<<b)-1;T<=B;++T)c[rE[T]>>d]=p}else for(c=new YA(i),n=0;n<i;++n)r[n]&&(c[n]=rE[a[r[n]-1]++]>>15-r[n]);return c},Ig=new Na(288);for(en=0;en<144;++en)Ig[en]=8;var en;for(en=144;en<256;++en)Ig[en]=9;var en;for(en=256;en<280;++en)Ig[en]=7;var en;for(en=280;en<288;++en)Ig[en]=8;var en,yB=new Na(32);for(en=0;en<32;++en)yB[en]=5;var en,uq=Cg(Ig,9,1),hq=Cg(yB,5,1),eE=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},nc=function(r,e,t){var i=e/8|0;return(r[i]|r[i+1]<<8)>>(e&7)&t},tE=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},fq=function(r){return(r+7)/8|0},dq=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var i=new Na(t-e);return i.set(r.subarray(e,t)),i},pq=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Fa=function(r,e,t){var i=new Error(e||pq[r]);if(i.code=r,Error.captureStackTrace&&Error.captureStackTrace(i,Fa),!t)throw i;return i},sE=function(r,e,t,i){var n=r.length,s=i?i.length:0;if(!n||e.f&&!e.l)return t||new Na(0);var a=!t||e.i!=2,c=e.i;t||(t=new Na(n*3));var d=function(Jr){var Ri=t.length;if(Jr>Ri){var li=new Na(Math.max(Ri*2,Jr));li.set(t),t=li}},p=e.f||0,b=e.p||0,T=e.b||0,B=e.l,z=e.d,G=e.m,Z=e.n,q=n*8;do{if(!B){p=nc(r,b,1);var re=nc(r,b+1,3);if(b+=3,re)if(re==1)B=uq,z=hq,G=9,Z=5;else if(re==2){var Le=nc(r,b,31)+257,je=nc(r,b+10,15)+4,Je=Le+nc(r,b+5,31)+1;b+=14;for(var J=new Na(Je),te=new Na(19),X=0;X<je;++X)te[aq[X]]=nc(r,b+X*3,7);b+=je*3;for(var ye=eE(te),_e=(1<<ye)-1,Oe=Cg(te,ye,1),X=0;X<Je;){var ve=Oe[nc(r,b,_e)];b+=ve&15;var ee=ve>>4;if(ee<16)J[X++]=ee;else{var De=0,Xe=0;for(ee==16?(Xe=3+nc(r,b,3),b+=2,De=J[X-1]):ee==17?(Xe=3+nc(r,b,7),b+=3):ee==18&&(Xe=11+nc(r,b,127),b+=7);Xe--;)J[X++]=De}}var rt=J.subarray(0,Le),tt=J.subarray(Le);G=eE(rt),Z=eE(tt),B=Cg(rt,G,1),z=Cg(tt,Z,1)}else Fa(1);else{var ee=fq(b)+4,ae=r[ee-4]|r[ee-3]<<8,me=ee+ae;if(me>n){c&&Fa(0);break}a&&d(T+ae),t.set(r.subarray(ee,me),T),e.b=T+=ae,e.p=b=me*8,e.f=p;continue}if(b>q){c&&Fa(0);break}}a&&d(T+131072);for(var yt=(1<<G)-1,Xt=(1<<Z)-1,jt=b;;jt=b){var De=B[tE(r,b)&yt],fr=De>>4;if(b+=De&15,b>q){c&&Fa(0);break}if(De||Fa(2),fr<256)t[T++]=fr;else if(fr==256){jt=b,B=null;break}else{var qt=fr-254;if(fr>264){var X=fr-257,Ot=dB[X];qt=nc(r,b,(1<<Ot)-1)+gB[X],b+=Ot}var wr=z[tE(r,b)&Xt],Lr=wr>>4;wr||Fa(3),b+=wr&15;var tt=cq[Lr];if(Lr>3){var Ot=pB[Lr];tt+=tE(r,b)&(1<<Ot)-1,b+=Ot}if(b>q){c&&Fa(0);break}a&&d(T+131072);var Or=T+qt;if(T<tt){var Zr=s-tt,Oi=Math.min(tt,Or);for(Zr+T<0&&Fa(3);T<Oi;++T)t[T]=i[Zr+T]}for(;T<Or;T+=4)t[T]=t[T-tt],t[T+1]=t[T+1-tt],t[T+2]=t[T+2-tt],t[T+3]=t[T+3-tt];T=Or}}e.l=B,e.p=jt,e.b=T,e.f=p,B&&(p=1,e.m=G,e.d=z,e.n=Z)}while(!p);return T==t.length?t:dq(t,0,T)},Aq=new Na(0),mq=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Fa(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!r[t++]);return t+(e&2)},gq=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},_q=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Fa(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Fa(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function yq(r,e){return sE(r,{i:2},e&&e.out,e&&e.dictionary)}function xq(r,e){var t=mq(r);return t+8>r.length&&Fa(6,"invalid gzip data"),sE(r.subarray(t,-8),{i:2},e&&e.out||new Na(gq(r)),e&&e.dictionary)}function bq(r,e){return sE(r.subarray(_q(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function iE(r,e){return r[0]==31&&r[1]==139&&r[2]==8?xq(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?yq(r,e):bq(r,e)}var vq=typeof TextDecoder<"u"&&new TextDecoder,wq=0;try{vq.decode(Aq,{stream:!0}),wq=1}catch{}var xB=(r,e)=>r*KA(2,e),Eg=(r,e)=>Math.floor(r/KA(2,e)),qx=(r,e)=>xB(r.getUint16(e+1,!0),8)+r.getUint8(e),bB=(r,e)=>xB(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),Tq=(r,e,t,i,n)=>{if(r!==i.getUint8(n))return r-i.getUint8(n);let s=qx(i,n+1);if(e!==s)return e-s;let a=qx(i,n+4);return t!==a?t-a:0},Eq=(r,e,t,i)=>{let n=vB(r,e|128,t,i);return n?{z:e,x:t,y:i,offset:n[0],length:n[1],isDir:!0}:null},hB=(r,e,t,i)=>{let n=vB(r,e,t,i);return n?{z:e,x:t,y:i,offset:n[0],length:n[1],isDir:!1}:null},vB=(r,e,t,i)=>{let n=0,s=r.byteLength/17-1;for(;n<=s;){let a=s+n>>1,c=Tq(e,t,i,r,a*17);if(c>0)n=a+1;else if(c<0)s=a-1;else return[bB(r,a*17+7),r.getUint32(a*17+13,!0)]}return null},Sq=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,wB=(r,e)=>{let t=r.getUint8(e*17);return{z:t&127,x:qx(r,e*17+1),y:qx(r,e*17+4),offset:bB(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},fB=r=>{let e=[],t=new DataView(r);for(let i=0;i<t.byteLength/17;i++)e.push(wB(t,i));return Cq(e)},Cq=r=>{r.sort(Sq);let e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let i=0;i<r.length;i++){let n=r[i],s=n.z;n.isDir&&(s=s|128),t[i*17]=s,t[i*17+1]=n.x&255,t[i*17+2]=n.x>>8&255,t[i*17+3]=n.x>>16&255,t[i*17+4]=n.y&255,t[i*17+5]=n.y>>8&255,t[i*17+6]=n.y>>16&255,t[i*17+7]=n.offset&255,t[i*17+8]=Eg(n.offset,8)&255,t[i*17+9]=Eg(n.offset,16)&255,t[i*17+10]=Eg(n.offset,24)&255,t[i*17+11]=Eg(n.offset,32)&255,t[i*17+12]=Eg(n.offset,48)&255,t[i*17+13]=n.length&255,t[i*17+14]=n.length>>8&255,t[i*17+15]=n.length>>16&255,t[i*17+16]=n.length>>24&255}return e},Iq=(r,e)=>{if(r.byteLength<17)return null;let t=r.byteLength/17,i=wB(r,t-1);if(i.isDir){let n=i.z,s=e.z-n,a=Math.trunc(e.x/(1<<s)),c=Math.trunc(e.y/(1<<s));return{z:n,x:a,y:c}}return null};function Pq(r){return bo(this,null,function*(){let e=yield r.getBytes(0,512e3),t=new DataView(e.data),i=t.getUint32(4,!0),n=t.getUint16(8,!0),s=new TextDecoder("utf-8"),a=JSON.parse(s.decode(new DataView(e.data,10,i))),c=0;a.compression==="gzip"&&(c=2);let d=0;"minzoom"in a&&(d=+a.minzoom);let p=0;"maxzoom"in a&&(p=+a.maxzoom);let b=0,T=0,B=0,z=-180,G=-85,Z=180,q=85;if(a.bounds){let ee=a.bounds.split(",");z=+ee[0],G=+ee[1],Z=+ee[2],q=+ee[3]}if(a.center){let ee=a.center.split(",");b=+ee[0],T=+ee[1],B=+ee[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+i,rootDirectoryLength:n*17,jsonMetadataOffset:10,jsonMetadataLength:i,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:c,tileType:1,minZoom:d,maxZoom:p,minLon:z,minLat:G,maxLon:Z,maxLat:q,centerZoom:B,centerLon:b,centerLat:T,etag:e.etag}})}function Mq(r,e,t,i,n,s,a){return bo(this,null,function*(){let c=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(c=fB(c));let d=hB(new DataView(c),i,n,s);if(d){let T=(yield e.getBytes(d.offset,d.length,a)).data,B=new DataView(T);return B.getUint8(0)===31&&B.getUint8(1)===139&&(T=iE(new Uint8Array(T))),{data:T}}let p=Iq(new DataView(c),{z:i,x:n,y:s});if(p){let b=Eq(new DataView(c),p.z,p.x,p.y);if(b){let T=yield t.getArrayBuffer(e,b.offset,b.length,r);r.specVersion===1&&(T=fB(T));let B=hB(new DataView(T),i,n,s);if(B){let G=(yield e.getBytes(B.offset,B.length,a)).data,Z=new DataView(G);return Z.getUint8(0)===31&&Z.getUint8(1)===139&&(G=iE(new Uint8Array(G))),{data:G}}}}})}var TB={getHeader:Pq,getZxy:Mq};var Rq=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);let i=new AbortController;return r(e,i).then(n=>t(void 0,n.data,n.cacheControl||"",n.expires||""),n=>t(n)).catch(n=>t(n)),{cancel:()=>i.abort()}},EB=class{constructor(r){this.tilev4=(e,t)=>bo(this,null,function*(){if(e.type==="json"){let B=e.url.substr(10),z=this.tiles.get(B);if(z||(z=new Zx(B),this.tiles.set(B,z)),this.metadata)return{data:yield z.getTileJson(e.url)};let G=yield z.getHeader();return{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:G.minZoom,maxzoom:G.maxZoom,bounds:[G.minLon,G.minLat,G.maxLon,G.maxLat]}}}let i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=e.url.match(i);if(!n)throw new Error("Invalid PMTiles protocol URL");let s=n[1],a=this.tiles.get(s);a||(a=new Zx(s),this.tiles.set(s,a));let c=n[2],d=n[3],p=n[4],b=yield a.getHeader(),T=yield a?.getZxy(+c,+d,+p,t.signal);return T?{data:new Uint8Array(T.data),cacheControl:T.cacheControl,expires:T.expires}:b.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=Rq(this.tilev4),this.tiles=new Map,this.metadata=r?.metadata||!1}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function XA(r,e){return(e>>>0)*4294967296+(r>>>0)}function Bq(r,e){let t=e.buf,i=t[e.pos++],n=(i&112)>>4;if(i<128||(i=t[e.pos++],n|=(i&127)<<3,i<128)||(i=t[e.pos++],n|=(i&127)<<10,i<128)||(i=t[e.pos++],n|=(i&127)<<17,i<128)||(i=t[e.pos++],n|=(i&127)<<24,i<128)||(i=t[e.pos++],n|=(i&1)<<31,i<128))return XA(r,n);throw new Error("Expected varint not more than 10 bytes")}function Sg(r){let e=r.buf,t=e[r.pos++],i=t&127;return t<128||(t=e[r.pos++],i|=(t&127)<<7,t<128)||(t=e[r.pos++],i|=(t&127)<<14,t<128)||(t=e[r.pos++],i|=(t&127)<<21,t<128)?i:(t=e[r.pos],i|=(t&15)<<28,Bq(i,r))}function Lq(r,e,t,i){if(i===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}var Oq=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Dq(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>KA(2,r)-1||t>KA(2,r)-1)throw Error("tile x/y outside zoom level bounds");let i=Oq[r],n=KA(2,r),s=0,a=0,c=0,d=[e,t],p=n/2;for(;p>0;)s=(d[0]&p)>0?1:0,a=(d[1]&p)>0?1:0,c+=p*p*(3*s^a),Lq(p,d,s,a),p=p/2;return i+c}function SB(r,e){return bo(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return iE(new Uint8Array(r));let t=new Response(r).body;if(!t)throw Error("Failed to read response stream");let i=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(i).arrayBuffer()}throw Error("Compression method not supported")})}function kq(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}var Fq=127;function Nq(r,e){let t=0,i=r.length-1;for(;t<=i;){let n=i+t>>1,s=e-r[n].tileId;if(s>0)t=n+1;else if(s<0)i=n-1;else return r[n]}return i>=0&&(r[i].runLength===0||e-r[i].tileId<r[i].runLength)?r[i]:null}var zq=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1;let t="";"navigator"in globalThis&&(t=globalThis.navigator.userAgent||"");let i=t.indexOf("Windows")>-1,n=/Chrome|Chromium|Edg|OPR|Brave/.test(t);this.chromeWindowsNoCache=!1,i&&n&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,i){return bo(this,null,function*(){let n,s;t?s=t:(n=new AbortController,s=n.signal);let a=new Headers(this.customHeaders);a.set("range",`bytes=${r}-${r+e-1}`);let c;this.mustReload?c="reload":this.chromeWindowsNoCache&&(c="no-store");let d=yield fetch(this.url,{signal:s,cache:c,headers:a});if(r===0&&d.status===416){let B=d.headers.get("Content-Range");if(!B||!B.startsWith("bytes */"))throw Error("Missing content-length on 416 response");let z=+B.substr(8);d=yield fetch(this.url,{signal:s,cache:"reload",headers:{range:`bytes=0-${z-1}`}})}let p=d.headers.get("Etag");if(p?.startsWith("W/")&&(p=null),d.status===416||i&&p&&p!==i)throw this.mustReload=!0,new nE(`Server returned non-matching ETag ${i} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);let b=d.headers.get("Content-Length");if(d.status===200&&(!b||+b>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function sc(r,e){let t=r.getUint32(e+4,!0),i=r.getUint32(e+0,!0);return t*KA(2,32)+i}function Uq(r,e){let t=new DataView(r),i=t.getUint8(7);if(i>3)throw Error(`Archive is spec version ${i} but this library supports up to spec version 3`);return{specVersion:i,rootDirectoryOffset:sc(t,8),rootDirectoryLength:sc(t,16),jsonMetadataOffset:sc(t,24),jsonMetadataLength:sc(t,32),leafDirectoryOffset:sc(t,40),leafDirectoryLength:sc(t,48),tileDataOffset:sc(t,56),tileDataLength:sc(t,64),numAddressedTiles:sc(t,72),numTileEntries:sc(t,80),numTileContents:sc(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function CB(r){let e={buf:new Uint8Array(r),pos:0},t=Sg(e),i=[],n=0;for(let s=0;s<t;s++){let a=Sg(e);i.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<t;s++)i[s].runLength=Sg(e);for(let s=0;s<t;s++)i[s].length=Sg(e);for(let s=0;s<t;s++){let a=Sg(e);a===0&&s>0?i[s].offset=i[s-1].offset+i[s-1].length:i[s].offset=a-1}return i}function Vq(r){let e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var nE=class extends Error{};function jq(r,e){return bo(this,null,function*(){let t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Vq(t.data)<3)return[yield TB.getHeader(r)];let n=t.data.slice(0,Fq),s=Uq(n,t.etag),a=t.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),c=`${r.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,d=CB(yield e(a,s.internalCompression));return[s,[c,d.length,d]]})}function Gq(r,e,t,i,n){return bo(this,null,function*(){let s=yield r.getBytes(t,i,void 0,n.etag),a=yield e(s.data,n.internalCompression),c=CB(a);if(c.length===0)throw new Error("Empty directory is invalid");return c})}var Hq=class{constructor(r=100,e=!0,t=SB){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return bo(this,null,function*(){let e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;let i=new Promise((n,s)=>{jq(r,this.decompress).then(a=>{a[1]&&this.cache.set(a[1][0],{lastUsed:this.counter++,data:Promise.resolve(a[1][2])}),n(a[0]),this.prune()}).catch(a=>{s(a)})});return this.cache.set(e,{lastUsed:this.counter++,data:i}),i})}getDirectory(r,e,t,i){return bo(this,null,function*(){let n=`${r.getKey()}|${i.etag||""}|${e}|${t}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((c,d)=>{Gq(r,this.decompress,e,t,i).then(p=>{c(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}getArrayBuffer(r,e,t,i){return bo(this,null,function*(){let n=`${r.getKey()}|${i.etag||""}|${e}|${t}`,s=this.cache.get(n);if(s)return s.lastUsed=this.counter++,yield s.data;let a=new Promise((c,d)=>{r.getBytes(e,t,void 0,i.etag).then(p=>{c(p.data),this.cache.has(n),this.prune()}).catch(p=>{d(p)})});return this.cache.set(n,{lastUsed:this.counter++,data:a}),a})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,i)=>{t.lastUsed<r&&(r=t.lastUsed,e=i)}),e&&this.cache.delete(e)}}invalidate(r){return bo(this,null,function*(){let e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());let t=new Promise((i,n)=>{this.getHeader(r).then(s=>{i(),this.invalidations.delete(e)}).catch(s=>{n(s)})});this.invalidations.set(e,t)})}},Zx=class{constructor(r,e,t){typeof r=="string"?this.source=new zq(r):this.source=r,t?this.decompress=t:this.decompress=SB,e?this.cache=e:this.cache=new Hq}getHeader(){return bo(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,i){return bo(this,null,function*(){let n=Dq(r,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return TB.getZxy(s,this.source,this.cache,r,e,t,i);if(r<s.minZoom||r>s.maxZoom)return;let a=s.rootDirectoryOffset,c=s.rootDirectoryLength;for(let d=0;d<=3;d++){let p=yield this.cache.getDirectory(this.source,a,c,s),b=Nq(p,n);if(b){if(b.runLength>0){let T=yield this.source.getBytes(s.tileDataOffset+b.offset,b.length,i,s.etag);return{data:yield this.decompress(T.data,s.tileCompression),cacheControl:T.cacheControl,expires:T.expires}}a=s.leafDirectoryOffset+b.offset,c=b.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,i){return bo(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,i)}catch(n){if(n instanceof nE)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,i);throw n}})}getMetadataAttempt(){return bo(this,null,function*(){let r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),i=new TextDecoder("utf-8");return JSON.parse(i.decode(t))})}getMetadata(){return bo(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof nE)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}getTileJson(r){return bo(this,null,function*(){let e=yield this.getHeader(),t=yield this.getMetadata(),i=kq(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${r}/{z}/{x}/{y}${i}`],vector_layers:t.vector_layers,attribution:t.attribution,description:t.description,name:t.name,version:t.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};async function za(r,e,t,i){return i._parse(r,e,t,i)}function Ti(r,e){if(!r)throw new Error(e||"loader assertion failed.")}var Jc={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Wq=Jc.self||Jc.window||Jc.global||{},$q=Jc.window||Jc.self||Jc.global||{},qq=Jc.global||Jc.self||Jc.window||{},Zq=Jc.document||{};var lh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var IB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Xq=IB&&parseFloat(IB[1])||0;var Xx=globalThis,Yq=globalThis.document||{},Yx=globalThis.process||{},Kq=globalThis.console,PB=globalThis.navigator||{};function Kx(r){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let e=typeof navigator<"u"&&navigator.userAgent,t=r||e;return!!(t&&t.indexOf("Electron")>=0)}function qo(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Kx()}function oE(r){return!r&&!qo()?"Node":Kx(r)?"Electron":(r||PB.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var aE="4.1.0";function Jq(r){try{let e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}var Qx=class{constructor(e,t,i="sessionStorage"){this.storage=Jq(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){let t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function MB(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function RB(r,e=8){let t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Jx;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Jx||(Jx={}));var eZ=10;function BB(r){return typeof r!="string"?r:(r=r.toUpperCase(),Jx[r]||Jx.WHITE)}function LB(r,e,t){return!qo&&typeof r=="string"&&(e&&(r=`\x1B[${BB(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${BB(t)+eZ}m${r}\x1B[49m`)),r}function OB(r,e=["constructor"]){let t=Object.getPrototypeOf(r),i=Object.getOwnPropertyNames(t),n=r;for(let s of i){let a=n[s];typeof a=="function"&&(e.find(c=>s===c)||(n[s]=a.bind(r)))}}function Pg(r,e){if(!r)throw new Error(e||"Assertion failed")}function rp(){let r;if(qo()&&Xx.performance)r=Xx?.performance?.now?.();else if("hrtime"in Yx){let e=Yx?.hrtime?.();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}var QA={debug:qo()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},tZ={enabled:!0,level:0};function JA(){}var DB={},kB={once:!0},da=class{constructor({id:e}={id:""}){this.VERSION=aE,this._startTs=rp(),this._deltaTs=rp(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Qx(`__probe-${this.id}__`,tZ),this.timeStamp(`${this.id} started`),OB(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((rp()-this._startTs).toPrecision(10))}getDelta(){return Number((rp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,QA.warn,arguments,kB)}error(e){return this._getLogFunction(0,e,QA.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,QA.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,QA.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,QA.debug||QA.info,arguments,kB)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||JA,i&&[i],{tag:iZ(t)}):JA}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||JA)}group(e,t,i={collapsed:!1}){let n=FB({logLevel:e,message:t,opts:i}),{collapsed:s}=i;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||JA)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=NB(e)}_getLogFunction(e,t,i,n,s){if(this._shouldLog(e)){s=FB({logLevel:e,message:t,args:n,opts:s}),i=i||s.method,Pg(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=rp();let a=s.tag||s.message;if(s.once&&a)if(!DB[a])DB[a]=rp();else return JA;return t=rZ(this.id,s.message,s),i.bind(console,t,...s.args)}return JA}};da.VERSION=aE;function NB(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return Pg(Number.isFinite(e)&&e>=0),e}function FB(r){let{logLevel:e,message:t}=r;r.logLevel=NB(e);let i=r.args?Array.from(r.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break;default:}typeof r.message=="function"&&(r.message=r.message());let n=typeof r.message;return Pg(n==="string"||n==="object"),Object.assign(r,{args:i},r.opts)}function rZ(r,e,t){if(typeof e=="string"){let i=t.time?RB(MB(t.total)):"";e=t.time?`${r}: ${i}  ${e}`:`${r}: ${e}`,e=LB(e,t.color,t.background)}return e}function iZ(r){for(let e in r)for(let t in r[e])return t||"untitled";return"empty"}globalThis.probe={};var lE=new da({id:"@probe.gl/log"});var cE="4.3.2",nZ=cE[0]>="0"&&cE[0]<="9"?`v${cE}`:"";function sZ(){let r=new da({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=nZ,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}var Mg=sZ();function Rg(r,e){return zB(r||{},e)}function zB(r,e,t=0){if(t>3)return e;let i={...r};for(let[n,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?i[n]=zB(i[n]||{},e[n],t+1):i[n]=e[n];return i}function uE(r){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,r)}function hE(r){return globalThis.loaders?.modules?.[r]||null}var UB="latest";function oZ(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}var Bg=oZ();function vo(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}var eu={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},sge=eu.self||eu.window||eu.global||{},oge=eu.window||eu.self||eu.global||{},age=eu.global||eu.self||eu.window||{},lge=eu.document||{};var so=typeof process!="object"||String(process)!=="[object process]"||process.browser,Lg=typeof importScripts=="function",jB=typeof window<"u"&&typeof window.orientation<"u",VB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),cge=VB&&parseFloat(VB[1])||0;var Og=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){vo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){vo(this.isRunning),this.isRunning=!1,this._reject(e)}};var e0=class{terminate(){}};var fE=new Map;function GB(r){vo(r.source&&!r.url||!r.source&&r.url);let e=fE.get(r.source||r.url);return e||(r.url&&(e=aZ(r.url),fE.set(r.url,e)),r.source&&(e=HB(r.source),fE.set(r.source,e))),vo(e),e}function aZ(r){if(!r.startsWith("http"))return r;let e=lZ(r);return HB(e)}function HB(r){let e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function lZ(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function dE(r,e=!0,t){let i=t||new Set;if(r){if(WB(r))i.add(r);else if(WB(r.buffer))i.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(let n in r)dE(r[n],e,i)}}return t===void 0?Array.from(i):[]}function WB(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}var pE=()=>{},Rf=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&so||typeof e0<"u"&&!so}constructor(e){let{name:t,source:i,url:n}=e;vo(i||n),this.name=t,this.source=i,this.url=n,this.onMessage=pE,this.onError=s=>console.log(s),this.worker=so?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=pE,this.onError=pE,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||dE(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=GB({source:this.source,url:this.url});let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){let i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new e0(i,{eval:!1})}else if(this.source)e=new e0(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}};var Dg=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Rf.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(n,s,a)=>n.done(a),i=(n,s)=>n.error(s)){let n=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:s}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let i=new Og(t.name,e);e.onMessage=n=>t.onMessage(i,n.type,n.payload),e.onError=n=>t.onError(i,n),t.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!so||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Rf({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return jB?this.maxMobileConcurrency:this.maxConcurrency}};var cZ={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ip=class r{props;workerPools=new Map;static _workerFarm;static isSupported(){return Rf.isSupported()}static getWorkerFarm(e={}){return r._workerFarm=r._workerFarm||new r({}),r._workerFarm.setProps(e),r._workerFarm}constructor(e){this.props={...cZ},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(let t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:i,url:n}=e,s=this.workerPools.get(t);return s||(s=new Dg({name:t,source:i,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function AE(r,e={}){let t=e[r.id]||{},i=so?`${r.id}-worker.js`:`${r.id}-worker-node.js`,n=t.workerUrl;if(!n&&r.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(so?n=`modules/${r.module}/dist/${i}`:n=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!n){let s=r.version;s==="latest"&&(s=UB);let a=s?`@${s}`:"";n=`https://unpkg.com/@loaders.gl/${r.module}${a}/dist/${i}`}return vo(n),n}function mE(r,e=Bg){vo(r,"no worker provided");let t=r.version;return!(!e||!t)}var gE={};async function tu(r,e=null,t={},i=null){return e&&(r=$B(r,e,t,i)),gE[r]=gE[r]||uZ(r),await gE[r]}function $B(r,e,t={},i=null){if(!t.useLocalLibraries&&r.startsWith("http"))return r;i=i||r;let n=t.modules||{};return n[i]?n[i]:so?t.CDN?(vo(t.CDN.startsWith("http")),`${t.CDN}/${e}@${Bg}/dist/libs/${i}`):Lg?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function uZ(r){if(r.endsWith("wasm"))return await fZ(r);if(!so)try{let{requireFromFile:t}=globalThis.loaders||{};return await t?.(r)}catch(t){return console.error(t),null}if(Lg)return importScripts(r);let e=await dZ(r);return hZ(e,r)}function hZ(r,e){if(!so){let{requireFromString:i}=globalThis.loaders||{};return i?.(r,e)}if(Lg)return eval.call(globalThis,r),null;let t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function fZ(r){let{readFileAsArrayBuffer:e}=globalThis.loaders||{};return so||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function dZ(r){let{readFileAsText:e}=globalThis.loaders||{};return so||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}function _E(r,e){return!ip.isSupported()||!so&&!e?._nodeWorkers?!1:r.worker&&e?.worker}async function yE(r,e,t,i,n){let s=r.id,a=AE(r,t),d=ip.getWorkerFarm(t).getWorkerPool({name:s,url:a});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));let p=await d.startJob("process-on-worker",pZ.bind(null,n));return p.postMessage("process",{input:e,options:t,context:i}),await(await p.result).result}async function pZ(r,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":let{id:n,input:s,options:a}=i;try{let c=await r(s,a);e.postMessage("done",{id:n,result:c})}catch(c){let d=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:n,error:d})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function ZB(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?qB(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?qB(r,0,e):""}function qB(r,e,t){if(r.byteLength<=e+t)return"";let i=new DataView(r),n="";for(let s=0;s<t;s++)n+=String.fromCharCode(i.getUint8(e+s));return n}function xE(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${ZB(r)}"`)}}function bE(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;let i=new Uint8Array(r),n=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s])return!1;return!0}function vE(...r){return XB(r)}function XB(r){let e=r.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,a)=>s+a.byteLength,0),i=new Uint8Array(t),n=0;for(let s of e)i.set(s,n),n+=s.byteLength;return i.buffer}function kg(...r){let e=r,t=e&&e.length>1&&e[0].constructor||null;if(!t)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');let i=e.reduce((a,c)=>a+c.length,0),n=new t(i),s=0;for(let a of e)n.set(a,s),s+=a.length;return n}function np(r,e,t){let i=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(i).buffer}function Bf(r,e){return Ti(r>=0),Ti(e>0),r+(e-1)&~(e-1)}function wE(r,e,t){let i;if(r instanceof ArrayBuffer)i=new Uint8Array(r);else{let n=r.byteOffset,s=r.byteLength;i=new Uint8Array(r.buffer||r.arrayBuffer,n,s)}return e.set(i,t),t+Bf(i.byteLength,4)}async function TE(r){let e=[];for await(let t of r)e.push(t);return vE(...e)}function Fg(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){let e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}var sp=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Fg(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Fg()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Mo=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(let e of Object.values(this.stats))e.reset();return this}forEach(e){for(let t of Object.values(this.stats))e(t)}getTable(){let e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){let{name:t,type:i}=e,n=this.stats[t];return n||(e instanceof sp?n=e:n=new sp(t,i),this.stats[t]=n),n}};var AZ="Queued Requests",mZ="Active Requests",gZ="Cancelled Requests",_Z="Queued Requests Ever",yZ="Active Requests Ever",xZ={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},Lf=class{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...xZ,...e},this.stats=new Mo({id:this.props.id}),this.stats.get(AZ),this.stats.get(mZ),this.stats.get(gZ),this.stats.get(_Z),this.stats.get(yZ)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let i={handle:e,priority:0,getPriority:t},n=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){let{handle:t,resolve:i}=e,n=!1,s=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){let i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){let e=this.requestQueue;for(let t=0;t<e.length;++t){let i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort((t,i)=>t.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}};var bZ="",YB={};function EE(r){for(let e in YB)if(r.startsWith(e)){let t=YB[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${bZ}${r}`),r}function KB(r){return r&&typeof r=="object"&&r.isBuffer}function e2(r){if(KB(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){let e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}var Ua={};Ms(Ua,{dirname:()=>wZ,filename:()=>vZ,join:()=>TZ,resolve:()=>EZ});function QB(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let r=window.location?.pathname;return r?.slice(0,r.lastIndexOf("/")+1)||""}function vZ(r){let e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function wZ(r){let e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}function TZ(...r){let e="/";return r=r.map((t,i)=>(i&&(t=t.replace(new RegExp(`^${e}`),"")),i!==r.length-1&&(t=t.replace(new RegExp(`${e}$`),"")),t)),r.join(e)}function EZ(...r){let e=[];for(let s=0;s<r.length;s++)e[s]=r[s];let t="",i=!1,n;for(let s=e.length-1;s>=-1&&!i;s--){let a;s>=0?a=e[s]:(n===void 0&&(n=QB()),a=n),a.length!==0&&(t=`${a}/${t}`,i=a.charCodeAt(0)===Ng)}return t=SZ(t,!i),i?`/${t}`:t.length>0?t:"."}var Ng=47,SE=46;function SZ(r,e){let t="",i=-1,n=0,s,a=!1;for(let c=0;c<=r.length;++c){if(c<r.length)s=r.charCodeAt(c);else{if(s===Ng)break;s=Ng}if(s===Ng){if(!(i===c-1||n===1))if(i!==c-1&&n===2){if(t.length<2||!a||t.charCodeAt(t.length-1)!==SE||t.charCodeAt(t.length-2)!==SE){if(t.length>2){let d=t.length-1,p=d;for(;p>=0&&t.charCodeAt(p)!==Ng;--p);if(p!==d){t=p===-1?"":t.slice(0,p),i=c,n=0,a=!1;continue}}else if(t.length===2||t.length===1){t="",i=c,n=0,a=!1;continue}}e&&(t.length>0?t+="/..":t="..",a=!0)}else{let d=r.slice(i+1,c);t.length>0?t+=`/${d}`:t=d,a=!1}i=c,n=0}else s===SE&&n!==-1?++n:n=-1}return t}var t2=class{fetch;loadOptions;_needsRefresh=!0;props;constructor(e){this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=CZ(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){let t=this._needsRefresh;return e&&(this._needsRefresh=!1),t}};function CZ(r){let e=r?.fetch;if(e&&typeof e=="function")return(i,n)=>e(i,n);let t=r?.fetch;return t&&typeof t!="function"?i=>fetch(i,t):i=>fetch(i)}var ru=class extends t2{static type="template";static testURL=e=>!1};var IZ=r=>typeof r=="boolean",zg=r=>typeof r=="function",op=r=>r!==null&&typeof r=="object",CE=r=>op(r)&&r.constructor==={}.constructor;var JB=r=>!!r&&typeof r[Symbol.iterator]=="function",e6=r=>r&&typeof r[Symbol.asyncIterator]=="function";var ll=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json;var cl=r=>typeof Blob<"u"&&r instanceof Blob,t6=r=>r&&typeof r=="object"&&r.isBuffer;var PZ=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||op(r)&&zg(r.tee)&&zg(r.cancel)&&zg(r.getReader);var MZ=r=>op(r)&&zg(r.read)&&zg(r.pipe)&&IZ(r.readable),r2=r=>PZ(r)||MZ(r);var i2=class extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response};var RZ=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,BZ=/^([-\w.]+\/[-\w.+]+)/;function IE(r,e){return r.toLowerCase()===e.toLowerCase()}function r6(r){let e=BZ.exec(r);return e?e[1]:r}function PE(r){let e=RZ.exec(r);return e?e[1]:""}var i6=/\?.*/;function n6(r){let e=r.match(i6);return e&&e[0]}function t0(r){return r.replace(i6,"")}function s6(r){if(r.length<50)return r;let e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function ap(r){return ll(r)?r.url:cl(r)?r.name||"":typeof r=="string"?r:""}function Ug(r){if(ll(r)){let e=r,t=e.headers.get("content-type")||"",i=t0(e.url);return r6(t)||PE(i)}return cl(r)?r.type||"":typeof r=="string"?PE(r):""}function o6(r){return ll(r)?r.headers["content-length"]||-1:cl(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function n2(r){if(ll(r))return r;let e={},t=o6(r);t>=0&&(e["content-length"]=String(t));let i=ap(r),n=Ug(r);n&&(e["content-type"]=n);let s=await OZ(r);s&&(e["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));let a=new Response(r,{headers:e});return Object.defineProperty(a,"url",{value:i}),a}async function a6(r){if(!r.ok)throw await LZ(r)}async function LZ(r){let e=s6(r.url),t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;let i={reason:r.statusText,url:r.url,response:r};try{let n=r.headers.get("Content-Type");i.reason=!r.bodyUsed&&n?.includes("application/json")?await r.json():await r.text()}catch{}return new i2(t,i)}async function OZ(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){let t=r.slice(0,5);return await new Promise(i=>{let n=new FileReader;n.onload=s=>i(s?.target?.result),n.readAsDataURL(t)})}if(r instanceof ArrayBuffer){let t=r.slice(0,5);return`data:base64,${DZ(t)}`}return null}function DZ(r){let e="",t=new Uint8Array(r);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function kZ(r){return!FZ(r)&&!NZ(r)}function FZ(r){return r.startsWith("http:")||r.startsWith("https:")}function NZ(r){return r.startsWith("data:")}async function ME(r,e){if(typeof r=="string"){let t=EE(r);return kZ(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await n2(r)}var RE=new da({id:"loaders.gl"}),s2=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},o2=class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};var BE={fetch:null,mimeType:void 0,nothrow:!1,log:new o2,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:lh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},l6={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function LE(){globalThis.loaders=globalThis.loaders||{};let{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function OE(){let r=LE();return r.globalOptions=r.globalOptions||{...BE},r.globalOptions}function h6(r,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],zZ(r,t),VZ(e,r,i)}function zZ(r,e){c6(r,null,BE,l6,e);for(let t of e){let i=r&&r[t.id]||{},n=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};c6(i,t.id,n,s,e)}}function c6(r,e,t,i,n){let s=e||"Top level",a=e?`${e}.`:"";for(let c in r){let d=!e&&op(r[c]),p=c==="baseUri"&&!e,b=c==="workerUrl"&&e;if(!(c in t)&&!p&&!b){if(c in i)RE.warn(`${s} loader option '${a}${c}' no longer supported, use '${i[c]}'`)();else if(!d){let T=UZ(c,n);RE.warn(`${s} loader option '${a}${c}' not recognized. ${T}`)()}}}}function UZ(r,e){let t=r.toLowerCase(),i="";for(let n of e)for(let s in n.options){if(r===s)return`Did you mean '${n.id}.${s}'?`;let a=s.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(i=i||`Did you mean '${n.id}.${s}'?`)}return i}function VZ(r,e,t){let n={...r.options||{}};return jZ(n,t),n.log===null&&(n.log=new s2),u6(n,OE()),u6(n,e),n}function u6(r,e){for(let t in e)if(t in e){let i=e[t];CE(i)&&CE(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function jZ(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function Vg(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r?.extensions)):!1}function jg(r){Ti(r,"null loader"),Ti(Vg(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r?.parseTextSync||r?.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}var f6=()=>{let r=LE();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function DE(r){let e=f6();r=Array.isArray(r)?r:[r];for(let t of r){let i=jg(t);e.find(n=>i===n)||e.unshift(i)}}function d6(){return f6()}var GZ=/\.([^.]+)$/;async function m6(r,e=[],t,i){if(!g6(r))return null;let n=p6(r,e,{...t,nothrow:!0},i);if(n)return n;if(cl(r)&&(r=await r.slice(0,10).arrayBuffer(),n=p6(r,e,t,i)),!n&&!t?.nothrow)throw new Error(_6(r));return n}function p6(r,e=[],t,i){if(!g6(r))return null;if(e&&!Array.isArray(e))return jg(e);let n=[];e&&(n=n.concat(e)),t?.ignoreRegisteredLoaders||n.push(...d6()),WZ(n);let s=HZ(r,n,t,i);if(!s&&!t?.nothrow)throw new Error(_6(r));return s}function HZ(r,e,t,i){let n=ap(r),s=Ug(r),a=t0(n)||i?.url,c=null,d="";return t?.mimeType&&(c=kE(e,t?.mimeType),d=`match forced by supplied MIME type ${t?.mimeType}`),c=c||$Z(e,a),d=d||(c?`matched url ${a}`:""),c=c||kE(e,s),d=d||(c?`matched MIME type ${s}`:""),c=c||ZZ(e,r),d=d||(c?`matched initial data ${y6(r)}`:""),t?.fallbackMimeType&&(c=c||kE(e,t?.fallbackMimeType),d=d||(c?`matched fallback MIME type ${s}`:"")),d&&Mg.log(1,`selectLoader selected ${c?.name}: ${d}.`),c}function g6(r){return!(r instanceof Response&&r.status===204)}function _6(r){let e=ap(r),t=Ug(r),i="No valid loader found (";i+=e?`${Ua.filename(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;let n=r?y6(r):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function WZ(r){for(let e of r)jg(e)}function $Z(r,e){let t=e&&GZ.exec(e),i=t&&t[1];return i?qZ(r,i):null}function qZ(r,e){e=e.toLowerCase();for(let t of r)for(let i of t.extensions)if(i.toLowerCase()===e)return t;return null}function kE(r,e){for(let t of r)if(t.mimeTypes?.some(i=>IE(e,i))||IE(e,`application/x.${t.id}`))return t;return null}function ZZ(r,e){if(!e)return null;for(let t of r)if(typeof e=="string"){if(XZ(e,t))return t}else if(ArrayBuffer.isView(e)){if(A6(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&A6(e,0,t))return t;return null}function XZ(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>r.startsWith(i))}function A6(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>YZ(r,e,t,n))}function YZ(r,e,t,i){if(i instanceof ArrayBuffer)return bE(i,r,i.byteLength);switch(typeof i){case"function":return i(r);case"string":let n=FE(r,e,i.length);return i===n;default:return!1}}function y6(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?FE(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?FE(r,0,e):""}function FE(r,e,t){if(r.byteLength<e+t)return"";let i=new DataView(r),n="";for(let s=0;s<t;s++)n+=String.fromCharCode(i.getUint8(e+s));return n}function*x6(r,e){let t=e?.chunkSize||262144,i=0,n=new TextEncoder;for(;i<r.length;){let s=Math.min(r.length-i,t),a=r.slice(i,i+s);i+=s,yield n.encode(a)}}function*b6(r,e={}){let{chunkSize:t=262144}=e,i=0;for(;i<r.byteLength;){let n=Math.min(r.byteLength-i,t),s=new ArrayBuffer(n),a=new Uint8Array(r,i,n);new Uint8Array(s).set(a),i+=n,yield s}}async function*v6(r,e){let t=e?.chunkSize||1048576,i=0;for(;i<r.size;){let n=i+t,s=await r.slice(i,n).arrayBuffer();i=n,yield s}}function NE(r,e){return lh?KZ(r,e):QZ(r,e)}async function*KZ(r,e){let t=r.getReader(),i;try{for(;;){let n=i||t.read();e?._streamReadAhead&&(i=t.read());let{done:s,value:a}=await n;if(s)return;yield e2(a)}}catch{t.releaseLock()}}async function*QZ(r,e){for await(let t of r)yield e2(t)}function w6(r,e){if(typeof r=="string")return x6(r,e);if(r instanceof ArrayBuffer)return b6(r,e);if(cl(r))return v6(r,e);if(r2(r))return NE(r,e);if(ll(r))return NE(r.body,e);throw new Error("makeIterator")}var T6="Cannot convert supplied data type";function JZ(r,e,t){if(e.text&&typeof r=="string")return r;if(t6(r)&&(r=r.buffer),r instanceof ArrayBuffer){let i=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let i=r.buffer,n=r.byteLength||r.length;return(r.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(r.byteOffset,r.byteOffset+n)),i}throw new Error(T6)}async function E6(r,e,t){let i=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||i)return JZ(r,e,t);if(cl(r)&&(r=await n2(r)),ll(r)){let n=r;return await a6(n),e.binary?await n.arrayBuffer():await n.text()}if(r2(r)&&(r=w6(r,t)),JB(r)||e6(r))return TE(r);throw new Error(T6)}function a2(r,e){let t=OE(),i=r||t;return typeof i.fetch=="function"?i.fetch:op(i.fetch)?n=>ME(n,i.fetch):e?.fetch?e?.fetch:ME}function S6(r,e,t){if(t)return t;let i={fetch:a2(e,r),...r};if(i.url){let n=t0(i.url);i.baseUrl=n,i.queryString=n6(i.url),i.filename=Ua.filename(n),i.baseUrl=Ua.dirname(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function C6(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){let i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function Gg(r,e,t,i){e&&!Array.isArray(e)&&!Vg(e)&&(i=void 0,t=e,e=void 0),r=await r,t=t||{};let n=ap(r),a=C6(e,i),c=await m6(r,a,t);return c?(t=h6(t,c,a,n),i=S6({url:n,_parse:Gg,loaders:a},t,i||null),await eX(c,r,t,i)):null}async function eX(r,e,t,i){if(mE(r),t=Rg(r.options,t),ll(e)){let s=e,{ok:a,redirected:c,status:d,statusText:p,type:b,url:T}=s,B=Object.fromEntries(s.headers.entries());i.response={headers:B,ok:a,redirected:c,status:d,statusText:p,type:b,url:T}}e=await E6(e,r,t);let n=r;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,t,i);if(_E(r,t))return await yE(r,e,t,i,Gg);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,i);if(n.parse)return await n.parse(e,t,i);throw vo(!n.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}function I6(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function ch(r){let e=1/0,t=1/0,i=1/0,n=-1/0,s=-1/0,a=-1/0,c=r.POSITION?r.POSITION.value:[],d=c&&c.length;for(let p=0;p<d;p+=3){let b=c[p],T=c[p+1],B=c[p+2];e=b<e?b:e,t=T<t?T:t,i=B<i?B:i,n=b>n?b:n,s=T>s?T:s,a=B>a?B:a}return[[e,t,i],[n,s,a]]}function zE(r,e,t){let i=I6(e.value),n=t||P6(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:n}}function P6(r){let e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}async function oo(r,e,t,i){let n,s;!Array.isArray(e)&&!Vg(e)?(n=[],s=e,i=void 0):(n=e,s=t);let a=a2(s),c=r;return typeof r=="string"&&(c=await a(r)),cl(r)&&(c=await a(r)),Array.isArray(n)?await Gg(c,n,s):await Gg(c,n,s)}var M6="4.3.2";var tX=globalThis.loaders?.parseImageNode,UE=typeof Image<"u",VE=typeof ImageBitmap<"u",rX=!!tX,jE=lh?!0:rX;function R6(r){switch(r){case"auto":return VE||UE||jE;case"imagebitmap":return VE;case"image":return UE;case"data":return jE;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function B6(){if(VE)return"imagebitmap";if(UE)return"image";if(jE)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function L6(r){let e=iX(r);if(!e)throw new Error("Not an image");return e}function Hg(r){switch(L6(r)){case"data":return r;case"image":case"imagebitmap":let e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function iX(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}var nX=/^data:image\/svg\+xml/,sX=/\.svg((\?|#).*)?$/;function l2(r){return r&&(nX.test(r)||sX.test(r))}function O6(r,e){if(l2(e)){let i=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return GE(r,e)}function GE(r,e){if(l2(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function c2(r,e,t){let i=O6(r,t),n=self.URL||self.webkitURL,s=typeof i!="string"&&n.createObjectURL(i);try{return await oX(s||i,e)}finally{s&&n.revokeObjectURL(s)}}async function oX(r,e){let t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,n)=>{try{t.onload=()=>i(t),t.onerror=s=>{let a=s instanceof Error?s.message:"error";n(new Error(a))}}catch(s){n(s)}})}var aX={},D6=!0;async function k6(r,e,t){let i;l2(t)?i=await c2(r,e,t):i=GE(r,t);let n=e&&e.imagebitmap;return await lX(i,n)}async function lX(r,e=null){if((cX(e)||!D6)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),D6=!1}return await createImageBitmap(r)}function cX(r){for(let e in r||aX)return!1;return!0}function F6(r){return!dX(r,"ftyp",4)||!(r[8]&96)?null:uX(r)}function uX(r){switch(hX(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function hX(r,e,t){return String.fromCharCode(...r.slice(e,t))}function fX(r){return[...r].map(e=>e.charCodeAt(0))}function dX(r,e,t=0){let i=fX(e);for(let n=0;n<i.length;++n)if(i[n]!==r[n+t])return!1;return!0}var iu=!1,Wg=!0;function lp(r){let e=$g(r);return AX(e)||_X(e)||mX(e)||gX(e)||pX(e)}function pX(r){let e=new Uint8Array(r instanceof DataView?r.buffer:r),t=F6(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function AX(r){let e=$g(r);return e.byteLength>=24&&e.getUint32(0,iu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,iu),height:e.getUint32(20,iu)}:null}function mX(r){let e=$g(r);return e.byteLength>=10&&e.getUint32(0,iu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Wg),height:e.getUint16(8,Wg)}:null}function gX(r){let e=$g(r);return e.byteLength>=14&&e.getUint16(0,iu)===16973&&e.getUint32(2,Wg)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Wg),height:e.getUint32(22,Wg)}:null}function _X(r){let e=$g(r);if(!(e.byteLength>=3&&e.getUint16(0,iu)===65496&&e.getUint8(2)===255))return null;let{tableMarkers:i,sofMarkers:n}=yX(),s=2;for(;s+9<e.byteLength;){let a=e.getUint16(s,iu);if(n.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,iu),width:e.getUint16(s+7,iu)};if(!i.has(a))return null;s+=2,s+=e.getUint16(s,iu)}return null}function yX(){let r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function $g(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function N6(r,e){let{mimeType:t}=lp(r)||{},i=globalThis.loaders?.parseImageNode;return Ti(i),await i(r,t)}async function z6(r,e,t){e=e||{};let n=(e.image||{}).type||"auto",{url:s}=t||{},a=xX(n),c;switch(a){case"imagebitmap":c=await k6(r,e,s);break;case"image":c=await c2(r,e,s);break;case"data":c=await N6(r,e);break;default:Ti(!1)}return n==="data"&&(c=Hg(c)),c}function xX(r){switch(r){case"auto":case"data":return B6();default:return R6(r),r}}var bX=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],vX=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],wX={image:{type:"auto",decode:!0}},Of={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:M6,mimeTypes:vX,extensions:bX,parse:z6,tests:[r=>!!lp(new DataView(r))],options:wX};var HE={};function WE(r){if(HE[r]===void 0){let e=lh?EX(r):TX(r);HE[r]=e}return HE[r]}function TX(r){let e=["image/png","image/jpeg","image/gif"],t=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&t.includes(r)}function EX(r){switch(r){case"image/avif":case"image/webp":return SX(r);default:return!0}}function SX(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}var CX=new da({id:"deck"}),cr=CX;var $E={};function U6(r){$E=r}function is(r,e,t,i){cr.level>0&&$E[r]&&$E[r].call(null,e,t,i)}function IX(r){let e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}var V6={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:IX,parseTextSync:JSON.parse};function PX(){let r="9.1.11",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||(cr.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:cr,_registerLoggers:U6},DE([V6,[Of,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}var j6=PX();function u2(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}var qE={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function H6(r){let e={};for(let[t,i]of Object.entries(r))e[t]=MX(i);return e}function MX(r){let e=G6(r);if(e!=="object")return{value:r,...qE[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...qE[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=G6(r.value),{...r,...qE[e],type:e}):{type:"object",value:null};throw new Error("props")}function G6(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}var W6=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,$6=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var RX={vertex:W6,fragment:$6},q6=/void\s+main\s*\([^)]*\)\s*\{\n?/,Z6=/}\n?[^{}]*$/,ZE=[],qg="__LUMA_INJECT_DECLARATIONS__";function X6(r){let e={vertex:{},fragment:{}};for(let t in r){let i=r[t],n=BX(t);typeof i=="string"&&(i={order:0,injection:i}),e[n][t]=i}return e}function BX(r){let e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Zg(r,e,t,i=!1){let n=e==="vertex";for(let s in t){let a=t[s];a.sort((d,p)=>d.order-p.order),ZE.length=a.length;for(let d=0,p=a.length;d<p;++d)ZE[d]=a[d].injection;let c=`${ZE.join(`
`)}
`;switch(s){case"vs:#decl":n&&(r=r.replace(qg,c));break;case"vs:#main-start":n&&(r=r.replace(q6,d=>d+c));break;case"vs:#main-end":n&&(r=r.replace(Z6,d=>c+d));break;case"fs:#decl":n||(r=r.replace(qg,c));break;case"fs:#main-start":n||(r=r.replace(q6,d=>d+c));break;case"fs:#main-end":n||(r=r.replace(Z6,d=>c+d));break;default:r=r.replace(s,d=>d+c)}}return r=r.replace(qg,""),i&&(r=r.replace(/\}\s*$/,s=>s+RX[e])),r}function r0(r){r.map(e=>LX(e))}function LX(r){if(r.instance)return;r0(r.dependencies||[]);let{propTypes:e={},deprecations:t=[],inject:i={}}=r,n={normalizedInjections:X6(i),parsedDeprecations:OX(t)};e&&(n.propValidators=H6(e)),r.instance=n;let s={};e&&(s=Object.entries(e).reduce((a,[c,d])=>{let p=d?.value;return p&&(a[c]=p),a},{})),r.defaultUniforms={...r.defaultUniforms,...s}}function XE(r,e,t){r.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function OX(r){return r.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),r}function i0(r){r0(r);let e={},t={};Y6({modules:r,level:0,moduleMap:e,moduleDepth:t});let i=Object.keys(t).sort((n,s)=>t[s]-t[n]).map(n=>e[n]);return r0(i),i}function Y6(r){let{modules:e,level:t,moduleMap:i,moduleDepth:n}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(let s of e)i[s.name]=s,(n[s.name]===void 0||n[s.name]<t)&&(n[s.name]=t);for(let s of e)s.dependencies&&Y6({modules:s.dependencies,level:t+1,moduleMap:i,moduleDepth:n})}function K6(r){switch(r?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function J6(r,e){if(Number(r.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=Q6(r,DX),r;case"fragment":return r=Q6(r,kX),r;default:throw new Error(e)}}var eL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],DX=[...eL,[YE("attribute"),"in $1"],[YE("varying"),"out $1"]],kX=[...eL,[YE("varying"),"in $1"]];function Q6(r,e){for(let[t,i]of e)r=r.replace(t,i);return r}function YE(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function KE(r,e){let t="";for(let i in r){let n=r[i];if(t+=`void ${n.signature} {
`,n.header&&(t+=`  ${n.header}`),e[i]){let s=e[i];s.sort((a,c)=>a.order-c.order);for(let a of s)t+=`  ${a.injection}
`}n.footer&&(t+=`  ${n.footer}`),t+=`}
`}return t}function QE(r){let e={vertex:{},fragment:{}};for(let t of r){let i,n;typeof t!="string"?(i=t,n=i.hook):(i={},n=t),n=n.trim();let[s,a]=n.split(":"),c=n.replace(/\(.+/,""),d=Object.assign(i,{signature:a});switch(s){case"vs":e.vertex[c]=d;break;case"fs":e.fragment[c]=d;break;default:throw new Error(s)}}return e}function tL(r,e){return{name:FX(r,e),language:"glsl",version:NX(r)}}function FX(r,e="unnamed"){let i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return i?i[1]:e}function NX(r){let e=100,t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){let i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}var iL=`

${qg}
`,zX=`precision highp float;
`;function nL(r){let e=i0(r.modules||[]);return{source:UX(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:oL(e)}}function sL(r){let{vs:e,fs:t}=r,i=i0(r.modules||[]);return{vs:rL(r.platformInfo,{...r,source:e,stage:"vertex",modules:i}),fs:rL(r.platformInfo,{...r,source:t,stage:"fragment",modules:i}),getUniforms:oL(i)}}function UX(r,e){let{source:t,stage:i,modules:n,hookFunctions:s=[],inject:a={},log:c}=e;u2(typeof t=="string","shader source must be a string");let d=t,p="",b=QE(s),T={},B={},z={};for(let Z in a){let q=typeof a[Z]=="string"?{injection:a[Z],order:0}:a[Z],re=/^(v|f)s:(#)?([\w-]+)$/.exec(Z);if(re){let ee=re[2],ae=re[3];ee?ae==="decl"?B[Z]=[q]:z[Z]=[q]:T[Z]=[q]}else z[Z]=[q]}let G=n;for(let Z of G){c&&XE(Z,d,c);let q=aL(Z,"wgsl");p+=q;let re=Z.injections?.[i]||{};for(let ee in re){let ae=/^(v|f)s:#([\w-]+)$/.exec(ee);if(ae){let Le=ae[2]==="decl"?B:z;Le[ee]=Le[ee]||[],Le[ee].push(re[ee])}else T[ee]=T[ee]||[],T[ee].push(re[ee])}}return p+=iL,p=Zg(p,i,B),p+=KE(b[i],T),p+=d,p=Zg(p,i,z),p}function rL(r,e){let{id:t,source:i,stage:n,language:s="glsl",modules:a,defines:c={},hookFunctions:d=[],inject:p={},prologue:b=!0,log:T}=e;u2(typeof i=="string","shader source must be a string");let B=s==="glsl"?tL(i).version:-1,z=r.shaderLanguageVersion,G=B===100?"#version 100":"#version 300 es",q=i.split(`
`).slice(1).join(`
`),re={};a.forEach(Je=>{Object.assign(re,Je.defines)}),Object.assign(re,c);let ee="";switch(s){case"wgsl":break;case"glsl":ee=b?`${G}

// ----- PROLOGUE -------------------------
${VX({id:t,source:i,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${K6(r)}
${n==="fragment"?zX:""}

// ----- APPLICATION DEFINES -------------------------

${jX(re)}

`:`${G}
`;break}let ae=QE(d),me={},Le={},je={};for(let Je in p){let J=typeof p[Je]=="string"?{injection:p[Je],order:0}:p[Je],te=/^(v|f)s:(#)?([\w-]+)$/.exec(Je);if(te){let X=te[2],ye=te[3];X?ye==="decl"?Le[Je]=[J]:je[Je]=[J]:me[Je]=[J]}else je[Je]=[J]}for(let Je of a){T&&XE(Je,q,T);let J=aL(Je,n);ee+=J;let te=Je.instance?.normalizedInjections[n]||{};for(let X in te){let ye=/^(v|f)s:#([\w-]+)$/.exec(X);if(ye){let Oe=ye[2]==="decl"?Le:je;Oe[X]=Oe[X]||[],Oe[X].push(te[X])}else me[X]=me[X]||[],me[X].push(te[X])}}return ee+="// ----- MAIN SHADER SOURCE -------------------------",ee+=iL,ee=Zg(ee,n,Le),ee+=KE(ae[n],me),ee+=q,ee=Zg(ee,n,je),s==="glsl"&&B!==z&&(ee=J6(ee,n)),ee.trim()}function oL(r){return function(t){let i={};for(let n of r){let s=n.getUniforms?.(t,i);Object.assign(i,s)}return i}}function VX(r){let{id:e,source:t,stage:i}=r;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function jX(r={}){let e="";for(let t in r){let i=r[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}function aL(r,e){let t;switch(e){case"vertex":t=r.vs||"";break;case"fragment":t=r.fs||"";break;case"wgsl":t=r.source||"";break;default:u2(!1)}if(!r.name)throw new Error("Shader module must have a name");let i=r.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),n=`// ----- MODULE ${r.name} ---------------

`;return e!=="wgsl"&&(n+=`#define MODULE_${i}
`),n+=`${t}
`,n}var GX=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,HX=/^\s*\#\s*endif\s*$/;function lL(r,e){let t=r.split(`
`),i=[],n=!0,s=null;for(let a of t){let c=a.match(GX),d=a.match(HX);c?(s=c[1],n=!!e?.defines?.[s]):d?n=!0:n&&i.push(a)}return i.join(`
`)}var cp=class r{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return r.defaultShaderAssembler=r.defaultShaderAssembler||new r,r.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){let t=this._getModuleList(e.modules),i=this._hookFunctions,{source:n,getUniforms:s}=nL({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?lL(n):n,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){let t=this._getModuleList(e.modules),i=this._hookFunctions;return{...sL({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){let t=new Array(this._defaultModules.length+e.length),i={},n=0;for(let s=0,a=this._defaultModules.length;s<a;++s){let c=this._defaultModules[s],d=c.name;t[n++]=c,i[d]=!0}for(let s=0,a=e.length;s<a;++s){let c=e[s],d=c.name;i[d]||(t[n++]=c,i[d]=!0)}return t.length=n,r0(t),t}};var WX=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,$X=`#version 300 es
${WX}`;function Xg(r){let{input:e,inputChannels:t,output:i}=r||{};if(!e)return $X;if(!t)throw new Error("inputChannels");let n=qX(t),s=cL(e,t);return`#version 300 es
in ${n} ${e};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}function qX(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function cL(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}var JE=class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Mo({id:e})),this.stats.get(e)}},h2=new JE;var Vt=new da({id:"luma.gl"});var eS={};function Df(r="id"){eS[r]=eS[r]||1;let e=eS[r]++;return`${r}-${e}`}var ai=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=ZX(t,i);let n=this.props.id!=="undefined"?this.props.id:Df(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(let e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){let i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){let t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function ZX(r,e){let t={...e};for(let i in r)r[i]!==void 0&&(t[i]=r[i]);return t}var Hi=class r extends ai{static defaultProps={...ai.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){let i={...t};(t.usage||0)&r.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,r.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){let n=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:i,r.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(s):t===0&&i===n.byteLength?this.debugData=n.slice(0,s):this.debugData=n.slice(t,t+s)}};function f2(r){let e=uL[r],t=XX(e),i=r.includes("norm"),n=!i&&!r.startsWith("float"),s=r.startsWith("s");return{dataType:uL[r],byteLength:t,integer:n,signed:s,normalized:i}}function XX(r){return YX[r]}var uL={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},YX={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var Ro="texture-compression-bc",bn="texture-compression-astc",nu="texture-compression-etc2",KX="texture-compression-etc1-webgl",d2="texture-compression-pvrtc-webgl",tS="texture-compression-atc-webgl",p2="float32-renderable-webgl",rS="float16-renderable-webgl",QX="rgb9e5ufloat-renderable-webgl",iS="snorm8-renderable-webgl",Yg="norm16-renderable-webgl",nS="snorm16-renderable-webgl",A2="float32-filterable",hL="float16-filterable-webgl";function m2(r){let e=JX[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}var JX={r8unorm:{},r8snorm:{render:iS},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:iS},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:rS,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Yg},"r16snorm-webgl":{f:nS},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:iS},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:rS,filter:hL},"rg16unorm-webgl":{render:Yg},"rg16snorm-webgl":{render:nS},r32uint:{},r32sint:{},r32float:{render:p2,filter:A2},rgb9e5ufloat:{channels:"rgb",packed:!0,render:QX},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:p2},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Yg},"rgb16snorm-webgl":{f:Yg},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:A2},rgba16uint:{},rgba16sint:{},rgba16float:{render:rS,filter:hL},"rgba16unorm-webgl":{render:Yg},"rgba16snorm-webgl":{render:nS},"rgb32float-webgl":{render:p2,filter:A2},rgba32uint:{},rgba32sint:{},rgba32float:{render:p2,filter:A2},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ro},"bc1-rgb-unorm-srgb-webgl":{f:Ro},"bc1-rgba-unorm":{f:Ro},"bc1-rgba-unorm-srgb":{f:Ro},"bc2-rgba-unorm":{f:Ro},"bc2-rgba-unorm-srgb":{f:Ro},"bc3-rgba-unorm":{f:Ro},"bc3-rgba-unorm-srgb":{f:Ro},"bc4-r-unorm":{f:Ro},"bc4-r-snorm":{f:Ro},"bc5-rg-unorm":{f:Ro},"bc5-rg-snorm":{f:Ro},"bc6h-rgb-ufloat":{f:Ro},"bc6h-rgb-float":{f:Ro},"bc7-rgba-unorm":{f:Ro},"bc7-rgba-unorm-srgb":{f:Ro},"etc2-rgb8unorm":{f:nu},"etc2-rgb8unorm-srgb":{f:nu},"etc2-rgb8a1unorm":{f:nu},"etc2-rgb8a1unorm-srgb":{f:nu},"etc2-rgba8unorm":{f:nu},"etc2-rgba8unorm-srgb":{f:nu},"eac-r11unorm":{f:nu},"eac-r11snorm":{f:nu},"eac-rg11unorm":{f:nu},"eac-rg11snorm":{f:nu},"astc-4x4-unorm":{f:bn},"astc-4x4-unorm-srgb":{f:bn},"astc-5x4-unorm":{f:bn},"astc-5x4-unorm-srgb":{f:bn},"astc-5x5-unorm":{f:bn},"astc-5x5-unorm-srgb":{f:bn},"astc-6x5-unorm":{f:bn},"astc-6x5-unorm-srgb":{f:bn},"astc-6x6-unorm":{f:bn},"astc-6x6-unorm-srgb":{f:bn},"astc-8x5-unorm":{f:bn},"astc-8x5-unorm-srgb":{f:bn},"astc-8x6-unorm":{f:bn},"astc-8x6-unorm-srgb":{f:bn},"astc-8x8-unorm":{f:bn},"astc-8x8-unorm-srgb":{f:bn},"astc-10x5-unorm":{f:bn},"astc-10x5-unorm-srgb":{f:bn},"astc-10x6-unorm":{f:bn},"astc-10x6-unorm-srgb":{f:bn},"astc-10x8-unorm":{f:bn},"astc-10x8-unorm-srgb":{f:bn},"astc-10x10-unorm":{f:bn},"astc-10x10-unorm-srgb":{f:bn},"astc-12x10-unorm":{f:bn},"astc-12x10-unorm-srgb":{f:bn},"astc-12x12-unorm":{f:bn},"astc-12x12-unorm-srgb":{f:bn},"pvrtc-rgb4unorm-webgl":{f:d2},"pvrtc-rgba4unorm-webgl":{f:d2},"pvrtc-rbg2unorm-webgl":{f:d2},"pvrtc-rgba2unorm-webgl":{f:d2},"etc1-rbg-unorm-webgl":{f:KX},"atc-rgb-unorm-webgl":{f:tS},"atc-rgba-unorm-webgl":{f:tS},"atc-rgbai-unorm-webgl":{f:tS}};var eY=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],tY=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function sS(r){return eY.some(e=>r.startsWith(e))}function n0(r){let e=rY(r);if(sS(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;let i=iY(r);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}let t=tY.exec(r);if(t){let[,i,n,s,a,c]=t,d=`${s}${n}`,p=f2(d),b=p.byteLength*8,T=i.length,B=[b,T>=2?b:0,T>=3?b:0,T>=4?b:0];e={format:r,attachment:e.attachment,dataType:p.dataType,components:T,channels:i,integer:p.integer,signed:p.signed,normalized:p.normalized,bitsPerChannel:B,bytesPerPixel:p.byteLength*i.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),a==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function rY(r){let e=m2(r),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function iY(r){let t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){let[,i,n]=t;return{blockWidth:Number(i),blockHeight:Number(n)}}return null}function fL(r){let e=m2(r),t={format:r,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=n0(r),n=r.startsWith("depth")||r.startsWith("stencil"),s=i?.signed,a=i?.integer,c=i?.webgl;return t.render&&=!s,t.filter&&=!n&&!s&&!a&&!c,t}var Kg=class{},Qg=class{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}},ul=class r{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Vt.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Vt.get("debug")||void 0,debugShaders:Vt.get("debug-shaders")||void 0,debugFramebuffers:!!Vt.get("debug-framebuffers"),debugWebGL:!!Vt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...r.defaultProps,...e},this.id=this.props.id||Df(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=h2;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){let t=fL(e),i=a=>(typeof a=="string"?this.features.has(a):a)??!0,n=i(t.create),s={format:e,create:n,render:n&&i(t.render),filter:n&&i(t.filter),blend:n&&i(t.blend),store:n&&i(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return sS(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let t={...e};return(e.usage||0)&Hi.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":Vt.warn("indices buffer content must be of integer type")()),t}};var nY=qo()&&typeof document<"u",sY=()=>nY&&document.readyState==="complete",oY="set luma.log.level=1 (or higher) to trace rendering",dL="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",oS=class r{static defaultProps={...ul.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=aY().then(()=>{Vt.probe(2,"DOM is loaded")()});stats=h2;log=Vt;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Vt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Vt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Vt.error("This version of luma.gl has already been initialized")()}Vt.log(1,`${this.VERSION} - ${oY}`)(),globalThis.luma=this}registerAdapters(e){for(let t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){let t=this.getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){let t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(r.defaultProps,e)}async createDevice(e={}){e={...r.defaultProps,...e},e.waitForPageLoad&&await r.pageLoaded;let t=this.getAdapterMap(e.adapters),i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);let a=await(this.getAdapterMap(e.adapters)||t).get(i)?.create?.(e);if(a)return a;throw new Error(dL)}async attachDevice(e){let t=this.getAdapterMap(e.adapters),i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await r.pageLoaded,e.handle===null&&(i="unknown");let s=await t.get(i)?.attach?.(null);if(s)return s;throw new Error(dL)}enforceWebGL2(e=!0,t=[]){let n=this.getAdapterMap(t).get("webgl");n||Vt.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}getAdapterMap(e=[]){let t=new Map(this.preregisteredAdapters);for(let i of e)t.set(i.type,i);return t}registerDevices(e){Vt.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(let t of e){let i=t.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}},s0=new oS;function aY(){return sY()||typeof window>"u"?Promise.resolve():new Promise(r=>{window.addEventListener("load",()=>r())})}var Jg=class{};var e_=class r{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...r.defaultProps,...e},e=this.props,!qo()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=cY(e.canvas):this.canvas=e.canvas;else{let t=uY(e),i=lY(e?.container||null);i.insertBefore(t,i.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(let i of t)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{let[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){let i=this.cssToDeviceRatio(),[n,s]=this.getDrawingBufferSize();return hY(e,i,n,s,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,n="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!n)&&(Vt.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);let s=this._canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==n||s.devicePixelRatio!==e){let a=e,c=Math.floor(i*a),d=Math.floor(n*a);if(this.htmlCanvas.width=c,this.htmlCanvas.height=d,this.device.gl){let[b,T]=this.getDrawingBufferSize();(b!==c||T!==d)&&(a=Math.min(b/i,T/n),this.htmlCanvas.width=Math.floor(i*a),this.htmlCanvas.height=Math.floor(n*a),Vt.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){let e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};function lY(r){if(typeof r=="string"){let e=document.getElementById(r);if(!e)throw new Error(`${r} is not an HTML element`);return e}else if(r)return r;return document.body}function cY(r){let e=document.getElementById(r);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function uY(r){let{width:e,height:t}=r,i=document.createElement("canvas");return i.id=Df("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",i}function hY(r,e,t,i,n){let s=r,a=pL(s[0],e,t),c=AL(s[1],e,i,n),d=pL(s[0]+1,e,t),p=d===t-1?d:d-1;d=AL(s[1]+1,e,i,n);let b;return n?(d=d===0?d:d+1,b=c,c=d):b=d===i-1?d:d-1,{x:a,y:c,width:Math.max(p-a+1,1),height:Math.max(b-c+1,1)}}function pL(r,e,t){return Math.min(Math.round(r*e),t-1)}function AL(r,e,t,i){return i?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}var tn=class r extends ai{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...ai.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(t=r.normalizeProps(e,t),super(e,t,r.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){let i=r.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?r.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){let t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return r.getTextureDataSize(e[0]);if(r.isExternalImage(e))return r.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){let i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){let i={...t},n=e?.props?._resourceDefaults?.texture||{};Object.assign(i,n);let{width:s,height:a}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}};var up=class r extends ai{static defaultProps={...ai.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,r.defaultProps)}};function gL(r,e,t){let i="",n=e.split(/\r?\n/),s=r.slice().sort((a,c)=>a.lineNum-c.lineNum);switch(t?.showSourceCode||"no"){case"all":let a=0;for(let c=1;c<=n.length;c++)for(i+=_L(n[c-1],c,t);s.length>a&&s[a].lineNum===c;){let d=s[a++];i+=mL(d,n,d.lineNum,{...t,inlineSource:!1})}return i;case"issues":case"no":for(let c of r)i+=mL(c,n,c.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function mL(r,e,t,i){if(i?.inlineSource){let s=fY(e,t),a=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${s}${a}${r.type.toUpperCase()}: ${r.message}

`}let n=r.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${n};"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function fY(r,e,t){let i="";for(let n=e-2;n<=e;n++){let s=r[n-1];s!==void 0&&(i+=_L(s,e,t))}return i}function _L(r,e,t){let i=t?.html?pY(r):r;return`${dY(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function dY(r,e){let t="";for(let i=r.length;i<e;++i)t+=" ";return t+r}function pY(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var hp=class r extends ai{static defaultProps={...ai.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:AY(t),...t},r.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;let t=yL(this.source),i=`${this.stage} ${t}`,n=gL(e,this.source,{showSourceCode:"all",html:!0}),s=this.getTranslatedSource();s&&(n+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);let a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${n}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),a.onclick=()=>{let d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}};function AY(r){return yL(r.source)||r.id||Df(`unnamed ${r.stage}-shader`)}function yL(r,e="unnamed"){let i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return i?i[1]:e}var fp=class r extends ai{static defaultProps={...ai.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=r.normalizeProps(e,t),super(e,t,r.defaultProps)}static normalizeProps(e,t){let i=e?.props?._resourceDefaults?.sampler||{};return{...t,...i}}};var dp=class r extends ai{static defaultProps={...ai.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,r.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){let t=this.colorAttachments.map(n=>n.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){let[i,n]=Array.isArray(e)?e:[e.width,e.height];t=t||n!==this.height||i!==this.width,this.width=i,this.height=n}t&&(Vt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){let n=this.createColorTexture(t,i);return this.attachResource(n),n.view}return t instanceof tn?t.view:t});let e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){let t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof tn?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:tn.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:tn.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){let n=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){let i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};var su=class r extends ai{static defaultProps={...ai.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,r.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}};var t_=class r extends ai{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...ai.defaultProps,framebuffer:null,parameters:void 0,clearColor:r.defaultClearColor,clearColors:void 0,clearDepth:r.defaultClearDepth,clearStencil:r.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=r.normalizeProps(e,t),super(e,t,r.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}};var o0=class r extends ai{static defaultProps={...ai.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,r.defaultProps),this.shaderLayout=t.shaderLayout}};var r_=class r extends ai{static defaultProps={...ai.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,r.defaultProps)}};var i_=class r extends ai{static defaultProps={...ai.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,r.defaultProps)}};function xL(r){let[e,t]=gY[r],i=e==="i32"||e==="u32",n=e!=="u32",s=_Y[e]*t,a=mY(e,t);return{dataType:e,components:t,defaultVertexFormat:a,byteLength:s,integer:i,signed:n}}function mY(r,e){let t;switch(r){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}var gY={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},_Y={f32:4,f16:2,i32:4,u32:4};function aS(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);let[t,i]=r.split("x"),n=t,s=i?parseInt(i):1,a=f2(n),c={type:n,components:s,byteLength:a.byteLength*s,integer:a.integer,signed:a.signed,normalized:a.normalized};return e&&(c.webglOnly=!0),c}function g2(r,e){let t={};for(let i of r.attributes){let n=yY(r,e,i.name);n&&(t[i.name]=n)}return t}function bL(r,e,t=16){let i=g2(r,e),n=new Array(t).fill(null);for(let s of Object.values(i))n[s.location]=s;return n}function yY(r,e,t){let i=xY(r,t),n=bY(e,t);if(!i)return null;let s=xL(i.type),a=n?.vertexFormat||s.defaultVertexFormat,c=aS(a);return{attributeName:n?.attributeName||i.name,bufferName:n?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:a,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:s.integer,stepMode:n?.stepMode||i.stepMode||"vertex",byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}function xY(r,e){let t=r.attributes.find(i=>i.name===e);return t||Vt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function bY(r,e){vY(r);let t=wY(r,e);return t||(t=TY(r,e),t)?t:(Vt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function vY(r){for(let e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&Vt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function wY(r,e){for(let t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function TY(r,e){for(let t of r){let i=t.byteStride;if(typeof t.byteStride!="number")for(let s of t.attributes||[]){let a=aS(s.format);i+=a.byteLength}let n=t.attributes?.find(s=>s.attribute===e);if(n)return{attributeName:n.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:i}}return null}var n_=class r extends ai{static defaultProps={...ai.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,r.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);let{shaderLayout:i,bufferLayout:n}=t.renderPipeline||{};if(!i||!n)throw new Error("VertexArray");this.attributeInfos=bL(i,n,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}};var s_=class r extends ai{static defaultProps={...ai.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,r.defaultProps)}};var o_=class r extends ai{static defaultProps={...ai.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,r.defaultProps)}};var EY={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function vL(r){return EY[r]}function wL(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}var _2;function lS(r){return(!_2||_2.byteLength<r)&&(_2=new ArrayBuffer(r)),_2}function cS(r,e){let t=lS(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function SY(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function a0(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":SY(r)}var TL=1024,y2=class{layout={};byteLength;constructor(e){let t=0;for(let[n,s]of Object.entries(e)){let a=vL(s),{type:c,components:d}=a;t=wL(t,d);let p=t;t+=d,this.layout[n]={type:c,size:d,offset:p}}t+=(4-t%4)%4;let i=t*4;this.byteLength=Math.max(i,TL)}getData(e){let t=Math.max(this.byteLength,TL),i=lS(t),n={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(let[s,a]of Object.entries(e)){let c=this.layout[s];if(!c){Vt.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}let{type:d,size:p,offset:b}=c,T=n[d];if(p===1){if(typeof a!="number"&&typeof a!="boolean"){Vt.warn(`Supplied value for single component uniform ${s} is not a number: ${a}`)();continue}T[b]=Number(a)}else{if(!a0(a)){Vt.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${a}`)();continue}T.set(a,b)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}};function EL(r,e,t=16){if(r!==e)return!1;let i=r,n=e;if(!a0(i))return!1;if(a0(n)&&i.length===n.length){for(let s=0;s<i.length;++s)if(n[s]!==i[s])return!1}return!0}function SL(r){return a0(r)?r.slice():r}var x2=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){let t=e?.shaderLayout.bindings?.find(n=>n.type==="uniform"&&n.name===e?.name);if(!t)throw new Error(e?.name);let i=t;for(let n of i.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(let[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){EL(this.uniforms[e],t)||(this.uniforms[e]=SL(t),this.modifiedUniforms[e]=!0,this.modified=!0)}};var a_=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(let[t,i]of Object.entries(e)){let n=t,s=new y2(i.uniformTypes||{});this.uniformBufferLayouts.set(n,s);let a=new x2({name:t});a.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,a)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);let n=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Hi.UNIFORM|Hi.COPY_DST,byteLength:n}),a=this.getUniformBufferData(t);return s.write(a),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){let i=this.getUniformBufferByteLength(t),n=e.createBuffer({usage:Hi.UNIFORM|Hi.COPY_DST,byteLength:i});this.uniformBuffers.set(t,n)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(let t of this.uniformBlocks.keys()){let i=this.updateUniformBuffer(t);e||=i}return e&&Vt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let t=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e),n=!1;if(i&&t?.needsRedraw){n||=t.needsRedraw;let s=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(s);let a=this.uniformBlocks.get(e)?.getAllUniforms();Vt.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return n}};function b2(r){let e=ArrayBuffer.isView(r)?r.constructor:r;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function l_(r){switch(r){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(r)}}function uS(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);let i=e,n=b2(r);if(n==="uint8"&&t&&i===1)return"unorm8-webgl";if(n==="uint8"&&t&&i===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(n=n.replace("int","norm")),`${n}x${i}`}if(n==="uint16"||n==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(n=n.replace("int","norm")),`${n}x${i}`}return i===1?n:`${n}x${i}`}var pp=class{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){let i=[...e];for(let n of t){let s=i.findIndex(a=>a.name===n.name);s<0?i.push(n):i[s]=n}return i}getBufferIndex(e){let t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&Vt.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}};function hS(r,e){let t=Object.fromEntries(r.attributes.map(n=>[n.name,n.location])),i=e.slice();return i.sort((n,s)=>{let a=n.attributes?n.attributes.map(b=>b.attribute):[n.name],c=s.attributes?s.attributes.map(b=>b.attribute):[s.name],d=Math.min(...a.map(b=>t[b])),p=Math.min(...c.map(b=>t[b]));return d-p}),i}var pa=class{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}},v2=class{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},ou=class extends pa{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},au=class extends pa{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}},hh=class extends pa{constructor(e,t,i,n){super(e,i),this.format=t,this.access=n}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}},kf;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(kf||(kf={}));var l0=class{constructor(e,t,i,n,s,a,c){this.name=e,this.type=t,this.group=i,this.binding=n,this.attributes=s,this.resourceType=a,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},pS=class{constructor(e,t){this.name=e,this.type=t}},AS=class{constructor(e,t,i,n){this.name=e,this.type=t,this.locationType=i,this.location=n,this.interpolation=null}},w2=class{constructor(e,t,i,n){this.name=e,this.type=t,this.locationType=i,this.location=n}},mS=class{constructor(e,t,i,n){this.name=e,this.type=t,this.attributes=i,this.id=n}},gS=class{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}},_S=class{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}},yS=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},PL=new Float32Array(1),CY=new Int32Array(PL.buffer),Bo=new Uint16Array(1);function IY(r){PL[0]=r;let e=CY[0],t=e>>31&1,i=e>>23&255,n=8388607&e;if(i===255)return Bo[0]=t<<15|31744|(n!==0?512:0),Bo[0];if(i===0){if(n===0)return Bo[0]=t<<15,Bo[0];n|=8388608;let s=113;for(;!(8388608&n);)n<<=1,s--;return i=127-s,n&=8388607,i>0?(n=(n>>126-i)+(n>>127-i&1),Bo[0]=t<<15|i<<10|n>>13,Bo[0]):(Bo[0]=t<<15,Bo[0])}return i=i-127+15,i>=31?(Bo[0]=t<<15|31744,Bo[0]):i<=0?i<-10?(Bo[0]=t<<15,Bo[0]):(n=(8388608|n)>>1-i,Bo[0]=t<<15|n>>13,Bo[0]):(n>>=13,Bo[0]=t<<15|i<<10|n,Bo[0])}var OS=new Uint32Array(1),ML=new Float32Array(OS.buffer,0,1);function CL(r){let e=112+(r>>6&31)<<23|(63&r)<<17;return OS[0]=e,ML[0]}function PY(r,e,t,i,n,s,a,c,d){let p=i*(a>>=n)*(s>>=n)+t*a+e*c;switch(d){case"r8unorm":return[rn(r,p,"8unorm",1)[0]];case"r8snorm":return[rn(r,p,"8snorm",1)[0]];case"r8uint":return[rn(r,p,"8uint",1)[0]];case"r8sint":return[rn(r,p,"8sint",1)[0]];case"rg8unorm":{let b=rn(r,p,"8unorm",2);return[b[0],b[1]]}case"rg8snorm":{let b=rn(r,p,"8snorm",2);return[b[0],b[1]]}case"rg8uint":{let b=rn(r,p,"8uint",2);return[b[0],b[1]]}case"rg8sint":{let b=rn(r,p,"8sint",2);return[b[0],b[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let b=rn(r,p,"8unorm",4);return[b[0],b[1],b[2],b[3]]}case"rgba8snorm":{let b=rn(r,p,"8snorm",4);return[b[0],b[1],b[2],b[3]]}case"rgba8uint":{let b=rn(r,p,"8uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba8sint":{let b=rn(r,p,"8sint",4);return[b[0],b[1],b[2],b[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let b=rn(r,p,"8unorm",4);return[b[2],b[1],b[0],b[3]]}case"r16uint":return[rn(r,p,"16uint",1)[0]];case"r16sint":return[rn(r,p,"16sint",1)[0]];case"r16float":return[rn(r,p,"16float",1)[0]];case"rg16uint":{let b=rn(r,p,"16uint",2);return[b[0],b[1]]}case"rg16sint":{let b=rn(r,p,"16sint",2);return[b[0],b[1]]}case"rg16float":{let b=rn(r,p,"16float",2);return[b[0],b[1]]}case"rgba16uint":{let b=rn(r,p,"16uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba16sint":{let b=rn(r,p,"16sint",4);return[b[0],b[1],b[2],b[3]]}case"rgba16float":{let b=rn(r,p,"16float",4);return[b[0],b[1],b[2],b[3]]}case"r32uint":return[rn(r,p,"32uint",1)[0]];case"r32sint":return[rn(r,p,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[rn(r,p,"32float",1)[0]];case"rg32uint":{let b=rn(r,p,"32uint",2);return[b[0],b[1]]}case"rg32sint":{let b=rn(r,p,"32sint",2);return[b[0],b[1]]}case"rg32float":{let b=rn(r,p,"32float",2);return[b[0],b[1]]}case"rgba32uint":{let b=rn(r,p,"32uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba32sint":{let b=rn(r,p,"32sint",4);return[b[0],b[1],b[2],b[3]]}case"rgba32float":{let b=rn(r,p,"32float",4);return[b[0],b[1],b[2],b[3]]}case"rg11b10ufloat":{let b=new Uint32Array(r.buffer,p,1)[0],T=(4192256&b)>>11,B=(4290772992&b)>>22;return[CL(2047&b),CL(T),function(z){let G=112+(z>>5&31)<<23|(31&z)<<18;return OS[0]=G,ML[0]}(B),1]}}return null}function rn(r,e,t,i){let n=[0,0,0,0];for(let p=0;p<i;++p)switch(t){case"8unorm":n[p]=r[e]/255,e++;break;case"8snorm":n[p]=r[e]/255*2-1,e++;break;case"8uint":n[p]=r[e],e++;break;case"8sint":n[p]=r[e]-127,e++;break;case"16uint":n[p]=r[e]|r[e+1]<<8,e+=2;break;case"16sint":n[p]=(r[e]|r[e+1]<<8)-32768,e+=2;break;case"16float":n[p]=(s=r[e]|r[e+1]<<8,a=void 0,c=void 0,d=void 0,a=(32768&s)>>15,d=1023&s,(c=(31744&s)>>10)==0?(a?-1:1)*Math.pow(2,-14)*(d/Math.pow(2,10)):c==31?d?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,c-15)*(1+d/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":n[p]=r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24,e+=4;break;case"32float":n[p]=new Float32Array(r.buffer,e,1)[0],e+=4}var s,a,c,d;return n}function cn(r,e,t,i,n){for(let s=0;s<i;++s)switch(t){case"8unorm":r[e]=255*n[s],e++;break;case"8snorm":r[e]=.5*(n[s]+1)*255,e++;break;case"8uint":r[e]=n[s],e++;break;case"8sint":r[e]=n[s]+127,e++;break;case"16uint":new Uint16Array(r.buffer,e,1)[0]=n[s],e+=2;break;case"16sint":new Int16Array(r.buffer,e,1)[0]=n[s],e+=2;break;case"16float":{let a=IY(n[s]);new Uint16Array(r.buffer,e,1)[0]=a,e+=2;break}case"32uint":new Uint32Array(r.buffer,e,1)[0]=n[s],e+=4;break;case"32sint":new Int32Array(r.buffer,e,1)[0]=n[s],e+=4;break;case"32float":new Float32Array(r.buffer,e,1)[0]=n[s],e+=4}return n}var fS={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}},fl=class r{constructor(){this.id=r._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(p0.instance);for(let i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(A0.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}};fl._id=0;var p0=class extends fl{};p0.instance=new p0;var A0=class extends fl{};A0.instance=new A0;var RL=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]),Dn=class extends fl{constructor(){super()}},yp=class extends Dn{constructor(e,t,i,n,s,a){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=n,this.startLine=s,this.endLine=a}get astNodeType(){return"function"}search(e){if(this.attributes)for(let t of this.attributes)e(t);e(this);for(let t of this.args)e(t);this.searchBlock(this.body,e)}},xS=class extends Dn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},T2=class extends Dn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},h_=class extends Dn{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}},E2=class extends Dn{constructor(e,t,i,n){super(),this.init=e,this.condition=t,this.increment=i,this.body=n}get astNodeType(){return"for"}search(e){var t,i,n;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}},ac=class extends Dn{constructor(e,t,i,n,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},f_=class extends Dn{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},mp=class extends Dn{constructor(e,t,i,n,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},h0=class extends Dn{constructor(e,t,i,n,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},c0,c_,vt,ct;(r=>{r.increment="++",r.decrement="--"})(c0||(c0={})),(r=>{r.parse=function(e){let t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(c0||(c0={}));var S2=class extends Dn{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(c_||(c_={})),(r=>{r.parse=function(e){let t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(c_||(c_={}));var C2=class extends Dn{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},d_=class extends Dn{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return RL.has(this.name)}search(e){for(let t of this.args)t.search(e);e(this)}},I2=class extends Dn{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}},P2=class extends Dn{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}},M2=class extends Dn{constructor(e,t,i,n){super(),this.condition=e,this.body=t,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},R2=class extends Dn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},bS=class extends Dn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},vS=class extends Dn{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},B2=class extends Dn{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}},p_=class extends Dn{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}},wS=class extends Dn{constructor(){super()}get astNodeType(){return"discard"}},L2=class extends Dn{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}},O2=class extends Dn{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},Zt=class r extends Dn{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){let n=r._priority.get(t.name);r._priority.get(e[i].name)<n&&(t=e[i])}return t.name==="x32"?r.i32:t}getTypeName(){return this.name}};Zt.x32=new Zt("x32"),Zt.f32=new Zt("f32"),Zt.i32=new Zt("i32"),Zt.u32=new Zt("u32"),Zt.f16=new Zt("f16"),Zt.bool=new Zt("bool"),Zt.void=new Zt("void"),Zt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var D2=class extends Zt{constructor(e){super(e)}},oc=class extends Zt{constructor(e,t,i,n){super(e),this.members=t,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(let t of this.members)e(t)}},pt=class extends Zt{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};pt.vec2f=new pt("vec2",Zt.f32,null),pt.vec3f=new pt("vec3",Zt.f32,null),pt.vec4f=new pt("vec4",Zt.f32,null),pt.vec2i=new pt("vec2",Zt.i32,null),pt.vec3i=new pt("vec3",Zt.i32,null),pt.vec4i=new pt("vec4",Zt.i32,null),pt.vec2u=new pt("vec2",Zt.u32,null),pt.vec3u=new pt("vec3",Zt.u32,null),pt.vec4u=new pt("vec4",Zt.u32,null),pt.vec2h=new pt("vec2",Zt.f16,null),pt.vec3h=new pt("vec3",Zt.f16,null),pt.vec4h=new pt("vec4",Zt.f16,null),pt.vec2b=new pt("vec2",Zt.bool,null),pt.vec3b=new pt("vec3",Zt.bool,null),pt.vec4b=new pt("vec4",Zt.bool,null),pt.mat2x2f=new pt("mat2x2",Zt.f32,null),pt.mat2x3f=new pt("mat2x3",Zt.f32,null),pt.mat2x4f=new pt("mat2x4",Zt.f32,null),pt.mat3x2f=new pt("mat3x2",Zt.f32,null),pt.mat3x3f=new pt("mat3x3",Zt.f32,null),pt.mat3x4f=new pt("mat3x4",Zt.f32,null),pt.mat4x2f=new pt("mat4x2",Zt.f32,null),pt.mat4x3f=new pt("mat4x3",Zt.f32,null),pt.mat4x4f=new pt("mat4x4",Zt.f32,null),pt.mat2x2h=new pt("mat2x2",Zt.f16,null),pt.mat2x3h=new pt("mat2x3",Zt.f16,null),pt.mat2x4h=new pt("mat2x4",Zt.f16,null),pt.mat3x2h=new pt("mat3x2",Zt.f16,null),pt.mat3x3h=new pt("mat3x3",Zt.f16,null),pt.mat3x4h=new pt("mat3x4",Zt.f16,null),pt.mat4x2h=new pt("mat4x2",Zt.f16,null),pt.mat4x3h=new pt("mat4x3",Zt.f16,null),pt.mat4x4h=new pt("mat4x4",Zt.f16,null),pt.mat2x2i=new pt("mat2x2",Zt.i32,null),pt.mat2x3i=new pt("mat2x3",Zt.i32,null),pt.mat2x4i=new pt("mat2x4",Zt.i32,null),pt.mat3x2i=new pt("mat3x2",Zt.i32,null),pt.mat3x3i=new pt("mat3x3",Zt.i32,null),pt.mat3x4i=new pt("mat3x4",Zt.i32,null),pt.mat4x2i=new pt("mat4x2",Zt.i32,null),pt.mat4x3i=new pt("mat4x3",Zt.i32,null),pt.mat4x4i=new pt("mat4x4",Zt.i32,null),pt.mat2x2u=new pt("mat2x2",Zt.u32,null),pt.mat2x3u=new pt("mat2x3",Zt.u32,null),pt.mat2x4u=new pt("mat2x4",Zt.u32,null),pt.mat3x2u=new pt("mat3x2",Zt.u32,null),pt.mat3x3u=new pt("mat3x3",Zt.u32,null),pt.mat3x4u=new pt("mat3x4",Zt.u32,null),pt.mat4x2u=new pt("mat4x2",Zt.u32,null),pt.mat4x3u=new pt("mat4x3",Zt.u32,null),pt.mat4x4u=new pt("mat4x4",Zt.u32,null);var u_=class extends Zt{constructor(e,t,i,n){super(e),this.storage=t,this.type=i,this.access=n}get astNodeType(){return"pointer"}},gp=class extends Zt{constructor(e,t,i,n){super(e),this.attributes=t,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}},Ap=class extends Zt{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}},dl=class extends fl{constructor(){super(),this.postfix=null}},fh=class extends dl{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},hl=class extends dl{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}},A_=class extends dl{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return RL.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(let t of this.args)t.search(e);e(this)}},Xo=class extends dl{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}},k2=class extends dl{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){let i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}},As=class extends dl{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof ht}get isVector(){return this.value instanceof Fe||this.value instanceof $r}get scalarValue(){return this.value instanceof ht?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Fe||this.value instanceof $r?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}},F2=class extends dl{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}};var Nf=class extends dl{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},N2=class extends dl{constructor(){super()}},ns=class extends N2{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}},Va=class extends N2{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Zt.f32:e.name==="u32"||t.name==="u32"?Zt.u32:Zt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}},z2=class extends fl{constructor(e){super(),this.body=e}},f0=class extends dl{constructor(){super()}get astNodeType(){return"default"}},U2=class extends z2{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},V2=class extends z2{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},j2=class extends fl{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}},TS=class extends fl{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},G2=class extends fl{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}},H2=class extends fl{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}},pl=class r{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=r._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,n){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}};pl._id=0;var m_=class extends pl{constructor(){super(new pa("void",null),null)}toString(){return"void"}};m_.void=new m_;var Ff=class extends pl{constructor(e){super(new pa("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,n){this.reference.setDataValue(e,t,i,n)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}},ht=class r extends pl{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new r(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new r(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new r(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,n){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof r))return void console.error("SetDataValue: Invalid value",t);let s=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}};function MY(r,e,t){let i=e.length;return i===2?t==="f32"?new Fe(new Float32Array(e),r.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new Fe(new Int32Array(e),r.getTypeInfo("vec2i")):t==="u32"?new Fe(new Uint32Array(e),r.getTypeInfo("vec2u")):t==="f16"?new Fe(new Float32Array(e),r.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new Fe(new Float32Array(e),r.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new Fe(new Int32Array(e),r.getTypeInfo("vec3i")):t==="u32"?new Fe(new Uint32Array(e),r.getTypeInfo("vec3u")):t==="f16"?new Fe(new Float32Array(e),r.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new Fe(new Float32Array(e),r.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new Fe(new Int32Array(e),r.getTypeInfo("vec4i")):t==="u32"?new Fe(new Uint32Array(e),r.getTypeInfo("vec4u")):t==="f16"?new Fe(new Float32Array(e),r.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}var Fe=class r extends pl{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{let n=this.typeInfo.name;n==="vec2f"||n==="vec3f"||n==="vec4f"?this.data=new Float32Array(e):n==="vec2i"||n==="vec3i"||n==="vec4i"?this.data=new Int32Array(e):n==="vec2u"||n==="vec3u"||n==="vec4u"?this.data=new Uint32Array(e):n==="vec2h"||n==="vec3h"||n==="vec4h"?this.data=new Float32Array(e):n==="vec2b"||n==="vec3b"||n==="vec4b"?this.data=new Int32Array(e):n==="vec2"||n==="vec3"||n==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${n}`)}}clone(){if(this.data instanceof Float32Array)return new r(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new r(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new r(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,n){i instanceof fh?console.error("TODO: Set vector postfix"):t instanceof r?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let n=e.getTypeInfo("f32");if(this.typeInfo instanceof hh)n=this.typeInfo.format||n;else{let a=this.typeInfo.name;a==="vec2f"||a==="vec3f"||a==="vec4f"?n=e.getTypeInfo("f32"):a==="vec2i"||a==="vec3i"||a==="vec4i"?n=e.getTypeInfo("i32"):a==="vec2b"||a==="vec3b"||a==="vec4b"?n=e.getTypeInfo("bool"):a==="vec2u"||a==="vec3u"||a==="vec4u"?n=e.getTypeInfo("u32"):a==="vec2h"||a==="vec3h"||a==="vec4h"?n=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${a}`)}let s=this;for(;t!==null&&s!==null;){if(t instanceof Nf){let a=t.index,c=-1;if(a instanceof As){if(!(a.value instanceof ht))return console.error(`GetSubData: Invalid array index ${a.value}`),null;c=a.value.value}else{let d=e.evalExpression(a,i);if(!(d instanceof ht))return console.error("GetSubData: Unknown index type",a),null;c=d.value}if(c<0||c>=s.data.length)return console.error("GetSubData: Index out of range",c),null;if(s.data instanceof Float32Array){let d=new Float32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ht(d,n)}if(s.data instanceof Int32Array){let d=new Int32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ht(d,n)}if(s.data instanceof Uint32Array){let d=new Uint32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ht(d,n)}throw"GetSubData: Invalid data type"}if(!(t instanceof fh))return console.error("GetSubData: Unknown postfix",t),null;{let a=t.value.toLowerCase();if(a.length===1){let d=0;if(a==="x"||a==="r")d=0;else if(a==="y"||a==="g")d=1;else if(a==="z"||a==="b")d=2;else{if(a!=="w"&&a!=="a")return console.error(`GetSubData: Unknown member ${a}`),null;d=3}if(this.data instanceof Float32Array){let p=new Float32Array(this.data.buffer,this.data.byteOffset+4*d,1);return new ht(p,n,this)}if(this.data instanceof Int32Array){let p=new Int32Array(this.data.buffer,this.data.byteOffset+4*d,1);return new ht(p,n,this)}if(this.data instanceof Uint32Array){let p=new Uint32Array(this.data.buffer,this.data.byteOffset+4*d,1);return new ht(p,n,this)}}let c=[];for(let d of a)d==="x"||d==="r"?c.push(this.data[0]):d==="y"||d==="g"?c.push(this.data[1]):d==="z"||d==="b"?c.push(this.data[2]):d==="w"||d==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${d}`);s=MY(e,c,n.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},$r=class r extends pl{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new r(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,n){i instanceof fh?console.error("TODO: Set matrix postfix"):t instanceof r?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let n=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof hh)this.typeInfo.format;else if(n.endsWith("f"))e.getTypeInfo("f32");else if(n.endsWith("i"))e.getTypeInfo("i32");else if(n.endsWith("u"))e.getTypeInfo("u32");else{if(!n.endsWith("h"))return console.error(`GetDataValue: Unknown type ${n}`),null;e.getTypeInfo("f16")}if(t instanceof Nf){let s=t.index,a=-1;if(s instanceof As){if(!(s.value instanceof ht))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;a=s.value.value}else{let p=e.evalExpression(s,i);if(!(p instanceof ht))return console.error("GetDataValue: Unknown index type",s),null;a=p.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;let c=n.endsWith("h")?"h":"f",d;if(n==="mat2x2"||n==="mat2x2f"||n==="mat2x2h"||n==="mat3x2"||n==="mat3x2f"||n==="mat3x2h"||n==="mat4x2"||n==="mat4x2f"||n==="mat4x2h")d=new Fe(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),e.getTypeInfo(`vec2${c}`));else if(n==="mat2x3"||n==="mat2x3f"||n==="mat2x3h"||n==="mat3x3"||n==="mat3x3f"||n==="mat3x3h"||n==="mat4x3"||n==="mat4x3f"||n==="mat4x3h")d=new Fe(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),e.getTypeInfo(`vec3${c}`));else{if(n!=="mat2x4"&&n!=="mat2x4f"&&n!=="mat2x4h"&&n!=="mat3x4"&&n!=="mat3x4f"&&n!=="mat3x4h"&&n!=="mat4x4"&&n!=="mat4x4f"&&n!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${n}`),null;d=new Fe(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),e.getTypeInfo(`vec4${c}`))}return t.postfix?d.getSubData(e,t.postfix,i):d}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},Rs=class r extends pl{constructor(e,t,i=0,n=null){super(t,n),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){let e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new r(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,n){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,a=this.typeInfo;for(;i;){if(i instanceof Nf)if(a instanceof au){let c=i.index;if(c instanceof As){if(!(c.value instanceof ht))return void console.error(`SetDataValue: Invalid index type ${c.value}`);s+=c.value.value*a.stride}else{let d=e.evalExpression(c,n);if(!(d instanceof ht))return void console.error("SetDataValue: Unknown index type",c);s+=d.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${a.getTypeName()} is not an array`);else{if(!(i instanceof fh))return void console.error("SetDataValue: Unknown postfix type",i);{let c=i.value;if(a instanceof ou){let d=!1;for(let p of a.members)if(p.name===c){s+=p.offset,a=p.type,d=!0;break}if(!d)return void console.error(`SetDataValue: Member ${c} not found`)}else if(a instanceof pa){let d=a.getTypeName(),p=0;if(c==="x"||c==="r")p=0;else if(c==="y"||c==="g")p=1;else if(c==="z"||c==="b")p=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);p=3}if(!(t instanceof ht))return void console.error("SetDataValue: Invalid value",t);let b=t.value;return d==="vec2f"?void(new Float32Array(this.buffer,s,2)[p]=b):d==="vec3f"?void(new Float32Array(this.buffer,s,3)[p]=b):d==="vec4f"?void(new Float32Array(this.buffer,s,4)[p]=b):d==="vec2i"?void(new Int32Array(this.buffer,s,2)[p]=b):d==="vec3i"?void(new Int32Array(this.buffer,s,3)[p]=b):d==="vec4i"?void(new Int32Array(this.buffer,s,4)[p]=b):d==="vec2u"?void(new Uint32Array(this.buffer,s,2)[p]=b):d==="vec3u"?void(new Uint32Array(this.buffer,s,3)[p]=b):d==="vec4u"?void(new Uint32Array(this.buffer,s,4)[p]=b):void console.error(`SetDataValue: Type ${d} is not a struct`)}}}i=i.postfix}this.setData(e,t,a,s,n)}setData(e,t,i,n,s){let a=i.getTypeName();if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool")if(a!=="vec2f"&&a!=="vec2h")if(a!=="vec3f"&&a!=="vec3h")if(a!=="vec4f"&&a!=="vec4h")if(a!=="vec2i")if(a!=="vec3i")if(a!=="vec4i")if(a!=="vec2u")if(a!=="vec3u")if(a!=="vec4u")if(a!=="vec2b")if(a!=="vec3b")if(a!=="vec4b")if(a!=="mat2x2f"&&a!=="mat2x2h")if(a!=="mat2x3f"&&a!=="mat2x3h")if(a!=="mat2x4f"&&a!=="mat2x4h")if(a!=="mat3x2f"&&a!=="mat3x2h")if(a!=="mat3x3f"&&a!=="mat3x3h")if(a!=="mat3x4f"&&a!=="mat3x4h")if(a!=="mat4x2f"&&a!=="mat4x2h")if(a!=="mat4x3f"&&a!=="mat4x3h")if(a!=="mat4x4f"&&a!=="mat4x4h")if(t instanceof r){if(i===t.typeInfo)return void new Uint8Array(this.buffer,n,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",a,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${a}`);else{let c=new Float32Array(this.buffer,n,16);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11],c[12]=t.data[12],c[13]=t.data[13],c[14]=t.data[14],c[15]=t.data[15]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11],c[12]=t[12],c[13]=t[13],c[14]=t[14],c[15]=t[15])}else{let c=new Float32Array(this.buffer,n,12);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{let c=new Float32Array(this.buffer,n,8);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{let c=new Float32Array(this.buffer,n,12);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{let c=new Float32Array(this.buffer,n,9);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8])}else{let c=new Float32Array(this.buffer,n,6);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{let c=new Float32Array(this.buffer,n,8);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{let c=new Float32Array(this.buffer,n,6);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{let c=new Float32Array(this.buffer,n,4);t instanceof $r?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{let c=new Uint32Array(this.buffer,n,4);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{let c=new Uint32Array(this.buffer,n,3);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{let c=new Uint32Array(this.buffer,n,2);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{let c=new Uint32Array(this.buffer,n,4);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{let c=new Uint32Array(this.buffer,n,3);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{let c=new Uint32Array(this.buffer,n,2);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{let c=new Int32Array(this.buffer,n,4);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{let c=new Int32Array(this.buffer,n,3);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{let c=new Int32Array(this.buffer,n,2);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{let c=new Float32Array(this.buffer,n,4);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{let c=new Float32Array(this.buffer,n,3);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{let c=new Float32Array(this.buffer,n,2);t instanceof Fe?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else t instanceof ht&&(new Int32Array(this.buffer,n,1)[0]=t.value);else t instanceof ht&&(new Uint32Array(this.buffer,n,1)[0]=t.value);else t instanceof ht&&(new Int32Array(this.buffer,n,1)[0]=t.value);else t instanceof ht&&(new Float32Array(this.buffer,n,1)[0]=t.value)}getSubData(e,t,i){var n,s,a;if(t===null)return this;let c=this.offset,d=this.typeInfo;for(;t;){if(t instanceof Nf){let b=t.index,T=e.evalExpression(b,i),B=0;if(T instanceof ht?B=T.value:console.error("GetDataValue: Invalid index type",b),d instanceof au)c+=B*d.stride,d=d.format;else{let z=d.getTypeName();z==="mat4x4"||z==="mat4x4f"||z==="mat4x4h"?(c+=16*B,d=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${d.getTypeName()} is not an array`)}}else{if(!(t instanceof fh))return console.error("GetDataValue: Unknown postfix type",t),null;{let b=t.value;if(d instanceof ou){let T=!1;for(let B of d.members)if(B.name===b){c+=B.offset,d=B.type,T=!0;break}if(!T)return console.error(`GetDataValue: Member ${b} not found`),null}else if(d instanceof pa){let T=d.getTypeName();if(T==="vec2f"||T==="vec3f"||T==="vec4f"||T==="vec2i"||T==="vec3i"||T==="vec4i"||T==="vec2u"||T==="vec3u"||T==="vec4u"||T==="vec2b"||T==="vec3b"||T==="vec4b"||T==="vec2h"||T==="vec3h"||T==="vec4h"||T==="vec2"||T==="vec3"||T==="vec4"){if(b.length>0&&b.length<5){let B="f",z=[];for(let G=0;G<b.length;++G){let Z=b[G].toLowerCase(),q=0;if(Z==="x"||Z==="r")q=0;else if(Z==="y"||Z==="g")q=1;else if(Z==="z"||Z==="b")q=2;else{if(Z!=="w"&&Z!=="a")return console.error(`Unknown member ${b}`),null;q=3}if(b.length===1){if(T.endsWith("f"))return this.buffer.byteLength<c+4*q+4?(console.log("Insufficient buffer data"),null):new ht(new Float32Array(this.buffer,c+4*q,1),e.getTypeInfo("f32"),this);if(T.endsWith("h"))return new ht(new Float32Array(this.buffer,c+4*q,1),e.getTypeInfo("f16"),this);if(T.endsWith("i"))return new ht(new Int32Array(this.buffer,c+4*q,1),e.getTypeInfo("i32"),this);if(T.endsWith("b"))return new ht(new Int32Array(this.buffer,c+4*q,1),e.getTypeInfo("bool"),this);if(T.endsWith("u"))return new ht(new Uint32Array(this.buffer,c+4*q,1),e.getTypeInfo("i32"),this)}if(T==="vec2f")z.push(new Float32Array(this.buffer,c,2)[q]);else if(T==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let re=new Float32Array(this.buffer,c,3);z.push(re[q])}else if(T==="vec4f")z.push(new Float32Array(this.buffer,c,4)[q]);else if(T==="vec2i")B="i",z.push(new Int32Array(this.buffer,c,2)[q]);else if(T==="vec3i")B="i",z.push(new Int32Array(this.buffer,c,3)[q]);else if(T==="vec4i")B="i",z.push(new Int32Array(this.buffer,c,4)[q]);else if(T==="vec2u"){B="u";let re=new Uint32Array(this.buffer,c,2);z.push(re[q])}else T==="vec3u"?(B="u",z.push(new Uint32Array(this.buffer,c,3)[q])):T==="vec4u"&&(B="u",z.push(new Uint32Array(this.buffer,c,4)[q]))}return z.length===2?d=e.getTypeInfo(`vec2${B}`):z.length===3?d=e.getTypeInfo(`vec3${B}`):z.length===4?d=e.getTypeInfo(`vec4${B}`):console.error(`GetDataValue: Invalid vector length ${z.length}`),new Fe(z,d,null)}return console.error(`GetDataValue: Unknown member ${b}`),null}return console.error(`GetDataValue: Type ${T} is not a struct`),null}}}t=t.postfix}let p=d.getTypeName();return p==="f32"?new ht(new Float32Array(this.buffer,c,1),d,this):p==="i32"?new ht(new Int32Array(this.buffer,c,1),d,this):p==="u32"?new ht(new Uint32Array(this.buffer,c,1),d,this):p==="vec2f"?new Fe(new Float32Array(this.buffer,c,2),d,this):p==="vec3f"?new Fe(new Float32Array(this.buffer,c,3),d,this):p==="vec4f"?new Fe(new Float32Array(this.buffer,c,4),d,this):p==="vec2i"?new Fe(new Int32Array(this.buffer,c,2),d,this):p==="vec3i"?new Fe(new Int32Array(this.buffer,c,3),d,this):p==="vec4i"?new Fe(new Int32Array(this.buffer,c,4),d,this):p==="vec2u"?new Fe(new Uint32Array(this.buffer,c,2),d,this):p==="vec3u"?new Fe(new Uint32Array(this.buffer,c,3),d,this):p==="vec4u"?new Fe(new Uint32Array(this.buffer,c,4),d,this):d instanceof hh&&d.name==="atomic"?((n=d.format)===null||n===void 0?void 0:n.name)==="u32"?new ht(new Uint32Array(this.buffer,c,1)[0],d.format,this):((s=d.format)===null||s===void 0?void 0:s.name)==="i32"?new ht(new Int32Array(this.buffer,c,1)[0],d.format,this):(console.error(`GetDataValue: Invalid atomic format ${(a=d.format)===null||a===void 0?void 0:a.name}`),null):new r(this.buffer,d,c,this)}toString(){let e="";if(this.typeInfo instanceof au)if(this.typeInfo.format.name==="f32"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){let t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){let t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof ou?e+="{...}":e="[...]";return e}},uh=class r extends pl{constructor(e,t,i,n){super(t,null),this.data=e,this.descriptor=i,this.view=n}clone(){return new r(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;let i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;let i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;let i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];let t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){let e=this.format,t=fS[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let e=this.format,t=fS[e];return!!t&&t.isDepthStencil}getGpuSize(){let e=this.format,t=fS[e],i=this.width;if(!e||i<=0||!t)return-1;let n=this.height,s=this.depthOrArrayLayers,a=this.dimension;return i/t.blockWidth*(a==="1d"?1:n/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,i=0,n=0){let s=this.texelByteSize,a=this.bytesPerRow,c=this.height,d=this.data[n];return PY(new Uint8Array(d),e,t,i,n,c,a,s,this.format)}setPixel(e,t,i,n,s){let a=this.texelByteSize,c=this.bytesPerRow,d=this.height,p=this.data[n];(function(b,T,B,z,G,Z,q,re,ee,ae){let me=z*(q>>=G)*(Z>>=G)+B*q+T*re;switch(ee){case"r8unorm":return void cn(b,me,"8unorm",1,ae);case"r8snorm":return void cn(b,me,"8snorm",1,ae);case"r8uint":return void cn(b,me,"8uint",1,ae);case"r8sint":return void cn(b,me,"8sint",1,ae);case"rg8unorm":return void cn(b,me,"8unorm",2,ae);case"rg8snorm":return void cn(b,me,"8snorm",2,ae);case"rg8uint":return void cn(b,me,"8uint",2,ae);case"rg8sint":return void cn(b,me,"8sint",2,ae);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void cn(b,me,"8unorm",4,ae);case"rgba8snorm":return void cn(b,me,"8snorm",4,ae);case"rgba8uint":return void cn(b,me,"8uint",4,ae);case"rgba8sint":return void cn(b,me,"8sint",4,ae);case"r16uint":return void cn(b,me,"16uint",1,ae);case"r16sint":return void cn(b,me,"16sint",1,ae);case"r16float":return void cn(b,me,"16float",1,ae);case"rg16uint":return void cn(b,me,"16uint",2,ae);case"rg16sint":return void cn(b,me,"16sint",2,ae);case"rg16float":return void cn(b,me,"16float",2,ae);case"rgba16uint":return void cn(b,me,"16uint",4,ae);case"rgba16sint":return void cn(b,me,"16sint",4,ae);case"rgba16float":return void cn(b,me,"16float",4,ae);case"r32uint":return void cn(b,me,"32uint",1,ae);case"r32sint":return void cn(b,me,"32sint",1,ae);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void cn(b,me,"32float",1,ae);case"rg32uint":return void cn(b,me,"32uint",2,ae);case"rg32sint":return void cn(b,me,"32sint",2,ae);case"rg32float":return void cn(b,me,"32float",2,ae);case"rgba32uint":return void cn(b,me,"32uint",4,ae);case"rgba32sint":return void cn(b,me,"32sint",4,ae);case"rgba32float":return void cn(b,me,"32float",4,ae);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(p),e,t,i,n,d,c,a,this.format,s)}};(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(ct||(ct={}));var lt=class{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}},Ce=class{};vt=Ce,Ce.none=new lt("",ct.reserved,""),Ce.eof=new lt("EOF",ct.token,""),Ce.reserved={asm:new lt("asm",ct.reserved,"asm"),bf16:new lt("bf16",ct.reserved,"bf16"),do:new lt("do",ct.reserved,"do"),enum:new lt("enum",ct.reserved,"enum"),f16:new lt("f16",ct.reserved,"f16"),f64:new lt("f64",ct.reserved,"f64"),handle:new lt("handle",ct.reserved,"handle"),i8:new lt("i8",ct.reserved,"i8"),i16:new lt("i16",ct.reserved,"i16"),i64:new lt("i64",ct.reserved,"i64"),mat:new lt("mat",ct.reserved,"mat"),premerge:new lt("premerge",ct.reserved,"premerge"),regardless:new lt("regardless",ct.reserved,"regardless"),typedef:new lt("typedef",ct.reserved,"typedef"),u8:new lt("u8",ct.reserved,"u8"),u16:new lt("u16",ct.reserved,"u16"),u64:new lt("u64",ct.reserved,"u64"),unless:new lt("unless",ct.reserved,"unless"),using:new lt("using",ct.reserved,"using"),vec:new lt("vec",ct.reserved,"vec"),void:new lt("void",ct.reserved,"void")},Ce.keywords={array:new lt("array",ct.keyword,"array"),atomic:new lt("atomic",ct.keyword,"atomic"),bool:new lt("bool",ct.keyword,"bool"),f32:new lt("f32",ct.keyword,"f32"),i32:new lt("i32",ct.keyword,"i32"),mat2x2:new lt("mat2x2",ct.keyword,"mat2x2"),mat2x3:new lt("mat2x3",ct.keyword,"mat2x3"),mat2x4:new lt("mat2x4",ct.keyword,"mat2x4"),mat3x2:new lt("mat3x2",ct.keyword,"mat3x2"),mat3x3:new lt("mat3x3",ct.keyword,"mat3x3"),mat3x4:new lt("mat3x4",ct.keyword,"mat3x4"),mat4x2:new lt("mat4x2",ct.keyword,"mat4x2"),mat4x3:new lt("mat4x3",ct.keyword,"mat4x3"),mat4x4:new lt("mat4x4",ct.keyword,"mat4x4"),ptr:new lt("ptr",ct.keyword,"ptr"),sampler:new lt("sampler",ct.keyword,"sampler"),sampler_comparison:new lt("sampler_comparison",ct.keyword,"sampler_comparison"),struct:new lt("struct",ct.keyword,"struct"),texture_1d:new lt("texture_1d",ct.keyword,"texture_1d"),texture_2d:new lt("texture_2d",ct.keyword,"texture_2d"),texture_2d_array:new lt("texture_2d_array",ct.keyword,"texture_2d_array"),texture_3d:new lt("texture_3d",ct.keyword,"texture_3d"),texture_cube:new lt("texture_cube",ct.keyword,"texture_cube"),texture_cube_array:new lt("texture_cube_array",ct.keyword,"texture_cube_array"),texture_multisampled_2d:new lt("texture_multisampled_2d",ct.keyword,"texture_multisampled_2d"),texture_storage_1d:new lt("texture_storage_1d",ct.keyword,"texture_storage_1d"),texture_storage_2d:new lt("texture_storage_2d",ct.keyword,"texture_storage_2d"),texture_storage_2d_array:new lt("texture_storage_2d_array",ct.keyword,"texture_storage_2d_array"),texture_storage_3d:new lt("texture_storage_3d",ct.keyword,"texture_storage_3d"),texture_depth_2d:new lt("texture_depth_2d",ct.keyword,"texture_depth_2d"),texture_depth_2d_array:new lt("texture_depth_2d_array",ct.keyword,"texture_depth_2d_array"),texture_depth_cube:new lt("texture_depth_cube",ct.keyword,"texture_depth_cube"),texture_depth_cube_array:new lt("texture_depth_cube_array",ct.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new lt("texture_depth_multisampled_2d",ct.keyword,"texture_depth_multisampled_2d"),texture_external:new lt("texture_external",ct.keyword,"texture_external"),u32:new lt("u32",ct.keyword,"u32"),vec2:new lt("vec2",ct.keyword,"vec2"),vec3:new lt("vec3",ct.keyword,"vec3"),vec4:new lt("vec4",ct.keyword,"vec4"),bitcast:new lt("bitcast",ct.keyword,"bitcast"),block:new lt("block",ct.keyword,"block"),break:new lt("break",ct.keyword,"break"),case:new lt("case",ct.keyword,"case"),continue:new lt("continue",ct.keyword,"continue"),continuing:new lt("continuing",ct.keyword,"continuing"),default:new lt("default",ct.keyword,"default"),diagnostic:new lt("diagnostic",ct.keyword,"diagnostic"),discard:new lt("discard",ct.keyword,"discard"),else:new lt("else",ct.keyword,"else"),enable:new lt("enable",ct.keyword,"enable"),fallthrough:new lt("fallthrough",ct.keyword,"fallthrough"),false:new lt("false",ct.keyword,"false"),fn:new lt("fn",ct.keyword,"fn"),for:new lt("for",ct.keyword,"for"),function:new lt("function",ct.keyword,"function"),if:new lt("if",ct.keyword,"if"),let:new lt("let",ct.keyword,"let"),const:new lt("const",ct.keyword,"const"),loop:new lt("loop",ct.keyword,"loop"),while:new lt("while",ct.keyword,"while"),private:new lt("private",ct.keyword,"private"),read:new lt("read",ct.keyword,"read"),read_write:new lt("read_write",ct.keyword,"read_write"),return:new lt("return",ct.keyword,"return"),requires:new lt("requires",ct.keyword,"requires"),storage:new lt("storage",ct.keyword,"storage"),switch:new lt("switch",ct.keyword,"switch"),true:new lt("true",ct.keyword,"true"),alias:new lt("alias",ct.keyword,"alias"),type:new lt("type",ct.keyword,"type"),uniform:new lt("uniform",ct.keyword,"uniform"),var:new lt("var",ct.keyword,"var"),override:new lt("override",ct.keyword,"override"),workgroup:new lt("workgroup",ct.keyword,"workgroup"),write:new lt("write",ct.keyword,"write"),r8unorm:new lt("r8unorm",ct.keyword,"r8unorm"),r8snorm:new lt("r8snorm",ct.keyword,"r8snorm"),r8uint:new lt("r8uint",ct.keyword,"r8uint"),r8sint:new lt("r8sint",ct.keyword,"r8sint"),r16uint:new lt("r16uint",ct.keyword,"r16uint"),r16sint:new lt("r16sint",ct.keyword,"r16sint"),r16float:new lt("r16float",ct.keyword,"r16float"),rg8unorm:new lt("rg8unorm",ct.keyword,"rg8unorm"),rg8snorm:new lt("rg8snorm",ct.keyword,"rg8snorm"),rg8uint:new lt("rg8uint",ct.keyword,"rg8uint"),rg8sint:new lt("rg8sint",ct.keyword,"rg8sint"),r32uint:new lt("r32uint",ct.keyword,"r32uint"),r32sint:new lt("r32sint",ct.keyword,"r32sint"),r32float:new lt("r32float",ct.keyword,"r32float"),rg16uint:new lt("rg16uint",ct.keyword,"rg16uint"),rg16sint:new lt("rg16sint",ct.keyword,"rg16sint"),rg16float:new lt("rg16float",ct.keyword,"rg16float"),rgba8unorm:new lt("rgba8unorm",ct.keyword,"rgba8unorm"),rgba8unorm_srgb:new lt("rgba8unorm_srgb",ct.keyword,"rgba8unorm_srgb"),rgba8snorm:new lt("rgba8snorm",ct.keyword,"rgba8snorm"),rgba8uint:new lt("rgba8uint",ct.keyword,"rgba8uint"),rgba8sint:new lt("rgba8sint",ct.keyword,"rgba8sint"),bgra8unorm:new lt("bgra8unorm",ct.keyword,"bgra8unorm"),bgra8unorm_srgb:new lt("bgra8unorm_srgb",ct.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new lt("rgb10a2unorm",ct.keyword,"rgb10a2unorm"),rg11b10float:new lt("rg11b10float",ct.keyword,"rg11b10float"),rg32uint:new lt("rg32uint",ct.keyword,"rg32uint"),rg32sint:new lt("rg32sint",ct.keyword,"rg32sint"),rg32float:new lt("rg32float",ct.keyword,"rg32float"),rgba16uint:new lt("rgba16uint",ct.keyword,"rgba16uint"),rgba16sint:new lt("rgba16sint",ct.keyword,"rgba16sint"),rgba16float:new lt("rgba16float",ct.keyword,"rgba16float"),rgba32uint:new lt("rgba32uint",ct.keyword,"rgba32uint"),rgba32sint:new lt("rgba32sint",ct.keyword,"rgba32sint"),rgba32float:new lt("rgba32float",ct.keyword,"rgba32float"),static_assert:new lt("static_assert",ct.keyword,"static_assert")},Ce.tokens={decimal_float_literal:new lt("decimal_float_literal",ct.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new lt("hex_float_literal",ct.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new lt("int_literal",ct.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new lt("uint_literal",ct.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new lt("name",ct.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new lt("ident",ct.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new lt("and",ct.token,"&"),and_and:new lt("and_and",ct.token,"&&"),arrow:new lt("arrow ",ct.token,"->"),attr:new lt("attr",ct.token,"@"),forward_slash:new lt("forward_slash",ct.token,"/"),bang:new lt("bang",ct.token,"!"),bracket_left:new lt("bracket_left",ct.token,"["),bracket_right:new lt("bracket_right",ct.token,"]"),brace_left:new lt("brace_left",ct.token,"{"),brace_right:new lt("brace_right",ct.token,"}"),colon:new lt("colon",ct.token,":"),comma:new lt("comma",ct.token,","),equal:new lt("equal",ct.token,"="),equal_equal:new lt("equal_equal",ct.token,"=="),not_equal:new lt("not_equal",ct.token,"!="),greater_than:new lt("greater_than",ct.token,">"),greater_than_equal:new lt("greater_than_equal",ct.token,">="),shift_right:new lt("shift_right",ct.token,">>"),less_than:new lt("less_than",ct.token,"<"),less_than_equal:new lt("less_than_equal",ct.token,"<="),shift_left:new lt("shift_left",ct.token,"<<"),modulo:new lt("modulo",ct.token,"%"),minus:new lt("minus",ct.token,"-"),minus_minus:new lt("minus_minus",ct.token,"--"),period:new lt("period",ct.token,"."),plus:new lt("plus",ct.token,"+"),plus_plus:new lt("plus_plus",ct.token,"++"),or:new lt("or",ct.token,"|"),or_or:new lt("or_or",ct.token,"||"),paren_left:new lt("paren_left",ct.token,"("),paren_right:new lt("paren_right",ct.token,")"),semicolon:new lt("semicolon",ct.token,";"),star:new lt("star",ct.token,"*"),tilde:new lt("tilde",ct.token,"~"),underscore:new lt("underscore",ct.token,"_"),xor:new lt("xor",ct.token,"^"),plus_equal:new lt("plus_equal",ct.token,"+="),minus_equal:new lt("minus_equal",ct.token,"-="),times_equal:new lt("times_equal",ct.token,"*="),division_equal:new lt("division_equal",ct.token,"/="),modulo_equal:new lt("modulo_equal",ct.token,"%="),and_equal:new lt("and_equal",ct.token,"&="),or_equal:new lt("or_equal",ct.token,"|="),xor_equal:new lt("xor_equal",ct.token,"^="),shift_right_equal:new lt("shift_right_equal",ct.token,">>="),shift_left_equal:new lt("shift_left_equal",ct.token,"<<=")},Ce.simpleTokens={"@":vt.tokens.attr,"{":vt.tokens.brace_left,"}":vt.tokens.brace_right,":":vt.tokens.colon,",":vt.tokens.comma,"(":vt.tokens.paren_left,")":vt.tokens.paren_right,";":vt.tokens.semicolon},Ce.literalTokens={"&":vt.tokens.and,"&&":vt.tokens.and_and,"->":vt.tokens.arrow,"/":vt.tokens.forward_slash,"!":vt.tokens.bang,"[":vt.tokens.bracket_left,"]":vt.tokens.bracket_right,"=":vt.tokens.equal,"==":vt.tokens.equal_equal,"!=":vt.tokens.not_equal,">":vt.tokens.greater_than,">=":vt.tokens.greater_than_equal,">>":vt.tokens.shift_right,"<":vt.tokens.less_than,"<=":vt.tokens.less_than_equal,"<<":vt.tokens.shift_left,"%":vt.tokens.modulo,"-":vt.tokens.minus,"--":vt.tokens.minus_minus,".":vt.tokens.period,"+":vt.tokens.plus,"++":vt.tokens.plus_plus,"|":vt.tokens.or,"||":vt.tokens.or_or,"*":vt.tokens.star,"~":vt.tokens.tilde,_:vt.tokens.underscore,"^":vt.tokens.xor,"+=":vt.tokens.plus_equal,"-=":vt.tokens.minus_equal,"*=":vt.tokens.times_equal,"/=":vt.tokens.division_equal,"%=":vt.tokens.modulo_equal,"&=":vt.tokens.and_equal,"|=":vt.tokens.or_equal,"^=":vt.tokens.xor_equal,">>=":vt.tokens.shift_right_equal,"<<=":vt.tokens.shift_left_equal},Ce.regexTokens={decimal_float_literal:vt.tokens.decimal_float_literal,hex_float_literal:vt.tokens.hex_float_literal,int_literal:vt.tokens.int_literal,uint_literal:vt.tokens.uint_literal,ident:vt.tokens.ident},Ce.storage_class=[vt.keywords.function,vt.keywords.private,vt.keywords.workgroup,vt.keywords.uniform,vt.keywords.storage],Ce.access_mode=[vt.keywords.read,vt.keywords.write,vt.keywords.read_write],Ce.sampler_type=[vt.keywords.sampler,vt.keywords.sampler_comparison],Ce.sampled_texture_type=[vt.keywords.texture_1d,vt.keywords.texture_2d,vt.keywords.texture_2d_array,vt.keywords.texture_3d,vt.keywords.texture_cube,vt.keywords.texture_cube_array],Ce.multisampled_texture_type=[vt.keywords.texture_multisampled_2d],Ce.storage_texture_type=[vt.keywords.texture_storage_1d,vt.keywords.texture_storage_2d,vt.keywords.texture_storage_2d_array,vt.keywords.texture_storage_3d],Ce.depth_texture_type=[vt.keywords.texture_depth_2d,vt.keywords.texture_depth_2d_array,vt.keywords.texture_depth_cube,vt.keywords.texture_depth_cube_array,vt.keywords.texture_depth_multisampled_2d],Ce.texture_external_type=[vt.keywords.texture_external],Ce.any_texture_type=[...vt.sampled_texture_type,...vt.multisampled_texture_type,...vt.storage_texture_type,...vt.depth_texture_type,...vt.texture_external_type],Ce.texel_format=[vt.keywords.r8unorm,vt.keywords.r8snorm,vt.keywords.r8uint,vt.keywords.r8sint,vt.keywords.r16uint,vt.keywords.r16sint,vt.keywords.r16float,vt.keywords.rg8unorm,vt.keywords.rg8snorm,vt.keywords.rg8uint,vt.keywords.rg8sint,vt.keywords.r32uint,vt.keywords.r32sint,vt.keywords.r32float,vt.keywords.rg16uint,vt.keywords.rg16sint,vt.keywords.rg16float,vt.keywords.rgba8unorm,vt.keywords.rgba8unorm_srgb,vt.keywords.rgba8snorm,vt.keywords.rgba8uint,vt.keywords.rgba8sint,vt.keywords.bgra8unorm,vt.keywords.bgra8unorm_srgb,vt.keywords.rgb10a2unorm,vt.keywords.rg11b10float,vt.keywords.rg32uint,vt.keywords.rg32sint,vt.keywords.rg32float,vt.keywords.rgba16uint,vt.keywords.rgba16sint,vt.keywords.rgba16float,vt.keywords.rgba32uint,vt.keywords.rgba32sint,vt.keywords.rgba32float],Ce.const_literal=[vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.decimal_float_literal,vt.tokens.hex_float_literal,vt.keywords.true,vt.keywords.false],Ce.literal_or_ident=[vt.tokens.ident,vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.decimal_float_literal,vt.tokens.hex_float_literal,vt.tokens.name],Ce.element_count_expression=[vt.tokens.int_literal,vt.tokens.uint_literal,vt.tokens.ident],Ce.template_types=[vt.keywords.vec2,vt.keywords.vec3,vt.keywords.vec4,vt.keywords.mat2x2,vt.keywords.mat2x3,vt.keywords.mat2x4,vt.keywords.mat3x2,vt.keywords.mat3x3,vt.keywords.mat3x4,vt.keywords.mat4x2,vt.keywords.mat4x3,vt.keywords.mat4x4,vt.keywords.atomic,vt.keywords.bitcast,...vt.any_texture_type],Ce.attribute_name=[vt.tokens.ident,vt.keywords.block,vt.keywords.diagnostic],Ce.assignment_operators=[vt.tokens.equal,vt.tokens.plus_equal,vt.tokens.minus_equal,vt.tokens.times_equal,vt.tokens.division_equal,vt.tokens.modulo_equal,vt.tokens.and_equal,vt.tokens.or_equal,vt.tokens.xor_equal,vt.tokens.shift_right_equal,vt.tokens.shift_left_equal],Ce.increment_operators=[vt.tokens.plus_plus,vt.tokens.minus_minus];var W2=class{constructor(e,t,i,n,s){this.type=e,this.lexeme=t,this.line=i,this.start=n,this.end=s}toString(){return this.lexeme}isTemplateType(){return Ce.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Ce.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},ES=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new W2(Ce.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}let t=Ce.simpleTokens[e];if(t)return this._addToken(t),!0;let i=Ce.none,n=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)e+=this._advance(),a=this._peekAhead()}if(n){let a=Ce.keywords[e];if(a)return this._addToken(a),!0}if(n||s)return this._addToken(Ce.tokens.ident),!0;for(;;){let a=this._findType(e),c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(Ce.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(Ce.tokens.minus_minus),!0;let d=this._tokens.length-1;if((Ce.literal_or_ident.indexOf(this._tokens[d].type)!=-1||this._tokens[d].type==Ce.tokens.paren_right)&&c!=">")return this._addToken(a),!0}if(e==">"&&(c==">"||c=="=")){let d=!1,p=this._tokens.length-1;for(let b=0;b<5&&p>=0&&Ce.assignment_operators.indexOf(this._tokens[p].type)===-1;++b,--p)if(this._tokens[p].type===Ce.tokens.less_than){p>0&&this._tokens[p-1].isArrayOrTemplateType()&&(d=!0);break}if(d)return this._addToken(a),!0}if(a===Ce.none){let d=e,p=0,b=2;for(let T=0;T<b;++T)if(d+=this._peekAhead(T),a=this._findType(d),a!==Ce.none){p=T;break}if(a===Ce.none)return i!==Ce.none&&(this._current--,this._addToken(i),!0);e=d,this._current+=p+1}if(i=a,this._isAtEnd())break;e+=this._advance()}return i!==Ce.none&&(this._addToken(i),!0)}_findType(e){for(let i in Ce.regexTokens){let n=Ce.regexTokens[i];if(this._match(e,n.rule))return n}return Ce.literalTokens[e]||Ce.none}_match(e,t){let i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let t=this._source.substring(this._start,this._current);this._tokens.push(new W2(e,t,this._line,this._start,this._current))}};function pr(r){return Array.isArray(r)||r?.buffer instanceof ArrayBuffer}var $2=new Float32Array(1),RY=new Uint32Array($2.buffer),BY=new Uint32Array($2.buffer),q2=new Int32Array(1),LY=new Float32Array(q2.buffer),OY=new Uint32Array(q2.buffer),Z2=new Uint32Array(1),DY=new Float32Array(Z2.buffer),kY=new Int32Array(Z2.buffer);function IL(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return $2[0]=r,RY[0];if(t==="u32")return $2[0]=r,BY[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return q2[0]=r,LY[0];if(t==="u32")return q2[0]=r,OY[0]}else if(e==="u32"){if(t==="f32")return Z2[0]=r,DY[0];if(t==="i32"||t==="x32")return Z2[0]=r,kY[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}var SS=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},u0=class{constructor(e,t){this.align=e,this.size=t}},_p=class r{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new yS,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(let t of e)t instanceof yp&&this._functions.set(t.name,new SS(t));for(let t of e)if(t instanceof oc){let i=this.getTypeInfo(t,null);i instanceof ou&&this.structs.push(i)}for(let t of e)if(t instanceof p_)this.aliases.push(this._getAliasInfo(t));else if(t instanceof f_){let i=t,n=this._getAttributeNum(i.attributes,"id",0),s=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new mS(i.name,s,i.attributes,n))}else if(this._isUniformVar(t)){let i=t,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=new l0(i.name,a,n,s,i.attributes,kf.Uniform,i.access);c.access||(c.access="read"),this.uniforms.push(c)}else if(this._isStorageVar(t)){let i=t,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(a),d=new l0(i.name,a,n,s,i.attributes,c?kf.StorageTexture:kf.Storage,i.access);d.access||(d.access="read"),this.storage.push(d)}else if(this._isTextureVar(t)){let i=t,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=this._isStorageTexture(a),d=new l0(i.name,a,n,s,i.attributes,c?kf.StorageTexture:kf.Texture,i.access);d.access||(d.access="read"),c?this.storage.push(d):this.textures.push(d)}else if(this._isSamplerVar(t)){let i=t,n=this._getAttributeNum(i.attributes,"group",0),s=this._getAttributeNum(i.attributes,"binding",0),a=this.getTypeInfo(i.type,i.attributes),c=new l0(i.name,a,n,s,i.attributes,kf.Sampler,i.access);this.samplers.push(c)}else if(t instanceof yp){let i=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),a=i||n||s,c=new _S(t.name,a?.name,t.attributes);c.attributes=t.attributes,c.startLine=t.startLine,c.endLine=t.endLine,this.functions.push(c),this._functions.get(t.name).info=c,a&&(this._functions.get(t.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(t,!!a),c.inputs=this._getInputs(t.args),c.outputs=this._getOutputs(t.returnType),this.entry[a.name].push(c)),c.arguments=t.args.map(d=>new gS(d.name,this.getTypeInfo(d.type,d.attributes),d.attributes)),c.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(let t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(let t of this._functions.values())t.node.search(i=>{var n,s,a;if(i instanceof H2){if(i.value)if(pr(i.value))for(let c of i.value)for(let d of this.overrides)c===d.name&&((n=t.info)===null||n===void 0||n.overrides.push(d));else for(let c of this.overrides)i.value===c.name&&((s=t.info)===null||s===void 0||s.overrides.push(c))}else if(i instanceof Xo)for(let c of this.overrides)i.name===c.name&&((a=t.info)===null||a===void 0||a.overrides.push(c))});for(let t of this.uniforms)this._markStructsInUse(t.type);for(let t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(let t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(let t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(let n of e.calls){let s=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;s&&t.add(s)}}findResource(e,t,i){if(i){for(let n of this.entry.compute)if(n.name===i){for(let s of n.resources)if(s.group==e&&s.binding==t)return s}for(let n of this.entry.vertex)if(n.name===i){for(let s of n.resources)if(s.group==e&&s.binding==t)return s}for(let n of this.entry.fragment)if(n.name===i){for(let s of n.resources)if(s.group==e&&s.binding==t)return s}}for(let n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(let n of this.storage)if(n.group==e&&n.binding==t)return n;for(let n of this.textures)if(n.group==e&&n.binding==t)return n;for(let n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(let t of this.uniforms)if(t.name==e)return t;for(let t of this.storage)if(t.name==e)return t;for(let t of this.textures)if(t.name==e)return t;for(let t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){let t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){let i=[],n=this,s=[];return e.search(a=>{if(a instanceof p0)s.push({});else if(a instanceof A0)s.pop();else if(a instanceof ac){let c=a;t&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(a instanceof hl){let c=a;t&&c.type!==null&&this._markStructsFromAST(c.type)}else if(a instanceof mp){let c=a;t&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(a instanceof Xo){let c=a;if(s.length>0&&s[s.length-1][c.name])return;let d=n._findResource(c.name);d&&i.push(d)}else if(a instanceof A_){let c=a,d=n._functions.get(c.name);d&&(t&&(d.inUse=!0),e.calls.add(d.node),d.resources===null&&(d.resources=n._findResources(d.node,t)),i.push(...d.resources))}else if(a instanceof d_){let c=a,d=n._functions.get(c.name);d&&(t&&(d.inUse=!0),e.calls.add(d.node),d.resources===null&&(d.resources=n._findResources(d.node,t)),i.push(...d.resources))}}),[...new Map(i.map(a=>[a.name,a])).values()]}getBindGroups(){let e=[];function t(i,n){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),n>=e[i].length&&(e[i].length=n+1)}for(let i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof oc)this._getStructOutputs(e,t);else{let i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(let i of e.members)if(i.type instanceof oc)this._getStructOutputs(i.type,t);else{let n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){let s=this.getTypeInfo(i.type,i.type.attributes),a=this._parseInt(n.value),c=new w2(i.name,s,n.name,a);t.push(c)}}}_getOutputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){let i=this.getTypeInfo(e,e.attributes),n=this._parseInt(t.value);return new w2("",i,t.name,n)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(let i of e)if(i.type instanceof oc)this._getStructInputs(i.type,t);else{let n=this._getInputInfo(i);n!==null&&t.push(n)}return t}_getStructInputs(e,t){for(let i of e.members)if(i.type instanceof oc)this._getStructInputs(i.type,t);else{let n=this._getInputInfo(i);n!==null&&t.push(n)}}_getInputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){let i=this._getAttribute(e,"interpolation"),n=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),a=new AS(e.name,n,t.name,s);return i!==null&&(a.interpolation=this._parseString(i.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(let t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new pS(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(let t of this.structs)if(t.name==e)return t;for(let t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof gp){let n=e,s=n.format?this.getTypeInfo(n.format,n.attributes):null,a=new au(n.name,t);return a.format=s,a.count=n.count,this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof oc){let n=e,s=new ou(n.name,t);s.startLine=n.startLine,s.endLine=n.endLine;for(let a of n.members){let c=this.getTypeInfo(a.type,a.attributes);s.members.push(new v2(a.name,c,a.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Ap){let n=e,s=n.format instanceof Zt,a=n.format?s?this.getTypeInfo(n.format,null):new pa(n.format,null):null,c=new hh(n.name,a,t,n.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof pt){let n=e,s=n.format?this.getTypeInfo(n.format,null):null,a=new hh(n.name,s,t,n.access);return this._types.set(e,a),this._updateTypeInfo(a),a}let i=new pa(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,n;let s=this._getTypeSize(e);if(e.size=(t=s?.size)!==null&&t!==void 0?t:0,e instanceof au&&e.format){let a=this._getTypeSize(e.format);e.stride=Math.max((i=a?.size)!==null&&i!==void 0?i:0,(n=a?.align)!==null&&n!==void 0?n:0),this._updateTypeInfo(e.format)}e instanceof ou&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,n=0,s=0,a=0;for(let c=0,d=e.members.length;c<d;++c){let p=e.members[c],b=this._getTypeSize(p);if(!b)continue;(t=this._getAlias(p.type.name))!==null&&t!==void 0||p.type;let T=b.align,B=b.size;i=this._roundUp(T,i+n),n=B,s=i,a=Math.max(a,T),p.offset=i,p.size=B,this._updateTypeInfo(p.type)}e.size=this._roundUp(a,s+n),e.align=a}_getTypeSize(e){var t,i;if(e==null)return null;let n=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof v2&&(e=e.type),e instanceof pa){let a=this._getAlias(e.name);a!==null&&(e=a)}{let a=r._typeInfo[e.name];if(a!==void 0){let c=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new u0(Math.max(s,a.align/c),Math.max(n,a.size/c))}}{let a=r._typeInfo[e.name.substring(0,e.name.length-1)];if(a){let c=e.name[e.name.length-1]==="h"?2:1;return new u0(Math.max(s,a.align/c),Math.max(n,a.size/c))}}if(e instanceof au){let a=e,c=8,d=8,p=this._getTypeSize(a.format);return p!==null&&(d=p.size,c=p.align),d=a.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(c,d)),n&&(d=n),new u0(Math.max(s,c),Math.max(n,d))}if(e instanceof ou){let a=0,c=0,d=0,p=0,b=0;for(let T of e.members){let B=this._getTypeSize(T.type);B!==null&&(a=Math.max(B.align,a),d=this._roundUp(B.align,d+p),p=B.size,b=d)}return c=this._roundUp(a,b+p),new u0(Math.max(s,a),Math.max(n,c))}return null}_isUniformVar(e){return e instanceof ac&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ac&&e.storage=="storage"}_isTextureVar(e){return e instanceof ac&&e.type!==null&&r._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ac&&e.type!==null&&r._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){let i=e;if(!i||!i.attributes)return null;let n=i.attributes;for(let s of n)if(s.name==t)return s;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let n of e)if(n.name==t){let s=n!==null&&n.value!==null?n.value:i;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}};_p._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},_p._textureTypes=Ce.any_texture_type.map(r=>r.name),_p._samplerTypes=Ce.sampler_type.map(r=>r.name);var CS=class r{constructor(e,t,i){this.name=e,this.value=t,this.node=i}clone(){return new r(this.name,this.value,this.node)}},IS=class r{constructor(e){this.name=e.name,this.node=e}clone(){return new r(this.node)}},PS=class r{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new CS(e,t,i??null))}setVariable(e,t,i){let n=this.getVariable(e);n!==null?n.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;let i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new r(this)}},MS=class{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}},RS=class{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){let i=this.exec.evalExpression(e.args[0],t),n=!0;if(i instanceof Fe)return i.data.forEach(s=>{s||(n=!1)}),new ht(n?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe){let n=i.data.some(s=>s);return new ht(n?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){let i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof ht))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.evalExpression(i,t);if(n instanceof Rs&&n.typeInfo.size===0){let s=n.typeInfo,a=n.buffer.byteLength/s.stride;return new ht(a,this.getTypeInfo("u32"))}return new ht(n.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.abs(s)),i.typeInfo);let n=i;return new ht(Math.abs(n.value),n.typeInfo)}Acos(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.acos(s)),i.typeInfo);let n=i;return new ht(Math.acos(n.value),i.typeInfo)}Acosh(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.acosh(s)),i.typeInfo);let n=i;return new ht(Math.acosh(n.value),i.typeInfo)}Asin(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.asin(s)),i.typeInfo);let n=i;return new ht(Math.asin(n.value),i.typeInfo)}Asinh(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.asinh(s)),i.typeInfo);let n=i;return new ht(Math.asinh(n.value),i.typeInfo)}Atan(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.atan(s)),i.typeInfo);let n=i;return new ht(Math.atan(n.value),i.typeInfo)}Atanh(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.atanh(s)),i.typeInfo);let n=i;return new ht(Math.atanh(n.value),i.typeInfo)}Atan2(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe)return new Fe(i.data.map((c,d)=>Math.atan2(c,n.data[d])),i.typeInfo);let s=i,a=n;return new ht(Math.atan2(s.value,a.value),i.typeInfo)}Ceil(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.ceil(s)),i.typeInfo);let n=i;return new ht(Math.ceil(n.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i instanceof Fe&&n instanceof Fe&&s instanceof Fe)return new Fe(i.data.map((p,b)=>this._clamp(p,n.data[b],s.data[b])),i.typeInfo);let a=i,c=n,d=s;return new ht(this._clamp(a.value,c.value,d.value),i.typeInfo)}Cos(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.cos(s)),i.typeInfo);let n=i;return new ht(Math.cos(n.value),i.typeInfo)}Cosh(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.cosh(s)),i.typeInfo);let n=i;return new ht(Math.cos(n.value),i.typeInfo)}CountLeadingZeros(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.clz32(s)),i.typeInfo);let n=i;return new ht(Math.clz32(n.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>this._countOneBits(s)),i.typeInfo);let n=i;return new ht(this._countOneBits(n.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>this._countTrailingZeros(s)),i.typeInfo);let n=i;return new ht(this._countTrailingZeros(n.value),i.typeInfo)}Cross(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe){if(i.data.length!==3||n.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;let s=i.data,a=n.data;return new Fe([s[1]*a[2]-a[1]*s[2],s[2]*a[0]-a[2]*s[0],s[0]*a[1]-a[0]*s[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){let i=this.exec.evalExpression(e.args[0],t),n=180/Math.PI;return i instanceof Fe?new Fe(i.data.map(s=>s*n),i.typeInfo):new ht(i.value*n,this.getTypeInfo("f32"))}Determinant(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof $r){let n=i.data,s=i.typeInfo.getTypeName(),a=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new ht(n[0]*n[3]-n[1]*n[2],a);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new ht(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),a);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new ht(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),a);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe){let c=0;for(let d=0;d<i.data.length;++d)c+=(i.data[d]-n.data[d])*(i.data[d]-n.data[d]);return new ht(Math.sqrt(c),this.getTypeInfo("f32"))}let s=i,a=n;return new ht(Math.abs(s.value-a.value),i.typeInfo)}_dot(e,t){let i=0;for(let n=0;n<e.length;++n)i+=t[n]*e[n];return i}Dot(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);return i instanceof Fe&&n instanceof Fe?new ht(this._dot(i.data,n.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.exp(s)),i.typeInfo);let n=i;return new ht(Math.exp(n.value),i.typeInfo)}Exp2(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.pow(2,s)),i.typeInfo);let n=i;return new ht(Math.pow(2,n.value),i.typeInfo)}ExtractBits(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n.typeInfo.name!=="u32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;let a=n.value,c=s.value;if(i instanceof Fe)return new Fe(i.data.map(p=>p>>a&(1<<c)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;let d=i.value;return new ht(d>>a&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i instanceof Fe&&n instanceof Fe&&s instanceof Fe){let a=this._dot(n.data,s.data);return new Fe(a<0?Array.from(i.data):i.data.map(c=>-c),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>this._firstLeadingBit(s)),i.typeInfo);let n=i;return new ht(this._firstLeadingBit(n.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>this._firstTrailingBit(s)),i.typeInfo);let n=i;return new ht(this._firstTrailingBit(n.value),i.typeInfo)}Floor(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.floor(s)),i.typeInfo);let n=i;return new ht(Math.floor(n.value),i.typeInfo)}Fma(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i instanceof Fe&&n instanceof Fe&&s instanceof Fe)return i.data.length!==n.data.length||i.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Fe(i.data.map((p,b)=>p*n.data[b]+s.data[b]),i.typeInfo);let a=i,c=n,d=s;return new ht(a.value*c.value+d.value,a.typeInfo)}Fract(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>s-Math.floor(s)),i.typeInfo);let n=i;return new ht(n.value-Math.floor(n.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),a=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;let c=s.value,d=(1<<a.value)-1<<c,p=~d;if(i instanceof Fe&&n instanceof Fe)return new Fe(i.data.map((B,z)=>B&p|n.data[z]<<c&d),i.typeInfo);let b=i.value,T=n.value;return new ht(b&p|T<<c&d,i.typeInfo)}InverseSqrt(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>1/Math.sqrt(s)),i.typeInfo);let n=i;return new ht(1/Math.sqrt(n.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe){let s=0;return i.data.forEach(a=>{s+=a*a}),new ht(Math.sqrt(s),this.getTypeInfo("f32"))}let n=i;return new ht(Math.abs(n.value),i.typeInfo)}Log(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.log(s)),i.typeInfo);let n=i;return new ht(Math.log(n.value),i.typeInfo)}Log2(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.log2(s)),i.typeInfo);let n=i;return new ht(Math.log2(n.value),i.typeInfo)}Max(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe)return new Fe(i.data.map((c,d)=>Math.max(c,n.data[d])),i.typeInfo);let s=i,a=n;return new ht(Math.max(s.value,a.value),i.typeInfo)}Min(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe)return new Fe(i.data.map((c,d)=>Math.min(c,n.data[d])),i.typeInfo);let s=i,a=n;return new ht(Math.min(s.value,a.value),i.typeInfo)}Mix(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i instanceof Fe&&n instanceof Fe&&s instanceof Fe)return new Fe(i.data.map((d,p)=>i.data[p]*(1-s.data[p])+n.data[p]*s.data[p]),i.typeInfo);let a=n,c=s;return new ht(i.value*(1-c.value)+a.value*c.value,i.typeInfo)}Modf(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe)return new Fe(i.data.map((a,c)=>a%n.data[c]),i.typeInfo);let s=n;return new ht(i.value%s.value,i.typeInfo)}Normalize(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe){let n=this.Length(e,t).value;return new Fe(i.data.map(s=>s/n),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe)return new Fe(i.data.map((c,d)=>Math.pow(c,n.data[d])),i.typeInfo);let s=i,a=n;return new ht(Math.pow(s.value,a.value),i.typeInfo)}QuantizeToF16(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof Fe?new Fe(i.data.map(n=>n),i.typeInfo):new ht(i.value,i.typeInfo)}Radians(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof Fe?new Fe(i.data.map(n=>n*Math.PI/180),i.typeInfo):new ht(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Fe&&n instanceof Fe){let s=this._dot(i.data,n.data);return new Fe(i.data.map((a,c)=>a-2*s*n.data[c]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i instanceof Fe&&n instanceof Fe&&s instanceof ht){let a=this._dot(n.data,i.data);return new Fe(i.data.map((c,d)=>{let p=1-s.value*s.value*(1-a*a);if(p<0)return 0;let b=Math.sqrt(p);return s.value*c-(s.value*a+b)*n.data[d]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.round(s)),i.typeInfo);let n=i;return new ht(Math.round(n.value),i.typeInfo)}Saturate(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.min(Math.max(s,0),1)),i.typeInfo);let n=i;return new ht(Math.min(Math.max(n.value,0),1),i.typeInfo)}Sign(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.sign(s)),i.typeInfo);let n=i;return new ht(Math.sign(n.value),i.typeInfo)}Sin(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.sin(s)),i.typeInfo);let n=i;return new ht(Math.sin(n.value),i.typeInfo)}Sinh(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.sinh(s)),i.typeInfo);let n=i;return new ht(Math.sinh(n.value),i.typeInfo)}_smoothstep(e,t,i){let n=Math.min(Math.max((i-e)/(t-e),0),1);return n*n*(3-2*n)}SmoothStep(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof Fe&&i instanceof Fe&&n instanceof Fe)return new Fe(s.data.map((p,b)=>this._smoothstep(i.data[b],n.data[b],p)),s.typeInfo);let a=i,c=n,d=s;return new ht(this._smoothstep(a.value,c.value,d.value),s.typeInfo)}Sqrt(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.sqrt(s)),i.typeInfo);let n=i;return new ht(Math.sqrt(n.value),i.typeInfo)}Step(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(n instanceof Fe&&i instanceof Fe)return new Fe(n.data.map((a,c)=>a<i.data[c]?0:1),n.typeInfo);let s=i;return new ht(n.value<s.value?0:1,s.typeInfo)}Tan(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.tan(s)),i.typeInfo);let n=i;return new ht(Math.tan(n.value),i.typeInfo)}Tanh(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.tanh(s)),i.typeInfo);let n=i;return new ht(Math.tanh(n.value),i.typeInfo)}_getTransposeType(e){let t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){let i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof $r))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;let n=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){let s=i.data;return new $r([s[0],s[2],s[1],s[3]],n)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){let s=i.data;return new $r([s[0],s[3],s[6],s[1],s[4],s[7]],n)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){let s=i.data;return new $r([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],n)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){let s=i.data;return new $r([s[0],s[3],s[1],s[4],s[2],s[5]],n)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){let s=i.data;return new $r([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],n)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){let s=i.data;return new $r([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],n)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){let s=i.data;return new $r([s[0],s[4],s[1],s[5],s[2],s[6]],n)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){let s=i.data;return new $r([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],n)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){let s=i.data;return new $r([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],n)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fe)return new Fe(i.data.map(s=>Math.trunc(s)),i.typeInfo);let n=i;return new ht(Math.trunc(n.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){let i=e.args[0],n=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof Xo){let s=i.name,a=t.getVariableValue(s);if(a instanceof uh){if(n<0||n>=a.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;let c=a.getMipLevelSize(n),d=a.dimension;return d==="1d"?new ht(c[0],this.getTypeInfo("u32")):d==="3d"?new Fe(c,this.getTypeInfo("vec3u")):d==="2d"?new Fe(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${d} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){let i=e.args[0],n=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(n instanceof Fe)||n.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof Xo){let a=i.name,c=t.getVariableValue(a);if(c instanceof uh){let d=Math.floor(n.data[0]),p=Math.floor(n.data[1]);if(d<0||d>=c.width||p<0||p>=c.height)return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;let b=c.getPixel(d,p,0,s);return b===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Fe(b,this.getTypeInfo("vec4f"))}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){let i=e.args[0];if(i instanceof Xo){let n=i.name,s=t.getVariableValue(n);return s instanceof uh?new ht(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){let i=e.args[0];if(i instanceof Xo){let n=i.name,s=t.getVariableValue(n);return s instanceof uh?new ht(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){let i=e.args[0];if(i instanceof Xo){let n=i.name,s=t.getVariableValue(n);return s instanceof uh?new ht(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){let i=e.args[0],n=this.exec.evalExpression(e.args[1],t),s=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,a=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(a.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(n instanceof Fe)||n.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof Xo){let c=i.name,d=t.getVariableValue(c);if(d instanceof uh){let p=d.getMipLevelSize(0),b=Math.floor(n.data[0]),T=Math.floor(n.data[1]);return b<0||b>=p[0]||T<0||T>=p[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(d.setPixel(b,T,0,s,Array.from(a)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t);return t.getVariable(n).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t);return d instanceof ht&&c instanceof ht&&(d.value=c.value),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value+=c.value),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicSub(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value-=c.value),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicMax(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value=Math.max(d.value,c.value)),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicMin(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value=Math.min(d.value,c.value)),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicAnd(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value=d.value&c.value),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicOr(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value=d.value|c.value),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicXor(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value=d.value^c.value),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicExchange(e,t){let i=e.args[0];i instanceof ns&&(i=i.right);let n=this.exec.getVariableName(i,t),s=t.getVariable(n),a=e.args[1],c=this.exec.evalExpression(a,t),d=s.value.getSubData(this.exec,i.postfix,t),p=new ht(d.value,d.typeInfo);return d instanceof ht&&c instanceof ht&&(d.value=c.value),s.value instanceof Rs&&s.value.setDataValue(this.exec,d,i.postfix,t),p}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}},dS={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Zo={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]},d0=class r extends MS{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new _p,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new PS,this.builtins=new RS(this),this.typeInfo={bool:this.getTypeInfo(Zt.bool),i32:this.getTypeInfo(Zt.i32),u32:this.getTypeInfo(Zt.u32),f32:this.getTypeInfo(Zt.f32),f16:this.getTypeInfo(Zt.f16),vec2f:this.getTypeInfo(pt.vec2f),vec2u:this.getTypeInfo(pt.vec2u),vec2i:this.getTypeInfo(pt.vec2i),vec2h:this.getTypeInfo(pt.vec2h),vec3f:this.getTypeInfo(pt.vec3f),vec3u:this.getTypeInfo(pt.vec3u),vec3i:this.getTypeInfo(pt.vec3i),vec3h:this.getTypeInfo(pt.vec3h),vec4f:this.getTypeInfo(pt.vec4f),vec4u:this.getTypeInfo(pt.vec4u),vec4i:this.getTypeInfo(pt.vec4i),vec4h:this.getTypeInfo(pt.vec4h),mat2x2f:this.getTypeInfo(pt.mat2x2f),mat2x3f:this.getTypeInfo(pt.mat2x3f),mat2x4f:this.getTypeInfo(pt.mat2x4f),mat3x2f:this.getTypeInfo(pt.mat3x2f),mat3x3f:this.getTypeInfo(pt.mat3x3f),mat3x4f:this.getTypeInfo(pt.mat3x4f),mat4x2f:this.getTypeInfo(pt.mat4x2f),mat4x3f:this.getTypeInfo(pt.mat4x3f),mat4x4f:this.getTypeInfo(pt.mat4x4f)}}getVariableValue(e){var t,i;let n=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(n===null)return null;if(n instanceof ht)return n.value;if(n instanceof Fe||n instanceof $r)return Array.from(n.data);if(n instanceof Rs&&n.typeInfo instanceof au){if(n.typeInfo.format.name==="u32")return Array.from(new Uint32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="i32")return Array.from(new Int32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="f32")return Array.from(new Float32Array(n.buffer,n.offset,n.typeInfo.count))}return console.error(`Unsupported return variable type ${n.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,n){let s=this.context.clone();(n=n??{}).constants&&this._setOverrides(n.constants,s),this._execStatements(this.ast,s);let a=s.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}let c=t[0],d=t[1],p=t[2],b=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new Fe(t,b));for(let T in i)for(let B in i[T]){let z=i[T][B];s.variables.forEach(G=>{var Z;let q=G.node;if(q?.attributes){let re=null,ee=null;for(let ae of q.attributes)ae.name==="binding"?re=ae.value:ae.name==="group"&&(ee=ae.value);if(B==re&&T==ee)if(z.texture!==void 0&&z.descriptor!==void 0){let ae=new uh(z.texture,this.getTypeInfo(q.type),z.descriptor,(Z=z.texture.view)!==null&&Z!==void 0?Z:null);G.value=ae}else z.uniform!==void 0?G.value=new Rs(z.uniform,this.getTypeInfo(q.type)):G.value=new Rs(z,this.getTypeInfo(q.type))}})}for(let T=0;T<p;++T)for(let B=0;B<d;++B)for(let z=0;z<c;++z)s.setVariable("@workgroup_id",new Fe([z,B,T],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[z,B,T],s)}execStatement(e,t){if(e instanceof R2)return this.evalExpression(e.value,t);if(e instanceof L2){if(e.condition){let i=this.evalExpression(e.condition,t);if(!(i instanceof ht))throw new Error("Invalid break-if condition");if(!i.value)return null}return r._breakObj}if(e instanceof O2)return r._continueObj;if(e instanceof mp)this._let(e,t);else if(e instanceof ac)this._var(e,t);else if(e instanceof h0)this._const(e,t);else if(e instanceof yp)this._function(e,t);else{if(e instanceof M2)return this._if(e,t);if(e instanceof P2)return this._switch(e,t);if(e instanceof E2)return this._for(e,t);if(e instanceof T2)return this._while(e,t);if(e instanceof I2)return this._loop(e,t);if(e instanceof h_){let i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof C2)this._assign(e,t);else if(e instanceof S2)this._increment(e,t);else{if(e instanceof oc)return null;if(e instanceof f_){let i=e.name;t.getVariable(i)===null&&t.setVariable(i,new ht(0,this.getTypeInfo("u32")))}else if(e instanceof d_)this._call(e,t);else{if(e instanceof B2||e instanceof p_)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Va?this._evalBinaryOp(e,t):e instanceof As?this._evalLiteral(e,t):e instanceof Xo?this._evalVariable(e,t):e instanceof A_?this._evalCall(e,t):e instanceof hl?this._evalCreate(e,t):e instanceof k2?this._evalConst(e,t):e instanceof F2?this._evalBitcast(e,t):e instanceof ns?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Zt){let n=this.reflection.getTypeInfo(e);if(n!==null)return n}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(let i in e){let n=e[i],s=this.reflection.getOverrideInfo(i);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(i,new ht(n,s.type)):s.type.name==="bool"?t.setVariable(i,new ht(n?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(i,new Fe(n,s.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){let n=[1,1,1];for(let b of e.node.attributes)if(b.name==="workgroup_size"){if(b.value.length>0){let T=i.getVariableValue(b.value[0]);n[0]=T instanceof ht?T.value:parseInt(b.value[0])}if(b.value.length>1){let T=i.getVariableValue(b.value[1]);n[1]=T instanceof ht?T.value:parseInt(b.value[1])}if(b.value.length>2){let T=i.getVariableValue(b.value[2]);n[2]=T instanceof ht?T.value:parseInt(b.value[2])}}let s=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new Fe(n,s));let c=n[0],d=n[1],p=n[2];for(let b=0,T=0;b<p;++b)for(let B=0;B<d;++B)for(let z=0;z<c;++z,++T){let G=[z,B,b],Z=[z+t[0]*n[0],B+t[1]*n[1],b+t[2]*n[2]];i.setVariable("@local_invocation_id",new Fe(G,s)),i.setVariable("@global_invocation_id",new Fe(Z,s)),i.setVariable("@local_invocation_index",new ht(T,a)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(let i of e.node.args)for(let n of i.attributes)if(n.name==="builtin"){let s=`@${n.value}`,a=t.getVariable(s);a!==void 0&&t.variables.set(i.name,a)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof ns;)e=e.right;return e instanceof Xo?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(let i of e){if(i instanceof Array){let s=t.clone(),a=this._execStatements(i,s);if(a)return a;continue}let n=this.execStatement(i,t);if(n)return n}return null}_call(e,t){let i=t.clone();i.currentFunctionName=e.name;let n=t.getFunction(e.name);if(n){for(let s=0;s<n.node.args.length;++s){let a=n.node.args[s],c=this.evalExpression(e.args[s],i);i.setVariable(a.name,c,a)}this._execStatements(n.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){let i=this.getVariableName(e.variable,t),n=t.getVariable(i);n?e.operator==="++"?n.value instanceof ht?n.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?n.value instanceof ht?n.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof Xo){let i=this.getVariableName(e,t),n=t.getVariable(i);return n===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):n.value.getSubData(this,e.postfix,t)}if(e instanceof ns){if(e.operator==="*"){let i=this._getVariableData(e.right,t);return i instanceof Ff?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){let i=this._getVariableData(e.right,t);return new Ff(i)}}return null}_assign(e,t){let i=null,n="<var>",s=null;if(e.variable instanceof ns){let d=this._getVariableData(e.variable,t),p=this.evalExpression(e.value,t),b=e.operator;if(b==="="){if(d instanceof ht||d instanceof Fe||d instanceof $r){if(p instanceof ht||p instanceof Fe||p instanceof $r&&d.data.length===p.data.length)return void d.data.set(p.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(d instanceof Rs&&p instanceof Rs&&d.buffer.byteLength-d.offset>=p.buffer.byteLength-p.offset)return void(d.buffer.byteLength%4==0?new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4).set(new Uint32Array(p.buffer,p.offset,p.typeInfo.size/4)):new Uint8Array(d.buffer,d.offset,d.typeInfo.size).set(new Uint8Array(p.buffer,p.offset,p.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(b==="+=")return d instanceof ht||d instanceof Fe||d instanceof $r?p instanceof ht||p instanceof Fe||p instanceof $r?void d.data.set(p.data.map((T,B)=>d.data[B]+T)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(b==="-=")return(d instanceof ht||d instanceof Fe||d instanceof $r)&&(p instanceof ht||p instanceof Fe||p instanceof $r)?void d.data.set(p.data.map((T,B)=>d.data[B]-T)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof ns){if(e.variable.operator==="*"){n=this.getVariableName(e.variable.right,t);let d=t.getVariable(n);if(!(d&&d.value instanceof Ff))return void console.error(`Variable ${n} is not a pointer. Line ${e.line}`);i=d.value.reference;let p=e.variable.postfix;if(!p){let b=e.variable.right;for(;b instanceof ns;){if(b.postfix){p=b.postfix;break}b=b.right}}p&&(i=i.getSubData(this,p,t))}}else{s=e.variable.postfix,n=this.getVariableName(e.variable,t);let d=t.getVariable(n);if(d===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);i=d.value}if(i instanceof Ff&&(i=i.reference),i===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);let a=this.evalExpression(e.value,t),c=e.operator;if(c==="=")if(i instanceof Rs)i.setDataValue(this,a,s,t);else if(s){if(!(i instanceof Fe||i instanceof $r))return void console.error(`Variable ${n} is not a vector or matrix. Line ${e.line}`);if(s instanceof Nf){let d=this.evalExpression(s.index,t).value;if(i instanceof Fe){if(!(a instanceof ht))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[d]=a.value}else{if(!(i instanceof $r))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let p=this.evalExpression(s.index,t).value;if(p<0)return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(a instanceof Fe))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{let b=i.typeInfo.getTypeName();if(b==="mat2x2"||b==="mat2x2f"||b==="mat2x2h"){if(!(p<2&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(b==="mat2x3"||b==="mat2x3f"||b==="mat2x3h"){if(!(p<2&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else if(b==="mat2x4"||b==="mat2x4f"||b==="mat2x4h"){if(!(p<2&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}else if(b==="mat3x2"||b==="mat3x2f"||b==="mat3x2h"){if(!(p<3&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(b==="mat3x3"||b==="mat3x3f"||b==="mat3x3h"){if(!(p<3&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else if(b==="mat3x4"||b==="mat3x4f"||b==="mat3x4h"){if(!(p<3&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}else if(b==="mat4x2"||b==="mat4x2f"||b==="mat4x2h"){if(!(p<4&&a.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*p]=a.data[0],i.data[2*p+1]=a.data[1]}else if(b==="mat4x3"||b==="mat4x3f"||b==="mat4x3h"){if(!(p<4&&a.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*p]=a.data[0],i.data[3*p+1]=a.data[1],i.data[3*p+2]=a.data[2]}else{if(b!=="mat4x4"&&b!=="mat4x4f"&&b!=="mat4x4h")return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(p<4&&a.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*p]=a.data[0],i.data[4*p+1]=a.data[1],i.data[4*p+2]=a.data[2],i.data[4*p+3]=a.data[3]}}}}}else if(s instanceof fh){let d=s.value;if(!(i instanceof Fe))return void console.error(`Invalid assignment to ${d}. Variable ${n} is not a vector. Line ${e.line}`);if(a instanceof ht){if(d.length>1)return void console.error(`Invalid assignment to ${d} for variable ${n}. Line ${e.line}`);if(d==="x")i.data[0]=a.value;else if(d==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${d} for variable ${n}. Line ${e.line}`);i.data[1]=a.value}else if(d==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${d} for variable ${n}. Line ${e.line}`);i.data[2]=a.value}else if(d==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${d} for variable ${n}. Line ${e.line}`);i.data[3]=a.value}}else{if(!(a instanceof Fe))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(d.length!==a.data.length)return void console.error(`Invalid assignment to ${d} for variable ${n}. Line ${e.line}`);for(let p=0;p<d.length;++p){let b=d[p];if(b==="x"||b==="r")i.data[0]=a.data[p];else if(b==="y"||b==="g"){if(a.data.length<2)return void console.error(`Invalid assignment to ${b} for variable ${n}. Line ${e.line}`);i.data[1]=a.data[p]}else if(b==="z"||b==="b"){if(a.data.length<3)return void console.error(`Invalid assignment to ${b} for variable ${n}. Line ${e.line}`);i.data[2]=a.data[p]}else{if(b!=="w"&&b!=="a")return void console.error(`Invalid assignment to ${b} for variable ${n}. Line ${e.line}`);if(a.data.length<4)return void console.error(`Invalid assignment to ${b} for variable ${n}. Line ${e.line}`);i.data[3]=a.data[p]}}}}}else i instanceof ht&&a instanceof ht?i.value=a.value:i instanceof Fe&&a instanceof Fe||i instanceof $r&&a instanceof $r?i.data.set(a.data):console.error(`Invalid assignment to ${n}. Line ${e.line}`);else{let d=i.getSubData(this,s,t);if(d instanceof Fe&&a instanceof ht){let p=d.data,b=a.value;if(c==="+=")for(let T=0;T<p.length;++T)p[T]+=b;else if(c==="-=")for(let T=0;T<p.length;++T)p[T]-=b;else if(c==="*=")for(let T=0;T<p.length;++T)p[T]*=b;else if(c==="/=")for(let T=0;T<p.length;++T)p[T]/=b;else if(c==="%=")for(let T=0;T<p.length;++T)p[T]%=b;else if(c==="&=")for(let T=0;T<p.length;++T)p[T]&=b;else if(c==="|=")for(let T=0;T<p.length;++T)p[T]|=b;else if(c==="^=")for(let T=0;T<p.length;++T)p[T]^=b;else if(c==="<<=")for(let T=0;T<p.length;++T)p[T]<<=b;else if(c===">>=")for(let T=0;T<p.length;++T)p[T]>>=b;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(d instanceof Fe&&a instanceof Fe){let p=d.data,b=a.data;if(p.length!==b.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let T=0;T<p.length;++T)p[T]+=b[T];else if(c==="-=")for(let T=0;T<p.length;++T)p[T]-=b[T];else if(c==="*=")for(let T=0;T<p.length;++T)p[T]*=b[T];else if(c==="/=")for(let T=0;T<p.length;++T)p[T]/=b[T];else if(c==="%=")for(let T=0;T<p.length;++T)p[T]%=b[T];else if(c==="&=")for(let T=0;T<p.length;++T)p[T]&=b[T];else if(c==="|=")for(let T=0;T<p.length;++T)p[T]|=b[T];else if(c==="^=")for(let T=0;T<p.length;++T)p[T]^=b[T];else if(c==="<<=")for(let T=0;T<p.length;++T)p[T]<<=b[T];else if(c===">>=")for(let T=0;T<p.length;++T)p[T]>>=b[T];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(d instanceof ht&&a instanceof ht))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?d.value+=a.value:c==="-="?d.value-=a.value:c==="*="?d.value*=a.value:c==="/="?d.value/=a.value:c==="%="?d.value%=a.value:c==="&="?d.value&=a.value:c==="|="?d.value|=a.value:c==="^="?d.value^=a.value:c==="<<="?d.value<<=a.value:c===">>="?d.value>>=a.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}i instanceof Rs&&i.setDataValue(this,d,s,t)}}_function(e,t){let i=new IS(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ns||(i=i.clone())}else{let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||n==="array"){let s=new hl(e.type,[]);i=this._evalCreate(s,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ns||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);let n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||e.type instanceof gp||e.type instanceof oc||e.type instanceof pt){let s=new hl(e.type,[]);i=this._evalCreate(s,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();let i=this.evalExpression(e.condition,t);if(!(i instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;let n=null;for(let s of e.cases)if(s instanceof U2)for(let a of s.selectors){if(a instanceof f0){n=s;continue}let c=this.evalExpression(a,t);if(!(c instanceof ht))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===i.value)return this._execStatements(s.body,t)}else s instanceof V2&&(n=s);return n?this._execStatements(n.body,t):null}_if(e,t){t=t.clone();let i=this.evalExpression(e.condition,t);if(!(i instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(let n of e.elseif){let s=this.evalExpression(n.condition,t);if(!(s instanceof ht))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(n.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof ht?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){let i=this._execStatements(e.body,t);if(i===r._breakObj)break;if(i!==null&&i!==r._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){let i=this._execStatements(e.body,t);if(i===r._breakObj)break;if(i===r._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===r._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){let i=this._execStatements(e.body,t);if(i===r._breakObj)break;if(i!==r._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){let i=this.evalExpression(e.value,t),n=e.type;if(i instanceof ht){let s=IL(i.value,i.typeInfo.name,n.name);return new ht(s,this.getTypeInfo(n))}if(i instanceof Fe){let s=i.typeInfo.getTypeName(),a="";if(s.endsWith("f"))a="f32";else if(s.endsWith("i"))a="i32";else if(s.endsWith("u"))a="u32";else if(s.endsWith("b"))a="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;a="f16"}let c=n.getTypeName(),d="";if(c.endsWith("f"))d="f32";else if(c.endsWith("i"))d="i32";else if(c.endsWith("u"))d="u32";else if(c.endsWith("b"))d="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${d}. Line ${e.line}`),null;d="f16"}let p=function(b,T,B){if(T===B)return b;let z=new Array(b.length);for(let G=0;G<b.length;G++)z[G]=IL(b[G],T,B);return z}(Array.from(i.data),a,d);return new Fe(p,this.getTypeInfo(n))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof hl){if(e.type===null)return m_.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}let n=e instanceof hl?e.type.name:e.name,s=e instanceof hl?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${n}. Line ${e.line}`),null;if(s.size===0)return null;let a=new Rs(new ArrayBuffer(s.size),s,0);if(s instanceof ou){if(e.args)for(let c=0;c<e.args.length;++c){let d=s.members[c],p=e.args[c],b=this.evalExpression(p,t);a.setData(this,b,d.type,d.offset,t)}}else if(s instanceof au){let c=0;if(e.args)for(let d=0;d<e.args.length;++d){let p=e.args[d],b=this.evalExpression(p,t);s.format===null&&(((i=b.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=b.typeInfo),a.setData(this,b,s.format,c,t),c+=s.stride}}else console.error(`Unknown type "${n}". Line ${e.line}`);return e instanceof hl?a.getSubData(this,e.postfix,t):a}_evalLiteral(e,t){let i=this.getTypeInfo(e.type),n=i.name;return n==="x32"||n==="u32"||n==="f32"||n==="f16"||n==="i32"||n==="bool"?new ht(e.scalarValue,i):n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"?this._callConstructorVec(e,t):n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){let i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){let n=r._priority.get(t.name);r._priority.get(e[i].name)<n&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){let i=this.evalExpression(e.right,t);if(e.operator==="&")return new Ff(i);if(e.operator==="*")return i instanceof Ff?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);let n=i instanceof ht?i.value:i instanceof Fe?Array.from(i.data):null;switch(e.operator){case"+":{if(pr(n)){let c=n.map((d,p)=>+d);return new Fe(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(+s,a)}case"-":{if(pr(n)){let c=n.map((d,p)=>-d);return new Fe(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(-s,a)}case"!":{if(pr(n)){let c=n.map((d,p)=>d?0:1);return new Fe(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(s?0:1,a)}case"~":{if(pr(n)){let c=n.map((d,p)=>~d);return new Fe(c,i.typeInfo)}let s=n,a=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new ht(~s,a)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){let i=this.evalExpression(e.left,t),n=this.evalExpression(e.right,t),s=i instanceof ht?i.value:i instanceof Fe||i instanceof $r?Array.from(i.data):null,a=n instanceof ht?n.value:n instanceof Fe||n instanceof $r?Array.from(n.data):null;switch(e.operator){case"+":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z+T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B+b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b+B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c+d,p)}case"-":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z-T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B-b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b-B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c-d,p)}case"*":{if(pr(s)&&pr(a)){let b=s,T=a;if(i instanceof $r&&n instanceof $r){let B=function(q,re,ee,ae){if(Zo[re.name]===void 0||Zo[ae.name]===void 0)return null;let me=Zo[re.name][0],Le=Zo[re.name][1],je=Zo[ae.name][0];if(me!==Zo[ae.name][1])return null;let Je=new Array(je*Le);for(let J=0;J<Le;J++)for(let te=0;te<je;te++){let X=0;for(let ye=0;ye<me;ye++)X+=q[ye*Le+J]*ee[te*me+ye];Je[J*je+te]=X}return Je}(b,i.typeInfo,T,n.typeInfo);if(B===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;let z=Zo[n.typeInfo.name][0],G=Zo[i.typeInfo.name][1],Z=this.getTypeInfo(`mat${z}x${G}f`);return new $r(B,Z)}if(i instanceof $r&&n instanceof Fe){let B=function(z,G,Z,q){if(Zo[G.name]===void 0||dS[q.name]===void 0)return null;let re=Zo[G.name][0],ee=Zo[G.name][1];if(re!==Z.length)return null;let ae=new Array(ee);for(let me=0;me<ee;me++){let Le=0;for(let je=0;je<re;je++)Le+=z[je*ee+me]*Z[je];ae[me]=Le}return ae}(b,i.typeInfo,T,n.typeInfo);return B===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Fe(B,n.typeInfo)}if(i instanceof Fe&&n instanceof $r){let B=function(z,G,Z,q){if(dS[G.name]===void 0||Zo[q.name]===void 0)return null;let re=Zo[q.name][0],ee=Zo[q.name][1];if(ee!==z.length)return null;let ae=[];for(let me=0;me<re;me++){let Le=0;for(let je=0;je<ee;je++)Le+=z[je]*Z[je*re+me];ae[me]=Le}return ae}(b,i.typeInfo,T,n.typeInfo);return B===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Fe(B,i.typeInfo)}{if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z*T[G]);return new Fe(B,i.typeInfo)}}if(pr(s)){let b=a,T=s.map((B,z)=>B*b);return i instanceof $r?new $r(T,i.typeInfo):new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b*B);return n instanceof $r?new $r(T,n.typeInfo):new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c*d,p)}case"%":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z%T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B%b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b%B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c%d,p)}case"/":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z/T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B/b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b/B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c/d,p)}case"&":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z&T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B&b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b&B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c&d,p)}case"|":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z|T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B|b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b|B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c|d,p)}case"^":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z^T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B^b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b^B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c^d,p)}case"<<":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z<<T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B<<b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b<<B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c<<d,p)}case">>":{if(pr(s)&&pr(a)){let b=s,T=a;if(b.length!==T.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let B=b.map((z,G)=>z>>T[G]);return new Fe(B,i.typeInfo)}if(pr(s)){let b=a,T=s.map((B,z)=>B>>b);return new Fe(T,i.typeInfo)}if(pr(a)){let b=s,T=a.map((B,z)=>b>>B);return new Fe(T,n.typeInfo)}let c=s,d=a,p=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new ht(c>>d,p)}case">":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b>d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p>c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c>p?1:0);return new Fe(d,n.typeInfo)}return new ht(s>a?1:0,this.getTypeInfo("bool"));case"<":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b<d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p<c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c<p?1:0);return new Fe(d,n.typeInfo)}return new ht(s<a?1:0,this.getTypeInfo("bool"));case"==":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b===d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p==c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c==p?1:0);return new Fe(d,n.typeInfo)}return new ht(s===a?1:0,this.getTypeInfo("bool"));case"!=":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b!==d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p!==c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c!==p?1:0);return new Fe(d,n.typeInfo)}return new ht(s!==a?1:0,this.getTypeInfo("bool"));case">=":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b>=d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p>=c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c>=p?1:0);return new Fe(d,n.typeInfo)}return new ht(s>=a?1:0,this.getTypeInfo("bool"));case"<=":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b<=d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p<=c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c<=p?1:0);return new Fe(d,n.typeInfo)}return new ht(s<=a?1:0,this.getTypeInfo("bool"));case"&&":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b&&d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p&&c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c&&p?1:0);return new Fe(d,n.typeInfo)}return new ht(s&&a?1:0,this.getTypeInfo("bool"));case"||":if(pr(s)&&pr(a)){let c=s,d=a;if(c.length!==d.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;let p=c.map((b,T)=>b||d[T]?1:0);return new Fe(p,i.typeInfo)}if(pr(s)){let c=a,d=s.map((p,b)=>p||c?1:0);return new Fe(d,i.typeInfo)}if(pr(a)){let c=s,d=a.map((p,b)=>c||p?1:0);return new Fe(d,n.typeInfo)}return new ht(s||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;let i=t.clone();i.currentFunctionName=e.name;let n=t.getFunction(e.name);if(!n)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<n.node.args.length;++s){let a=n.node.args[s],c=this.evalExpression(e.args[s],i);i.createVariable(a.name,c,a)}return this._execStatements(n.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}let i=t.getFunction(e.name);if(i){let n=t.clone();for(let s=0;s<i.node.args.length;++s){let a=i.node.args[s],c=this.evalExpression(e.args[s],n);n.setVariable(a.name,c,a)}return this._execStatements(i.node.body,n)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new ht(0,this.getTypeInfo(e.type));let i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){let i=this.getTypeInfo(e.type),n=e.type.getTypeName(),s=dS[n];if(s===void 0)return console.error(`Invalid vec constructor ${n}. Line ${e.line}`),null;let a=[];if(e instanceof As)if(e.isVector){let c=e.vectorValue;for(let d of c)a.push(d)}else a.push(e.scalarValue);else if(e.args)for(let c of e.args){let d=this.evalExpression(c,t);if(d instanceof Fe){let p=d.data;for(let b=0;b<p.length;++b){let T=p[b];a.push(T)}}else if(d instanceof ht){let p=d.value;a.push(p)}}if(e.type instanceof pt&&e.type.format===null&&(e.type.format=pt.f32),a.length===0){let c=new Array(s).fill(0);return new Fe(c,i).getSubData(this,e.postfix,t)}if(a.length===1)for(;a.length<s;)a.push(a[0]);return a.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Fe(a.length>s?a.slice(0,s):a,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){let i=this.getTypeInfo(e.type),n=e.type.getTypeName(),s=Zo[n];if(s===void 0)return console.error(`Invalid matrix constructor ${n}. Line ${e.line}`),null;let a=[];if(e instanceof As)if(e.isVector){let c=e.vectorValue;for(let d of c)a.push(d)}else a.push(e.scalarValue);else if(e.args)for(let c of e.args){let d=this.evalExpression(c,t);d instanceof Fe?a.push(...d.data):d instanceof ht?a.push(d.value):d instanceof $r&&a.push(...d.data)}if(i instanceof hh&&i.format===null&&(i.format=this.getTypeInfo("f32")),a.length===0){let c=new Array(s[2]).fill(0);return new $r(c,i).getSubData(this,e.postfix,t)}return a.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new $r(a,i).getSubData(this,e.postfix,t)}};d0._breakObj=new pl(new pa("BREAK",null),null),d0._continueObj=new pl(new pa("CONTINUE",null),null),d0._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);var BS=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},LS=class{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new BS,this._exec=new d0,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let t=[];for(;!this._isAtEnd();){let i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(let i of this._deferArrayCountEval){let n=i.arrayType,s=i.countNode;if(s instanceof Xo){let a=s.name,c=this._context.constants.get(a);if(c)try{let d=c.constEvaluate(this._exec);n.count=d}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let i of t)i.search(n=>{n instanceof G2||n instanceof u_?n.type=this._forwardType(n.type):n instanceof gp?n.format=this._forwardType(n.format):n instanceof ac||n instanceof mp||n instanceof h0?n.type=this._forwardType(n.type):n instanceof yp?n.returnType=this._forwardType(n.returnType):n instanceof j2&&(n.type=this._forwardType(n.type))});return t}_forwardType(e){if(e instanceof D2){let t=this._getType(e.name);if(t)return t}else e instanceof u_?e.type=this._forwardType(e.type):e instanceof gp&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){let t=new ES(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ce.eof}_match(e){if(e instanceof lt)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){let n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;let t=this._peek();if(e instanceof Array){let i=t.type,n=!1;for(let s of e){if(i===s)return!0;s===Ce.tokens.name&&(n=!0)}if(n){let s=Ce.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Ce.tokens.name){let i=Ce.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ce.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ce.keywords.alias)){let t=this._type_alias();return this._consume(Ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Ce.keywords.diagnostic)){let t=this._diagnostic();return this._consume(Ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Ce.keywords.requires)){let t=this._requires_directive();return this._consume(Ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Ce.keywords.enable)){let t=this._enable_directive();return this._consume(Ce.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}let e=this._attribute();if(this._check(Ce.keywords.var)){let t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(Ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ce.keywords.override)){let t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(Ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ce.keywords.let)){let t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(Ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ce.keywords.const)){let t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(Ce.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Ce.keywords.struct)){let t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Ce.keywords.fn)){let t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Ce.keywords.fn))return null;let e=this._currentLine,t=this._consume(Ce.tokens.ident,"Expected function name.").toString();this._consume(Ce.tokens.paren_left,"Expected '(' for function arguments.");let i=[];if(!this._check(Ce.tokens.paren_right))do{if(this._check(Ce.tokens.paren_right))break;let c=this._attribute(),d=this._consume(Ce.tokens.name,"Expected argument name.").toString();this._consume(Ce.tokens.colon,"Expected ':' for argument type.");let p=this._attribute(),b=this._type_decl();b!=null&&(b.attributes=p,i.push(this._updateNode(new j2(d,b,c))))}while(this._match(Ce.tokens.comma));this._consume(Ce.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(Ce.tokens.arrow)){let c=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=c)}let s=this._compound_statement(),a=this._currentLine;return this._updateNode(new yp(t,i,n,s,e,a),e)}_compound_statement(){let e=[];for(this._consume(Ce.tokens.brace_left,"Expected '{' for block.");!this._check(Ce.tokens.brace_right);){let t=this._statement();t!==null&&e.push(t)}return this._consume(Ce.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Ce.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ce.tokens.attr)&&this._attribute(),this._check(Ce.keywords.if))return this._if_statement();if(this._check(Ce.keywords.switch))return this._switch_statement();if(this._check(Ce.keywords.loop))return this._loop_statement();if(this._check(Ce.keywords.for))return this._for_statement();if(this._check(Ce.keywords.while))return this._while_statement();if(this._check(Ce.keywords.continuing))return this._continuing_statement();if(this._check(Ce.keywords.static_assert))return this._static_assert_statement();if(this._check(Ce.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Ce.keywords.return))e=this._return_statement();else if(this._check([Ce.keywords.var,Ce.keywords.let,Ce.keywords.const]))e=this._variable_statement();else if(this._match(Ce.keywords.discard))e=this._updateNode(new wS);else if(this._match(Ce.keywords.break)){let t=this._updateNode(new L2);if(this._currentLoop.length>0){let i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(Ce.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Ce.keywords.continue)){let t=this._updateNode(new O2);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{let i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Ce.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Ce.keywords.static_assert))return null;let e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new xS(t),e)}_while_statement(){if(!this._match(Ce.keywords.while))return null;let e=this._updateNode(new T2(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ce.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){let e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Ce.keywords.continuing))return null;let t=this._currentLine,i=this._compound_statement();return this._updateNode(new h_(i,e),t)}_for_statement(){if(!this._match(Ce.keywords.for))return null;this._consume(Ce.tokens.paren_left,"Expected '('.");let e=this._updateNode(new E2(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Ce.tokens.semicolon)?null:this._for_init(),this._consume(Ce.tokens.semicolon,"Expected ';'."),e.condition=this._check(Ce.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Ce.tokens.semicolon,"Expected ';'."),e.increment=this._check(Ce.tokens.paren_right)?null:this._for_increment(),this._consume(Ce.tokens.paren_right,"Expected ')'."),this._check(Ce.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ce.keywords.var)){let e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Ce.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new ac(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Ce.keywords.let)){let e=this._currentLine,t=this._consume(Ce.tokens.name,"Expected name for let.").toString(),i=null;if(this._match(Ce.tokens.colon)){let s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(Ce.tokens.equal,"Expected '=' for let.");let n=this._short_circuit_or_expression();return this._updateNode(new mp(t,i,null,null,n),e)}if(this._match(Ce.keywords.const)){let e=this._currentLine,t=this._consume(Ce.tokens.name,"Expected name for const.").toString(),i=null;if(this._match(Ce.tokens.colon)){let s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}this._consume(Ce.tokens.equal,"Expected '=' for const.");let n=this._short_circuit_or_expression();return i===null&&n instanceof As&&(i=n.type),this._updateNode(new h0(t,i,null,null,n),e)}return null}_increment_decrement_statement(){let e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(Ce.increment_operators))return this._current=e,null;let i=this._consume(Ce.increment_operators,"Expected increment operator");return this._updateNode(new S2(i.type===Ce.tokens.plus_plus?c0.increment:c0.decrement,t))}_assignment_statement(){let e=null,t=this._currentLine;if(this._check(Ce.tokens.brace_right))return null;let i=this._match(Ce.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;let n=this._consume(Ce.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new C2(c_.parse(n.lexeme),e,s),t)}_func_call_statement(){if(!this._check(Ce.tokens.ident))return null;let e=this._currentLine,t=this._current,i=this._consume(Ce.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):this._updateNode(new d_(i.lexeme,n),e)}_loop_statement(){if(!this._match(Ce.keywords.loop))return null;this._check(Ce.tokens.attr)&&this._attribute(),this._consume(Ce.tokens.brace_left,"Expected '{' for loop.");let e=this._updateNode(new I2([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof h_){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Ce.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Ce.keywords.switch))return null;let e=this._updateNode(new P2(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Ce.tokens.attr)&&this._attribute(),this._consume(Ce.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ce.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){let e=[],t=!1;for(;this._check([Ce.keywords.default,Ce.keywords.case]);){if(this._match(Ce.keywords.case)){let i=this._case_selectors();for(let s of i)if(s instanceof f0){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Ce.tokens.colon),this._check(Ce.tokens.attr)&&this._attribute(),this._consume(Ce.tokens.brace_left,"Exected '{' for switch case.");let n=this._case_body();this._consume(Ce.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new U2(i,n)))}if(this._match(Ce.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Ce.tokens.colon),this._check(Ce.tokens.attr)&&this._attribute(),this._consume(Ce.tokens.brace_left,"Exected '{' for switch default.");let i=this._case_body();this._consume(Ce.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new V2(i)))}}return e}_case_selectors(){let e=[];for(this._match(Ce.keywords.default)?e.push(this._updateNode(new f0)):e.push(this._shift_expression());this._match(Ce.tokens.comma);)this._match(Ce.keywords.default)?e.push(this._updateNode(new f0)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Ce.keywords.fallthrough))return this._consume(Ce.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);let t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(Ce.keywords.if))return null;let e=this._currentLine,t=this._optional_paren_expression();this._check(Ce.tokens.attr)&&this._attribute();let i=this._compound_statement(),n=[];this._match_elseif()&&(this._check(Ce.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let s=null;return this._match(Ce.keywords.else)&&(this._check(Ce.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new M2(t,i,n,s),e)}_match_elseif(){return this._tokens[this._current].type===Ce.keywords.else&&this._tokens[this._current+1].type===Ce.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new TS(t,i))),this._match_elseif()&&(this._check(Ce.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Ce.keywords.return))return null;let e=this._short_circuit_or_expression();return this._updateNode(new R2(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Ce.tokens.or_or);)e=this._updateNode(new Va(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Ce.tokens.and_and);)e=this._updateNode(new Va(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Ce.tokens.or);)e=this._updateNode(new Va(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Ce.tokens.xor);)e=this._updateNode(new Va(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Ce.tokens.and);)e=this._updateNode(new Va(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){let e=this._relational_expression();return this._match([Ce.tokens.equal_equal,Ce.tokens.not_equal])?this._updateNode(new Va(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Ce.tokens.less_than,Ce.tokens.greater_than,Ce.tokens.less_than_equal,Ce.tokens.greater_than_equal]);)e=this._updateNode(new Va(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Ce.tokens.shift_left,Ce.tokens.shift_right]);)e=this._updateNode(new Va(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Ce.tokens.plus,Ce.tokens.minus]);)e=this._updateNode(new Va(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Ce.tokens.star,Ce.tokens.forward_slash,Ce.tokens.modulo]);)e=this._updateNode(new Va(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Ce.tokens.minus,Ce.tokens.bang,Ce.tokens.tilde,Ce.tokens.star,Ce.tokens.and])?this._updateNode(new ns(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Ce.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(Ce.tokens.bracket_right,"Expected ']'.");let t=this._updateNode(new Nf(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(Ce.tokens.period)){let e=this._consume(Ce.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new fh(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){let t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Zt.void;case"bool":return Zt.bool;case"i32":return Zt.i32;case"u32":return Zt.u32;case"f32":return Zt.f32;case"f16":return Zt.f16;case"vec2f":return pt.vec2f;case"vec3f":return pt.vec3f;case"vec4f":return pt.vec4f;case"vec2i":return pt.vec2i;case"vec3i":return pt.vec3i;case"vec4i":return pt.vec4i;case"vec2u":return pt.vec2u;case"vec3u":return pt.vec3u;case"vec4u":return pt.vec4u;case"vec2h":return pt.vec2h;case"vec3h":return pt.vec3h;case"vec4h":return pt.vec4h;case"mat2x2f":return pt.mat2x2f;case"mat2x3f":return pt.mat2x3f;case"mat2x4f":return pt.mat2x4f;case"mat3x2f":return pt.mat3x2f;case"mat3x3f":return pt.mat3x3f;case"mat3x4f":return pt.mat3x4f;case"mat4x2f":return pt.mat4x2f;case"mat4x3f":return pt.mat4x3f;case"mat4x4f":return pt.mat4x4f;case"mat2x2h":return pt.mat2x2h;case"mat2x3h":return pt.mat2x3h;case"mat2x4h":return pt.mat2x4h;case"mat3x2h":return pt.mat3x2h;case"mat3x3h":return pt.mat3x3h;case"mat3x4h":return pt.mat3x4h;case"mat4x2h":return pt.mat4x2h;case"mat4x3h":return pt.mat4x3h;case"mat4x4h":return pt.mat4x4h;case"mat2x2i":return pt.mat2x2i;case"mat2x3i":return pt.mat2x3i;case"mat2x4i":return pt.mat2x4i;case"mat3x2i":return pt.mat3x2i;case"mat3x3i":return pt.mat3x3i;case"mat3x4i":return pt.mat3x4i;case"mat4x2i":return pt.mat4x2i;case"mat4x3i":return pt.mat4x3i;case"mat4x4i":return pt.mat4x4i;case"mat2x2u":return pt.mat2x2u;case"mat2x3u":return pt.mat2x3u;case"mat2x4u":return pt.mat2x4u;case"mat3x2u":return pt.mat3x2u;case"mat3x3u":return pt.mat3x3u;case"mat3x4u":return pt.mat3x4u;case"mat4x2u":return pt.mat4x2u;case"mat4x3u":return pt.mat4x3u;case"mat4x4u":return pt.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Ce.tokens.ident)){let i=this._previous().toString();if(this._check(Ce.tokens.paren_left)){let n=this._argument_expression_list(),s=this._getType(i);return s!==null?this._updateNode(new hl(s,n)):this._updateNode(new A_(i,n))}if(this._context.constants.has(i)){let n=this._context.constants.get(i);return this._updateNode(new k2(i,n.value))}return this._updateNode(new Xo(i))}if(this._match(Ce.tokens.int_literal)){let i=this._previous().toString(),n=i.endsWith("i")||i.endsWith("i")?Zt.i32:i.endsWith("u")||i.endsWith("U")?Zt.u32:Zt.x32,s=parseInt(i);return this._validateTypeRange(s,n),this._updateNode(new As(new ht(s,this._exec.getTypeInfo(n)),n))}if(this._match(Ce.tokens.uint_literal)){let i=parseInt(this._previous().toString());return this._validateTypeRange(i,Zt.u32),this._updateNode(new As(new ht(i,this._exec.getTypeInfo(Zt.u32)),Zt.u32))}if(this._match([Ce.tokens.decimal_float_literal,Ce.tokens.hex_float_literal])){let i=this._previous().toString(),n=i.endsWith("h");n&&(i=i.substring(0,i.length-1));let s=parseFloat(i);this._validateTypeRange(s,n?Zt.f16:Zt.f32);let a=n?Zt.f16:Zt.f32;return this._updateNode(new As(new ht(s,this._exec.getTypeInfo(a)),a))}if(this._match([Ce.keywords.true,Ce.keywords.false])){let i=this._previous().toString()===Ce.keywords.true.rule;return this._updateNode(new As(new ht(i?1:0,this._exec.getTypeInfo(Zt.bool)),Zt.bool))}if(this._check(Ce.tokens.paren_left))return this._paren_expression();if(this._match(Ce.keywords.bitcast)){this._consume(Ce.tokens.less_than,"Expected '<'.");let i=this._type_decl();this._consume(Ce.tokens.greater_than,"Expected '>'.");let n=this._paren_expression();return this._updateNode(new F2(i,n))}let e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new hl(e,t))}_argument_expression_list(){if(!this._match(Ce.tokens.paren_left))return null;let e=[];do{if(this._check(Ce.tokens.paren_right))break;let t=this._short_circuit_or_expression();e.push(t)}while(this._match(Ce.tokens.comma));return this._consume(Ce.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Ce.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(Ce.tokens.paren_right),e}_paren_expression(){this._consume(Ce.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(Ce.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Ce.keywords.struct))return null;let e=this._currentLine,t=this._consume(Ce.tokens.ident,"Expected name for struct.").toString();this._consume(Ce.tokens.brace_left,"Expected '{' for struct body.");let i=[];for(;!this._check(Ce.tokens.brace_right);){let a=this._attribute(),c=this._consume(Ce.tokens.name,"Expected variable name.").toString();this._consume(Ce.tokens.colon,"Expected ':' for struct member type.");let d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d),this._check(Ce.tokens.brace_right)?this._match(Ce.tokens.comma):this._consume(Ce.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new G2(c,p,a)))}this._consume(Ce.tokens.brace_right,"Expected '}' after struct body.");let n=this._currentLine,s=this._updateNode(new oc(t,i,e,n),e);return this._context.structs.set(t,s),s}_global_variable_decl(){let e=this._variable_decl();if(!e)return null;if(this._match(Ce.tokens.equal)){let t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof As){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof As&&(e.type=e.value.type.name==="x32"?Zt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(Ce.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Ce.keywords.const))return null;let t=this._consume(Ce.tokens.name,"Expected variable name"),i=this._currentLine,n=null;if(this._match(Ce.tokens.colon)){let d=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=d)}let s=null;this._consume(Ce.tokens.equal,"const declarations require an assignment");let a=this._short_circuit_or_expression();try{let d=[Zt.f32],p=a.constEvaluate(this._exec,d);p instanceof ht&&this._validateTypeRange(p.value,d[0]),d[0]instanceof pt&&d[0].format===null&&p.typeInfo instanceof hh&&p.typeInfo.format!==null&&(p.typeInfo.format.name==="f16"?d[0].format=Zt.f16:p.typeInfo.format.name==="f32"?d[0].format=Zt.f32:p.typeInfo.format.name==="i32"?d[0].format=Zt.i32:p.typeInfo.format.name==="u32"?d[0].format=Zt.u32:p.typeInfo.format.name==="bool"?d[0].format=Zt.bool:console.error(`TODO: impelement template format type ${p.typeInfo.format.name}`)),s=this._updateNode(new As(p,d[0])),this._exec.context.setVariable(t.toString(),p)}catch{s=a}if(n!==null&&s instanceof As){if(s.type.name!=="x32"&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else n===null&&s instanceof As&&(n=(e=s?.type)!==null&&e!==void 0?e:Zt.f32,n===Zt.x32&&(n=Zt.i32));let c=this._updateNode(new h0(t.toString(),n,"","",s),i);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(Ce.keywords.let))return null;let e=this._currentLine,t=this._consume(Ce.tokens.name,"Expected variable name"),i=null;if(this._match(Ce.tokens.colon)){let s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}let n=null;if(this._match(Ce.tokens.equal)&&(n=this._const_expression()),i!==null&&n instanceof As){if(n.type.name!=="x32"&&i.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${i.name}. Line:${this._currentLine}`);n.type=i}else i===null&&n instanceof As&&(i=n.type.name==="x32"?Zt.i32:n.type);return n instanceof As&&n.isScalar&&this._validateTypeRange(n.scalarValue,i),this._updateNode(new mp(t.toString(),i,"","",n),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Ce.keywords.var))return null;let e=this._currentLine,t="",i="";this._match(Ce.tokens.less_than)&&(t=this._consume(Ce.storage_class,"Expected storage_class.").toString(),this._match(Ce.tokens.comma)&&(i=this._consume(Ce.access_mode,"Expected access_mode.").toString()),this._consume(Ce.tokens.greater_than,"Expected '>'."));let n=this._consume(Ce.tokens.name,"Expected variable name"),s=null;if(this._match(Ce.tokens.colon)){let a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}return this._updateNode(new ac(n.toString(),s,t,i,null),e)}_override_decl(){if(!this._match(Ce.keywords.override))return null;let e=this._consume(Ce.tokens.name,"Expected variable name"),t=null;if(this._match(Ce.tokens.colon)){let i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new f_(e.toString(),t,null))}_diagnostic(){this._consume(Ce.tokens.paren_left,"Expected '('");let e=this._consume(Ce.tokens.ident,"Expected severity control name.");this._consume(Ce.tokens.comma,"Expected ','");let t=this._consume(Ce.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Ce.tokens.period)&&(t+=`.${this._consume(Ce.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Ce.tokens.paren_right,"Expected ')'"),this._updateNode(new B2(e.toString(),t))}_enable_directive(){let e=this._consume(Ce.tokens.ident,"identity expected.");return this._updateNode(new bS(e.toString()))}_requires_directive(){let e=[this._consume(Ce.tokens.ident,"identity expected.").toString()];for(;this._match(Ce.tokens.comma);){let t=this._consume(Ce.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new vS(e))}_type_alias(){let e=this._consume(Ce.tokens.ident,"identity expected.");this._consume(Ce.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);let i=this._updateNode(new p_(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([Ce.tokens.ident,...Ce.texel_format,Ce.keywords.bool,Ce.keywords.f32,Ce.keywords.i32,Ce.keywords.u32])){let i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){let n=this._updateNode(new D2(i));return this._forwardTypeCount++,n}return this._updateNode(new Zt(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Ce.template_types)){let i=this._advance().toString(),n=null,s=null;return this._match(Ce.tokens.less_than)&&(n=this._type_decl(),s=null,this._match(Ce.tokens.comma)&&(s=this._consume(Ce.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ce.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new pt(i,n,s))}if(this._match(Ce.keywords.ptr)){let i=this._previous().toString();this._consume(Ce.tokens.less_than,"Expected '<' for pointer.");let n=this._consume(Ce.storage_class,"Expected storage_class for pointer");this._consume(Ce.tokens.comma,"Expected ',' for pointer.");let s=this._type_decl(),a=null;return this._match(Ce.tokens.comma)&&(a=this._consume(Ce.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ce.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new u_(i,n.toString(),s,a))}let t=this._attribute();if(this._match(Ce.keywords.array)){let i=null,n=-1,s=this._previous(),a=null;if(this._match(Ce.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let d="";if(this._match(Ce.tokens.comma)){a=this._shift_expression();try{d=a.constEvaluate(this._exec).toString(),a=null}catch{d="1"}}this._consume(Ce.tokens.greater_than,"Expected '>' for array."),n=d?parseInt(d):0}let c=this._updateNode(new gp(s.toString(),t,i,n));return a&&this._deferArrayCountEval.push({arrayType:c,countNode:a}),c}return null}_texture_sampler_types(){if(this._match(Ce.sampler_type))return this._updateNode(new Ap(this._previous().toString(),null,null));if(this._match(Ce.depth_texture_type))return this._updateNode(new Ap(this._previous().toString(),null,null));if(this._match(Ce.sampled_texture_type)||this._match(Ce.multisampled_texture_type)){let e=this._previous();this._consume(Ce.tokens.less_than,"Expected '<' for sampler type.");let t=this._type_decl();return this._consume(Ce.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ap(e.toString(),t,null))}if(this._match(Ce.storage_texture_type)){let e=this._previous();this._consume(Ce.tokens.less_than,"Expected '<' for sampler type.");let t=this._consume(Ce.texel_format,"Invalid texel format.").toString();this._consume(Ce.tokens.comma,"Expected ',' after texel format.");let i=this._consume(Ce.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ce.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Ap(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(Ce.tokens.attr);){let t=this._consume(Ce.attribute_name,"Expected attribute name"),i=this._updateNode(new H2(t.toString(),null));if(this._match(Ce.tokens.paren_left)){if(i.value=this._consume(Ce.literal_or_ident,"Expected attribute value").toString(),this._check(Ce.tokens.comma)){this._advance();do{let n=this._consume(Ce.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(Ce.tokens.comma))}this._consume(Ce.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}},X2=class extends _p{constructor(e){super(),e&&this.update(e)}update(e){let t=new LS().parse(e);this.updateAST(t)}};function DS(r){let e={attributes:[],bindings:[]},t;try{t=FY(r)}catch(s){return Vt.error(s.message)(),e}for(let s of t.uniforms){let a=[];for(let c of s.type?.members||[])a.push({name:c.name,type:BL(c.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:a})}for(let s of t.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(let s of t.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});let i=t.entry.vertex[0],n=i?.inputs.length||0;for(let s=0;s<n;s++){let a=i.inputs[s];if(a.locationType==="location"){let c=BL(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:c})}}return e}function BL(r){return r.format?`${r.name}<${r.format.name}>`:r.name}function FY(r){try{return new X2(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}var NY=1/Math.PI*180,zY=1/180*Math.PI,UY={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...UY}};var In=globalThis.mathgl.config;function kS(r,{precision:e=In.precision}={}){return r=VY(r),`${parseFloat(r.toPrecision(e))}`}function ja(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function FS(r){return LL(r)}function NS(r){return Ga(r)}function LL(r,e){return zS(r,t=>t*zY,e)}function Ga(r,e){return zS(r,t=>t*NY,e)}function ao(r,e,t){return zS(r,i=>Math.max(e,Math.min(t,i)))}function wo(r,e,t){return ja(r)?r.map((i,n)=>wo(i,e[n],t)):t*e+(1-t)*r}function Bs(r,e,t){let i=In.EPSILON;t&&(In.EPSILON=t);try{if(r===e)return!0;if(ja(r)&&ja(e)){if(r.length!==e.length)return!1;for(let n=0;n<r.length;++n)if(!Bs(r[n],e[n]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=In.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{In.EPSILON=i}}function VY(r){return Math.round(r/In.EPSILON)*In.EPSILON}function jY(r){return r.clone?r.clone():new Array(r.length)}function zS(r,e,t){if(ja(r)){let i=r;t=t||jY(i);for(let n=0;n<t.length&&n<i.length;++n){let s=typeof r=="number"?r:r[n];t[n]=e(s,n,t)}return t}return e(r)}var zf=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ja(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(In)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+kS(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Bs(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){let s=e[n],a=typeof t=="number"?t:t[n];this[n]=s+i*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(In.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}};function GY(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function Li(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function Uf(r,e,t=""){if(In.debug&&!GY(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function lo(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}var Vf=class extends zf{get x(){return this[0]}set x(e){this[0]=Li(e)}get y(){return this[1]}set y(e){this[1]=Li(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){let n=this[i]-e[i];t+=n*n}return Li(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return Li(t)}normalize(){let e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(let t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return lo(e>=0&&e<this.ELEMENTS,"index is out of range"),Li(this[e])}setComponent(e,t){return lo(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};var cu={};Ms(cu,{add:()=>ZY,angle:()=>uK,ceil:()=>XY,clone:()=>HY,copy:()=>$Y,create:()=>OL,cross:()=>oK,dist:()=>yK,distance:()=>NL,div:()=>_K,divide:()=>FL,dot:()=>sK,equals:()=>pK,exactEquals:()=>dK,floor:()=>YY,forEach:()=>vK,fromValues:()=>WY,inverse:()=>iK,len:()=>AK,length:()=>UL,lerp:()=>aK,max:()=>QY,min:()=>KY,mul:()=>gK,multiply:()=>kL,negate:()=>rK,normalize:()=>nK,random:()=>lK,rotate:()=>cK,round:()=>JY,scale:()=>eK,scaleAndAdd:()=>tK,set:()=>qY,sqrDist:()=>xK,sqrLen:()=>bK,squaredDistance:()=>zL,squaredLength:()=>VL,str:()=>fK,sub:()=>mK,subtract:()=>DL,transformMat2:()=>US,transformMat2d:()=>VS,transformMat3:()=>g_,transformMat4:()=>__,zero:()=>hK});var vn=typeof Float32Array<"u"?Float32Array:Array,lu=Math.random;function Al(r){return r>=0?Math.round(r):r%.5===0?Math.floor(r):Math.round(r)}var Pve=Math.PI/180;function OL(){let r=new vn(2);return vn!=Float32Array&&(r[0]=0,r[1]=0),r}function HY(r){let e=new vn(2);return e[0]=r[0],e[1]=r[1],e}function WY(r,e){let t=new vn(2);return t[0]=r,t[1]=e,t}function $Y(r,e){return r[0]=e[0],r[1]=e[1],r}function qY(r,e,t){return r[0]=e,r[1]=t,r}function ZY(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function DL(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r}function kL(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r}function FL(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r}function XY(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r}function YY(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r}function KY(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r}function QY(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r}function JY(r,e){return r[0]=Al(e[0]),r[1]=Al(e[1]),r}function eK(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r}function tK(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r}function NL(r,e){let t=e[0]-r[0],i=e[1]-r[1];return Math.sqrt(t*t+i*i)}function zL(r,e){let t=e[0]-r[0],i=e[1]-r[1];return t*t+i*i}function UL(r){let e=r[0],t=r[1];return Math.sqrt(e*e+t*t)}function VL(r){let e=r[0],t=r[1];return e*e+t*t}function rK(r,e){return r[0]=-e[0],r[1]=-e[1],r}function iK(r,e){return r[0]=1/e[0],r[1]=1/e[1],r}function nK(r,e){let t=e[0],i=e[1],n=t*t+i*i;return n>0&&(n=1/Math.sqrt(n)),r[0]=e[0]*n,r[1]=e[1]*n,r}function sK(r,e){return r[0]*e[0]+r[1]*e[1]}function oK(r,e,t){let i=e[0]*t[1]-e[1]*t[0];return r[0]=r[1]=0,r[2]=i,r}function aK(r,e,t,i){let n=e[0],s=e[1];return r[0]=n+i*(t[0]-n),r[1]=s+i*(t[1]-s),r}function lK(r,e){e=e===void 0?1:e;let t=lu()*2*Math.PI;return r[0]=Math.cos(t)*e,r[1]=Math.sin(t)*e,r}function US(r,e,t){let i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r}function VS(r,e,t){let i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n+t[4],r[1]=t[1]*i+t[3]*n+t[5],r}function g_(r,e,t){let i=e[0],n=e[1];return r[0]=t[0]*i+t[3]*n+t[6],r[1]=t[1]*i+t[4]*n+t[7],r}function __(r,e,t){let i=e[0],n=e[1];return r[0]=t[0]*i+t[4]*n+t[12],r[1]=t[1]*i+t[5]*n+t[13],r}function cK(r,e,t,i){let n=e[0]-t[0],s=e[1]-t[1],a=Math.sin(i),c=Math.cos(i);return r[0]=n*c-s*a+t[0],r[1]=n*a+s*c+t[1],r}function uK(r,e){let t=r[0],i=r[1],n=e[0],s=e[1],a=Math.sqrt((t*t+i*i)*(n*n+s*s)),c=a&&(t*n+i*s)/a;return Math.acos(Math.min(Math.max(c,-1),1))}function hK(r){return r[0]=0,r[1]=0,r}function fK(r){return`vec2(${r[0]}, ${r[1]})`}function dK(r,e){return r[0]===e[0]&&r[1]===e[1]}function pK(r,e){let t=r[0],i=r[1],n=e[0],s=e[1];return Math.abs(t-n)<=1e-6*Math.max(1,Math.abs(t),Math.abs(n))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))}var AK=UL,mK=DL,gK=kL,_K=FL,yK=NL,xK=zL,bK=VL,vK=function(){let r=OL();return function(e,t,i,n,s,a){let c,d;for(t||(t=2),i||(i=0),n?d=Math.min(n*t+i,e.length):d=e.length,c=i;c<d;c+=t)r[0]=e[c],r[1]=e[c+1],s(r,r,a),e[c]=r[0],e[c+1]=r[1];return e}}();function Y2(r,e,t){let i=e[0],n=e[1],s=t[3]*i+t[7]*n||1;return r[0]=(t[0]*i+t[4]*n)/s,r[1]=(t[1]*i+t[5]*n)/s,r}function K2(r,e,t){let i=e[0],n=e[1],s=e[2],a=t[3]*i+t[7]*n+t[11]*s||1;return r[0]=(t[0]*i+t[4]*n+t[8]*s)/a,r[1]=(t[1]*i+t[5]*n+t[9]*s)/a,r[2]=(t[2]*i+t[6]*n+t[10]*s)/a,r}function jL(r,e,t){let i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r[2]=e[2],r}function HL(r,e,t){let i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r[2]=e[2],r[3]=e[3],r}function Q2(r,e,t){let i=e[0],n=e[1],s=e[2];return r[0]=t[0]*i+t[3]*n+t[6]*s,r[1]=t[1]*i+t[4]*n+t[7]*s,r[2]=t[2]*i+t[5]*n+t[8]*s,r[3]=e[3],r}var xp=class extends Vf{constructor(e=0,t=0){super(2),ja(e)&&arguments.length===1?this.copy(e):(In.debug&&(Li(e),Li(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return In.debug&&(Li(e.x),Li(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return __(this,this,e),this.check()}transformAsVector(e){return Y2(this,this,e),this.check()}transformByMatrix3(e){return g_(this,this,e),this.check()}transformByMatrix2x3(e){return VS(this,this,e),this.check()}transformByMatrix2(e){return US(this,this,e),this.check()}};var To={};Ms(To,{add:()=>SK,angle:()=>$S,bezier:()=>zK,ceil:()=>CK,clone:()=>wK,copy:()=>TK,create:()=>J2,cross:()=>bp,dist:()=>ZK,distance:()=>XL,div:()=>qK,divide:()=>ZL,dot:()=>y_,equals:()=>HK,exactEquals:()=>GK,floor:()=>IK,forEach:()=>KK,fromValues:()=>eb,hermite:()=>NK,inverse:()=>DK,len:()=>qS,length:()=>WL,lerp:()=>kK,max:()=>MK,min:()=>PK,mul:()=>$K,multiply:()=>qL,negate:()=>OK,normalize:()=>jS,random:()=>UK,rotateX:()=>GS,rotateY:()=>HS,rotateZ:()=>WS,round:()=>RK,scale:()=>BK,scaleAndAdd:()=>LK,set:()=>EK,slerp:()=>FK,sqrDist:()=>XK,sqrLen:()=>YK,squaredDistance:()=>YL,squaredLength:()=>KL,str:()=>jK,sub:()=>WK,subtract:()=>$L,transformMat3:()=>x_,transformMat4:()=>vp,transformQuat:()=>b_,zero:()=>VK});function J2(){let r=new vn(3);return vn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function wK(r){let e=new vn(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function WL(r){let e=r[0],t=r[1],i=r[2];return Math.sqrt(e*e+t*t+i*i)}function eb(r,e,t){let i=new vn(3);return i[0]=r,i[1]=e,i[2]=t,i}function TK(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function EK(r,e,t,i){return r[0]=e,r[1]=t,r[2]=i,r}function SK(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function $L(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function qL(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function ZL(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r}function CK(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r}function IK(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r}function PK(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function MK(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function RK(r,e){return r[0]=Al(e[0]),r[1]=Al(e[1]),r[2]=Al(e[2]),r}function BK(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function LK(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r}function XL(r,e){let t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2];return Math.sqrt(t*t+i*i+n*n)}function YL(r,e){let t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2];return t*t+i*i+n*n}function KL(r){let e=r[0],t=r[1],i=r[2];return e*e+t*t+i*i}function OK(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function DK(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function jS(r,e){let t=e[0],i=e[1],n=e[2],s=t*t+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function y_(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function bp(r,e,t){let i=e[0],n=e[1],s=e[2],a=t[0],c=t[1],d=t[2];return r[0]=n*d-s*c,r[1]=s*a-i*d,r[2]=i*c-n*a,r}function kK(r,e,t,i){let n=e[0],s=e[1],a=e[2];return r[0]=n+i*(t[0]-n),r[1]=s+i*(t[1]-s),r[2]=a+i*(t[2]-a),r}function FK(r,e,t,i){let n=Math.acos(Math.min(Math.max(y_(e,t),-1),1)),s=Math.sin(n),a=Math.sin((1-i)*n)/s,c=Math.sin(i*n)/s;return r[0]=a*e[0]+c*t[0],r[1]=a*e[1]+c*t[1],r[2]=a*e[2]+c*t[2],r}function NK(r,e,t,i,n,s){let a=s*s,c=a*(2*s-3)+1,d=a*(s-2)+s,p=a*(s-1),b=a*(3-2*s);return r[0]=e[0]*c+t[0]*d+i[0]*p+n[0]*b,r[1]=e[1]*c+t[1]*d+i[1]*p+n[1]*b,r[2]=e[2]*c+t[2]*d+i[2]*p+n[2]*b,r}function zK(r,e,t,i,n,s){let a=1-s,c=a*a,d=s*s,p=c*a,b=3*s*c,T=3*d*a,B=d*s;return r[0]=e[0]*p+t[0]*b+i[0]*T+n[0]*B,r[1]=e[1]*p+t[1]*b+i[1]*T+n[1]*B,r[2]=e[2]*p+t[2]*b+i[2]*T+n[2]*B,r}function UK(r,e){e=e===void 0?1:e;let t=lu()*2*Math.PI,i=lu()*2-1,n=Math.sqrt(1-i*i)*e;return r[0]=Math.cos(t)*n,r[1]=Math.sin(t)*n,r[2]=i*e,r}function vp(r,e,t){let i=e[0],n=e[1],s=e[2],a=t[3]*i+t[7]*n+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*i+t[4]*n+t[8]*s+t[12])/a,r[1]=(t[1]*i+t[5]*n+t[9]*s+t[13])/a,r[2]=(t[2]*i+t[6]*n+t[10]*s+t[14])/a,r}function x_(r,e,t){let i=e[0],n=e[1],s=e[2];return r[0]=i*t[0]+n*t[3]+s*t[6],r[1]=i*t[1]+n*t[4]+s*t[7],r[2]=i*t[2]+n*t[5]+s*t[8],r}function b_(r,e,t){let i=t[0],n=t[1],s=t[2],a=t[3],c=e[0],d=e[1],p=e[2],b=n*p-s*d,T=s*c-i*p,B=i*d-n*c,z=n*B-s*T,G=s*b-i*B,Z=i*T-n*b,q=a*2;return b*=q,T*=q,B*=q,z*=2,G*=2,Z*=2,r[0]=c+b+z,r[1]=d+T+G,r[2]=p+B+Z,r}function GS(r,e,t,i){let n=[],s=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function HS(r,e,t,i){let n=[],s=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function WS(r,e,t,i){let n=[],s=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function $S(r,e){let t=r[0],i=r[1],n=r[2],s=e[0],a=e[1],c=e[2],d=Math.sqrt((t*t+i*i+n*n)*(s*s+a*a+c*c)),p=d&&y_(r,e)/d;return Math.acos(Math.min(Math.max(p,-1),1))}function VK(r){return r[0]=0,r[1]=0,r[2]=0,r}function jK(r){return`vec3(${r[0]}, ${r[1]}, ${r[2]})`}function GK(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function HK(r,e){let t=r[0],i=r[1],n=r[2],s=e[0],a=e[1],c=e[2];return Math.abs(t-s)<=1e-6*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-c)<=1e-6*Math.max(1,Math.abs(n),Math.abs(c))}var WK=$L,$K=qL,qK=ZL,ZK=XL,XK=YL,qS=WL,YK=KL,KK=function(){let r=J2();return function(e,t,i,n,s,a){let c,d;for(t||(t=3),i||(i=0),n?d=Math.min(n*t+i,e.length):d=e.length,c=i;c<d;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],s(r,r,a),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2];return e}}();var ZS=[0,0,0],tb,st=class r extends Vf{static get ZERO(){return tb||(tb=new r(0,0,0),Object.freeze(tb)),tb}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&ja(e)?this.copy(e):(In.debug&&(Li(e),Li(t),Li(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return In.debug&&(Li(e.x),Li(e.y),Li(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Li(e)}angle(e){return $S(this,e)}cross(e){return bp(this,this,e),this.check()}rotateX({radians:e,origin:t=ZS}){return GS(this,this,t,e),this.check()}rotateY({radians:e,origin:t=ZS}){return HS(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=ZS}){return WS(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return vp(this,this,e),this.check()}transformAsVector(e){return K2(this,this,e),this.check()}transformByMatrix3(e){return x_(this,this,e),this.check()}transformByMatrix2(e){return jL(this,this,e),this.check()}transformByQuaternion(e){return b_(this,this,e),this.check()}};var rb,ib=class r extends Vf{static get ZERO(){return rb||(rb=new r(0,0,0,0),Object.freeze(rb)),rb}constructor(e=0,t=0,i=0,n=0){super(-0,-0,-0,-0),ja(e)&&arguments.length===1?this.copy(e):(In.debug&&(Li(e),Li(t),Li(i),Li(n)),this[0]=e,this[1]=t,this[2]=i,this[3]=n)}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return In.debug&&(Li(e.x),Li(e.y),Li(e.z),Li(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Li(e)}get w(){return this[3]}set w(e){this[3]=Li(e)}transform(e){return vp(this,this,e),this.check()}transformByMatrix3(e){return Q2(this,this,e),this.check()}transformByMatrix2(e){return HL(this,this,e),this.check()}transformByQuaternion(e){return b_(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}};var g0=class extends zf{toString(){let e="[";if(In.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=Li(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[i+n];return t}setColumn(e,t){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=t[n];return this}};function QL(){let r=new vn(9);return vn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function JL(r,e){if(r===e){let t=e[1],i=e[2],n=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=i,r[7]=n}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function e8(r,e){let t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],c=e[5],d=e[6],p=e[7],b=e[8],T=b*a-c*p,B=-b*s+c*d,z=p*s-a*d,G=t*T+i*B+n*z;return G?(G=1/G,r[0]=T*G,r[1]=(-b*i+n*p)*G,r[2]=(c*i-n*a)*G,r[3]=B*G,r[4]=(b*t-n*d)*G,r[5]=(-c*t+n*s)*G,r[6]=z*G,r[7]=(-p*t+i*d)*G,r[8]=(a*t-i*s)*G,r):null}function t8(r){let e=r[0],t=r[1],i=r[2],n=r[3],s=r[4],a=r[5],c=r[6],d=r[7],p=r[8];return e*(p*s-a*d)+t*(-p*n+a*c)+i*(d*n-s*c)}function XS(r,e,t){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],d=e[5],p=e[6],b=e[7],T=e[8],B=t[0],z=t[1],G=t[2],Z=t[3],q=t[4],re=t[5],ee=t[6],ae=t[7],me=t[8];return r[0]=B*i+z*a+G*p,r[1]=B*n+z*c+G*b,r[2]=B*s+z*d+G*T,r[3]=Z*i+q*a+re*p,r[4]=Z*n+q*c+re*b,r[5]=Z*s+q*d+re*T,r[6]=ee*i+ae*a+me*p,r[7]=ee*n+ae*c+me*b,r[8]=ee*s+ae*d+me*T,r}function r8(r,e,t){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],d=e[5],p=e[6],b=e[7],T=e[8],B=t[0],z=t[1];return r[0]=i,r[1]=n,r[2]=s,r[3]=a,r[4]=c,r[5]=d,r[6]=B*i+z*a+p,r[7]=B*n+z*c+b,r[8]=B*s+z*d+T,r}function i8(r,e,t){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],d=e[5],p=e[6],b=e[7],T=e[8],B=Math.sin(t),z=Math.cos(t);return r[0]=z*i+B*a,r[1]=z*n+B*c,r[2]=z*s+B*d,r[3]=z*a-B*i,r[4]=z*c-B*n,r[5]=z*d-B*s,r[6]=p,r[7]=b,r[8]=T,r}function YS(r,e,t){let i=t[0],n=t[1];return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=n*e[3],r[4]=n*e[4],r[5]=n*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function n8(r,e){let t=e[0],i=e[1],n=e[2],s=e[3],a=t+t,c=i+i,d=n+n,p=t*a,b=i*a,T=i*c,B=n*a,z=n*c,G=n*d,Z=s*a,q=s*c,re=s*d;return r[0]=1-T-G,r[3]=b-re,r[6]=B+q,r[1]=b+re,r[4]=1-p-G,r[7]=z-Z,r[2]=B-q,r[5]=z+Z,r[8]=1-p-T,r}var KS;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(KS||(KS={}));var QK=Object.freeze([1,0,0,0,1,0,0,0,1]),nn=class extends g0{static get IDENTITY(){return eQ()}static get ZERO(){return JK()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return KS}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(QK)}fromObject(e){return this.check()}fromQuaternion(e){return n8(this,e),this.check()}set(e,t,i,n,s,a,c,d,p){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=c,this[7]=d,this[8]=p,this.check()}setRowMajor(e,t,i,n,s,a,c,d,p){return this[0]=e,this[1]=n,this[2]=c,this[3]=t,this[4]=s,this[5]=d,this[6]=i,this[7]=a,this[8]=p,this.check()}determinant(){return t8(this)}transpose(){return JL(this,this),this.check()}invert(){return e8(this,this),this.check()}multiplyLeft(e){return XS(this,e,this),this.check()}multiplyRight(e){return XS(this,this,e),this.check()}rotate(e){return i8(this,this,e),this.check()}scale(e){return Array.isArray(e)?YS(this,this,e):YS(this,this,[e,e]),this.check()}translate(e){return r8(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=g_(t||[-0,-0],e,this);break;case 3:i=x_(t||[-0,-0,-0],e,this);break;case 4:i=Q2(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Uf(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}},nb,sb=null;function JK(){return nb||(nb=new nn([0,0,0,0,0,0,0,0,0]),Object.freeze(nb)),nb}function eQ(){return sb||(sb=new nn,Object.freeze(sb)),sb}var ms={};Ms(ms,{add:()=>EQ,adjoint:()=>oQ,clone:()=>rQ,copy:()=>iQ,create:()=>tQ,decompose:()=>mQ,determinant:()=>eC,equals:()=>PQ,exactEquals:()=>IQ,frob:()=>TQ,fromQuat:()=>aC,fromQuat2:()=>dQ,fromRotation:()=>cQ,fromRotationTranslation:()=>a8,fromRotationTranslationScale:()=>gQ,fromRotationTranslationScaleOrigin:()=>_Q,fromScaling:()=>lQ,fromTranslation:()=>aQ,fromValues:()=>nQ,fromXRotation:()=>uQ,fromYRotation:()=>hQ,fromZRotation:()=>fQ,frustum:()=>lC,getRotation:()=>AQ,getScaling:()=>l8,getTranslation:()=>pQ,identity:()=>o8,invert:()=>JS,lookAt:()=>hC,mul:()=>MQ,multiply:()=>v_,multiplyScalar:()=>SQ,multiplyScalarAndAdd:()=>CQ,ortho:()=>uC,orthoNO:()=>u8,orthoZO:()=>bQ,perspective:()=>cC,perspectiveFromFieldOfView:()=>xQ,perspectiveNO:()=>c8,perspectiveZO:()=>yQ,rotate:()=>iC,rotateX:()=>nC,rotateY:()=>sC,rotateZ:()=>oC,scale:()=>rC,set:()=>sQ,str:()=>wQ,sub:()=>RQ,subtract:()=>h8,targetTo:()=>vQ,translate:()=>tC,transpose:()=>QS});function tQ(){let r=new vn(16);return vn!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function rQ(r){let e=new vn(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function iQ(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function nQ(r,e,t,i,n,s,a,c,d,p,b,T,B,z,G,Z){let q=new vn(16);return q[0]=r,q[1]=e,q[2]=t,q[3]=i,q[4]=n,q[5]=s,q[6]=a,q[7]=c,q[8]=d,q[9]=p,q[10]=b,q[11]=T,q[12]=B,q[13]=z,q[14]=G,q[15]=Z,q}function sQ(r,e,t,i,n,s,a,c,d,p,b,T,B,z,G,Z,q){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r[4]=s,r[5]=a,r[6]=c,r[7]=d,r[8]=p,r[9]=b,r[10]=T,r[11]=B,r[12]=z,r[13]=G,r[14]=Z,r[15]=q,r}function o8(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function QS(r,e){if(r===e){let t=e[1],i=e[2],n=e[3],s=e[6],a=e[7],c=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=i,r[9]=s,r[11]=e[14],r[12]=n,r[13]=a,r[14]=c}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function JS(r,e){let t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],c=e[5],d=e[6],p=e[7],b=e[8],T=e[9],B=e[10],z=e[11],G=e[12],Z=e[13],q=e[14],re=e[15],ee=t*c-i*a,ae=t*d-n*a,me=t*p-s*a,Le=i*d-n*c,je=i*p-s*c,Je=n*p-s*d,J=b*Z-T*G,te=b*q-B*G,X=b*re-z*G,ye=T*q-B*Z,_e=T*re-z*Z,Oe=B*re-z*q,ve=ee*Oe-ae*_e+me*ye+Le*X-je*te+Je*J;return ve?(ve=1/ve,r[0]=(c*Oe-d*_e+p*ye)*ve,r[1]=(n*_e-i*Oe-s*ye)*ve,r[2]=(Z*Je-q*je+re*Le)*ve,r[3]=(B*je-T*Je-z*Le)*ve,r[4]=(d*X-a*Oe-p*te)*ve,r[5]=(t*Oe-n*X+s*te)*ve,r[6]=(q*me-G*Je-re*ae)*ve,r[7]=(b*Je-B*me+z*ae)*ve,r[8]=(a*_e-c*X+p*J)*ve,r[9]=(i*X-t*_e-s*J)*ve,r[10]=(G*je-Z*me+re*ee)*ve,r[11]=(T*me-b*je-z*ee)*ve,r[12]=(c*te-a*ye-d*J)*ve,r[13]=(t*ye-i*te+n*J)*ve,r[14]=(Z*ae-G*Le-q*ee)*ve,r[15]=(b*Le-T*ae+B*ee)*ve,r):null}function oQ(r,e){let t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],c=e[5],d=e[6],p=e[7],b=e[8],T=e[9],B=e[10],z=e[11],G=e[12],Z=e[13],q=e[14],re=e[15],ee=t*c-i*a,ae=t*d-n*a,me=t*p-s*a,Le=i*d-n*c,je=i*p-s*c,Je=n*p-s*d,J=b*Z-T*G,te=b*q-B*G,X=b*re-z*G,ye=T*q-B*Z,_e=T*re-z*Z,Oe=B*re-z*q;return r[0]=c*Oe-d*_e+p*ye,r[1]=n*_e-i*Oe-s*ye,r[2]=Z*Je-q*je+re*Le,r[3]=B*je-T*Je-z*Le,r[4]=d*X-a*Oe-p*te,r[5]=t*Oe-n*X+s*te,r[6]=q*me-G*Je-re*ae,r[7]=b*Je-B*me+z*ae,r[8]=a*_e-c*X+p*J,r[9]=i*X-t*_e-s*J,r[10]=G*je-Z*me+re*ee,r[11]=T*me-b*je-z*ee,r[12]=c*te-a*ye-d*J,r[13]=t*ye-i*te+n*J,r[14]=Z*ae-G*Le-q*ee,r[15]=b*Le-T*ae+B*ee,r}function eC(r){let e=r[0],t=r[1],i=r[2],n=r[3],s=r[4],a=r[5],c=r[6],d=r[7],p=r[8],b=r[9],T=r[10],B=r[11],z=r[12],G=r[13],Z=r[14],q=r[15],re=e*a-t*s,ee=e*c-i*s,ae=t*c-i*a,me=p*G-b*z,Le=p*Z-T*z,je=b*Z-T*G,Je=e*je-t*Le+i*me,J=s*je-a*Le+c*me,te=p*ae-b*ee+T*re,X=z*ae-G*ee+Z*re;return d*Je-n*J+q*te-B*X}function v_(r,e,t){let i=e[0],n=e[1],s=e[2],a=e[3],c=e[4],d=e[5],p=e[6],b=e[7],T=e[8],B=e[9],z=e[10],G=e[11],Z=e[12],q=e[13],re=e[14],ee=e[15],ae=t[0],me=t[1],Le=t[2],je=t[3];return r[0]=ae*i+me*c+Le*T+je*Z,r[1]=ae*n+me*d+Le*B+je*q,r[2]=ae*s+me*p+Le*z+je*re,r[3]=ae*a+me*b+Le*G+je*ee,ae=t[4],me=t[5],Le=t[6],je=t[7],r[4]=ae*i+me*c+Le*T+je*Z,r[5]=ae*n+me*d+Le*B+je*q,r[6]=ae*s+me*p+Le*z+je*re,r[7]=ae*a+me*b+Le*G+je*ee,ae=t[8],me=t[9],Le=t[10],je=t[11],r[8]=ae*i+me*c+Le*T+je*Z,r[9]=ae*n+me*d+Le*B+je*q,r[10]=ae*s+me*p+Le*z+je*re,r[11]=ae*a+me*b+Le*G+je*ee,ae=t[12],me=t[13],Le=t[14],je=t[15],r[12]=ae*i+me*c+Le*T+je*Z,r[13]=ae*n+me*d+Le*B+je*q,r[14]=ae*s+me*p+Le*z+je*re,r[15]=ae*a+me*b+Le*G+je*ee,r}function tC(r,e,t){let i=t[0],n=t[1],s=t[2],a,c,d,p,b,T,B,z,G,Z,q,re;return e===r?(r[12]=e[0]*i+e[4]*n+e[8]*s+e[12],r[13]=e[1]*i+e[5]*n+e[9]*s+e[13],r[14]=e[2]*i+e[6]*n+e[10]*s+e[14],r[15]=e[3]*i+e[7]*n+e[11]*s+e[15]):(a=e[0],c=e[1],d=e[2],p=e[3],b=e[4],T=e[5],B=e[6],z=e[7],G=e[8],Z=e[9],q=e[10],re=e[11],r[0]=a,r[1]=c,r[2]=d,r[3]=p,r[4]=b,r[5]=T,r[6]=B,r[7]=z,r[8]=G,r[9]=Z,r[10]=q,r[11]=re,r[12]=a*i+b*n+G*s+e[12],r[13]=c*i+T*n+Z*s+e[13],r[14]=d*i+B*n+q*s+e[14],r[15]=p*i+z*n+re*s+e[15]),r}function rC(r,e,t){let i=t[0],n=t[1],s=t[2];return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function iC(r,e,t,i){let n=i[0],s=i[1],a=i[2],c=Math.sqrt(n*n+s*s+a*a),d,p,b,T,B,z,G,Z,q,re,ee,ae,me,Le,je,Je,J,te,X,ye,_e,Oe,ve,De;return c<1e-6?null:(c=1/c,n*=c,s*=c,a*=c,p=Math.sin(t),d=Math.cos(t),b=1-d,T=e[0],B=e[1],z=e[2],G=e[3],Z=e[4],q=e[5],re=e[6],ee=e[7],ae=e[8],me=e[9],Le=e[10],je=e[11],Je=n*n*b+d,J=s*n*b+a*p,te=a*n*b-s*p,X=n*s*b-a*p,ye=s*s*b+d,_e=a*s*b+n*p,Oe=n*a*b+s*p,ve=s*a*b-n*p,De=a*a*b+d,r[0]=T*Je+Z*J+ae*te,r[1]=B*Je+q*J+me*te,r[2]=z*Je+re*J+Le*te,r[3]=G*Je+ee*J+je*te,r[4]=T*X+Z*ye+ae*_e,r[5]=B*X+q*ye+me*_e,r[6]=z*X+re*ye+Le*_e,r[7]=G*X+ee*ye+je*_e,r[8]=T*Oe+Z*ve+ae*De,r[9]=B*Oe+q*ve+me*De,r[10]=z*Oe+re*ve+Le*De,r[11]=G*Oe+ee*ve+je*De,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function nC(r,e,t){let i=Math.sin(t),n=Math.cos(t),s=e[4],a=e[5],c=e[6],d=e[7],p=e[8],b=e[9],T=e[10],B=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*n+p*i,r[5]=a*n+b*i,r[6]=c*n+T*i,r[7]=d*n+B*i,r[8]=p*n-s*i,r[9]=b*n-a*i,r[10]=T*n-c*i,r[11]=B*n-d*i,r}function sC(r,e,t){let i=Math.sin(t),n=Math.cos(t),s=e[0],a=e[1],c=e[2],d=e[3],p=e[8],b=e[9],T=e[10],B=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*n-p*i,r[1]=a*n-b*i,r[2]=c*n-T*i,r[3]=d*n-B*i,r[8]=s*i+p*n,r[9]=a*i+b*n,r[10]=c*i+T*n,r[11]=d*i+B*n,r}function oC(r,e,t){let i=Math.sin(t),n=Math.cos(t),s=e[0],a=e[1],c=e[2],d=e[3],p=e[4],b=e[5],T=e[6],B=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*n+p*i,r[1]=a*n+b*i,r[2]=c*n+T*i,r[3]=d*n+B*i,r[4]=p*n-s*i,r[5]=b*n-a*i,r[6]=T*n-c*i,r[7]=B*n-d*i,r}function aQ(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function lQ(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function cQ(r,e,t){let i=t[0],n=t[1],s=t[2],a=Math.sqrt(i*i+n*n+s*s),c,d,p;return a<1e-6?null:(a=1/a,i*=a,n*=a,s*=a,d=Math.sin(e),c=Math.cos(e),p=1-c,r[0]=i*i*p+c,r[1]=n*i*p+s*d,r[2]=s*i*p-n*d,r[3]=0,r[4]=i*n*p-s*d,r[5]=n*n*p+c,r[6]=s*n*p+i*d,r[7]=0,r[8]=i*s*p+n*d,r[9]=n*s*p-i*d,r[10]=s*s*p+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function uQ(r,e){let t=Math.sin(e),i=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=t,r[7]=0,r[8]=0,r[9]=-t,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function hQ(r,e){let t=Math.sin(e),i=Math.cos(e);return r[0]=i,r[1]=0,r[2]=-t,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=t,r[9]=0,r[10]=i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function fQ(r,e){let t=Math.sin(e),i=Math.cos(e);return r[0]=i,r[1]=t,r[2]=0,r[3]=0,r[4]=-t,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function a8(r,e,t){let i=e[0],n=e[1],s=e[2],a=e[3],c=i+i,d=n+n,p=s+s,b=i*c,T=i*d,B=i*p,z=n*d,G=n*p,Z=s*p,q=a*c,re=a*d,ee=a*p;return r[0]=1-(z+Z),r[1]=T+ee,r[2]=B-re,r[3]=0,r[4]=T-ee,r[5]=1-(b+Z),r[6]=G+q,r[7]=0,r[8]=B+re,r[9]=G-q,r[10]=1-(b+z),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function dQ(r,e){let t=new vn(3),i=-e[0],n=-e[1],s=-e[2],a=e[3],c=e[4],d=e[5],p=e[6],b=e[7],T=i*i+n*n+s*s+a*a;return T>0?(t[0]=(c*a+b*i+d*s-p*n)*2/T,t[1]=(d*a+b*n+p*i-c*s)*2/T,t[2]=(p*a+b*s+c*n-d*i)*2/T):(t[0]=(c*a+b*i+d*s-p*n)*2,t[1]=(d*a+b*n+p*i-c*s)*2,t[2]=(p*a+b*s+c*n-d*i)*2),a8(r,e,t),r}function pQ(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function l8(r,e){let t=e[0],i=e[1],n=e[2],s=e[4],a=e[5],c=e[6],d=e[8],p=e[9],b=e[10];return r[0]=Math.sqrt(t*t+i*i+n*n),r[1]=Math.sqrt(s*s+a*a+c*c),r[2]=Math.sqrt(d*d+p*p+b*b),r}function AQ(r,e){let t=new vn(3);l8(t,e);let i=1/t[0],n=1/t[1],s=1/t[2],a=e[0]*i,c=e[1]*n,d=e[2]*s,p=e[4]*i,b=e[5]*n,T=e[6]*s,B=e[8]*i,z=e[9]*n,G=e[10]*s,Z=a+b+G,q=0;return Z>0?(q=Math.sqrt(Z+1)*2,r[3]=.25*q,r[0]=(T-z)/q,r[1]=(B-d)/q,r[2]=(c-p)/q):a>b&&a>G?(q=Math.sqrt(1+a-b-G)*2,r[3]=(T-z)/q,r[0]=.25*q,r[1]=(c+p)/q,r[2]=(B+d)/q):b>G?(q=Math.sqrt(1+b-a-G)*2,r[3]=(B-d)/q,r[0]=(c+p)/q,r[1]=.25*q,r[2]=(T+z)/q):(q=Math.sqrt(1+G-a-b)*2,r[3]=(c-p)/q,r[0]=(B+d)/q,r[1]=(T+z)/q,r[2]=.25*q),r}function mQ(r,e,t,i){e[0]=i[12],e[1]=i[13],e[2]=i[14];let n=i[0],s=i[1],a=i[2],c=i[4],d=i[5],p=i[6],b=i[8],T=i[9],B=i[10];t[0]=Math.sqrt(n*n+s*s+a*a),t[1]=Math.sqrt(c*c+d*d+p*p),t[2]=Math.sqrt(b*b+T*T+B*B);let z=1/t[0],G=1/t[1],Z=1/t[2],q=n*z,re=s*G,ee=a*Z,ae=c*z,me=d*G,Le=p*Z,je=b*z,Je=T*G,J=B*Z,te=q+me+J,X=0;return te>0?(X=Math.sqrt(te+1)*2,r[3]=.25*X,r[0]=(Le-Je)/X,r[1]=(je-ee)/X,r[2]=(re-ae)/X):q>me&&q>J?(X=Math.sqrt(1+q-me-J)*2,r[3]=(Le-Je)/X,r[0]=.25*X,r[1]=(re+ae)/X,r[2]=(je+ee)/X):me>J?(X=Math.sqrt(1+me-q-J)*2,r[3]=(je-ee)/X,r[0]=(re+ae)/X,r[1]=.25*X,r[2]=(Le+Je)/X):(X=Math.sqrt(1+J-q-me)*2,r[3]=(re-ae)/X,r[0]=(je+ee)/X,r[1]=(Le+Je)/X,r[2]=.25*X),r}function gQ(r,e,t,i){let n=e[0],s=e[1],a=e[2],c=e[3],d=n+n,p=s+s,b=a+a,T=n*d,B=n*p,z=n*b,G=s*p,Z=s*b,q=a*b,re=c*d,ee=c*p,ae=c*b,me=i[0],Le=i[1],je=i[2];return r[0]=(1-(G+q))*me,r[1]=(B+ae)*me,r[2]=(z-ee)*me,r[3]=0,r[4]=(B-ae)*Le,r[5]=(1-(T+q))*Le,r[6]=(Z+re)*Le,r[7]=0,r[8]=(z+ee)*je,r[9]=(Z-re)*je,r[10]=(1-(T+G))*je,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function _Q(r,e,t,i,n){let s=e[0],a=e[1],c=e[2],d=e[3],p=s+s,b=a+a,T=c+c,B=s*p,z=s*b,G=s*T,Z=a*b,q=a*T,re=c*T,ee=d*p,ae=d*b,me=d*T,Le=i[0],je=i[1],Je=i[2],J=n[0],te=n[1],X=n[2],ye=(1-(Z+re))*Le,_e=(z+me)*Le,Oe=(G-ae)*Le,ve=(z-me)*je,De=(1-(B+re))*je,Xe=(q+ee)*je,rt=(G+ae)*Je,tt=(q-ee)*Je,yt=(1-(B+Z))*Je;return r[0]=ye,r[1]=_e,r[2]=Oe,r[3]=0,r[4]=ve,r[5]=De,r[6]=Xe,r[7]=0,r[8]=rt,r[9]=tt,r[10]=yt,r[11]=0,r[12]=t[0]+J-(ye*J+ve*te+rt*X),r[13]=t[1]+te-(_e*J+De*te+tt*X),r[14]=t[2]+X-(Oe*J+Xe*te+yt*X),r[15]=1,r}function aC(r,e){let t=e[0],i=e[1],n=e[2],s=e[3],a=t+t,c=i+i,d=n+n,p=t*a,b=i*a,T=i*c,B=n*a,z=n*c,G=n*d,Z=s*a,q=s*c,re=s*d;return r[0]=1-T-G,r[1]=b+re,r[2]=B-q,r[3]=0,r[4]=b-re,r[5]=1-p-G,r[6]=z+Z,r[7]=0,r[8]=B+q,r[9]=z-Z,r[10]=1-p-T,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function lC(r,e,t,i,n,s,a){let c=1/(t-e),d=1/(n-i),p=1/(s-a);return r[0]=s*2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*d,r[6]=0,r[7]=0,r[8]=(t+e)*c,r[9]=(n+i)*d,r[10]=(a+s)*p,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*p,r[15]=0,r}function c8(r,e,t,i,n){let s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0){let a=1/(i-n);r[10]=(n+i)*a,r[14]=2*n*i*a}else r[10]=-1,r[14]=-2*i;return r}var cC=c8;function yQ(r,e,t,i,n){let s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0){let a=1/(i-n);r[10]=n*a,r[14]=n*i*a}else r[10]=-1,r[14]=-i;return r}function xQ(r,e,t,i){let n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),d=2/(a+c),p=2/(n+s);return r[0]=d,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=-((a-c)*d*.5),r[9]=(n-s)*p*.5,r[10]=i/(t-i),r[11]=-1,r[12]=0,r[13]=0,r[14]=i*t/(t-i),r[15]=0,r}function u8(r,e,t,i,n,s,a){let c=1/(e-t),d=1/(i-n),p=1/(s-a);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*p,r[11]=0,r[12]=(e+t)*c,r[13]=(n+i)*d,r[14]=(a+s)*p,r[15]=1,r}var uC=u8;function bQ(r,e,t,i,n,s,a){let c=1/(e-t),d=1/(i-n),p=1/(s-a);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*d,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=p,r[11]=0,r[12]=(e+t)*c,r[13]=(n+i)*d,r[14]=s*p,r[15]=1,r}function hC(r,e,t,i){let n,s,a,c,d,p,b,T,B,z,G=e[0],Z=e[1],q=e[2],re=i[0],ee=i[1],ae=i[2],me=t[0],Le=t[1],je=t[2];return Math.abs(G-me)<1e-6&&Math.abs(Z-Le)<1e-6&&Math.abs(q-je)<1e-6?o8(r):(T=G-me,B=Z-Le,z=q-je,n=1/Math.sqrt(T*T+B*B+z*z),T*=n,B*=n,z*=n,s=ee*z-ae*B,a=ae*T-re*z,c=re*B-ee*T,n=Math.sqrt(s*s+a*a+c*c),n?(n=1/n,s*=n,a*=n,c*=n):(s=0,a=0,c=0),d=B*c-z*a,p=z*s-T*c,b=T*a-B*s,n=Math.sqrt(d*d+p*p+b*b),n?(n=1/n,d*=n,p*=n,b*=n):(d=0,p=0,b=0),r[0]=s,r[1]=d,r[2]=T,r[3]=0,r[4]=a,r[5]=p,r[6]=B,r[7]=0,r[8]=c,r[9]=b,r[10]=z,r[11]=0,r[12]=-(s*G+a*Z+c*q),r[13]=-(d*G+p*Z+b*q),r[14]=-(T*G+B*Z+z*q),r[15]=1,r)}function vQ(r,e,t,i){let n=e[0],s=e[1],a=e[2],c=i[0],d=i[1],p=i[2],b=n-t[0],T=s-t[1],B=a-t[2],z=b*b+T*T+B*B;z>0&&(z=1/Math.sqrt(z),b*=z,T*=z,B*=z);let G=d*B-p*T,Z=p*b-c*B,q=c*T-d*b;return z=G*G+Z*Z+q*q,z>0&&(z=1/Math.sqrt(z),G*=z,Z*=z,q*=z),r[0]=G,r[1]=Z,r[2]=q,r[3]=0,r[4]=T*q-B*Z,r[5]=B*G-b*q,r[6]=b*Z-T*G,r[7]=0,r[8]=b,r[9]=T,r[10]=B,r[11]=0,r[12]=n,r[13]=s,r[14]=a,r[15]=1,r}function wQ(r){return`mat4(${r[0]}, ${r[1]}, ${r[2]}, ${r[3]}, ${r[4]}, ${r[5]}, ${r[6]}, ${r[7]}, ${r[8]}, ${r[9]}, ${r[10]}, ${r[11]}, ${r[12]}, ${r[13]}, ${r[14]}, ${r[15]})`}function TQ(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]+r[3]*r[3]+r[4]*r[4]+r[5]*r[5]+r[6]*r[6]+r[7]*r[7]+r[8]*r[8]+r[9]*r[9]+r[10]*r[10]+r[11]*r[11]+r[12]*r[12]+r[13]*r[13]+r[14]*r[14]+r[15]*r[15])}function EQ(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r}function h8(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r}function SQ(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r}function CQ(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r[3]=e[3]+t[3]*i,r[4]=e[4]+t[4]*i,r[5]=e[5]+t[5]*i,r[6]=e[6]+t[6]*i,r[7]=e[7]+t[7]*i,r[8]=e[8]+t[8]*i,r[9]=e[9]+t[9]*i,r[10]=e[10]+t[10]*i,r[11]=e[11]+t[11]*i,r[12]=e[12]+t[12]*i,r[13]=e[13]+t[13]*i,r[14]=e[14]+t[14]*i,r[15]=e[15]+t[15]*i,r}function IQ(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function PQ(r,e){let t=r[0],i=r[1],n=r[2],s=r[3],a=r[4],c=r[5],d=r[6],p=r[7],b=r[8],T=r[9],B=r[10],z=r[11],G=r[12],Z=r[13],q=r[14],re=r[15],ee=e[0],ae=e[1],me=e[2],Le=e[3],je=e[4],Je=e[5],J=e[6],te=e[7],X=e[8],ye=e[9],_e=e[10],Oe=e[11],ve=e[12],De=e[13],Xe=e[14],rt=e[15];return Math.abs(t-ee)<=1e-6*Math.max(1,Math.abs(t),Math.abs(ee))&&Math.abs(i-ae)<=1e-6*Math.max(1,Math.abs(i),Math.abs(ae))&&Math.abs(n-me)<=1e-6*Math.max(1,Math.abs(n),Math.abs(me))&&Math.abs(s-Le)<=1e-6*Math.max(1,Math.abs(s),Math.abs(Le))&&Math.abs(a-je)<=1e-6*Math.max(1,Math.abs(a),Math.abs(je))&&Math.abs(c-Je)<=1e-6*Math.max(1,Math.abs(c),Math.abs(Je))&&Math.abs(d-J)<=1e-6*Math.max(1,Math.abs(d),Math.abs(J))&&Math.abs(p-te)<=1e-6*Math.max(1,Math.abs(p),Math.abs(te))&&Math.abs(b-X)<=1e-6*Math.max(1,Math.abs(b),Math.abs(X))&&Math.abs(T-ye)<=1e-6*Math.max(1,Math.abs(T),Math.abs(ye))&&Math.abs(B-_e)<=1e-6*Math.max(1,Math.abs(B),Math.abs(_e))&&Math.abs(z-Oe)<=1e-6*Math.max(1,Math.abs(z),Math.abs(Oe))&&Math.abs(G-ve)<=1e-6*Math.max(1,Math.abs(G),Math.abs(ve))&&Math.abs(Z-De)<=1e-6*Math.max(1,Math.abs(Z),Math.abs(De))&&Math.abs(q-Xe)<=1e-6*Math.max(1,Math.abs(q),Math.abs(Xe))&&Math.abs(re-rt)<=1e-6*Math.max(1,Math.abs(re),Math.abs(rt))}var MQ=v_,RQ=h8;var Aa={};Ms(Aa,{add:()=>fC,ceil:()=>BQ,clone:()=>d8,copy:()=>A8,create:()=>f8,cross:()=>UQ,dist:()=>ZQ,distance:()=>x8,div:()=>qQ,divide:()=>y8,dot:()=>AC,equals:()=>HQ,exactEquals:()=>v8,floor:()=>LQ,forEach:()=>QQ,fromValues:()=>p8,inverse:()=>zQ,len:()=>YQ,length:()=>ob,lerp:()=>mC,max:()=>DQ,min:()=>OQ,mul:()=>$Q,multiply:()=>_8,negate:()=>NQ,normalize:()=>pC,random:()=>VQ,round:()=>kQ,scale:()=>dC,scaleAndAdd:()=>FQ,set:()=>m8,sqrDist:()=>XQ,sqrLen:()=>KQ,squaredDistance:()=>b8,squaredLength:()=>ab,str:()=>GQ,sub:()=>WQ,subtract:()=>g8,transformMat4:()=>gC,transformQuat:()=>_C,zero:()=>jQ});function f8(){let r=new vn(4);return vn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function d8(r){let e=new vn(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function p8(r,e,t,i){let n=new vn(4);return n[0]=r,n[1]=e,n[2]=t,n[3]=i,n}function A8(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function m8(r,e,t,i,n){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function fC(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function g8(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r}function _8(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r}function y8(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r[3]=e[3]/t[3],r}function BQ(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r[3]=Math.ceil(e[3]),r}function LQ(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r[3]=Math.floor(e[3]),r}function OQ(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.min(e[3],t[3]),r}function DQ(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r}function kQ(r,e){return r[0]=Al(e[0]),r[1]=Al(e[1]),r[2]=Al(e[2]),r[3]=Al(e[3]),r}function dC(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function FQ(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r[2]=e[2]+t[2]*i,r[3]=e[3]+t[3]*i,r}function x8(r,e){let t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2],s=e[3]-r[3];return Math.sqrt(t*t+i*i+n*n+s*s)}function b8(r,e){let t=e[0]-r[0],i=e[1]-r[1],n=e[2]-r[2],s=e[3]-r[3];return t*t+i*i+n*n+s*s}function ob(r){let e=r[0],t=r[1],i=r[2],n=r[3];return Math.sqrt(e*e+t*t+i*i+n*n)}function ab(r){let e=r[0],t=r[1],i=r[2],n=r[3];return e*e+t*t+i*i+n*n}function NQ(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r}function zQ(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r[3]=1/e[3],r}function pC(r,e){let t=e[0],i=e[1],n=e[2],s=e[3],a=t*t+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=i*a,r[2]=n*a,r[3]=s*a,r}function AC(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function UQ(r,e,t,i){let n=t[0]*i[1]-t[1]*i[0],s=t[0]*i[2]-t[2]*i[0],a=t[0]*i[3]-t[3]*i[0],c=t[1]*i[2]-t[2]*i[1],d=t[1]*i[3]-t[3]*i[1],p=t[2]*i[3]-t[3]*i[2],b=e[0],T=e[1],B=e[2],z=e[3];return r[0]=T*p-B*d+z*c,r[1]=-(b*p)+B*a-z*s,r[2]=b*d-T*a+z*n,r[3]=-(b*c)+T*s-B*n,r}function mC(r,e,t,i){let n=e[0],s=e[1],a=e[2],c=e[3];return r[0]=n+i*(t[0]-n),r[1]=s+i*(t[1]-s),r[2]=a+i*(t[2]-a),r[3]=c+i*(t[3]-c),r}function VQ(r,e){e=e===void 0?1:e;let t,i,n,s,a,c;do t=lu()*2-1,i=lu()*2-1,a=t*t+i*i;while(a>=1);do n=lu()*2-1,s=lu()*2-1,c=n*n+s*s;while(c>=1);let d=Math.sqrt((1-a)/c);return r[0]=e*t,r[1]=e*i,r[2]=e*n*d,r[3]=e*s*d,r}function gC(r,e,t){let i=e[0],n=e[1],s=e[2],a=e[3];return r[0]=t[0]*i+t[4]*n+t[8]*s+t[12]*a,r[1]=t[1]*i+t[5]*n+t[9]*s+t[13]*a,r[2]=t[2]*i+t[6]*n+t[10]*s+t[14]*a,r[3]=t[3]*i+t[7]*n+t[11]*s+t[15]*a,r}function _C(r,e,t){let i=e[0],n=e[1],s=e[2],a=t[0],c=t[1],d=t[2],p=t[3],b=p*i+c*s-d*n,T=p*n+d*i-a*s,B=p*s+a*n-c*i,z=-a*i-c*n-d*s;return r[0]=b*p+z*-a+T*-d-B*-c,r[1]=T*p+z*-c+B*-a-b*-d,r[2]=B*p+z*-d+b*-c-T*-a,r[3]=e[3],r}function jQ(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r}function GQ(r){return`vec4(${r[0]}, ${r[1]}, ${r[2]}, ${r[3]})`}function v8(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]}function HQ(r,e){let t=r[0],i=r[1],n=r[2],s=r[3],a=e[0],c=e[1],d=e[2],p=e[3];return Math.abs(t-a)<=1e-6*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(i-c)<=1e-6*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-d)<=1e-6*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-p)<=1e-6*Math.max(1,Math.abs(s),Math.abs(p))}var WQ=g8,$Q=_8,qQ=y8,ZQ=x8,XQ=b8,YQ=ob,KQ=ab,QQ=function(){let r=f8();return function(e,t,i,n,s,a){let c,d;for(t||(t=4),i||(i=0),n?d=Math.min(n*t+i,e.length):d=e.length,c=i;c<d;c+=t)r[0]=e[c],r[1]=e[c+1],r[2]=e[c+2],r[3]=e[c+3],s(r,r,a),e[c]=r[0],e[c+1]=r[1],e[c+2]=r[2],e[c+3]=r[3];return e}}();var bC;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(bC||(bC={}));var JQ=45*Math.PI/180,eJ=1,yC=.1,xC=500,tJ=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),vr=class extends g0{static get IDENTITY(){return iJ()}static get ZERO(){return rJ()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return bC}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,n,s,a,c,d,p,b,T,B,z,G,Z,q){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=s,this[5]=a,this[6]=c,this[7]=d,this[8]=p,this[9]=b,this[10]=T,this[11]=B,this[12]=z,this[13]=G,this[14]=Z,this[15]=q,this.check()}setRowMajor(e,t,i,n,s,a,c,d,p,b,T,B,z,G,Z,q){return this[0]=e,this[1]=s,this[2]=p,this[3]=z,this[4]=t,this[5]=a,this[6]=b,this[7]=G,this[8]=i,this[9]=c,this[10]=T,this[11]=Z,this[12]=n,this[13]=d,this[14]=B,this[15]=q,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(tJ)}fromObject(e){return this.check()}fromQuaternion(e){return aC(this,e),this.check()}frustum(e){let{left:t,right:i,bottom:n,top:s,near:a=yC,far:c=xC}=e;return c===1/0?nJ(this,t,i,n,s,a):lC(this,t,i,n,s,a,c),this.check()}lookAt(e){let{eye:t,center:i=[0,0,0],up:n=[0,1,0]}=e;return hC(this,t,i,n),this.check()}ortho(e){let{left:t,right:i,bottom:n,top:s,near:a=yC,far:c=xC}=e;return uC(this,t,i,n,s,a,c),this.check()}orthographic(e){let{fovy:t=JQ,aspect:i=eJ,focalDistance:n=1,near:s=yC,far:a=xC}=e;w8(t);let c=t/2,d=n*Math.tan(c),p=d*i;return this.ortho({left:-p,right:p,bottom:-d,top:d,near:s,far:a})}perspective(e){let{fovy:t=45*Math.PI/180,aspect:i=1,near:n=.1,far:s=500}=e;return w8(t),cC(this,t,i,n,s),this.check()}determinant(){return eC(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),n=1/i[0],s=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),n=1/i[0],s=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*n,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*n,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return QS(this,this),this.check()}invert(){return JS(this,this),this.check()}multiplyLeft(e){return v_(this,e,this),this.check()}multiplyRight(e){return v_(this,this,e),this.check()}rotateX(e){return nC(this,this,e),this.check()}rotateY(e){return sC(this,this,e),this.check()}rotateZ(e){return oC(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return iC(this,this,e,t),this.check()}scale(e){return rC(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return tC(this,this,e),this.check()}transform(e,t){return e.length===4?(t=gC(t||[-0,-0,-0,-0],e,this),Uf(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){let{length:i}=e,n;switch(i){case 2:n=__(t||[-0,-0],e,this);break;case 3:n=vp(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Uf(n,e.length),n}transformAsVector(e,t){let i;switch(e.length){case 2:i=Y2(t||[-0,-0],e,this);break;case 3:i=K2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Uf(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}},lb,cb;function rJ(){return lb||(lb=new vr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(lb)),lb}function iJ(){return cb||(cb=new vr,Object.freeze(cb)),cb}function w8(r){if(r>Math.PI*2)throw Error("expected radians")}function nJ(r,e,t,i,n,s){let a=2*s/(t-e),c=2*s/(n-i),d=(t+e)/(t-e),p=(n+i)/(n-i),b=-1,T=-1,B=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=d,r[9]=p,r[10]=b,r[11]=T,r[12]=0,r[13]=0,r[14]=B,r[15]=0,r}function T8(){let r=new vn(4);return vn!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function E8(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function vC(r,e,t){t=t*.5;let i=Math.sin(t);return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=Math.cos(t),r}function wC(r,e,t){let i=e[0],n=e[1],s=e[2],a=e[3],c=t[0],d=t[1],p=t[2],b=t[3];return r[0]=i*b+a*c+n*p-s*d,r[1]=n*b+a*d+s*c-i*p,r[2]=s*b+a*p+i*d-n*c,r[3]=a*b-i*c-n*d-s*p,r}function S8(r,e,t){t*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(t),d=Math.cos(t);return r[0]=i*d+a*c,r[1]=n*d+s*c,r[2]=s*d-n*c,r[3]=a*d-i*c,r}function C8(r,e,t){t*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(t),d=Math.cos(t);return r[0]=i*d-s*c,r[1]=n*d+a*c,r[2]=s*d+i*c,r[3]=a*d-n*c,r}function I8(r,e,t){t*=.5;let i=e[0],n=e[1],s=e[2],a=e[3],c=Math.sin(t),d=Math.cos(t);return r[0]=i*d+n*c,r[1]=n*d-i*c,r[2]=s*d+a*c,r[3]=a*d-s*c,r}function P8(r,e){let t=e[0],i=e[1],n=e[2];return r[0]=t,r[1]=i,r[2]=n,r[3]=Math.sqrt(Math.abs(1-t*t-i*i-n*n)),r}function w_(r,e,t,i){let n=e[0],s=e[1],a=e[2],c=e[3],d=t[0],p=t[1],b=t[2],T=t[3],B,z,G,Z,q;return B=n*d+s*p+a*b+c*T,B<0&&(B=-B,d=-d,p=-p,b=-b,T=-T),1-B>1e-6?(z=Math.acos(B),q=Math.sin(z),G=Math.sin((1-i)*z)/q,Z=Math.sin(i*z)/q):(G=1-i,Z=i),r[0]=G*n+Z*d,r[1]=G*s+Z*p,r[2]=G*a+Z*b,r[3]=G*c+Z*T,r}function M8(r,e){let t=e[0],i=e[1],n=e[2],s=e[3],a=t*t+i*i+n*n+s*s,c=a?1/a:0;return r[0]=-t*c,r[1]=-i*c,r[2]=-n*c,r[3]=s*c,r}function R8(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function TC(r,e){let t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),r[3]=.5*i,i=.5/i,r[0]=(e[5]-e[7])*i,r[1]=(e[6]-e[2])*i,r[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);let s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[s*3+s]-e[a*3+a]+1),r[n]=.5*i,i=.5/i,r[3]=(e[s*3+a]-e[a*3+s])*i,r[s]=(e[s*3+n]+e[n*3+s])*i,r[a]=(e[a*3+n]+e[n*3+a])*i}return r}var B8=fC;var L8=dC,O8=AC,D8=mC,k8=ob;var F8=ab;var N8=pC;var z8=function(){let r=J2(),e=eb(1,0,0),t=eb(0,1,0);return function(i,n,s){let a=y_(n,s);return a<-.999999?(bp(r,e,n),qS(r)<1e-6&&bp(r,t,n),jS(r,r),vC(i,r,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(bp(r,n,s),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+a,N8(i,i))}}(),pwe=function(){let r=T8(),e=T8();return function(t,i,n,s,a,c){return w_(r,i,a,c),w_(e,n,s,c),w_(t,r,e,2*c*(1-c)),t}}(),Awe=function(){let r=QL();return function(e,t,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],N8(e,TC(e,r))}}();var oJ=[0,0,0,1],ml=class extends zf{constructor(e=0,t=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,i,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return TC(this,e),this.check()}fromAxisRotation(e,t){return vC(this,e,t),this.check()}identity(){return E8(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Li(e)}get y(){return this[1]}set y(e){this[1]=Li(e)}get z(){return this[2]}set z(e){this[2]=Li(e)}get w(){return this[3]}set w(e){this[3]=Li(e)}len(){return k8(this)}lengthSquared(){return F8(this)}dot(e){return O8(this,e)}rotationTo(e,t){return z8(this,e,t),this.check()}add(e){return B8(this,this,e),this.check()}calculateW(){return P8(this,this),this.check()}conjugate(){return R8(this,this),this.check()}invert(){return M8(this,this),this.check()}lerp(e,t,i){return i===void 0?this.lerp(this,e,t):(D8(this,e,t,i),this.check())}multiplyRight(e){return wC(this,this,e),this.check()}multiplyLeft(e){return wC(this,e,this),this.check()}normalize(){let e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return S8(this,this,e),this.check()}rotateY(e){return C8(this,this,e),this.check()}rotateZ(e){return I8(this,this,e),this.check()}scale(e){return L8(this,this,e),this.check()}slerp(e,t,i){let n,s,a;switch(arguments.length){case 1:({start:n=oJ,target:s,ratio:a}=e);break;case 2:n=this,s=e,a=t;break;default:n=e,s=t,a=i}return w_(this,n,s,a),this.check()}transformVector4(e,t=new ib){return _C(t,e,this),Uf(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}};var lc={};Ms(lc,{EPSILON1:()=>aJ,EPSILON10:()=>mJ,EPSILON11:()=>gJ,EPSILON12:()=>_J,EPSILON13:()=>yJ,EPSILON14:()=>xJ,EPSILON15:()=>bJ,EPSILON16:()=>vJ,EPSILON17:()=>wJ,EPSILON18:()=>TJ,EPSILON19:()=>EJ,EPSILON2:()=>lJ,EPSILON20:()=>SJ,EPSILON3:()=>cJ,EPSILON4:()=>uJ,EPSILON5:()=>hJ,EPSILON6:()=>fJ,EPSILON7:()=>dJ,EPSILON8:()=>pJ,EPSILON9:()=>AJ,PI_OVER_FOUR:()=>IJ,PI_OVER_SIX:()=>PJ,PI_OVER_TWO:()=>CJ,TWO_PI:()=>MJ});var aJ=.1,lJ=.01,cJ=.001,uJ=1e-4,hJ=1e-5,fJ=1e-6,dJ=1e-7,pJ=1e-8,AJ=1e-9,mJ=1e-10,gJ=1e-11,_J=1e-12,yJ=1e-13,xJ=1e-14,bJ=1e-15,vJ=1e-16,wJ=1e-17,TJ=1e-18,EJ=1e-19,SJ=1e-20,CJ=Math.PI/2,IJ=Math.PI/4,PJ=Math.PI/6,MJ=Math.PI*2;function EC(r,e=[],t=0){let i=Math.fround(r),n=r-i;return e[t]=i,e[t+1]=n,e}function U8(r){return r-Math.fround(r)}function V8(r){let e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){let n=t*4+i;EC(r[i*4+t],e,n*2)}return e}var RJ=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,SC={name:"fp32",vs:RJ};var j8=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var BJ={ONE:1},CC={name:"fp64arithmetic",vs:j8,defaultUniforms:BJ,uniformTypes:{ONE:"f32"},fp64ify:EC,fp64LowPart:U8,fp64ifyMatrix4:V8};var LJ=[0,1,1,1],OJ=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,DJ=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,ub={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:LJ},vs:OJ,fs:DJ,getUniforms:kJ};function kJ(r={},e){let t={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;let i=r.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(r.highlightColor){let i=Array.from(r.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return r.isActive!==void 0&&(t.isActive=!!r.isActive,t.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(t.useFloatColors=!!r.useFloatColors),t}var IC=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`;var G8=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;var H8=3,FJ=255,T_;(function(r){r[r.POINT=0]="POINT",r[r.DIRECTIONAL=1]="DIRECTIONAL"})(T_||(T_={}));var dh={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:H8},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:T_.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:G8,vs:IC,fs:IC,getUniforms:NJ};function NJ(r,e={}){if(r=r&&{...r},!r)return{...dh.defaultUniforms};r.lights&&(r={...r,...UJ(r.lights),lights:void 0});let{ambientLight:t,pointLights:i,directionalLights:n}=r||{};if(!(t||i&&i.length>0||n&&n.length>0))return{...dh.defaultUniforms,enabled:0};let a={...dh.defaultUniforms,...e,...zJ({ambientLight:t,pointLights:i,directionalLights:n})};return r.enabled!==void 0&&(a.enabled=r.enabled?1:0),a}function zJ({ambientLight:r,pointLights:e=[],directionalLights:t=[]}){let i={};i.ambientLightColor=PC(r);let n=0;for(let s of e){i.lightType=T_.POINT;let a=n;i[`lightColor${a}`]=PC(s),i[`lightPosition${a}`]=s.position,i[`lightAttenuation${a}`]=s.attenuation||[1,0,0],n++}for(let s of t){i.lightType=T_.DIRECTIONAL;let a=n;i[`lightColor${a}`]=PC(s),i[`lightDirection${a}`]=s.direction,n++}return n>H8&&Vt.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function UJ(r){let e={pointLights:[],directionalLights:[]};for(let t of r||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break;default:}return e}function PC(r={}){let{color:e=[0,0,0],intensity:t=1}=r;return e.map(i=>i*t/FJ)}var hb=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,fb=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`;var db=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`;var jf={props:{},name:"gouraudMaterial",vs:fb.replace("phongMaterial","gouraudMaterial"),fs:hb.replace("phongMaterial","gouraudMaterial"),source:db.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[dh],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){let e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...jf.defaultUniforms,...e}}};var _0={name:"phongMaterial",dependencies:[dh],source:db,vs:hb,fs:fb,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){let e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{..._0.defaultUniforms,...e}}};var W8=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`;var $8=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`;var q8=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,Z8={name:"pbrProjection",vs:q8,fs:q8,getUniforms:r=>r,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}};var wp={props:{},uniforms:{},name:"pbrMaterial",dependencies:[dh,Z8],vs:W8,fs:$8,defines:{LIGHTING_FRAGMENT:1},getUniforms:r=>r,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}};var X8=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,MC={name:"layer",vs:X8,fs:X8,getUniforms:r=>({opacity:Math.pow(r.opacity,.45454545454545453)}),uniformTypes:{opacity:"f32"}};var VJ=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Y8="#define SMOOTH_EDGE_RADIUS 0.5",jJ=`${Y8}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,GJ=`${Y8}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,pb={name:"geometry",source:VJ,vs:jJ,fs:GJ};var un;(function(r){r[r.Start=1]="Start",r[r.Move=2]="Move",r[r.End=4]="End",r[r.Cancel=8]="Cancel"})(un||(un={}));var Un;(function(r){r[r.None=0]="None",r[r.Left=1]="Left",r[r.Right=2]="Right",r[r.Up=4]="Up",r[r.Down=8]="Down",r[r.Horizontal=3]="Horizontal",r[r.Vertical=12]="Vertical",r[r.All=15]="All"})(Un||(Un={}));var Nr;(function(r){r[r.Possible=1]="Possible",r[r.Began=2]="Began",r[r.Changed=4]="Changed",r[r.Ended=8]="Ended",r[r.Recognized=8]="Recognized",r[r.Cancelled=16]="Cancelled",r[r.Failed=32]="Failed"})(Nr||(Nr={}));var K8="compute",RC="auto",E_="manipulation",Tp="none",S_="pan-x",C_="pan-y";function BC(r){if(r.includes(Tp))return Tp;let e=r.includes(S_),t=r.includes(C_);return e&&t?Tp:e||t?e?S_:C_:r.includes(E_)?E_:RC}var I_=class{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===K8&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return BC(e.join(" "))}};function y0(r){return r.trim().split(/\s+/g)}function Ab(r,e,t){if(r)for(let i of y0(e))r.addEventListener(i,t,!1)}function mb(r,e,t){if(r)for(let i of y0(e))r.removeEventListener(i,t,!1)}function LC(r){return(r.ownerDocument||r).defaultView}function OC(r,e){let t=r;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function gb(r){let e=r.length;if(e===1)return{x:Math.round(r[0].clientX),y:Math.round(r[0].clientY)};let t=0,i=0,n=0;for(;n<e;)t+=r[n].clientX,i+=r[n].clientY,n++;return{x:Math.round(t/e),y:Math.round(i/e)}}function DC(r){let e=[],t=0;for(;t<r.pointers.length;)e[t]={clientX:Math.round(r.pointers[t].clientX),clientY:Math.round(r.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:gb(e),deltaX:r.deltaX,deltaY:r.deltaY}}function _b(r,e){let t=e.x-r.x,i=e.y-r.y;return Math.sqrt(t*t+i*i)}function kC(r,e){let t=e.clientX-r.clientX,i=e.clientY-r.clientY;return Math.sqrt(t*t+i*i)}function Q8(r,e){let t=e.x-r.x,i=e.y-r.y;return Math.atan2(i,t)*180/Math.PI}function FC(r,e){let t=e.clientX-r.clientX,i=e.clientY-r.clientY;return Math.atan2(i,t)*180/Math.PI}function yb(r,e){return r===e?Un.None:Math.abs(r)>=Math.abs(e)?r<0?Un.Left:Un.Right:e<0?Un.Up:Un.Down}function J8(r,e){let t=e.center,i=r.offsetDelta,n=r.prevDelta,s=r.prevInput;return(e.eventType===un.Start||s?.eventType===un.End)&&(n=r.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},i=r.offsetDelta={x:t.x,y:t.y}),{deltaX:n.x+(t.x-i.x),deltaY:n.y+(t.y-i.y)}}function xb(r,e,t){return{x:e/r||0,y:t/r||0}}function eO(r,e){return kC(e[0],e[1])/kC(r[0],r[1])}function tO(r,e){return FC(e[1],e[0])-FC(r[1],r[0])}function rO(r,e){let t=r.lastInterval||e,i=e.timeStamp-t.timeStamp,n,s,a,c;if(e.eventType!==un.Cancel&&(i>25||t.velocity===void 0)){let d=e.deltaX-t.deltaX,p=e.deltaY-t.deltaY,b=xb(i,d,p);s=b.x,a=b.y,n=Math.abs(b.x)>Math.abs(b.y)?b.x:b.y,c=yb(d,p),r.lastInterval=e}else n=t.velocity,s=t.velocityX,a=t.velocityY,c=t.direction;e.velocity=n,e.velocityX=s,e.velocityY=a,e.direction=c}function iO(r,e){let{session:t}=r,{pointers:i}=e,{length:n}=i;t.firstInput||(t.firstInput=DC(e)),n>1&&!t.firstMultiple?t.firstMultiple=DC(e):n===1&&(t.firstMultiple=!1);let{firstInput:s,firstMultiple:a}=t,c=a?a.center:s.center,d=e.center=gb(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=Q8(c,d),e.distance=_b(c,d);let{deltaX:p,deltaY:b}=J8(t,e);e.deltaX=p,e.deltaY=b,e.offsetDirection=yb(e.deltaX,e.deltaY);let T=xb(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=T.x,e.overallVelocityY=T.y,e.overallVelocity=Math.abs(T.x)>Math.abs(T.y)?T.x:T.y,e.scale=a?eO(a.pointers,i):1,e.rotation=a?tO(a.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let B=r.element;return OC(e.srcEvent.target,B)&&(B=e.srcEvent.target),e.target=B,rO(t,e),e}function nO(r,e,t){let i=t.pointers.length,n=t.changedPointers.length,s=e&un.Start&&i-n===0,a=e&(un.End|un.Cancel)&&i-n===0;t.isFirst=!!s,t.isFinal=!!a,s&&(r.session={}),t.eventType=e;let c=iO(r,t);r.emit("hammer.input",c),r.recognize(c),r.session.prevInput=c}var P_=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){nO(this.manager,e,t)}init(){Ab(this.element,this.evEl,this.domHandler),Ab(this.target,this.evTarget,this.domHandler),Ab(LC(this.element),this.evWin,this.domHandler)}destroy(){mb(this.element,this.evEl,this.domHandler),mb(this.target,this.evTarget,this.domHandler),mb(LC(this.element),this.evWin,this.domHandler)}};var WJ={pointerdown:un.Start,pointermove:un.Move,pointerup:un.End,pointercancel:un.Cancel,pointerout:un.Cancel},$J="pointerdown",qJ="pointermove pointerup pointercancel",M_=class extends P_{constructor(e){super(e),this.evEl=$J,this.evWin=qJ,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:t}=this,i=!1,n=WJ[e.type],s=e.pointerType,a=s==="touch",c=t.findIndex(d=>d.pointerId===e.pointerId);n&un.Start&&(e.buttons||a)?c<0&&(t.push(e),c=t.length-1):n&(un.End|un.Cancel)&&(i=!0),!(c<0)&&(t[c]=e,this.callback(n,{pointers:t,changedPointers:[e],eventType:n,pointerType:s,srcEvent:e}),i&&t.splice(c,1))}};var ZJ=["","webkit","Moz","MS","ms","o"];function sO(r,e){let t=e[0].toUpperCase()+e.slice(1);for(let i of ZJ){let n=i?i+t:e;if(n in r)return n}}var XJ=1,oO=2,aO={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}},R_=class{constructor(e,t){this.options={...aO,...t,cssProps:{...aO.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new M_(this),this.touchAction=new I_(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?oO:XJ}recognize(e){let{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i,{recognizers:n}=this,{curRecognizer:s}=t;(!s||s&&s.state&Nr.Recognized)&&(s=t.curRecognizer=null);let a=0;for(;a<n.length;)i=n[a],t.stopped!==oO&&(!s||i===s||i.canRecognizeWith(s))?i.recognize(e):i.reset(),!s&&i.state&(Nr.Began|Nr.Changed|Nr.Ended)&&(s=t.curRecognizer=i),a++}get(e){let{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(let i of e)this.add(i);return this}let t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let i of e)this.remove(i);return this}let t=typeof e=="string"?this.get(e):e;if(t){let{recognizers:i}=this,n=i.indexOf(t);n!==-1&&(i.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;let{handlers:i}=this;for(let n of y0(e))i[n]=i[n]||[],i[n].push(t)}off(e,t){if(!e)return;let{handlers:i}=this;for(let n of y0(e))t?i[n]&&i[n].splice(i[n].indexOf(t),1):delete i[n]}emit(e,t){let i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;let n=t;n.type=e,n.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<i.length;)i[s](n),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:t}=this;if(t){for(let[i,n]of Object.entries(this.options.cssProps)){let s=sO(t.style,i);e?(this.oldCssProps[s]=t.style[s],t.style[s]=n):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}};var YJ=1;function lO(){return YJ++}function NC(r){return r&Nr.Cancelled?"cancel":r&Nr.Ended?"end":r&Nr.Changed?"move":r&Nr.Began?"start":""}var ph=class{constructor(e){this.options=e,this.id=lO(),this.state=Nr.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(let n of e)this.recognizeWith(n);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;let{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(let i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(let n of e)this.requireFailure(n);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;let{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(let i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){let i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:t}=this;t<Nr.Ended&&this.manager.emit(this.options.event+NC(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Nr.Ended&&this.manager.emit(this.options.event+NC(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Nr.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Nr.Failed|Nr.Possible)))return!1;e++}return!0}recognize(e){let t={...e};if(!this.options.enable){this.reset(),this.state=Nr.Failed;return}this.state&(Nr.Recognized|Nr.Cancelled|Nr.Failed)&&(this.state=Nr.Possible),this.state=this.process(t),this.state&(Nr.Began|Nr.Changed|Nr.Ended|Nr.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}};var Ah=class extends ph{attrTest(e){let t=this.options.pointers;return t===0||e.pointers.length===t}process(e){let{state:t}=this,{eventType:i}=e,n=t&(Nr.Began|Nr.Changed),s=this.attrTest(e);return n&&(i&un.Cancel||!s)?t|Nr.Cancelled:n||s?i&un.End?t|Nr.Ended:t&Nr.Began?t|Nr.Changed:Nr.Began:Nr.Failed}};var Ep=class extends ph{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[E_]}process(e){let{options:t}=this,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&un.Start&&this.count===0)return this.failTimeout();if(n&&s&&i){if(e.eventType!==un.End)return this.failTimeout();let a=this.pTime?e.timeStamp-this.pTime<t.interval:!0,c=!this.pCenter||_b(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!a?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Nr.Recognized,this.tryEmit(this._input)},t.interval),Nr.Began):Nr.Recognized}return Nr.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Nr.Failed},this.options.interval),Nr.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Nr.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}};var KJ=["","start","move","end","cancel","up","down","left","right"],Gf=class extends Ah{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Un.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,t=[];return e&Un.Horizontal&&t.push(C_),e&Un.Vertical&&t.push(S_),t}getEventNames(){return KJ.map(e=>this.options.event+e)}directionTest(e){let{options:t}=this,i=!0,{distance:n}=e,{direction:s}=e,a=e.deltaX,c=e.deltaY;return s&t.direction||(t.direction&Un.Horizontal?(s=a===0?Un.None:a<0?Un.Left:Un.Right,i=a!==this.pX,n=Math.abs(e.deltaX)):(s=c===0?Un.None:c<0?Un.Up:Un.Down,i=c!==this.pY,n=Math.abs(e.deltaY))),e.direction=s,i&&n>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Nr.Began)||!(this.state&Nr.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let t=Un[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}};var QJ=["","start","move","end","cancel","in","out"],x0=class extends Ah{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Tp]}getEventNames(){return QJ.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Nr.Began))}emit(e){if(e.scale!==1){let t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}};var uu=class{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}};var cO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",jEe=typeof window<"u"?window:global;var ree=cO.indexOf("firefox")!==-1,uO=4.000244140625,iee=40,nee=.25,bb=class extends uu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=n=>{if(!this.options.enable)return;let s=n.deltaY;globalThis.WheelEvent&&(ree&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=iee)),s!==0&&s%uO===0&&(s=Math.floor(s/uO)),n.shiftKey&&s&&(s=s*nee),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-s,srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}};var hO=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],vb=class extends uu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;let{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,hO.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){hO.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break;default:}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break;default:}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}};var fO=["keydown","keyup"],wb=class extends uu{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=n=>{let s=n.target||n.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",fO.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){fO.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}};var Tb=class extends uu{constructor(e,t,i){super(e,t,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}};var see={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},oee=0,aee=1,lee=2,cee=1,uee=2,hee=4;function dO(r){let e=see[r.srcEvent.type];if(!e)return null;let{buttons:t,button:i}=r.srcEvent,n=!1,s=!1,a=!1;return e===2?(n=!!(t&cee),s=!!(t&hee),a=!!(t&uee)):(n=i===oee,s=i===aee,a=i===lee),{leftButton:n,middleButton:s,rightButton:a}}function pO(r,e){let t=r.center;if(!t)return null;let i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,a={x:(t.x-i.left-e.clientLeft)/n,y:(t.y-i.top-e.clientTop)/s};return{center:t,offsetCenter:a}}var fee={srcElement:"root",priority:0},Eb=class{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;let n=this._normalizeEvent(i),s=i.srcEvent.target;for(;s&&s!==n.rootElement;){if(this._emit(n,s),n.handled)return;s=s.parentNode}this._emit(n,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,n=!1,s=!1){let{handlers:a,handlersByElement:c}=this,d={...fee,...i},p=c.get(d.srcElement);p||(p=[],c.set(d.srcElement,p));let b={type:e,handler:t,srcElement:d.srcElement,priority:d.priority};n&&(b.once=!0),s&&(b.passive=!0),a.push(b),this._active=this._active||!b.passive;let T=p.length-1;for(;T>=0&&!(p[T].priority>=b.priority);)T--;p.splice(T+1,0,b)}remove(e,t){let{handlers:i,handlersByElement:n}=this;for(let s=i.length-1;s>=0;s--){let a=i[s];if(a.type===e&&a.handler===t){i.splice(s,1);let c=n.get(a.srcElement);c.splice(c.indexOf(a),1),c.length===0&&n.delete(a.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,t){let i=this.handlersByElement.get(t);if(i){let n=!1,s=()=>{e.handled=!0},a=()=>{e.handled=!0,n=!0},c=[];for(let d=0;d<i.length;d++){let{type:p,handler:b,once:T}=i[d];if(b({...e,type:p,stopPropagation:s,stopImmediatePropagation:a}),T&&c.push(i[d]),n)break}for(let d=0;d<c.length;d++){let{type:p,handler:b}=c[d];this.remove(p,b)}}}_normalizeEvent(e){let t=this.eventManager.getElement();return{...e,...dO(e),...pO(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}};function dee(r){if("recognizer"in r)return r;let e,t=Array.isArray(r)?[...r]:[r];if(typeof t[0]=="function"){let i=t.shift(),n=t.shift()||{};e=new i(n)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}var B_=class{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new R_(e,this.options);for(let i of this.options.recognizers){let{recognizer:n,recognizeWith:s,requireFailure:a}=dee(i);this.manager.add(n),s&&n.recognizeWith(s),a&&n.requireFailure(a)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new bb(e,this._onOtherEvent,{enable:!1}),this.moveInput=new vb(e,this._onOtherEvent,{enable:!1}),this.keyInput=new wb(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Tb(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){let{manager:i}=this;if(!i)return;let n=i.get(e);n&&(n.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,n,s){if(typeof e!="string"){i=t;for(let[p,b]of Object.entries(e))this._addEventHandler(p,b,i,n,s);return}let{manager:a,events:c}=this;if(!a)return;let d=c.get(e);if(!d){let p=this._getRecognizerName(e)||e;d=new Eb(this,p),c.set(e,d),a&&a.on(e,d.handleEvent)}d.add(e,t,i,n,s),d.isEmpty()||this._toggleRecognizer(d.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(let[s,a]of Object.entries(e))this._removeEventHandler(s,a);return}let{events:i}=this,n=i.get(e);if(n&&(n.remove(e,t),n.isEmpty())){let{recognizerName:s}=n,a=!1;for(let c of i.values())if(c.recognizerName===s&&!c.isEmpty()){a=!0;break}a||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}};var br={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(br,"IDENTITY",{get:()=>(cr.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var Ws={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Pn={common:0,meters:1,pixels:2},L_={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},zC={multipan:[Gf,{threshold:10,direction:Un.Vertical,pointers:2}],pinch:[x0,{},null,["multipan"]],pan:[Gf,{threshold:1},["pinch"],["multipan"]],dblclick:[Ep,{event:"dblclick",taps:2}],click:[Ep,{event:"click"},null,["dblclick"]]};function pee(r,e){if(r===e)return!0;if(Array.isArray(r)){let t=r.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}return!1}function hu(r){let e={},t;return i=>{for(let n in i)if(!pee(i[n],e[n])){t=r(i),e=i;break}return t}}var AO=[0,0,0,0],Aee=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],mO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mee=[0,0,0],gO=[0,0,0],gee=hu(yee);function UC(r,e,t=gO){t.length<3&&(t=[t[0],t[1],0]);let i=t,n,s=!0;switch(e===br.LNGLAT_OFFSETS||e===br.METER_OFFSETS?n=t:n=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case Ws.WEB_MERCATOR:(e===br.LNGLAT||e===br.CARTESIAN)&&(n=[0,0,0],s=!1);break;case Ws.WEB_MERCATOR_AUTO_OFFSET:e===br.LNGLAT?i=n:e===br.CARTESIAN&&(i=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],n=r.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case Ws.IDENTITY:i=r.position.map(Math.fround),i[2]=i[2]||0;break;case Ws.GLOBE:s=!1,n=null;break;default:s=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:s}}function _ee(r,e,t){let{viewMatrixUncentered:i,projectionMatrix:n}=r,{viewMatrix:s,viewProjectionMatrix:a}=r,c=AO,d=AO,p=r.cameraPosition,{geospatialOrigin:b,shaderCoordinateOrigin:T,offsetMode:B}=UC(r,e,t);return B&&(d=r.projectPosition(b||T),p=[p[0]-d[0],p[1]-d[1],p[2]-d[2]],d[3]=1,c=Aa.transformMat4([],d,a),s=i||s,a=ms.multiply([],n,s),a=ms.multiply([],a,Aee)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:c,originCommon:d,cameraPosCommon:p,shaderCoordinateOrigin:T,geospatialOrigin:b}}function _O({viewport:r,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=br.DEFAULT,coordinateOrigin:n=gO,autoWrapLongitude:s=!1}){i===br.DEFAULT&&(i=r.isGeospatial?br.LNGLAT:br.CARTESIAN);let a=gee({viewport:r,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n});return a.wrapLongitude=s,a.modelMatrix=t||mO,a}function yee({viewport:r,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){let{projectionCenter:n,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:c,shaderCoordinateOrigin:d,geospatialOrigin:p}=_ee(r,t,i),b=r.getDistanceScales(),T=[r.width*e,r.height*e],B=Aa.transformMat4([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,z={coordinateSystem:t,projectionMode:r.projectionMode,coordinateOrigin:d,commonOrigin:a.slice(0,3),center:n,pseudoMeters:!!r._pseudoMeters,viewportSize:T,devicePixelRatio:e,focalDistance:B,commonUnitsPerMeter:b.unitsPerMeter,commonUnitsPerWorldUnit:b.unitsPerMeter,commonUnitsPerWorldUnit2:mee,scale:r.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:mO,cameraPosition:c};if(p){let G=r.getDistanceScales(p);switch(t){case br.METER_OFFSETS:z.commonUnitsPerWorldUnit=G.unitsPerMeter,z.commonUnitsPerWorldUnit2=G.unitsPerMeter2;break;case br.LNGLAT:case br.LNGLAT_OFFSETS:r._pseudoMeters||(z.commonUnitsPerMeter=G.unitsPerMeter),z.commonUnitsPerWorldUnit=G.unitsPerDegree,z.commonUnitsPerWorldUnit2=G.unitsPerDegree2;break;case br.CARTESIAN:z.commonUnitsPerWorldUnit=[1,1,G.unitsPerMeter[2]],z.commonUnitsPerWorldUnit2=[0,0,G.unitsPerMeter2[2]];break;default:break}}return z}var xee=Object.keys(br).map(r=>`const COORDINATE_SYSTEM_${r}: i32 = ${br[r]};`).join(""),bee=Object.keys(Ws).map(r=>`const PROJECTION_MODE_${r}: i32 = ${Ws[r]};`).join(""),vee=Object.keys(Pn).map(r=>`const UNIT_${r.toUpperCase()}: i32 = ${Pn[r]};`).join(""),wee=`${xee}
${bee}
${vee}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,yO=`${wee}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z\u2011axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`;var Tee=Object.keys(br).map(r=>`const int COORDINATE_SYSTEM_${r} = ${br[r]};`).join(""),Eee=Object.keys(Ws).map(r=>`const int PROJECTION_MODE_${r} = ${Ws[r]};`).join(""),See=Object.keys(Pn).map(r=>`const int UNIT_${r.toUpperCase()} = ${Pn[r]};`).join(""),xO=`${Tee}
${Eee}
${See}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;var Cee={};function Iee(r=Cee){return"viewport"in r?_O(r):{}}var b0={name:"project",dependencies:[SC,pb],source:yO,vs:xO,getUniforms:Iee,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};var Pee=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,Mee=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Pi={name:"project32",dependencies:[b0],source:Pee,vs:Mee};function VC(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Hf(r,e){let t=Aa.transformMat4([],e,r);return Aa.scale(t,t,1/t[3]),t}function jC(r,e){let t=r%e;return t<0?e+t:t}function O_(r,e,t){return r<e?e:r>t?t:r}function Ree(r){return Math.log(r)*Math.LOG2E}var v0=Math.log2||Ree;function cc(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var uc=Math.PI,bO=uc/4,gl=uc/180,GC=180/uc,w0=512,Sb=4003e4,_l=85.051129,vO=1.5;function HC(r){return v0(r)}function $s(r){let[e,t]=r;cc(Number.isFinite(e)),cc(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");let i=e*gl,n=t*gl,s=w0*(i+uc)/(2*uc),a=w0*(uc+Math.log(Math.tan(bO+n*.5)))/(2*uc);return[s,a]}function Lo(r){let[e,t]=r,i=e/w0*(2*uc)-uc,n=2*(Math.atan(Math.exp(t/w0*(2*uc)-uc))-bO);return[i*GC,n*GC]}function WC(r){let{latitude:e}=r;cc(Number.isFinite(e));let t=Math.cos(e*gl);return HC(Sb*t)-9}function Sp(r){let e=Math.cos(r*gl);return w0/Sb/e}function T0(r){let{latitude:e,longitude:t,highPrecision:i=!1}=r;cc(Number.isFinite(e)&&Number.isFinite(t));let n=w0,s=Math.cos(e*gl),a=n/360,c=a/s,d=n/Sb/s,p={unitsPerMeter:[d,d,d],metersPerUnit:[1/d,1/d,1/d],unitsPerDegree:[a,c,d],degreesPerUnit:[1/a,1/c,1/d]};if(i){let b=gl*Math.tan(e*gl)/s,T=a*b/2,B=n/Sb*b,z=B/c*d;p.unitsPerDegree2=[0,T,B],p.unitsPerMeter2=[z,0,z]}return p}function D_(r,e){let[t,i,n]=r,[s,a,c]=e,{unitsPerMeter:d,unitsPerMeter2:p}=T0({longitude:t,latitude:i,highPrecision:!0}),b=$s(r);b[0]+=s*(d[0]+p[0]*a),b[1]+=a*(d[1]+p[1]*a);let T=Lo(b),B=(n||0)+(c||0);return Number.isFinite(n)||Number.isFinite(c)?[T[0],T[1],B]:T}function Cb(r){let{height:e,pitch:t,bearing:i,altitude:n,scale:s,center:a}=r,c=VC();ms.translate(c,c,[0,0,-n]),ms.rotateX(c,c,-t*gl),ms.rotateZ(c,c,i*gl);let d=s/e;return ms.scale(c,c,[d,d,d]),a&&ms.translate(c,c,To.negate([],a)),c}function $C(r){let{width:e,height:t,altitude:i,pitch:n=0,offset:s,center:a,scale:c,nearZMultiplier:d=1,farZMultiplier:p=1}=r,{fovy:b=mh(vO)}=r;i!==void 0&&(b=mh(i));let T=b*gl,B=n*gl,z=Cp(b),G=z;a&&(G+=a[2]*c/Math.cos(B)/t);let Z=T*(.5+(s?s[1]:0)/t),q=Math.sin(Z)*G/Math.sin(O_(Math.PI/2-B-Z,.01,Math.PI-.01)),re=Math.sin(B)*q+G,ee=G*10,ae=Math.min(re*p,ee);return{fov:T,aspect:e/t,focalDistance:z,near:d,far:ae}}function mh(r){return 2*Math.atan(.5/r)*GC}function Cp(r){return .5/Math.tan(.5*r*gl)}function E0(r,e){let[t,i,n=0]=r;return cc(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(n)),Hf(e,[t,i,n,1])}function Wf(r,e,t=0){let[i,n,s]=r;if(cc(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return Hf(e,[i,n,s,1]);let a=Hf(e,[i,n,0,1]),c=Hf(e,[i,n,1,1]),d=a[2],p=c[2],b=d===p?0:((t||0)-d)/(p-d);return cu.lerp([],a,c,b)}function Ib(r){let{width:e,height:t,bounds:i,minExtent:n=0,maxZoom:s=24,offset:a=[0,0]}=r,[[c,d],[p,b]]=i,T=Bee(r.padding),B=$s([c,O_(b,-_l,_l)]),z=$s([p,O_(d,-_l,_l)]),G=[Math.max(Math.abs(z[0]-B[0]),n),Math.max(Math.abs(z[1]-B[1]),n)],Z=[e-T.left-T.right-Math.abs(a[0])*2,t-T.top-T.bottom-Math.abs(a[1])*2];cc(Z[0]>0&&Z[1]>0);let q=Z[0]/G[0],re=Z[1]/G[1],ee=(T.right-T.left)/2/q,ae=(T.top-T.bottom)/2/re,me=[(z[0]+B[0])/2+ee,(z[1]+B[1])/2+ae],Le=Lo(me),je=Math.min(s,v0(Math.abs(Math.min(q,re))));return cc(Number.isFinite(je)),{longitude:Le[0],latitude:Le[1],zoom:je}}function Bee(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(cc(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}var wO=Math.PI/180;function Pb(r,e=0){let{width:t,height:i,unproject:n}=r,s={targetZ:e},a=n([0,i],s),c=n([t,i],s),d,p,b=r.fovy?.5*r.fovy*wO:Math.atan(.5/r.altitude),T=(90-r.pitch)*wO;return b>T-.01?(d=TO(r,0,e),p=TO(r,t,e)):(d=n([0,0],s),p=n([t,0],s)),[a,c,p,d]}function TO(r,e,t){let{pixelUnprojectionMatrix:i}=r,n=Hf(i,[e,0,1,1]),s=Hf(i,[e,r.height,1,1]),c=(t*r.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),d=cu.lerp([],n,s,c),p=Lo(d);return p.push(t),p}var SO=512;function qC(r){let{width:e,height:t,pitch:i=0}=r,{longitude:n,latitude:s,zoom:a,bearing:c=0}=r;(n<-180||n>180)&&(n=jC(n+180,360)-180),(c<-180||c>180)&&(c=jC(c+180,360)-180);let d=v0(t/SO);if(a<=d)a=d,s=0;else{let p=t/2/Math.pow(2,a),b=Lo([0,p])[1];if(s<b)s=b;else{let T=Lo([0,SO-p])[1];s>T&&(s=T)}}return{width:e,height:t,longitude:n,latitude:s,zoom:a,pitch:i,bearing:c}}var CO=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,Dee=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,kee=`
${CO}
${Dee}
`,Fee=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Nee=`
${CO}
${Fee}
`,zee=hu(Hee),Uee=hu(Wee),Vee=[0,0,0,1],jee=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Gee(r,e){let[t,i,n]=r,s=Wf([t,i,n],e);return Number.isFinite(n)?s:[s[0],s[1],0]}function Hee({viewport:r,center:e}){return new vr(r.viewProjectionMatrix).invert().transform(e)}function Wee({viewport:r,shadowMatrices:e}){let t=[],i=r.pixelUnprojectionMatrix,n=r.isGeospatial?void 0:1,s=[[0,0,n],[r.width,0,n],[0,r.height,n],[r.width,r.height,n],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(a=>Gee(a,i));for(let a of e){let c=a.clone().translate(new st(r.center).negate()),d=s.map(b=>c.transform(b)),p=new vr().ortho({left:Math.min(...d.map(b=>b[0])),right:Math.max(...d.map(b=>b[0])),bottom:Math.min(...d.map(b=>b[1])),top:Math.max(...d.map(b=>b[1])),near:Math.min(...d.map(b=>-b[2])),far:Math.max(...d.map(b=>-b[2]))});t.push(p.multiplyRight(a))}return t}function $ee(r){let{shadowEnabled:e=!0,project:t}=r;if(!e||!t||!r.shadowMatrices||!r.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};let i=b0.getUniforms(t),n=zee({viewport:t.viewport,center:i.center}),s=[],a=Uee({shadowMatrices:r.shadowMatrices,viewport:t.viewport}).slice();for(let d=0;d<r.shadowMatrices.length;d++){let p=a[d],b=p.clone().translate(new st(t.viewport.center).negate());i.coordinateSystem===br.LNGLAT&&i.projectionMode===Ws.WEB_MERCATOR?(a[d]=b,s[d]=n):(a[d]=p.clone().multiplyRight(jee),s[d]=b.transform(n))}let c={drawShadowMap:!!r.drawToShadowMap,useShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,color:r.shadowColor||Vee,lightId:r.shadowLightId||0,lightCount:r.shadowMatrices.length,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};for(let d=0;d<a.length;d++)c[`viewProjectionMatrix${d}`]=a[d],c[`projectCenter${d}`]=s[d];for(let d=0;d<2;d++)c[`shadow_uShadowMap${d}`]=r.shadowMaps&&r.shadowMaps[d]||r.dummyShadowMap;return c}var Mb={name:"shadow",dependencies:[b0],vs:kee,fs:Nee,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:$ee,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}};var wn={...ub,defaultUniforms:{...ub.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var qee=[pb],Zee=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Xee=[];function IO(r){let e=cp.getDefaultShaderAssembler();for(let i of qee)e.addDefaultModule(i);let t=r==="glsl"?Zee:Xee;for(let i of t)e.addShaderHook(i);return e}var Yee=[255,255,255],Kee=1,Qee=0,Rb=class{constructor(e={}){this.type="ambient";let{color:t=Yee}=e,{intensity:i=Kee}=e;this.id=e.id||`ambient-${Qee++}`,this.color=t,this.intensity=i}};var Jee=[255,255,255],ete=1,tte=[0,0,-1],rte=0,k_=class{constructor(e={}){this.type="directional";let{color:t=Jee}=e,{intensity:i=ete}=e,{direction:n=tte}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${rte++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new st(n).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}};var F_=class{constructor(e,t={id:"pass"}){let{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}};var gh=class extends F_{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[t,i]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,s=e.clearColor??(n?[0,0,0,0]:!1),a=n?1:!1,c=n?0:!1,d=e.colorMask??15,p={viewport:[0,0,t,i]};e.colorMask&&(p.colorMask=d),e.scissorRect&&(p.scissorRect=e.scissorRect);let b=this.device.beginRenderPass({framebuffer:e.target,parameters:p,clearColor:s,clearDepth:a,clearStencil:c});try{return this._drawLayers(b,e)}finally{b.end(),this.device.submit()}}_drawLayers(e,t){let{target:i,shaderModuleProps:n,viewports:s,views:a,onViewportActive:c,clearStack:d=!0}=t;t.pass=t.pass||"unknown",d&&(this._lastRenderIndex=-1);let p=[];for(let b of s){let T=a&&a[b.id];c?.(b);let B=this._getDrawLayerParams(b,t),z=b.subViewports||[b];for(let G of z){let Z=this._drawLayersInViewport(e,{target:i,shaderModuleProps:n,viewport:G,view:T,pass:t.pass,layers:t.layers},B);p.push(Z)}}return p}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:n=!1,layerFilter:s,cullRect:a,effects:c,shaderModuleProps:d},p=!1){let b=[],T=MO(this._lastRenderIndex+1),B={layer:t[0],viewport:e,isPicking:n,renderPass:i,cullRect:a},z={};for(let G=0;G<t.length;G++){let Z=t[G],q=this._shouldDrawLayer(Z,B,s,z),re={shouldDrawLayer:q};q&&!p&&(re.shouldDrawLayer=!0,re.layerRenderIndex=T(Z,q),re.shaderModuleProps=this._getShaderModuleProps(Z,c,i,d),re.layerParameters={...Z.context.deck?.props.parameters,...this.getLayerParameters(Z,G,e)}),b[G]=re}return b}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:n,target:s,viewport:a,view:c},d){let p=ite(this.device,{shaderModuleProps:i,target:s,viewport:a});if(c&&c.props.clear){let T=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:p,scissorRect:p},clearColor:T.color?[0,0,0,0]:!1,clearDepth:T.depth?1:!1}).end()}let b={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:p});for(let T=0;T<t.length;T++){let B=t[T],z=d[T],{shouldDrawLayer:G}=z;if(G&&B.props.pickable&&b.pickableCount++,B.isComposite&&b.compositeCount++,B.isDrawable&&z.shouldDrawLayer){let{layerRenderIndex:Z,shaderModuleProps:q,layerParameters:re}=z;b.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Z),q.project&&(q.project.viewport=a),B.context.renderPass=e;try{B._drawLayer({renderPass:e,shaderModuleProps:q,uniforms:{layerIndex:Z},parameters:re})}catch(ee){B.raiseError(ee,`drawing ${B} to ${n}`)}}}return b}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(i){let c=t.layer.id;if(c in n||(n[c]=i(t)),!n[c])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,n){let s=this.device.canvasContext.cssToDeviceRatio(),a=e.internalState?.propsInTransition||e.props,c={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(let d of t)PO(c,d.getShaderModuleProps?.(e,c));return PO(c,this.getShaderModuleProps(e,t,c),n)}};function MO(r=0,e={}){let t={},i=(n,s)=>{let a=n.props._offset,c=n.id,d=n.parent&&n.parent.id,p;if(d&&!(d in e)&&i(n.parent,!1),d in t){let b=t[d]=t[d]||MO(e[d],e);p=b(n,s),t[c]=b}else Number.isFinite(a)?(p=a+(e[d]||0),t[c]=null):p=r;return s&&p>=r&&(r=p+1),e[c]=p,p};return i}function ite(r,{shaderModuleProps:e,target:t,viewport:i}){let n=e?.project?.devicePixelRatio??r.canvasContext.cssToDeviceRatio(),[,s]=r.canvasContext.getDrawingBufferSize(),a=t?t.height:s,c=i;return[c.x*n,a-(c.y+c.height)*n,c.width*n,c.height*n]}function PO(r,...e){for(let t of e)if(t)for(let i in t)r[i]?Object.assign(r[i],t[i]):r[i]=t[i];return r}var N_=class extends gh{constructor(e,t){super(e,t);let i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),n=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:n})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],s=n.width*i,a=n.height*i,c=[1,1,1,1];(s!==t.width||a!==t.height)&&t.resize({width:s,height:a}),super.render({...e,clearColor:c,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}};var nte={color:[255,255,255],intensity:1},RO=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],ste=[0,0,0,200/255],S0=class{constructor(e={}){this.id="lighting-effect",this.shadowColor=ste,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(Mb),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(let t in e){let i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:n,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:e,layerFilter:t,viewports:i,onViewportActive:n,views:s,shaderModuleProps:{shadow:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){let i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},n={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(a=>a.getProjectedLight({layer:e})),pointLights:this.pointLights.map(a=>a.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:i,lighting:n,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(let t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Mb))}_calculateMatrices(){let e=[];for(let t of this.directionalLights){let i=new vr().lookAt({eye:new st(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){let i=new N_(e);this.shadowPasses[t]=i}}_applyDefaultLights(){let{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new Rb(nte),this.directionalLights.push(new k_(RO[0]),new k_(RO[1])))}};var ZC=class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:n,padding:s=0,copy:a=!1,initialize:c=!1,maxCount:d}){let p=n||e&&e.constructor||Float32Array,b=t*i+s;if(ArrayBuffer.isView(e)){if(b<=e.length)return e;if(b*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,b)}let T=1/0;d&&(T=d*i+s);let B=this._allocate(p,b,c,T);return e&&a?B.set(e):c||B.fill(0,0,4),this._release(e),B}release(e){this._release(e)}_allocate(e,t,i,n){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>n&&(s=n);let a=this._pool,c=e.BYTES_PER_ELEMENT*s,d=a.findIndex(p=>p.byteLength>=c);if(d>=0){let p=new e(a.splice(d,1)[0],0,s);return i&&p.fill(0),p}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;let t=this._pool,{buffer:i}=e,{byteLength:n}=i,s=t.findIndex(a=>a.byteLength>=n);s<0?t.push(i):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,i),t.length>this.opts.poolSize&&t.shift()}},hc=new ZC;function I0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function LO(r,e){let t=r%e;return t<0?e+t:t}function OO(r){return[r[12],r[13],r[14]]}function DO(r){return{left:C0(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:C0(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:C0(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:C0(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:C0(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:C0(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}var BO=new st;function C0(r,e,t,i){BO.set(r,e,t);let n=BO.len();return{distance:i/n,normal:new st(-r/n,-e/n,-t/n)}}function ote(r){return r-Math.fround(r)}var z_;function Bb(r,e){let{size:t=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:r.length,s=(n-i)/t;z_=hc.allocate(z_,s,{type:Float32Array,size:t*2});let a=i,c=0;for(;a<n;){for(let d=0;d<t;d++){let p=r[a++];z_[c+d]=p,z_[c+d+t]=ote(p)}c+=t*2}return z_.subarray(0,s*t*2)}function kO(r){let e=null,t=!1;for(let i of r)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}var ate=Math.PI/180,lte=I0(),FO=[0,0,0],cte={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function ute({width:r,height:e,orthographic:t,fovyRadians:i,focalDistance:n,padding:s,near:a,far:c}){let d=r/e,p=t?new vr().orthographic({fovy:i,aspect:d,focalDistance:n,near:a,far:c}):new vr().perspective({fovy:i,aspect:d,near:a,far:c});if(s){let{left:b=0,right:T=0,top:B=0,bottom:z=0}=s,G=ao((b+r-T)/2,0,r)-r/2,Z=ao((B+e-z)/2,0,e)-e/2;p[8]-=G*2/r,p[9]+=Z*2/e}return p}var Lb=class r{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||cte,this.focalDistance=e.focalDistance||1,this.position=e.position||FO,this.modelMatrix=e.modelMatrix||null;let{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ws.WEB_MERCATOR:Ws.WEB_MERCATOR_AUTO_OFFSET:Ws.IDENTITY}equals(e){return e instanceof r?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Bs(e.projectionMatrix,this.projectionMatrix)&&Bs(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){let i=this.projectPosition(e),n=E0(i,this.pixelProjectionMatrix),[s,a]=n,c=t?a:this.height-a;return e.length===2?[s,c]:[s,c,n[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){let[n,s,a]=e,c=t?s:this.height-s,d=i&&i*this.distanceScales.unitsPerMeter[2],p=Wf([n,c,a],this.pixelUnprojectionMatrix,d),[b,T,B]=this.unprojectPosition(p);return Number.isFinite(a)?[b,T,B]:Number.isFinite(i)?[b,T,i]:[b,T]}projectPosition(e){let[t,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,n]}unprojectPosition(e){let[t,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,n]}projectFlat(e){if(this.isGeospatial){let t=$s(e);return t[1]=ao(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Lo(e):e}getBounds(e={}){let t={targetZ:e.z||0},i=this.unproject([0,0],t),n=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(i[0],n[0],s[0],a[0]),Math.min(i[1],n[1],s[1],a[1]),Math.max(i[0],n[0],s[0],a[0]),Math.max(i[1],n[1],s[1],a[1])]}getDistanceScales(e){return e&&this.isGeospatial?T0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:n=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,DO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){let t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=WC({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||T0({latitude:i,longitude:t}));let n=Math.pow(2,this.zoom);this.scale=n;let{position:s,modelMatrix:a}=e,c=FO;if(s&&(c=a?new vr(a).transformAsVector(s,[]):s),this.isGeospatial){let d=this.projectPosition([t,i,0]);this.center=new st(c).scale(this.distanceScales.unitsPerMeter).add(d)}else this.center=this.projectPosition(c)}_initMatrices(e){let{viewMatrix:t=lte,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:s,fovy:a=75,near:c=.1,far:d=1e3,padding:p=null,focalDistance:b=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new vr().multiplyRight(t).translate(new st(this.center).negate()),this.projectionMatrix=i||ute({width:this.width,height:this.height,orthographic:n,fovyRadians:s||a*ate,focalDistance:b,padding:p,near:c,far:d});let T=I0();ms.multiply(T,T,this.projectionMatrix),ms.multiply(T,T,this.viewMatrix),this.viewProjectionMatrix=T,this.viewMatrixInverse=ms.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=OO(this.viewMatrixInverse);let B=I0(),z=I0();ms.scale(B,B,[this.width/2,-this.height/2,1]),ms.translate(B,B,[1,-1,0]),ms.multiply(z,B,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=ms.invert(I0(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||cr.warn("Pixel project matrix not invertible")()}};Lb.displayName="Viewport";var Ha=Lb;var Ob=class r extends Ha{constructor(e={}){let{latitude:t=0,longitude:i=0,zoom:n=0,pitch:s=0,bearing:a=0,nearZMultiplier:c=.1,farZMultiplier:d=1.01,nearZ:p,farZ:b,orthographic:T=!1,projectionMatrix:B,repeat:z=!1,worldOffset:G=0,position:Z,padding:q,legacyMeterSizes:re=!1}=e,{width:ee,height:ae,altitude:me=1.5}=e,Le=Math.pow(2,n);ee=ee||1,ae=ae||1;let je,Je=null;if(B)me=B[5]/2,je=mh(me);else{e.fovy?(je=e.fovy,me=Cp(je)):je=mh(me);let te;if(q){let{top:X=0,bottom:ye=0}=q;te=[0,ao((X+ae-ye)/2,0,ae)-ae/2]}Je=$C({width:ee,height:ae,scale:Le,center:Z&&[0,0,Z[2]*Sp(t)],offset:te,pitch:s,fovy:je,nearZMultiplier:c,farZMultiplier:d}),Number.isFinite(p)&&(Je.near=p),Number.isFinite(b)&&(Je.far=b)}let J=Cb({height:ae,pitch:s,bearing:a,scale:Le,altitude:me});G&&(J=new vr().translate([512*G,0,0]).multiplyLeft(J)),super({...e,width:ee,height:ae,viewMatrix:J,longitude:i,latitude:t,zoom:n,...Je,fovy:je,focalDistance:me}),this.latitude=t,this.longitude=i,this.zoom=n,this.pitch=s,this.bearing=a,this.altitude=me,this.fovy=je,this.orthographic=T,this._subViewports=z?[]:null,this._pseudoMeters=re,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=t;n<=i;n++){let s=n?new r({...this,worldOffset:n}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[t,i]=this.projectFlat(e),n=(e[2]||0)*Sp(e[1]);return[t,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[t,i]=this.unprojectFlat(e),n=(e[2]||0)/Sp(i);return[t,i,n]}addMetersToLngLat(e,t){return D_(e,t)}panByPosition(e,t){let i=Wf(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),s=cu.add([],n,cu.negate([],i)),a=cu.add([],this.center,s),[c,d]=this.unprojectFlat(a);return{longitude:c,latitude:d}}getBounds(e={}){let t=Pb(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){let{width:i,height:n}=this,{longitude:s,latitude:a,zoom:c}=Ib({width:i,height:n,bounds:e,...t});return new r({width:i,height:n,longitude:s,latitude:a,zoom:c})}};Ob.displayName="WebMercatorViewport";var fu=Ob;var NO=[0,0,0];function XC(r,e,t=!1){let i=e.projectPosition(r);if(t&&e instanceof fu){let[n,s,a=0]=r,c=e.getDistanceScales([n,s]);i[2]=a*c.unitsPerMeter[2]}return i}function hte(r){let{viewport:e,modelMatrix:t,coordinateOrigin:i}=r,{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return n===br.DEFAULT&&(n=e.isGeospatial?br.LNGLAT:br.CARTESIAN),s===void 0&&(s=n),a===void 0&&(a=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function YC(r,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:n,offsetMode:s}){let[a,c,d=0]=r;switch(t&&([a,c,d]=Aa.transformMat4([],[a,c,d,1],t)),i){case br.LNGLAT:return XC([a,c,d],e,s);case br.LNGLAT_OFFSETS:return XC([a+n[0],c+n[1],d+(n[2]||0)],e,s);case br.METER_OFFSETS:return XC(D_(n,[a,c,d]),e,s);case br.CARTESIAN:default:return e.isGeospatial?[a+n[0],c+n[1],d+n[2]]:e.projectPosition([a,c,d])}}function zO(r,e){let{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:c}=hte(e),{autoOffset:d=!0}=e,{geospatialOrigin:p=NO,shaderCoordinateOrigin:b=NO,offsetMode:T=!1}=d?UC(t,i,n):{},B=YC(r,{viewport:t,modelMatrix:s,coordinateSystem:a,coordinateOrigin:c,offsetMode:T});if(T){let z=t.projectPosition(p||b);To.sub(B,B,z)}return B}var fte=1,dte=1,Ip=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:s=1}=e,a=fte++,c={time:0,delay:t,duration:i,rate:n,repeat:s};return this._setChannelTime(c,this.time),this.channels.set(a,c),a}removeChannel(e){this.channels.delete(e);for(let[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){let t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;let t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);let t=this.channels.values();for(let n of t)this._setChannelTime(n,this.time);let i=this.animations.values();for(let n of i){let{animation:s,channel:a}=n;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){let i=dte++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){let i=t-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}};function UO(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function VO(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}var pte=0,Ate={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:r=>console.error(r),stats:s0.stats.get(`animation-loop-${pte++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},U_=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Ate,...e},e=this.props,!e.device)throw new Error("No device provided");let{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Mo({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){let i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){let t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=UO(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(VO(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);let i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1],i=1,n=this.device?.canvasContext?.canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};var KC={};function yl(r="id"){KC[r]=KC[r]||1;let e=KC[r]++;return`${r}-${e}`}var Db=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||yl("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Hi.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(let e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}};function jO(r,e){if(e instanceof Db)return e;let t=mte(r,e),{attributes:i,bufferLayout:n}=gte(r,e);return new Db({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:t,attributes:i})}function mte(r,e){if(!e.indices)return;let t=e.indices.value;return r.createBuffer({usage:Hi.INDEX,data:t})}function gte(r,e){let t=[],i={};for(let[s,a]of Object.entries(e.attributes)){let c=s;switch(s){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(a){i[c]=r.createBuffer({data:a.value,id:`${s}-buffer`});let{value:d,size:p,normalized:b}=a;t.push({name:c,format:uS(d,p,b)})}}let n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:n}}var kb=class r{static defaultProps={...su.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new r(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){let t={...su.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){let n=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});n.hash=i,this._renderPipelineCache[i]={pipeline:n,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){let t={...o0.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){let n=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});n.hash=i,this._computePipelineCache[i]={pipeline:n,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){let t=e.hash,i=e instanceof o0?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,i[t].useCount===0&&this.destroyPolicy==="unused"&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){let t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,n="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${i}V${n}BL${s}`;default:let a=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V${n}T${e.topology}P${a}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};var Fb=class r{static defaultProps={...hp.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new r(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){let t=this._hashShader(e),i=this._cache[t];if(!i){let n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:n,useCount:0}}return i.useCount++,i.shader}release(e){let t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};function GO(r,e){let t={},i="Values";if(r.attributes.length===0&&!r.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(let n of r.attributes)if(n){let s=`${n.location} ${n.name}: ${n.type}`;t[`in ${s}`]={[i]:n.stepMode||"vertex"}}for(let n of r.varyings||[]){let s=`${n.location} ${n.name}`;t[`out ${s}`]={[i]:JSON.stringify(n)}}return t}var co=null,QC=null;function HO(r,{id:e,minimap:t,opaque:i,top:n="0",left:s="0",rgbaScale:a=1}){co||(co=document.createElement("canvas"),co.id=e,co.title=e,co.style.zIndex="100",co.style.position="absolute",co.style.top=n,co.style.left=s,co.style.border="blue 5px solid",co.style.transform="scaleY(-1)",document.body.appendChild(co),QC=co.getContext("2d")),(co.width!==r.width||co.height!==r.height)&&(co.width=r.width/2,co.height=r.height/2,co.style.width="400px",co.style.height="400px");let c=r.device.readPixelsToArrayWebGL(r),d=QC?.createImageData(r.width,r.height);if(d){for(let b=0;b<c.length;b+=4)d.data[0+b+0]=c[b+0]*a,d.data[0+b+1]=c[b+1]*a,d.data[0+b+2]=c[b+2]*a,d.data[0+b+3]=i?255:c[b+3]*a;QC?.putImageData(d,0,0)}}function Nb(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Nb(r[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){let i=Object.keys(r),n=Object.keys(e);if(i.length!==n.length)return!1;for(let s of i)if(!e.hasOwnProperty(s)||!Nb(r[s],e[s],t-1))return!1;return!0}return!1}function WO(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function $O(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function V_(r){return WO(r)||$O(r)}function _te(r){return V_(r)||typeof r=="number"||typeof r=="boolean"}function zb(r){let e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{let i=r[t];_te(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}var Ub=class{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);let i=i0(Object.values(e).filter(n=>n.dependencies));for(let n of i)e[n.name]=n;Vt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(let[n,s]of Object.entries(e))this._addModule(s),s.name&&n!==s.name&&!this.options.disableWarnings&&Vt.warn(`Module name: ${n} vs ${s.name}`)()}destroy(){}setProps(e){for(let t of Object.keys(e)){let i=t,n=e[i]||{},s=this.modules[i];if(!s){this.options.disableWarnings||Vt.warn(`Module ${t} not found`)();continue}let a=this.moduleUniforms[i],c=this.moduleBindings[i],d=s.getUniforms?.(n,a)||n,{uniforms:p,bindings:b}=zb(d);this.moduleUniforms[i]={...a,...p},this.moduleBindings[i]={...c,...b}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){let e={};for(let[t,i]of Object.entries(this.moduleUniforms))for(let[n,s]of Object.entries(i))e[`${t}.${n}`]={type:this.modules[t].uniformTypes?.[n],value:String(s)};return e}_addModule(e){let t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}};var yte="";async function qO(r,e){let t=new Image;return t.crossOrigin=e?.crossOrigin||"anonymous",t.src=r.startsWith("http")?r:yte+r,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}var P0=class{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||yl("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:qO(t.data)}),this.ready=new Promise((i,n)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=n}),this.initAsync(t)}async initAsync(e){let t=e.data,i;try{i=await ZO(t)}catch(s){this.rejectReady(s)}if(this.destroyed)return;let n={...e,data:i};this.texture=this.device.createTexture(n),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}};async function ZO(r){if(r=await r,Array.isArray(r))return await Promise.all(r.map(ZO));if(r&&typeof r=="object"&&r.constructor===Object){let e=r,t=await Promise.all(Object.values(e)),i=Object.keys(e),n={};for(let s=0;s<i.length;s++)n[i[s]]=t[s];return n}return r}var Pp=2,xte=1e4,hi=class r{static defaultProps={...su.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:cp.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...r.defaultProps,...t},t=this.props,this.id=t.id||yl("model"),this.device=e,Object.assign(this.userData,t.userData);let i=Object.fromEntries(this.props.modules?.map(d=>[d.name,d])||[]),n=t.shaderInputs||new Ub(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(n);let s=vte(e),a=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){let{source:d,getUniforms:p}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:a});this.source=d,this._getModuleUniforms=p,this.props.shaderLayout||=DS(this.source)}else{let{vs:d,fs:p,getUniforms:b}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:a});this.vs=d,this.fs=p,this._getModuleUniforms=b}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||kb.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Fb.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let t=this._areBindingsLoading();if(t)return Vt.info(Pp,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let n=this._getBindings();this.pipeline.setBindings(n,{disableWarnings:this.props.disableWarnings}),JC(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:s}=this.vertexArray,a=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();let t=e&&jO(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");let i=new pp(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let t=new pp(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Nb(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new a_(this.shaderInputs.modules);for(let[t,i]of Object.entries(this.shaderInputs.modules))if(bte(i)){let n=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){let i=t?.disableWarnings??this.props.disableWarnings;e.indices&&Vt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=hS(this.pipeline.shaderLayout,this.bufferLayout);let n=new pp(this.bufferLayout);for(let[s,a]of Object.entries(e)){let c=n.getBufferLayout(s);if(!c){i||Vt.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}let d=n.getAttributeNamesForBuffer(c),p=!1;for(let b of d){let T=this._attributeInfos[b];if(T){let B=this.device.type==="webgpu"?n.getBufferIndex(T.bufferName):T.location;this.vertexArray.setBuffer(B,a),p=!0}}!p&&!i&&Vt.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(let[i,n]of Object.entries(e)){let s=this._attributeInfos[i];s?this.vertexArray.setConstantWebGL(s.location,n):(t?.disableWarnings??this.props.disableWarnings)||Vt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){JC(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){let{bindings:t,uniforms:i}=zb(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof P0&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[t,i]of Object.entries(this.bindings))i instanceof P0?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(let t of Object.values(this.bindings))t instanceof up?e=Math.max(e,t.texture.updateTimestamp):t instanceof Hi||t instanceof tn?e=Math.max(e,t.updateTimestamp):t instanceof P0?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof fp||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let t={...e.attributes};for(let[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Vt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:n}),this._attributeInfos=g2(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=Vt.level>3?0:xte;Vt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Vt.group(Pp,`>>> DRAWING MODEL ${this.id}`,{collapsed:Vt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=GO(this.pipeline.shaderLayout,this.id);Vt.table(Pp,e)();let t=this.shaderInputs.getDebugTable();for(let[n,s]of Object.entries(this.uniforms))t[n]={value:s};Vt.table(Pp,t)();let i=this._getAttributeDebugTable();Vt.table(Pp,this._attributeInfos)(),Vt.table(Pp,i)(),Vt.groupEnd(Pp)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;let i=e.props.framebuffer;i&&HO(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[t,i]of Object.entries(this._attributeInfos)){let n=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:n?this._getBufferOrConstantValues(n,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){let i=l_(t);return(e instanceof Hi?new i(e.debugData):e).toString()}};function bte(r){return!!(r.uniformTypes&&!JC(r.uniformTypes))}function vte(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function JC(r){for(let e in r)return!1;return!0}var du=class r{device;model;transformFeedback;static defaultProps={...hi.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=r.defaultProps){if(!r.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new hi(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||Xg(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Hi)return t.readAsync();let{buffer:i,byteOffset:n=0,byteLength:s=i.byteLength}=t;return i.readAsync(n,s)}};var wte="transform_output",M0=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,t){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new hi(this.device,{id:t.id||"texture-transform-model",fs:t.fs||Xg({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:wte}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){this.model.destroy();for(let e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){let{framebuffer:t}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(i),i.end()}getTargetTexture(){let{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:i,targetTexture:n}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,t),n){e.targetTexture=n;let{width:s,height:a}=n;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:s,height:a,colorAttachments:[n]}),e.framebuffer.resize({width:s,height:a})}return e}_setSourceTextureParameters(){let e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(let i in t)t[i].sampler=this.sampler}};var Xi=class{id;topology;vertexCount;indices;attributes;userData={};constructor(e){let{attributes:t={},indices:i=null,vertexCount:n=null}=e;this.id=e.id||yl("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(let[s,a]of Object.entries(t)){let c=ArrayBuffer.isView(a)?{value:a}:a;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!c.size&&(c.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[s]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(let n of Object.values(e)){let{value:s,size:a,constant:c}=n;!c&&s&&a!==void 0&&a>=1&&(i=Math.min(i,s.length/a))}return i}};var pu=class{id;matrix=new vr;display=!0;position=new st;rotation=new st;scale=new st(1,1,1);userData={};props={};constructor(e={}){let{id:t}=e;this.id=t||yl(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:i,scale:n,update:s=!0}=e;return t&&this.setPosition(t),i&&this.setRotation(i),n&&this.setScale(n),s&&this.updateMatrix(),this}updateMatrix(){let e=this.position,t=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(i),this}update(e={}){let{position:t,rotation:i,scale:n}=e;return t&&this.setPosition(t),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;let i=new vr(e).multiplyRight(t),n=i.invert(),s=n.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}};var _h=class r extends pu{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;let{children:t=[]}=e;Vt.assert(t.every(i=>i instanceof pu),"every child must an instance of ScenegraphNode"),super(e),this.children=t}getBounds(){let e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,{worldMatrix:i})=>{let n=t.getBounds();if(!n)return;let[s,a]=n,c=new st(s).add(a).divide([2,2,2]);i.transformAsPoint(c,c);let d=new st(a).subtract(s).divide([2,2,2]);i.transformAsVector(d,d);for(let p=0;p<8;p++){let b=new st(p&1?-1:1,p&2?-1:1,p&4?-1:1).multiply(d).add(c);for(let T=0;T<3;T++)e[0][T]=Math.min(e[0][T],b[T]),e[1][T]=Math.max(e[1][T],b[T])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(let t of e)Array.isArray(t)?this.add(...t):this.children.push(t);return this}remove(e){let t=this.children,i=t.indexOf(e);return i>-1&&t.splice(i,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:t=new vr}={}){let i=new vr(t).multiplyRight(this.matrix);for(let n of this.children)n instanceof r?n.traverse(e,{worldMatrix:i}):e(n,{worldMatrix:i})}};var $f=class extends pu{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}};var Mp=class extends Xi{constructor(e={}){let{id:t=yl("cube-geometry"),indices:i=!0}=e;super(i?{...e,id:t,topology:"triangle-list",indices:{size:1,value:Tte},attributes:{...Rte,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...Bte,...e.attributes}})}},Tte=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Ete=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),Ste=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Cte=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Ite=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),Pte=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),Mte=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),Rte={POSITION:{size:3,value:Ete},NORMAL:{size:3,value:Ste},TEXCOORD_0:{size:2,value:Cte}},Bte={POSITION:{size:3,value:Ite},TEXCOORD_0:{size:2,value:Pte},COLOR_0:{size:3,value:Mte}};var Lte={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},Rp=class extends gh{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:n,onViewportActive:s,pickingFBO:a,deviceRect:{x:c,y:d,width:p,height:b},cullRect:T,effects:B,pass:z="picking",pickZ:G,shaderModuleProps:Z}){this.pickZ=G;let q=this._resetColorEncoder(G),re=[c,d,p,b],ee=super.render({target:a,layers:e,layerFilter:t,views:i,viewports:n,onViewportActive:s,cullRect:T,effects:B?.filter(me=>me.useInPicking),pass:z,isPicking:!0,shaderModuleProps:Z,clearColor:[0,0,0,0],colorMask:15,scissorRect:re});return this._colorEncoderState=null,{decodePickingColor:q&&Dte.bind(null,q),stats:ee}}shouldDrawLayer(e){let{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){let n={...e.props.parameters},{pickable:s,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?n.blend=!1:s&&a.includes("draw")&&(Object.assign(n,Lte),n.blend=!0,n.blendColor=Ote(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function Ote(r,e,t){let{byLayer:i,byAlpha:n}=r,s,a=i.get(e);return a?(a.viewports.push(t),s=a.a):(s=i.size+1,s<=255?(a={a:s,layer:e,viewports:[t]},i.set(e,a),n[s]=a):(cr.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function Dte(r,e){let t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}var qf={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},R0=Symbol.for("component"),xl=Symbol.for("propTypes"),Vb=Symbol.for("deprecatedProps"),yh=Symbol.for("asyncPropDefaults"),Au=Symbol.for("asyncPropOriginal"),fc=Symbol.for("asyncPropResolved");function ma(r,e=()=>!0){return Array.isArray(r)?XO(r,e,[]):e(r)?[r]:[]}function XO(r,e,t){let i=-1;for(;++i<r.length;){let n=r[i];Array.isArray(n)?XO(n,e,t):e(n)&&t.push(n)}return t}function e4({target:r,source:e,start:t=0,count:i=1}){let n=e.length,s=i*n,a=0;for(let c=t;a<n;a++)r[c++]=e[a];for(;a<s;)a<s-a?(r.copyWithin(t+a,t,t+a),a*=2):(r.copyWithin(t+a,t,t+s-a),a=s);return r}var j_=class{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;let i=++this._loadCount,n=e;typeof e=="string"&&(n=oo(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(let s of this._subscribers)s.onChange(this.getData())}};var G_=class{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:n=!0}){let s=this._resources[e];s?s.setData(t,i):(s=new j_(e,t,this._context),this._resources[e]=s),s.persistent=n}remove(e){let t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let t=this._consumers[e];if(t){for(let i in t){let n=t[i],s=this._resources[n.resourceId];s&&s.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:n="default"}){let{_resources:s,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));let c=s[e];if(this._track(i,n,c,t),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,t,i,n){let s=this._consumers,a=s[e]=s[e]||{},c=a[t],d=c&&c.resourceId&&this._resources[c.resourceId];d&&(d.unsubscribe(c),this.prune()),i&&(c?(c.onChange=n,c.resourceId=i.id):c={onChange:n,resourceId:i.id},a[t]=c,i.subscribe(c))}_prune(){this._pruneRequest=null;for(let e of Object.keys(this._resources)){let t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}};var kte="layerManager.setLayers",Fte="layerManager.activateViewport",H_=class{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{is(Fte,this,c),c&&(this.context.viewport=c)};let{deck:i,stats:n,viewport:s,timeline:a}=t||{};this.layers=[],this.resourceManager=new G_({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:IO(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[MC],renderPass:void 0,stats:n||new Mo({id:"deck.gl"}),viewport:s||new Ha({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new Ip,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(let i of this.layers){let n=i.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){is(kte,this,t,e),this._lastRenderedLayers=e;let i=ma(e,Boolean);for(let n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:t}=this.context,i=t.findIndex(n=>n.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){let i={};for(let a of e)i[a.id]?cr.warn(`Multiple old layers with same id ${a.id}`)():i[a.id]=a;if(this._defaultShaderModulesChanged){for(let a of e)a.setNeedsUpdate(),a.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let n=[];this._updateSublayersRecursively(t,i,n),this._finalizeOldLayers(i);let s=!1;for(let a of n)if(a.hasUniformTransition()){s=`Uniform transition in ${a}`;break}this._needsUpdate=s,this.layers=n}_updateSublayersRecursively(e,t,i){for(let n of e){n.context=this.context;let s=t[n.id];s===null&&cr.warn(`Multiple new layers with same id ${n.id}`)(),t[n.id]=null;let a=null;try{this._debug&&s!==n&&n.validateProps(),s?(this._transferLayerState(s,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),a=n.isComposite?n.getSubLayers():null}catch(c){this._handleError("matching",c,n)}a&&this._updateSublayersRecursively(a,t,i)}}_finalizeOldLayers(e){for(let t in e){let i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=qf.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=qf.MATCHED,t!==e&&(e.lifecycle=qf.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=qf.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=qf.FINALIZED}catch(t){this._handleError("finalization",t,e)}}};function hn(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!hn(r[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){let i=Object.keys(r),n=Object.keys(e);if(i.length!==n.length)return!1;for(let s of i)if(!e.hasOwnProperty(s)||!hn(r[s],e[s],t-1))return!1;return!0}return!1}var W_=class{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){let t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){let i=this.getViewports(),n={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){let a=i[s];if(a.containsPixel(n)){let c=e.slice();return c[0]-=a.x,c[1]-=a.y,a.unproject(c,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=ma(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!hn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):cr.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){let i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,t,i,n){let s=e.controller;if(s&&i){let a={...t,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==s.type)&&(n=this._createController(e,a)),n&&n.setProps(a),n}return null}_rebuildViewports(){let{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){let s=e[n],a=this.getViewState(s),c=s.makeViewport({viewState:a,width:this.width,height:this.height}),d=t[s.id],p=!!s.controller;p&&!d&&(i=!0),(i||!p)&&d&&(d.finalize(),d=null),this.controllers[s.id]=this._updateController(s,a,c,d),c&&this._viewports.unshift(c)}for(let n in t){let s=t[n];s&&!this.controllers[n]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,n)=>!e[n].equals(t[n]))}};var Nte=/([0-9]+\.?[0-9]*)(%|px)/;function xh(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":let e=Nte.exec(r);if(e&&e.length>=3){let t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function bh(r,e){return r.relative?Math.round(r.position*e):r.position}var Bp=class{constructor(e){let{id:t,x:i=0,y:n=0,width:s="100%",height:a="100%",padding:c=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=xh(i),this._y=xh(n),this._width=xh(s),this._height=xh(a),this._padding=c&&{left:xh(c.left||0),right:xh(c.right||0),top:xh(c.top||0),bottom:xh(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&hn(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);let n=this.getDimensions({width:e,height:t});if(!n.height||!n.width)return null;let s=this.getViewportType(i);return new s({...i,...this.props,...n})}getViewStateId(){let{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let t={...e};for(let i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){let i={x:bh(this._x,e),y:bh(this._y,t),width:bh(this._width,e),height:bh(this._height,t)};return this._padding&&(i.padding={left:bh(this._padding.left,e),top:bh(this._padding.top,t),right:bh(this._padding.right,e),bottom:bh(this._padding.bottom,t)}),i}get controller(){let e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}};var dc=class{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var YO=()=>{},t4={BREAK:1,SNAP_TO_END:2,IGNORE:3},zte=r=>r,Ute=t4.BREAK,$_=class{constructor(e){this._onTransitionUpdate=t=>{let{time:i,settings:{interpolator:n,startProps:s,endProps:a,duration:c,easing:d}}=t,p=d(i/c),b=n.interpolateProps(s,a,p);this.propsInTransition=this.getControllerState({...this.props,...b}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new dc(e.timeline),this.onViewStateChange=e.onViewStateChange||YO,this.onStateChange=e.onStateChange||YO}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){let{interruption:s,endProps:a}=this.transition.settings;n={...i,...s===t4.SNAP_TO_END?a:this.propsInTransition||i}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===t4.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){let i=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(i),s=t.transitionInterpolator,a=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(a===0)return;let c=s.initializeProps(e,n);this.propsInTransition={};let d={duration:a,easing:t.transitionEasing||zte,interpolator:s,interruption:t.transitionInterruption||Ute,startProps:c.start,endProps:c.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(d),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}};function An(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}var q_=class{constructor(e){let{compare:t,extract:i,required:n}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=n}arePropsEqual(e,t){for(let i of this._propsToCompare)if(!(i in e)||!(i in t)||!Bs(e[i],t[i]))return!1;return!0}initializeProps(e,t){let i={},n={};for(let s of this._propsToExtract)(s in e||s in t)&&(i[s]=e[s],n[s]=t[s]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{let i=e[t];An(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}};var Vte=["longitude","latitude","zoom","bearing","pitch"],jte=["longitude","latitude","zoom"],vh=class extends q_{constructor(e={}){let t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Vte,required:jte},super(i.transitionProps),this.opts=i}initializeProps(e,t){let i=super.initializeProps(e,t),{makeViewport:n,around:s}=this.opts;if(n&&s){let a=n(e),c=n(t),d=a.unproject(s);i.start.around=s,Object.assign(i.end,{around:c.project(d),aroundPosition:d,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){let n={};for(let s of this._propsToExtract)n[s]=wo(e[s]||0,t[s]||0,i);if(t.aroundPosition&&this.opts.makeViewport){let s=this.opts.makeViewport({...t,...n});Object.assign(n,s.panByPosition(t.aroundPosition,wo(e.around,t.around,i)))}return n}};var Zf={transitionDuration:0},Gte=300,jb=r=>1-(1-r)*(1-r),B0={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Lp={},Op=class{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new $_({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:t,y:i}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-i]}isPointInBounds(e,t){let{width:i,height:n}=this.props;if(t&&t.handled)return!1;let s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){let{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?Gte:0;let{scrollZoom:i=!0,dragPan:n=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:c=!0,touchRotate:d=!1,keyboard:p=!0}=e,b=!!this.onViewStateChange;this.toggleEvents(B0.WHEEL,b&&i),this.toggleEvents(B0.PAN,b),this.toggleEvents(B0.PINCH,b&&(c||d)),this.toggleEvents(B0.MULTI_PAN,b&&d),this.toggleEvents(B0.DOUBLE_CLICK,b&&a),this.toggleEvents(B0.KEYBOARD,b&&p),this.scrollZoom=i,this.dragPan=n,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=c,this.touchRotate=d,this.keyboard=p}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){let n={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){let a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);let n=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(n,Zf,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;let t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Zf,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:t}=this;if(this.dragPan&&t&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:jb},{isDragging:!1,isPanning:!0})}else{let i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Zf,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:jb},{isDragging:!1,isRotating:!0})}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();let{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e,a=2/(1+Math.exp(-Math.abs(s*i)));s<0&&a!==0&&(a=1/a);let c=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(c,{...this._getTransitionProps({around:t}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Zf,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let t=this.getCenter(e);t[0]-=e.deltaX;let i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Zf,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){let i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:n});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:jb},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Lp._startPinchRotation=e.rotation,Lp._lastPinchEvent=e,this.updateViewport(i,Zf,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){let{scale:i}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:i})}if(this.touchRotate){let{rotation:i}=e;t=t.rotate({deltaAngleX:Lp._startPinchRotation-i})}return this.updateViewport(t,Zf,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Lp._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this,{_lastPinchEvent:i}=Lp;if(this.touchZoom&&t&&i&&e.scale!==i.scale){let n=this.getCenter(e),s=this.controllerState.rotateEnd(),a=Math.log2(e.scale),c=(a-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),d=Math.pow(2,a+c*t/2);s=s.zoom({pos:n,scale:d}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:jb},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{let n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Lp._startPinchRotation=null,Lp._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;let t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this,d,p={};switch(e.srcEvent.code){case"Minus":d=t?c.zoomOut(i).zoomOut(i):c.zoomOut(i),p.isZooming=!0;break;case"Equal":d=t?c.zoomIn(i).zoomIn(i):c.zoomIn(i),p.isZooming=!0;break;case"ArrowLeft":t?(d=c.rotateLeft(s),p.isRotating=!0):(d=c.moveLeft(n),p.isPanning=!0);break;case"ArrowRight":t?(d=c.rotateRight(s),p.isRotating=!0):(d=c.moveRight(n),p.isPanning=!0);break;case"ArrowUp":t?(d=c.rotateUp(a),p.isRotating=!0):(d=c.moveUp(n),p.isPanning=!0);break;case"ArrowDown":t?(d=c.rotateDown(a),p.isRotating=!0):(d=c.moveDown(n),p.isPanning=!0);break;default:return!1}return this.updateViewport(d,this._getTransitionProps(),p),!0}_getTransitionProps(e){let{transition:t}=this;return!t||!t.transitionInterpolator?Zf:e?{...t,transitionInterpolator:new vh({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}};var Z_=class{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}};var KO=5,Hte=1.2,X_=class extends Z_{constructor(e){let{width:t,height:i,latitude:n,longitude:s,zoom:a,bearing:c=0,pitch:d=0,altitude:p=1.5,position:b=[0,0,0],maxZoom:T=20,minZoom:B=0,maxPitch:z=60,minPitch:G=0,startPanLngLat:Z,startZoomLngLat:q,startRotatePos:re,startBearing:ee,startPitch:ae,startZoom:me,normalize:Le=!0}=e;An(Number.isFinite(s)),An(Number.isFinite(n)),An(Number.isFinite(a)),super({width:t,height:i,latitude:n,longitude:s,zoom:a,bearing:c,pitch:d,altitude:p,maxZoom:T,minZoom:B,maxPitch:z,minPitch:G,normalize:Le,position:b},{startPanLngLat:Z,startZoomLngLat:q,startRotatePos:re,startBearing:ee,startPitch:ae,startZoom:me}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){let i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;let s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){let{startRotatePos:n,startBearing:s,startPitch:a}=this.getState();if(!n||s===void 0||a===void 0)return this;let c;return e?c=this._getNewRotation(e,n,a,s):c={bearing:s+t,pitch:a+i},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:n,startZoomLngLat:s}=this.getState();if(s||(n=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;let{maxZoom:a,minZoom:c}=this.getViewportProps(),d=n+Math.log2(i);d=ao(d,c,a);let p=this.makeViewport({...this.getViewportProps(),zoom:d});return this._getUpdatedState({zoom:d,...p.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:s}=i;return Math.abs(n-t.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(s-t.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=ao(n,i,t);let{maxPitch:s,minPitch:a,pitch:c}=e;e.pitch=ao(c,a,s);let{normalize:d=!0}=e;return d&&Object.assign(e,qC(e)),e}_zoomFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,n){let s=e[0]-t[0],a=e[1]-t[1],c=e[1],d=t[1],{width:p,height:b}=this.getViewportProps(),T=s/p,B=0;a>0?Math.abs(b-d)>KO&&(B=a/(d-b)*Hte):a<0&&d>KO&&(B=1-c/d),B=ao(B,-1,1);let{minPitch:z,maxPitch:G}=this.getViewportProps(),Z=n+180*T,q=i;return B>0?q=i+B*(G-i):B<0&&(q=i-B*(z-i)),{pitch:q,bearing:Z}}},Y_=class extends Op{constructor(){super(...arguments),this.ControllerState=X_,this.transition={transitionDuration:300,transitionInterpolator:new vh({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};var Gb=class extends Bp{constructor(e={}){super(e)}getViewportType(){return fu}get ControllerType(){return Y_}};Gb.displayName="MapView";var K_=Gb;var Wte=new S0;function $te(r,e){let t=r.order??1/0,i=e.order??1/0;return t-i}var Q_=class{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){let i=t.findIndex(n=>$te(n,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(hn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){let t={};for(let n of this.effects)t[n.id]=n;let i=[];for(let n of e){let s=t[n.id],a=n;s&&s!==n?s.setProps?(s.setProps(n.props),a=s):s.cleanup(this._context):s||n.setup(this._context),i.push(a),delete t[n.id]}for(let n in t)t[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof S0)||this._resolvedEffects.push(Wte),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var J_=class extends gh{shouldDrawLayer(e){let{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}};var qte="deckRenderer.renderLayers",e1=class{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new J_(e),this.pickLayersPass=new Rp(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);let n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);let s=t.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,is(qte,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){let{renderBuffers:e}=this;for(let t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(let i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{let n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[n]}))});for(let i of e)i.resize(t)}_postRender(e,t){let{renderBuffers:i}=this,n={...t,inputBuffer:i[0],swapBuffer:i[1]};for(let s of e)if(s.postRender){n.target=s.id===this.lastPostProcessEffect?t.target:void 0;let a=s.postRender(n);n.inputBuffer=a,n.swapBuffer=a===i[0]?i[1]:i[0]}}};var Zte={pickedColor:null,pickedObjectIndex:-1};function QO({pickedColors:r,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:n,deviceRect:s}){let{x:a,y:c,width:d,height:p}=s,b=n*n,T=-1,B=0;for(let z=0;z<p;z++){let G=z+c-i,Z=G*G;if(Z>b)B+=4*d;else for(let q=0;q<d;q++){if(r[B+3]-1>=0){let ee=q+a-t,ae=ee*ee+Z;ae<=b&&(b=ae,T=B)}B+=4}}if(T>=0){let z=r.slice(T,T+4),G=e(z);if(G){let Z=Math.floor(T/4/d),q=T/4-Z*d;return{...G,pickedColor:z,pickedX:a+q,pickedY:c+Z}}cr.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Zte}function JO({pickedColors:r,decodePickingColor:e}){let t=new Map;if(r){for(let i=0;i<r.length;i+=4)if(r[i+3]-1>=0){let s=r.slice(i,i+4),a=s.join(",");if(!t.has(a)){let c=e(s);c?t.set(a,{...c,color:s}):cr.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function r4({pickInfo:r,viewports:e,pixelRatio:t,x:i,y:n,z:s}){let a=e[0];e.length>1&&(a=Xte(r?.pickedViewports||e,{x:i,y:n}));let c;if(a){let d=[i-a.x,n-a.y];s!==void 0&&(d[2]=s),c=a.unproject(d)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:c,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:t}}function eD(r){let{pickInfo:e,lastPickedInfo:t,mode:i,layers:n}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:c}=e,d=a?[a]:[];if(i==="hover"){let T=t.index,B=t.layerId,z=a?a.props.id:null;if(z!==B||c!==T){if(z!==B){let G=n.find(Z=>Z.props.id===B);G&&d.unshift(G)}t.layerId=z,t.index=c,t.info=null}}let p=r4(r),b=new Map;return b.set(null,p),d.forEach(T=>{let B={...p};T===a&&(B.color=s,B.index=c,B.picked=!0),B=i4({layer:T,info:B,mode:i});let z=B.layer;T===a&&i==="hover"&&(t.info=B),b.set(z.id,B),i==="hover"&&z.updateAutoHighlight(B)}),b}function i4({layer:r,info:e,mode:t}){for(;r&&e;){let i=e.layer||null;e.sourceLayer=i,e.layer=r,e=r.getPickingInfo({info:e,mode:t,sourceLayer:i}),r=r.parent}return e}function Xte(r,e){for(let t=r.length-1;t>=0;t--){let i=r[t];if(i.containsPixel(e))return i}return r[0]}var t1=class{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Rp(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:n},s=this.lastPickedInfo.info){let a=s&&s.layer&&s.layer.id,c=s&&s.viewport&&s.viewport.id,d=a?i.find(B=>B.id===a):null,p=c&&n.find(B=>B.id===c)||n[0],b=p&&p.unproject([e-p.x,t-p.y]);return{...s,...{x:e,y:t,viewport:p,coordinate:b,layer:d}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;let t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:n,y:s,radius:a=0,depth:c=1,mode:d="query",unproject3D:p,onViewportActive:b,effects:T}){let B=this.device.canvasContext.cssToDeviceRatio(),z=this._getPickable(e);if(!z||i.length===0)return{result:[],emptyInfo:r4({viewports:i,x:n,y:s,pixelRatio:B})};this._resizeBuffer();let G=this.device.canvasContext.cssToDevicePixels([n,s],!0),Z=[G.x+Math.floor(G.width/2),G.y+Math.floor(G.height/2)],q=Math.round(a*B),{width:re,height:ee}=this.pickingFBO,ae=this._getPickingRect({deviceX:Z[0],deviceY:Z[1],deviceRadius:q,deviceWidth:re,deviceHeight:ee}),me={x:n-a,y:s-a,width:a*2+1,height:a*2+1},Le,je=[],Je=new Set;for(let J=0;J<c;J++){let te;if(ae){let ye=this._drawAndSample({layers:z,views:t,viewports:i,onViewportActive:b,deviceRect:ae,cullRect:me,effects:T,pass:`picking:${d}`});te=QO({...ye,deviceX:Z[0],deviceY:Z[1],deviceRadius:q,deviceRect:ae})}else te={pickedColor:null,pickedObjectIndex:-1};let X;if(te.pickedLayer&&p&&this.depthFBO){let{pickedColors:ye}=this._drawAndSample({layers:[te.pickedLayer],views:t,viewports:i,onViewportActive:b,deviceRect:{x:te.pickedX,y:te.pickedY,width:1,height:1},cullRect:me,effects:T,pass:`picking:${d}:z`},!0);ye[3]&&(X=ye[0])}te.pickedLayer&&J+1<c&&(Je.add(te.pickedLayer),te.pickedLayer.disablePickingIndex(te.pickedObjectIndex)),Le=eD({pickInfo:te,lastPickedInfo:this.lastPickedInfo,mode:d,layers:z,viewports:i,x:n,y:s,z:X,pixelRatio:B});for(let ye of Le.values())ye.layer&&je.push(ye);if(!te.pickedColor)break}for(let J of Je)J.restorePickingColors();return{result:je,emptyInfo:Le.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:n,y:s,width:a=1,height:c=1,mode:d="query",maxObjects:p=null,onViewportActive:b,effects:T}){let B=this._getPickable(e);if(!B||i.length===0)return[];this._resizeBuffer();let z=this.device.canvasContext.cssToDeviceRatio(),G=this.device.canvasContext.cssToDevicePixels([n,s],!0),Z=G.x,q=G.y+G.height,re=this.device.canvasContext.cssToDevicePixels([n+a,s+c],!0),ee=re.x+re.width,ae=re.y,me={x:Z,y:ae,width:ee-Z,height:q-ae},Le=this._drawAndSample({layers:B,views:t,viewports:i,onViewportActive:b,deviceRect:me,cullRect:{x:n,y:s,width:a,height:c},effects:T,pass:`picking:${d}`}),je=JO(Le),Je=new Map,J=[],te=Number.isFinite(p);for(let X=0;X<je.length&&!(te&&J.length>=p);X++){let ye=je[X],_e={color:ye.pickedColor,layer:null,index:ye.pickedObjectIndex,picked:!0,x:n,y:s,pixelRatio:z};_e=i4({layer:ye.pickedLayer,info:_e,mode:d});let Oe=_e.layer.id;Je.has(Oe)||Je.set(Oe,new Set);let ve=Je.get(Oe),De=_e.object??_e.index;ve.has(De)||(ve.add(De),J.push(_e))}return J}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:n,deviceRect:s,cullRect:a,effects:c,pass:d},p=!1){let b=p?this.depthFBO:this.pickingFBO,T={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:n,pickingFBO:b,deviceRect:s,cullRect:a,effects:c,pass:d,pickZ:p,preRenderStats:{},isPicking:!0};for(let ee of c)ee.useInPicking&&(T.preRenderStats[ee.id]=ee.preRender(T));let{decodePickingColor:B}=this.pickLayersPass.render(T),{x:z,y:G,width:Z,height:q}=s,re=new(p?Float32Array:Uint8Array)(Z*q*4);return this.device.readPixelsToArrayWebGL(b,{sourceX:z,sourceY:G,sourceWidth:Z,sourceHeight:q,target:re}),{pickedColors:re,decodePickingColor:B}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:n,deviceHeight:s}){let a=Math.max(0,e-i),c=Math.max(0,t-i),d=Math.min(n,e+i+1)-a,p=Math.min(s,t+i+1)-c;return d<=0||p<=0?null:{x:a,y:c,width:d,height:p}}};var Yte={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Kte="top-left",tD="__root",Hb=class{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!hn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(let e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){let t={};for(let i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(let i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){let n=t[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._remove(n),this._add(i)):i!==n&&(n.setProps(i.props),i=n):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(let i in t){let n=t[i];n&&this._remove(n)}this.widgets=e}_add(e){let{viewId:t=null,placement:i=Kte}=e,n=e.onAdd({deck:this.deck,viewId:t});n&&this._getContainer(t,i).append(n),e._element=n}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){let i=e||tD,n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",this.parentElement?.append(n),this.containers[i]=n);let s=n.querySelector(`.${t}`);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,Yte[t]),n.append(s)),s}_updateContainers(){let e=this.deck.width,t=this.deck.height;for(let i in this.containers){let n=this.lastViewports[i]||null,s=i===tD||n,a=this.containers[i];s?(a.style.display="block",a.style.left=`${n?n.x:0}px`,a.style.top=`${n?n.y:0}px`,a.style.width=`${n?n.width:e}px`,a.style.height=`${n?n.height:t}px`):a.style.display="none"}}onRedraw({viewports:e,layers:t}){let i=e.reduce((n,s)=>(n[s.id]=s,n),{});for(let n of this.getWidgets()){let{viewId:s}=n;if(s){let a=i[s];a&&(n.onViewportChange&&n.onViewportChange(a),n.onRedraw?.({viewports:[a],layers:t}))}else{if(n.onViewportChange)for(let a of e)n.onViewportChange(a);n.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(let i of this.getWidgets()){let{viewId:n}=i;(!n||n===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){let i=L_[t.type];if(i)for(let n of this.getWidgets()){let{viewId:s}=n;(!s||s===e.viewport?.id)&&n[i]?.(e,t)}}};var Qte={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},r1=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){let t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,Qte),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;let n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,t,i){let n=this.element;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}};var Xf;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Xf||(Xf={}));var n1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ls=(r,e,t)=>e?r.enable(t):r.disable(t),rD=(r,e,t)=>r.hint(t,e),Wa=(r,e,t)=>r.pixelStorei(t,e),iD=(r,e,t)=>{let i=t===36006?36009:36008;return r.bindFramebuffer(i,e)},i1=(r,e,t)=>{let n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(n,e)};function n4(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}var nD={3042:Ls,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:Ls,2885:(r,e)=>r.cullFace(e),2929:Ls,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:Ls,35723:rD,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>r.bindTransformFeedback?.(36386,e),34229:(r,e)=>r.bindVertexArray(e),36006:iD,36010:iD,34964:i1,36662:i1,36663:i1,35053:i1,35055:i1,2886:(r,e)=>r.frontFace(e),33170:rD,2849:(r,e)=>r.lineWidth(e),32823:Ls,32824:"polygonOffset",10752:"polygonOffset",35977:Ls,32926:Ls,32928:Ls,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ls,3088:(r,e)=>r.scissor(...e),2960:Ls,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:Ls,10754:Ls,12288:Ls,12289:Ls,12290:Ls,12291:Ls,12292:Ls,12293:Ls,12294:Ls,12295:Ls,3333:Wa,3317:Wa,37440:Wa,37441:Wa,37443:Wa,3330:Wa,3332:Wa,3331:Wa,3314:Wa,32878:Wa,3316:Wa,3315:Wa,32877:Wa,framebuffer:(r,e)=>{let t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{let t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{let t=e?.length===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(e[0],e[1]||!1),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=n4(e)?e:[e,e];let[t,i]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,i)},stencilFunc:(r,e)=>{e=n4(e)&&e.length===3?[...e,...e]:e;let[t,i,n,s,a,c]=e;r.stencilFuncSeparate(1028,t,i,n),r.stencilFuncSeparate(1029,s,a,c)},stencilOp:(r,e)=>{e=n4(e)&&e.length===3?[...e,...e]:e;let[t,i,n,s,a,c]=e;r.stencilOpSeparate(1028,t,i,n),r.stencilOpSeparate(1029,s,a,c)},viewport:(r,e)=>r.viewport(...e)};function ss(r,e,t){return e[r]!==void 0?e[r]:t[r]}var sD={blendEquation:(r,e,t)=>r.blendEquationSeparate(ss(32777,e,t),ss(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(ss(32969,e,t),ss(32968,e,t),ss(32971,e,t),ss(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(ss(32824,e,t),ss(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(ss(32938,e,t),ss(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,ss(2962,e,t),ss(2967,e,t),ss(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,ss(34816,e,t),ss(36003,e,t),ss(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,ss(2964,e,t),ss(2965,e,t),ss(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,ss(34817,e,t),ss(34818,e,t),ss(34819,e,t))},s4={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{let i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?r({[i]:t}):{valueChanged:!0}},blendColor:(r,e,t,i,n)=>r({32773:new Float32Array([e,t,i,n])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,i,n)=>r({32969:e,32968:t,32971:i,32970:n}),clearColor:(r,e,t,i,n)=>r({3106:new Float32Array([e,t,i,n])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,i,n)=>r({3107:[e,t,i,n]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,i,n)=>r({3088:new Int32Array([e,t,i,n])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,i)=>r({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(r,e,t,i,n)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(r,e,t,i)=>r({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(r,e,t,i,n)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(r,e,t,i,n)=>r({2978:[e,t,i,n]})},mu=(r,e)=>r.isEnabled(e),o4={3042:mu,2884:mu,2929:mu,3024:mu,32823:mu,32926:mu,32928:mu,3089:mu,2960:mu,35977:mu},oD=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function pc(r,e){if(Jte(e))return;let t={};for(let n in e){let s=Number(n),a=nD[n];a&&(typeof a=="string"?t[a]=!0:a(r,e[n],s))}let i=r.state&&r.state.cache;if(i)for(let n in t){let s=sD[n];s(r,e,i)}}function Wb(r,e=n1){if(typeof e=="number"){let n=e,s=o4[n];return s?s(r,n):r.getParameter(n)}let t=Array.isArray(e)?e:Object.keys(e),i={};for(let n of t){let s=o4[n];i[n]=s?s(r,Number(n)):r.getParameter(Number(n))}return i}function aD(r){pc(r,n1)}function Jte(r){for(let e in r)return!1;return!0}function lD(r,e){if(r===e)return!0;let t=Array.isArray(r)||ArrayBuffer.isView(r),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&r.length===e.length){for(let n=0;n<r.length;++n)if(r[n]!==e[n])return!1;return!0}return!1}var Ac=class{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){let e=this.stateStack[this.stateStack.length-1];pc(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?Wb(e):Object.assign({},n1),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,tre(e);for(let i in s4){let n=s4[i];ere(e,i,n)}cD(e,"getParameter"),cD(e,"isEnabled")}_updateCache(e){let t=!1,i,n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let s in e){let a=e[s],c=this.cache[s];lD(a,c)||(t=!0,i=c,n&&!(s in n)&&(n[s]=c),this.cache[s]=a)}return{valueChanged:t,oldValue:i}}};function cD(r,e){let t=r[e].bind(r);r[e]=function(n){if(n===void 0||oD.has(n))return t(n);let s=Ac.get(r);return n in s.cache||(s.cache[n]=t(n)),s.enable?s.cache[n]:t(n)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function ere(r,e,t){if(!r[e])return;let i=r[e].bind(r);r[e]=function(...s){let a=Ac.get(r),{valueChanged:c,oldValue:d}=t(a._updateCache,...s);return c&&i(...s),d},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function tre(r){let e=r.useProgram.bind(r);r.useProgram=function(i){let n=Ac.get(r);n.program!==i&&(e(i),n.program=i)}}function uD(r,e,t){let i="",n={preserveDrawingBuffer:!0,...t},s=null;if(s||=r.getContext("webgl2",n),n.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!t.failIfMajorPerformanceCaveat&&(n.failIfMajorPerformanceCaveat=!1,s=r.getContext("webgl2",n),s.luma||={},s.luma.softwareRenderer=!0),s||(s=r.getContext("webgl",{}),s&&(s=null,i||="Your browser only supports WebGL1")),!s)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);let{onContextLost:a,onContextRestored:c}=e;return r.addEventListener("webglcontextlost",d=>a(d),!1),r.addEventListener("webglcontextrestored",d=>c(d),!1),s.luma||={},s}function gu(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function hD(r,e){let t=r.getParameter(7936),i=r.getParameter(7937);gu(r,"WEBGL_debug_renderer_info",e);let n=e.WEBGL_debug_renderer_info,s=r.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),a=r.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),c=s||t,d=a||i,p=r.getParameter(7938),b=fD(c,d),T=rre(c,d),B=ire(c,d);return{type:"webgl",gpu:b,gpuType:B,gpuBackend:T,vendor:c,renderer:d,version:p,shadingLanguage:"glsl",shadingLanguageVersion:300}}function fD(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function rre(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function ire(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(fD(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function $b(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}var s1="WEBGL_compressed_texture_s3tc",o1="WEBGL_compressed_texture_s3tc_srgb",L0="EXT_texture_compression_rgtc",O0="EXT_texture_compression_bptc",nre="WEBGL_compressed_texture_etc",sre="WEBGL_compressed_texture_astc",ore="WEBGL_compressed_texture_etc1",are="WEBGL_compressed_texture_pvrtc",lre="WEBGL_compressed_texture_atc",dD="EXT_texture_norm16",pD="EXT_render_snorm",cre="EXT_color_buffer_float",qb={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[pD],"norm16-renderable-webgl":[dD],"snorm16-renderable-webgl":[dD,pD],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[s1,o1,L0,O0],"texture-compression-bc5-webgl":[L0],"texture-compression-bc7-webgl":[O0],"texture-compression-etc2":[nre],"texture-compression-astc":[sre],"texture-compression-etc1-webgl":[ore],"texture-compression-pvrtc-webgl":[are],"texture-compression-atc-webgl":[lre]};function AD(r){return r in qb}function mD(r,e,t){return(qb[e]||[]).every(n=>gu(r,n,t))}var a4={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:cre,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:s1},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:o1},"bc1-rgba-unorm":{gl:33777,x:s1},"bc1-rgba-unorm-srgb":{gl:35916,x:o1},"bc2-rgba-unorm":{gl:33778,x:s1},"bc2-rgba-unorm-srgb":{gl:35918,x:o1},"bc3-rgba-unorm":{gl:33779,x:s1},"bc3-rgba-unorm-srgb":{gl:35919,x:o1},"bc4-r-unorm":{gl:36283,x:L0},"bc4-r-snorm":{gl:36284,x:L0},"bc5-rg-unorm":{gl:36285,x:L0},"bc5-rg-snorm":{gl:36286,x:L0},"bc6h-rgb-ufloat":{gl:36495,x:O0},"bc6h-rgb-float":{gl:36494,x:O0},"bc7-rgba-unorm":{gl:36492,x:O0},"bc7-rgba-unorm-srgb":{gl:36493,x:O0},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function gD(r,e,t){let i=e.create,n=a4[e.format];return n?.gl===void 0&&(i=!1),n?.x&&(i=i&&!!gu(r,n.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function Zb(r){let e=a4[r],t=hre(r),i=n0(r);return{internalFormat:t,format:e?.dataFormat||ure(i.channels,i.integer,i.normalized,t),type:i.dataType?$b(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function _D(r){switch(n0(r).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${r}`)}}function ure(r,e,t,i){if(i===6408||i===6407)return i;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function hre(r){let t=a4[r]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}var yD={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},Xb=class extends Qg{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,gu(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){let e=this.getFeatures();for(let t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),AD(e)&&mD(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){let e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(let t of e)this.has(t)}getFeatures(){return[...Object.keys(yD),...Object.keys(qb)]}getWebGLFeature(e){let t=yD[e];return typeof t=="string"?!!gu(this.gl,t,this.extensions):!!t}};var Yb=class extends Kg{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}};var _u=class extends dp{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);let i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){let i=this.colorAttachments[t];if(i){let n=36064+t;this._attachTextureView(n,i)}}if(this.depthStencilAttachment){let t=_D(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){let t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${dre(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){let{gl:i}=this.device,{texture:n}=t,s=t.props.baseMipLevel,a=t.props.baseArrayLayer;switch(i.bindTexture(n.glTarget,n.handle),n.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,n.handle,s,a);break;case 34067:let c=fre(a);i.framebufferTexture2D(36160,e,c,n.handle,s);break;case 3553:i.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:throw new Error("Illegal texture type")}i.bindTexture(n.glTarget,null)}};function fre(r){return r<34069?r+34069:r}function dre(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}var Kb=class extends e_{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new _u(this.device,{handle:null}),this._framebuffer}update(){let e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){let t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}};async function Qb(r,e){let t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");let i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",r),e&&(i.id=e),new Promise((n,s)=>{i.onload=n,i.onerror=a=>s(new Error(`Unable to load script '${r}': ${a}`)),t.appendChild(i)})}var pre=1,$a=null,xD=!1,Jb={debugSpectorJS:Vt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function bD(r){if(!globalThis.SPECTOR)try{await Qb(r.debugSpectorJSUrl||Jb.debugSpectorJSUrl)}catch(e){Vt.warn(String(e))}}function vD(r){if(r={...Jb,...r},!r.debugSpectorJS)return null;if(!$a&&globalThis.SPECTOR&&!globalThis.luma?.spector){Vt.probe(pre,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:e}=globalThis.SPECTOR;$a=new e,globalThis.luma&&(globalThis.luma.spector=$a)}if(!$a)return null;if(xD||(xD=!0,$a.spyCanvases(),$a?.onCaptureStarted.add(e=>Vt.info("Spector capture started:",e)()),$a?.onCapture.add(e=>{Vt.info("Spector capture complete:",e)(),$a?.getResultUI(),$a?.resultView.display(),$a?.resultView.addCapture(e)})),r.gl){let e=r.gl,t=e.device;$a?.startCapture(r.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{Vt.info("Spector capture stopped after 2 seconds")(),$a?.stopCapture()})}return $a}var Are="https://unpkg.com/webgl-debug@2.0.1/index.js";function TD(r){return r.luma=r.luma||{},r.luma}async function ED(){qo()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Qb(Are))}function SD(r,e={}){return e.debugWebGL||e.traceWebGL?gre(r,e):mre(r)}function mre(r){let e=TD(r);return e.realContext?e.realContext:r}function gre(r,e){if(!globalThis.WebGLDebugUtils)return Vt.warn("webgl-debug not loaded")(),r;let t=TD(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Xf,...r});let i=globalThis.WebGLDebugUtils.makeDebugContext(r,_re.bind(null,e),yre.bind(null,e));for(let a in Xf)!(a in i)&&typeof Xf[a]=="number"&&(i[a]=Xf[a]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(r)),Object.setPrototypeOf(n,i);let s=Object.create(n);return t.realContext=r,t.debugContext=s,s.debug=!0,s}function wD(r,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function _re(r,e,t,i){i=Array.from(i).map(c=>c===void 0?"undefined":c);let n=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),a=`${n} in gl.${t}(${s})`;Vt.error(a)();debugger}function yre(r,e,t){let i="";Vt.level>=1&&(i=wD(e,t),r.traceWebGL&&Vt.log(1,i)());for(let n of t)if(n===void 0){i=i||wD(e,t);debugger}}var l4={};function CD(r="id"){l4[r]=l4[r]||1;let e=l4[r]++;return`${r}-${e}`}var mc=class extends Hi{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;let i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=xre(this.props.usage),this.glUsage=bre(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,i=e.byteLength+t){let n=this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));let i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;let i=new Uint8Array(t),n=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,n,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}};function xre(r){return r&Hi.INDEX?34963:r&Hi.VERTEX?34962:r&Hi.UNIFORM?35345:34962}function bre(r){return r&Hi.INDEX||r&Hi.VERTEX?35044:r&Hi.UNIFORM?35048:35044}function PD(r){let e=r.split(/\r?\n/),t=[];for(let i of e){if(i.length<=1)continue;let n=i.split(":");if(n.length===2){let[T,B]=n;t.push({message:B.trim(),type:ID(T),lineNum:0,linePos:0});continue}let[s,a,c,...d]=n,p=parseInt(c,10);isNaN(p)&&(p=0);let b=parseInt(a,10);isNaN(b)&&(b=0),t.push({message:d.join(":").trim(),type:ID(s),lineNum:p,linePos:b})}return t}function ID(r){let e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}var ev=class extends hp{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let e=this.device.gl.getShaderInfoLog(this.handle);return e?PD(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;let{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Vt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Vt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let e=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};function RD(r,e,t,i){if(Ere(e))return i(r);let n=r;n.pushState();try{return vre(r,e),pc(n.gl,t),i(r)}finally{n.popState()}}function vre(r,e){let t=r,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Dp("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){let s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=Dp("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(a)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){let s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,a=Dp("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,a),s?.polygonModeWEBGL(1029,a)}e.polygonOffsetLine&&i.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(Tre("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(rv("depthCompare",e.depthCompare))),e.stencilWriteMask){let n=e.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&Vt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){let n=e.stencilReadMask||4294967295,s=rv("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,s,0,n),i.stencilFuncSeparate(1029,s,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){let n=c4("stencilPassOperation",e.stencilPassOperation),s=c4("stencilFailOperation",e.stencilFailOperation),a=c4("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,s,a,n),i.stencilOpSeparate(1029,s,a,n)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break;default:}if(e.blendColorOperation||e.blendAlphaOperation){let n=MD("blendColorOperation",e.blendColorOperation||"add"),s=MD("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(n,s);let a=tv("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=tv("blendColorDstFactor",e.blendColorDstFactor||"zero"),d=tv("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),p=tv("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(a,c,d,p)}}function rv(r,e){return Dp(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function c4(r,e){return Dp(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function MD(r,e){return Dp(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function tv(r,e){return Dp(r,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function wre(r,e){return`Illegal parameter ${e} for ${r}`}function Dp(r,e,t){if(!(e in t))throw new Error(wre(r,e));return t[e]}function Tre(r,e){return e}function Ere(r){let e=!0;for(let t in r){e=!1;break}return e}function iv(r){let e={};return r.addressModeU&&(e[10242]=u4(r.addressModeU)),r.addressModeV&&(e[10243]=u4(r.addressModeV)),r.addressModeW&&(e[32882]=u4(r.addressModeW)),r.magFilter&&(e[10240]=h4(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=Sre(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=rv("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function u4(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function h4(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function Sre(r,e="none"){if(!e)return h4(r);switch(e){case"none":return h4(r);case"nearest":return r==="nearest"?9984:9986;case"linear":return r==="nearest"?9985:9987}}var kp=class extends fp{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=iv(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(let[t,i]of Object.entries(e)){let n=Number(t);switch(n){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,n,i);break;default:this.device.gl.samplerParameteri(this.handle,n,i);break}}}};var yu=class extends up{device;gl;handle;texture;constructor(e,t){super(e,{...tn.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}};var Cre="Failed to deduce GL constant from typed array";function BD(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Cre)}}function LD(r,e){let{clamped:t=!0}=e||{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function f4(r){switch(r){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function OD(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Fp(r,e,t){if(Ire(e))return t(r);let{nocatch:i=!0}=e,n=Ac.get(r);n.push(),pc(r,e);let s;if(i)s=t(r),n.pop();else try{s=t(r)}finally{n.pop()}return s}function Ire(r){for(let e in r)return!1;return!0}function DD(r,e,t){let{dimension:i,width:n,height:s,depth:a=0}=t,{glInternalFormat:c}=t,d=t.glTarget;switch(i){case"2d-array":case"3d":r.texStorage3D(d,e,c,n,s,a);break;default:r.texStorage2D(d,e,c,n,s)}}function d4(r,e,t,i){let{width:n,height:s}=i,{dimension:a,depth:c=0,mipLevel:d=0}=i,{x:p=0,y:b=0,z:T=0}=i,{glFormat:B,glType:z}=i,G=FD(i.glTarget,a,c),Z=i.flipY?{37440:!0}:{};Fp(r,Z,()=>{switch(a){case"2d-array":case"3d":r.bindTexture(G,e),r.texSubImage3D(G,d,p,b,T,n,s,c,B,z,t),r.bindTexture(G,null);break;case"2d":case"cube":r.bindTexture(G,e),r.texSubImage2D(G,d,p,b,n,s,B,z,t),r.bindTexture(G,null);break;default:throw new Error(a)}})}function p4(r,e,t){let{dimension:i,width:n,height:s,depth:a=0,mipLevel:c=0,byteOffset:d=0}=t,{x:p=0,y:b=0,z:T=0}=t,{glFormat:B,glType:z,compressed:G}=t,Z=FD(t.glTarget,i,a);switch(i){case"2d-array":case"3d":G?r.compressedTexSubImage3D(Z,c,p,b,T,n,s,a,B,e,d):r.texSubImage3D(Z,c,p,b,T,n,s,a,B,z,e,d);break;case"2d":case"cube":G?r.compressedTexSubImage2D(Z,c,p,b,n,s,B,e,d):r.texSubImage2D(Z,c,p,b,n,s,B,z,e,d);break;default:throw new Error(i)}}function kD(r){switch(r){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866;case"cube-array":break}throw new Error(r)}function FD(r,e,t){return e==="cube"?34069+t:r}function ND(r,e){let{sourceX:t=0,sourceY:i=0,sourceAttachment:n=0}=e||{},{target:s=null,sourceWidth:a,sourceHeight:c,sourceDepth:d,sourceFormat:p,sourceType:b}=e||{},{framebuffer:T,deleteFramebuffer:B}=UD(r),{gl:z,handle:G}=T;a||=T.width,c||=T.height;let Z=T.colorAttachments[n]?.texture;if(!Z)throw new Error(`Invalid framebuffer attachment ${n}`);d=Z?.depth||1,p||=Z?.glFormat||6408,b||=Z?.glType||5121,s=Mre(s,b,p,a,c,d),b=b||BD(s);let q=z.bindFramebuffer(36160,G);return z.readBuffer(36064+n),z.readPixels(t,i,a,c,p,b,s),z.readBuffer(36064),z.bindFramebuffer(36160,q||null),B&&T.destroy(),s}function zD(r,e){let{target:t,sourceX:i=0,sourceY:n=0,sourceFormat:s=6408,targetByteOffset:a=0}=e||{},{sourceWidth:c,sourceHeight:d,sourceType:p}=e||{},{framebuffer:b,deleteFramebuffer:T}=UD(r);c=c||b.width,d=d||b.height;let B=b;p=p||5121;let z=t;if(!z){let Z=f4(s),q=OD(p),re=a+c*d*Z*q;z=B.device.createBuffer({byteLength:re})}let G=r.device.createCommandEncoder();return G.copyTextureToBuffer({sourceTexture:r,width:c,height:d,origin:[i,n],destinationBuffer:z,byteOffset:a}),G.destroy(),T&&b.destroy(),z}function UD(r){return r instanceof dp?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:Pre(r),deleteFramebuffer:!0}}function Pre(r,e){let{device:t,width:i,height:n,id:s}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:i,height:n,colorAttachments:[r]})}function Mre(r,e,t,i,n,s){if(r)return r;e||=5121;let a=LD(e,{clamped:!1}),c=f4(t);return new a(i*n*c)}var xu=class extends tn{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);let i={...this.props};i.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=kD(this.props.dimension);let n=Zb(this.props.format);this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:i}=e;if(!t||!i){let n=tn.getTextureDataSize(e.data);t=n?.width||1,i=n?.height||1}if(this.width=t,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new yu(this.device,{...this.props,texture:this}),this.bind(),DD(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new yu(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof kp?(this.sampler=e,t=e.props):(this.sampler=new kp(this.device,e),t=e);let i=iv(t);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Vt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){Vt.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){let t=tn.getExternalImageSize(e.image),i={...tn.defaultCopyExternalImageOptions,...t,...e},{image:n,depth:s,mipLevel:a,x:c,y:d,z:p,flipY:b}=i,{width:T,height:B}=i,{dimension:z,glTarget:G,glFormat:Z,glInternalFormat:q,glType:re}=this;if(T=Math.min(T,this.width-c),B=Math.min(B,this.height-d),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return d4(this.device.gl,this.handle,n,{dimension:z,mipLevel:a,x:c,y:d,z:p,width:T,height:B,depth:s,glFormat:Z,glInternalFormat:q,glType:re,glTarget:G,flipY:b}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();let i=tn.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&Vt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let n=0;n<i.length;n++){let s=i[n];this._setMipLevel(t,n,s)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),p4(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(let i of tn.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&Vt.warn(`${this.id} has mipmap and multiple LODs.`)();let n=tn.CubeFaces.indexOf(t);this.setTexture2DData(e,n)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){let{face:t,width:i,height:n,pixels:s,data:a,format:c=6408,type:d=5121}=e,{gl:p}=this,b=s||a;this.bind(),b instanceof Promise?b.then(T=>this.setImageDataForFace(Object.assign({},e,{face:t,data:T,pixels:T}))):this.width||this.height?p.texImage2D(t,0,c,i,n,0,c,d,b):p.texImage2D(t,0,c,c,d,b)}_getImageDataMap(e){for(let t=0;t<tn.CubeFaces.length;++t){let i=tn.CubeFaces[t];e[i]&&(e[34069+t]=e[i],delete e[i])}return e}_setSamplerParameters(e){Vt.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(let[t,i]of Object.entries(e)){let n=Number(t),s=i;switch(n){case 33082:case 33083:this.gl.texParameterf(this.glTarget,n,s);break;case 10241:this.gl.texParameteri(this.glTarget,n,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,n,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,n,s);break;default:this.gl.texParameteri(this.glTarget,n,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,i,n=this.glTarget){if(tn.isExternalImage(i)){d4(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:t,glTarget:n,flipY:this.props.flipY});return}if(tn.isTextureLevelData(i)){p4(this.device.gl,i.data,{...this,depth:e,mipLevel:t,glTarget:n});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){let{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){let{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}};var Rre=[1,2,4,8],nv=class extends t_{device;glParameters;constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){let{width:s,height:a}=t.framebuffer;i=[0,0,s,a]}else{let[s,a]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,s,a]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){let s=this.props.framebuffer.colorAttachments.map((a,c)=>36064+c);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){let t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=Rre.map(i=>!!(i&e.colorMask))),this.glParameters=t,pc(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let e={...this.glParameters},t=0;this.props.clearColors&&this.props.clearColors.forEach((i,n)=>{i&&this.clearColorBuffer(n,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&Fp(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){Fp(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}};function VD(r){return Bre.includes(r)}var Bre=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],jD={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function A4(r){let e=jD[r];if(!e)throw new Error("uniform");let[t,i,,n]=e;return{format:n,components:i,glType:t}}function GD(r){let e=jD[r];if(!e)throw new Error("attribute");let[,t,,i,n]=e;return{attributeType:i,vertexFormat:n,components:t}}function HD(r,e){let t={attributes:[],bindings:[]};t.attributes=Lre(r,e);let i=kre(r,e);for(let c of i){let d=c.uniforms.map(p=>({name:p.name,format:p.format,byteOffset:p.byteOffset,byteStride:p.byteStride,arrayLength:p.arrayLength}));t.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:d})}let n=Dre(r,e),s=0;for(let c of n)if(VD(c.type)){let{viewDimension:d,sampleType:p}=Nre(c.type);t.bindings.push({type:"texture",name:c.name,group:0,location:s,viewDimension:d,sampleType:p}),c.textureUnit=s,s+=1}n.length&&(t.uniforms=n);let a=Ore(r,e);return a?.length&&(t.varyings=a),t}function Lre(r,e){let t=[],i=r.getProgramParameter(e,35721);for(let n=0;n<i;n++){let s=r.getActiveAttrib(e,n);if(!s)throw new Error("activeInfo");let{name:a,type:c}=s,d=r.getAttribLocation(e,a);if(d>=0){let{attributeType:p}=GD(c),b=/instance/i.test(a)?"instance":"vertex";t.push({name:a,location:d,stepMode:b,type:p})}}return t.sort((n,s)=>n.location-s.location),t}function Ore(r,e){let t=[],i=r.getProgramParameter(e,35971);for(let n=0;n<i;n++){let s=r.getTransformFeedbackVarying(e,n);if(!s)throw new Error("activeInfo");let{name:a,type:c,size:d}=s,{glType:p,components:b}=A4(c),T={location:n,name:a,type:p,size:d*b};t.push(T)}return t.sort((n,s)=>n.location-s.location),t}function Dre(r,e){let t=[],i=r.getProgramParameter(e,35718);for(let n=0;n<i;n++){let s=r.getActiveUniform(e,n);if(!s)throw new Error("activeInfo");let{name:a,size:c,type:d}=s,{name:p,isArray:b}=zre(a),T=r.getUniformLocation(e,p),B={location:T,name:p,size:c,type:d,isArray:b};if(t.push(B),B.size>1)for(let z=0;z<B.size;z++){let G=`${p}[${z}]`;T=r.getUniformLocation(e,G);let Z={...B,name:G,location:T};t.push(Z)}}return t}function kre(r,e){let t=(s,a)=>r.getActiveUniformBlockParameter(e,s,a),i=[],n=r.getProgramParameter(e,35382);for(let s=0;s<n;s++){let a={name:r.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},c=t(s,35395)||[],d=r.getActiveUniforms(e,c,35383),p=r.getActiveUniforms(e,c,35384),b=r.getActiveUniforms(e,c,35387),T=r.getActiveUniforms(e,c,35388);for(let B=0;B<a.uniformCount;++B){let z=r.getActiveUniform(e,c[B]);if(!z)throw new Error("activeInfo");a.uniforms.push({name:z.name,format:A4(d[B]).format,type:d[B],arrayLength:p[B],byteOffset:b[B],byteStride:T[B]})}i.push(a)}return i.sort((s,a)=>s.location-a.location),i}var Fre={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Nre(r){let e=Fre[r];if(!e)throw new Error("sampler");let[t,i]=e;return{viewDimension:t,sampleType:i}}function zre(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};let t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function WD(r,e,t,i){let n=r,s=i;s===!0&&(s=1),s===!1&&(s=0);let a=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,i);case 5126:return r.uniform1fv(e,a);case 35664:return r.uniform2fv(e,a);case 35665:return r.uniform3fv(e,a);case 35666:return r.uniform4fv(e,a);case 5124:return r.uniform1iv(e,a);case 35667:return r.uniform2iv(e,a);case 35668:return r.uniform3iv(e,a);case 35669:return r.uniform4iv(e,a);case 35670:return r.uniform1iv(e,a);case 35671:return r.uniform2iv(e,a);case 35672:return r.uniform3iv(e,a);case 35673:return r.uniform4iv(e,a);case 5125:return n.uniform1uiv(e,a,1);case 36294:return n.uniform2uiv(e,a,2);case 36295:return n.uniform3uiv(e,a,3);case 36296:return n.uniform4uiv(e,a,4);case 35674:return r.uniformMatrix2fv(e,!1,a);case 35675:return r.uniformMatrix3fv(e,!1,a);case 35676:return r.uniformMatrix4fv(e,!1,a);case 35685:return n.uniformMatrix2x3fv(e,!1,a);case 35686:return n.uniformMatrix2x4fv(e,!1,a);case 35687:return n.uniformMatrix3x2fv(e,!1,a);case 35688:return n.uniformMatrix3x4fv(e,!1,a);case 35689:return n.uniformMatrix4x2fv(e,!1,a);case 35690:return n.uniformMatrix4x3fv(e,!1,a)}throw new Error("Illegal uniform")}function Ure(r){return V_(r)!==null||typeof r=="number"||typeof r=="boolean"}function $D(r){let e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{let i=r[t];Ure(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}function qD(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(r)}}function ZD(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(r)}}var XD=4,sv=class extends su{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;let{varyings:i,bufferMode:n=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,n)),this._linkShaders(),Vt.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=HD(this.device.gl,this.handle),Vt.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Vre(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(let[i,n]of Object.entries(e)){let s=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!s){let a=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");t?.disableWarnings||Vt.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${a}`,n)();continue}switch(n||Vt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(n instanceof mc)&&!(n.buffer instanceof mc))throw new Error("buffer value");break;case"texture":if(!(n instanceof yu||n instanceof xu||n instanceof _u))throw new Error("texture value");break;case"sampler":Vt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(s.type)}this.bindings[i]=n}}draw(e){let{renderPass:t,parameters:i=this.props.parameters,topology:n=this.props.topology,vertexArray:s,vertexCount:a,instanceCount:c,isInstanced:d=!1,firstVertex:p=0,transformFeedback:b}=e,T=qD(n),B=!!s.indexBuffer,z=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Vt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Vt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(t),b&&b.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let G=t;return RD(this.device,i,G.glParameters,()=>{B&&d?this.device.gl.drawElementsInstanced(T,a||0,z,p,c||0):B?this.device.gl.drawElements(T,a||0,z,p):d?this.device.gl.drawArraysInstanced(T,p,a||0,c||0):this.device.gl.drawArrays(T,p,a||0),b&&b.end()}),s.unbindAfterRender(t),!0}setUniformsWebGL(e){let{bindings:t}=$D(e);Object.keys(t).forEach(i=>{Vt.warn(`Unsupported value "${JSON.stringify(t[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){let{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Vt.time(XD,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Vt.timeEnd(XD,`linkProgram for ${this.id}`)(),Vt.level,!this.device.features.has("compilation-status-async-webgl")){let i=this._getLinkStatus();this._reportLinkStatus(i);return}Vt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Vt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break;case"success":break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break;case"success":break}let t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){let{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let e=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(let t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(Vt.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(let n of this.shaderLayout.bindings){let s=this.bindings[n.name]||this.bindings[n.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${n.name} in ${this.id}`);switch(n.type){case"uniform":let{name:a}=n,c=e.getUniformBlockIndex(this.handle,a);if(c===4294967295)throw new Error(`Invalid uniform block name ${a}`);e.uniformBlockBinding(this.handle,i,c),s instanceof mc?e.bindBufferBase(35345,i,s.handle):e.bindBufferRange(35345,i,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),i+=1;break;case"texture":if(!(s instanceof yu||s instanceof xu||s instanceof _u))throw new Error("texture");let d;if(s instanceof yu)d=s.texture;else if(s instanceof xu)d=s;else if(s instanceof _u&&s.colorAttachments[0]instanceof yu)Vt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(d.glTarget,d.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${n.type}' not supported in WebGL`)}}}_applyUniforms(){for(let e of this.shaderLayout.uniforms||[]){let{name:t,location:i,type:n,textureUnit:s}=e,a=this.uniforms[t]??s;a!==void 0&&WD(this.device.gl,i,n,a)}}};function Vre(r,e){let t={...r,attributes:r.attributes.map(i=>({...i}))};for(let i of e?.attributes||[]){let n=t.attributes.find(s=>s.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):Vt.warn(`shader layout attribute ${i.name} not present in shader`)}return t}var ov=class extends i_{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(let t of e)switch(t.name){case"copy-buffer-to-buffer":jre(this.device,t.options);break;case"copy-buffer-to-texture":Gre(this.device,t.options);break;case"copy-texture-to-buffer":Hre(this.device,t.options);break;case"copy-texture-to-texture":Wre(this.device,t.options);break;default:throw new Error(t.name)}}};function jre(r,e){let t=e.sourceBuffer,i=e.destinationBuffer;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,i.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function Gre(r,e){throw new Error("Not implemented")}function Hre(r,e){let{sourceTexture:t,mipLevel:i=0,aspect:n="all",width:s=e.sourceTexture.width,height:a=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:d=[0,0],destinationBuffer:p,byteOffset:b=0,bytesPerRow:T,rowsPerImage:B}=e;if(n!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||c!==0||T||B)throw new Error("not implemented");let{framebuffer:z,destroyFramebuffer:G}=YD(t),Z;try{let q=p,re=s||z.width,ee=a||z.height,ae=Zb(z.colorAttachments[0].texture.props.format),me=ae.format,Le=ae.type;r.gl.bindBuffer(35051,q.handle),Z=r.gl.bindFramebuffer(36160,z.handle),r.gl.readPixels(d[0],d[1],re,ee,me,Le,b)}finally{r.gl.bindBuffer(35051,null),Z!==void 0&&r.gl.bindFramebuffer(36160,Z),G&&z.destroy()}}function Wre(r,e){let{sourceTexture:t,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:s=[0,0],destinationTexture:a}=e,{width:c=e.destinationTexture.width,height:d=e.destinationTexture.height}=e,{framebuffer:p,destroyFramebuffer:b}=YD(t),[T,B]=n,[z,G,Z]=s,q=r.gl.bindFramebuffer(36160,p.handle),re=null,ee;if(a instanceof xu)re=a,c=Number.isFinite(c)?c:re.width,d=Number.isFinite(d)?d:re.height,re.bind(0),ee=re.glTarget;else throw new Error("invalid destination");switch(ee){case 3553:case 34067:r.gl.copyTexSubImage2D(ee,i,z,G,T,B,c,d);break;case 35866:case 32879:r.gl.copyTexSubImage3D(ee,i,z,G,Z,T,B,c,d);break;default:}re&&re.unbind(),r.gl.bindFramebuffer(36160,q),b&&p.destroy()}function YD(r){if(r instanceof tn){let{width:e,height:t,id:i}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}var av=class extends r_{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new ov(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}};function KD(r){let{target:e,source:t,start:i=0,count:n=1}=r,s=t.length,a=n*s,c=0;for(let d=i;c<s;c++)e[d++]=t[c];for(;c<a;)c<a-c?(e.copyWithin(i+c,i,i+c),c*=2):(e.copyWithin(i+c,i,i+a-c),c=a);return r.target}var lv=class r extends n_{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return oE()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){let t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){let i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:n,type:s,stride:a,offset:c,normalized:d,integer:p,divisor:b}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),p?this.device.gl.vertexAttribIPointer(e,n,s,a,c):this.device.gl.vertexAttribPointer(e,n,s,d,a,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,b||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){let t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){let t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);let i=$b(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){let n=r.isConstantAttributeZeroSupported(this.device)||e!==0;(t||n)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){let i=$re(t),n=i.byteLength*e,s=i.length*e;if(this.buffer&&n!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${n} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:n}),a=a||!qre(i,this.bufferValue),a){let c=cS(t.constructor,s);KD({target:c,source:i,start:0,count:s}),this.buffer.write(c),this.bufferValue=t}return this.buffer}};function $re(r){return Array.isArray(r)?new Float32Array(r):r}function qre(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}var cv=class extends s_{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(ZD(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){let i=this._getVaryingIndex(e),{buffer:n,byteLength:s,byteOffset:a}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=n,Vt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:n,byteLength:s,byteOffset:a},this.bindOnUse||this._bindBuffer(i,n,a,s)}getBuffer(e){if(QD(e))return this.buffers[e]||null;let t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof mc)return{buffer:e,byteOffset:0,byteLength:e.byteLength};let{buffer:t,byteOffset:i=0,byteLength:n=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:n}}_getVaryingIndex(e){if(QD(e))return Number(e);for(let t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(let e in this.buffers){let{buffer:t,byteLength:i,byteOffset:n}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,n,i)}}_unbindBuffers(){for(let e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,n){let s=t&&t.handle;!s||n===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,n)}};function QD(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}var uv=class extends o_{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,n)=>{let s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}};var gc=class extends ul{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||CD("webgl-device")});let t=ul._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new Kb(this,t),this.lost=new Promise(b=>{this._resolveContextLost=b});let n={...e.webgl};t.alphaMode==="premultiplied"&&(n.premultipliedAlpha=!0),e.powerPreference!==void 0&&(n.powerPreference=e.powerPreference);let a=this.props._handle||uD(this.canvasContext.canvas,{onContextLost:b=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:b=>console.log("WebGL context restored")},n);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(e._reuseDevices)return Vt.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=vD({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=hD(this.gl,this._extensions),this.limits=new Yb(this.gl),this.features=new Xb(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),t.autoResize!==!1&&this.canvasContext.resize(),new Ac(this.gl,{log:(...b)=>Vt.log(1,...b)()}).trackState(this.gl,{copyState:!1});let d=e.debugWebGL||e.debug,p=e.debugWebGL;d&&(this.gl=SD(this.gl,{debugWebGL:d,traceWebGL:p}),Vt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Vt.level=Math.max(Vt.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){let t=this._normalizeBufferProps(e);return new mc(this,t)}createTexture(e){return new xu(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new kp(this,e)}createShader(e){return new ev(this,e)}createFramebuffer(e){return new _u(this,e)}createVertexArray(e){return new lv(this,e)}createTransformFeedback(e){return new cv(this,e)}createQuerySet(e){return new uv(this,e)}createRenderPipeline(e){return new sv(this,e)}beginRenderPass(e){return new nv(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new av(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return ND(e,t)}readPixelsToBufferWebGL(e,t){return zD(e,t)}setParametersWebGL(e){pc(this.gl,e)}getParametersWebGL(e){return Wb(this.gl,e)}withParametersWebGL(e,t){return Fp(this.gl,e,t)}resetWebGL(){Vt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),aD(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return gD(this.gl,e,this._extensions)}loseDevice(){let e=!1,i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Ac.get(this.gl).push()}popState(){Ac.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){let i=Number(e);for(let n in this.gl)if(this.gl[n]===i)return`GL.${n}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){let t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[n,s])=>(i[`${n}:${this.getGLKey(n,t)}`]=`${s}:${this.getGLKey(s,t)}`,i),{})}_constants;setConstantAttributeWebGL(e,t){let i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);let n=this._constants[e];switch(n&&Kre(n,t)&&Vt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:Zre(this,e,t);break;case Int32Array:Xre(this,e,t);break;case Uint32Array:Yre(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return gu(this.gl,e,this._extensions),this._extensions}};function Zre(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break;default:}}function Xre(r,e,t){r.gl.vertexAttribI4iv(e,t)}function Yre(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function Kre(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}var Qre={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Jre=r=>({drawBuffersWEBGL(e){return r.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),eie=r=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return r.createVertexArray()},deleteVertexArrayOES(e){return r.deleteVertexArray(e)},isVertexArrayOES(e){return r.isVertexArray(e)},bindVertexArrayOES(e){return r.bindVertexArray(e)}}),tie=r=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return r.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return r.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return r.vertexAttribDivisor(...e)}});function JD(r=!0){let e=HTMLCanvasElement.prototype;if(!r&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){let n=this.originalGetContext("webgl2",i);return n instanceof HTMLElement&&rie(n),n}return this.originalGetContext(t,i)}}function rie(r){r.getExtension("EXT_color_buffer_float");let e={...Qre,WEBGL_disjoint_timer_query:r.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Jre(r),OES_vertex_array_object:eie(r),ANGLE_instanced_arrays:tie(r)},t=r.getExtension;r.getExtension=function(n){let s=t.call(r,n);return s||(n in e?e[n]:null)};let i=r.getSupportedExtensions;r.getSupportedExtensions=function(){return(i.apply(r)||[])?.concat(Object.keys(e))}}var hv=1,m4=class extends Jg{type="webgl";constructor(){super(),ul.defaultProps={...ul.defaultProps,...Jb},gc.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){JD(e)}async attach(e){if(e instanceof gc)return e;if(e?.device instanceof ul)return e.device;if(!iie(e))throw new Error("Invalid WebGL2RenderingContext");return new gc({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){Vt.groupCollapsed(hv,"WebGLDevice created")();let t=[];(e.debugWebGL||e.debug)&&t.push(ED()),e.debugSpectorJS&&t.push(bD(e));let i=await Promise.allSettled(t);for(let a of i)a.status==="rejected"&&Vt.error(`Failed to initialize debug libraries ${a.reason}`)();let n=new gc(e),s=`${n._reused?"Reusing":"Created"} device with WebGL2 ${n.debug?"debug ":""}context: ${n.info.vendor}, ${n.info.renderer} for canvas: ${n.canvasContext.id}`;return Vt.probe(hv,s)(),Vt.table(hv,n.info)(),Vt.groupEnd(hv)(),n}};function iie(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}var fv=new m4;function Yf(){}var nie=({isDragging:r})=>r?"grabbing":"grab",ek={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Yf,onWebGLInitialized:Yf,onResize:Yf,onViewStateChange:Yf,onInteractionStateChange:Yf,onBeforeRender:Yf,onAfterRender:Yf,onLoad:Yf,onError:r=>cr.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:nie,getTooltip:null,debug:!1,drawPickingColors:!1},a1=class{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Mo({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{let{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{let s=i.offsetCenter;if(!s)return;n.x=s.x,n.y=s.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{let n=L_[i.type],s=i.offsetCenter;if(!n||!s||!this.layerManager)return;let a=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:a,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:d}=c,p=d&&(d[n]||d.props[n]),b=this.props[n],T=!1;p&&(T=p.call(d,c,i)),T||(b?.(c,i),this.widgetManager.onEvent(c,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;let n=i.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...ek,...e},e=this.props,e.viewState&&e.initialViewState&&cr.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&cr.error("WebGL1 context not supported.")(),t=fv.attach(e.gl)),t||(t=s0.createDevice({type:"best-available",_reuseDevices:!0,adapters:[fv],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&hc.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&cr.removed("onLayerHover","onHover")(),"onLayerClick"in e&&cr.removed("onLayerClick","onClick")(),e.initialViewState&&!hn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||i||n||s||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return An(this.viewManager),this.viewManager.views}getViewports(e){return An(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(let i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(let t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){An(this.deckPicker);let{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();let s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),An(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:i}=e;if(t||t===0){let n=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=n}if(i||i===0){let n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){let{gl:i,onError:n,useDevicePixels:s}=t;return new U_({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new K_({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:e}=this;if(e.event){let{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let n=i,s=!1;for(let a of t)n=a,s=a.layer?.onHover(a,e.event)||s;s||(this.props.onHover?.(n,e.event),this.widgetManager.onHover(n,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);let t=new Ip;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new B_(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(zC).map(n=>{let[s,a,c,d]=zC[n],p=this.props.eventRecognizerOptions?.[n],b={...a,...p,event:n};return{recognizer:new s(b),recognizeWith:c,requestFailure:d}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let n in L_)this.eventManager.on(n,this._onEvent);this.viewManager=new W_({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let i=this.viewManager.getViewports()[0];this.layerManager=new H_(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new Q_({deck:this,device:this.device}),this.deckRenderer=new e1(this.device),this.deckPicker=new t1(this.device),this.widgetManager=new Hb({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new r1),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){let{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});let s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),cr.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();let i=s0.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}};a1.defaultProps=ek;a1.VERSION=j6;var D0=a1;function tk(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return l_(r)}}var rk=b2;function l1(r,e,t){let i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:r,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function Kf(r){return r.stride||r.size*r.bytesPerElement}function ik(r,e){return r.type===e.type&&r.size===e.size&&Kf(r)===Kf(e)&&(r.offset||0)===(e.offset||0)}function g4(r,e){e.offset&&cr.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let t=Kf(r),i=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,n=e.elementOffset||0,s=i*t+n*r.bytesPerElement+(r.offset||0);return{...e,offset:s,stride:t}}function sie(r,e){let t=g4(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}var c1=class{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;let n=t.logicalType||t.type,s=n==="float64",{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let c;s?c="float32":!n&&t.isIndexed?c="uint32":c=n||"float32";let d=tk(n||c);this.doublePrecision=s,s&&t.fp64===!1&&(d=Float32Array),this.value=null,this.settings={...t,defaultType:d,defaultValue:a,logicalType:n,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:d.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Kf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),hc.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){let i={};if(this.state.constant){let n=this.value;if(t){let s=g4(this.getAccessor(),t),a=s.offset/n.BYTES_PER_ELEMENT,c=s.size||this.size;i[e]=n.subarray(a,a+c)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){let i=this.getAccessor(),n=[],s={name:this.id,byteStride:Kf(i),attributes:n};if(this.doublePrecision){let a=sie(i,t||{});n.push(l1(e,{...i,...a.high},this.device.type),l1(`${e}64Low`,{...i,...a.low},this.device.type))}else if(t){let a=g4(i,t);n.push(l1(e,{...i,...a},this.device.type))}else n.push(l1(e,i,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let t=Array.from(this.value);e=[t,t]}else{let{value:t,numInstances:i,size:n}=this,s=i*n;if(t&&s&&t.length>=s){let a=new Array(n).fill(1/0),c=new Array(n).fill(-1/0);for(let d=0;d<s;)for(let p=0;p<n;p++){let b=t[d++];b<a[p]&&(a[p]=b),b>c[p]&&(c[p]=b)}e=[a,c]}}return this.state.bounds=e,e}setData(e){let{state:t}=this,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Hi?i={buffer:e}:i=e;let n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{let a=rk(i.value);n.type=n.normalized?a.replace("int","norm"):a}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=Kf(n)}if(t.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(i.buffer){let s=i.buffer;t.externalBuffer=s,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let s=i.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:a}=this,c=Kf(n),d=(n.vertexOffset||0)*c;if(this.doublePrecision&&s instanceof Float64Array&&(s=Bb(s,n)),this.settings.isIndexed){let b=this.settings.defaultType;s.constructor!==b&&(s=new b(s))}let p=s.byteLength+d+c*2;(!a||a.byteLength<p)&&(a=this._createBuffer(p)),a.write(s,d)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;let t=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Bb(t,{size:this.size,startIndex:i,endIndex:n}):t.subarray(i,n),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){let{state:i}=this,n=i.allocatedValue,s=hc.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;let{byteOffset:a}=this,{buffer:c}=this;return(!c||c.byteLength<s.byteLength+a)&&(c=this._createBuffer(s.byteLength+a),t&&n&&c.write(n instanceof Float64Array?Bb(n,this):n,a)),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);let i=this.settings.defaultType,n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&cr.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){let{defaultValue:n,size:s}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let a=s;for(;--a>=0;)t[i+a]=n[a];return t}switch(s){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let a=s;for(;--a>=0;)t[i+a]=Number.isFinite(e[a])?e[a]:n[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;let{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Hi.INDEX:Hi.VERTEX)|Hi.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}};var nk=[],sk=[];function gs(r,e=0,t=1/0){let i=nk,n={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?i=r:r.length>0&&(sk.length=r.length,i=sk):i=nk,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),n.index=e-1),{iterable:i,objectInfo:n}}function dv(r){return r&&r[Symbol.asyncIterator]}function pv(r,e){let{size:t,stride:i,offset:n,startIndices:s,nested:a}=e,c=r.BYTES_PER_ELEMENT,d=i?i/c:t,p=n?n/c:0,b=Math.floor((r.length-p)/d);return(T,{index:B,target:z})=>{if(!s){let re=B*d+p;for(let ee=0;ee<t;ee++)z[ee]=r[re+ee];return z}let G=s[B],Z=s[B+1]||b,q;if(a){q=new Array(Z-G);for(let re=G;re<Z;re++){let ee=re*d+p;z=new Array(t);for(let ae=0;ae<t;ae++)z[ae]=r[ee+ae];q[re-G]=z}}else if(d===t)q=r.subarray(G*t+p,Z*t+p);else{q=new r.constructor((Z-G)*t);let re=0;for(let ee=G;ee<Z;ee++){let ae=ee*d+p;for(let me=0;me<t;me++)q[re++]=r[ae+me]}}return q}}var ok=[],u1=[[0,1/0]];function ak(r,e){if(r===u1||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;let t=[],i=r.length,n=0;for(let s=0;s<i;s++){let a=r[s];a[1]<e[0]?(t.push(a),n=s+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(n,0,e),t}var aie={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function Av(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});let t=r.type||"interpolation";return{...aie[t],...e,...r,type:t}}var Np=class extends c1{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:u1}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!ik(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:t}=this.settings,i=this.settings.transition,n=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return Av(n,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){let{startRow:i=0,endRow:n=1/0}=t;this.state.updateRanges=ak(this.state.updateRanges,[i,n])}else this.state.updateRanges=u1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=ok}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==u1),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:n}){if(!this.needsUpdate())return!1;let{state:{updateRanges:s},settings:{update:a,noAlloc:c}}=this,d=!0;if(a){for(let[p,b]of s)a.call(n,this,{data:t,startRow:p,endRow:b,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[p,b]of s){let T=Number.isFinite(p)?this.getVertexOffset(p):0,B=Number.isFinite(b)?this.getVertexOffset(b):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:T,endOffset:B})}this._checkAttributeArray()}else d=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),d}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){let{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){let{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let a=e;An(ArrayBuffer.isView(a.value),`invalid ${n.accessor}`);let c=!!a.size&&a.size!==this.size;return i.binaryAccessor=pv(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(let i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;let t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!t)return i;for(let s in t){let a=super._getBufferLayout(s,t[s]);i.attributes.push(...a.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:n,props:s,numInstances:a}){if(e.constant&&this.context.device.type!=="webgpu")return;let{settings:c,state:d,value:p,size:b,startIndices:T}=e,{accessor:B,transform:z}=c,G=d.binaryAccessor||(typeof B=="function"?B:s[B]);typeof G!="function"&&(G=()=>G),An(typeof G=="function",`accessor "${B}" is not a function`);let Z=e.getVertexOffset(i),{iterable:q,objectInfo:re}=gs(t,i,n);for(let ee of q){re.index++;let ae=G(ee,re);if(z&&(ae=z.call(this,ae)),T){let me=(re.index<T.length-1?T[re.index+1]:a)-T[re.index];if(ae&&Array.isArray(ae[0])){let Le=Z;for(let je of ae)e._normalizeValue(je,p,Le),Le+=b}else ae&&ae.length>b?p.set(ae,Z):(e._normalizeValue(ae,re.target,0),e4({target:p,source:re.target,start:Z,count:me}));Z+=me*b}else e._normalizeValue(ae,p,Z),Z+=b}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function _4(r){let{source:e,target:t,start:i=0,size:n,getData:s}=r,a=r.end||t.length,c=e.length,d=a-i;if(c>d){t.set(e.subarray(0,d),i);return}if(t.set(e,i),!s)return;let p=c;for(;p<d;){let b=s(p,e);for(let T=0;T<n;T++)t[i+p]=b[T]||0,p++}}function lk({source:r,target:e,size:t,getData:i,sourceStartIndices:n,targetStartIndices:s}){if(!n||!s)return _4({source:r,target:e,size:t,getData:i}),e;let a=0,c=0,d=i&&((b,T)=>i(b+c,T)),p=Math.min(n.length,s.length);for(let b=1;b<p;b++){let T=n[b]*t,B=s[b]*t;_4({source:r.subarray(a,T),target:e,start:c,end:B,size:t,getData:d}),a=T,c=B}return c<e.length&&_4({source:[],target:e,start:c,size:t,getData:d}),e}function ck(r){let{device:e,settings:t,value:i}=r,n=new Np(e,t);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),n}function mv(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function gv(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function _v(r){r.push(r.shift())}function uk(r,e){let{doublePrecision:t,settings:i,value:n,size:s}=r,a=t&&n instanceof Float64Array?2:1,c=0,{shaderAttributes:d}=r.settings;if(d)for(let p of Object.values(d))c=Math.max(c,p.vertexOffset??0);return(i.noAlloc?n.length:(e+c)*s)*a}function yv({device:r,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=r.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function xv({device:r,buffer:e,attribute:t,fromLength:i,toLength:n,fromStartIndices:s,getData:a=c=>c}){let c=t.doublePrecision&&t.value instanceof Float64Array?2:1,d=t.size*c,p=t.byteOffset,b=t.settings.bytesPerElement<4?p/t.settings.bytesPerElement*4:p,T=t.startIndices,B=s&&T,z=t.isConstant;if(!B&&e&&i>=n)return e;let G=t.value instanceof Float64Array?Float32Array:t.value.constructor,Z=z?t.value:new G(t.getBuffer().readSyncWebGL(p,n*G.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!z){let ae=a;a=(me,Le)=>t.normalizeConstant(ae(me,Le))}let q=z?(ae,me)=>a(Z,me):(ae,me)=>a(Z.subarray(ae+p,ae+p+d),me),re=e?new Float32Array(e.readSyncWebGL(b,i*4).buffer):new Float32Array(0),ee=new Float32Array(n);return lk({source:re,target:ee,sourceStartIndices:s,targetStartIndices:T,size:d,getData:q}),(!e||e.byteLength<ee.byteLength+b)&&(e?.destroy(),e=r.createBuffer({byteLength:ee.byteLength+b,usage:35050})),e.write(ee,b),e}var k0=class{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new dc(i),this.attribute=t,this.attributeInTransition=ck(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=uk(this.attribute,t),this.transition.start({...e,duration:i})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let e of this.buffers)e.destroy();this.buffers.length=0}};var h1=class extends k0{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=hie(e,t)}start(e,t){let i=this.currentLength,n=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}let{buffers:s,attribute:a}=this;_v(s),s[0]=xv({device:this.device,buffer:s[0],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),s[1]=yv({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);let{transform:c}=this,d=c.model,p=Math.floor(this.currentLength/a.size);fk(a)&&(p/=2),d.setVertexCount(p),a.isConstant?(d.setAttributes({aFrom:s[0]}),d.setConstantAttributes({aTo:a.value})):d.setAttributes({aFrom:s[0],aTo:a.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){let{duration:e,easing:t}=this.settings,{time:i}=this.transition,n=i/e;t&&(n=t(n));let{model:s}=this.transform,a={time:n};s.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},lie=`uniform interpolationUniforms {
  float time;
} interpolation;
`,hk={name:"interpolation",vs:lie,uniformTypes:{time:"f32"}},cie=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,uie=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function fk(r){return r.doublePrecision&&r.value instanceof Float64Array}function hie(r,e){let t=e.size,i=mv(t),n=gv(t),s=e.getBufferLayout();return fk(e)?new du(r,{vs:uie,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*t}]}],modules:[CC,hk],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new du(r,{vs:cie,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:s.attributes[0].format}],modules:[hk],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}var f1=class extends k0{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=gie(e),this.framebuffer=_ie(e,this.texture),this.transform=mie(e,t)}start(e,t){let i=this.currentLength,n=this.currentStartIndices;super.start(e,t);let{buffers:s,attribute:a}=this;for(let d=0;d<2;d++)s[d]=xv({device:this.device,buffer:s[d],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});s[2]=yv({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);let{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?c.setConstantAttributes({aTo:a.value}):c.setAttributes({aTo:a.getBuffer()})}onUpdate(){let{buffers:e,transform:t,framebuffer:i,transition:n}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});let a={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:a}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),_v(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},fie=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,die={name:"spring",vs:fie,uniformTypes:{damping:"f32",stiffness:"f32"}},pie=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Aie=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function mie(r,e){let t=mv(e.size),i=gv(e.size);return new du(r,{vs:pie,fs:Aie,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[die],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function gie(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function _ie(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}var yie={interpolation:h1,spring:f1},d1=class{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(let n in e){let s=e[n],a=s.getTransitionSetting(t);a&&this._updateAttribute(n,s,a)}for(let n in this.transitions){let s=e[n];(!s||!s.getTransitionSetting(t))&&this._removeTransition(n)}}hasAttribute(e){let t=this.transitions[e];return t&&t.inProgress}getAttributes(){let e={};for(let t in this.transitions){let i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(let t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){let n=this.transitions[e],s=!n||n.type!==i.type;if(s){n&&this._removeTransition(e);let a=yie[i.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,device:this.device}):(cr.error(`unsupported transition type '${i.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}};var dk="attributeManager.invalidate",xie="attributeManager.updateStart",bie="attributeManager.updateEnd",vie="attribute.updateStart",wie="attribute.allocate",Tie="attribute.updateEnd",bl=class{constructor(e,{id:t="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=hu(kO),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new d1(e,{id:`${t}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){let i=this._invalidateTrigger(e,t);is(dk,this,e,i)}invalidateAll(e){for(let t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);is(dk,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:n,props:s={},buffers:a={},context:c={}}){let d=!1;is(xie,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let p in this.attributes){let b=this.attributes[p],T=b.settings.accessor;b.startIndices=i,b.numInstances=t,s[p]&&cr.removed(`props.${p}`,`data.attributes.${p}`)(),b.setExternalBuffer(a[p])||b.setBinaryValue(typeof T=="string"?a[T]:void 0,e.startIndices)||typeof T=="string"&&!a[T]&&b.setConstantValue(s[T])||b.needsUpdate()&&(d=!0,this._updateAttribute({attribute:b,numInstances:t,data:e,props:s,context:c})),this.needsRedraw=this.needsRedraw||b.needsRedraw()}d&&is(bie,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:n})}updateTransition(){let{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:t,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(let s in t){let a=t[s];a.needsRedraw(e)&&!i.hasAttribute(s)&&(n[s]=a)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(let i in e){let n=e[i],s={...n,id:i,size:n.isIndexed&&1||n.size||1,...t};this.attributes[i]=new Np(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){let{attributes:i,updateTriggers:n}=this,s=n[e];return s&&s.forEach(a=>{let c=i[a];c&&c.setNeedsUpdate(c.id,t)}),s}_updateAttribute(e){let{attribute:t,numInstances:i}=e;if(is(vie,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&is(wie,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,is(Tie,t,i))}};var p1=class extends dc{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:t,toValue:i,duration:n,easing:s}}=this,a=s(e/n);this._value=wo(t,i,a)}};var pk=1e-5;function Ak(r,e,t,i,n){let s=e-r,c=(t-e)*n,d=-s*i;return c+d+s+e}function Eie(r,e,t,i,n){if(Array.isArray(t)){let s=[];for(let a=0;a<t.length;a++)s[a]=Ak(r[a],e[a],t[a],i,n);return s}return Ak(r,e,t,i,n)}function mk(r,e){if(Array.isArray(r)){let t=0;for(let i=0;i<r.length;i++){let n=r[i]-e[i];t+=n*n}return Math.sqrt(t)}return Math.abs(r-e)}var A1=class extends dc{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:t,damping:i,stiffness:n}=this.settings,{_prevValue:s=e,_currValue:a=e}=this,c=Eie(s,a,t,i,n),d=mk(c,t),p=mk(c,a);d<pk&&p<pk&&(c=t,this.end()),this._prevValue=a,this._currValue=c}};var Sie={interpolation:p1,spring:A1},m1=class{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,n){let{transitions:s}=this;if(s.has(e)){let d=s.get(e),{value:p=d.settings.fromValue}=d;t=p,this.remove(e)}if(n=Av(n),!n)return;let a=Sie[n.type];if(!a){cr.error(`unsupported transition type '${n.type}'`)();return}let c=new a(this.timeline);c.start({...n,fromValue:t,toValue:i}),s.set(e,c)}remove(e){let{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){let e={};for(let[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}};function _k(r){let e=r[xl];for(let t in e){let i=e[t],{validate:n}=i;if(n&&!n(r[t],i))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function yk(r,e){let t=g1({newProps:r,oldProps:e,propTypes:r[xl],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Iie(r,e),n=!1;return i||(n=Pie(r,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:n,extensionsChanged:Mie(r,e),transitionsChanged:Cie(r,e)}}function Cie(r,e){if(!r.transitions)return!1;let t={},i=r[xl],n=!1;for(let s in r.transitions){let a=i[s],c=a&&a.type;(c==="number"||c==="color"||c==="array")&&y4(r[s],e[s],a)&&(t[s]=!0,n=!0)}return n?t:!1}function g1({newProps:r,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:n="props"}){if(e===r)return!1;if(typeof r!="object"||r===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(let s of Object.keys(r))if(!(s in t)){if(!(s in e))return`${n}.${s} added`;let a=y4(r[s],e[s],i[s]);if(a)return`${n}.${s} ${a}`}for(let s of Object.keys(e))if(!(s in t)){if(!(s in r))return`${n}.${s} dropped`;if(!Object.hasOwnProperty.call(r,s)){let a=y4(r[s],e[s],i[s]);if(a)return`${n}.${s} ${a}`}}return!1}function y4(r,e,t){let i=t&&t.equal;return i&&!i(r,e,t)||!i&&(i=r&&e&&r.equals,i&&!i.call(r,e))?"changed deeply":!i&&e!==r?"changed shallowly":null}function Iie(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1,{dataComparator:i,_dataDiff:n}=r;return i?i(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&n&&(t=n(r.data,e.data)||t),t}function Pie(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&gk(r,e,"all"))return{all:!0};let t={},i=!1;for(let n in r.updateTriggers)n!=="all"&&gk(r,e,n)&&(t[n]=!0,i=!0);return i?t:!1}function Mie(r,e){if(e===null)return!0;let t=e.extensions,{extensions:i}=r;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(t[n]))return!0;return!1}function gk(r,e,t){let i=r.updateTriggers[t];i=i??{};let n=e.updateTriggers[t];return n=n??{},g1({oldProps:n,newProps:i,triggerName:t})}var Rie="count(): argument not an object",Bie="count(): argument not a container";function xk(r){if(!Oie(r))throw new Error(Rie);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(Lie(r))return Object.keys(r).length;throw new Error(Bie)}function Lie(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function Oie(r){return r!==null&&typeof r=="object"}function x4(r,e){if(!e)return r;let t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){let i=t.modules.findIndex(n=>n.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{let i={...r.inject};for(let n in e.inject)i[n]=(i[n]||"")+e.inject[n];t.inject=i}return t}var Die={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},b4={};function bk(r,e,t,i){if(t instanceof tn)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let n=null;t.compressed&&(n={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});let s=e.createTexture({...t,sampler:{...Die,...n,...i},mipmaps:!0});return b4[s.id]=r,s}function vk(r,e){!e||!(e instanceof tn)||b4[e.id]===r&&(e.delete(),delete b4[e.id])}var kie={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||v4(r)&&(r.length===3||r.length===4)},equal(r,e,t){return hn(r,e,1)}},accessor:{validate(r,e){let t=bv(r);return t==="function"||t===bv(e.value)},equal(r,e,t){return typeof e=="function"?!0:hn(r,e,1)}},array:{validate(r,e){return e.optional&&!r||v4(r)},equal(r,e,t){let{compare:i}=t,n=Number.isInteger(i)?i:i?1:0;return i?hn(r,e,n):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;let{compare:i}=t,n=Number.isInteger(i)?i:i?1:0;return i?hn(r,e,n):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;let{dataTransform:i}=t.props;return i?i(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{let i=t.context;return!i||!i.device?null:bk(t.id,i.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{vk(t.id,r)}}};function wk(r){let e={},t={},i={};for(let[n,s]of Object.entries(r)){let a=s?.deprecatedFor;if(a)i[n]=Array.isArray(a)?a:[a];else{let c=Fie(n,s);e[n]=c,t[n]=c.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function Fie(r,e){switch(bv(e)){case"object":return _1(r,e);case"array":return _1(r,{type:"array",value:e,compare:!1});case"boolean":return _1(r,{type:"boolean",value:e});case"number":return _1(r,{type:"number",value:e});case"function":return _1(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function _1(r,e){return"type"in e?{name:r,...kie[e.type],...e}:"value"in e?{name:r,type:bv(e.value),...e}:{name:r,type:"object",value:e}}function v4(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function bv(r){return v4(r)?"array":r===null?"null":typeof r}function Tk(r,e){let t;for(let s=e.length-1;s>=0;s--){let a=e[s];"extensions"in a&&(t=a.extensions)}let i=w4(r.constructor,t),n=Object.create(i);n[R0]=r,n[Au]={},n[fc]={};for(let s=0;s<e.length;++s){let a=e[s];for(let c in a)n[c]=a[c]}return Object.freeze(n),n}var Nie="_mergedDefaultProps";function w4(r,e){if(!(r instanceof vv.constructor))return{};let t=Nie;if(e)for(let n of e){let s=n.constructor;s&&(t+=`:${s.extensionName||s.name}`)}let i=Ek(r,t);return i||(r[t]=zie(r,e||[]))}function zie(r,e){if(!r.prototype)return null;let i=Object.getPrototypeOf(r),n=w4(i),s=Ek(r,"defaultProps")||{},a=wk(s),c=Object.assign(Object.create(null),n,a.defaultProps),d=Object.assign(Object.create(null),n?.[xl],a.propTypes),p=Object.assign(Object.create(null),n?.[Vb],a.deprecatedProps);for(let b of e){let T=w4(b.constructor);T&&(Object.assign(c,T),Object.assign(d,T[xl]),Object.assign(p,T[Vb]))}return Uie(c,r),jie(c,d),Vie(c,p),c[xl]=d,c[Vb]=p,e.length===0&&!T4(r,"_propTypes")&&(r._propTypes=d),c}function Uie(r,e){let t=Hie(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function Vie(r,e){for(let t in e)Object.defineProperty(r,t,{enumerable:!1,set(i){let n=`${this.id}: ${t}`;for(let s of e[t])T4(this,s)||(this[s]=i);cr.deprecated(n,e[t].join("/"))()}})}function jie(r,e){let t={},i={};for(let n in e){let s=e[n],{name:a,value:c}=s;s.async&&(t[a]=c,i[a]=Gie(a))}r[yh]=t,r[Au]={},Object.defineProperties(r,i)}function Gie(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||dv(e)?this[Au][r]=e:this[fc][r]=e},get(){if(this[fc]){if(r in this[fc])return this[fc][r]||this[yh][r];if(r in this[Au]){let e=this[R0]&&this[R0].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[yh][r]}}return this[yh][r]}}}function T4(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Ek(r,e){return T4(r,e)&&r[e]}function Hie(r){let e=r.componentName;return e||cr.warn(`${r.name}.componentName not specified`)(),e||r.name}var Wie=0,y1=class{constructor(...e){this.props=Tk(this,e),this.id=this.props.id,this.count=Wie++}clone(e){let{props:t}=this,i={};for(let n in t[yh])n in t[fc]?i[n]=t[fc][n]:n in t[Au]&&(i[n]=t[Au][n]);return new this.constructor({...t,...i,...e})}};y1.componentName="Component";y1.defaultProps={};var vv=y1;var $ie=Object.freeze({}),x1=class{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||$ie}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){let t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(let t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[R0]||this.component;let t=e[fc]||{},i=e[Au]||e,n=e[yh]||{};for(let s in t){let a=t[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,a),t[s]=this.getAsyncProp(s)}for(let s in i){let a=i[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(dv(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){let i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();let i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){let n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){let i=this.asyncProps[e];if(i){i.pendingLoadCount++;let n=i.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,n),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}let i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;let n=i.pendingLoadCount,s=[],a=0;for await(let c of t){if(!this.component)return;let{dataTransform:d}=this.component.props;d?s=d(c,s):s=s.concat(c),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(e,s,n)}this._onResolve(e,s)}_postProcessValue(e,t){let i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){let n=this.component&&this.component.props[xl];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}};var b1=class extends x1{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){let i=this.layer,n=i?.props.fetch;return n?n(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){let i=this.layer;if(i){let n=i.props.onDataLoad;e==="data"&&n&&n(t,{propName:e,layer:i})}}_onError(e,t){let i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}};var qie="layer.changeFlag",Zie="layer.initialize",Xie="layer.update",Yie="layer.finalize",Kie="layer.matched",Sk=2**24-1,Qie=Object.freeze([]),Jie=hu(({oldViewport:r,viewport:e})=>r.equals(e)),_c=new Uint8ClampedArray(0),ene={data:{type:"data",value:Qie,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:t,loaders:i,loadOptions:n,signal:s})=>{let{resourceManager:a}=t.context;n=n||t.getLoadOptions(),i=i||t.props.loaders,s&&(n={...n,fetch:{...n?.fetch,signal:s}});let c=a.contains(r);return!c&&!n&&(a.add({resourceId:r,data:oo(r,i),persistent:!1}),c=!0),c?a.subscribe({resourceId:r,onChange:d=>t.internalState?.reloadAsyncProp(e,d),consumerId:t.id,requestId:e}):oo(r,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:br.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},v1=class extends vv{constructor(){super(...arguments),this.internalState=null,this.lifecycle=qf.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){An(this.internalState);let t=this.internalState.viewport||this.context.viewport,i=YC(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,s,a]=E0(i,t.pixelProjectionMatrix);return e.length===2?[n,s]:[n,s,a]}unproject(e){return An(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){An(this.internalState);let i=this.internalState.viewport||this.context.viewport;return zO(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===br.DEFAULT||e===br.LNGLAT||e===br.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){An(e instanceof Uint8Array);let[t,i,n]=e;return t+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:xk(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=x4(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let t of this.props.extensions)e=x4(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(let n of i)t.invalidateAll(n);else t.invalidateAll();if(t){let{props:n}=e,s=this.internalState.hasPickingBuffer,a=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(s!==a){this.internalState.hasPickingBuffer=a;let{pickingColors:c,instancePickingColors:d}=t.attributes,p=c||d;p&&(a&&p.constant&&(p.constant=!1,t.invalidate(p.id)),!p.value&&!a&&(p.constant=!0,p.value=[0,0,0]))}}}finalizeState(e){for(let i of this.getModels())i.destroy();let t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){let{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let t=this.internalState.viewport;this.internalState.viewport=e,(!t||!Jie({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(let i in e)e[i].layoutChanged()&&(t=!0);for(let i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let t=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});let s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let t=e.update(),i=Object.create(this.props);for(let n in t)Object.defineProperty(i,n,{value:t[n]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;let i=Math.floor(_c.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>Sk&&cr.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),_c=hc.allocate(_c,t,{size:4,copy:!0,maxCount:Math.max(t,Sk)});let n=Math.floor(_c.length/4),s=[0,0,0];for(let a=i;a<n;a++)this.encodePickingColor(a,s),_c[a*4+0]=s[0],_c[a*4+1]=s[1],_c[a*4+2]=s[2],_c[a*4+3]=0}e.value=_c.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){let c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),t=c.getAttributes()}let n=e.userData?.excludeAttributes||{},s={},a={};for(let c in t){if(n[c])continue;let d=t[c].getValue();for(let p in d){let b=d[p];b instanceof Hi?t[c].settings.isIndexed?e.setIndexBuffer(b):s[p]=b:b&&(a[p]=b)}}e.setAttributes(s),e.setConstantAttributes(a)}disablePickingIndex(e){let t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}let{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n,a=s&&t.attributes&&t.attributes[s.id];if(a&&a.value){let c=a.value,d=this.encodePickingColor(e);for(let p=0;p<t.length;p++){let b=s.getVertexOffset(p);c[b]===d[0]&&c[b+1]===d[1]&&c[b+2]===d[2]&&this._disablePickingIndex(p)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,n=t||i;if(!n)return;let s=n.getVertexOffset(e),a=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(a-s),s)}restorePickingColors(){let{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==_c.buffer&&(i.value=_c.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){An(!this.internalState),An(Number.isFinite(this.props.coordinateSystem)),is(Zie,this);let e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new b1({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(cr.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new m1(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){is(Kie,this,this===e);let{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(is(Xie,this,e),!e)return;let t=this.props,i=this.context,n=this.internalState,s=i.viewport,a=this._updateUniformTransition();n.propsInTransition=a,i.viewport=n.viewport||s,this.props=a;try{let c=this._getUpdateParams(),d=this.getModels();if(i.device)this.updateState(c);else try{this.updateState(c)}catch{}for(let b of this.props.extensions)b.updateState.call(this,c,b);this.setNeedsRedraw(),this._updateAttributes();let p=this.getModels()[0]!==d[0];this._postUpdate(c,p)}finally{i.viewport=s,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){is(Yie,this),this.finalizeState(this.context);for(let e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();let s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);let{getPolygonOffset:c}=this.props,d=c&&c(i)||[0,0];a.device instanceof gc&&a.device.setParametersWebGL({polygonOffset:d});for(let p of this.getModels())p.device.type==="webgpu"?p.setParameters({...p.parameters,...n}):p.setParameters(n);if(a.device instanceof gc)a.device.withParametersWebGL(n,()=>{let p={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:n,context:a};for(let b of this.props.extensions)b.draw.call(this,p,b);this.draw(p)});else{let p={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:n,context:a};for(let b of this.props.extensions)b.draw.call(this,p,b);this.draw(p)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:t}=this.internalState;for(let n in e)if(e[n]){let s=!1;switch(n){case"dataChanged":let a=e[n],c=t[n];a&&Array.isArray(c)&&(t.dataChanged=Array.isArray(a)?c.concat(a):a,s=!0);default:t[n]||(t[n]=e[n],s=!0)}s&&is(qie,this,n,e)}let i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){let i=yk(e,t);if(i.updateTriggersChanged)for(let n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(i.transitionsChanged)for(let n in i.transitionsChanged)this.internalState.uniformTransitions.add(n,t[n],e[n],e.transitions?.[n]);return this.setChangeFlags(i)}validateProps(){_k(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new bl(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){let{props:i,oldProps:n}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());let{autoHighlight:a,highlightedObjectIndex:c,highlightColor:d}=i;if(t||n.autoHighlight!==a||n.highlightedObjectIndex!==c||n.highlightColor!==d){let p={};Array.isArray(d)&&(p.highlightColor=d),(t||n.autoHighlight!==a||c!==n.highlightedObjectIndex)&&(p.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:p})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;let i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(t=t||n,t)for(let s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};v1.defaultProps=ene;v1.layerName="Layer";var sn=v1;var tne="compositeLayer.renderLayers",wv=class extends sn{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){let{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){let t={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,n)}return e}getSubLayerProps(e={}){let{opacity:t,pickable:i,visible:n,parameters:s,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:d,highlightColor:p,coordinateSystem:b,coordinateOrigin:T,wrapLongitude:B,positionFormat:z,modelMatrix:G,extensions:Z,fetch:q,operation:re,_subLayerProps:ee}=this.props,ae={id:"",updateTriggers:{},opacity:t,pickable:i,visible:n,parameters:s,getPolygonOffset:a,highlightedObjectIndex:c,autoHighlight:d,highlightColor:p,coordinateSystem:b,coordinateOrigin:T,wrapLongitude:B,positionFormat:z,modelMatrix:G,extensions:Z,fetch:q,operation:re},me=ee&&e.id&&ee[e.id],Le=me&&me.updateTriggers,je=e.id||"sublayer";if(me){let Je=this.props[xl],J=e.type?e.type._propTypes:{};for(let te in me){let X=J[te]||Je[te];X&&X.type==="accessor"&&(me[te]=this.getSubLayerAccessor(me[te]))}}Object.assign(ae,e,me),ae.id=`${this.props.id}-${je}`,ae.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...Le};for(let Je of Z){let J=Je.getSubLayerProps.call(this,Je);J&&Object.assign(ae,J,{updateTriggers:Object.assign(ae.updateTriggers,J.updateTriggers)})}return ae}_updateAutoHighlight(e){for(let t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers,n=!i||this.needsUpdate();if(n){let s=this.renderLayers();i=ma(s,Boolean),this.internalState.subLayers=i}is(tne,this,n,i);for(let s of i)s.parent=this}};wv.layerName="CompositeLayer";var Zn=wv;var Tv=Math.PI/180,Ck=180/Math.PI,Ev=6370972,F0=256;function rne(){let r=F0/Ev,e=Math.PI/180*F0;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}var Qf=class extends Ha{constructor(e={}){let{longitude:t=0,zoom:i=0,nearZMultiplier:n=.5,farZMultiplier:s=1,resolution:a=10}=e,{latitude:c=0,height:d,altitude:p=1.5,fovy:b}=e;c=Math.max(Math.min(c,_l),-_l),d=d||1,b?p=Cp(b):b=mh(p);let T=1/Math.PI/Math.cos(c*Math.PI/180),B=Math.pow(2,i)*T,z=e.nearZ??n,G=e.farZ??(p+F0*2*B/d)*s,Z=new vr().lookAt({eye:[0,-p,0],up:[0,0,1]});Z.rotateX(c*Tv),Z.rotateZ(-t*Tv),Z.scale(B/d),super({...e,height:d,viewMatrix:Z,longitude:t,latitude:c,zoom:i,distanceScales:rne(),fovy:b,focalDistance:p,near:z,far:G}),this.scale=B,this.latitude=c,this.longitude=t,this.resolution=a}get projectionMode(){return Ws.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),n=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),a=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],n[0],a[0]),Math.min(i[1],s[1],n[1],a[1]),Math.max(i[0],s[0],n[0],a[0]),Math.max(i[1],s[1],n[1],a[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){let[n,s,a]=e,c=t?s:this.height-s,{pixelUnprojectionMatrix:d}=this,p;if(Number.isFinite(a))p=E4(d,[n,c,a,1]);else{let z=E4(d,[n,c,-1,1]),G=E4(d,[n,c,1,1]),Z=((i||0)/Ev+1)*F0,q=To.sqrLen(To.sub([],z,G)),re=To.sqrLen(z),ee=To.sqrLen(G),me=4*((4*re*ee-(q-re-ee)**2)/16)/q,Le=Math.sqrt(re-me),je=Math.sqrt(Math.max(0,Z*Z-me)),Je=(Le-je)/Math.sqrt(q);p=To.lerp([],z,G,Je)}let[b,T,B]=this.unprojectPosition(p);return Number.isFinite(a)?[b,T,B]:Number.isFinite(i)?[b,T,i]:[b,T]}projectPosition(e){let[t,i,n=0]=e,s=t*Tv,a=i*Tv,c=Math.cos(a),d=(n/Ev+1)*F0;return[Math.sin(s)*c*d,-Math.cos(s)*c*d,Math.sin(a)*d]}unprojectPosition(e){let[t,i,n]=e,s=To.len(e),a=Math.asin(n/s),d=Math.atan2(t,-i)*Ck,p=a*Ck,b=(s/F0-1)*Ev;return[d,p,b]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){let i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}};function E4(r,e){let t=Aa.transformMat4([],e,r);return Aa.scale(t,t,1/t[3]),t}var S4=class extends X_{applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=ao(n,i,t);let{longitude:s,latitude:a}=e;return(s<-180||s>180)&&(e.longitude=LO(s+180,360)-180),e.latitude=ao(a,-_l,_l),e}},w1=class extends Op{constructor(){super(...arguments),this.ControllerState=S4,this.transition={transitionDuration:300,transitionInterpolator:new vh(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}};var Sv=class extends Bp{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?fu:Qf}get ControllerType(){return w1}};Sv.displayName="GlobeView";var C4=Sv;var T1=class{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&hn(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){let{defaultProps:t}=e.constructor,i={updateTriggers:{}};for(let n in t)if(n in this.props){let s=t[n],a=this.props[n];i[n]=a,s&&s.type==="accessor"&&(i.updateTriggers[n]=this.props.updateTriggers[n],typeof a=="function"&&(i[n]=this.getSubLayerAccessor(a)))}return i}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}};T1.defaultProps={};T1.extensionName="LayerExtension";var I4=T1;var Jf=class{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;let{attributes:t={}}=e;this.typedArrayManager=hc,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:t,buffers:i={},getGeometry:n,geometryBuffer:s,positionFormat:a,dataChanged:c,normalize:d=!0}=this.opts;if(this.data=t,this.getGeometry=n,this.positionSize=s&&s.size||(a==="XY"?2:3),this.buffers=i,this.normalize=d,s&&(An(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),d||(i.vertexPositions=s)),this.geometryBuffer=i.vertexPositions,Array.isArray(c))for(let p of c)this._rebuildGeometry(p);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){let t=e.value||e;return ArrayBuffer.isView(t)?pv(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){let{attributes:i,buffers:n,_attributeDefs:s,typedArrayManager:a}=this;for(let c in s)if(c in n)a.release(i[c]),i[c]=null;else{let d=s[c];d.copy=t,i[c]=a.allocate(i[c],e,d)}}_forEachGeometry(e,t,i){let{data:n,getGeometry:s}=this,{iterable:a,objectInfo:c}=gs(n,t,i);for(let d of a){c.index++;let p=s?s(d,c):null;e(p,c.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:n}=this,{data:s,geometryBuffer:a}=this,{startRow:c=0,endRow:d=1/0}=e||{},p={};if(e||(t=[0],i=[0]),this.normalize||!a)this._forEachGeometry((T,B)=>{let z=T&&this.normalizeGeometry(T);p[B]=z,i[B+1]=i[B]+(z?this.getGeometrySize(z):0)},c,d),n=i[i.length-1];else if(i=s.startIndices,n=i[s.length]||0,ArrayBuffer.isView(a))n=n||a.length/this.positionSize;else if(a instanceof Hi){let T=this.positionSize*4;n=n||a.byteLength/T}else if(a.buffer){let T=a.stride||this.positionSize*4;n=n||a.buffer.byteLength/T}else if(a.value){let T=a.value,B=a.stride/T.BYTES_PER_ELEMENT||this.positionSize;n=n||T.length/B}this._allocate(n,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=n;let b={};this._forEachGeometry((T,B)=>{let z=p[B]||T;b.vertexStart=i[B],b.indexStart=t[B];let G=B<i.length-1?i[B+1]:n;b.geometrySize=G-i[B],b.geometryIndex=B,this.updateGeometryAttributes(z,b)},c,d),this.vertexCount=t[t.length-1]}};var P4=512,ine=Math.PI/180;function Cv({map:r,gl:e,deck:t}){if(r.__deck)return r.__deck;let i=t?.props._customRender,n=t?.props.onLoad,s={...t?.props,_customRender:()=>{r.triggerRepaint(),i?.("")}};s.parameters={...Iv(r,!0),...s.parameters},s.views||(s.views=E1(r));let a;return(!t||t.props.gl===e)&&(Object.assign(s,{gl:e,width:null,height:null,touchAction:"unset",viewState:N0(r)}),t?.isInitialized?Ik(t,r):s.onLoad=()=>{n?.(),Ik(a,r)}),t?(a=t,t.setProps(s),t.userData.isExternal=!0):(a=new D0(s),r.on("remove",()=>{M4(r)})),a.userData.mapboxLayers=new Set,r.__deck=a,r.on("render",()=>{a.isInitialized&&sne(a,r)}),a}function Ik(r,e){let t=()=>{r.isInitialized?one(r,e):e.off("move",t)};e.on("move",t)}function M4(r){r.__deck?.finalize(),r.__deck=null}function Iv(r,e){let t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return Lk(r)==="globe"&&(t.cullMode="back"),t}function Pk(r,e){r.userData.mapboxLayers.add(e),R4(r)}function Mk(r,e){r.userData.mapboxLayers.delete(e),R4(r)}function Rk(r,e){R4(r)}function Bk(r,e,t,i){let{currentViewport:n}=r.userData,s=!1;n||(n=Ok(r,e,i),r.userData.currentViewport=n,s=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:a})=>t.id===a.id||a.props.operation.includes("terrain"),clearStack:s,clearCanvas:!1})}function Lk(r){let e=r.getProjection?.(),t=e?.type||e?.name;if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function E1(r){return Lk(r)==="globe"?new C4({id:"mapbox"}):new K_({id:"mapbox"})}function N0(r){let{lng:e,lat:t}=r.getCenter(),i={longitude:(e+540)%360-180,latitude:t,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return r.getTerrain?.()&&nne(r,i),i}function nne(r,e){if(r.getFreeCameraOptions){let{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;let i=r.transform.height,{longitude:n,latitude:s,pitch:a}=e,c=t.x*P4,d=(1-t.y)*P4,p=t.z*P4,b=$s([n,s]),T=c-b[0],B=d-b[1],z=Math.sqrt(T*T+B*B),G=a*ine,Z=1.5*i,q=G<.001?Z*Math.cos(G)/p:Z*Math.sin(G)/z;e.zoom=Math.log2(q);let re=Z*Math.cos(G)/q,ee=p-re;e.position=[0,0,ee/Sp(s)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function Ok(r,e,t){let i=N0(e),n=E1(e);t&&(n.props.nearZMultiplier=.2);let s=t?.nearZ??e.transform._nearZ,a=t?.farZ??e.transform._farZ;return Number.isFinite(s)&&(i.nearZ=s/e.transform.height,i.farZ=a/e.transform.height),n.makeViewport({width:r.width,height:r.height,viewState:i})}function sne(r,e){let{mapboxLayers:t,isExternal:i}=r.userData;if(i){let n=Array.from(t,b=>b.id),a=ma(r.props.layers,Boolean).some(b=>b&&!n.includes(b.id)),c=r.getViewports(),d=c.findIndex(b=>b.id==="mapbox"),p=c.length>1||d<0;(a||p)&&(d>=0&&(c=c.slice(),c[d]=Ok(r,e)),r._drawLayers("mapbox-repaint",{viewports:c,layerFilter:b=>(!r.props.layerFilter||r.props.layerFilter(b))&&(b.viewport.id!=="mapbox"||!n.includes(b.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function one(r,e){r.setProps({viewState:N0(e)}),r.needsRedraw({clearRedrawFlags:!0})}function R4(r){if(r.userData.isExternal)return;let e=[];r.userData.mapboxLayers.forEach(t=>{let i=t.props.type,n=new i(t.props);e.push(n)}),r.setProps({layers:e})}var S1=class{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=Cv({map:e,gl:t,deck:this.props.deck}),Pk(this.deck,this)}onRemove(){this.deck&&Mk(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&Rk(this.deck,this)}render(e,t){Bk(this.deck,this.map,this,t)}};var B4="__UNDEFINED__";function C1(r,e,t,i){if(!r||!e||!r.style||!r.style._loaded)return;let n=ma(i,Boolean);if(t!==i){let c=ma(t,Boolean),d=new Set(c.map(p=>p.id));for(let p of n)d.delete(p.id);for(let p of d)r.getLayer(p)&&r.removeLayer(p)}for(let c of n){let d=r.getLayer(c.id);d?(d.implementation||d).setProps(c.props):r.addLayer(new S1({id:c.id,deck:e,slot:c.props.slot}),c.props.beforeId)}let s=r.style._order,a={};for(let c of n){let{beforeId:d}=c.props;(!d||!s.includes(d))&&(d=B4),a[d]=a[d]||[],a[d].push(c.id)}for(let c in a){let d=a[c],p=c===B4?s.length:s.indexOf(c),b=c===B4?void 0:c;for(let T=d.length-1;T>=0;T--){let B=d[T],z=s.indexOf(B);z!==p-1&&(r.moveLayer(B,b),z>p&&p++),p--,b=B}}}var zp=class{constructor(e){this._handleStyleChange=()=>{C1(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:n,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${s}px`})}},this._updateViewState=()=>{let n=this._deck,s=this._map;n&&s&&(n.setProps({views:this._props.views||E1(s),viewState:N0(s)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{let s=this._deck;if(!s||!s.isInitialized)return;let a={type:n.type,offsetCenter:n.point,srcEvent:n},c=this._lastMouseDownPoint;switch(!n.point&&c&&(a.deltaX=n.originalEvent.clientX-c.clientX,a.deltaY=n.originalEvent.clientY-c.clientY,a.offsetCenter={x:c.x+a.deltaX,y:c.y+a.deltaY}),a.type){case"mousedown":s._onPointerDown(a),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":a.type="panstart",s._onEvent(a);break;case"drag":a.type="panmove",s._onEvent(a);break;case"dragend":a.type="panend",s._onEvent(a);break;case"click":a.tapCount=1,s._onEvent(a);break;case"dblclick":a.type="click",a.tapCount=2,s._onEvent(a);break;case"mousemove":a.type="pointermove",s._onPointerMove(a);break;case"mouseout":a.type="pointerleave",s._onPointerMove(a);break;default:return}};let{interleaved:t=!1,...i}=e;this._interleaved=t,this._props=i}setProps(e){this._interleaved&&e.layers&&C1(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...Iv(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new D0({...this._props,parent:t,parameters:{...Iv(e,!1),...this._props.parameters},views:this._props.views||E1(e),viewState:N0(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){let t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&cr.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Cv({map:e,gl:t,deck:new D0({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),C1(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),C1(e,this._deck,this._props.layers,[]),M4(e)}getDefaultPosition(){return"top-left"}pickObject(e){return An(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return An(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return An(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};function z0(r,e=""){if(!r)throw new Error(`JSON conversion error ${e}`)}function kk(r,e){let t=lne(e),i=r;for(let n of t)i=ane(i)?i[n]:void 0;return i}function ane(r){return r!==null&&typeof r=="object"}var Dk={};function lne(r){if(typeof r=="string"){let e=Dk[r];return e||(e=r.split("."),Dk[r]=e),e}return Array.isArray(r)?r:[r]}var L4=Tf(Fk(),1);var Nk={"||":(r,e)=>r||e,"&&":(r,e)=>r&&e,"|":(r,e)=>r|e,"^":(r,e)=>r^e,"&":(r,e)=>r&e,"==":(r,e)=>r==e,"!=":(r,e)=>r!=e,"===":(r,e)=>r===e,"!==":(r,e)=>r!==e,"<":(r,e)=>r<e,">":(r,e)=>r>e,"<=":(r,e)=>r<=e,">=":(r,e)=>r>=e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e},cne={"-":r=>-r,"+":r=>+r,"~":r=>~r,"!":r=>!r};function zk(r,e){return r.map(function(t){return uo(t,e)})}function Uk(r,e){let t=uo(r.object,e),i;if(r.computed?i=uo(r.property,e):i=r.property.name,/^__proto__|prototype|constructor$/.test(i))throw Error(`Access to member "${i}" disallowed.`);return[t,t[i]]}function uo(r,e){let t=r;switch(t.type){case"ArrayExpression":return zk(t.elements,e);case"BinaryExpression":return Nk[t.operator](uo(t.left,e),uo(t.right,e));case"CallExpression":let i,n,s;return t.callee.type==="MemberExpression"?(s=Uk(t.callee,e),i=s[0],n=s[1]):n=uo(t.callee,e),typeof n!="function"?void 0:n.apply(i,zk(t.arguments,e));case"ConditionalExpression":return uo(t.test,e)?uo(t.consequent,e):uo(t.alternate,e);case"Identifier":return e[t.name];case"Literal":return t.value;case"LogicalExpression":return t.operator==="||"?uo(t.left,e)||uo(t.right,e):t.operator==="&&"?uo(t.left,e)&&uo(t.right,e):Nk[t.operator](uo(t.left,e),uo(t.right,e));case"MemberExpression":return Uk(t,e)[1];case"ThisExpression":return e;case"UnaryExpression":return cne[t.operator](uo(t.argument,e));default:return}}var O4={"-":r=>r};function P1(r,e){if(r in O4)return O4[r];let t,i=(0,L4.default)(r);return i.type==="Identifier"?t=n=>kk(n,r):(D4(i,n=>{if(n.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),t=n=>uo(i,n)),O4[r]=t,t}function D4(r,e){if(Array.isArray(r))r.forEach(t=>D4(t,e));else if(r&&typeof r=="object"){r.type&&e(r);for(let t in r)D4(r[t],e)}}var U0="@@=",k4="@@#",Vk="@@type",Mv="@@function";var jk=r=>r&&typeof r=="object",bu=class{constructor(...e){this.typeKey=Vk,this.functionKey=Mv,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=P1,this.preProcessClassProps=(t,i)=>i,this.postProcessConvertedJson=t=>t;for(let t of e)this.merge(t)}merge(e){for(let t in e)switch(t){case"layers":case"views":Object.assign(this.classes,e[t]);break;default:if(t in this){let i=e[t];this[t]=jk(this[t])?Object.assign(this[t],i):i}}}validate(e){return z0(!this.typeKey||typeof this.typeKey=="string"),z0(jk(this.classes)),!0}};function une(r){return typeof r=="string"&&r.startsWith(U0)}function hne(r){return r.replace(U0,"")}function Rv(r,e){let t={};for(let i in r){let n=r[i];une(n)&&(n=hne(n),n=P1(n,e)),t[i]=n}return t}function Gk(r,e,t){let i=t.classes[r],n=t.reactComponents[r];if(!i&&!n){let{log:s}=t;if(s){let a=JSON.stringify(e,null,0).slice(0,40);s.warn(`JSON converter: No registered class of type ${r}(${a}...)  `)}return null}return i?fne(i,e,t):dne(n,e,t)}function fne(r,e,t){return t.preProcessClassProps&&(e=t.preProcessClassProps(r,e,t)),e=Rv(e,t),new r(e)}function dne(r,e,t){let{React:i}=t,{children:n=[]}=e;return delete e.children,t.preProcessClassProps&&(e=t.preProcessClassProps(r,e,t)),e=Rv(e,t),i.createElement(r,e,n)}function Hk(r,e,t){let i=t.functions[r];if(!i){let{log:n}=t;if(n){let s=JSON.stringify(e,null,0).slice(0,40);n.warn(`JSON converter: No registered function ${r}(${s}...)  `)}return null}return i(e)}function F4(r){return typeof r=="string"?JSON.parse(r):r}var N4=r=>r&&typeof r=="object",V0=class{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof bu?e.configuration:new bu(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;let t=F4(e),i=pne(t,this.configuration);return i=this.configuration.postProcessConvertedJson(i),this.convertedJson=i,i}convertJson(e){return this.convert(e)}};function pne(r,e){return e=new bu(e),z4(r,"",e)}function z4(r,e,t){return Array.isArray(r)?r.map((i,n)=>z4(i,String(n),t)):Ane(r,t)?mne(r,t):N4(r)?Mv in r?gne(r,t):U4(r,t):typeof r=="string"?_ne(r,e,t):r}function Ane(r,e){let{typeKey:t}=e;return N4(r)&&!!r[t]}function mne(r,e){let{typeKey:t}=e,i=r[t],n={...r};return delete n[t],n=U4(n,e),Gk(i,n,e)}function gne(r,e){let{functionKey:t}=e,i=r[t],n={...r};return delete n[t],n=U4(n,e),Hk(i,n,e)}function U4(r,e){z0(N4(r));let t={};for(let i in r){let n=r[i];t[i]=z4(n,i,e)}return t}function _ne(r,e,t){if(r.startsWith(U0)&&t.convertFunction)return r=r.replace(U0,""),t.convertFunction(r,t);if(r.startsWith(k4)){if(r=r.replace(k4,""),t.constants[r])return t.constants[r];let[i,n]=r.split(".");return t.enumerations[i][n]}return r}var rI={};Ms(rI,{ArcLayer:()=>Lv,BitmapLayer:()=>Ov,ColumnLayer:()=>vu,GeoJsonLayer:()=>Hp,GridCellLayer:()=>UF,IconLayer:()=>j0,LineLayer:()=>dF,PathLayer:()=>wu,PointCloudLayer:()=>Dv,PolygonLayer:()=>nd,ScatterplotLayer:()=>kv,SolidPolygonLayer:()=>id,TextLayer:()=>rw,_MultiIconLayer:()=>Jv,_TextBackgroundLayer:()=>tw});var Wk=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,$k={name:"arc",vs:Wk,fs:Wk,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}};var qk=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Zk=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Bv=[0,0,0,255],yne={getSourcePosition:{type:"accessor",value:r=>r.sourcePosition},getTargetPosition:{type:"accessor",value:r=>r.targetPosition},getSourceColor:{type:"accessor",value:Bv},getTargetColor:{type:"accessor",value:Bv},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},M1=class extends sn{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:qk,fs:Zk,modules:[Pi,wn,$k]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Bv},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Bv},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:t,widthScale:i,widthMinPixels:n,widthMaxPixels:s,greatCircle:a,wrapLongitude:c,numSegments:d}=this.props,p={numSegments:d,widthUnits:Pn[t],widthScale:i,widthMinPixels:n,widthMaxPixels:s,greatCircle:a,useShortestPath:c},b=this.state.model;b.shaderInputs.setProps({arc:p}),b.setVertexCount(d*2),b.draw(this.context.renderPass)}_getModel(){return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}};M1.layerName="ArcLayer";M1.defaultProps=yne;var Lv=M1;var xne=new Uint32Array([0,2,1,0,3,2]),bne=new Float32Array([0,1,0,0,1,0,1,1]);function V4(r,e){if(!e)return vne(r);let t=Math.max(Math.abs(r[0][0]-r[3][0]),Math.abs(r[1][0]-r[2][0])),i=Math.max(Math.abs(r[1][1]-r[0][1]),Math.abs(r[2][1]-r[3][1])),n=Math.ceil(t/e)+1,s=Math.ceil(i/e)+1,a=(n-1)*(s-1)*6,c=new Uint32Array(a),d=new Float32Array(n*s*2),p=new Float64Array(n*s*3),b=0,T=0;for(let B=0;B<n;B++){let z=B/(n-1);for(let G=0;G<s;G++){let Z=G/(s-1),q=wne(r,z,Z);p[b*3+0]=q[0],p[b*3+1]=q[1],p[b*3+2]=q[2]||0,d[b*2+0]=z,d[b*2+1]=1-Z,B>0&&G>0&&(c[T++]=b-s,c[T++]=b-s-1,c[T++]=b-1,c[T++]=b-s,c[T++]=b-1,c[T++]=b),b++}}return{vertexCount:a,positions:p,indices:c,texCoords:d}}function vne(r){let e=new Float64Array(12);for(let t=0;t<r.length;t++)e[t*3+0]=r[t][0],e[t*3+1]=r[t][1],e[t*3+2]=r[t][2]||0;return{vertexCount:6,positions:e,indices:xne,texCoords:bne}}function wne(r,e,t){return wo(wo(r[0],r[1],t),wo(r[3],r[2],t),e)}var Xk=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,Yk={name:"bitmap",vs:Xk,fs:Xk,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}};var Kk=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var Tne=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Qk=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${Tne}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`;var Ene={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:br.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},R1=class extends sn{getShaders(){return super.getShaders({vs:Kk,fs:Qk,modules:[Pi,wn,Yk]})}initializeState(){let e=this.getAttributeManager();e.remove(["instancePickingColors"]);let t=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:t},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:t},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:t}})}updateState({props:e,oldProps:t,changeFlags:i}){let n=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll()),e.bounds!==t.bounds){let s=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(let c in a)s&&s[c]!==a[c]&&n.invalidate(c);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==t._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{image:t}=this.props,i=e.info;if(!i.color||!t)return i.bitmap=null,i;let{width:n,height:s}=t;i.index=0;let a=Sne(i.color);return i.bitmap={size:{width:n,height:s},uv:a,pixel:[Math.floor(a[0]*n),Math.floor(a[1]*s)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:e}=this.props,t=e;return Jk(e)&&(t=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),V4(t,this.context.viewport.resolution)}_getModel(){return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){let{shaderModuleProps:t}=e,{model:i,coordinateConversion:n,bounds:s,disablePicking:a}=this.state,{image:c,desaturate:d,transparentColor:p,tintColor:b}=this.props;if(!(t.picking.isActive&&a)&&c&&i){let T={bitmapTexture:c,bounds:s,coordinateConversion:n,desaturate:d,tintColor:b.slice(0,3).map(B=>B/255),transparentColor:p.map(B=>B/255)};i.shaderInputs.setProps({bitmap:T}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){let{LNGLAT:e,CARTESIAN:t,DEFAULT:i}=br,{_imageCoordinateSystem:n}=this.props;if(n!==i){let{bounds:s}=this.props;if(!Jk(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");let a=this.context.viewport.resolution?e:t;if(n=n===e?e:t,n===e&&a===t)return{coordinateConversion:-1,bounds:s};if(n===t&&a===e){let c=$s([s[0],s[1]]),d=$s([s[2],s[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],d[0],d[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};R1.layerName="BitmapLayer";R1.defaultProps=Ene;var Ov=R1;function Sne(r){let[e,t,i]=r,n=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(t+n)/256]}function Jk(r){return Number.isFinite(r[0])}var eF=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,tF={name:"icon",vs:eF,fs:eF,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}};var rF=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`;var iF=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Cne=1024,Ine=4,nF=()=>{},sF={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Pne={x:0,y:0,width:0,height:0};function Mne(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function Rne(r,e,t,i){let n=Math.min(t/e.width,i/e.height),s=Math.floor(e.width*n),a=Math.floor(e.height*n);return n===1?{image:e,width:s,height:a}:(r.canvas.height=a,r.canvas.width=s,r.clearRect(0,0,s,a),r.drawImage(e,0,0,e.width,e.height,0,0,s,a),{image:r.canvas,width:s,height:a})}function B1(r){return r&&(r.id||r.url)}function Bne(r,e,t,i){let{width:n,height:s,device:a}=r,c=a.createTexture({format:"rgba8unorm",width:e,height:t,sampler:i,mipmaps:!0}),d=a.createCommandEncoder();return d.copyTextureToTexture({sourceTexture:r,destinationTexture:c,width:n,height:s}),d.finish(),r.destroy(),c}function oF(r,e,t){for(let i=0;i<e.length;i++){let{icon:n,xOffset:s}=e[i],a=B1(n);r[a]={...n,x:s,y:t}}}function Lne({icons:r,buffer:e,mapping:t={},xOffset:i=0,yOffset:n=0,rowHeight:s=0,canvasWidth:a}){let c=[];for(let d=0;d<r.length;d++){let p=r[d],b=B1(p);if(!t[b]){let{height:T,width:B}=p;i+B+e>a&&(oF(t,c,n),i=0,n=s+n+e,s=0,c=[]),c.push({icon:p,xOffset:i}),i=i+B+e,s=Math.max(s,T)}}return c.length>0&&oF(t,c,n),{mapping:t,rowHeight:s,xOffset:i,yOffset:n,canvasWidth:a,canvasHeight:Mne(s+n+e)}}function One(r,e,t){if(!r||!e)return null;t=t||{};let i={},{iterable:n,objectInfo:s}=gs(r);for(let a of n){s.index++;let c=e(a,s),d=B1(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!i[d]&&(!t[d]||c.url!==t[d].url)&&(i[d]={...c,source:a,sourceIndex:s.index})}return i}var L1=class{constructor(e,{onUpdate:t=nF,onError:i=nF}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Ine,this._canvasWidth=Cne,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let t=this._autoPacking?B1(e):e;return this._mapping[t]||Pne}setProps({loadOptions:e,autoPacking:t,iconAtlas:i,iconMapping:n,textureParameters:s}){e&&(this._loadOptions=e),t!==void 0&&(this._autoPacking=t),n&&(this._mapping=n),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,t){if(!this._autoPacking||typeof document>"u")return;let i=Object.values(One(e,t,this._mapping)||{});if(i.length>0){let{mapping:n,xOffset:s,yOffset:a,rowHeight:c,canvasHeight:d}=Lne({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=n,this._xOffset=s,this._yOffset=a,this._canvasHeight=d,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||sF,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Bne(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||sF)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){let t=this._canvas.getContext("2d",{willReadFrequently:!0});for(let i of e)this._pendingCount++,oo(i.url,this._loadOptions).then(n=>{let s=B1(i),a=this._mapping[s],{x:c,y:d,width:p,height:b}=a,{image:T,width:B,height:z}=Rne(t,n,p,b);this._texture?.copyExternalImage({image:T,x:c+(p-B)/2,y:d+(b-z)/2,width:B,height:z}),a.width=B,a.height=z,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}};var aF=[0,0,0,255],Dne={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:r=>r.position},getIcon:{type:"accessor",value:r=>r.icon},getColor:{type:"accessor",value:aF},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},O1=class extends sn{getShaders(){return super.getShaders({vs:rF,fs:iF,modules:[Pi,wn,tF]})}initializeState(){this.state={iconManager:new L1(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:aF},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:n}=e,s=this.getAttributeManager(),{iconAtlas:a,iconMapping:c,data:d,getIcon:p,textureParameters:b}=t,{iconManager:T}=this.state;if(typeof a=="string")return;let B=a||this.internalState.isAsyncPropLoading("iconAtlas");T.setProps({loadOptions:t.loadOptions,autoPacking:!B,iconAtlas:a,iconMapping:B?c:null,textureParameters:b}),B?i.iconMapping!==t.iconMapping&&s.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&T.packIcons(d,p),n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:t,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:s,billboard:a,alphaCutoff:c}=this.props,{iconManager:d}=this.state,p=d.getTexture();if(p){let b=this.state.model,T={iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Pn[s],sizeScale:t,sizeMinPixels:i,sizeMaxPixels:n,billboard:a,alphaCutoff:c};b.shaderInputs.setProps({icon:T}),b.draw(this.context.renderPass)}}_getModel(){let e=[-1,-1,1,-1,-1,1,1,1];return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Xi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){let t=this.getCurrentLayer()?.props.onIconError;t?t(e):cr.error(e.error.message)()}getInstanceOffset(e){let{width:t,height:i,anchorX:n=t/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[t/2-n,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){let{x:t,y:i,width:n,height:s}=this.state.iconManager.getIconMapping(e);return[t,i,n,s]}};O1.defaultProps=Dne;O1.layerName="IconLayer";var j0=O1;var kne=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,lF=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,cF={name:"line",source:kne,vs:lF,fs:lF,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}};var uF=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90\xB0: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`;var hF=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var fF=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Fne=[0,0,0,255],Nne={getSourcePosition:{type:"accessor",value:r=>r.sourcePosition},getTargetPosition:{type:"accessor",value:r=>r.targetPosition},getColor:{type:"accessor",value:Fne},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},D1=class extends sn{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:hF,fs:fF,source:uF,modules:[Pi,wn,cF]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:t,widthScale:i,widthMinPixels:n,widthMaxPixels:s,wrapLongitude:a}=this.props,c=this.state.model,d={widthUnits:Pn[t],widthScale:i,widthMinPixels:n,widthMaxPixels:s,useShortestPath:a?1:0};c.shaderInputs.setProps({line:d}),c.draw(this.context.renderPass),a&&(c.shaderInputs.setProps({line:{...d,useShortestPath:-1}}),c.draw(this.context.renderPass))}_getModel(){let e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Xi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};D1.layerName="LineLayer";D1.defaultProps=Nne;var dF=D1;var pF=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,AF={name:"pointCloud",vs:pF,fs:pF,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}};var mF=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var gF=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var _F=[0,0,0,255],yF=[0,0,1],zne={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:yF},getColor:{type:"accessor",value:_F},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Une(r){let{header:e,attributes:t}=r;if(!(!e||!t)&&(r.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){let{size:i,value:n}=t.COLOR_0;t.instanceColors={size:i,type:"unorm8",value:n}}}var k1=class extends sn{getShaders(){return super.getShaders({vs:mF,fs:gF,modules:[Pi,jf,wn,AF]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:yF},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:_F}})}updateState(e){let{changeFlags:t,props:i}=e;super.updateState(e),t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&Une(i.data)}draw({uniforms:e}){let{pointSize:t,sizeUnits:i}=this.props,n=this.state.model,s={sizeUnits:Pn[i],radiusPixels:t};n.shaderInputs.setProps({pointCloud:s}),n.draw(this.context.renderPass)}_getModel(){let e=[];for(let t=0;t<3;t++){let i=t/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Xi({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}};k1.layerName="PointCloudLayer";k1.defaultProps=zne;var Dv=k1;var xF=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,bF={name:"scatterplot",vs:xF,fs:xF,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}};var vF=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var wF=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var TF=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`;var EF=[0,0,0,255],Vne={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:r=>r.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:EF},getLineColor:{type:"accessor",value:EF},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},F1=class extends sn{getShaders(){return super.getShaders({vs:vF,fs:wF,source:TF,modules:[Pi,wn,bF]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:t,radiusScale:i,radiusMinPixels:n,radiusMaxPixels:s,stroked:a,filled:c,billboard:d,antialiasing:p,lineWidthUnits:b,lineWidthScale:T,lineWidthMinPixels:B,lineWidthMaxPixels:z}=this.props,G={stroked:a,filled:c,billboard:d,antialiasing:p,radiusUnits:Pn[t],radiusScale:i,radiusMinPixels:n,radiusMaxPixels:s,lineWidthUnits:Pn[b],lineWidthScale:T,lineWidthMinPixels:B,lineWidthMaxPixels:z},Z=this.state.model;Z.shaderInputs.setProps({scatterplot:G}),Z.draw(this.context.renderPass)}_getModel(){let e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Xi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};F1.defaultProps=Vne;F1.layerName="ScatterplotLayer";var kv=F1;var G0={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Up(r,e,t={}){return SF(r,t)!==e?(jne(r,t),!0):!1}function SF(r,e={}){return Math.sign(ed(r,e))}var N1={x:0,y:1,z:2};function ed(r,e={}){let{start:t=0,end:i=r.length,plane:n="xy"}=e,s=e.size||2,a=0,c=N1[n[0]],d=N1[n[1]];for(let p=t,b=i-s;p<i;p+=s)a+=(r[p+c]-r[b+c])*(r[p+d]+r[b+d]),b=p;return a/2}function jne(r,e){let{start:t=0,end:i=r.length,size:n=2}=e,s=(i-t)/n,a=Math.floor(s/2);for(let c=0;c<a;++c){let d=t+c*n,p=t+(s-1-c)*n;for(let b=0;b<n;++b){let T=r[d+b];r[d+b]=r[p+b],r[p+b]=T}}}function G4(r,e,t=2,i,n="xy"){let s=e&&e.length,a=s?e[0]*t:r.length,c=IF(r,0,a,t,!0,i&&i[0],n),d=[];if(!c||c.next===c.prev)return d;let p,b,T,B,z,G,Z;if(s&&(c=Zne(r,e,c,t,i,n)),r.length>80*t){B=b=r[0],z=T=r[1];for(let q=t;q<a;q+=t)G=r[q],Z=r[q+1],G<B&&(B=G),Z<z&&(z=Z),G>b&&(b=G),Z>T&&(T=Z);p=Math.max(b-B,T-z),p=p!==0?32767/p:0}return z1(c,d,t,B,z,p,0),d}function IF(r,e,t,i,n,s,a){let c,d;s===void 0&&(s=ed(r,{start:e,end:t,size:i,plane:a}));let p=N1[a[0]],b=N1[a[1]];if(n===s<0)for(c=e;c<t;c+=i)d=CF(c,r[c+p],r[c+b],d);else for(c=t-i;c>=e;c-=i)d=CF(c,r[c+p],r[c+b],d);return d&&zv(d,d.next)&&(V1(d),d=d.next),d}function Vp(r,e){if(!r)return r;e||(e=r);let t=r,i;do if(i=!1,!t.steiner&&(zv(t,t.next)||Xn(t.prev,t,t.next)===0)){if(V1(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function z1(r,e,t,i,n,s,a){if(!r)return;!a&&s&&Jne(r,i,n,s);let c=r,d,p;for(;r.prev!==r.next;){if(d=r.prev,p=r.next,s?Wne(r,i,n,s):Hne(r)){e.push(d.i/t|0),e.push(r.i/t|0),e.push(p.i/t|0),V1(r),r=p.next,c=p.next;continue}if(r=p,r===c){a?a===1?(r=$ne(Vp(r),e,t),z1(r,e,t,i,n,s,2)):a===2&&qne(r,e,t,i,n,s):z1(Vp(r),e,t,i,n,s,1);break}}}function Hne(r){let e=r.prev,t=r,i=r.next;if(Xn(e,t,i)>=0)return!1;let n=e.x,s=t.x,a=i.x,c=e.y,d=t.y,p=i.y,b=n<s?n<a?n:a:s<a?s:a,T=c<d?c<p?c:p:d<p?d:p,B=n>s?n>a?n:a:s>a?s:a,z=c>d?c>p?c:p:d>p?d:p,G=i.next;for(;G!==e;){if(G.x>=b&&G.x<=B&&G.y>=T&&G.y<=z&&H0(n,c,s,d,a,p,G.x,G.y)&&Xn(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function Wne(r,e,t,i){let n=r.prev,s=r,a=r.next;if(Xn(n,s,a)>=0)return!1;let c=n.x,d=s.x,p=a.x,b=n.y,T=s.y,B=a.y,z=c<d?c<p?c:p:d<p?d:p,G=b<T?b<B?b:B:T<B?T:B,Z=c>d?c>p?c:p:d>p?d:p,q=b>T?b>B?b:B:T>B?T:B,re=j4(z,G,e,t,i),ee=j4(Z,q,e,t,i),ae=r.prevZ,me=r.nextZ;for(;ae&&ae.z>=re&&me&&me.z<=ee;){if(ae.x>=z&&ae.x<=Z&&ae.y>=G&&ae.y<=q&&ae!==n&&ae!==a&&H0(c,b,d,T,p,B,ae.x,ae.y)&&Xn(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,me.x>=z&&me.x<=Z&&me.y>=G&&me.y<=q&&me!==n&&me!==a&&H0(c,b,d,T,p,B,me.x,me.y)&&Xn(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;ae&&ae.z>=re;){if(ae.x>=z&&ae.x<=Z&&ae.y>=G&&ae.y<=q&&ae!==n&&ae!==a&&H0(c,b,d,T,p,B,ae.x,ae.y)&&Xn(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;me&&me.z<=ee;){if(me.x>=z&&me.x<=Z&&me.y>=G&&me.y<=q&&me!==n&&me!==a&&H0(c,b,d,T,p,B,me.x,me.y)&&Xn(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function $ne(r,e,t){let i=r;do{let n=i.prev,s=i.next.next;!zv(n,s)&&PF(n,i,i.next,s)&&U1(n,s)&&U1(s,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(s.i/t|0),V1(i),V1(i.next),i=r=s),i=i.next}while(i!==r);return Vp(i)}function qne(r,e,t,i,n,s){let a=r;do{let c=a.next.next;for(;c!==a.prev;){if(a.i!==c.i&&rse(a,c)){let d=MF(a,c);a=Vp(a,a.next),d=Vp(d,d.next),z1(a,e,t,i,n,s,0),z1(d,e,t,i,n,s,0);return}c=c.next}a=a.next}while(a!==r)}function Zne(r,e,t,i,n,s){let a=[],c,d,p,b,T;for(c=0,d=e.length;c<d;c++)p=e[c]*i,b=c<d-1?e[c+1]*i:r.length,T=IF(r,p,b,i,!1,n&&n[c+1],s),T===T.next&&(T.steiner=!0),a.push(tse(T));for(a.sort(Xne),c=0;c<a.length;c++)t=Yne(a[c],t);return t}function Xne(r,e){return r.x-e.x}function Yne(r,e){let t=Kne(r,e);if(!t)return e;let i=MF(t,r);return Vp(i,i.next),Vp(t,t.next)}function Kne(r,e){let t=e,i=r.x,n=r.y,s=-1/0,a;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){let B=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(B<=i&&B>s&&(s=B,a=t.x<t.next.x?t:t.next,B===i))return a}t=t.next}while(t!==e);if(!a)return null;let c=a,d=a.x,p=a.y,b=1/0,T;t=a;do i>=t.x&&t.x>=d&&i!==t.x&&H0(n<p?i:s,n,d,p,n<p?s:i,n,t.x,t.y)&&(T=Math.abs(n-t.y)/(i-t.x),U1(t,r)&&(T<b||T===b&&(t.x>a.x||t.x===a.x&&Qne(a,t)))&&(a=t,b=T)),t=t.next;while(t!==c);return a}function Qne(r,e){return Xn(r.prev,r,e.prev)<0&&Xn(e.next,r,r.next)<0}function Jne(r,e,t,i){let n=r;do n.z===0&&(n.z=j4(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==r);n.prevZ.nextZ=null,n.prevZ=null,ese(n)}function ese(r){let e,t,i=1,n,s,a,c,d,p;do{for(s=r,r=null,p=null,n=0;s;){for(n++,c=s,a=0,t=0;t<i&&(a++,c=c.nextZ,!!c);t++);for(d=i;a>0||d>0&&c;)a!==0&&(d===0||!c||s.z<=c.z)?(e=s,s=s.nextZ,a--):(e=c,c=c.nextZ,d--),p?p.nextZ=e:r=e,e.prevZ=p,p=e;s=c}p.nextZ=null,i*=2}while(n>1);return r}function j4(r,e,t,i,n){return r=(r-t)*n|0,e=(e-i)*n|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function tse(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function H0(r,e,t,i,n,s,a,c){return(n-a)*(e-c)>=(r-a)*(s-c)&&(r-a)*(i-c)>=(t-a)*(e-c)&&(t-a)*(s-c)>=(n-a)*(i-c)}function rse(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!ise(r,e)&&(U1(r,e)&&U1(e,r)&&nse(r,e)&&(Xn(r.prev,r,e.prev)||Xn(r,e.prev,e))||zv(r,e)&&Xn(r.prev,r,r.next)>0&&Xn(e.prev,e,e.next)>0)}function Xn(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function zv(r,e){return r.x===e.x&&r.y===e.y}function PF(r,e,t,i){let n=Nv(Xn(r,e,t)),s=Nv(Xn(r,e,i)),a=Nv(Xn(t,i,r)),c=Nv(Xn(t,i,e));return!!(n!==s&&a!==c||n===0&&Fv(r,t,e)||s===0&&Fv(r,i,e)||a===0&&Fv(t,r,i)||c===0&&Fv(t,e,i))}function Fv(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Nv(r){return r>0?1:r<0?-1:0}function ise(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&PF(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function U1(r,e){return Xn(r.prev,r,r.next)<0?Xn(r,e,r.next)>=0&&Xn(r,r.prev,e)>=0:Xn(r,e,r.prev)<0||Xn(r,r.next,e)<0}function nse(r,e){let t=r,i=!1,n=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&n<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==r);return i}function MF(r,e){let t=new j1(r.i,r.x,r.y),i=new j1(e.i,e.x,e.y),n=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=n,n.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function CF(r,e,t,i){let n=new j1(r,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function V1(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}var j1=class{constructor(e,t,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=t,this.y=i}};function ga(r,e){let t=e.length,i=r.length;if(i>0){let n=!0;for(let s=0;s<t;s++)if(r[i-t+s]!==e[s]){n=!1;break}if(n)return!1}for(let n=0;n<t;n++)r[i+n]=e[n];return!0}function G1(r,e){let t=e.length;for(let i=0;i<t;i++)r[i]=e[i]}function td(r,e,t,i,n=[]){let s=i+e*t;for(let a=0;a<t;a++)n[a]=r[s+a];return n}function Uv(r,e,t,i,n=[]){let s,a;if(t&8)s=(i[3]-r[1])/(e[1]-r[1]),a=3;else if(t&4)s=(i[1]-r[1])/(e[1]-r[1]),a=1;else if(t&2)s=(i[2]-r[0])/(e[0]-r[0]),a=2;else if(t&1)s=(i[0]-r[0])/(e[0]-r[0]),a=0;else return null;for(let c=0;c<r.length;c++)n[c]=(a&1)===c?i[a]:s*(e[c]-r[c])+r[c];return n}function H1(r,e){let t=0;return r[0]<e[0]?t|=1:r[0]>e[2]&&(t|=2),r[1]<e[1]?t|=4:r[1]>e[3]&&(t|=8),t}function W1(r,e){let{size:t=2,broken:i=!1,gridResolution:n=10,gridOffset:s=[0,0],startIndex:a=0,endIndex:c=r.length}=e||{},d=(c-a)/t,p=[],b=[p],T=td(r,0,t,a),B,z,G=LF(T,n,s,[]),Z=[];ga(p,T);for(let q=1;q<d;q++){for(B=td(r,q,t,a,B),z=H1(B,G);z;){Uv(T,B,z,G,Z);let re=H1(Z,G);re&&(Uv(T,Z,re,G,Z),z=re),ga(p,Z),G1(T,Z),ose(G,n,z),i&&p.length>t&&(p=[],b.push(p),ga(p,T)),z=H1(B,G)}ga(p,B),G1(T,B)}return i?b:b[0]}var RF=0,sse=1;function $1(r,e=null,t){if(!r.length)return[];let{size:i=2,gridResolution:n=10,gridOffset:s=[0,0],edgeTypes:a=!1}=t||{},c=[],d=[{pos:r,types:a?new Array(r.length/i).fill(sse):null,holes:e||[]}],p=[[],[]],b=[];for(;d.length;){let{pos:T,types:B,holes:z}=d.shift();ase(T,i,z[0]||T.length,p),b=LF(p[0],n,s,b);let G=H1(p[1],b);if(G){let Z=BF(T,B,i,0,z[0]||T.length,b,G),q={pos:Z[0].pos,types:Z[0].types,holes:[]},re={pos:Z[1].pos,types:Z[1].types,holes:[]};d.push(q,re);for(let ee=0;ee<z.length;ee++)Z=BF(T,B,i,z[ee],z[ee+1]||T.length,b,G),Z[0]&&(q.holes.push(q.pos.length),q.pos=Vv(q.pos,Z[0].pos),a&&(q.types=Vv(q.types,Z[0].types))),Z[1]&&(re.holes.push(re.pos.length),re.pos=Vv(re.pos,Z[1].pos),a&&(re.types=Vv(re.types,Z[1].types)))}else{let Z={positions:T};a&&(Z.edgeTypes=B),z.length&&(Z.holeIndices=z),c.push(Z)}}return c}function BF(r,e,t,i,n,s,a){let c=(n-i)/t,d=[],p=[],b=[],T=[],B=[],z,G,Z,q=td(r,c-1,t,i),re=Math.sign(a&8?q[1]-s[3]:q[0]-s[2]),ee=e&&e[c-1],ae=0,me=0;for(let Le=0;Le<c;Le++)z=td(r,Le,t,i,z),G=Math.sign(a&8?z[1]-s[3]:z[0]-s[2]),Z=e&&e[i/t+Le],G&&re&&re!==G&&(Uv(q,z,a,s,B),ga(d,B)&&b.push(ee),ga(p,B)&&T.push(ee)),G<=0?(ga(d,z)&&b.push(Z),ae-=G):b.length&&(b[b.length-1]=RF),G>=0?(ga(p,z)&&T.push(Z),me+=G):T.length&&(T[T.length-1]=RF),G1(q,z),re=G,ee=Z;return[ae?{pos:d,types:e&&b}:null,me?{pos:p,types:e&&T}:null]}function LF(r,e,t,i){let n=Math.floor((r[0]-t[0])/e)*e+t[0],s=Math.floor((r[1]-t[1])/e)*e+t[1];return i[0]=n,i[1]=s,i[2]=n+e,i[3]=s+e,i}function ose(r,e,t){t&8?(r[1]+=e,r[3]+=e):t&4?(r[1]-=e,r[3]-=e):t&2?(r[0]+=e,r[2]+=e):t&1&&(r[0]-=e,r[2]-=e)}function ase(r,e,t,i){let n=1/0,s=-1/0,a=1/0,c=-1/0;for(let d=0;d<t;d+=e){let p=r[d],b=r[d+1];n=p<n?p:n,s=p>s?p:s,a=b<a?b:a,c=b>c?b:c}return i[0][0]=n,i[0][1]=a,i[1][0]=s,i[1][1]=c,i}function Vv(r,e){for(let t=0;t<e.length;t++)r.push(e[t]);return r}var lse=85.051129;function H4(r,e){let{size:t=2,startIndex:i=0,endIndex:n=r.length,normalize:s=!0}=e||{},a=r.slice(i,n);OF(a,t,0,n-i);let c=W1(a,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(let d of c)DF(d,t);return c}function W4(r,e=null,t){let{size:i=2,normalize:n=!0,edgeTypes:s=!1}=t||{};e=e||[];let a=[],c=[],d=0,p=0;for(let T=0;T<=e.length;T++){let B=e[T]||r.length,z=p,G=cse(r,i,d,B);for(let Z=G;Z<B;Z++)a[p++]=r[Z];for(let Z=d;Z<G;Z++)a[p++]=r[Z];OF(a,i,z,p),use(a,i,z,p,t?.maxLatitude),d=B,c[T]=p}c.pop();let b=$1(a,c,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(n)for(let T of b)DF(T.positions,i);return b}function cse(r,e,t,i){let n=-1,s=-1;for(let a=t+1;a<i;a+=e){let c=Math.abs(r[a]);c>n&&(n=c,s=a-1)}return s}function use(r,e,t,i,n=lse){let s=r[t],a=r[i-e];if(Math.abs(s-a)>180){let c=td(r,0,e,t);c[0]+=Math.round((a-s)/360)*360,ga(r,c),c[1]=Math.sign(c[1])*n,ga(r,c),c[0]=s,ga(r,c)}}function OF(r,e,t,i){let n=r[0],s;for(let a=t;a<i;a+=e){s=r[a];let c=s-n;(c>180||c<-180)&&(s-=Math.round(c/360)*360),r[a]=n=s}}function DF(r,e){let t,i=r.length/e;for(let s=0;s<i&&(t=r[s*e],(t+180)%360===0);s++);let n=-Math.round(t/360)*360;if(n!==0)for(let s=0;s<i;s++)r[s*e]+=n}var q1=class extends Xi{constructor(e){let{indices:t,attributes:i}=fse(e);super({...e,indices:t,attributes:i})}};function fse(r){let{radius:e,height:t=1,nradial:i=10}=r,{vertices:n}=r;n&&(cr.assert(n.length>=i),n=n.flatMap(z=>[z[0],z[1]]),Up(n,G0.COUNTER_CLOCKWISE));let s=t>0,a=i+1,c=s?a*3+1:i,d=Math.PI*2/i,p=new Uint16Array(s?i*3*2:0),b=new Float32Array(c*3),T=new Float32Array(c*3),B=0;if(s){for(let z=0;z<a;z++){let G=z*d,Z=z%i,q=Math.sin(G),re=Math.cos(G);for(let ee=0;ee<2;ee++)b[B+0]=n?n[Z*2]:re*e,b[B+1]=n?n[Z*2+1]:q*e,b[B+2]=(1/2-ee)*t,T[B+0]=n?n[Z*2]:re,T[B+1]=n?n[Z*2+1]:q,B+=3}b[B+0]=b[B-3],b[B+1]=b[B-2],b[B+2]=b[B-1],B+=3}for(let z=s?0:1;z<a;z++){let G=Math.floor(z/2)*Math.sign(.5-z%2),Z=G*d,q=(G+i)%i,re=Math.sin(Z),ee=Math.cos(Z);b[B+0]=n?n[q*2]:ee*e,b[B+1]=n?n[q*2+1]:re*e,b[B+2]=t/2,T[B+2]=1,B+=3}if(s){let z=0;for(let G=0;G<i;G++)p[z++]=G*2+0,p[z++]=G*2+2,p[z++]=G*2+0,p[z++]=G*2+1,p[z++]=G*2+1,p[z++]=G*2+3}return{indices:p,attributes:{POSITION:{size:3,value:b},NORMAL:{size:3,value:T}}}}var kF=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,FF={name:"column",vs:kF,fs:kF,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}};var NF=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var zF=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var jv=[0,0,0,255],dse={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:r=>r.position},getFillColor:{type:"accessor",value:jv},getLineColor:{type:"accessor",value:jv},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Z1=class extends sn{getShaders(){let e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:NF,fs:zF,defines:e,modules:[Pi,t?_0:jf,wn,FF]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:jv},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:jv},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:n}=e,s=n.extensionsChanged||t.flatShading!==i.flatShading;s&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let a=this.getNumInstances();this.state.fillModel.setInstanceCount(a),this.state.wireframeModel.setInstanceCount(a),(s||t.diskResolution!==i.diskResolution||t.vertices!==i.vertices||(t.extruded||t.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(t)}getGeometry(e,t,i){let n=new q1({radius:1,height:i?2:0,vertices:t,nradial:e}),s=0;if(t)for(let a=0;a<e;a++){let c=t[a],d=Math.sqrt(c[0]*c[0]+c[1]*c[1]);s+=d/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),n}_getModels(){let e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),i=new hi(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),n=new hi(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:i,wireframeModel:n,models:[n,i]}}_updateGeometry({diskResolution:e,vertices:t,extruded:i,stroked:n}){let s=this.getGeometry(e,t,i||n);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});let a=this.state.fillModel,c=this.state.wireframeModel;a.setGeometry(s),a.setTopology("triangle-strip"),a.setIndexBuffer(null),c.setGeometry(s),c.setTopology("line-list")}draw({uniforms:e}){let{lineWidthUnits:t,lineWidthScale:i,lineWidthMinPixels:n,lineWidthMaxPixels:s,radiusUnits:a,elevationScale:c,extruded:d,filled:p,stroked:b,wireframe:T,offset:B,coverage:z,radius:G,angle:Z}=this.props,q=this.state.fillModel,re=this.state.wireframeModel,{fillVertexCount:ee,edgeDistance:ae}=this.state,me={radius:G,angle:Z/180*Math.PI,offset:B,extruded:d,stroked:b,coverage:z,elevationScale:c,edgeDistance:ae,radiusUnits:Pn[a],widthUnits:Pn[t],widthScale:i,widthMinPixels:n,widthMaxPixels:s};d&&T&&(re.shaderInputs.setProps({column:{...me,isStroke:!0}}),re.draw(this.context.renderPass)),p&&(q.setVertexCount(ee),q.shaderInputs.setProps({column:{...me,isStroke:!1}}),q.draw(this.context.renderPass)),!d&&b&&(q.setVertexCount(ee*2/3),q.shaderInputs.setProps({column:{...me,isStroke:!0}}),q.draw(this.context.renderPass))}};Z1.layerName="ColumnLayer";Z1.defaultProps=dse;var vu=Z1;var pse={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},X1=class extends vu{_updateGeometry(){let e=new Mp;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{elevationScale:t,extruded:i,offset:n,coverage:s,cellSize:a,angle:c,radiusUnits:d}=this.props,p=this.state.fillModel,b={radius:a/2,radiusUnits:Pn[d],angle:c,offset:n,extruded:i,stroked:!1,coverage:s,elevationScale:t,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};p.shaderInputs.setProps({column:b}),p.draw(this.context.renderPass)}};X1.layerName="GridCellLayer";X1.defaultProps=pse;var UF=X1;function VF(r,e,t,i){let n;if(Array.isArray(r[0])){let s=r.length*e;n=new Array(s);for(let a=0;a<r.length;a++)for(let c=0;c<e;c++)n[a*e+c]=r[a][c]||0}else n=r;return t?W1(n,{size:e,gridResolution:t}):i?H4(n,{size:e}):n}var Ase=1,mse=2,$4=4,Y1=class extends Jf{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?VF(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(jF(e)){let i=0;for(let n of e)i+=this.getGeometrySize(n);return i}let t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&jF(e))for(let i of e){let n=this.getGeometrySize(i);t.geometrySize=n,this.updateGeometryAttributes(i,t),t.vertexStart+=n}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){let i=this.attributes.segmentTypes,n=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:a}=t;i.fill(0,s,s+a),n?(i[s]=$4,i[s+a-2]=$4):(i[s]+=Ase,i[s+a-2]+=mse),i[s+a-1]=$4}_updatePositions(e,t){let{positions:i}=this.attributes;if(!i||!e)return;let{vertexStart:n,geometrySize:s}=t,a=new Array(3);for(let c=n,d=0;d<s;c++,d++)this.getPointOnPath(e,d,a),i[c*3]=a[0],i[c*3+1]=a[1],i[c*3+2]=a[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){let{positionSize:n}=this;t*n>=e.length&&(t+=1-e.length/n);let s=t*n;return i[0]=e[s],i[1]=e[s+1],i[2]=n===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;let{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}};function jF(r){return Array.isArray(r[0])}var GF=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,HF={name:"path",vs:GF,fs:GF,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}};var WF=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var $F=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var qF=[0,0,0,255],gse={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:r=>r.path},getColor:{type:"accessor",value:qF},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},q4={enter:(r,e)=>e.length?e.subarray(e.length-r.length):r},K1=class extends sn{getShaders(){return super.getShaders({vs:WF,fs:$F,modules:[Pi,wn,HF]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:q4,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:q4,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:q4,defaultValue:qF},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:n,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:n,s)}}),this.setState({pathTesselator:new Y1({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:t,changeFlags:i}=e,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){let{pathTesselator:a}=this.state,c=t.data.attributes||{};a.updateGeometry({data:t.data,geometryBuffer:c.getPath,buffers:c,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||n.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i}=t,n=this.props.data;return n[0]&&n[0].__source&&(t.object=n.find(s=>s.__source.index===i)),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:t,capRounded:i,billboard:n,miterLimit:s,widthUnits:a,widthScale:c,widthMinPixels:d,widthMaxPixels:p}=this.props,b=this.state.model,T={jointType:Number(t),capType:Number(i),billboard:n,widthUnits:Pn[a],widthScale:c,miterLimit:s,widthMinPixels:d,widthMaxPixels:p};b.shaderInputs.setProps({path:T}),b.draw(this.context.renderPass)}_getModel(){let e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Xi({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){let{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}};K1.defaultProps=gse;K1.layerName="PathLayer";var wu=K1;var iN=Tf(QF(),1);var qv=G0.CLOCKWISE,JF=G0.COUNTER_CLOCKWISE,rd={isClosed:!0};function Lse(r){if(r=r&&r.positions||r,!Array.isArray(r)&&!ArrayBuffer.isView(r))throw new Error("invalid polygon")}function $0(r){return"positions"in r?r.positions:r}function ty(r){return"holeIndices"in r?r.holeIndices:null}function Ose(r){return Array.isArray(r[0])}function Dse(r){return r.length>=1&&r[0].length>=2&&Number.isFinite(r[0][0])}function kse(r){let e=r[0],t=r[r.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Fse(r,e,t,i){for(let n=0;n<e;n++)if(r[t+n]!==r[i-e+n])return!1;return!0}function eN(r,e,t,i,n){let s=e,a=t.length;for(let c=0;c<a;c++)for(let d=0;d<i;d++)r[s++]=t[c][d]||0;if(!kse(t))for(let c=0;c<i;c++)r[s++]=t[0][c]||0;return rd.start=e,rd.end=s,rd.size=i,Up(r,n,rd),s}function tN(r,e,t,i,n=0,s,a){s=s||t.length;let c=s-n;if(c<=0)return e;let d=e;for(let p=0;p<c;p++)r[d++]=t[n+p];if(!Fse(t,i,n,s))for(let p=0;p<i;p++)r[d++]=t[n+p];return rd.start=e,rd.end=d,rd.size=i,Up(r,a,rd),d}function Zv(r,e){Lse(r);let t=[],i=[];if("positions"in r){let{positions:n,holeIndices:s}=r;if(s){let a=0;for(let c=0;c<=s.length;c++)a=tN(t,a,n,e,s[c-1],s[c],c===0?qv:JF),i.push(a);return i.pop(),{positions:t,holeIndices:i}}r=n}if(!Ose(r))return tN(t,0,r,e,0,t.length,qv),t;if(!Dse(r)){let n=0;for(let[s,a]of r.entries())n=eN(t,n,a,e,s===0?qv:JF),i.push(n);return i.pop(),{positions:t,holeIndices:i}}return eN(t,0,r,e,qv),t}function Q4(r,e,t){let i=r.length/3,n=0;for(let s=0;s<i;s++){let a=(s+1)%i;n+=r[s*3+e]*r[a*3+t],n-=r[a*3+e]*r[s*3+t]}return Math.abs(n/2)}function rN(r,e,t,i){let n=r.length/3;for(let s=0;s<n;s++){let a=s*3,c=r[a+0],d=r[a+1],p=r[a+2];r[a+e]=c,r[a+t]=d,r[a+i]=p}}function nN(r,e,t,i){let n=ty(r);n&&(n=n.map(c=>c/e));let s=$0(r),a=i&&e===3;if(t){let c=s.length;s=s.slice();let d=[];for(let p=0;p<c;p+=e){d[0]=s[p],d[1]=s[p+1],a&&(d[2]=s[p+2]);let b=t(d);s[p]=b[0],s[p+1]=b[1],a&&(s[p+2]=b[2])}}if(a){let c=Q4(s,0,1),d=Q4(s,0,2),p=Q4(s,1,2);if(!c&&!d&&!p)return[];c>d&&c>p||(d>p?(t||(s=s.slice()),rN(s,0,2,1)):(t||(s=s.slice()),rN(s,2,0,1)))}return(0,iN.default)(s,n,e)}var ry=class extends Jf{constructor(e){let{fp64:t,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){let{attributes:t}=this;return e==="indices"?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);let t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let t=Zv(e,this.positionSize);return this.opts.resolution?$1($0(t),ty(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?W4($0(t),ty(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(oN(e)){let t=0;for(let i of e)t+=this.getGeometrySize(i);return t}return $0(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&oN(e))for(let i of e){let n=this.getGeometrySize(i);t.geometrySize=n,this.updateGeometryAttributes(i,t),t.vertexStart+=n,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{let i=e;this._updateIndices(i,t),this._updatePositions(i,t),this._updateVertexValid(i,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:i,indexStart:n}){let{attributes:s,indexStarts:a,typedArrayManager:c}=this,d=s.indices;if(!d||!e)return;let p=n,b=nN(e,this.positionSize,this.opts.preproject,this.opts.full3d);d=c.allocate(d,n+b.length,{copy:!0});for(let T=0;T<b.length;T++)d[p++]=b[T]+i;a[t+1]=n+b.length,s.indices=d}_updatePositions(e,{vertexStart:t,geometrySize:i}){let{attributes:{positions:n},positionSize:s}=this;if(!n||!e)return;let a=$0(e);for(let c=t,d=0;d<i;c++,d++){let p=a[d*s],b=a[d*s+1],T=s>2?a[d*s+2]:0;n[c*3]=p,n[c*3+1]=b,n[c*3+2]=T}}_updateVertexValid(e,{vertexStart:t,geometrySize:i}){let{positionSize:n}=this,s=this.attributes.vertexValid,a=e&&ty(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,t):s.fill(1,t,t+i),a)for(let c=0;c<a.length;c++)s[t+a[c]/n-1]=0;s[t+i-1]=0}};function oN(r){return Array.isArray(r)&&r.length>0&&!Number.isFinite(r[0])}var aN=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,lN={name:"solidPolygon",vs:aN,fs:aN,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}};var Xv=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var cN=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${Xv}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`;var uN=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${Xv}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`;var hN=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Kv=[0,0,0,255],Nse={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:r=>r.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Kv},getLineColor:{type:"accessor",value:Kv},material:!0},Yv={enter:(r,e)=>e.length?e.subarray(e.length-r.length):r},iy=class extends sn{getShaders(e){return super.getShaders({vs:e==="top"?cN:uN,fs:hN,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Pi,jf,wn,lN]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let{viewport:e}=this.context,{coordinateSystem:t}=this.props,{_full3d:i}=this.props;e.isGeospatial&&t===br.DEFAULT&&(t=br.LNGLAT);let n;t===br.LNGLAT&&(i?n=e.projectPosition.bind(e):n=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new ry({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let s=this.getAttributeManager(),a=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:a},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Yv,accessor:"getPolygon",update:this.calculatePositions,noAlloc:a,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:a},elevations:{size:1,stepMode:"dynamic",transition:Yv,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Yv,accessor:"getFillColor",defaultValue:Kv},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Yv,accessor:"getLineColor",defaultValue:Kv},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:d,target:p})=>this.encodePickingColor(c&&c.__source?c.__source.index:d,p)}})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i}=t,n=this.props.data;return n[0]&&n[0].__source&&(t.object=n.find(s=>s.__source.index===i)),t}disablePickingIndex(e){let t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{extruded:t,filled:i,wireframe:n,elevationScale:s}=this.props,{topModel:a,sideModel:c,wireframeModel:d,polygonTesselator:p}=this.state,b={extruded:!!t,elevationScale:s,isWireframe:!1};d&&n&&(d.setInstanceCount(p.instanceCount-1),d.shaderInputs.setProps({solidPolygon:{...b,isWireframe:!0}}),d.draw(this.context.renderPass)),c&&i&&(c.setInstanceCount(p.instanceCount-1),c.shaderInputs.setProps({solidPolygon:b}),c.draw(this.context.renderPass)),a&&i&&(a.setVertexCount(p.vertexCount),a.shaderInputs.setProps({solidPolygon:b}),a.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:t,oldProps:i,changeFlags:n}=e,s=this.getAttributeManager();(n.extensionsChanged||t.filled!==i.filled||t.extruded!==i.extruded)&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){let{polygonTesselator:s}=this.state,a=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:a.getPolygon,buffers:a,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let{id:e,filled:t,extruded:i}=this.props,n,s,a;if(t){let c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;let d=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new hi(this.context.device,{...c,id:`${e}-top`,topology:"triangle-list",bufferLayout:d,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){let c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new hi(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:c,geometry:new Xi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),a=new hi(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:c,geometry:new Xi({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,a,n].filter(Boolean),topModel:n,sideModel:s,wireframeModel:a}}calculateIndices(e){let{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){let{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};iy.defaultProps=Nse;iy.layerName="SolidPolygonLayer";var id=iy;function Qv({data:r,getIndex:e,dataRange:t,replace:i}){let{startRow:n=0,endRow:s=1/0}=t,a=r.length,c=a,d=a;for(let B=0;B<a;B++){let z=e(r[B]);if(c>B&&z>=n&&(c=B),z>=s){d=B;break}}let p=c,T=d-c!==i.length?r.slice(d):void 0;for(let B=0;B<i.length;B++)r[p++]=i[B];if(T){for(let B=0;B<T.length;B++)r[p++]=T[B];r.length=p}return{startRow:c,endRow:c+i.length}}var fN=[0,0,0,255],zse=[0,0,0,255],Use={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:r=>r.polygon},getFillColor:{type:"accessor",value:zse},getLineColor:{type:"accessor",value:fN},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},ny=class extends Zn{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&cr.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){let t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){let i=this.state.paths.slice(),n=e.dataChanged.map(s=>Qv({data:i,getIndex:a=>a.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:n})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){let{data:t,getPolygon:i,positionFormat:n,_normalize:s}=this.props,a=[],c=n==="XY"?2:3,{startRow:d,endRow:p}=e,{iterable:b,objectInfo:T}=gs(t,d,p);for(let B of b){T.index++;let z=i(B,T);s&&(z=Zv(z,c));let{holeIndices:G}=z,Z=z.positions||z;if(G)for(let q=0;q<=G.length;q++){let re=Z.slice(G[q-1]||0,G[q]||Z.length);a.push(this.getSubLayerRow({path:re},B,T.index))}else a.push(this.getSubLayerRow({path:Z},B,T.index))}return a}renderLayers(){let{data:e,_dataDiff:t,stroked:i,filled:n,extruded:s,wireframe:a,_normalize:c,_windingOrder:d,elevationScale:p,transitions:b,positionFormat:T}=this.props,{lineWidthUnits:B,lineWidthScale:z,lineWidthMinPixels:G,lineWidthMaxPixels:Z,lineJointRounded:q,lineMiterLimit:re,lineDashJustified:ee}=this.props,{getFillColor:ae,getLineColor:me,getLineWidth:Le,getLineDashArray:je,getElevation:Je,getPolygon:J,updateTriggers:te,material:X}=this.props,{paths:ye,pathsDiff:_e}=this.state,Oe=this.getSubLayerClass("fill",id),ve=this.getSubLayerClass("stroke",wu),De=this.shouldRenderSubLayer("fill",ye)&&new Oe({_dataDiff:t,extruded:s,elevationScale:p,filled:n,wireframe:a,_normalize:c,_windingOrder:d,getElevation:Je,getFillColor:ae,getLineColor:s&&a?me:fN,material:X,transitions:b},this.getSubLayerProps({id:"fill",updateTriggers:te&&{getPolygon:te.getPolygon,getElevation:te.getElevation,getFillColor:te.getFillColor,lineColors:s&&a,getLineColor:te.getLineColor}}),{data:e,positionFormat:T,getPolygon:J}),Xe=!s&&i&&this.shouldRenderSubLayer("stroke",ye)&&new ve({_dataDiff:_e&&(()=>_e),widthUnits:B,widthScale:z,widthMinPixels:G,widthMaxPixels:Z,jointRounded:q,miterLimit:re,dashJustified:ee,_pathType:"loop",transitions:b&&{getWidth:b.getLineWidth,getColor:b.getLineColor,getPath:b.getPolygon},getColor:this.getSubLayerAccessor(me),getWidth:this.getSubLayerAccessor(Le),getDashArray:this.getSubLayerAccessor(je)},this.getSubLayerProps({id:"stroke",updateTriggers:te&&{getWidth:te.getLineWidth,getColor:te.getLineColor,getDashArray:te.getLineDashArray}}),{data:ye,positionFormat:T,getPath:rt=>rt.path});return[!s&&De,Xe,s&&De]}};ny.layerName="PolygonLayer";ny.defaultProps=Use;var nd=ny;function dN(r,e){if(!r)return null;let t="startIndices"in r?r.startIndices[e]:e,i=r.featureIds.value[t];return t!==-1?Vse(r,i,t):null}function Vse(r,e,t){let i={properties:{...r.properties[e]}};for(let n in r.numericProps)i.properties[n]=r.numericProps[n].value[t];return i}function pN(r,e){let t={points:null,lines:null,polygons:null};for(let i in t){let n=r[i].globalFeatureIds.value;t[i]=new Uint8ClampedArray(n.length*4);let s=[];for(let a=0;a<n.length;a++)e(n[a],s),t[i][a*4+0]=s[0],t[i][a*4+1]=s[1],t[i][a*4+2]=s[2],t[i][a*4+3]=255}return t}var AN=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,mN={name:"sdf",vs:AN,fs:AN,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}};var gN=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var J4=192/256,_N=[],jse={getIconOffsets:{type:"accessor",value:r=>r.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},sy=class extends j0{getShaders(){let e=super.getShaders();return{...e,modules:[...e.modules,mN],fs:gN}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e,{outlineColor:n}=t;n!==i.outlineColor&&(n=n.map(s=>s/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!t.sdf&&t.outlineWidth&&cr.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){let{sdf:t,smoothing:i,outlineWidth:n}=this.props,{outlineColor:s}=this.state,a=n?Math.max(i,J4*(1-n)):-1,c=this.state.model,d={buffer:J4,outlineBuffer:a,gamma:i,enabled:!!t,outlineColor:s};if(c.shaderInputs.setProps({sdf:d}),super.draw(e),t&&n){let{iconManager:p}=this.state;p.getTexture()&&(c.shaderInputs.setProps({sdf:{...d,outlineBuffer:J4}}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(t=>super.getInstanceOffset(t)):_N}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(t=>super.getInstanceIconFrame(t)):_N}};sy.defaultProps=jse;sy.layerName="MultiIconLayer";var Jv=sy;var oy=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:n=.25,fontFamily:s="sans-serif",fontWeight:a="normal",fontStyle:c="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=i;let d=this.size=e+t*4,p=this._createCanvas(d),b=this.ctx=p.getContext("2d",{willReadFrequently:!0});b.font=`${c} ${a} ${e}px ${s}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(e){let t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){let{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:s,actualBoundingBoxRight:a}=this.ctx.measureText(e),c=Math.ceil(i),d=0,p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-s))),b=Math.min(this.size-this.buffer,c+Math.ceil(n)),T=p+2*this.buffer,B=b+2*this.buffer,z=Math.max(T*B,0),G=new Uint8ClampedArray(z),Z={data:G,width:T,height:B,glyphWidth:p,glyphHeight:b,glyphTop:c,glyphLeft:d,glyphAdvance:t};if(p===0||b===0)return Z;let{ctx:q,buffer:re,gridInner:ee,gridOuter:ae}=this;q.clearRect(re,re,p,b),q.fillText(e,re,re+c);let me=q.getImageData(re,re,p,b);ae.fill(1e20,0,z),ee.fill(0,0,z);for(let Le=0;Le<b;Le++)for(let je=0;je<p;je++){let Je=me.data[4*(Le*p+je)+3]/255;if(Je===0)continue;let J=(Le+re)*T+je+re;if(Je===1)ae[J]=0,ee[J]=1e20;else{let te=.5-Je;ae[J]=te>0?te*te:0,ee[J]=te<0?te*te:0}}yN(ae,0,0,T,B,T,this.f,this.v,this.z),yN(ee,re,re,p,b,T,this.f,this.v,this.z);for(let Le=0;Le<z;Le++){let je=Math.sqrt(ae[Le])-Math.sqrt(ee[Le]);G[Le]=Math.round(255-255*(je/this.radius+this.cutoff))}return Z}};function yN(r,e,t,i,n,s,a,c,d){for(let p=e;p<e+i;p++)xN(r,t*s+p,s,n,a,c,d);for(let p=t;p<t+n;p++)xN(r,p*s+e,1,i,a,c,d)}function xN(r,e,t,i,n,s,a){s[0]=0,a[0]=-1e20,a[1]=1e20,n[0]=r[e];for(let c=1,d=0,p=0;c<i;c++){n[c]=r[e+c*t];let b=c*c;do{let T=s[d];p=(n[c]-n[T]+b-T*T)/(c-T)/2}while(p<=a[d]&&--d>-1);d++,s[d]=c,a[d]=p,a[d+1]=1e20}for(let c=0,d=0;c<i;c++){for(;a[d+1]<c;)d++;let p=s[d],b=c-p;r[e+c*t]=n[p]+b*b}}var Gse=32,Hse=[];function Wse(r){return Math.pow(2,Math.ceil(Math.log2(r)))}function bN({characterSet:r,getFontWidth:e,fontHeight:t,buffer:i,maxCanvasWidth:n,mapping:s={},xOffset:a=0,yOffset:c=0}){let d=0,p=a,b=t+i*2;for(let T of r)if(!s[T]){let B=e(T);p+B+i*2>n&&(p=0,d++),s[T]={x:p+i,y:c+d*b+i,width:B,height:b,layoutWidth:B,layoutHeight:t},p+=B+i*2}return{mapping:s,xOffset:p,yOffset:c+d*b,canvasHeight:Wse(c+(d+1)*b)}}function vN(r,e,t,i){let n=0;for(let s=e;s<t;s++){let a=r[s];n+=i[a]?.layoutWidth||0}return n}function wN(r,e,t,i,n,s){let a=e,c=0;for(let d=e;d<t;d++){let p=vN(r,d,d+1,n);c+p>i&&(a<d&&s.push(d),a=d,c=0),c+=p}return c}function $se(r,e,t,i,n,s){let a=e,c=e,d=e,p=0;for(let b=e;b<t;b++)if((r[b]===" "||r[b+1]===" "||b+1===t)&&(d=b+1),d>c){let T=vN(r,c,d,n);p+T>i&&(a<c&&(s.push(c),a=c,p=0),T>i&&(T=wN(r,c,d,i,n,s),a=s[s.length-1])),c=d,p+=T}return p}function qse(r,e,t,i,n=0,s){s===void 0&&(s=r.length);let a=[];return e==="break-all"?wN(r,n,s,t,i,a):$se(r,n,s,t,i,a),a}function Zse(r,e,t,i,n,s){let a=0,c=0;for(let d=e;d<t;d++){let p=r[d],b=i[p];b?(c||(c=b.layoutHeight),n[d]=a+b.layoutWidth/2,a+=b.layoutWidth):(cr.warn(`Missing character: ${p} (${p.codePointAt(0)})`)(),n[d]=a,a+=Gse)}s[0]=a,s[1]=c}function TN(r,e,t,i,n){let s=Array.from(r),a=s.length,c=new Array(a),d=new Array(a),p=new Array(a),b=(t==="break-word"||t==="break-all")&&isFinite(i)&&i>0,T=[0,0],B=[0,0],z=0,G=0,Z=0;for(let q=0;q<=a;q++){let re=s[q];if((re===`
`||q===a)&&(Z=q),Z>G){let ee=b?qse(s,t,i,n,G,Z):Hse;for(let ae=0;ae<=ee.length;ae++){let me=ae===0?G:ee[ae-1],Le=ae<ee.length?ee[ae]:Z;Zse(s,me,Le,n,c,B);for(let je=me;je<Le;je++){let Je=c[je]-B[0]/2,J=s[je],te=n[J]?.layoutOffsetY||0;d[je]=z+B[1]/2+te,p[je]=B[0]}z=z+B[1]*e,T[0]=Math.max(T[0],B[0])}G=Z}re===`
`&&(c[G]=0,d[G]=0,p[G]=0,G++)}return T[1]=z,{x:c,y:d,rowWidth:p,size:T}}function EN({value:r,length:e,stride:t,offset:i,startIndices:n,characterSet:s}){let a=r.BYTES_PER_ELEMENT,c=t?t/a:1,d=i?i/a:0,p=n[e]||Math.ceil((r.length-d)/c),b=s&&new Set,T=new Array(e),B=r;if(c>1||d>0){let z=r.constructor;B=new z(p);for(let G=0;G<p;G++)B[G]=r[G*c+d]}for(let z=0;z<e;z++){let G=n[z],Z=n[z+1]||p,q=B.subarray(G,Z);T[z]=String.fromCodePoint.apply(null,q),b&&q.forEach(b.add,b)}if(b)for(let z of b)s.add(String.fromCodePoint(z));return{texts:T,characterCount:p}}var q0=class{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){let t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}};function Xse(){let r=[];for(let e=32;e<128;e++)r.push(String.fromCharCode(e));return r}var Gp={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Xse(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},SN=1024,CN=.9,IN=1.2,MN=3,ew=new q0(MN);function Yse(r,e){let t;typeof e=="string"?t=new Set(Array.from(e)):t=new Set(e);let i=ew.get(r);if(!i)return t;for(let n in i.mapping)t.has(n)&&t.delete(n);return t}function Kse(r,e){for(let t=0;t<r.length;t++)e.data[4*t+3]=r[t]}function PN(r,e,t,i){r.font=`${i} ${t}px ${e}`,r.fillStyle="#000",r.textBaseline="alphabetic",r.textAlign="left"}function RN(r){cr.assert(Number.isFinite(r)&&r>=MN,"Invalid cache limit"),ew=new q0(r)}var ay=class{constructor(){this.props={...Gp}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:e,buffer:t}=this.props;return(e*IN+t*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();let t=Yse(this._key,this.props.characterSet),i=ew.get(this._key);if(i&&t.size===0){this._atlas!==i&&(this._atlas=i);return}let n=this._generateFontAtlas(t,i);this._atlas=n,ew.set(this._key,n)}_generateFontAtlas(e,t){let{fontFamily:i,fontWeight:n,fontSize:s,buffer:a,sdf:c,radius:d,cutoff:p}=this.props,b=t&&t.data;b||(b=document.createElement("canvas"),b.width=SN);let T=b.getContext("2d",{willReadFrequently:!0});PN(T,i,s,n);let{mapping:B,canvasHeight:z,xOffset:G,yOffset:Z}=bN({getFontWidth:q=>T.measureText(q).width,fontHeight:s*IN,buffer:a,characterSet:e,maxCanvasWidth:SN,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(b.height!==z){let q=T.getImageData(0,0,b.width,b.height);b.height=z,T.putImageData(q,0,0)}if(PN(T,i,s,n),c){let q=new oy({fontSize:s,buffer:a,radius:d,cutoff:p,fontFamily:i,fontWeight:`${n}`});for(let re of e){let{data:ee,width:ae,height:me,glyphTop:Le}=q.draw(re);B[re].width=ae,B[re].layoutOffsetY=s*CN-Le;let je=T.createImageData(ae,me);Kse(ee,je),T.putImageData(je,B[re].x,B[re].y)}}else for(let q of e)T.fillText(q,B[q].x,B[q].y+a+s*CN);return{xOffset:G,yOffset:Z,mapping:B,data:b,width:b.width,height:b.height}}_getKey(){let{fontFamily:e,fontWeight:t,fontSize:i,buffer:n,sdf:s,radius:a,cutoff:c}=this.props;return s?`${e} ${t} ${i} ${n} ${a} ${c}`:`${e} ${t} ${i} ${n}`}};var BN=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,LN={name:"textBackground",vs:BN,fs:BN,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}};var ON=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var DN=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Qse={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:r=>r.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},ly=class extends sn{getShaders(){return super.getShaders({vs:ON,fs:DN,modules:[Pi,wn,LN]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{billboard:t,sizeScale:i,sizeUnits:n,sizeMinPixels:s,sizeMaxPixels:a,getLineWidth:c}=this.props,{padding:d,borderRadius:p}=this.props;d.length<4&&(d=[d[0],d[1],d[0],d[1]]),Array.isArray(p)||(p=[p,p,p,p]);let b=this.state.model,T={billboard:t,stroked:!!c,borderRadius:p,padding:d,sizeUnits:Pn[n],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:a};b.shaderInputs.setProps({textBackground:T}),b.draw(this.context.renderPass)}_getModel(){let e=[0,0,1,0,0,1,1,1];return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Xi({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};ly.defaultProps=Qse;ly.layerName="TextBackgroundLayer";var tw=ly;var kN={start:1,middle:0,end:-1},FN={top:1,center:0,bottom:-1},eI=[0,0,0,255],Jse=1,eoe={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:eI},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Gp.characterSet},fontFamily:Gp.fontFamily,fontWeight:Gp.fontWeight,lineHeight:Jse,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:eI},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:r=>r.text},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:eI},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},cy=class extends Zn{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[i,n]}=this.transformParagraph(e,t),{fontSize:s}=this.state.fontAtlasManager.props;i/=s,n/=s;let{getTextAnchor:a,getAlignmentBaseline:c}=this.props,d=kN[typeof a=="function"?a(e,t):a],p=FN[typeof c=="function"?c(e,t):c];return[(d-1)*i/2,(p-1)*n/2,i,n]},this.getIconOffsets=(e,t)=>{let{getTextAnchor:i,getAlignmentBaseline:n}=this.props,{x:s,y:a,rowWidth:c,size:[d,p]}=this.transformParagraph(e,t),b=kN[typeof i=="function"?i(e,t):i],T=FN[typeof n=="function"?n(e,t):n],B=s.length,z=new Array(B*2),G=0;for(let Z=0;Z<B;Z++){let q=(1-b)*(d-c[Z])/2;z[G++]=(b-1)*d/2+q+s[Z],z[G++]=(T-1)*p/2+a[Z]}return z}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new ay},this.props.maxWidth>0&&cr.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){let{props:t,oldProps:i,changeFlags:n}=e;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==i.lineHeight||t.wordBreak!==i.wordBreak||t.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:t,fontWeight:i}=this.props,{fontAtlasManager:n,characterSet:s}=this.state,a={...e,characterSet:s,fontFamily:t,fontWeight:i};if(!n.mapping)return n.setProps(a),!0;for(let c in a)if(a[c]!==n.props[c])return n.setProps(a),!0;return!1}_updateText(){let{data:e,characterSet:t}=this.props,i=e.attributes?.getText,{getText:n}=this.props,s=e.startIndices,a,c=t==="auto"&&new Set;if(i&&s){let{texts:d,characterCount:p}=EN({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:s,characterSet:c});a=p,n=(b,{index:T})=>d[T]}else{let{iterable:d,objectInfo:p}=gs(e);s=[0],a=0;for(let b of d){p.index++;let T=Array.from(n(b,p)||"");c&&T.forEach(c.add,c),a+=T.length,s.push(a)}}this.setState({getText:n,startIndices:s,numInstances:a,characterSet:c||t})}transformParagraph(e,t){let{fontAtlasManager:i}=this.state,n=i.mapping,s=this.state.getText,{wordBreak:a,lineHeight:c,maxWidth:d}=this.props,p=s(e,t)||"";return TN(p,c,a,d*i.props.fontSize,n)}renderLayers(){let{startIndices:e,numInstances:t,getText:i,fontAtlasManager:{scale:n,atlas:s,mapping:a},styleVersion:c}=this.state,{data:d,_dataDiff:p,getPosition:b,getColor:T,getSize:B,getAngle:z,getPixelOffset:G,getBackgroundColor:Z,getBorderColor:q,getBorderWidth:re,backgroundBorderRadius:ee,backgroundPadding:ae,background:me,billboard:Le,fontSettings:je,outlineWidth:Je,outlineColor:J,sizeScale:te,sizeUnits:X,sizeMinPixels:ye,sizeMaxPixels:_e,transitions:Oe,updateTriggers:ve}=this.props,De=this.getSubLayerClass("characters",Jv),Xe=this.getSubLayerClass("background",tw);return[me&&new Xe({getFillColor:Z,getLineColor:q,getLineWidth:re,borderRadius:ee,padding:ae,getPosition:b,getSize:B,getAngle:z,getPixelOffset:G,billboard:Le,sizeScale:te,sizeUnits:X,sizeMinPixels:ye,sizeMaxPixels:_e,transitions:Oe&&{getPosition:Oe.getPosition,getAngle:Oe.getAngle,getSize:Oe.getSize,getFillColor:Oe.getBackgroundColor,getLineColor:Oe.getBorderColor,getLineWidth:Oe.getBorderWidth,getPixelOffset:Oe.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ve.getPosition,getAngle:ve.getAngle,getSize:ve.getSize,getFillColor:ve.getBackgroundColor,getLineColor:ve.getBorderColor,getLineWidth:ve.getBorderWidth,getPixelOffset:ve.getPixelOffset,getBoundingRect:{getText:ve.getText,getTextAnchor:ve.getTextAnchor,getAlignmentBaseline:ve.getAlignmentBaseline,styleVersion:c}}}),{data:d.attributes&&d.attributes.background?{length:d.length,attributes:d.attributes.background}:d,_dataDiff:p,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new De({sdf:je.sdf,smoothing:Number.isFinite(je.smoothing)?je.smoothing:Gp.smoothing,outlineWidth:Je/(je.radius||Gp.radius),outlineColor:J,iconAtlas:s,iconMapping:a,getPosition:b,getColor:T,getSize:B,getAngle:z,getPixelOffset:G,billboard:Le,sizeScale:te*n,sizeUnits:X,sizeMinPixels:ye*n,sizeMaxPixels:_e*n,transitions:Oe&&{getPosition:Oe.getPosition,getAngle:Oe.getAngle,getColor:Oe.getColor,getSize:Oe.getSize,getPixelOffset:Oe.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ve.getText,getPosition:ve.getPosition,getAngle:ve.getAngle,getColor:ve.getColor,getSize:ve.getSize,getPixelOffset:ve.getPixelOffset,getIconOffsets:{getTextAnchor:ve.getTextAnchor,getAlignmentBaseline:ve.getAlignmentBaseline,styleVersion:c}}}),{data:d,_dataDiff:p,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){RN(e)}};cy.defaultProps=eoe;cy.layerName="TextLayer";var rw=cy;var uy={circle:{type:kv,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:j0,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:rw,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},hy={type:wu,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},iw={type:id,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Z0({type:r,props:e}){let t={};for(let i in e)t[i]=r.defaultProps[e[i]];return t}function nw(r,e){let{transitions:t,updateTriggers:i}=r.props,n={updateTriggers:{},transitions:t&&{getPosition:t.geometry}};for(let s in e){let a=e[s],c=r.props[s];s.startsWith("get")&&(c=r.getSubLayerAccessor(c),n.updateTriggers[a]=i[s],t&&(n.transitions[a]=t[s])),n[a]=c}return n}function zN(r){if(Array.isArray(r))return r;switch(cr.assert(r.type,"GeoJSON does not have type"),r.type){case"Feature":return[r];case"FeatureCollection":return cr.assert(Array.isArray(r.features),"GeoJSON does not have features array"),r.features;default:return[{geometry:r}]}}function tI(r,e,t={}){let i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:s=r.length}=t;for(let a=n;a<s;a++){let c=r[a],{geometry:d}=c;if(d)if(d.type==="GeometryCollection"){cr.assert(Array.isArray(d.geometries),"GeoJSON does not have geometries array");let{geometries:p}=d;for(let b=0;b<p.length;b++){let T=p[b];NN(T,i,e,c,a)}}else NN(d,i,e,c,a)}return i}function NN(r,e,t,i,n){let{type:s,coordinates:a}=r,{pointFeatures:c,lineFeatures:d,polygonFeatures:p,polygonOutlineFeatures:b}=e;if(!roe(s,a)){cr.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":c.push(t({geometry:r},i,n));break;case"MultiPoint":a.forEach(T=>{c.push(t({geometry:{type:"Point",coordinates:T}},i,n))});break;case"LineString":d.push(t({geometry:r},i,n));break;case"MultiLineString":a.forEach(T=>{d.push(t({geometry:{type:"LineString",coordinates:T}},i,n))});break;case"Polygon":p.push(t({geometry:r},i,n)),a.forEach(T=>{b.push(t({geometry:{type:"LineString",coordinates:T}},i,n))});break;case"MultiPolygon":a.forEach(T=>{p.push(t({geometry:{type:"Polygon",coordinates:T}},i,n)),T.forEach(B=>{b.push(t({geometry:{type:"LineString",coordinates:B}},i,n))})});break;default:}}var toe={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function roe(r,e){let t=toe[r];for(cr.assert(t,`Unknown GeoJSON type ${r}`);e&&--t>0;)e=e[0];return e&&Number.isFinite(e[0])}function UN(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function sw(r){return r.geometry.coordinates}function VN(r,e){let t=UN(),{pointFeatures:i,lineFeatures:n,polygonFeatures:s,polygonOutlineFeatures:a}=r;return t.points.data=i,t.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),t.points.getPosition=sw,t.lines.data=n,t.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),t.lines.getPath=sw,t.polygons.data=s,t.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),t.polygons.getPolygon=sw,t.polygonsOutline.data=a,t.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),t.polygonsOutline.getPath=sw,t}function jN(r,e){let t=UN(),{points:i,lines:n,polygons:s}=r,a=pN(r,e);return t.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:a.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:a.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},t.lines._pathType="open",t.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.polygons._normalize=!1,s.triangles&&(t.polygons.data.attributes.indices=s.triangles.value),t.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:a.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},t.polygonsOutline._pathType="open",t}var ioe=["points","linestrings","polygons"],noe={...Z0(uy.circle),...Z0(uy.icon),...Z0(uy.text),...Z0(hy),...Z0(iw),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:r=>r.properties.icon},getText:{type:"accessor",value:r=>r.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},fy=class extends Zn{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;let{data:i}=this.props,n=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:n}),n?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){let i=jN(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:t}){let i=zN(e.data),n=this.getSubLayerRow.bind(this),s={},a={};if(Array.isArray(t.dataChanged)){let d=this.state.features;for(let p in d)s[p]=d[p].slice(),a[p]=[];for(let p of t.dataChanged){let b=tI(i,n,p);for(let T in d)a[T].push(Qv({data:s[T],getIndex:B=>B.__source.index,dataRange:p,replace:b[T]}))}}else s=tI(i,n);let c=VN(s,a);this.setState({features:s,featuresDiff:a,layerProps:c})}getPickingInfo(e){let t=super.getPickingInfo(e),{index:i,sourceLayer:n}=t;return t.featureType=ioe.find(s=>n.id.startsWith(`${this.id}-${s}-`)),i>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[i]),t}_updateAutoHighlight(e){let t=`${this.id}-points-`,i=e.featureType==="points";for(let n of this.getSubLayers())n.id.startsWith(t)===i&&n.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:t}=this.props,{layerProps:i}=this.state,n="polygons-fill",s=this.shouldRenderSubLayer(n,i.polygons?.data)&&this.getSubLayerClass(n,iw.type);if(s){let a=nw(this,iw.props),c=e&&t;return c||delete a.getLineColor,a.updateTriggers.lineColors=c,new s(a,this.getSubLayerProps({id:n,updateTriggers:a.updateTriggers}),i.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:t}=this.props,{layerProps:i}=this.state,n="polygons-stroke",s="linestrings",a=!e&&t&&this.shouldRenderSubLayer(n,i.polygonsOutline?.data)&&this.getSubLayerClass(n,hy.type),c=this.shouldRenderSubLayer(s,i.lines?.data)&&this.getSubLayerClass(s,hy.type);if(a||c){let d=nw(this,hy.props);return[a&&new a(d,this.getSubLayerProps({id:n,updateTriggers:d.updateTriggers}),i.polygonsOutline),c&&new c(d,this.getSubLayerProps({id:s,updateTriggers:d.updateTriggers}),i.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:t,binary:i}=this.state,{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=t.points.data.findIndex(c=>c.__source.index===n));let s=new Set(e.split("+")),a=[];for(let c of s){let d=`points-${c}`,p=uy[c],b=p&&this.shouldRenderSubLayer(d,t.points?.data)&&this.getSubLayerClass(d,p.type);if(b){let T=nw(this,p.props),B=t.points;if(c==="text"&&i){let{instancePickingColors:z,...G}=B.data.attributes;B={...B,data:{...B.data,attributes:G}}}a.push(new b(T,this.getSubLayerProps({id:d,updateTriggers:T.updateTriggers,highlightedObjectIndex:n}),B))}}return a}renderLayers(){let{extruded:e}=this.props,t=this._renderPolygonLayer(),i=this._renderLineLayers(),n=this._renderPointLayers();return[!e&&t,i,n,e&&t]}getSubLayerAccessor(e){let{binary:t}=this.state;return!t||typeof e!="function"?super.getSubLayerAccessor(e):(i,n)=>{let{data:s,index:a}=n,c=dN(s,a);return e(c,n)}}};fy.layerName="GeoJsonLayer";fy.defaultProps=noe;var Hp=fy;var hI={};Ms(hI,{CPUAggregator:()=>Yo,ContourLayer:()=>q7,GridLayer:()=>Q7,HeatmapLayer:()=>m9,HexagonLayer:()=>p7,ScreenGridLayer:()=>i7,WebGLAggregator:()=>_s,_AggregationLayer:()=>Tu});function GN({pointCount:r,getBinId:e}){let t=new Map;for(let i=0;i<r;i++){let n=e(i);if(n===null)continue;let s=t.get(String(n));s?s.points.push(i):(s={id:n,index:t.size,points:[i]},t.set(String(n),s))}return Array.from(t.values())}function HN({bins:r,dimensions:e,target:t}){let i=r.length*e;(!t||t.length<i)&&(t=new Float32Array(i));for(let n=0;n<r.length;n++){let{id:s}=r[n];Array.isArray(s)?t.set(s,n*e):t[n]=s}return t}var soe=r=>r.length,WN=(r,e)=>{let t=0;for(let i of r)t+=e(i);return t},ooe=(r,e)=>r.length===0?NaN:WN(r,e)/r.length,aoe=(r,e)=>{let t=1/0;for(let i of r){let n=e(i);n<t&&(t=n)}return t},loe=(r,e)=>{let t=-1/0;for(let i of r){let n=e(i);n>t&&(t=n)}return t},$N={COUNT:soe,SUM:WN,MEAN:ooe,MIN:aoe,MAX:loe};function qN({bins:r,getValue:e,operation:t,target:i}){(!i||i.length<r.length)&&(i=new Float32Array(r.length));let n=1/0,s=-1/0;for(let a=0;a<r.length;a++){let{points:c}=r[a];i[a]=t(c,e),i[a]<n&&(n=i[a]),i[a]>s&&(s=i[a])}return{value:i,domain:[n,s]}}function iI(r,e,t){let i={};for(let s of r.sources||[]){let a=e[s];if(a)i[s]=coe(a);else throw new Error(`Cannot find attribute ${s}`)}let n={};return s=>{for(let a in i)n[a]=i[a](s);return r.getValue(n,s,t)}}function coe(r){let e=r.value,{offset:t=0,stride:i,size:n}=r.getAccessor(),s=e.BYTES_PER_ELEMENT,a=t/s,c=i?i/s:n;if(n===1)return r.isConstant?()=>e[0]:p=>{let b=a+c*p;return e[b]};let d;return r.isConstant?(d=Array.from(e),()=>d):(d=new Array(n),p=>{let b=a+c*p;for(let T=0;T<n;T++)d[T]=e[b+T];return d})}var Yo=class{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){let t=this.props;if(e.binOptions&&(hn(e.binOptions,t.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==t.operations[i]&&this.setNeedsUpdate(i);if(e.customOperations)for(let i=0;i<this.channelCount;i++)!!e.customOperations[i]!=!!t.customOperations[i]&&this.setNeedsUpdate(i);e.pointCount!==void 0&&e.pointCount!==t.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...t.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){if(this.needsUpdate===!0){this.bins=GN({pointCount:this.props.pointCount,getBinId:iI(this.props.getBin,this.props.attributes,this.props.binOptions)});let e=HN({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:e,type:"float32",size:this.dimensions}}for(let e=0;e<this.channelCount;e++)if(this.needsUpdate===!0||this.needsUpdate[e]){let t=this.props.customOperations[e]||$N[this.props.operations[e]],{value:i,domain:n}=qN({bins:this.bins,getValue:iI(this.props.getValue[e],this.props.attributes,void 0),operation:t,target:this.results[e]?.value});this.results[e]={value:i,domain:n,type:"float32",size:1},this.props.onUpdate?.({channel:e})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){return this.results[e]?.domain??[1/0,-1/0]}getBin(e){let t=this.bins[e];if(!t)return null;let i=new Array(this.channelCount);for(let n=0;n<i.length;n++){let s=this.results[n];i[n]=s?.value[e]}return{id:t.id,value:i,count:t.points.length,pointIndices:t.points}}};function ow(r,e,t){return r.createFramebuffer({width:e,height:t,colorAttachments:[r.createTexture({width:e,height:t,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}var uoe=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,ZN={name:"binSorter",vs:uoe,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}};var YN=[1,2,4,8],XN=3e38,hoe={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},dy=1024,aw=class{constructor(e,t){this.binsFBO=null,this.device=e,this.model=doe(e,t)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(e){if(!this.binsFBO)return null;let t=e%dy,i=Math.floor(e/dy),n=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:t,sourceY:i,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(n)}setDimensions(e,t){let i=dy,n=Math.ceil(e/i);this.binsFBO?this.binsFBO.height<n&&this.binsFBO.resize({width:i,height:n}):this.binsFBO=ow(this.device,i,n);let s={binIdRange:[t[0][0],t[0][1],t[1]?.[0]||0,t[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:s})}setModelProps(e){let t=this.model;e.attributes&&t.setAttributes(e.attributes),e.constantAttributes&&t.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&t.setVertexCount(e.vertexCount),e.shaderModuleProps&&t.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;let t=foe(e);this._updateBins("SUM",t.SUM+t.MEAN),this._updateBins("MIN",t.MIN),this._updateBins("MAX",t.MAX)}_updateBins(e,t){if(t===0)return;t|=YN[3];let i=this.model,n=this.binsFBO,s=e==="MAX"?-XN:e==="MIN"?XN:0,a=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:n,parameters:{viewport:[0,0,n.width,n.height],colorMask:t},clearColor:[s,s,s,0],clearDepth:!1,clearStencil:!1});i.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),i.draw(a),a.end()}};function foe(r){let e={...hoe};for(let t=0;t<r.length;t++){let i=r[t];i&&(e[i]+=YN[t])}return e}function doe(r,e){let t=e.vs;e.dimensions===2&&(t+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);let i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${t}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new hi(r,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],ZN],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:i,fs:n,topology:"point-list",disableWarnings:!0})}var poe=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,KN={name:"aggregatorTransform",vs:poe,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};var nI=3e38,lw=class{constructor(e,t){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=t.channelCount,this.transform=Aoe(e,t),this.domainFBO=ow(e,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){let e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,t=new Float32Array(e);this._domains=[[-t[4],t[0]],[-t[5],t[1]],[-t[6],t[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,t){let{model:i,transformFeedback:n}=this.transform;i.setVertexCount(e);let s={binIdRange:[t[0][0],t[0][1],t[1]?.[0]||0,t[1]?.[1]||0]};i.shaderInputs.setProps({aggregatorTransform:s});let a=e*t.length*4;(!this.binBuffer||this.binBuffer.byteLength<a)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:a}),n.setBuffer("binIds",this.binBuffer));let c=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<c)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:c}),n.setBuffer("values",this.valueBuffer))}update(e,t){if(!e)return;let i=this.transform,n=this.domainFBO,s=[0,1,2].map(d=>t[d]==="COUNT"?1:0),a=[0,1,2].map(d=>t[d]==="MEAN"?1:0),c={isCount:s,isMean:a,bins:e};i.model.shaderInputs.setProps({aggregatorTransform:c}),i.run({id:"gpu-aggregation-domain",framebuffer:n,parameters:{viewport:[0,0,2,1]},clearColor:[-nI,-nI,-nI,0],clearDepth:!1,clearStencil:!1}),this._domains=null}};function Aoe(r,e){let t=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new du(r,{vs:t,fs:i,topology:"point-list",modules:[KN],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:dy},varyings:["binIds","values"],disableWarnings:!0})}var _s=class{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,t){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=t.dimensions,this.channelCount=t.channelCount,this.props={...t,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new aw(e,t),this.aggregationTransform=new lw(e,t),this.setProps(t)}getBins(){let e=this.aggregationTransform.binBuffer;return e?(this.binIds?.buffer!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){let t=this.aggregationTransform.valueBuffer;return!t||e>=this.channelCount?null:(this.results[e]?.buffer!==t&&(this.results[e]={buffer:t,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;let{binIdRange:t}=this.props,i;if(this.dimensions===1)i=[e+t[0][0]];else{let[[c,d],[p]]=t,b=d-c;i=[e%b+c,Math.floor(e/b)+p]}let n=this.binSorter.getBinValues(e);if(!n)return null;let s=n[3],a=[];for(let c=0;c<this.channelCount;c++){let d=this.props.operations[c];d==="COUNT"?a[c]=s:s===0?a[c]=NaN:a[c]=d==="MEAN"?n[c]/s:n[c]}return{id:i,value:a,count:s}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){let t=this.props;if("binIdRange"in e&&!hn(e.binIdRange,t.binIdRange,2)){let i=e.binIdRange;if(cr.assert(i.length===this.dimensions),this.dimensions===1){let[[n,s]]=i;this.binCount=s-n}else{let[[n,s],[a,c]]=i;this.binCount=(s-n)*(c-a)}this.binSorter.setDimensions(this.binCount,i),this.aggregationTransform.setDimensions(this.binCount,i),this.setNeedsUpdate()}if(e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==t.operations[i]&&this.setNeedsUpdate(i);if(e.pointCount!==void 0&&e.pointCount!==t.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(hn(e.binOptions,t.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){let i={},n={};for(let s of Object.values(e.attributes))for(let[a,c]of Object.entries(s.getValue()))ArrayBuffer.isView(c)?n[a]=c:c&&(i[a]=c);this.binSorter.setModelProps({attributes:i,constantAttributes:n})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;let{operations:e}=this.props,t=this.needsUpdate.map((i,n)=>i?e[n]:null);this.binSorter.update(t),this.aggregationTransform.update(this.binSorter.texture,e);for(let i=0;i<this.channelCount;i++)this.needsUpdate[i]&&(this.needsUpdate[i]=!1,this.props.onUpdate?.({channel:i}))}};var cw=class extends Zn{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){super.updateState(e);let t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){this.state.aggregator?.destroy();let i=this.createAggregator(t);return i.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:i,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){let{aggregator:t}=this.state;t.setProps({attributes:e});for(let i in e)this.onAttributeChange(i);t.update()}draw({shaderModuleProps:e}){let{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new bl(this.context.device,{id:this.props.id,stats:this.context.stats})}};cw.layerName="AggregationLayer";var Tu=cw;var sd=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function sI(r,e=!1,t=Float32Array){let i;if(Number.isFinite(r[0]))i=new t(r);else{i=new t(r.length*4);let n=0;for(let s=0;s<r.length;s++){let a=r[s];i[n++]=a[0],i[n++]=a[1],i[n++]=a[2],i[n++]=Number.isFinite(a[3])?a[3]:255}}if(e)for(let n=0;n<i.length;n++)i[n]/=255;return i}var uw={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function X0(r,e){r.setSampler({minFilter:uw[e],magFilter:uw[e]})}function Y0(r,e,t="linear"){let i=sI(e,!1,Uint8Array);return r.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:uw[t],magFilter:uw[t],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:i,width:i.length/4,height:1})}var QN=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`;var JN=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var moe=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,e7={name:"screenGrid",vs:moe,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};var hw=class extends sn{getShaders(){return super.getShaders({vs:QN,fs:JN,modules:[wn,e7]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:n}=e,s=this.state.model;if(i.colorRange!==t.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=Y0(this.context.device,t.colorRange,t.colorScaleType);let a={colorRange:this.state.colorTexture};s.shaderInputs.setProps({screenGrid:a})}else i.colorScaleType!==t.colorScaleType&&X0(this.state.colorTexture,t.colorScaleType);if(i.cellMarginPixels!==t.cellMarginPixels||i.cellSizePixels!==t.cellSizePixels||n.viewportChanged){let{width:a,height:c}=this.context.viewport,{cellSizePixels:d,cellMarginPixels:p}=this.props,b=Math.max(d-p,0),T={gridSizeClipspace:[d/a*2,d/c*2],cellSizeClipspace:[b/a*2,b/c*2]};s.shaderInputs.setProps({screenGrid:T})}}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let t=this.props.colorDomain(),i=this.state.model,n={colorDomain:t};i.shaderInputs.setProps({screenGrid:n}),i.draw(this.context.renderPass)}_getModel(){return new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Xi({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}};hw.layerName="ScreenGridCellLayer";var t7=hw;var goe=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,r7={name:"binOptions",vs:goe,uniformTypes:{cellSizePixels:"f32"}};var _oe={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:sd,colorScaleType:"linear",getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},py=class extends Tu{getAggregatorType(){return this.props.gpuAggregation&&_s.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!_s.isSupported(this.context.device)?new Yo({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},i,n)=>{let s=this.context.viewport,a=s.project(t),c=n.cellSizePixels;return a[0]<0||a[0]>=s.width||a[1]<0||a[1]>=s.height?null:[Math.floor(a[0]/c),Math.floor(a[1]/c)]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}]}):new _s(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Pi,r7],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){let t=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{cellSizePixels:a,aggregation:c}=i;if(t||s.dataChanged||s.updateTriggersChanged||s.viewportChanged||c!==n.aggregation||a!==n.cellSizePixels){let{width:d,height:p}=this.context.viewport,{aggregator:b}=this.state;b instanceof _s&&b.setProps({binIdRange:[[0,Math.ceil(d/a)],[0,Math.ceil(p/a)]]}),b.setProps({pointCount:this.getNumInstances(),operations:[c],binOptions:{cellSizePixels:a}})}return s.viewportChanged&&this.state.aggregator.setNeedsUpdate(),t}onAttributeChange(e){let{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate();break;case"counts":t.setNeedsUpdate(0);break;default:}}renderLayers(){let{aggregator:e}=this.state,t=this.getSubLayerClass("cells",t7),i=e.getBins(),n=e.getResult(0);return new t(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:i,getWeight:n}},dataComparator:(s,a)=>s.length===a.length,updateTriggers:{getBin:[i],getWeight:[n]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){let t=e.info,{index:i}=t;if(i>=0){let n=this.state.aggregator.getBin(i),s;n&&(s={col:n.id[0],row:n.id[1],value:n.value[0],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(a=>this.props.data[a]):[])),t.object=s}return t}};py.layerName="ScreenGridLayer";py.defaultProps=_oe;var i7=py;var od=class{constructor(e,t){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=t,this.attribute=e}getScalePercentile(){if(!this._percentile){let e=n7(this.input,this.inputLength);this._percentile=xoe(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){let e=n7(this.input,this.inputLength);this._ordinal=yoe(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:t,upperPercentile:i}){if(e==="quantile")return[t,i-1];if(t>0||i<100){let{domain:n}=this.getScalePercentile(),s=n[Math.floor(t)-1]??-1/0,a=n[Math.floor(i)-1]??1/0;if(e==="ordinal"){let{domain:c}=this.getScaleOrdinal();s=c.findIndex(d=>d>=s),a=c.findIndex(d=>d>a)-1,a===-2&&(a=c.length-1)}return[s,a]}return null}update(e){let t=this.props;if(e.scaleType!==t.scaleType)switch(e.scaleType){case"quantile":{let{attribute:i}=this.getScalePercentile();this.attribute=i,this.domain=[0,99];break}case"ordinal":{let{attribute:i,domain:n}=this.getScaleOrdinal();this.attribute=i,this.domain=[0,n.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==t.scaleType||e.lowerPercentile!==t.lowerPercentile||e.upperPercentile!==t.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}};function yoe(r){let e=new Set;for(let n of r)Number.isFinite(n)&&e.add(n);let t=Array.from(e).sort(),i=new Map;for(let n=0;n<t.length;n++)i.set(t[n],n);return{attribute:{value:r.map(n=>Number.isFinite(n)?i.get(n):NaN),type:"float32",size:1},domain:t}}function xoe(r,e=100){let t=Array.from(r).filter(Number.isFinite).sort(boe),i=0,n=Math.max(1,e),s=new Array(n-1);for(;++i<n;)s[i-1]=voe(t,i/n);return{attribute:{value:r.map(a=>Number.isFinite(a)?woe(s,a):NaN),type:"float32",size:1},domain:s}}function n7(r,e){let t=(r.stride??4)/4,i=(r.offset??0)/4,n=r.value;if(!n){let a=r.buffer?.readSyncWebGL(0,t*4*e);a&&(n=new Float32Array(a.buffer),r.value=n)}if(t===1)return n.subarray(0,e);let s=new Float32Array(e);for(let a=0;a<e;a++)s[a]=n[a*t+i];return s}function boe(r,e){return r-e}function voe(r,e){let t=r.length;if(e<=0||t<2)return r[0];if(e>=1)return r[t-1];let i=(t-1)*e,n=Math.floor(i),s=r[n],a=r[n+1];return s+(a-s)*(i-n)}function woe(r,e){let t=0,i=r.length;for(;t<i;){let n=t+i>>>1;r[n]>e?i=n:t=n+1}return t}function K0({dataBounds:r,getBinId:e,padding:t=0}){let i=[r[0],r[1],[r[0][0],r[1][1]],[r[1][0],r[0][1]]].map(d=>e(d)),n=Math.min(...i.map(d=>d[0]))-t,s=Math.min(...i.map(d=>d[1]))-t,a=Math.max(...i.map(d=>d[0]))+t+1,c=Math.max(...i.map(d=>d[1]))+t+1;return[[n,a],[s,c]]}var s7=Math.PI/3,fw=2*Math.sin(s7),dw=1.5,o7=Array.from({length:6},(r,e)=>{let t=e*s7;return[Math.sin(t),-Math.cos(t)]});function pw([r,e],t){let i=Math.round(e=e/t/dw),n=Math.round(r=r/t/fw-(i&1)/2),s=e-i;if(Math.abs(s)*3>1){let a=r-n,c=n+(r<n?-1:1)/2,d=i+(e<i?-1:1),p=r-c,b=e-d;a*a+s*s>p*p+b*b&&(n=c+(i&1?1:-1)/2,i=d)}return[n,i]}var a7=`
const vec2 DIST = vec2(${fw}, ${dw});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function oI([r,e],t){return[(r+(e&1)/2)*t*fw,e*t*dw]}var l7=`
const vec2 DIST = vec2(${fw}, ${dw});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`;var c7=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${l7}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Toe=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,u7={name:"hexagon",vs:Toe,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};var Aw=class extends vu{getShaders(){let e=super.getShaders();return e.modules.push(u7),{...e,vs:c7}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==t.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=Y0(this.context.device,t.colorRange,t.colorScaleType);let s={colorRange:this.state.colorTexture};n.shaderInputs.setProps({hexagon:s})}else i.colorScaleType!==t.colorScaleType&&X0(this.state.colorTexture,t.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let{radius:t,hexOriginCommon:i,elevationRange:n,elevationScale:s,extruded:a,coverage:c,colorDomain:d,elevationDomain:p}=this.props,b=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],B=this.state.fillModel;B.vertexArray.indexBuffer&&B.setIndexBuffer(null),B.setVertexCount(this.state.fillVertexCount);let z={colorDomain:[Math.max(d[0],b[0]),Math.min(d[1],b[1]),Math.max(d[0]-1,b[0]),Math.min(d[1]+1,b[1])],elevationDomain:[Math.max(p[0],T[0]),Math.min(p[1],T[1]),Math.max(p[0]-1,T[0]),Math.min(p[1]+1,T[1])],elevationRange:[n[0]*s,n[1]*s],originCommon:i};B.shaderInputs.setProps({column:{extruded:a,coverage:c,radius:t},hexagon:z}),B.draw(this.context.renderPass)}};Aw.layerName="HexagonCellLayer";var h7=Aw;var Eoe=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,f7={name:"binOptions",vs:Eoe,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function d7(){}var Soe={gpuAggregation:!0,colorDomain:null,colorRange:sd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:d7,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:d7,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:r=>r.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},Ay=class extends Tu{getAggregatorType(){let{gpuAggregation:e,hexagonAggregator:t,getColorValue:i,getElevationValue:n}=this.props;return e&&(t||i||n)?(cr.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&_s.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{hexagonAggregator:t,radius:i}=this.props;return new Yo({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},s,a)=>{if(t)return t(n,i);let d=this.state.aggregatorViewport.projectPosition(n),{radiusCommon:p,hexOriginCommon:b}=a;return pw([d[0]-b[0],d[1]-b[1]],p)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new _s(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Pi,f7],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${a7}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let t=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:a}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(gs(i.data).iterable)),t||s.dataChanged||i.radius!==n.radius||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{radiusCommon:c,hexOriginCommon:d,binIdRange:p,dataAsArray:b}=this.state;if(a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{radiusCommon:c,hexOriginCommon:d},onUpdate:this._onAggregationUpdate.bind(this)}),b){let{getColorValue:T,getElevationValue:B}=this.props;a.setProps({customOperations:[T&&(z=>T(z.map(G=>b[G]),{indices:z,data:i.data})),B&&(z=>B(z.map(G=>b[G]),{indices:z,data:i.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&a.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&a.setNeedsUpdate(1),t}_updateBinOptions(){let e=this.getBounds(),t=1,i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{radius:c}=this.props,{unitsPerMeter:d}=s.getDistanceScales(a);t=d[0]*c;let p=pw(s.projectFlat(a),t);a=s.unprojectFlat(oI(p,t));let b=s.constructor;s=s.isGeospatial?new b({longitude:a[0],latitude:a[1],zoom:12}):new Ha({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=K0({dataBounds:e,getBinId:T=>{let B=s.projectFlat(T);return B[0]-=i[0],B[1]-=i[1],pw(B,t)},padding:1})}this.setState({radiusCommon:t,hexOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let t=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new od(n,i.binCount)}),t.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new od(n,i.binCount)}),t.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();let{radiusCommon:i,hexOriginCommon:n,binIdRange:s}=this.state;t.setProps({binIdRange:s,binOptions:{radiusCommon:i,hexOriginCommon:n}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,radiusCommon:t,hexOriginCommon:i}=this.state,{elevationScale:n,colorRange:s,elevationRange:a,extruded:c,coverage:d,material:p,transitions:b,colorScaleType:T,lowerPercentile:B,upperPercentile:z,colorDomain:G,elevationScaleType:Z,elevationLowerPercentile:q,elevationUpperPercentile:re,elevationDomain:ee}=this.props,ae=this.getSubLayerClass("cells",h7),me=e.getBins(),Le=this.state.colors?.update({scaleType:T,lowerPercentile:B,upperPercentile:z}),je=this.state.elevations?.update({scaleType:Z,lowerPercentile:q,upperPercentile:re});return!Le||!je?null:new ae(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:me,getColorValue:Le.attribute,getElevationValue:je.attribute}},dataComparator:(Je,J)=>Je.length===J.length,updateTriggers:{getBin:[me],getColorValue:[Le.attribute],getElevationValue:[je.attribute]},diskResolution:6,vertices:o7,radius:t,hexOriginCommon:i,elevationScale:n,colorRange:s,colorScaleType:T,elevationRange:a,extruded:c,coverage:d,material:p,colorDomain:Le.domain||G||e.getResultDomain(0),elevationDomain:je.domain||ee||e.getResultDomain(1),colorCutoff:Le.cutoff,elevationCutoff:je.cutoff,transitions:b&&{getFillColor:b.getColorValue||b.getColorWeight,getElevation:b.getElevationValue||b.getElevationWeight},extensions:[]})}getPickingInfo(e){let t=e.info,{index:i}=t;if(i>=0){let n=this.state.aggregator.getBin(i),s;if(n){let a=oI(n.id,this.state.radiusCommon),c=this.context.viewport.unprojectFlat(a);s={col:n.id[0],row:n.id[1],position:c,colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(d=>this.props.data[d]):[])}t.object=s}return t}};Ay.layerName="HexagonLayer";Ay.defaultProps=Soe;var p7=Ay;var gr=.16666666666666666,Ct={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},Q0=[Ct.W,Ct.SW,Ct.S],J0=[Ct.S,Ct.SE,Ct.E],em=[Ct.E,Ct.NE,Ct.N],tm=[Ct.NW,Ct.W,Ct.N],rm=[[-.5,gr],[-.5,-gr],[-gr,-.5],[gr,-.5]],im=[[-gr,-.5],[gr,-.5],[.5,-gr],[.5,gr]],nm=[[.5,-gr],[.5,gr],[gr,.5],[-gr,.5]],sm=[[-.5,gr],[-.5,-gr],[gr,.5],[-gr,.5]],A7=[Ct.W,Ct.SW,Ct.SE,Ct.E],m7=[Ct.S,Ct.SE,Ct.NE,Ct.N],g7=[Ct.NW,Ct.W,Ct.E,Ct.NE],_7=[Ct.NW,Ct.SW,Ct.S,Ct.N],y7=[[-.5,gr],[-.5,-gr],[.5,-gr],[.5,gr]],x7=[[-gr,-.5],[gr,-.5],[gr,.5],[-gr,.5]],Coe=[Ct.NW,Ct.SW,Ct.SE,Ct.NE],b7=[Ct.NW,Ct.SW,Ct.SE,Ct.E,Ct.N],v7=[Ct.W,Ct.SW,Ct.SE,Ct.NE,Ct.N],w7=[Ct.NW,Ct.W,Ct.S,Ct.SE,Ct.NE],T7=[Ct.NW,Ct.SW,Ct.S,Ct.E,Ct.NE],E7=[Ct.NW,Ct.W,[.5,-gr],[.5,gr],Ct.N],S7=[[-gr,-.5],[gr,-.5],Ct.E,Ct.NE,Ct.N],C7=[[-.5,gr],[-.5,-gr],Ct.S,Ct.SE,Ct.E],I7=[Ct.W,Ct.SW,Ct.S,[gr,.5],[-gr,.5]],P7=[Ct.NW,Ct.W,[-gr,-.5],[gr,-.5],Ct.N],M7=[[-.5,gr],[-.5,-gr],Ct.E,Ct.NE,Ct.N],R7=[Ct.S,Ct.SE,Ct.E,[gr,.5],[-gr,.5]],B7=[Ct.W,Ct.SW,Ct.S,[.5,-gr],[.5,gr]],L7=[Ct.W,Ct.SW,Ct.SE,Ct.E,[gr,.5],[-gr,.5]],O7=[[-.5,gr],[-.5,-gr],Ct.S,Ct.SE,Ct.NE,Ct.N],D7=[Ct.NW,Ct.W,[-gr,-.5],[gr,-.5],Ct.E,Ct.NE],k7=[Ct.NW,Ct.SW,Ct.S,[.5,-gr],[.5,gr],Ct.N],om=[Ct.W,Ct.SW,Ct.S,Ct.E,Ct.NE,Ct.N],am=[Ct.NW,Ct.W,Ct.S,Ct.SE,Ct.E,Ct.N],mw=[[-.5,gr],[-.5,-gr],[-gr,-.5],[gr,-.5],Ct.E,Ct.NE,Ct.N],gw=[Ct.W,Ct.SW,Ct.S,[.5,-gr],[.5,gr],[gr,.5],[-gr,.5]],_w=[Ct.NW,Ct.W,[-gr,-.5],[gr,-.5],[.5,-gr],[.5,gr],Ct.N],yw=[[-.5,gr],[-.5,-gr],Ct.S,Ct.SE,Ct.E,[gr,.5],[-gr,.5]],F7=[[-.5,gr],[-.5,-gr],[-gr,-.5],[gr,-.5],[.5,-gr],[.5,gr],[gr,.5],[-gr,.5]],N7={0:[],1:[[Ct.W,Ct.S]],2:[[Ct.S,Ct.E]],3:[[Ct.W,Ct.E]],4:[[Ct.N,Ct.E]],5:{0:[[Ct.W,Ct.S],[Ct.N,Ct.E]],1:[[Ct.W,Ct.N],[Ct.S,Ct.E]]},6:[[Ct.N,Ct.S]],7:[[Ct.W,Ct.N]],8:[[Ct.W,Ct.N]],9:[[Ct.N,Ct.S]],10:{0:[[Ct.W,Ct.N],[Ct.S,Ct.E]],1:[[Ct.W,Ct.S],[Ct.N,Ct.E]]},11:[[Ct.N,Ct.E]],12:[[Ct.W,Ct.E]],13:[[Ct.S,Ct.E]],14:[[Ct.W,Ct.S]],15:[]};function hr(r){return parseInt(r,4)}var z7={[hr("0000")]:[],[hr("2222")]:[],[hr("2221")]:[Q0],[hr("2212")]:[J0],[hr("2122")]:[em],[hr("1222")]:[tm],[hr("0001")]:[Q0],[hr("0010")]:[J0],[hr("0100")]:[em],[hr("1000")]:[tm],[hr("2220")]:[rm],[hr("2202")]:[im],[hr("2022")]:[nm],[hr("0222")]:[sm],[hr("0002")]:[rm],[hr("0020")]:[im],[hr("0200")]:[nm],[hr("2000")]:[sm],[hr("0011")]:[A7],[hr("0110")]:[m7],[hr("1100")]:[g7],[hr("1001")]:[_7],[hr("2211")]:[A7],[hr("2112")]:[m7],[hr("1122")]:[g7],[hr("1221")]:[_7],[hr("2200")]:[y7],[hr("2002")]:[x7],[hr("0022")]:[y7],[hr("0220")]:[x7],[hr("1111")]:[Coe],[hr("1211")]:[b7],[hr("2111")]:[v7],[hr("1112")]:[w7],[hr("1121")]:[T7],[hr("1011")]:[b7],[hr("0111")]:[v7],[hr("1110")]:[w7],[hr("1101")]:[T7],[hr("1200")]:[E7],[hr("0120")]:[S7],[hr("0012")]:[C7],[hr("2001")]:[I7],[hr("1022")]:[E7],[hr("2102")]:[S7],[hr("2210")]:[C7],[hr("0221")]:[I7],[hr("1002")]:[P7],[hr("2100")]:[M7],[hr("0210")]:[R7],[hr("0021")]:[B7],[hr("1220")]:[P7],[hr("0122")]:[M7],[hr("2012")]:[R7],[hr("2201")]:[B7],[hr("0211")]:[L7],[hr("2110")]:[O7],[hr("1102")]:[D7],[hr("1021")]:[k7],[hr("2011")]:[L7],[hr("0112")]:[O7],[hr("1120")]:[D7],[hr("1201")]:[k7],[hr("2101")]:[om],[hr("0121")]:[om],[hr("1012")]:[am],[hr("1210")]:[am],[hr("0101")]:{0:[Q0,em],1:[om],2:[om]},[hr("1010")]:{0:[tm,J0],1:[am],2:[am]},[hr("2121")]:{0:[om],1:[om],2:[Q0,em]},[hr("1212")]:{0:[am],1:[am],2:[tm,J0]},[hr("2120")]:{0:[mw],1:[mw],2:[rm,em]},[hr("2021")]:{0:[gw],1:[gw],2:[Q0,nm]},[hr("1202")]:{0:[_w],1:[_w],2:[tm,im]},[hr("0212")]:{0:[yw],1:[yw],2:[J0,sm]},[hr("0102")]:{0:[rm,em],1:[mw],2:[mw]},[hr("0201")]:{0:[Q0,nm],1:[gw],2:[gw]},[hr("1020")]:{0:[tm,im],1:[_w],2:[_w]},[hr("2010")]:{0:[J0,sm],1:[yw],2:[yw]},[hr("2020")]:{0:[sm,im],1:[F7],2:[rm,nm]},[hr("0202")]:{0:[nm,rm],1:[F7],2:[sm,im]}};function my(r,e){return Number.isNaN(r)?0:Array.isArray(e)?r<e[0]?0:r<e[1]?1:2:r>=e?1:0}function U7(r){let{x:e,y:t,xRange:i,yRange:n,getValue:s,threshold:a}=r,c=e<i[0],d=e>=i[1]-1,p=t<n[0],b=t>=n[1]-1,T=c||d||p||b,B=0,z,G,Z,q;if(c||b)Z=0;else{let ae=s(e,t+1);Z=my(ae,a),B+=ae}if(d||b)q=0;else{let ae=s(e+1,t+1);q=my(ae,a),B+=ae}if(d||p)G=0;else{let ae=s(e+1,t);G=my(ae,a),B+=ae}if(c||p)z=0;else{let ae=s(e,t);z=my(ae,a),B+=ae}let re=-1;Number.isFinite(a)&&(re=Z<<3|q<<2|G<<1|z),Array.isArray(a)&&(re=Z<<6|q<<4|G<<2|z);let ee=0;return T||(ee=my(B/4,a)),{code:re,meanCode:ee}}function V7(r){let{x:e,y:t,z:i,code:n,meanCode:s}=r,a=z7[n];Array.isArray(a)||(a=a[s]);let c=e+1,d=t+1,p=[];return a.forEach(b=>{let T=[];b.forEach(B=>{let z=c+B[0],G=d+B[1];T.push([z,G,i])}),p.push(T)}),p}function j7(r){let{x:e,y:t,z:i,code:n,meanCode:s}=r,a=N7[n];Array.isArray(a)||(a=a[s]);let c=e+1,d=t+1,p=[];return a.forEach(b=>{b.forEach(T=>{let B=c+T[0],z=d+T[1];p.push([B,z,i])})}),p}function G7({contours:r,getValue:e,xRange:t,yRange:i}){let n=[],s=[],a=0,c=0;for(let d=0;d<r.length;d++){let p=r[d],b=p.zIndex??d,{threshold:T}=p;for(let B=t[0]-1;B<t[1];B++)for(let z=i[0]-1;z<i[1];z++){let{code:G,meanCode:Z}=U7({getValue:e,threshold:T,x:B,y:z,xRange:t,yRange:i}),q={x:B,y:z,z:b,code:G,meanCode:Z};if(Array.isArray(T)){let re=V7(q);for(let ee of re)s[c++]={vertices:ee,contour:p}}else{let re=j7(q);re.length>0&&(n[a++]={vertices:re,contour:p})}}}return{lines:n,polygons:s}}function H7(r){let{aggregator:e,binIdRange:t,channel:i}=r;if(e instanceof _s){let n=e.getResult(i)?.buffer;if(n){let s=new Float32Array(n.readSyncWebGL().buffer);return Ioe(s,t)}}if(e instanceof Yo){let n=e.getResult(i)?.value,s=e.getBins()?.value;if(s&&n)return Poe(n,s,e.binCount)}return null}function Ioe(r,e){let[[t,i],[n,s]]=e,a=i-t,c=s-n;return(d,p)=>(d-=t,p-=n,d<0||d>=a||p<0||p>=c?NaN:r[p*a+d])}function Poe(r,e,t){let i={};for(let n=0;n<t;n++){let s=e[n*2],a=e[n*2+1];i[s]=i[s]||{},i[s][a]=r[n]}return(n,s)=>i[n]?.[s]??NaN}var Moe=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,W7={name:"binOptions",vs:Moe,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};var $7=[255,255,255,255],Roe=1,Boe={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005},gy=class extends Tu{getAggregatorType(){return this.props.gpuAggregation&&_s.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new Yo({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},i,n)=>{let a=this.state.aggregatorViewport.projectPosition(t),{cellSizeCommon:c,cellOriginCommon:d}=n;return[Math.floor((a[0]-d[0])/c[0]),Math.floor((a[1]-d[1])/c[1])]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}],onUpdate:this._onAggregationUpdate.bind(this)}):new _s(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Pi,W7],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){let t=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:a}=this.state;if(t||s.dataChanged||i.cellSize!==n.cellSize||!hn(i.gridOrigin,n.gridOrigin,1)||i.aggregation!==n.aggregation){this._updateBinOptions();let{cellSizeCommon:c,cellOriginCommon:d,binIdRange:p}=this.state;a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.aggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:d}})}return hn(n.contours,i.contours,2)||this.setState({contourData:null}),t}_updateBinOptions(){let e=this.getBounds(),t=[1,1],i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:c,gridOrigin:d}=this.props,{unitsPerMeter:p}=s.getDistanceScales(a);t[0]=p[0]*c,t[1]=p[1]*c;let b=s.projectFlat(a);i=[Math.floor((b[0]-d[0])/t[0])*t[0]+d[0],Math.floor((b[1]-d[1])/t[1])*t[1]+d[1]],a=s.unprojectFlat(i);let T=s.constructor;s=s.isGeospatial?new T({longitude:a[0],latitude:a[1],zoom:12}):new Ha({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=K0({dataBounds:e,getBinId:B=>{let z=s.projectFlat(B);return[Math.floor((z[0]-i[0])/t[0]),Math.floor((z[1]-i[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){let{aggregator:e,binIdRange:t}=this.state;this.setState({aggregatedValueReader:H7({aggregator:e,binIdRange:t,channel:0}),contourData:null})}_getContours(){let{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){let{binIdRange:t}=this.state,{contours:i}=this.props,n=G7({contours:i,getValue:e,xRange:t[0],yRange:t[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(e){let{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:s}=this.state;t.setProps({binIdRange:s,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"counts":t.setNeedsUpdate(0);break;default:}}renderLayers(){let e=this._getContours();if(!e)return null;let{lines:t,polygons:i}=e,{zOffset:n}=this.props,{cellOriginCommon:s,cellSizeCommon:a}=this.state,c=this.getSubLayerClass("lines",wu),d=this.getSubLayerClass("bands",id),p=new vr().translate([s[0],s[1],0]).scale([a[0],a[1],n]),b=t&&t.length>0&&new c(this.getSubLayerProps({id:"lines"}),{data:t,coordinateSystem:br.CARTESIAN,modelMatrix:p,getPath:B=>B.vertices,getColor:B=>B.contour.color??$7,getWidth:B=>B.contour.strokeWidth??Roe,widthUnits:"pixels"}),T=i&&i.length>0&&new d(this.getSubLayerProps({id:"bands"}),{data:i,coordinateSystem:br.CARTESIAN,modelMatrix:p,getPolygon:B=>B.vertices,getFillColor:B=>B.contour.color??$7});return[b,T]}getPickingInfo(e){let t=e.info,{object:i}=t;return i&&(t.object={contour:i.contour}),t}};gy.layerName="ContourLayer";gy.defaultProps=Boe;var q7=gy;var Z7=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Loe=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,X7={name:"grid",vs:Loe,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};var _y=class extends vu{getShaders(){let e=super.getShaders();return e.modules.push(X7),{...e,vs:Z7}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==t.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=Y0(this.context.device,t.colorRange,t.colorScaleType);let s={colorRange:this.state.colorTexture};n.shaderInputs.setProps({grid:s})}else i.colorScaleType!==t.colorScaleType&&X0(this.state.colorTexture,t.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}_updateGeometry(){let e=new Mp;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{cellOriginCommon:t,cellSizeCommon:i,elevationRange:n,elevationScale:s,extruded:a,coverage:c,colorDomain:d,elevationDomain:p}=this.props,b=this.props.colorCutoff||[-1/0,1/0],T=this.props.elevationCutoff||[-1/0,1/0],B=this.state.fillModel,z={colorDomain:[Math.max(d[0],b[0]),Math.min(d[1],b[1]),Math.max(d[0]-1,b[0]),Math.min(d[1]+1,b[1])],elevationDomain:[Math.max(p[0],T[0]),Math.min(p[1],T[1]),Math.max(p[0]-1,T[0]),Math.min(p[1]+1,T[1])],elevationRange:[n[0]*s,n[1]*s],originCommon:t,sizeCommon:i};B.shaderInputs.setProps({column:{extruded:a,coverage:c},grid:z}),B.draw(this.context.renderPass)}};_y.layerName="GridCellLayer";var Ooe=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Y7={name:"binOptions",vs:Ooe,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function K7(){}var Doe={gpuAggregation:!0,colorDomain:null,colorRange:sd,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:K7,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:K7,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:r=>r.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},yy=class extends Tu{getAggregatorType(){let{gpuAggregation:e,gridAggregator:t,getColorValue:i,getElevationValue:n}=this.props;return e&&(t||i||n)?(cr.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&_s.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{gridAggregator:t,cellSize:i}=this.props;return new Yo({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},s,a)=>{if(t)return t(n,i);let d=this.state.aggregatorViewport.projectPosition(n),{cellSizeCommon:p,cellOriginCommon:b}=a;return[Math.floor((d[0]-b[0])/p[0]),Math.floor((d[1]-b[1])/p[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new _s(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Pi,Y7],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let t=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:a}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(gs(i.data).iterable)),t||s.dataChanged||i.cellSize!==n.cellSize||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{cellSizeCommon:c,cellOriginCommon:d,binIdRange:p,dataAsArray:b}=this.state;if(a.setProps({binIdRange:p,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:d},onUpdate:this._onAggregationUpdate.bind(this)}),b){let{getColorValue:T,getElevationValue:B}=this.props;a.setProps({customOperations:[T&&(z=>T(z.map(G=>b[G]),{indices:z,data:i.data})),B&&(z=>B(z.map(G=>b[G]),{indices:z,data:i.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&a.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&a.setNeedsUpdate(1),t}_updateBinOptions(){let e=this.getBounds(),t=[1,1],i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let a=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:c}=this.props,{unitsPerMeter:d}=s.getDistanceScales(a);t[0]=d[0]*c,t[1]=d[1]*c;let p=s.projectFlat(a);i=[Math.floor(p[0]/t[0])*t[0],Math.floor(p[1]/t[1])*t[1]],a=s.unprojectFlat(i);let b=s.constructor;s=s.isGeospatial?new b({longitude:a[0],latitude:a[1],zoom:12}):new Ha({position:[a[0],a[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=K0({dataBounds:e,getBinId:T=>{let B=s.projectFlat(T);return[Math.floor((B[0]-i[0])/t[0]),Math.floor((B[1]-i[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let t=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new od(n,i.binCount)}),t.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new od(n,i.binCount)}),t.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:s}=this.state;t.setProps({binIdRange:s,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,cellOriginCommon:t,cellSizeCommon:i}=this.state,{elevationScale:n,colorRange:s,elevationRange:a,extruded:c,coverage:d,material:p,transitions:b,colorScaleType:T,lowerPercentile:B,upperPercentile:z,colorDomain:G,elevationScaleType:Z,elevationLowerPercentile:q,elevationUpperPercentile:re,elevationDomain:ee}=this.props,ae=this.getSubLayerClass("cells",_y),me=e.getBins(),Le=this.state.colors?.update({scaleType:T,lowerPercentile:B,upperPercentile:z}),je=this.state.elevations?.update({scaleType:Z,lowerPercentile:q,upperPercentile:re});return!Le||!je?null:new ae(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:me,getColorValue:Le.attribute,getElevationValue:je.attribute}},dataComparator:(Je,J)=>Je.length===J.length,updateTriggers:{getBin:[me],getColorValue:[Le.attribute],getElevationValue:[je.attribute]},cellOriginCommon:t,cellSizeCommon:i,elevationScale:n,colorRange:s,colorScaleType:T,elevationRange:a,extruded:c,coverage:d,material:p,colorDomain:Le.domain||G||e.getResultDomain(0),elevationDomain:je.domain||ee||e.getResultDomain(1),colorCutoff:Le.cutoff,elevationCutoff:je.cutoff,transitions:b&&{getFillColor:b.getColorValue||b.getColorWeight,getElevation:b.getElevationValue||b.getElevationWeight},extensions:[]})}getPickingInfo(e){let t=e.info,{index:i}=t;if(i>=0){let n=this.state.aggregator.getBin(i),s;n&&(s={col:n.id[0],row:n.id[1],colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(a=>this.props.data[a]):[])),t.object=s}return t}};yy.layerName="GridLayer";yy.defaultProps=Doe;var Q7=yy;function e9(r){let e=r.map(c=>c[0]),t=r.map(c=>c[1]),i=Math.min.apply(null,e),n=Math.max.apply(null,e),s=Math.min.apply(null,t),a=Math.max.apply(null,t);return[i,s,n,a]}function t9(r,e){return e[0]>=r[0]&&e[2]<=r[2]&&e[1]>=r[1]&&e[3]<=r[3]}var J7=new Float32Array(12);function aI(r,e=2){let t=0;for(let i of r)for(let n=0;n<e;n++)J7[t++]=i[n]||0;return J7}function r9(r,e,t){let[i,n,s,a]=r,c=s-i,d=a-n,p=c,b=d;c/d<e/t?p=e/t*d:b=t/e*c,p<e&&(p=e,b=t);let T=(s+i)/2,B=(a+n)/2;return[T-p/2,B-b/2,T+p/2,B+b/2]}function i9(r,e){let[t,i,n,s]=e;return[(r[0]-t)/(n-t),(r[1]-i)/(s-i)]}var n9=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`;var s9=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`;var o9=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,a9={name:"triangle",vs:o9,fs:o9,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};var xw=class extends sn{getShaders(){return super.getShaders({vs:n9,fs:s9,modules:[Pi,a9]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){let{vertexCount:t,data:i}=this.props;return new hi(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){let{model:e}=this.state,{aggregationMode:t,colorDomain:i,intensity:n,threshold:s,colorTexture:a,maxTexture:c,weightsTexture:d}=this.props,p={aggregationMode:t,colorDomain:i,intensity:n,threshold:s,colorTexture:a,maxTexture:c,weightsTexture:d};e.shaderInputs.setProps({triangle:p}),e.draw(this.context.renderPass)}};xw.layerName="TriangleLayer";var l9=xw;function c9(r,e){let t={};for(let i in r)e.includes(i)||(t[i]=r[i]);return t}var bw=class extends Zn{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:c9(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);let{changeFlags:t}=e;if(t.extensionsChanged){let i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:e,mousePosition:t,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){let{props:i,oldProps:n,changeFlags:s}=e,{compareAll:a=!1,dimension:c}=t,{ignoreProps:d}=this.state,{props:p,accessors:b=[]}=c,{updateTriggersChanged:T}=s;if(s.dataChanged)return!0;if(T){if(T.all)return!0;for(let B of b)if(T[B])return!0}if(a)return s.extensionsChanged?!0:g1({oldProps:n,newProps:i,ignoreProps:d,propTypes:this.constructor._propTypes});for(let B of p)if(i[B]!==n[B])return!0;return!1}isAttributeChanged(e){let{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!koe(t)}_getAttributeManager(){return new bl(this.context.device,{id:this.props.id,stats:this.context.stats})}};bw.layerName="AggregationLayer";var u9=bw;function koe(r){let e=!0;for(let t in r){e=!1;break}return e}var lI=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`;var cI=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var h9=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var f9=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var Foe=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,d9={name:"weight",vs:Foe,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},p9={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}};var Noe=2,uI={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},A9=[0,0],zoe={SUM:0,MEAN:1},Uoe={getPosition:{type:"accessor",value:r=>r.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:sd,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},Voe=["float32-renderable-webgl","texture-blend-float-webgl"],joe={data:{props:["radiusPixels"]}},xy=class extends u9{getShaders(e){let t=[Pi];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(joe),this.setState({colorDomain:A9}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){let{props:t,oldProps:i}=e,n=this._getChangeFlags(e);(n.dataChanged||n.viewportChanged)&&(n.boundsChanged=this._updateBounds(n.dataChanged),this._updateTextureRenderingBounds()),n.dataChanged||n.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):n.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){let{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:i,maxWeightsTexture:n,colorTexture:s,colorDomain:a}=this.state,{updateTriggers:c,intensity:d,threshold:p,aggregation:b}=this.props,T=this.getSubLayerClass("triangle",l9);return new T(this.getSubLayerProps({id:"triangle-layer",updateTriggers:c}),{coordinateSystem:br.DEFAULT,data:{attributes:{positions:t,texCoords:i}},vertexCount:4,maxTexture:n,colorTexture:s,aggregationMode:zoe[b]||0,weightsTexture:e,intensity:d,threshold:p,colorDomain:a})}finalizeState(e){super.finalizeState(e);let{weightsTransform:t,weightsTexture:i,maxWeightTransform:n,maxWeightsTexture:s,triPositionBuffer:a,triTexCoordBuffer:c,colorTexture:d,updateTimer:p}=this.state;t?.destroy(),i?.destroy(),n?.destroy(),s?.destroy(),a?.destroy(),c?.destroy(),d?.destroy(),p&&clearTimeout(p)}_getAttributeManager(){return new bl(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){let t={},{dimensions:i}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;let{zoom:n}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==n)&&(t.viewportZoomChanged=!0),t}_createTextures(){let{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...uI,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...uI,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:e}=this.context,{weightsTextureSize:t}=this.props,i=Math.min(t,e.limits.maxTextureDimension2D),n=Voe.every(c=>e.features.has(c)),s=n?"rgba32float":"rgba8unorm",a=n?1:1/255;this.setState({textureSize:i,format:s,weightsScale:a}),n||cr.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state,{weightsTexture:i}=this.state,n=this.getAttributeManager();t?.destroy(),t=new M0(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:n.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,d9]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();let{device:e}=this.context,{textureSize:t,weightsTexture:i,maxWeightsTexture:n}=this.state,s=this.getShaders({vs:lI,fs:cI});this._createWeightsTransform(s);let a=this.getShaders({vs:h9,fs:f9,modules:[p9]}),c=new M0(e,{id:`${this.id}-max-weights-transform`,targetTexture:n,...a,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),d={inTexture:i,textureSize:t};c.model.shaderInputs.setProps({maxWeight:d}),this.setState({weightsTexture:i,maxWeightsTexture:n,maxWeightTransform:c,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:lI,fs:cI,...e})}_updateMaxWeightValue(){let{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){let{viewport:t}=this.context,i=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(c=>c.map(Math.fround)),n=e9(i),s={visibleWorldBounds:n,viewportCorners:i},a=!1;if(e||!this.state.worldBounds||!t9(this.state.worldBounds,n)){let c=this._worldToCommonBounds(n),d=this._commonToWorldBounds(c);this.props.coordinateSystem===br.LNGLAT&&(d[1]=Math.max(d[1],-85.051129),d[3]=Math.min(d[3],85.051129),d[0]=Math.max(d[0],-360),d[2]=Math.min(d[2],360));let p=this._worldToCommonBounds(d);s.worldBounds=d,s.normalizedCommonBounds=p,a=!0}return this.setState(s),a}_updateTextureRenderingBounds(){let{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:i,viewportCorners:n}=this.state,{viewport:s}=this.context;e.write(aI(n,3));let a=n.map(c=>i9(s.projectPosition(c),i));t.write(aI(a,2))}_updateColorTexture(e){let{colorRange:t}=e.props,{colorTexture:i}=this.state,n=sI(t,!1,Uint8Array);i&&i?.width===t.length?i.setTexture2DData({data:n}):(i?.destroy(),i=this.context.device.createTexture({...uI,data:n,width:t.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){let{radiusPixels:e,colorDomain:t,aggregation:i}=this.props,{worldBounds:n,textureSize:s,weightsScale:a,weightsTexture:c}=this.state,d=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let p=this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0});if(t&&i==="SUM"){let{viewport:ae}=this.context,me=ae.distanceScales.metersPerUnit[2]*(p[2]-p[0])/s;this.state.colorDomain=t.map(Le=>Le*me*a)}else this.state.colorDomain=t||A9;let T=this.getAttributeManager().getAttributes(),B=this.getModuleSettings();this._setModelAttributes(d.model,T),d.model.setVertexCount(this.getNumInstances());let z={radiusPixels:e,commonBounds:p,textureWidth:s,weightsScale:a,weightsTexture:c},{viewport:G,devicePixelRatio:Z,coordinateSystem:q,coordinateOrigin:re}=B,{modelMatrix:ee}=this.props;d.model.shaderInputs.setProps({project:{viewport:G,devicePixelRatio:Z,modelMatrix:ee,coordinateSystem:q,coordinateOrigin:re},weight:z}),d.run({parameters:{viewport:[0,0,s,s]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state,{debounceTimeout:i}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){let{useLayerCoordinateSystem:i=!1}=t,[n,s,a,c]=e,{viewport:d}=this.context,{textureSize:p}=this.state,{coordinateSystem:b}=this.props,T=i&&(b===br.LNGLAT_OFFSETS||b===br.METER_OFFSETS),B=T?d.projectPosition(this.props.coordinateOrigin):[0,0],z=p*Noe/d.scale,G,Z;return i&&!T?(G=this.projectPosition([n,s,0]),Z=this.projectPosition([a,c,0])):(G=d.projectPosition([n,s,0]),Z=d.projectPosition([a,c,0])),r9([G[0]-B[0],G[1]-B[1],Z[0]-B[0],Z[1]-B[1]],z,z)}_commonToWorldBounds(e){let[t,i,n,s]=e,{viewport:a}=this.context,c=a.unprojectPosition([t,i]),d=a.unprojectPosition([n,s]);return c.slice(0,2).concat(d.slice(0,2))}};xy.layerName="HeatmapLayer";xy.defaultProps=Uoe;var m9=xy;var RM={};Ms(RM,{GeohashLayer:()=>xG,GreatCircleLayer:()=>sz,H3ClusterLayer:()=>lU,H3HexagonLayer:()=>kw,MVTLayer:()=>mG,QuadkeyLayer:()=>yz,S2Layer:()=>gz,TerrainLayer:()=>Hj,Tile3DLayer:()=>Fj,TileLayer:()=>Yp,TripsLayer:()=>zz,_GeoCellLayer:()=>Eu,_Tile2DHeader:()=>Zp,_Tileset2D:()=>Xp,_WMSLayer:()=>cm,_getURLFromTemplate:()=>Iu});function Goe(r){return typeof r=="string"?r.charAt(0).toLowerCase()+r.slice(1):r}function vw(r){if(Array.isArray(r))return r.map(e=>vw(e));if(r&&typeof r=="object"){let e={};for(let[t,i]of Object.entries(r))e[Goe(t)]=vw(i);return e}return r}var Y9=Tf(X9(),1);function bI(r,e){if(e?._parser&&e._parser!=="fast-xml-parser")throw new Error(e?._parser);let t={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e?.removeNSPrefix,textNodeName:e?.textNodeName,isArray:(n,s,a,c)=>!!e?.arrayPaths?.some(p=>s===p),...e?._fastXML},i=rle(r,t);return e?.uncapitalizeKeys?vw(i):i}function rle(r,e){return new Y9.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(r)}var ile="4.3.2",yc={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:ile,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:nle,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(r,e)=>bI(new TextDecoder().decode(r),{...yc.options.xml,...e?.xml}),parseTextSync:(r,e)=>bI(r,{...yc.options.xml,...e?.xml})};function nle(r){return r.startsWith("<?xml")}function K9(r,e){let t=yc.parseTextSync?.(r,e),i=t?.ServiceExceptionReport?.ServiceException||t?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof i=="string"?i:i.value||i.code||"Unknown error"}var sle="4.3.2",wy={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:sle,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:ole,options:{wms:{throwOnError:!1}},parse:async(r,e)=>vI(new TextDecoder().decode(r),e),parseSync:(r,e)=>vI(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>vI(r,e)};function ole(r){return r.startsWith("<?xml")}function vI(r,e){let t={...wy.options.wms,...e?.wms},i=K9(r,t),n=t.minimalErrors?i:`WMS Service error: ${i}`;if(t.throwOnError)throw new Error(n);return n}function $p(r){return Array.isArray(r)?r:r?[r]:[]}function Ty(r){let e=$p(r);return e.length>0&&e.every(t=>typeof t=="string")?e:[]}function Ey(r,e=void 0){switch(typeof r){case"number":return r;case"string":return parseFloat(r);default:return}}function Tw(r,e=void 0){switch(typeof r){case"number":return r;case"string":return parseInt(r,10);default:return}}function qp(r){switch(r){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function wI(r,e){let t=yc.parseTextSync?.(r,e),i=t.WMT_MS_Capabilities||t.WMS_Capabilities||t,n=ale(i);if(e?.inheritedLayerProps)for(let s of n.layers)J9(s,null);return e?.includeRawJSON&&(n.json=i),e?.includeXMLText&&(n.xml=r),n}function ale(r){let e={version:String(r.version||""),name:String(r.Service?.Name||"unnamed"),title:r.Service?.Title?String(r.Service?.Title):void 0,abstract:r.Service?.Abstract?String(r.Service?.Abstract):void 0,keywords:Ty(r.Service?.KeywordList?.Keyword),fees:r.Service?.Fees?JSON.stringify(r.Service?.Fees):void 0,accessConstraints:r.Service?.AccessConstraints?JSON.stringify(r.Service?.AccessConstraints):void 0,layerLimit:Tw(r.Service?.LayerLimit),maxWidth:Tw(r.Service?.maxWidth),maxHeight:Tw(r.Service?.maxHeight),layers:[],requests:lle(r.Capability?.Request),exceptions:cle(r.Exception)},t=$p(r.Capability?.Layer);for(let i of t)e.layers.push(Q9(i));for(let[i,n]of Object.entries(e))n===void 0&&delete e[i];return e}function lle(r){let e={};for(let[t,i]of Object.entries(r||{})){let n=Ty(i?.Format);e[t]={mimeTypes:n}}return e}function cle(r){if($p(r?.Format).length>0)return{mimeTypes:Ty(r)}}function Q9(r){let e={title:String(r?.Title||""),name:r?.Name&&String(r?.Name),abstract:r?.Name&&String(r?.Abstract),keywords:Ty(r.KeywordList?.Keyword)},t=r?.CRS||r?.SRS;t&&Array.isArray(t)&&t.every(p=>typeof p=="string")&&(e.crs=t);let i=r?.EX_GeographicBoundingBox&&ule(r?.EX_GeographicBoundingBox);i&&(e.geographicBoundingBox=i),i=r?.LatLonBoundingBox&&hle(r?.LatLonBoundingBox),i&&(e.geographicBoundingBox=i);let n=r?.BoundingBox&&fle(r?.BoundingBox);n&&n.length>0&&(e.boundingBoxes=n);let a=$p(r?.Dimension).map(p=>ple(p));a.length&&(e.dimensions=a),r?.opaque&&(e.opaque=qp(r?.opaque)),r?.cascaded&&(e.cascaded=qp(r?.cascaded)),r?.queryable&&(e.queryable=qp(r?.queryable));let c=$p(r?.Layer),d=[];for(let p of c)d.push(Q9(p));d.length>0&&(e.layers=d);for(let[p,b]of Object.entries(e))b===void 0&&delete e[p];return e}function ule(r){let{westBoundLongitude:e,northBoundLatitude:t,eastBoundLongitude:i,southBoundLatitude:n}=r;return[[e,n],[i,t]]}function hle(r){let{minx:e,miny:t,maxx:i,maxy:n}=r;return[[e,t],[i,n]]}function fle(r){return $p(r).map(t=>dle(t))}function dle(r){let{CRS:e,SRS:t,minx:i,miny:n,maxx:s,maxy:a,resx:c,resy:d}=r,p={crs:e||t,boundingBox:[[Ey(i),Ey(n)],[Ey(s),Ey(a)]]};return c&&(p.xResolution=c),d&&(p.yResolution=d),p}function ple(r){let{name:e,units:t,value:i}=r,n={name:e,units:t,extent:i};return r.unitSymbol&&(n.unitSymbol=r.unitSymbol),r.default&&(n.defaultValue=r.default),r.multipleValues&&(n.multipleValues=qp(r.multipleValues)),r.nearestValue&&(n.nearestValue=qp(r.nearestValue)),r.current&&(n.current=qp(r.current)),n}function J9(r,e){e?.geographicBoundingBox&&!r.geographicBoundingBox&&(r.geographicBoundingBox=[...e.geographicBoundingBox]),e?.crs&&!r.crs&&(r.crs=[...e.crs]),e?.boundingBoxes&&!r.boundingBoxes&&(r.boundingBoxes=[...e.boundingBoxes]),e?.dimensions&&!r.dimensions&&(r.dimensions=[...e.dimensions]);for(let t of r.layers||[])J9(t,r)}var Ale="4.3.2",lm={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:Ale,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:mle,options:{wms:{}},parse:async(r,e)=>wI(new TextDecoder().decode(r),e?.wms),parseTextSync:(r,e)=>wI(r,e?.wms)};function mle(r){return r.startsWith("<?xml")}function TI(r,e){let i=(yc.parseTextSync?.(r,e)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(i)?i:[i]).map(s=>gle(s))}}function gle(r){return{attributes:r||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}var ez={...lm,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(r,e)=>TI(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>TI(r,e)};function EI(r,e){return yc.parseTextSync?.(r,e)}var tz={...lm,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(r,e)=>EI(new TextDecoder().decode(r),e),parseTextSync:(r,e)=>EI(r,e)};var rz={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:r=>r.toLowerCase().includes("wms"),createDataSource:(r,e)=>new SI(r,e)},SI=class extends ru{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(e,t){super(t),this.url=e,this.data=e,this.substituteCRS84=t.wms?.substituteCRS84??t.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...t.wmsParameters,...t.wms?.wmsParameters},this.vendorParameters=t.wms?.vendorParameters||t.vendorParameters||{}}async getMetadata(){let e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){let{boundingBox:t,bbox:i,...n}=e,s={bbox:t?[...t[0],...t[1]]:i,...n};return await this.getMap(s)}normalizeMetadata(e){return e}async getCapabilities(e,t){let i=this.getCapabilitiesURL(e,t),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);let a=await lm.parse(s,this.loadOptions);return this.capabilities=a,a}async getMap(e,t){let i=this.getMapURL(e,t),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);try{return await Of.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(e,t){let i=this.getFeatureInfoURL(e,t),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),await ez.parse(s,this.loadOptions)}async getFeatureInfoText(e,t){let i=this.getFeatureInfoURL(e,t),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),new TextDecoder().decode(s)}async describeLayer(e,t){let i=this.describeLayerURL(e,t),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),await tz.parse(s,this.loadOptions)}async getLegendGraphic(e,t){let i=this.getLegendGraphicURL(e,t),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);try{return await Of.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(e,t){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",i,t)}getMapURL(e,t){e=this._getWMS130Parameters(e);let i={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",i,t)}getFeatureInfoURL(e,t){e=this._getWMS130Parameters(e);let{boundingBox:i,bbox:n}=e;e.bbox=i?[...i[0],...i[1]]:n;let s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",s,t)}describeLayerURL(e,t){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",i,t)}getLegendGraphicURL(e,t){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",i,t)}_parseWMSUrl(e){let[t,i]=e.split("?"),n=i.split("&"),s={};for(let a of n){let[c,d]=a.split("=");s[c]=d}return{url:t,parameters:s}}_getWMSUrl(e,t,i){let n=this.url,s=!0,a={service:"WMS",version:t.version,request:e,...t,...this.vendorParameters,...i},c=["transparent","time","elevation"];for(let[d,p]of Object.entries(a))(!c.includes(d)||p)&&(n+=s?"?":"&",s=!1,n+=this._getURLParameter(d,p,t));return encodeURI(n)}_getWMS130Parameters(e){let t={...e};return t.srs&&(t.crs=t.crs||t.srs,delete t.srs),t}_getURLParameter(e,t,i){switch(e){case"crs":i.version!=="1.3.0"?e="srs":this.substituteCRS84&&t==="EPSG:4326"&&(t="CRS:84");break;case"srs":i.version==="1.3.0"&&(e="crs");break;case"bbox":let n=this._flipBoundingBox(t,i);n&&(t=n);break;case"x":i.version==="1.3.0"&&(e="i");break;case"y":i.version==="1.3.0"&&(e="j");break;default:}return e=e.toUpperCase(),Array.isArray(t)?`${e}=${t.join(",")}`:`${e}=${t?String(t):""}`}_flipBoundingBox(e,t){if(!Array.isArray(e)||e.length!==4)return null;let i=t.version==="1.3.0"&&this.flipCRS.includes(t.crs||"")&&!(this.substituteCRS84&&t.crs==="EPSG:4326"),n=e;return i?[n[1],n[0],n[3],n[2]]:n}async _fetchArrayBuffer(e){let t=await this.fetch(e),i=await t.arrayBuffer();return this._checkResponse(t,i),i}_checkResponse(e,t){let i=e.headers["content-type"];if(!e.ok||wy.mimeTypes.includes(i)){let n=Rg(this.loadOptions,{wms:{throwOnError:!0}}),s=wy.parseSync?.(t,n);throw new Error(s)}}_parseError(e){let t=wy.parseSync?.(e,this.loadOptions);return new Error(t)}};var iz={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:r=>r.toLowerCase().includes("ImageServer"),createDataSource:(r,e)=>new CI(r,e)},CI=class extends ru{url;data;constructor(e,t){super(t),this.url=e,this.data=e}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.url}?f=pjson`}exportImageURL(e){let t=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,i=`size=${e.width},${e.height}`,n={...e,bbox:t,size:i};return delete n.width,delete n.height,this.getUrl("exportImage",n)}getUrl(e,t,i){let n=`${this.url}/${e}`,s=!0;for(let[a,c]of Object.entries(t))n+=s?"?":"&",s=!1,Array.isArray(c)?n+=`${a.toUpperCase()}=${c.join(",")}`:n+=`${a.toUpperCase()}=${c?String(c):""}`;return n}async checkResponse(e){if(!e.ok)throw new Error("error")}};var _le=[rz,iz];function II(r,e=_le){let{type:t="auto"}=r,i=t==="auto"?xle(r.url,e):yle(t,e);if(!i)throw new Error("Not a valid image source type");return i.createDataSource(r.url,r)}function yle(r,e){for(let t of e)if(t.type===r)return t;return null}function xle(r,e){for(let t of e)if(t.testURL&&t.testURL(r))return t;return null}var nz=6378137*Math.PI;function PI(r){let e=$s(r);return e[0]=(e[0]/256-1)*nz,e[1]=(e[1]/256-1)*nz,e}var ble={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(r,e)=>console.error(e,r)}},cm=class extends Zn{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:t,oldProps:i}){let{viewport:n}=this.context;e.dataChanged||t.serviceType!==i.serviceType?(this.state.imageSource=this._createImageSource(t),this._loadMetadata(),this.debounce(()=>this.loadImage(n,"image source changed"),0)):hn(t.layers,i.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(n,"viewport changed")):this.debounce(()=>this.loadImage(n,"layers changed"),0)}finalizeState(){}renderLayers(){let{bounds:e,image:t,lastRequestParameters:i}=this.state;return t&&new Ov({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:i.srs==="EPSG:4326"?br.LNGLAT:br.CARTESIAN,bounds:e,image:t})}async getFeatureInfoText(e,t){let{lastRequestParameters:i}=this.state;return i?await this.state.imageSource.getFeatureInfoText?.({...i,query_layers:i.layers,x:e,y:t,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(e){if(e.data instanceof ru)return e.data;if(typeof e.data=="string")return II({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){let{imageSource:e}=this.state;try{this.state.loadCounter++;let t=await e.getMetadata();this.state.imageSource===e&&this.getCurrentLayer()?.props.onMetadataLoad(t)}catch(t){this.getCurrentLayer()?.props.onMetadataLoadError(t)}finally{this.state.loadCounter--}}async loadImage(e,t){let{layers:i,serviceType:n}=this.props;if(n==="wms"&&i.length===0)return;let s=e.getBounds(),{width:a,height:c}=e,d=this.getRequestId(),{srs:p}=this.props;p==="auto"&&(p=e.resolution?"EPSG:4326":"EPSG:3857");let b={width:a,height:c,boundingBox:[[s[0],s[1]],[s[2],s[3]]],layers:i,crs:p};if(p==="EPSG:3857"){let T=PI([s[0],s[1]]),B=PI([s[2],s[3]]);b.boundingBox=[T,B]}try{this.state.loadCounter++,this.props.onImageLoadStart(d);let T=await this.state.imageSource.getImage(b);this.state.lastRequestId<d&&(this.getCurrentLayer()?.props.onImageLoad(d),this.setState({image:T,bounds:s,lastRequestParameters:b,lastRequestId:d}))}catch(T){this.raiseError(T,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(d,T)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,t=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),t)}};cm.layerName="WMSLayer";cm.defaultProps=ble;var vle={getHeight:{type:"accessor",value:0},greatCircle:!0},Sy=class extends Lv{};Sy.layerName="GreatCircleLayer";Sy.defaultProps=vle;var sz=Sy;var wle={...nd.defaultProps},Cy=class extends Zn{indexToBounds(){return null}renderLayers(){let{elevationScale:e,extruded:t,wireframe:i,filled:n,stroked:s,lineWidthUnits:a,lineWidthScale:c,lineWidthMinPixels:d,lineWidthMaxPixels:p,lineJointRounded:b,lineMiterLimit:T,lineDashJustified:B,getElevation:z,getFillColor:G,getLineColor:Z,getLineWidth:q}=this.props,{updateTriggers:re,material:ee,transitions:ae}=this.props,me=this.getSubLayerClass("cell",nd),{updateTriggers:Le,...je}=this.indexToBounds()||{};return new me({filled:n,wireframe:i,extruded:t,elevationScale:e,stroked:s,lineWidthUnits:a,lineWidthScale:c,lineWidthMinPixels:d,lineWidthMaxPixels:p,lineJointRounded:b,lineMiterLimit:T,lineDashJustified:B,material:ee,transitions:ae,getElevation:z,getFillColor:G,getLineColor:Z,getLineWidth:q},this.getSubLayerProps({id:"cell",updateTriggers:re&&{...Le,getElevation:re.getElevation,getFillColor:re.getFillColor,getLineColor:re.getLineColor,getLineWidth:re.getLineWidth}}),je)}};Cy.layerName="GeoCellLayer";Cy.defaultProps=wle;var Eu=Cy;var Ew=Tf(MI(),1),Tle=3,Ele=30,Sle=2*Ele+1,az=180/Math.PI;function cz(r,e,t){let i=1<<e;return[(r[0]+t[0])/i,(r[1]+t[1])/i]}function lz(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function uz(r){return[lz(r[0]),lz(r[1])]}function hz(r,[e,t]){switch(r){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function fz([r,e,t]){let i=Math.atan2(t,Math.sqrt(r*r+e*e));return[Math.atan2(e,r)*az,i*az]}function dz(r){let e=Ew.default.fromString(r,!0,10).toString(2);for(;e.length<Tle+Sle;)e="0"+e;let t=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,t),s=n.length/2,a=Ew.default.fromString(i,!0,2).toString(10),c=Ew.default.fromString(n,!0,2).toString(4);for(;c.length<s;)c="0"+c;return`${a}/${c}`}function Cle(r,e,t,i){if(i===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function pz(r){let e=r.split("/"),t=parseInt(e[0],10),i=e[1],n=i.length,s=[0,0],a;for(let c=n-1;c>=0;c--){a=n-c;let d=i[c],p=0,b=0;d==="1"?b=1:d==="2"?(p=1,b=1):d==="3"&&(p=1);let T=Math.pow(2,a-1);Cle(T,s,p,b),s[0]+=T*p,s[1]+=T*b}if(t%2===1){let c=s[0];s[0]=s[1],s[1]=c}return{face:t,ij:s,level:a}}var Az=Tf(MI(),1);function Ile(r){let e=r.padEnd(16,"0");return Az.default.fromString(e,16)}var Ple=100;function Mle({face:r,ij:e,level:t}){let i=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(Ple*Math.pow(2,-t))),s=new Float64Array(4*n*2+2),a=0,c=0;for(let d=0;d<4;d++){let p=i[d].slice(0),b=i[d+1],T=(b[0]-p[0])/n,B=(b[1]-p[1])/n;for(let z=0;z<n;z++){p[0]+=T,p[1]+=B;let G=cz(e,t,p),Z=uz(G),q=hz(r,Z),re=fz(q);Math.abs(re[1])>89.999&&(re[0]=c);let ee=re[0]-c;re[0]+=ee>180?-360:ee<-180?360:0,s[a++]=re[0],s[a++]=re[1],c=re[0]}}return s[a++]=s[0],s[a++]=s[1],s}function Rle(r){if(typeof r=="string"){if(r.indexOf("/")>0)return r;r=Ile(r)}return dz(r.toString())}function mz(r){let e=Rle(r),t=pz(e);return Mle(t)}var Ble={getS2Token:{type:"accessor",value:r=>r.token}},Py=class extends Eu{indexToBounds(){let{data:e,getS2Token:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>mz(t(i,n))}}};Py.layerName="S2Layer";Py.defaultProps=Ble;var gz=Py;var RI=512;function Lle(r,e){let t=0,i=0,n=1<<r.length,s=n/RI;for(let a=0;a<r.length;a++){n>>=1;let c=parseInt(r[a]);c%2&&(t|=n),c>1&&(i|=n)}return[[t/s,RI-i/s],[(t+e)/s,RI-(i+e)/s]]}function _z(r,e=1){let[t,i]=Lle(r,e),[n,s]=Lo(t),[a,c]=Lo(i);return[a,s,a,c,n,c,n,s,a,s]}var Ole={getQuadkey:{type:"accessor",value:r=>r.quadkey}},My=class extends Eu{indexToBounds(){let{data:e,extruded:t,getQuadkey:i}=this.props,n=t?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(s,a)=>_z(i(s,a),n),updateTriggers:{getPolygon:n}}}};My.layerName="QuadkeyLayer";My.defaultProps=Ole;var yz=My;var Zp=class{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:t,onLoad:i,onError:n}){let{index:s,id:a,bbox:c,userData:d,zoom:p}=this,b=this._loaderId;this._abortController=new AbortController;let{signal:T}=this._abortController,B=await t.scheduleRequest(this,Z=>Z.isSelected?1:-1);if(!B){this._isCancelled=!0;return}if(this._isCancelled){B.done();return}let z=null,G;try{z=await e({index:s,id:a,bbox:c,userData:d,zoom:p,signal:T})}catch(Z){G=Z||!0}finally{B.done()}if(b===this._loaderId){if(this._loader=void 0,this.content=z,this._isCancelled&&!z){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,G?n(G,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}};var xs={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var xz=new st,Dle=new st,um=class r{constructor(e=[0,0,0],t=[0,0,0],i){i=i||xz.copy(e).add(t).scale(.5),this.center=new st(i),this.halfDiagonal=new st(t).subtract(this.center),this.minimum=new st(e),this.maximum=new st(t)}clone(){return new r(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:t}=this,i=Dle.from(e.normal),n=t.x*Math.abs(i.x)+t.y*Math.abs(i.y)+t.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-n>0?xs.INSIDE:s+n<0?xs.OUTSIDE:xs.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t=xz.from(e).subtract(this.center),{halfDiagonal:i}=this,n=0,s;return s=Math.abs(t.x)-i.x,s>0&&(n+=s*s),s=Math.abs(t.y)-i.y,s>0&&(n+=s*s),s=Math.abs(t.z)-i.z,s>0&&(n+=s*s),n}};var Ry=new st,bz=new st,Su=class r{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new st,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Ry.from(t),this.center=new st().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new r(this.center,this.radius)}union(e){let t=this.center,i=this.radius,n=e.center,s=e.radius,a=Ry.copy(n).subtract(t),c=a.magnitude();if(i>=c+s)return this.clone();if(s>=c+i)return e.clone();let d=(i+c+s)*.5;return bz.copy(a).scale((-i+d)/c).add(t),this.center.copy(bz),this.radius=d,this}expand(e){let i=Ry.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);let t=ms.getScaling(Ry,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){let t=this.distanceTo(e);return t*t}distanceTo(e){let i=Ry.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){let t=this.center,i=this.radius,s=e.normal.dot(t)+e.distance;return s<-i?xs.OUTSIDE:s<i?xs.INTERSECTING:xs.INSIDE}};var kle=new st,Fle=new st,Sw=new st,Cw=new st,Iw=new st,Nle=new st,zle=new st,Th={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},Eh=class r{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new st().from(e),this.halfAxes=new nn(t)}get halfSize(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new st(e).len(),new st(t).len(),new st(i).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new st(e).normalize(),s=new st(t).normalize(),a=new st(i).normalize();return new ml().fromMatrix3(new nn([...n,...s,...a]))}fromCenterHalfSizeQuaternion(e,t,i){let n=new ml(i),s=new nn().fromQuaternion(n);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new st().from(e),this.halfAxes=s,this}clone(){return new r(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new Su){let t=this.halfAxes,i=t.getColumn(0,Sw),n=t.getColumn(1,Cw),s=t.getColumn(2,Iw),a=kle.copy(i).add(n).add(s);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){let t=this.center,i=e.normal,n=this.halfAxes,s=i.x,a=i.y,c=i.z,d=Math.abs(s*n[Th.COLUMN0ROW0]+a*n[Th.COLUMN0ROW1]+c*n[Th.COLUMN0ROW2])+Math.abs(s*n[Th.COLUMN1ROW0]+a*n[Th.COLUMN1ROW1]+c*n[Th.COLUMN1ROW2])+Math.abs(s*n[Th.COLUMN2ROW0]+a*n[Th.COLUMN2ROW1]+c*n[Th.COLUMN2ROW2]),p=i.dot(t)+e.distance;return p<=-d?xs.OUTSIDE:p>=d?xs.INSIDE:xs.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t=Fle.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,Sw),s=i.getColumn(1,Cw),a=i.getColumn(2,Iw),c=n.magnitude(),d=s.magnitude(),p=a.magnitude();n.normalize(),s.normalize(),a.normalize();let b=0,T;return T=Math.abs(t.dot(n))-c,T>0&&(b+=T*T),T=Math.abs(t.dot(s))-d,T>0&&(b+=T*T),T=Math.abs(t.dot(a))-p,T>0&&(b+=T*T),b}computePlaneDistances(e,t,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=this.center,c=this.halfAxes,d=c.getColumn(0,Sw),p=c.getColumn(1,Cw),b=c.getColumn(2,Iw),T=Nle.copy(d).add(p).add(b).add(a),B=zle.copy(T).subtract(e),z=t.dot(B);return n=Math.min(z,n),s=Math.max(z,s),T.copy(a).add(d).add(p).subtract(b),B.copy(T).subtract(e),z=t.dot(B),n=Math.min(z,n),s=Math.max(z,s),T.copy(a).add(d).subtract(p).add(b),B.copy(T).subtract(e),z=t.dot(B),n=Math.min(z,n),s=Math.max(z,s),T.copy(a).add(d).subtract(p).subtract(b),B.copy(T).subtract(e),z=t.dot(B),n=Math.min(z,n),s=Math.max(z,s),a.copy(T).subtract(d).add(p).add(b),B.copy(T).subtract(e),z=t.dot(B),n=Math.min(z,n),s=Math.max(z,s),a.copy(T).subtract(d).add(p).subtract(b),B.copy(T).subtract(e),z=t.dot(B),n=Math.min(z,n),s=Math.max(z,s),a.copy(T).subtract(d).subtract(p).add(b),B.copy(T).subtract(e),z=t.dot(B),n=Math.min(z,n),s=Math.max(z,s),a.copy(T).subtract(d).subtract(p).subtract(b),B.copy(T).subtract(e),z=t.dot(B),n=Math.min(z,n),s=Math.max(z,s),i[0]=n,i[1]=s,i}transform(e){this.center.transformAsPoint(e);let t=this.halfAxes.getColumn(0,Sw);t.transformAsPoint(e);let i=this.halfAxes.getColumn(1,Cw);i.transformAsPoint(e);let n=this.halfAxes.getColumn(2,Iw);return n.transformAsPoint(e),this.halfAxes=new nn([...t,...i,...n]),this}getTransform(){throw new Error("not implemented")}};var vz=new st,wz=new st,Oo=class r{constructor(e=[0,0,1],t=0){this.normal=new st,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return lo(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=vz.from(e),this.normal.from(t).normalize();let i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,n){return this.normal.set(e,t,i),lo(Bs(this.normal.len(),1)),this.distance=n,this}clone(){return new r(this.normal,this.distance)}equals(e){return Bs(this.distance,e.distance)&&Bs(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let t=wz.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e,t=[0,0,0]){let i=vz.from(e),n=this.getPointDistance(i),s=wz.copy(this.normal).scale(n);return i.subtract(s).to(t)}};var Tz=[new st([1,0,0]),new st([0,1,0]),new st([0,0,1])],Ez=new st,Ule=new st,Qo=class r{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*Tz.length;let t=e.center,i=e.radius,n=0;for(let s of Tz){let a=this.planes[n],c=this.planes[n+1];a||(a=this.planes[n]=new Oo),c||(c=this.planes[n+1]=new Oo);let d=Ez.copy(s).scale(-i).add(t);a.fromPointNormal(d,s);let p=Ez.copy(s).scale(i).add(t),b=Ule.copy(s).negate();c.fromPointNormal(p,b),n+=2}return this}computeVisibility(e){let t=xs.INSIDE;for(let i of this.planes)switch(e.intersectPlane(i)){case xs.OUTSIDE:return xs.OUTSIDE;case xs.INTERSECTING:t=xs.INTERSECTING;break;default:}return t}computeVisibilityWithPlaneMask(e,t){if(lo(Number.isFinite(t),"parentPlaneMask is required."),t===r.MASK_OUTSIDE||t===r.MASK_INSIDE)return t;let i=r.MASK_INSIDE,n=this.planes;for(let s=0;s<this.planes.length;++s){let a=s<31?1<<s:0;if(s<31&&!(t&a))continue;let c=n[s],d=e.intersectPlane(c);if(d===xs.OUTSIDE)return r.MASK_OUTSIDE;d===xs.INTERSECTING&&(i|=a)}return i}};Qo.MASK_OUTSIDE=4294967295;Qo.MASK_INSIDE=0;Qo.MASK_INDETERMINATE=2147483647;var bUe=new st,vUe=new st,wUe=new st,TUe=new st,EUe=new st;var RUe=new st,BUe=new st,LUe=new st,OUe=new st,DUe=new st,kUe=new st,FUe=new st,NUe=new st,zUe=new st,UUe=new st,VUe=new st,jUe=new st;var Cu=new nn,jle=new nn,Gle=new nn,Pw=new nn,Sz=new nn;function OI(r,e={}){let t=lc.EPSILON20,i=10,n=0,s=0,a=jle,c=Gle;a.identity(),c.copy(r);let d=t*Hle(c);for(;s<i&&Wle(c)>d;)$le(c,Pw),Sz.copy(Pw).transpose(),c.multiplyRight(Pw),c.multiplyLeft(Sz),a.multiplyRight(Pw),++n>2&&(++s,n=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=c.toTarget(e.diagonal),e}function Hle(r){let e=0;for(let t=0;t<9;++t){let i=r[t];e+=i*i}return Math.sqrt(e)}var BI=[1,0,0],LI=[2,2,1];function Wle(r){let e=0;for(let t=0;t<3;++t){let i=r[Cu.getElementIndex(LI[t],BI[t])];e+=2*i*i}return Math.sqrt(e)}function $le(r,e){let t=lc.EPSILON15,i=0,n=1;for(let p=0;p<3;++p){let b=Math.abs(r[Cu.getElementIndex(LI[p],BI[p])]);b>i&&(n=p,i=b)}let s=BI[n],a=LI[n],c=1,d=0;if(Math.abs(r[Cu.getElementIndex(a,s)])>t){let p=r[Cu.getElementIndex(a,a)],b=r[Cu.getElementIndex(s,s)],T=r[Cu.getElementIndex(a,s)],B=(p-b)/2/T,z;B<0?z=-1/(-B+Math.sqrt(1+B*B)):z=1/(B+Math.sqrt(1+B*B)),c=1/Math.sqrt(1+z*z),d=z*c}return nn.IDENTITY.to(e),e[Cu.getElementIndex(s,s)]=e[Cu.getElementIndex(a,a)]=c,e[Cu.getElementIndex(a,s)]=d,e[Cu.getElementIndex(s,a)]=-d,e}var ld=new st,qle=new st,Zle=new st,Xle=new st,Yle=new st,Kle=new nn,Qle={diagonal:new nn,unitary:new nn};function By(r,e=new Eh){if(!r||r.length===0)return e.halfAxes=new nn([0,0,0,0,0,0,0,0,0]),e.center=new st,e;let t=r.length,i=new st(0,0,0);for(let te of r)i.add(te);let n=1/t;i.multiplyByScalar(n);let s=0,a=0,c=0,d=0,p=0,b=0;for(let te of r){let X=ld.copy(te).subtract(i);s+=X.x*X.x,a+=X.x*X.y,c+=X.x*X.z,d+=X.y*X.y,p+=X.y*X.z,b+=X.z*X.z}s*=n,a*=n,c*=n,d*=n,p*=n,b*=n;let T=Kle;T[0]=s,T[1]=a,T[2]=c,T[3]=a,T[4]=d,T[5]=p,T[6]=c,T[7]=p,T[8]=b;let{unitary:B}=OI(T,Qle),z=e.halfAxes.copy(B),G=z.getColumn(0,Zle),Z=z.getColumn(1,Xle),q=z.getColumn(2,Yle),re=-Number.MAX_VALUE,ee=-Number.MAX_VALUE,ae=-Number.MAX_VALUE,me=Number.MAX_VALUE,Le=Number.MAX_VALUE,je=Number.MAX_VALUE;for(let te of r)ld.copy(te),re=Math.max(ld.dot(G),re),ee=Math.max(ld.dot(Z),ee),ae=Math.max(ld.dot(q),ae),me=Math.min(ld.dot(G),me),Le=Math.min(ld.dot(Z),Le),je=Math.min(ld.dot(q),je);G=G.multiplyByScalar(.5*(me+re)),Z=Z.multiplyByScalar(.5*(Le+ee)),q=q.multiplyByScalar(.5*(je+ae)),e.center.copy(G).add(Z).add(q);let Je=qle.set(re-me,ee-Le,ae-je).multiplyByScalar(.5),J=new nn([Je[0],0,0,0,Je[1],0,0,0,Je[2]]);return e.halfAxes.multiplyRight(J),e}var hm=512,Cz=3,Iz=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],Pz=Iz.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),Jle=Pz.concat([[.25,.5],[.75,.5]]),DI=class r{constructor(e,t,i){this.x=e,this.y=t,this.z=i}get children(){if(!this._children){let e=this.x*2,t=this.y*2,i=this.z+1;this._children=[new r(e,t,i),new r(e,t+1,i),new r(e+1,t,i),new r(e+1,t+1,i)]}return this._children}update(e){let{viewport:t,cullingVolume:i,elevationBounds:n,minZ:s,maxZ:a,bounds:c,offset:d,project:p}=e,b=this.getBoundingVolume(n,d,p);if(c&&!this.insideBounds(c)||i.computeVisibility(b)<0)return!1;if(!this.childVisible){let{z:B}=this;if(B<a&&B>=s){let z=b.distanceTo(t.cameraPosition)*t.scale/t.height;B+=Math.floor(Math.log2(z))}if(B>=a)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let B of this.children)B.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let t of this._children)t.getSelected(e);return e}insideBounds([e,t,i,n]){let s=Math.pow(2,this.z),a=hm/s;return this.x*a<i&&this.y*a<n&&(this.x+1)*a>e&&(this.y+1)*a>t}getBoundingVolume(e,t,i){if(i){let d=this.z<1?Jle:this.z<2?Pz:Iz,p=[];for(let b of d){let T=Mw(this.x+b[0],this.y+b[1],this.z);T[2]=e[0],p.push(i(T)),e[0]!==e[1]&&(T[2]=e[1],p.push(i(T)))}return By(p)}let n=Math.pow(2,this.z),s=hm/n,a=this.x*s+t*hm,c=hm-(this.y+1)*s;return new um([a,c,e[0]],[a+s,c+s,e[1]])}};function Mz(r,e,t,i){let n=r instanceof Qf&&r.resolution?r.projectPosition:null,s=Object.values(r.getFrustumPlanes()).map(({normal:z,distance:G})=>new Oo(z.clone().negate(),G)),a=new Qo(s),c=r.distanceScales.unitsPerMeter[2],d=t&&t[0]*c||0,p=t&&t[1]*c||0,b=r instanceof fu&&r.pitch<=60?e:0;if(i){let[z,G,Z,q]=i,re=$s([z,q]),ee=$s([Z,G]);i=[re[0],hm-re[1],ee[0],hm-ee[1]]}let T=new DI(0,0,0),B={viewport:r,project:n,cullingVolume:a,elevationBounds:[d,p],minZ:b,maxZ:e,bounds:i,offset:0};if(T.update(B),r instanceof fu&&r.subViewports&&r.subViewports.length>1){for(B.offset=-1;T.update(B)&&!(--B.offset<-Cz););for(B.offset=1;T.update(B)&&!(++B.offset>Cz););}return T.getSelected()}var Sh=512,ece=[-1/0,-1/0,1/0,1/0],cd={type:"object",value:null,validate:(r,e)=>e.optional&&r===null||typeof r=="string"||Array.isArray(r)&&r.every(t=>typeof t=="string"),equal:(r,e)=>{if(r===e)return!0;if(!Array.isArray(r)||!Array.isArray(e))return!1;let t=r.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}};function Bz(r,e){let t=[e.transformAsPoint([r[0],r[1]]),e.transformAsPoint([r[2],r[1]]),e.transformAsPoint([r[0],r[3]]),e.transformAsPoint([r[2],r[3]])];return[Math.min(...t.map(n=>n[0])),Math.min(...t.map(n=>n[1])),Math.max(...t.map(n=>n[0])),Math.max(...t.map(n=>n[1]))]}function tce(r){return Math.abs(r.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt(0)|0,0))}function Iu(r,e){if(!r||!r.length)return null;let{index:t,id:i}=e;if(Array.isArray(r)){let s=tce(i)%r.length;r=r[s]}let n=r;for(let s of Object.keys(t)){let a=new RegExp(`{${s}}`,"g");n=n.replace(a,String(t[s]))}return Number.isInteger(t.y)&&Number.isInteger(t.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,t.z)-t.y-1))),n}function rce(r,e,t){let i;if(e&&e.length===2){let[n,s]=e,a=r.getBounds({z:n}),c=r.getBounds({z:s});i=[Math.min(a[0],c[0]),Math.min(a[1],c[1]),Math.max(a[2],c[2]),Math.max(a[3],c[3])]}else i=r.getBounds();return r.isGeospatial?[Math.max(i[0],t[0]),Math.max(i[1],t[1]),Math.min(i[2],t[2]),Math.min(i[3],t[3])]:[Math.max(Math.min(i[0],t[2]),t[0]),Math.max(Math.min(i[1],t[3]),t[1]),Math.min(Math.max(i[2],t[0]),t[2]),Math.min(Math.max(i[3],t[1]),t[3])]}function Lz({viewport:r,z:e,cullRect:t}){return(r.subViewports||[r]).map(n=>kI(n,e||0,t))}function kI(r,e,t){if(!Array.isArray(e)){let s=t.x-r.x,a=t.y-r.y,{width:c,height:d}=t,p={targetZ:e},b=r.unproject([s,a],p),T=r.unproject([s+c,a],p),B=r.unproject([s,a+d],p),z=r.unproject([s+c,a+d],p);return[Math.min(b[0],T[0],B[0],z[0]),Math.min(b[1],T[1],B[1],z[1]),Math.max(b[0],T[0],B[0],z[0]),Math.max(b[1],T[1],B[1],z[1])]}let i=kI(r,e[0],t),n=kI(r,e[1],t);return[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]}function ice(r,e,t){return t?Bz(r,t).map(n=>n*e/Sh):r.map(i=>i*e/Sh)}function FI(r,e){return Math.pow(2,r)*Sh/e}function Mw(r,e,t){let i=FI(t,Sh),n=r/i*360-180,s=Math.PI-2*Math.PI*e/i,a=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[n,a]}function Rz(r,e,t,i){let n=FI(t,i);return[r/n*Sh,e/n*Sh]}function NI(r,e,t,i,n=Sh){if(r.isGeospatial){let[p,b]=Mw(e,t,i),[T,B]=Mw(e+1,t+1,i);return{west:p,north:b,east:T,south:B}}let[s,a]=Rz(e,t,i,n),[c,d]=Rz(e+1,t+1,i,n);return{left:s,top:a,right:c,bottom:d}}function nce(r,e,t,i,n){let s=rce(r,null,i),a=FI(e,t),[c,d,p,b]=ice(s,a,n),T=[];for(let B=Math.floor(c);B<p;B++)for(let z=Math.floor(d);z<b;z++)T.push({x:B,y:z,z:e});return T}function zI({viewport:r,maxZoom:e,minZoom:t,zRange:i,extent:n,tileSize:s=Sh,modelMatrix:a,modelMatrixInverse:c,zoomOffset:d=0}){let p=r.isGeospatial?Math.round(r.zoom+Math.log2(Sh/s))+d:Math.ceil(r.zoom)+d;if(typeof t=="number"&&Number.isFinite(t)&&p<t){if(!n)return[];p=t}typeof e=="number"&&Number.isFinite(e)&&p>e&&(p=e);let b=n;return a&&c&&n&&!r.isGeospatial&&(b=Bz(n,a)),r.isGeospatial?Mz(r,p,i,n):nce(r,p,s,b||ece,c)}function UI(r){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(r)}function VI(r){return Number.isFinite(r.west)&&Number.isFinite(r.north)&&Number.isFinite(r.east)&&Number.isFinite(r.south)}function Oz(r){let e={},t;return i=>{for(let n in i)if(!sce(i[n],e[n])){t=r(i),e=i;break}return t}}function sce(r,e){if(r===e)return!0;if(Array.isArray(r)){let t=r.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}return!1}var Dz=1,Rw=2,oce="never",ace="no-overlap",Ly="best-available",lce=5,cce={[Ly]:hce,[ace]:fce,[oce]:()=>{}},uce={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}},Xp=class{constructor(e){this._getCullBounds=Oz(Lz),this.opts={...uce,...e},this.setOptions(this.opts),this.onTileLoad=t=>{this.opts.onTileLoad?.(t),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new Lf({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new vr,this._modelMatrixInverse=new vr}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let t=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(t)?this._cache.delete(e):t.setNeedsReload()}}update(e,{zRange:t,modelMatrix:i}={zRange:null,modelMatrix:null}){let n=i?new vr(i):new vr,s=!n.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Bs(this._zRange,t)||s){s&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=e,this._zRange=t;let c=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:t,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(d=>this._getTile(d,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));let a=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),a&&this._frameNumber++,this._frameNumber}isTileVisible(e,t){if(!e.isVisible)return!1;if(t&&this._viewport){let i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:t}),{bbox:n}=e;for(let[s,a,c,d]of i){let p;if("west"in n)p=n.west<c&&n.east>s&&n.south<d&&n.north>a;else{let b=Math.min(n.top,n.bottom),T=Math.max(n.top,n.bottom);p=n.left<c&&n.right>s&&b<d&&T>a}if(p)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:t,minZoom:i,zRange:n,modelMatrix:s,modelMatrixInverse:a}){let{tileSize:c,extent:d,zoomOffset:p}=this.opts;return zI({viewport:e,maxZoom:t,minZoom:i,zRange:n,tileSize:c,extent:d,modelMatrix:s,modelMatrixInverse:a,zoomOffset:p})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:t}=this.opts;return{bbox:NI(this._viewport,e.x,e.y,e.z,t)}}getParentIndex(e){let t=Math.floor(e.x/2),i=Math.floor(e.y/2),n=e.z-1;return{x:t,y:i,z:n}}updateTileStates(){let e=this.opts.refinementStrategy||Ly,t=new Array(this._cache.size),i=0;for(let n of this._cache.values())t[i++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(let n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof e=="function"?e:cce[e])(Array.from(this._cache.values())),i=0;for(let n of this._cache.values())if(t[i++]!==n.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e=0}=this.opts,t=[],i=0;for(let n of this._cache.values())n.isLoading&&(i++,!n.isSelected&&!n.isVisible&&t.push(n));for(;e>0&&i>e&&t.length>0;)t.shift().abort(),i--}_rebuildTree(){let{_cache:e}=this;for(let t of e.values())t.parent=null,t.children&&(t.children.length=0);for(let t of e.values()){let i=this._getNearestAncestor(t);t.parent=i,i?.children&&i.children.push(t)}}_resizeCache(){let{_cache:e,opts:t}=this,i=t.maxCacheSize??(t.maxCacheByteSize!==null?1/0:lce*this.selectedTiles.length),n=t.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>n){for(let[a,c]of e)if(!c.isVisible&&!c.isSelected&&(this._cacheByteSize-=t.maxCacheByteSize!==null?c.byteLength:0,e.delete(a),this.opts.onTileUnload?.(c)),e.size<=i&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((a,c)=>a.zoom-c.zoom),this._dirty=!1)}_getTile(e,t){let i=this.getTileId(e),n=this._cache.get(i),s=!1;return!n&&t?(n=new Zp(e),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:i,zoom:this.getTileZoom(n.index)}),s=!0,this._cache.set(i,n),this._dirty=!0):n&&n.needsReload&&(s=!0),n&&s&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(e){let{_minZoom:t=0}=this,i=e.index;for(;this.getTileZoom(i)>t;){i=this.getParentIndex(i);let n=this._getTile(i);if(n)return n}return null}};function hce(r){for(let e of r)e.state=0;for(let e of r)e.isSelected&&!kz(e)&&jI(e);for(let e of r)e.isVisible=!!(e.state&Rw)}function fce(r){for(let t of r)t.state=0;for(let t of r)t.isSelected&&kz(t);let e=Array.from(r).sort((t,i)=>t.zoom-i.zoom);for(let t of e)if(t.isVisible=!!(t.state&Rw),t.children&&(t.isVisible||t.state&Dz))for(let i of t.children)i.state=Dz;else t.isSelected&&jI(t)}function kz(r){let e=r;for(;e;){if(e.isLoaded||e.content)return e.state|=Rw,!0;e=e.parent}return!1}function jI(r){for(let e of r.children)e.isLoaded||e.content?e.state|=Rw:jI(e)}var dce={TilesetClass:Xp,data:{type:"data",value:[]},dataComparator:cd.equal,renderSubLayers:{type:"function",value:r=>new Hp(r)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:r=>console.error(r)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Ly,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Oy=class extends Zn{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(t=>t.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:t}=this.state,i=e.propsOrDataChanged||e.updateTriggersChanged,n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);t?i&&(t.setOptions(this._getTilesetOptions()),n?t.reloadAll():t.tiles.forEach(s=>{s.layers=null})):(t=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:t})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:t,maxCacheByteSize:i,refinementStrategy:n,extent:s,maxZoom:a,minZoom:c,maxRequests:d,debounceTime:p,zoomOffset:b}=this.props;return{maxCacheSize:t,maxCacheByteSize:i,maxZoom:a,minZoom:c,tileSize:e,refinementStrategy:n,extent:s,maxRequests:d,debounceTime:p,zoomOffset:b,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let e=this.state.tileset,{zRange:t,modelMatrix:i}=this.props,n=e.update(this.context.viewport,{zRange:t,modelMatrix:i}),{isLoaded:s}=e,a=this.state.isLoaded!==s,c=this.state.frameNumber!==n;s&&(a||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:n}),this.state.isLoaded=s}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:t}=this.props;t&&t(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,t){this.props.onTileError(e),t.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:t,getTileData:i,fetch:n}=this.props,{signal:s}=e;return e.url=typeof t=="string"||Array.isArray(t)?Iu(t,e):null,i?i(e):n&&e.url?n(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let t=e.sourceLayer,i=t.props.tile,n=e.info;return n.picked&&(n.tile=i),n.sourceTile=i,n.sourceTileSubLayer=t,n}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{let t=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)t&&e.layers[0]&&Object.keys(t).some(i=>e.layers[0].props[i]!==t[i])&&(e.layers=e.layers.map(i=>i.clone(t)));else{let i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=ma(i,Boolean).map(n=>n.clone({tile:e,...t}))}return e.layers})}filterSubLayer({layer:e,cullRect:t}){let{tile:i}=e.props;return this.state.tileset.isTileVisible(i,t)}};Oy.defaultProps=dce;Oy.layerName="TileLayer";var Yp=Oy;var Fz=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,Nz={name:"trips",vs:Fz,fs:Fz,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}};var pce={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:r=>r.timestamps}},Dy=class extends wu{getShaders(){let e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,Nz],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){let{fadeTrail:t,trailLength:i,currentTime:n}=this.props,s={fadeTrail:t,trailLength:i,currentTime:n};this.state.model.shaderInputs.setProps({trips:s}),super.draw(e)}};Dy.layerName="TripsLayer";Dy.defaultProps=pce;var zz=Dy;var Yi=function(r){r=r||{};var e=typeof r<"u"?r:{},t={},i;for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);var n=[],s="";function a(gt){return e.locateFile?e.locateFile(gt,s):s+gt}var c;typeof document<"u"&&document.currentScript&&(s=document.currentScript.src),s.indexOf("blob:")!==0?s=s.substr(0,s.lastIndexOf("/")+1):s="",c=function(Wt,or,Br){var y=new XMLHttpRequest;y.open("GET",Wt,!0),y.responseType="arraybuffer",y.onload=function(){if(y.status==200||y.status==0&&y.response){or(y.response);return}var Ei=zt(Wt);if(Ei){or(Ei.buffer);return}Br()},y.onerror=Br,y.send(null)};var d=e.print||console.log.bind(console),p=e.printErr||console.warn.bind(console);for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);t=null,e.arguments&&(n=e.arguments);var b=0,T=function(gt){b=gt},B=function(){return b},z=8;function G(gt,Wt,or,Br){switch(or=or||"i8",or.charAt(or.length-1)==="*"&&(or="i32"),or){case"i1":ve[gt>>0]=Wt;break;case"i8":ve[gt>>0]=Wt;break;case"i16":Xe[gt>>1]=Wt;break;case"i32":tt[gt>>2]=Wt;break;case"i64":$i=[Wt>>>0,(Ir=Wt,+Ds(Ir)>=1?Ir>0?(ea(+ks(Ir/4294967296),4294967295)|0)>>>0:~~+Kn((Ir-+(~~Ir>>>0))/4294967296)>>>0:0)],tt[gt>>2]=$i[0],tt[gt+4>>2]=$i[1];break;case"float":Xt[gt>>2]=Wt;break;case"double":jt[gt>>3]=Wt;break;default:Ta("invalid type for setValue: "+or)}}function Z(gt,Wt,or){switch(Wt=Wt||"i8",Wt.charAt(Wt.length-1)==="*"&&(Wt="i32"),Wt){case"i1":return ve[gt>>0];case"i8":return ve[gt>>0];case"i16":return Xe[gt>>1];case"i32":return tt[gt>>2];case"i64":return tt[gt>>2];case"float":return Xt[gt>>2];case"double":return jt[gt>>3];default:Ta("invalid type for getValue: "+Wt)}return null}var q=!1;function re(gt,Wt){gt||Ta("Assertion failed: "+Wt)}function ee(gt){var Wt=e["_"+gt];return re(Wt,"Cannot call unknown function "+gt+", make sure it is exported"),Wt}function ae(gt,Wt,or,Br,y){var qi={string:function(kn){var vi=0;if(kn!=null&&kn!==0){var Si=(kn.length<<2)+1;vi=AA(Si),te(kn,vi,Si)}return vi},array:function(kn){var vi=AA(kn.length);return ye(kn,vi),vi}};function Ei(kn){return Wt==="string"?Je(kn):Wt==="boolean"?!!kn:kn}var Ee=ee(gt),En=[],Js=0;if(Br)for(var Wn=0;Wn<Br.length;Wn++){var Ui=qi[or[Wn]];Ui?(Js===0&&(Js=jh()),En[Wn]=Ui(Br[Wn])):En[Wn]=Br[Wn]}var dn=Ee.apply(null,En);return dn=Ei(dn),Js!==0&&Vh(Js),dn}function me(gt,Wt,or,Br){or=or||[];var y=or.every(function(Ei){return Ei==="number"}),qi=Wt!=="string";return qi&&y&&!Br?ee(gt):function(){return ae(gt,Wt,or,arguments,Br)}}var Le=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function je(gt,Wt,or){for(var Br=Wt+or,y=Wt;gt[y]&&!(y>=Br);)++y;if(y-Wt>16&&gt.subarray&&Le)return Le.decode(gt.subarray(Wt,y));for(var qi="";Wt<y;){var Ei=gt[Wt++];if(!(Ei&128)){qi+=String.fromCharCode(Ei);continue}var Ee=gt[Wt++]&63;if((Ei&224)==192){qi+=String.fromCharCode((Ei&31)<<6|Ee);continue}var En=gt[Wt++]&63;if((Ei&240)==224?Ei=(Ei&15)<<12|Ee<<6|En:Ei=(Ei&7)<<18|Ee<<12|En<<6|gt[Wt++]&63,Ei<65536)qi+=String.fromCharCode(Ei);else{var Js=Ei-65536;qi+=String.fromCharCode(55296|Js>>10,56320|Js&1023)}}return qi}function Je(gt,Wt){return gt?je(De,gt,Wt):""}function J(gt,Wt,or,Br){if(!(Br>0))return 0;for(var y=or,qi=or+Br-1,Ei=0;Ei<gt.length;++Ei){var Ee=gt.charCodeAt(Ei);if(Ee>=55296&&Ee<=57343){var En=gt.charCodeAt(++Ei);Ee=65536+((Ee&1023)<<10)|En&1023}if(Ee<=127){if(or>=qi)break;Wt[or++]=Ee}else if(Ee<=2047){if(or+1>=qi)break;Wt[or++]=192|Ee>>6,Wt[or++]=128|Ee&63}else if(Ee<=65535){if(or+2>=qi)break;Wt[or++]=224|Ee>>12,Wt[or++]=128|Ee>>6&63,Wt[or++]=128|Ee&63}else{if(or+3>=qi)break;Wt[or++]=240|Ee>>18,Wt[or++]=128|Ee>>12&63,Wt[or++]=128|Ee>>6&63,Wt[or++]=128|Ee&63}}return Wt[or]=0,or-y}function te(gt,Wt,or){return J(gt,De,Wt,or)}var X=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ye(gt,Wt){ve.set(gt,Wt)}function _e(gt,Wt){return gt%Wt>0&&(gt+=Wt-gt%Wt),gt}var Oe,ve,De,Xe,rt,tt,yt,Xt,jt;function fr(gt){Oe=gt,e.HEAP8=ve=new Int8Array(gt),e.HEAP16=Xe=new Int16Array(gt),e.HEAP32=tt=new Int32Array(gt),e.HEAPU8=De=new Uint8Array(gt),e.HEAPU16=rt=new Uint16Array(gt),e.HEAPU32=yt=new Uint32Array(gt),e.HEAPF32=Xt=new Float32Array(gt),e.HEAPF64=jt=new Float64Array(gt)}var qt=5267040,Ot=24128,wr=e.TOTAL_MEMORY||33554432;e.buffer?Oe=e.buffer:Oe=new ArrayBuffer(wr),wr=Oe.byteLength,fr(Oe),tt[Ot>>2]=qt;function Lr(gt){for(;gt.length>0;){var Wt=gt.shift();if(typeof Wt=="function"){Wt();continue}var or=Wt.func;typeof or=="number"?Wt.arg===void 0?e.dynCall_v(or):e.dynCall_vi(or,Wt.arg):or(Wt.arg===void 0?null:Wt.arg)}}var Or=[],Zr=[],Oi=[],Jr=[];function Ri(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)ni(e.preRun.shift());Lr(Or)}function li(){Lr(Zr)}function Qi(){Lr(Oi)}function Di(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)fo(e.postRun.shift());Lr(Jr)}function ni(gt){Or.unshift(gt)}function fo(gt){Jr.unshift(gt)}var Ds=Math.abs,Kn=Math.ceil,ks=Math.floor,ea=Math.min,os=0,Zs=null,as=null;function Vr(gt){os++,e.monitorRunDependencies&&e.monitorRunDependencies(os)}function Jt(gt){if(os--,e.monitorRunDependencies&&e.monitorRunDependencies(os),os==0&&(Zs!==null&&(clearInterval(Zs),Zs=null),as)){var Wt=as;as=null,Wt()}}e.preloadedImages={},e.preloadedAudios={};var Ft=null,Tr="data:application/octet-stream;base64,";function si(gt){return String.prototype.startsWith?gt.startsWith(Tr):gt.indexOf(Tr)===0}var Ir,$i;Ft="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Qn=24144;function Mn(gt){return gt}function ot(gt){var Wt=/\b__Z[\w\d_]+/g;return gt.replace(Wt,function(or){var Br=or;return or===Br?or:Br+" ["+or+"]"})}function de(){var gt=new Error;if(!gt.stack){try{throw new Error(0)}catch(Wt){gt=Wt}if(!gt.stack)return"(no stack trace available)"}return gt.stack.toString()}function ge(){var gt=de();return e.extraStackTrace&&(gt+=`
`+e.extraStackTrace()),ot(gt)}function ce(gt,Wt,or,Br){Ta("Assertion failed: "+Je(gt)+", at: "+[Wt?Je(Wt):"unknown filename",or,Br?Je(Br):"unknown function"])}function ze(){return ve.length}function Ye(gt,Wt,or){De.set(De.subarray(Wt,Wt+or),gt)}function Ke(gt){return e.___errno_location&&(tt[e.___errno_location()>>2]=gt),gt}function dt(gt){Ta("OOM")}function it(gt){try{var Wt=new ArrayBuffer(gt);return Wt.byteLength!=gt?void 0:(new Int8Array(Wt).set(ve),Gn(Wt),fr(Wt),1)}catch{}}function Bt(gt){var Wt=ze(),or=16777216,Br=2147483648-or;if(gt>Br)return!1;for(var y=16777216,qi=Math.max(Wt,y);qi<gt;)qi<=536870912?qi=_e(2*qi,or):qi=Math.min(_e((3*qi+2147483648)/4,or),Br);var Ei=it(qi);return!!Ei}var Pt=typeof atob=="function"?atob:function(gt){var Wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",or="",Br,y,qi,Ei,Ee,En,Js,Wn=0;gt=gt.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ei=Wt.indexOf(gt.charAt(Wn++)),Ee=Wt.indexOf(gt.charAt(Wn++)),En=Wt.indexOf(gt.charAt(Wn++)),Js=Wt.indexOf(gt.charAt(Wn++)),Br=Ei<<2|Ee>>4,y=(Ee&15)<<4|En>>2,qi=(En&3)<<6|Js,or=or+String.fromCharCode(Br),En!==64&&(or=or+String.fromCharCode(y)),Js!==64&&(or=or+String.fromCharCode(qi));while(Wn<gt.length);return or};function ut(gt){try{for(var Wt=Pt(gt),or=new Uint8Array(Wt.length),Br=0;Br<Wt.length;++Br)or[Br]=Wt.charCodeAt(Br);return or}catch{throw new Error("Converting base64 string to bytes failed.")}}function zt(gt){if(si(gt))return ut(gt.slice(Tr.length))}var rr={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},nr={a:Ta,b:T,c:B,d:ce,e:Ke,f:ze,g:Ye,h:Bt,i:dt,j:Mn,k:ot,l:it,m:de,n:ge,o:Qn,p:Ot},We=function(gt,Wt,or){"almost asm";var Br=new gt.Int8Array(or),y=new gt.Int32Array(or),qi=new gt.Uint8Array(or),Ei=new gt.Float32Array(or),Ee=new gt.Float64Array(or),En=Wt.o|0,Js=Wt.p|0,Wn=gt.Math.floor,Ui=gt.Math.abs,dn=gt.Math.sqrt,kn=gt.Math.pow,vi=gt.Math.cos,Si=gt.Math.sin,Ic=gt.Math.tan,mA=gt.Math.acos,Ll=gt.Math.asin,Pc=gt.Math.atan,_o=gt.Math.atan2,sa=gt.Math.ceil,oa=gt.Math.imul,Ol=gt.Math.min,gA=gt.Math.max,Dl=gt.Math.clz32,Yr=Wt.b,Pe=Wt.c,Fr=Wt.d,Hh=Wt.e,_A=Wt.f,Wh=Wt.g,aa=Wt.h,vd=Wt.i,be=24160;function wd(m){return Br=new Int8Array(m),qi=new Uint8Array(m),y=new Int32Array(m),Ei=new Float32Array(m),Ee=new Float64Array(m),or=m,!0}function yA(m){m=m|0;var A=0;return A=be,be=be+m|0,be=be+15&-16,A|0}function Ci(){return be|0}function kl(m){m=m|0,be=m}function Td(m,A){m=m|0,A=A|0,be=m}function jm(m,A){m=m|0,A=A|0;var x=0,E=0,P=0;return(m|0)<0?(A=2,A|0):(m|0)>13780509?(A=Zl(15,A)|0,A|0):(x=((m|0)<0)<<31>>31,P=Tt(m|0,x|0,3,0)|0,E=Pe()|0,x=Ge(m|0,x|0,1,0)|0,x=Tt(P|0,E|0,x|0,Pe()|0)|0,x=Ge(x|0,Pe()|0,1,0)|0,m=Pe()|0,y[A>>2]=x,y[A+4>>2]=m,A=0,A|0)}function xA(m,A,x,E){return m=m|0,A=A|0,x=x|0,E=E|0,bA(m,A,x,E,0)|0}function bA(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0;if(W=be,be=be+16|0,k=W,!(vA(m,A,x,E,P)|0))return E=0,be=W,E|0;do if((x|0)>=0){if((x|0)>13780509){if(R=Zl(15,k)|0,R|0)break;F=k,k=y[F>>2]|0,F=y[F+4>>2]|0}else R=((x|0)<0)<<31>>31,Q=Tt(x|0,R|0,3,0)|0,F=Pe()|0,R=Ge(x|0,R|0,1,0)|0,R=Tt(Q|0,F|0,R|0,Pe()|0)|0,R=Ge(R|0,Pe()|0,1,0)|0,F=Pe()|0,y[k>>2]=R,y[k+4>>2]=F,k=R;if(Fi(E|0,0,k<<3|0)|0,P|0){Fi(P|0,0,k<<2|0)|0,R=la(m,A,x,E,P,k,F,0)|0;break}R=qe(k,4)|0,R?(Q=la(m,A,x,E,R,k,F,0)|0,Be(R),R=Q):R=13}else R=2;while(!1);return Q=R,be=W,Q|0}function vA(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0;if(nt=be,be=be+16|0,Qe=nt,Ue=nt+8|0,$e=Qe,y[$e>>2]=m,y[$e+4>>2]=A,(x|0)<0)return Ue=2,be=nt,Ue|0;if(R=E,y[R>>2]=m,y[R+4>>2]=A,R=(P|0)!=0,R&&(y[P>>2]=0),Vi(m,A)|0)return Ue=9,be=nt,Ue|0;y[Ue>>2]=0;e:do if((x|0)>=1)if(R)for(he=1,Q=0,we=0,$e=1,R=m;;){if(!(Q|we)){if(R=ts(R,A,4,Ue,Qe)|0,R|0)break e;if(A=Qe,R=y[A>>2]|0,A=y[A+4>>2]|0,Vi(R,A)|0){R=9;break e}}if(R=ts(R,A,y[22384+(we<<2)>>2]|0,Ue,Qe)|0,R|0)break e;if(A=Qe,R=y[A>>2]|0,A=y[A+4>>2]|0,m=E+(he<<3)|0,y[m>>2]=R,y[m+4>>2]=A,y[P+(he<<2)>>2]=$e,m=Q+1|0,k=(m|0)==($e|0),F=we+1|0,W=(F|0)==6,Vi(R,A)|0){R=9;break e}if($e=$e+(W&k&1)|0,($e|0)>(x|0)){R=0;break}else he=he+1|0,Q=k?0:m,we=k?W?0:F:we}else for(he=1,Q=0,we=0,$e=1,R=m;;){if(!(Q|we)){if(R=ts(R,A,4,Ue,Qe)|0,R|0)break e;if(A=Qe,R=y[A>>2]|0,A=y[A+4>>2]|0,Vi(R,A)|0){R=9;break e}}if(R=ts(R,A,y[22384+(we<<2)>>2]|0,Ue,Qe)|0,R|0)break e;if(A=Qe,R=y[A>>2]|0,A=y[A+4>>2]|0,m=E+(he<<3)|0,y[m>>2]=R,y[m+4>>2]=A,m=Q+1|0,k=(m|0)==($e|0),F=we+1|0,W=(F|0)==6,Vi(R,A)|0){R=9;break e}if($e=$e+(W&k&1)|0,($e|0)>(x|0)){R=0;break}else he=he+1|0,Q=k?0:m,we=k?W?0:F:we}else R=0;while(!1);return Ue=R,be=nt,Ue|0}function la(m,A,x,E,P,R,k,F){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0,R=R|0,k=k|0,F=F|0;var W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0;if(nt=be,be=be+16|0,Qe=nt+8|0,Ue=nt,W=Kt(m|0,A|0,R|0,k|0)|0,he=Pe()|0,we=E+(W<<3)|0,It=we,wt=y[It>>2]|0,It=y[It+4>>2]|0,Q=(wt|0)==(m|0)&(It|0)==(A|0),!((wt|0)==0&(It|0)==0|Q))do W=Ge(W|0,he|0,1,0)|0,W=er(W|0,Pe()|0,R|0,k|0)|0,he=Pe()|0,we=E+(W<<3)|0,wt=we,It=y[wt>>2]|0,wt=y[wt+4>>2]|0,Q=(It|0)==(m|0)&(wt|0)==(A|0);while(!((It|0)==0&(wt|0)==0|Q));if(W=P+(W<<2)|0,Q&&(y[W>>2]|0)<=(F|0)||(wt=we,y[wt>>2]=m,y[wt+4>>2]=A,y[W>>2]=F,(F|0)>=(x|0)))return wt=0,be=nt,wt|0;switch(Q=F+1|0,y[Qe>>2]=0,W=ts(m,A,2,Qe,Ue)|0,W|0){case 9:{$e=9;break}case 0:{W=Ue,W=la(y[W>>2]|0,y[W+4>>2]|0,x,E,P,R,k,Q)|0,W||($e=9);break}default:}e:do if(($e|0)==9){switch(y[Qe>>2]=0,W=ts(m,A,3,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=la(y[W>>2]|0,y[W+4>>2]|0,x,E,P,R,k,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=ts(m,A,1,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=la(y[W>>2]|0,y[W+4>>2]|0,x,E,P,R,k,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=ts(m,A,5,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=la(y[W>>2]|0,y[W+4>>2]|0,x,E,P,R,k,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=ts(m,A,4,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=la(y[W>>2]|0,y[W+4>>2]|0,x,E,P,R,k,Q)|0,W|0)break e;break}default:break e}switch(y[Qe>>2]=0,W=ts(m,A,6,Qe,Ue)|0,W|0){case 9:break;case 0:{if(W=Ue,W=la(y[W>>2]|0,y[W+4>>2]|0,x,E,P,R,k,Q)|0,W|0)break e;break}default:break e}return wt=0,be=nt,wt|0}while(!1);return wt=W,be=nt,wt|0}function ts(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(x>>>0>6)return P=1,P|0;if(we=(y[E>>2]|0)%6|0,y[E>>2]=we,(we|0)>0){R=0;do x=jl(x)|0,R=R+1|0;while((R|0)<(y[E>>2]|0))}if(we=mt(m|0,A|0,45)|0,Pe()|0,he=we&127,he>>>0>121)return P=5,P|0;W=Es(m,A)|0,R=mt(m|0,A|0,52)|0,Pe()|0,R=R&15;e:do if(!R)Q=8;else{for(;;){if(k=(15-R|0)*3|0,F=mt(m|0,A|0,k|0)|0,Pe()|0,F=F&7,(F|0)==7){A=5;break}if(Ue=(yn(R)|0)==0,R=R+-1|0,$e=Nt(7,0,k|0)|0,A=A&~(Pe()|0),Qe=Nt(y[(Ue?432:16)+(F*28|0)+(x<<2)>>2]|0,0,k|0)|0,k=Pe()|0,x=y[(Ue?640:224)+(F*28|0)+(x<<2)>>2]|0,m=Qe|m&~$e,A=k|A,!x){x=0;break e}if(!R){Q=8;break e}}return A|0}while(!1);(Q|0)==8&&(Ue=y[848+(he*28|0)+(x<<2)>>2]|0,Qe=Nt(Ue|0,0,45)|0,m=Qe|m,A=Pe()|0|A&-1040385,x=y[4272+(he*28|0)+(x<<2)>>2]|0,(Ue&127|0)==127&&(Ue=Nt(y[848+(he*28|0)+20>>2]|0,0,45)|0,A=Pe()|0|A&-1040385,x=y[4272+(he*28|0)+20>>2]|0,m=Ia(Ue|m,A)|0,A=Pe()|0,y[E>>2]=(y[E>>2]|0)+1)),F=mt(m|0,A|0,45)|0,Pe()|0,F=F&127;e:do if(Ai(F)|0){t:do if((Es(m,A)|0)==1){if((he|0)!=(F|0))if(ju(F,y[7696+(he*28|0)>>2]|0)|0){m=el(m,A)|0,k=1,A=Pe()|0;break}else Fr(23313,22416,436,22424);switch(W|0){case 3:{m=Ia(m,A)|0,A=Pe()|0,y[E>>2]=(y[E>>2]|0)+1,k=0;break t}case 5:{m=el(m,A)|0,A=Pe()|0,y[E>>2]=(y[E>>2]|0)+5,k=0;break t}case 0:return Ue=9,Ue|0;default:return Ue=1,Ue|0}}else k=0;while(!1);if((x|0)>0){R=0;do m=Fd(m,A)|0,A=Pe()|0,R=R+1|0;while((R|0)!=(x|0))}if((he|0)!=(F|0)){if(!(Xh(F)|0)){if((k|0)!=0|(Es(m,A)|0)!=5)break;y[E>>2]=(y[E>>2]|0)+1;break}switch(we&127){case 8:case 118:break e;default:}(Es(m,A)|0)!=3&&(y[E>>2]=(y[E>>2]|0)+1)}}else if((x|0)>0){R=0;do m=Ia(m,A)|0,A=Pe()|0,R=R+1|0;while((R|0)!=(x|0))}while(!1);return y[E>>2]=((y[E>>2]|0)+x|0)%6|0,Ue=P,y[Ue>>2]=m,y[Ue+4>>2]=A,Ue=0,Ue|0}function $h(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0;for(F=be,be=be+16|0,R=F,k=F+8|0,P=(Vi(m,A)|0)==0,P=P?1:2;;){if(y[k>>2]=0,Q=(ts(m,A,P,k,R)|0)==0,W=R,Q&((y[W>>2]|0)==(x|0)?(y[W+4>>2]|0)==(E|0):0)){m=4;break}if(P=P+1|0,P>>>0>=7){P=7,m=4;break}}return(m|0)==4?(be=F,P|0):0}function qh(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(Ue=be,be=be+16|0,$e=Ue,Qe=Ue+8|0,we=$e,y[we>>2]=m,y[we+4>>2]=A,!x)return Qe=E,y[Qe>>2]=m,y[Qe+4>>2]=A,Qe=0,be=Ue,Qe|0;y[Qe>>2]=0;e:do if(Vi(m,A)|0)m=9;else{if(R=(x|0)>0,R){P=0,we=m;do{if(m=ts(we,A,4,Qe,$e)|0,m|0)break e;if(A=$e,we=y[A>>2]|0,A=y[A+4>>2]|0,P=P+1|0,Vi(we,A)|0){m=9;break e}}while((P|0)<(x|0));if(he=E,y[he>>2]=we,y[he+4>>2]=A,he=x+-1|0,R){Q=0,m=1;do{if(P=22384+(Q<<2)|0,(Q|0)==5)for(k=y[P>>2]|0,R=0,P=m;;){if(m=$e,m=ts(y[m>>2]|0,y[m+4>>2]|0,k,Qe,$e)|0,m|0)break e;if((R|0)!=(he|0))if(W=$e,F=y[W>>2]|0,W=y[W+4>>2]|0,m=E+(P<<3)|0,y[m>>2]=F,y[m+4>>2]=W,!(Vi(F,W)|0))m=P+1|0;else{m=9;break e}else m=P;if(R=R+1|0,(R|0)>=(x|0))break;P=m}else for(k=$e,W=y[P>>2]|0,F=0,P=m,R=y[k>>2]|0,k=y[k+4>>2]|0;;){if(m=ts(R,k,W,Qe,$e)|0,m|0)break e;if(k=$e,R=y[k>>2]|0,k=y[k+4>>2]|0,m=E+(P<<3)|0,y[m>>2]=R,y[m+4>>2]=k,m=P+1|0,Vi(R,k)|0){m=9;break e}if(F=F+1|0,(F|0)>=(x|0))break;P=m}Q=Q+1|0}while(Q>>>0<6);m=$e,k=we,P=y[m>>2]|0,R=A,m=y[m+4>>2]|0}else k=we,P=we,R=A,m=A}else k=E,y[k>>2]=m,y[k+4>>2]=A,k=m,P=m,R=A,m=A;m=(k|0)==(P|0)&(R|0)==(m|0)?0:9}while(!1);return Qe=m,be=Ue,Qe|0}function Zh(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0;if(F=be,be=be+48|0,P=F+16|0,R=F+8|0,k=F,x|0)return k=15,be=F,k|0;if(Q=m,W=y[Q+4>>2]|0,x=R,y[x>>2]=y[Q>>2],y[x+4>>2]=W,Hc(R,P),A=Kh(P,A,k)|0,!A){if(x=y[R>>2]|0,R=y[m+8>>2]|0,(R|0)>0){P=y[m+12>>2]|0,A=0;do x=(y[P+(A<<3)>>2]|0)+x|0,A=A+1|0;while((A|0)<(R|0))}A=k,P=y[A>>2]|0,A=y[A+4>>2]|0,R=((x|0)<0)<<31>>31,(A|0)<(R|0)|(A|0)==(R|0)&P>>>0<x>>>0?(A=k,y[A>>2]=x,y[A+4>>2]=R,A=R):x=P,W=Ge(x|0,A|0,12,0)|0,Q=Pe()|0,A=k,y[A>>2]=W,y[A+4>>2]=Q,A=E,y[A>>2]=W,y[A+4>>2]=Q,A=0}return Q=A,be=F,Q|0}function Vu(m,A,x,E,P,R,k){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0,R=R|0,k=k|0;var F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0,lr=0,di=0,ti=0,ii=0,Hr=0,Ur=0,jr=0,Ni=0,Wr=0,ln=0,yo=0,RA=0;if(Ni=be,be=be+64|0,ii=Ni+48|0,Hr=Ni+32|0,Ur=Ni+24|0,ar=Ni+8|0,mr=Ni,W=y[m>>2]|0,(W|0)<=0)return jr=0,be=Ni,jr|0;for(sr=m+4|0,lr=ii+8|0,di=Hr+8|0,ti=ar+8|0,F=0,bt=0;;){Q=y[sr>>2]|0,at=Q+(bt<<4)|0,y[ii>>2]=y[at>>2],y[ii+4>>2]=y[at+4>>2],y[ii+8>>2]=y[at+8>>2],y[ii+12>>2]=y[at+12>>2],(bt|0)==(W+-1|0)?(y[Hr>>2]=y[Q>>2],y[Hr+4>>2]=y[Q+4>>2],y[Hr+8>>2]=y[Q+8>>2],y[Hr+12>>2]=y[Q+12>>2]):(at=Q+(bt+1<<4)|0,y[Hr>>2]=y[at>>2],y[Hr+4>>2]=y[at+4>>2],y[Hr+8>>2]=y[at+8>>2],y[Hr+12>>2]=y[at+12>>2]),W=wi(ii,Hr,E,Ur)|0;e:do if(W)Q=0,F=W;else if(Q=Ur,W=y[Q>>2]|0,Q=y[Q+4>>2]|0,(Q|0)>0|(Q|0)==0&W>>>0>0){wt=0,at=0;t:for(;;){if(RA=+Ee[ii>>3],It=Ze(W|0,Q|0,wt|0,at|0)|0,yo=+(It>>>0)+4294967296*+(Pe()|0),Wr=+(W>>>0)+4294967296*+(Q|0),ln=+(wt>>>0)+4294967296*+(at|0),Ee[ar>>3]=RA*yo/Wr+ +Ee[Hr>>3]*ln/Wr,Ee[ti>>3]=+Ee[lr>>3]*yo/Wr+ +Ee[di>>3]*ln/Wr,W=ur(ar,E,mr)|0,W|0){F=W;break}It=mr,nt=y[It>>2]|0,It=y[It+4>>2]|0,$e=Kt(nt|0,It|0,A|0,x|0)|0,he=Pe()|0,W=k+($e<<3)|0,we=W,Q=y[we>>2]|0,we=y[we+4>>2]|0;r:do if((Q|0)==0&(we|0)==0)ft=W,jr=16;else for(Qe=0,Ue=0;;){if((Qe|0)>(x|0)|(Qe|0)==(x|0)&Ue>>>0>A>>>0){F=1;break t}if((Q|0)==(nt|0)&(we|0)==(It|0))break r;if(W=Ge($e|0,he|0,1,0)|0,$e=er(W|0,Pe()|0,A|0,x|0)|0,he=Pe()|0,Ue=Ge(Ue|0,Qe|0,1,0)|0,Qe=Pe()|0,W=k+($e<<3)|0,we=W,Q=y[we>>2]|0,we=y[we+4>>2]|0,(Q|0)==0&(we|0)==0){ft=W,jr=16;break}}while(!1);if((jr|0)==16&&(jr=0,!((nt|0)==0&(It|0)==0))&&(Ue=ft,y[Ue>>2]=nt,y[Ue+4>>2]=It,Ue=R+(y[P>>2]<<3)|0,y[Ue>>2]=nt,y[Ue+4>>2]=It,Ue=P,Ue=Ge(y[Ue>>2]|0,y[Ue+4>>2]|0,1,0)|0,nt=Pe()|0,It=P,y[It>>2]=Ue,y[It+4>>2]=nt),wt=Ge(wt|0,at|0,1,0)|0,at=Pe()|0,Q=Ur,W=y[Q>>2]|0,Q=y[Q+4>>2]|0,!((Q|0)>(at|0)|(Q|0)==(at|0)&W>>>0>wt>>>0)){Q=1;break e}}Q=0}else Q=1;while(!1);if(bt=bt+1|0,!Q){jr=21;break}if(W=y[m>>2]|0,(bt|0)>=(W|0)){F=0,jr=21;break}}return(jr|0)==21?(be=Ni,F|0):0}function Ed(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0,lr=0,di=0,ti=0,ii=0,Hr=0,Ur=0,jr=0,Ni=0,Wr=0,ln=0,yo=0;if(yo=be,be=be+112|0,jr=yo+80|0,W=yo+72|0,Ni=yo,Wr=yo+56|0,x|0)return ln=15,be=yo,ln|0;if(Q=m+8|0,ln=Ve((y[Q>>2]<<5)+32|0)|0,!ln)return ln=13,be=yo,ln|0;if(mf(m,ln),Hr=m,Ur=y[Hr+4>>2]|0,x=W,y[x>>2]=y[Hr>>2],y[x+4>>2]=Ur,Hc(W,jr),x=Kh(jr,A,Ni)|0,x)Hr=0,Ur=0;else{if(x=y[W>>2]|0,R=y[Q>>2]|0,(R|0)>0){k=y[m+12>>2]|0,P=0;do x=(y[k+(P<<3)>>2]|0)+x|0,P=P+1|0;while((P|0)!=(R|0));P=x}else P=x;x=Ni,R=y[x>>2]|0,x=y[x+4>>2]|0,k=((P|0)<0)<<31>>31,(x|0)<(k|0)|(x|0)==(k|0)&R>>>0<P>>>0?(x=Ni,y[x>>2]=P,y[x+4>>2]=k,x=k):P=R,Hr=Ge(P|0,x|0,12,0)|0,Ur=Pe()|0,x=Ni,y[x>>2]=Hr,y[x+4>>2]=Ur,x=0}if(x|0)return Be(ln),ln=x,be=yo,ln|0;if(P=qe(Hr,8)|0,!P)return Be(ln),ln=13,be=yo,ln|0;if(F=qe(Hr,8)|0,!F)return Be(ln),Be(P),ln=13,be=yo,ln|0;ti=jr,y[ti>>2]=0,y[ti+4>>2]=0,ti=m,ii=y[ti+4>>2]|0,x=W,y[x>>2]=y[ti>>2],y[x+4>>2]=ii,x=Vu(W,Hr,Ur,A,jr,P,F)|0;e:do if(x)Be(P),Be(F),Be(ln);else{t:do if((y[Q>>2]|0)>0){for(k=m+12|0,R=0;x=Vu((y[k>>2]|0)+(R<<3)|0,Hr,Ur,A,jr,P,F)|0,R=R+1|0,!(x|0);)if((R|0)>=(y[Q>>2]|0))break t;Be(P),Be(F),Be(ln);break e}while(!1);(Ur|0)>0|(Ur|0)==0&Hr>>>0>0&&Fi(F|0,0,Hr<<3|0)|0,ii=jr,ti=y[ii+4>>2]|0;t:do if((ti|0)>0|(ti|0)==0&(y[ii>>2]|0)>>>0>0){sr=P,lr=F,di=P,ti=F,ii=P,x=P,ft=P,ar=F,mr=F,P=F;r:for(;;){for(It=0,wt=0,at=0,bt=0,R=0,k=0;;){F=Ni,W=F+56|0;do y[F>>2]=0,F=F+4|0;while((F|0)<(W|0));if(A=sr+(It<<3)|0,Q=y[A>>2]|0,A=y[A+4>>2]|0,vA(Q,A,1,Ni,0)|0){F=Ni,W=F+56|0;do y[F>>2]=0,F=F+4|0;while((F|0)<(W|0));F=qe(7,4)|0,F|0&&(la(Q,A,1,Ni,F,7,0,0)|0,Be(F))}for(nt=0;;){Ue=Ni+(nt<<3)|0,Qe=y[Ue>>2]|0,Ue=y[Ue+4>>2]|0;i:do if((Qe|0)==0&(Ue|0)==0)F=R,W=k;else{if(he=Kt(Qe|0,Ue|0,Hr|0,Ur|0)|0,Q=Pe()|0,F=E+(he<<3)|0,A=F,W=y[A>>2]|0,A=y[A+4>>2]|0,!((W|0)==0&(A|0)==0)){we=0,$e=0;do{if((we|0)>(Ur|0)|(we|0)==(Ur|0)&$e>>>0>Hr>>>0)break r;if((W|0)==(Qe|0)&(A|0)==(Ue|0)){F=R,W=k;break i}F=Ge(he|0,Q|0,1,0)|0,he=er(F|0,Pe()|0,Hr|0,Ur|0)|0,Q=Pe()|0,$e=Ge($e|0,we|0,1,0)|0,we=Pe()|0,F=E+(he<<3)|0,A=F,W=y[A>>2]|0,A=y[A+4>>2]|0}while(!((W|0)==0&(A|0)==0))}(Qe|0)==0&(Ue|0)==0?(F=R,W=k):(Uc(Qe,Ue,Wr)|0,Xl(m,ln,Wr)|0&&($e=Ge(R|0,k|0,1,0)|0,k=Pe()|0,we=F,y[we>>2]=Qe,y[we+4>>2]=Ue,R=lr+(R<<3)|0,y[R>>2]=Qe,y[R+4>>2]=Ue,R=$e),F=R,W=k)}while(!1);if(nt=nt+1|0,nt>>>0>=7)break;R=F,k=W}if(It=Ge(It|0,wt|0,1,0)|0,wt=Pe()|0,at=Ge(at|0,bt|0,1,0)|0,bt=Pe()|0,k=jr,R=y[k>>2]|0,k=y[k+4>>2]|0,(bt|0)<(k|0)|(bt|0)==(k|0)&at>>>0<R>>>0)R=F,k=W;else break}if((k|0)>0|(k|0)==0&R>>>0>0){R=0,k=0;do bt=sr+(R<<3)|0,y[bt>>2]=0,y[bt+4>>2]=0,R=Ge(R|0,k|0,1,0)|0,k=Pe()|0,bt=jr,at=y[bt+4>>2]|0;while((k|0)<(at|0)|((k|0)==(at|0)?R>>>0<(y[bt>>2]|0)>>>0:0))}if(bt=jr,y[bt>>2]=F,y[bt+4>>2]=W,(W|0)>0|(W|0)==0&F>>>0>0)nt=P,It=mr,wt=ii,at=ar,bt=lr,P=ft,mr=x,ar=di,ft=nt,x=It,ii=ti,ti=wt,di=at,lr=sr,sr=bt;else break t}Be(di),Be(ti),Be(ln),x=1;break e}else x=F;while(!1);Be(ln),Be(P),Be(x),x=0}while(!1);return ln=x,be=yo,ln|0}function Fl(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0;if(he=be,be=be+176|0,W=he,(A|0)<1)return H(x,0,0),Q=0,be=he,Q|0;for(F=m,F=mt(y[F>>2]|0,y[F+4>>2]|0,52)|0,Pe()|0,H(x,(A|0)>6?A:6,F&15),F=0;E=m+(F<<3)|0,E=jo(y[E>>2]|0,y[E+4>>2]|0,W)|0,!(E|0);){if(E=y[W>>2]|0,(E|0)>0){k=0;do R=W+8+(k<<4)|0,k=k+1|0,E=W+8+(((k|0)%(E|0)|0)<<4)|0,P=Ae(x,E,R)|0,P?ie(x,P)|0:fe(x,R,E)|0,E=y[W>>2]|0;while((k|0)<(E|0))}if(F=F+1|0,(F|0)>=(A|0)){E=0,Q=13;break}}return(Q|0)==13?(be=he,E|0):(K(x),Q=E,be=he,Q|0)}function Mc(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0;if(R=be,be=be+32|0,E=R,P=R+16|0,m=Fl(m,A,P)|0,m|0)return x=m,be=R,x|0;if(y[x>>2]=0,y[x+4>>2]=0,y[x+8>>2]=0,m=ne(P)|0,m|0)do{A=pf(x)|0;do jd(A,m)|0,k=m+16|0,y[E>>2]=y[k>>2],y[E+4>>2]=y[k+4>>2],y[E+8>>2]=y[k+8>>2],y[E+12>>2]=y[k+12>>2],ie(P,m)|0,m=Ie(P,E)|0;while(m|0);m=ne(P)|0}while(m|0);return K(P),m=to(x)|0,m?(Af(x),k=m,be=R,k|0):(k=0,be=R,k|0)}function Ai(m){return m=m|0,m>>>0>121?(m=0,m|0):(m=y[7696+(m*28|0)+16>>2]|0,m|0)}function Xh(m){return m=m|0,(m|0)==4|(m|0)==117|0}function Sd(m){return m=m|0,y[11120+((y[m>>2]|0)*216|0)+((y[m+4>>2]|0)*72|0)+((y[m+8>>2]|0)*24|0)+(y[m+12>>2]<<3)>>2]|0}function Cd(m){return m=m|0,y[11120+((y[m>>2]|0)*216|0)+((y[m+4>>2]|0)*72|0)+((y[m+8>>2]|0)*24|0)+(y[m+12>>2]<<3)+4>>2]|0}function Nl(m,A){m=m|0,A=A|0,m=7696+(m*28|0)|0,y[A>>2]=y[m>>2],y[A+4>>2]=y[m+4>>2],y[A+8>>2]=y[m+8>>2],y[A+12>>2]=y[m+12>>2]}function Yh(m,A){m=m|0,A=A|0;var x=0,E=0;if(A>>>0>20)return A=-1,A|0;do if((y[11120+(A*216|0)>>2]|0)!=(m|0))if((y[11120+(A*216|0)+8>>2]|0)!=(m|0))if((y[11120+(A*216|0)+16>>2]|0)!=(m|0))if((y[11120+(A*216|0)+24>>2]|0)!=(m|0))if((y[11120+(A*216|0)+32>>2]|0)!=(m|0))if((y[11120+(A*216|0)+40>>2]|0)!=(m|0))if((y[11120+(A*216|0)+48>>2]|0)!=(m|0))if((y[11120+(A*216|0)+56>>2]|0)!=(m|0))if((y[11120+(A*216|0)+64>>2]|0)!=(m|0))if((y[11120+(A*216|0)+72>>2]|0)!=(m|0))if((y[11120+(A*216|0)+80>>2]|0)!=(m|0))if((y[11120+(A*216|0)+88>>2]|0)!=(m|0))if((y[11120+(A*216|0)+96>>2]|0)!=(m|0))if((y[11120+(A*216|0)+104>>2]|0)!=(m|0))if((y[11120+(A*216|0)+112>>2]|0)!=(m|0))if((y[11120+(A*216|0)+120>>2]|0)!=(m|0))if((y[11120+(A*216|0)+128>>2]|0)!=(m|0))if((y[11120+(A*216|0)+136>>2]|0)==(m|0))m=2,x=1,E=2;else{if((y[11120+(A*216|0)+144>>2]|0)==(m|0)){m=0,x=2,E=0;break}if((y[11120+(A*216|0)+152>>2]|0)==(m|0)){m=0,x=2,E=1;break}if((y[11120+(A*216|0)+160>>2]|0)==(m|0)){m=0,x=2,E=2;break}if((y[11120+(A*216|0)+168>>2]|0)==(m|0)){m=1,x=2,E=0;break}if((y[11120+(A*216|0)+176>>2]|0)==(m|0)){m=1,x=2,E=1;break}if((y[11120+(A*216|0)+184>>2]|0)==(m|0)){m=1,x=2,E=2;break}if((y[11120+(A*216|0)+192>>2]|0)==(m|0)){m=2,x=2,E=0;break}if((y[11120+(A*216|0)+200>>2]|0)==(m|0)){m=2,x=2,E=1;break}if((y[11120+(A*216|0)+208>>2]|0)==(m|0)){m=2,x=2,E=2;break}else m=-1;return m|0}else m=2,x=1,E=1;else m=2,x=1,E=0;else m=1,x=1,E=2;else m=1,x=1,E=1;else m=1,x=1,E=0;else m=0,x=1,E=2;else m=0,x=1,E=1;else m=0,x=1,E=0;else m=2,x=0,E=2;else m=2,x=0,E=1;else m=2,x=0,E=0;else m=1,x=0,E=2;else m=1,x=0,E=1;else m=1,x=0,E=0;else m=0,x=0,E=2;else m=0,x=0,E=1;else m=0,x=0,E=0;while(!1);return A=y[11120+(A*216|0)+(x*72|0)+(m*24|0)+(E<<3)+4>>2]|0,A|0}function ju(m,A){return m=m|0,A=A|0,(y[7696+(m*28|0)+20>>2]|0)==(A|0)?(A=1,A|0):(A=(y[7696+(m*28|0)+24>>2]|0)==(A|0),A|0)}function zl(m,A){return m=m|0,A=A|0,y[848+(m*28|0)+(A<<2)>>2]|0}function Rc(m,A){return m=m|0,A=A|0,(y[848+(m*28|0)>>2]|0)==(A|0)?(A=0,A|0):(y[848+(m*28|0)+4>>2]|0)==(A|0)?(A=1,A|0):(y[848+(m*28|0)+8>>2]|0)==(A|0)?(A=2,A|0):(y[848+(m*28|0)+12>>2]|0)==(A|0)?(A=3,A|0):(y[848+(m*28|0)+16>>2]|0)==(A|0)?(A=4,A|0):(y[848+(m*28|0)+20>>2]|0)==(A|0)?(A=5,A|0):((y[848+(m*28|0)+24>>2]|0)==(A|0)?6:7)|0}function wA(){return 122}function Bc(m){m=m|0;var A=0,x=0,E=0;A=0;do Nt(A|0,0,45)|0,E=Pe()|0|134225919,x=m+(A<<3)|0,y[x>>2]=-1,y[x+4>>2]=E,A=A+1|0;while((A|0)!=122);return 0}function Ul(m){return m=m|0,+Ee[m+16>>3]<+Ee[m+24>>3]|0}function Id(m,A){m=m|0,A=A|0;var x=0,E=0,P=0;return x=+Ee[A>>3],!(x>=+Ee[m+8>>3])||!(x<=+Ee[m>>3])?(A=0,A|0):(E=+Ee[m+16>>3],x=+Ee[m+24>>3],P=+Ee[A+8>>3],A=P>=x,m=P<=E&1,E<x?A&&(m=1):A||(m=0),A=(m|0)!=0,A|0)}function Kh(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0;Ue=be,be=be+288|0,he=Ue+264|0,we=Ue+96|0,Q=Ue,F=Q,W=F+96|0;do y[F>>2]=0,F=F+4|0;while((F|0)<(W|0));return A=Vc(A,Q)|0,A|0?(Qe=A,be=Ue,Qe|0):(W=Q,Q=y[W>>2]|0,W=y[W+4>>2]|0,Uc(Q,W,he)|0,jo(Q,W,we)|0,k=+jc(he,we+8|0),Ee[he>>3]=+Ee[m>>3],W=he+8|0,Ee[W>>3]=+Ee[m+16>>3],Ee[we>>3]=+Ee[m+8>>3],Q=we+8|0,Ee[Q>>3]=+Ee[m+24>>3],P=+jc(he,we),It=+Ee[W>>3]-+Ee[Q>>3],R=+Ui(+It),nt=+Ee[he>>3]-+Ee[we>>3],E=+Ui(+nt),!(It==0|nt==0)&&(It=+Ii(+R,+E),It=+sa(+(P*P/+Gr(+(It/+Gr(+R,+E)),3)/(k*(k*2.59807621135)*.8))),Ee[En>>3]=It,$e=~~It>>>0,Qe=+Ui(It)>=1?It>0?~~+Ol(+Wn(It/4294967296),4294967295)>>>0:~~+sa((It-+(~~It>>>0))/4294967296)>>>0:0,(y[En+4>>2]&2146435072|0)!=2146435072)?(we=($e|0)==0&(Qe|0)==0,A=x,y[A>>2]=we?1:$e,y[A+4>>2]=we?0:Qe,A=0):A=1,Qe=A,be=Ue,Qe|0)}function wi(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0;Q=be,be=be+288|0,k=Q+264|0,F=Q+96|0,W=Q,P=W,R=P+96|0;do y[P>>2]=0,P=P+4|0;while((P|0)<(R|0));return x=Vc(x,W)|0,x|0?(E=x,be=Q,E|0):(x=W,P=y[x>>2]|0,x=y[x+4>>2]|0,Uc(P,x,k)|0,jo(P,x,F)|0,he=+jc(k,F+8|0),he=+sa(+(+jc(m,A)/(he*2))),Ee[En>>3]=he,x=~~he>>>0,P=+Ui(he)>=1?he>0?~~+Ol(+Wn(he/4294967296),4294967295)>>>0:~~+sa((he-+(~~he>>>0))/4294967296)>>>0:0,(y[En+4>>2]&2146435072|0)==2146435072?(E=1,be=Q,E|0):(W=(x|0)==0&(P|0)==0,y[E>>2]=W?1:x,y[E+4>>2]=W?0:P,E=0,be=Q,E|0))}function Qh(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0,y[m>>2]=A,y[m+4>>2]=x,y[m+8>>2]=E}function Pd(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0;we=A+8|0,y[we>>2]=0,W=+Ee[m>>3],k=+Ui(+W),Q=+Ee[m+8>>3],F=+Ui(+Q)/.8660254037844386,k=k+F*.5,x=~~k,m=~~F,k=k-+(x|0),F=F-+(m|0);do if(k<.5)if(k<.3333333333333333)if(y[A>>2]=x,F<(k+1)*.5){y[A+4>>2]=m;break}else{m=m+1|0,y[A+4>>2]=m;break}else if($e=1-k,m=(!(F<$e)&1)+m|0,y[A+4>>2]=m,$e<=F&F<k*2){x=x+1|0,y[A>>2]=x;break}else{y[A>>2]=x;break}else{if(!(k<.6666666666666666))if(x=x+1|0,y[A>>2]=x,F<k*.5){y[A+4>>2]=m;break}else{m=m+1|0,y[A+4>>2]=m;break}if(F<1-k){if(y[A+4>>2]=m,k*2+-1<F){y[A>>2]=x;break}}else m=m+1|0,y[A+4>>2]=m;x=x+1|0,y[A>>2]=x}while(!1);do if(W<0)if(m&1){he=(m+1|0)/2|0,he=Ze(x|0,((x|0)<0)<<31>>31|0,he|0,((he|0)<0)<<31>>31|0)|0,x=~~(+(x|0)-((+(he>>>0)+4294967296*+(Pe()|0))*2+1)),y[A>>2]=x;break}else{he=(m|0)/2|0,he=Ze(x|0,((x|0)<0)<<31>>31|0,he|0,((he|0)<0)<<31>>31|0)|0,x=~~(+(x|0)-(+(he>>>0)+4294967296*+(Pe()|0))*2),y[A>>2]=x;break}while(!1);he=A+4|0,Q<0&&(x=x-((m<<1|1|0)/2|0)|0,y[A>>2]=x,m=0-m|0,y[he>>2]=m),E=m-x|0,(x|0)<0?(P=0-x|0,y[he>>2]=E,y[we>>2]=P,y[A>>2]=0,m=E,x=0):P=0,(m|0)<0&&(x=x-m|0,y[A>>2]=x,P=P-m|0,y[we>>2]=P,y[he>>2]=0,m=0),R=x-P|0,E=m-P|0,(P|0)<0&&(y[A>>2]=R,y[he>>2]=E,y[we>>2]=0,m=E,x=R,P=0),E=(m|0)<(x|0)?m:x,E=(P|0)<(E|0)?P:E,!((E|0)<=0)&&(y[A>>2]=x-E,y[he>>2]=m-E,y[we>>2]=P-E)}function ls(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0;A=y[m>>2]|0,k=m+4|0,x=y[k>>2]|0,(A|0)<0&&(x=x-A|0,y[k>>2]=x,R=m+8|0,y[R>>2]=(y[R>>2]|0)-A,y[m>>2]=0,A=0),(x|0)<0?(A=A-x|0,y[m>>2]=A,R=m+8|0,P=(y[R>>2]|0)-x|0,y[R>>2]=P,y[k>>2]=0,x=0):(P=m+8|0,R=P,P=y[P>>2]|0),(P|0)<0&&(A=A-P|0,y[m>>2]=A,x=x-P|0,y[k>>2]=x,y[R>>2]=0,P=0),E=(x|0)<(A|0)?x:A,E=(P|0)<(E|0)?P:E,!((E|0)<=0)&&(y[m>>2]=A-E,y[k>>2]=x-E,y[R>>2]=P-E)}function Uo(m,A){m=m|0,A=A|0;var x=0,E=0;E=y[m+8>>2]|0,x=+((y[m+4>>2]|0)-E|0),Ee[A>>3]=+((y[m>>2]|0)-E|0)-x*.5,Ee[A+8>>3]=x*.8660254037844386}function zs(m,A,x){m=m|0,A=A|0,x=x|0,y[x>>2]=(y[A>>2]|0)+(y[m>>2]|0),y[x+4>>2]=(y[A+4>>2]|0)+(y[m+4>>2]|0),y[x+8>>2]=(y[A+8>>2]|0)+(y[m+8>>2]|0)}function Jh(m,A,x){m=m|0,A=A|0,x=x|0,y[x>>2]=(y[m>>2]|0)-(y[A>>2]|0),y[x+4>>2]=(y[m+4>>2]|0)-(y[A+4>>2]|0),y[x+8>>2]=(y[m+8>>2]|0)-(y[A+8>>2]|0)}function Md(m,A){m=m|0,A=A|0;var x=0,E=0;x=oa(y[m>>2]|0,A)|0,y[m>>2]=x,x=m+4|0,E=oa(y[x>>2]|0,A)|0,y[x>>2]=E,m=m+8|0,A=oa(y[m>>2]|0,A)|0,y[m>>2]=A}function ef(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;k=y[m>>2]|0,F=(k|0)<0,E=(y[m+4>>2]|0)-(F?k:0)|0,R=(E|0)<0,P=(R?0-E|0:0)+((y[m+8>>2]|0)-(F?k:0))|0,x=(P|0)<0,m=x?0:P,A=(R?0:E)-(x?P:0)|0,P=(F?0:k)-(R?E:0)-(x?P:0)|0,x=(A|0)<(P|0)?A:P,x=(m|0)<(x|0)?m:x,E=(x|0)>0,m=m-(E?x:0)|0,A=A-(E?x:0)|0;e:do switch(P-(E?x:0)|0){case 0:switch(A|0){case 0:return F=m|0?(m|0)==1?1:7:0,F|0;case 1:return F=m|0?(m|0)==1?3:7:2,F|0;default:break e}case 1:switch(A|0){case 0:return F=m|0?(m|0)==1?5:7:4,F|0;case 1:{if(!m)m=6;else break e;return m|0}default:break e}default:}while(!1);return F=7,F|0}function Lc(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;k=m+8|0,P=y[k>>2]|0,R=(y[m>>2]|0)-P|0,F=m+4|0,P=(y[F>>2]|0)-P|0;do if(R>>>0>715827881|P>>>0>715827881){if(x=(R|0)>0,x){if((2147483647-R|0)<(R|0)||(2147483647-(R<<1)|0)<(R|0))return F=1,F|0}else if((-2147483648-R|0)>(R|0)||(-2147483648-(R<<1)|0)>(R|0))return F=1,F|0;if(A=R*3|0,(P|0)>0){if((2147483647-P|0)<(P|0))return F=1,F|0}else if((-2147483648-P|0)>(P|0))return F=1,F|0;if(E=P<<1,(R|0)>-1){if((A|-2147483648|0)>=(P|0))return F=1,F|0}else if((A^-2147483648|0)<(P|0))return F=1,F|0;if(x){if((2147483647-R|0)<(E|0))A=1;else{x=E;break}return A|0}else{if((-2147483648-R|0)>(E|0))A=1;else{x=E;break}return A|0}}else x=P<<1,A=R*3|0;while(!1);E=ke(+(A-P|0)/7)|0,y[m>>2]=E,P=ke(+(x+R|0)/7)|0,y[F>>2]=P,y[k>>2]=0,x=(P|0)<(E|0),A=x?E:P,x=x?P:E;do if((x|0)<0){if((A|0)>0){if((A|-2147483648|0)<(x|0)&((x|0)!=-2147483648&(2147483647-A|0)>=(x|0)))break;Fr(23313,22444,355,22455)}if((x|0)==-2147483648|(-2147483648-A|0)>(x|0)&&Fr(23313,22444,355,22455),(A|0)>-1){if((A|-2147483648|0)<(x|0))break;Fr(23313,22444,355,22455)}else{if((A^-2147483648|0)>=(x|0))break;Fr(23313,22444,355,22455)}}while(!1);return A=P-E|0,(E|0)<0?(x=0-E|0,y[F>>2]=A,y[k>>2]=x,y[m>>2]=0,E=0):(A=P,x=0),(A|0)<0&&(E=E-A|0,y[m>>2]=E,x=x-A|0,y[k>>2]=x,y[F>>2]=0,A=0),R=E-x|0,P=A-x|0,(x|0)<0?(y[m>>2]=R,y[F>>2]=P,y[k>>2]=0,A=P,P=R,x=0):P=E,E=(A|0)<(P|0)?A:P,E=(x|0)<(E|0)?x:E,(E|0)<=0?(F=0,F|0):(y[m>>2]=P-E,y[F>>2]=A-E,y[k>>2]=x-E,F=0,F|0)}function Gu(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;k=m+8|0,P=y[k>>2]|0,R=(y[m>>2]|0)-P|0,F=m+4|0,P=(y[F>>2]|0)-P|0;do if(R>>>0>715827881|P>>>0>715827881){if(x=(R|0)>0,x){if((2147483647-R|0)<(R|0))return F=1,F|0}else if((-2147483648-R|0)>(R|0))return F=1,F|0;if(A=R<<1,(P|0)>0){if((2147483647-P|0)<(P|0)||(2147483647-(P<<1)|0)<(P|0))return F=1,F|0}else if((-2147483648-P|0)>(P|0)||(-2147483648-(P<<1)|0)>(P|0))return F=1,F|0;if(E=P*3|0,x){if((2147483647-A|0)<(P|0))return F=1,F|0}else if((-2147483648-A|0)>(P|0))return F=1,F|0;if((P|0)>-1){if((E|-2147483648|0)<(R|0)){x=E;break}else A=1;return A|0}else{if((E^-2147483648|0)<(R|0))A=1;else{x=E;break}return A|0}}else x=P*3|0,A=R<<1;while(!1);E=ke(+(A+P|0)/7)|0,y[m>>2]=E,P=ke(+(x-R|0)/7)|0,y[F>>2]=P,y[k>>2]=0,x=(P|0)<(E|0),A=x?E:P,x=x?P:E;do if((x|0)<0){if((A|0)>0){if((A|-2147483648|0)<(x|0)&((x|0)!=-2147483648&(2147483647-A|0)>=(x|0)))break;Fr(23313,22444,404,22469)}if((x|0)==-2147483648|(-2147483648-A|0)>(x|0)&&Fr(23313,22444,404,22469),(A|0)>-1){if((A|-2147483648|0)<(x|0))break;Fr(23313,22444,404,22469)}else{if((A^-2147483648|0)>=(x|0))break;Fr(23313,22444,404,22469)}}while(!1);return A=P-E|0,(E|0)<0?(x=0-E|0,y[F>>2]=A,y[k>>2]=x,y[m>>2]=0,E=0):(A=P,x=0),(A|0)<0&&(E=E-A|0,y[m>>2]=E,x=x-A|0,y[k>>2]=x,y[F>>2]=0,A=0),R=E-x|0,P=A-x|0,(x|0)<0?(y[m>>2]=R,y[F>>2]=P,y[k>>2]=0,A=P,P=R,x=0):P=E,E=(A|0)<(P|0)?A:P,E=(x|0)<(E|0)?x:E,(E|0)<=0?(F=0,F|0):(y[m>>2]=P-E,y[F>>2]=A-E,y[k>>2]=x-E,F=0,F|0)}function tf(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;k=m+8|0,x=y[k>>2]|0,A=(y[m>>2]|0)-x|0,F=m+4|0,x=(y[F>>2]|0)-x|0,E=ke(+((A*3|0)-x|0)/7)|0,y[m>>2]=E,A=ke(+((x<<1)+A|0)/7)|0,y[F>>2]=A,y[k>>2]=0,x=A-E|0,(E|0)<0?(R=0-E|0,y[F>>2]=x,y[k>>2]=R,y[m>>2]=0,A=x,E=0,x=R):x=0,(A|0)<0&&(E=E-A|0,y[m>>2]=E,x=x-A|0,y[k>>2]=x,y[F>>2]=0,A=0),R=E-x|0,P=A-x|0,(x|0)<0?(y[m>>2]=R,y[F>>2]=P,y[k>>2]=0,A=P,P=R,x=0):P=E,E=(A|0)<(P|0)?A:P,E=(x|0)<(E|0)?x:E,!((E|0)<=0)&&(y[m>>2]=P-E,y[F>>2]=A-E,y[k>>2]=x-E)}function rf(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;k=m+8|0,x=y[k>>2]|0,A=(y[m>>2]|0)-x|0,F=m+4|0,x=(y[F>>2]|0)-x|0,E=ke(+((A<<1)+x|0)/7)|0,y[m>>2]=E,A=ke(+((x*3|0)-A|0)/7)|0,y[F>>2]=A,y[k>>2]=0,x=A-E|0,(E|0)<0?(R=0-E|0,y[F>>2]=x,y[k>>2]=R,y[m>>2]=0,A=x,E=0,x=R):x=0,(A|0)<0&&(E=E-A|0,y[m>>2]=E,x=x-A|0,y[k>>2]=x,y[F>>2]=0,A=0),R=E-x|0,P=A-x|0,(x|0)<0?(y[m>>2]=R,y[F>>2]=P,y[k>>2]=0,A=P,P=R,x=0):P=E,E=(A|0)<(P|0)?A:P,E=(x|0)<(E|0)?x:E,!((E|0)<=0)&&(y[m>>2]=P-E,y[F>>2]=A-E,y[k>>2]=x-E)}function Oc(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;A=y[m>>2]|0,k=m+4|0,x=y[k>>2]|0,F=m+8|0,E=y[F>>2]|0,P=x+(A*3|0)|0,y[m>>2]=P,x=E+(x*3|0)|0,y[k>>2]=x,A=(E*3|0)+A|0,y[F>>2]=A,E=x-P|0,(P|0)<0?(A=A-P|0,y[k>>2]=E,y[F>>2]=A,y[m>>2]=0,x=E,E=0):E=P,(x|0)<0&&(E=E-x|0,y[m>>2]=E,A=A-x|0,y[F>>2]=A,y[k>>2]=0,x=0),R=E-A|0,P=x-A|0,(A|0)<0?(y[m>>2]=R,y[k>>2]=P,y[F>>2]=0,E=R,A=0):P=x,x=(P|0)<(E|0)?P:E,x=(A|0)<(x|0)?A:x,!((x|0)<=0)&&(y[m>>2]=E-x,y[k>>2]=P-x,y[F>>2]=A-x)}function Ka(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;P=y[m>>2]|0,k=m+4|0,A=y[k>>2]|0,F=m+8|0,x=y[F>>2]|0,E=(A*3|0)+P|0,P=x+(P*3|0)|0,y[m>>2]=P,y[k>>2]=E,A=(x*3|0)+A|0,y[F>>2]=A,x=E-P|0,(P|0)<0?(A=A-P|0,y[k>>2]=x,y[F>>2]=A,y[m>>2]=0,P=0):x=E,(x|0)<0&&(P=P-x|0,y[m>>2]=P,A=A-x|0,y[F>>2]=A,y[k>>2]=0,x=0),R=P-A|0,E=x-A|0,(A|0)<0?(y[m>>2]=R,y[k>>2]=E,y[F>>2]=0,P=R,A=0):E=x,x=(E|0)<(P|0)?E:P,x=(A|0)<(x|0)?A:x,!((x|0)<=0)&&(y[m>>2]=P-x,y[k>>2]=E-x,y[F>>2]=A-x)}function Hu(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0;(A+-1|0)>>>0>=6||(P=(y[15440+(A*12|0)>>2]|0)+(y[m>>2]|0)|0,y[m>>2]=P,F=m+4|0,E=(y[15440+(A*12|0)+4>>2]|0)+(y[F>>2]|0)|0,y[F>>2]=E,k=m+8|0,A=(y[15440+(A*12|0)+8>>2]|0)+(y[k>>2]|0)|0,y[k>>2]=A,x=E-P|0,(P|0)<0?(A=A-P|0,y[F>>2]=x,y[k>>2]=A,y[m>>2]=0,E=0):(x=E,E=P),(x|0)<0&&(E=E-x|0,y[m>>2]=E,A=A-x|0,y[k>>2]=A,y[F>>2]=0,x=0),R=E-A|0,P=x-A|0,(A|0)<0?(y[m>>2]=R,y[F>>2]=P,y[k>>2]=0,E=R,A=0):P=x,x=(P|0)<(E|0)?P:E,x=(A|0)<(x|0)?A:x,!((x|0)<=0)&&(y[m>>2]=E-x,y[F>>2]=P-x,y[k>>2]=A-x))}function Dc(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;P=y[m>>2]|0,k=m+4|0,A=y[k>>2]|0,F=m+8|0,x=y[F>>2]|0,E=A+P|0,P=x+P|0,y[m>>2]=P,y[k>>2]=E,A=x+A|0,y[F>>2]=A,x=E-P|0,(P|0)<0?(A=A-P|0,y[k>>2]=x,y[F>>2]=A,y[m>>2]=0,E=0):(x=E,E=P),(x|0)<0&&(E=E-x|0,y[m>>2]=E,A=A-x|0,y[F>>2]=A,y[k>>2]=0,x=0),R=E-A|0,P=x-A|0,(A|0)<0?(y[m>>2]=R,y[k>>2]=P,y[F>>2]=0,E=R,A=0):P=x,x=(P|0)<(E|0)?P:E,x=(A|0)<(x|0)?A:x,!((x|0)<=0)&&(y[m>>2]=E-x,y[k>>2]=P-x,y[F>>2]=A-x)}function Vl(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;A=y[m>>2]|0,k=m+4|0,E=y[k>>2]|0,F=m+8|0,x=y[F>>2]|0,P=E+A|0,y[m>>2]=P,E=x+E|0,y[k>>2]=E,A=x+A|0,y[F>>2]=A,x=E-P|0,(P|0)<0?(A=A-P|0,y[k>>2]=x,y[F>>2]=A,y[m>>2]=0,E=0):(x=E,E=P),(x|0)<0&&(E=E-x|0,y[m>>2]=E,A=A-x|0,y[F>>2]=A,y[k>>2]=0,x=0),R=E-A|0,P=x-A|0,(A|0)<0?(y[m>>2]=R,y[k>>2]=P,y[F>>2]=0,E=R,A=0):P=x,x=(P|0)<(E|0)?P:E,x=(A|0)<(x|0)?A:x,!((x|0)<=0)&&(y[m>>2]=E-x,y[k>>2]=P-x,y[F>>2]=A-x)}function jl(m){switch(m=m|0,m|0){case 1:{m=5;break}case 5:{m=4;break}case 4:{m=6;break}case 6:{m=2;break}case 2:{m=3;break}case 3:{m=1;break}default:}return m|0}function ca(m){switch(m=m|0,m|0){case 1:{m=3;break}case 3:{m=2;break}case 2:{m=6;break}case 6:{m=4;break}case 4:{m=5;break}case 5:{m=1;break}default:}return m|0}function Rd(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;A=y[m>>2]|0,k=m+4|0,x=y[k>>2]|0,F=m+8|0,E=y[F>>2]|0,P=x+(A<<1)|0,y[m>>2]=P,x=E+(x<<1)|0,y[k>>2]=x,A=(E<<1)+A|0,y[F>>2]=A,E=x-P|0,(P|0)<0?(A=A-P|0,y[k>>2]=E,y[F>>2]=A,y[m>>2]=0,x=E,E=0):E=P,(x|0)<0&&(E=E-x|0,y[m>>2]=E,A=A-x|0,y[F>>2]=A,y[k>>2]=0,x=0),R=E-A|0,P=x-A|0,(A|0)<0?(y[m>>2]=R,y[k>>2]=P,y[F>>2]=0,E=R,A=0):P=x,x=(P|0)<(E|0)?P:E,x=(A|0)<(x|0)?A:x,!((x|0)<=0)&&(y[m>>2]=E-x,y[k>>2]=P-x,y[F>>2]=A-x)}function nf(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;P=y[m>>2]|0,k=m+4|0,A=y[k>>2]|0,F=m+8|0,x=y[F>>2]|0,E=(A<<1)+P|0,P=x+(P<<1)|0,y[m>>2]=P,y[k>>2]=E,A=(x<<1)+A|0,y[F>>2]=A,x=E-P|0,(P|0)<0?(A=A-P|0,y[k>>2]=x,y[F>>2]=A,y[m>>2]=0,P=0):x=E,(x|0)<0&&(P=P-x|0,y[m>>2]=P,A=A-x|0,y[F>>2]=A,y[k>>2]=0,x=0),R=P-A|0,E=x-A|0,(A|0)<0?(y[m>>2]=R,y[k>>2]=E,y[F>>2]=0,P=R,A=0):E=x,x=(E|0)<(P|0)?E:P,x=(A|0)<(x|0)?A:x,!((x|0)<=0)&&(y[m>>2]=P-x,y[k>>2]=E-x,y[F>>2]=A-x)}function Gl(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0;return k=(y[m>>2]|0)-(y[A>>2]|0)|0,F=(k|0)<0,E=(y[m+4>>2]|0)-(y[A+4>>2]|0)-(F?k:0)|0,R=(E|0)<0,P=(F?0-k|0:0)+(y[m+8>>2]|0)-(y[A+8>>2]|0)+(R?0-E|0:0)|0,m=(P|0)<0,A=m?0:P,x=(R?0:E)-(m?P:0)|0,P=(F?0:k)-(R?E:0)-(m?P:0)|0,m=(x|0)<(P|0)?x:P,m=(A|0)<(m|0)?A:m,E=(m|0)>0,A=A-(E?m:0)|0,x=x-(E?m:0)|0,m=P-(E?m:0)|0,m=(m|0)>-1?m:0-m|0,x=(x|0)>-1?x:0-x|0,A=(A|0)>-1?A:0-A|0,A=(x|0)>(A|0)?x:A,((m|0)>(A|0)?m:A)|0}function sf(m,A){m=m|0,A=A|0;var x=0;x=y[m+8>>2]|0,y[A>>2]=(y[m>>2]|0)-x,y[A+4>>2]=(y[m+4>>2]|0)-x}function of(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0;E=y[m>>2]|0,y[A>>2]=E,P=y[m+4>>2]|0,k=A+4|0,y[k>>2]=P,F=A+8|0,y[F>>2]=0,x=(P|0)<(E|0),m=x?E:P,x=x?P:E;do if((x|0)<0){if((m|0)>0){if((m|-2147483648|0)<(x|0)&((x|0)!=-2147483648&(2147483647-m|0)>=(x|0)))break;return m=1,m|0}if((x|0)==-2147483648|(-2147483648-m|0)>(x|0))return A=1,A|0;if((m|0)>-1){if((m|-2147483648|0)<(x|0))break;return m=1,m|0}else{if((m^-2147483648|0)<(x|0))m=1;else break;return m|0}}while(!1);return m=P-E|0,(E|0)<0?(x=0-E|0,y[k>>2]=m,y[F>>2]=x,y[A>>2]=0,E=0):(m=P,x=0),(m|0)<0&&(E=E-m|0,y[A>>2]=E,x=x-m|0,y[F>>2]=x,y[k>>2]=0,m=0),R=E-x|0,P=m-x|0,(x|0)<0?(y[A>>2]=R,y[k>>2]=P,y[F>>2]=0,m=P,P=R,x=0):P=E,E=(m|0)<(P|0)?m:P,E=(x|0)<(E|0)?x:E,(E|0)<=0?(A=0,A|0):(y[A>>2]=P-E,y[k>>2]=m-E,y[F>>2]=x-E,A=0,A|0)}function Wu(m){m=m|0;var A=0,x=0,E=0,P=0;A=m+8|0,P=y[A>>2]|0,x=P-(y[m>>2]|0)|0,y[m>>2]=x,E=m+4|0,m=(y[E>>2]|0)-P|0,y[E>>2]=m,y[A>>2]=0-(m+x)}function kc(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;x=y[m>>2]|0,A=0-x|0,y[m>>2]=A,k=m+8|0,y[k>>2]=0,F=m+4|0,E=y[F>>2]|0,P=E+x|0,(x|0)>0?(y[F>>2]=P,y[k>>2]=x,y[m>>2]=0,A=0,E=P):x=0,(E|0)<0?(R=A-E|0,y[m>>2]=R,x=x-E|0,y[k>>2]=x,y[F>>2]=0,P=R-x|0,A=0-x|0,(x|0)<0?(y[m>>2]=P,y[F>>2]=A,y[k>>2]=0,E=A,x=0):(E=0,P=R)):P=A,A=(E|0)<(P|0)?E:P,A=(x|0)<(A|0)?x:A,!((A|0)<=0)&&(y[m>>2]=P-A,y[F>>2]=E-A,y[k>>2]=x-A)}function Fc(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0;if(we=be,be=be+64|0,he=we,F=we+56|0,!(!0&(A&2013265920|0)==134217728&(!0&(E&2013265920|0)==134217728)))return P=5,be=we,P|0;if((m|0)==(x|0)&(A|0)==(E|0))return y[P>>2]=0,P=0,be=we,P|0;if(k=mt(m|0,A|0,52)|0,Pe()|0,k=k&15,Q=mt(x|0,E|0,52)|0,Pe()|0,(k|0)!=(Q&15|0))return P=12,be=we,P|0;if(R=k+-1|0,k>>>0>1){uf(m,A,R,he)|0,uf(x,E,R,F)|0,Q=he,W=y[Q>>2]|0,Q=y[Q+4>>2]|0;e:do if((W|0)==(y[F>>2]|0)&&(Q|0)==(y[F+4>>2]|0)){k=(k^15)*3|0,R=mt(m|0,A|0,k|0)|0,Pe()|0,R=R&7,k=mt(x|0,E|0,k|0)|0,Pe()|0,k=k&7;do if((R|0)==0|(k|0)==0)y[P>>2]=1,R=0;else if((R|0)==7)R=5;else{if((R|0)==1|(k|0)==1&&Vi(W,Q)|0){R=5;break}if((y[15536+(R<<2)>>2]|0)!=(k|0)&&(y[15568+(R<<2)>>2]|0)!=(k|0))break e;y[P>>2]=1,R=0}while(!1);return P=R,be=we,P|0}while(!1)}R=he,k=R+56|0;do y[R>>2]=0,R=R+4|0;while((R|0)<(k|0));return xA(m,A,1,he)|0,A=he,!((y[A>>2]|0)==(x|0)&&(y[A+4>>2]|0)==(E|0))&&(A=he+8|0,!((y[A>>2]|0)==(x|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+16|0,!((y[A>>2]|0)==(x|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+24|0,!((y[A>>2]|0)==(x|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+32|0,!((y[A>>2]|0)==(x|0)&&(y[A+4>>2]|0)==(E|0)))&&(A=he+40|0,!((y[A>>2]|0)==(x|0)&&(y[A+4>>2]|0)==(E|0)))?(R=he+48|0,R=((y[R>>2]|0)==(x|0)?(y[R+4>>2]|0)==(E|0):0)&1):R=1,y[P>>2]=R,P=0,be=we,P|0}function Gm(m,A,x,E,P){return m=m|0,A=A|0,x=x|0,E=E|0,P=P|0,x=$h(m,A,x,E)|0,(x|0)==7?(P=11,P|0):(E=Nt(x|0,0,56)|0,A=A&-2130706433|(Pe()|0)|268435456,y[P>>2]=m|E,y[P+4>>2]=A,P=0,P|0)}function TA(m,A,x){return m=m|0,A=A|0,x=x|0,!0&(A&2013265920|0)==268435456?(y[x>>2]=m,y[x+4>>2]=A&-2130706433|134217728,x=0,x|0):(x=6,x|0)}function Rn(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;return P=be,be=be+16|0,E=P,y[E>>2]=0,!0&(A&2013265920|0)==268435456?(R=mt(m|0,A|0,56)|0,Pe()|0,E=ts(m,A&-2130706433|134217728,R&7,E,x)|0,be=P,E|0):(E=6,be=P,E|0)}function Hl(m,A){m=m|0,A=A|0;var x=0;switch(x=mt(m|0,A|0,56)|0,Pe()|0,x&7){case 0:case 7:return x=0,x|0;default:}return x=A&-2130706433|134217728,!(!0&(A&2013265920|0)==268435456)||!0&(A&117440512|0)==16777216&(Vi(m,x)|0)!=0?(x=0,x|0):(x=cf(m,x)|0,x|0)}function So(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0;return P=be,be=be+16|0,E=P,!0&(A&2013265920|0)==268435456?(R=A&-2130706433|134217728,k=x,y[k>>2]=m,y[k+4>>2]=R,y[E>>2]=0,A=mt(m|0,A|0,56)|0,Pe()|0,E=ts(m,R,A&7,E,x+8|0)|0,be=P,E|0):(E=6,be=P,E|0)}function Bd(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0;return P=(Vi(m,A)|0)==0,A=A&-2130706433,E=x,y[E>>2]=P?m:0,y[E+4>>2]=P?A|285212672:0,E=x+8|0,y[E>>2]=m,y[E+4>>2]=A|301989888,E=x+16|0,y[E>>2]=m,y[E+4>>2]=A|318767104,E=x+24|0,y[E>>2]=m,y[E+4>>2]=A|335544320,E=x+32|0,y[E>>2]=m,y[E+4>>2]=A|352321536,x=x+40|0,y[x>>2]=m,y[x+4>>2]=A|369098752,0}function Wl(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0;return k=be,be=be+16|0,P=k,R=A&-2130706433|134217728,!0&(A&2013265920|0)==268435456?(E=mt(m|0,A|0,56)|0,Pe()|0,E=_(m,R,E&7)|0,(E|0)==-1?(y[x>>2]=0,R=6,be=k,R|0):(Vo(m,R,P)|0&&Fr(23313,22484,282,22499),A=mt(m|0,A|0,52)|0,Pe()|0,A=A&15,Vi(m,R)|0?af(P,A,E,2,x):Sa(P,A,E,2,x),R=0,be=k,R|0)):(R=6,be=k,R|0)}function Ld(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0;E=be,be=be+16|0,P=E,Ea(m,A,x,P),Pd(P,x+4|0),be=E}function Ea(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0;if(F=be,be=be+16|0,W=F,$u(m,x,W),R=+mA(+(1-+Ee[W>>3]*.5)),R<1e-16){y[E>>2]=0,y[E+4>>2]=0,y[E+8>>2]=0,y[E+12>>2]=0,be=F;return}if(W=y[x>>2]|0,P=+Ee[15920+(W*24|0)>>3],P=+ql(P-+ql(+Wm(15600+(W<<4)|0,m))),yn(A)|0?k=+ql(P+-.3334731722518321):k=P,P=+Ic(+R)/.381966011250105,(A|0)>0){m=0;do P=P*2.6457513110645907,m=m+1|0;while((m|0)!=(A|0))}R=+vi(+k)*P,Ee[E>>3]=R,k=+Si(+k)*P,Ee[E+8>>3]=k,be=F}function $u(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;if(R=be,be=be+32|0,P=R,u(m,P),y[A>>2]=0,Ee[x>>3]=5,E=+o(16400,P),E<+Ee[x>>3]&&(y[A>>2]=0,Ee[x>>3]=E),E=+o(16424,P),E<+Ee[x>>3]&&(y[A>>2]=1,Ee[x>>3]=E),E=+o(16448,P),E<+Ee[x>>3]&&(y[A>>2]=2,Ee[x>>3]=E),E=+o(16472,P),E<+Ee[x>>3]&&(y[A>>2]=3,Ee[x>>3]=E),E=+o(16496,P),E<+Ee[x>>3]&&(y[A>>2]=4,Ee[x>>3]=E),E=+o(16520,P),E<+Ee[x>>3]&&(y[A>>2]=5,Ee[x>>3]=E),E=+o(16544,P),E<+Ee[x>>3]&&(y[A>>2]=6,Ee[x>>3]=E),E=+o(16568,P),E<+Ee[x>>3]&&(y[A>>2]=7,Ee[x>>3]=E),E=+o(16592,P),E<+Ee[x>>3]&&(y[A>>2]=8,Ee[x>>3]=E),E=+o(16616,P),E<+Ee[x>>3]&&(y[A>>2]=9,Ee[x>>3]=E),E=+o(16640,P),E<+Ee[x>>3]&&(y[A>>2]=10,Ee[x>>3]=E),E=+o(16664,P),E<+Ee[x>>3]&&(y[A>>2]=11,Ee[x>>3]=E),E=+o(16688,P),E<+Ee[x>>3]&&(y[A>>2]=12,Ee[x>>3]=E),E=+o(16712,P),E<+Ee[x>>3]&&(y[A>>2]=13,Ee[x>>3]=E),E=+o(16736,P),E<+Ee[x>>3]&&(y[A>>2]=14,Ee[x>>3]=E),E=+o(16760,P),E<+Ee[x>>3]&&(y[A>>2]=15,Ee[x>>3]=E),E=+o(16784,P),E<+Ee[x>>3]&&(y[A>>2]=16,Ee[x>>3]=E),E=+o(16808,P),E<+Ee[x>>3]&&(y[A>>2]=17,Ee[x>>3]=E),E=+o(16832,P),E<+Ee[x>>3]&&(y[A>>2]=18,Ee[x>>3]=E),E=+o(16856,P),!(E<+Ee[x>>3])){be=R;return}y[A>>2]=19,Ee[x>>3]=E,be=R}function Qa(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0;if(R=+eh(m),R<1e-16){A=15600+(A<<4)|0,y[P>>2]=y[A>>2],y[P+4>>2]=y[A+4>>2],y[P+8>>2]=y[A+8>>2],y[P+12>>2]=y[A+12>>2];return}if(k=+_o(+ +Ee[m+8>>3],+ +Ee[m>>3]),(x|0)>0){m=0;do R=R/2.6457513110645907,m=m+1|0;while((m|0)!=(x|0))}E?(R=R/3,x=(yn(x)|0)==0,R=+Pc(+((x?R:R/2.6457513110645907)*.381966011250105))):(R=+Pc(+(R*.381966011250105)),yn(x)|0&&(k=+ql(k+.3334731722518321))),$m(15600+(A<<4)|0,+ql(+Ee[15920+(A*24|0)>>3]-k),R,P)}function Od(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0;E=be,be=be+16|0,P=E,Uo(m+4|0,P),Qa(P,y[m>>2]|0,A,0,x),be=E}function af(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0,lr=0,di=0,ti=0,ii=0,Hr=0,Ur=0,jr=0,Ni=0,Wr=0;if(jr=be,be=be+272|0,R=jr+256|0,at=jr+240|0,ii=jr,Hr=jr+224|0,Ur=jr+208|0,bt=jr+176|0,ft=jr+160|0,ar=jr+192|0,mr=jr+144|0,sr=jr+128|0,lr=jr+112|0,di=jr+96|0,ti=jr+80|0,y[R>>2]=A,y[at>>2]=y[m>>2],y[at+4>>2]=y[m+4>>2],y[at+8>>2]=y[m+8>>2],y[at+12>>2]=y[m+12>>2],lf(at,R,ii),y[P>>2]=0,at=E+x+((E|0)==5&1)|0,(at|0)<=(x|0)){be=jr;return}W=y[R>>2]|0,Q=Hr+4|0,he=bt+4|0,we=x+5|0,$e=16880+(W<<2)|0,Qe=16960+(W<<2)|0,Ue=sr+8|0,nt=lr+8|0,It=di+8|0,wt=Ur+4|0,F=x;e:for(;;){k=ii+(((F|0)%5|0)<<4)|0,y[Ur>>2]=y[k>>2],y[Ur+4>>2]=y[k+4>>2],y[Ur+8>>2]=y[k+8>>2],y[Ur+12>>2]=y[k+12>>2];do;while((Ja(Ur,W,0,1)|0)==2);if((F|0)>(x|0)&(yn(A)|0)!=0){if(y[bt>>2]=y[Ur>>2],y[bt+4>>2]=y[Ur+4>>2],y[bt+8>>2]=y[Ur+8>>2],y[bt+12>>2]=y[Ur+12>>2],Uo(Q,ft),E=y[bt>>2]|0,R=y[17040+(E*80|0)+(y[Hr>>2]<<2)>>2]|0,y[bt>>2]=y[18640+(E*80|0)+(R*20|0)>>2],k=y[18640+(E*80|0)+(R*20|0)+16>>2]|0,(k|0)>0){m=0;do Dc(he),m=m+1|0;while((m|0)<(k|0))}switch(k=18640+(E*80|0)+(R*20|0)+4|0,y[ar>>2]=y[k>>2],y[ar+4>>2]=y[k+4>>2],y[ar+8>>2]=y[k+8>>2],Md(ar,(y[$e>>2]|0)*3|0),zs(he,ar,he),ls(he),Uo(he,mr),Ni=+(y[Qe>>2]|0),Ee[sr>>3]=Ni*3,Ee[Ue>>3]=0,Wr=Ni*-1.5,Ee[lr>>3]=Wr,Ee[nt>>3]=Ni*2.598076211353316,Ee[di>>3]=Wr,Ee[It>>3]=Ni*-2.598076211353316,y[17040+((y[bt>>2]|0)*80|0)+(y[Ur>>2]<<2)>>2]|0){case 1:{m=lr,E=sr;break}case 3:{m=di,E=lr;break}case 2:{m=sr,E=di;break}default:{m=12;break e}}_f(ft,mr,E,m,ti),Qa(ti,y[bt>>2]|0,W,1,P+8+(y[P>>2]<<4)|0),y[P>>2]=(y[P>>2]|0)+1}if((F|0)<(we|0)&&(Uo(wt,bt),Qa(bt,y[Ur>>2]|0,W,1,P+8+(y[P>>2]<<4)|0),y[P>>2]=(y[P>>2]|0)+1),y[Hr>>2]=y[Ur>>2],y[Hr+4>>2]=y[Ur+4>>2],y[Hr+8>>2]=y[Ur+8>>2],y[Hr+12>>2]=y[Ur+12>>2],F=F+1|0,(F|0)>=(at|0)){m=3;break}}if((m|0)==3){be=jr;return}else(m|0)==12&&Fr(22522,22569,571,22579)}function lf(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0;W=be,be=be+128|0,E=W+64|0,P=W,R=E,k=20240,F=R+60|0;do y[R>>2]=y[k>>2],R=R+4|0,k=k+4|0;while((R|0)<(F|0));R=P,k=20304,F=R+60|0;do y[R>>2]=y[k>>2],R=R+4|0,k=k+4|0;while((R|0)<(F|0));F=(yn(y[A>>2]|0)|0)==0,E=F?E:P,P=m+4|0,Rd(P),nf(P),yn(y[A>>2]|0)|0&&(Ka(P),y[A>>2]=(y[A>>2]|0)+1),y[x>>2]=y[m>>2],A=x+4|0,zs(P,E,A),ls(A),y[x+16>>2]=y[m>>2],A=x+20|0,zs(P,E+12|0,A),ls(A),y[x+32>>2]=y[m>>2],A=x+36|0,zs(P,E+24|0,A),ls(A),y[x+48>>2]=y[m>>2],A=x+52|0,zs(P,E+36|0,A),ls(A),y[x+64>>2]=y[m>>2],x=x+68|0,zs(P,E+48|0,x),ls(x),be=W}function Ja(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(Ue=be,be=be+32|0,$e=Ue+12|0,F=Ue,Qe=m+4|0,we=y[16960+(A<<2)>>2]|0,he=(E|0)!=0,we=he?we*3|0:we,P=y[Qe>>2]|0,Q=m+8|0,k=y[Q>>2]|0,he){if(R=m+12|0,E=y[R>>2]|0,P=k+P+E|0,(P|0)==(we|0))return Qe=1,be=Ue,Qe|0;W=R}else W=m+12|0,E=y[W>>2]|0,P=k+P+E|0;if((P|0)<=(we|0))return Qe=0,be=Ue,Qe|0;do if((E|0)>0){if(E=y[m>>2]|0,(k|0)>0){R=18640+(E*80|0)+60|0,E=m;break}E=18640+(E*80|0)+40|0,x?(Qh($e,we,0,0),Jh(Qe,$e,F),Vl(F),zs(F,$e,Qe),R=E,E=m):(R=E,E=m)}else R=18640+((y[m>>2]|0)*80|0)+20|0,E=m;while(!1);if(y[E>>2]=y[R>>2],P=R+16|0,(y[P>>2]|0)>0){E=0;do Dc(Qe),E=E+1|0;while((E|0)<(y[P>>2]|0))}return m=R+4|0,y[$e>>2]=y[m>>2],y[$e+4>>2]=y[m+4>>2],y[$e+8>>2]=y[m+8>>2],A=y[16880+(A<<2)>>2]|0,Md($e,he?A*3|0:A),zs(Qe,$e,Qe),ls(Qe),he?E=((y[Q>>2]|0)+(y[Qe>>2]|0)+(y[W>>2]|0)|0)==(we|0)?1:2:E=2,Qe=E,be=Ue,Qe|0}function Nc(m,A){m=m|0,A=A|0;var x=0;do x=Ja(m,A,0,1)|0;while((x|0)==2);return x|0}function Sa(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0,lr=0,di=0,ti=0,ii=0;if(di=be,be=be+240|0,R=di+224|0,ar=di+208|0,mr=di,sr=di+192|0,lr=di+176|0,It=di+160|0,wt=di+144|0,at=di+128|0,bt=di+112|0,ft=di+96|0,y[R>>2]=A,y[ar>>2]=y[m>>2],y[ar+4>>2]=y[m+4>>2],y[ar+8>>2]=y[m+8>>2],y[ar+12>>2]=y[m+12>>2],Dd(ar,R,mr),y[P>>2]=0,nt=E+x+((E|0)==6&1)|0,(nt|0)<=(x|0)){be=di;return}W=y[R>>2]|0,Q=x+6|0,he=16960+(W<<2)|0,we=wt+8|0,$e=at+8|0,Qe=bt+8|0,Ue=sr+4|0,k=0,F=x,E=-1;e:for(;;){if(R=(F|0)%6|0,m=mr+(R<<4)|0,y[sr>>2]=y[m>>2],y[sr+4>>2]=y[m+4>>2],y[sr+8>>2]=y[m+8>>2],y[sr+12>>2]=y[m+12>>2],m=k,k=Ja(sr,W,0,1)|0,(F|0)>(x|0)&(yn(A)|0)!=0&&(m|0)!=1&&(y[sr>>2]|0)!=(E|0)){switch(Uo(mr+(((R+5|0)%6|0)<<4)+4|0,lr),Uo(mr+(R<<4)+4|0,It),ti=+(y[he>>2]|0),Ee[wt>>3]=ti*3,Ee[we>>3]=0,ii=ti*-1.5,Ee[at>>3]=ii,Ee[$e>>3]=ti*2.598076211353316,Ee[bt>>3]=ii,Ee[Qe>>3]=ti*-2.598076211353316,R=y[ar>>2]|0,y[17040+(R*80|0)+(((E|0)==(R|0)?y[sr>>2]|0:E)<<2)>>2]|0){case 1:{m=at,E=wt;break}case 3:{m=bt,E=at;break}case 2:{m=wt,E=bt;break}default:{m=8;break e}}_f(lr,It,E,m,ft),!(S(lr,ft)|0)&&!(S(It,ft)|0)&&(Qa(ft,y[ar>>2]|0,W,1,P+8+(y[P>>2]<<4)|0),y[P>>2]=(y[P>>2]|0)+1)}if((F|0)<(Q|0)&&(Uo(Ue,lr),Qa(lr,y[sr>>2]|0,W,1,P+8+(y[P>>2]<<4)|0),y[P>>2]=(y[P>>2]|0)+1),F=F+1|0,(F|0)>=(nt|0)){m=3;break}else E=y[sr>>2]|0}if((m|0)==3){be=di;return}else(m|0)==8&&Fr(22606,22569,736,22651)}function Dd(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0;W=be,be=be+160|0,E=W+80|0,P=W,R=E,k=20368,F=R+72|0;do y[R>>2]=y[k>>2],R=R+4|0,k=k+4|0;while((R|0)<(F|0));R=P,k=20448,F=R+72|0;do y[R>>2]=y[k>>2],R=R+4|0,k=k+4|0;while((R|0)<(F|0));F=(yn(y[A>>2]|0)|0)==0,E=F?E:P,P=m+4|0,Rd(P),nf(P),yn(y[A>>2]|0)|0&&(Ka(P),y[A>>2]=(y[A>>2]|0)+1),y[x>>2]=y[m>>2],A=x+4|0,zs(P,E,A),ls(A),y[x+16>>2]=y[m>>2],A=x+20|0,zs(P,E+12|0,A),ls(A),y[x+32>>2]=y[m>>2],A=x+36|0,zs(P,E+24|0,A),ls(A),y[x+48>>2]=y[m>>2],A=x+52|0,zs(P,E+36|0,A),ls(A),y[x+64>>2]=y[m>>2],A=x+68|0,zs(P,E+48|0,A),ls(A),y[x+80>>2]=y[m>>2],x=x+84|0,zs(P,E+60|0,x),ls(x),be=W}function EA(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,52)|0,Pe()|0,A&15|0}function kd(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,45)|0,Pe()|0,A&127|0}function cf(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0;if(!(!0&(A&-16777216|0)==134217728)||(k=mt(m|0,A|0,45)|0,Pe()|0,k=k&127,k>>>0>121))return A=0,A|0;x=mt(m|0,A|0,52)|0,Pe()|0,x=x&15;do if(x|0){for(P=1,E=0;;){if(R=mt(m|0,A|0,(15-P|0)*3|0)|0,Pe()|0,R=R&7,(R|0)!=0&(E^1))if((R|0)==1&(Ai(k)|0)!=0){F=0,E=13;break}else E=1;if((R|0)==7){F=0,E=13;break}if(P>>>0<x>>>0)P=P+1|0;else{E=9;break}}if((E|0)==9){if((x|0)==15)F=1;else break;return F|0}else if((E|0)==13)return F|0}while(!1);for(;;){if(F=mt(m|0,A|0,(14-x|0)*3|0)|0,Pe()|0,!((F&7|0)==7&!0)){F=0,E=13;break}if(x>>>0<14)x=x+1|0;else{F=1,E=13;break}}return(E|0)==13?F|0:0}function uf(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0;if(R=mt(m|0,A|0,52)|0,Pe()|0,R=R&15,x>>>0>15)return E=4,E|0;if((R|0)<(x|0))return E=12,E|0;if((R|0)==(x|0))return y[E>>2]=m,y[E+4>>2]=A,E=0,E|0;if(P=Nt(x|0,0,52)|0,P=P|m,m=Pe()|0|A&-15728641,(R|0)>(x|0))do A=Nt(7,0,(14-x|0)*3|0)|0,x=x+1|0,P=A|P,m=Pe()|0|m;while((x|0)<(R|0));return y[E>>2]=P,y[E+4>>2]=m,E=0,E|0}function Ca(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0;if(R=mt(m|0,A|0,52)|0,Pe()|0,R=R&15,!((x|0)<16&(R|0)<=(x|0)))return E=4,E|0;P=x-R|0,x=mt(m|0,A|0,45)|0,Pe()|0;e:do if(!(Ai(x&127)|0))x=cs(7,0,P,((P|0)<0)<<31>>31)|0,P=Pe()|0;else{t:do if(R|0){for(x=1;k=Nt(7,0,(15-x|0)*3|0)|0,!!((k&m|0)==0&((Pe()|0)&A|0)==0);)if(x>>>0<R>>>0)x=x+1|0;else break t;x=cs(7,0,P,((P|0)<0)<<31>>31)|0,P=Pe()|0;break e}while(!1);x=cs(7,0,P,((P|0)<0)<<31>>31)|0,x=Tt(x|0,Pe()|0,5,0)|0,x=Ge(x|0,Pe()|0,-5,-1)|0,x=Mt(x|0,Pe()|0,6,0)|0,x=Ge(x|0,Pe()|0,1,0)|0,P=Pe()|0}while(!1);return k=E,y[k>>2]=x,y[k+4>>2]=P,k=0,k|0}function Vi(m,A){m=m|0,A=A|0;var x=0,E=0,P=0;if(P=mt(m|0,A|0,45)|0,Pe()|0,!(Ai(P&127)|0))return P=0,P|0;P=mt(m|0,A|0,52)|0,Pe()|0,P=P&15;e:do if(!P)x=0;else for(E=1;;){if(x=mt(m|0,A|0,(15-E|0)*3|0)|0,Pe()|0,x=x&7,x|0)break e;if(E>>>0<P>>>0)E=E+1|0;else{x=0;break}}while(!1);return P=(x|0)==0&1,P|0}function Ts(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0;if(k=be,be=be+16|0,R=k,Nd(R,m,A,x),A=R,m=y[A>>2]|0,A=y[A+4>>2]|0,(m|0)==0&(A|0)==0)return be=k,0;P=0,x=0;do F=E+(P<<3)|0,y[F>>2]=m,y[F+4>>2]=A,P=Ge(P|0,x|0,1,0)|0,x=Pe()|0,IA(R),F=R,m=y[F>>2]|0,A=y[F+4>>2]|0;while(!((m|0)==0&(A|0)==0));return be=k,0}function zc(m,A,x,E){return m=m|0,A=A|0,x=x|0,E=E|0,(E|0)<(x|0)?(x=A,E=m,Yr(x|0),E|0):(x=Nt(-1,-1,((E-x|0)*3|0)+3|0)|0,E=Nt(~x|0,~(Pe()|0)|0,(15-E|0)*3|0)|0,x=~(Pe()|0)&A,E=~E&m,Yr(x|0),E|0)}function Co(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0;return P=mt(m|0,A|0,52)|0,Pe()|0,P=P&15,(x|0)<16&(P|0)<=(x|0)?((P|0)<(x|0)&&(P=Nt(-1,-1,((x+-1-P|0)*3|0)+3|0)|0,P=Nt(~P|0,~(Pe()|0)|0,(15-x|0)*3|0)|0,A=~(Pe()|0)&A,m=~P&m),P=Nt(x|0,0,52)|0,x=A&-15728641|(Pe()|0),y[E>>2]=m|P,y[E+4>>2]=x,E=0,E|0):(E=4,E|0)}function ua(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0,lr=0;if((x|0)==0&(E|0)==0)return sr=0,sr|0;if(P=m,R=y[P>>2]|0,P=y[P+4>>2]|0,!0&(P&15728640|0)==0){if(!((E|0)>0|(E|0)==0&x>>>0>0)||(sr=A,y[sr>>2]=R,y[sr+4>>2]=P,(x|0)==1&(E|0)==0))return sr=0,sr|0;P=1;do ar=m+(P<<3)|0,mr=y[ar+4>>2]|0,sr=A+(P<<3)|0,y[sr>>2]=y[ar>>2],y[sr+4>>2]=mr,P=P+1|0;while(0<(E|0)|(E|0)==0&P>>>0<x>>>0);return P=0,P|0}if(ft=x<<3,mr=Ve(ft)|0,!mr)return sr=13,sr|0;if(Wi(mr|0,m|0,ft|0)|0,ar=qe(x,8)|0,!ar)return Be(mr),sr=13,sr|0;e:do if(x|0){t:for(;;){P=mr,wt=y[P>>2]|0,P=y[P+4>>2]|0,at=mt(wt|0,P|0,52)|0,Pe()|0,at=at&15,bt=at+-1|0,It=(x|0)>0;r:do if((at|0)!=0&It){if(Qe=((x|0)<0)<<31>>31,Ue=Nt(bt|0,0,52)|0,nt=Pe()|0,bt>>>0>15){if(!((wt|0)==0&(P|0)==0)){sr=17;break t}for(R=0;;){if(R=R+1|0,(R|0)>=(x|0))break r;if(E=mr+(R<<3)|0,nt=y[E>>2]|0,E=y[E+4>>2]|0,!((nt|0)==0&(E|0)==0)){P=E,sr=17;break t}}}for(R=0,m=wt,E=P;;){if(!((m|0)==0&(E|0)==0)){if(!(!0&(E&117440512|0)==0)){sr=22;break t}if(F=mt(m|0,E|0,52)|0,Pe()|0,F=F&15,(F|0)<(bt|0)){P=12,sr=28;break t}if((F|0)!=(bt|0)&&(m=m|Ue,E=E&-15728641|nt,F>>>0>=at>>>0)){k=bt;do $e=Nt(7,0,(14-k|0)*3|0)|0,k=k+1|0,m=$e|m,E=Pe()|0|E;while(k>>>0<F>>>0)}if(k=Kt(m|0,E|0,x|0,Qe|0)|0,Pe()|0,Q=ar+(k<<3)|0,F=Q,W=y[F>>2]|0,F=y[F+4>>2]|0,(W|0)==0&(F|0)==0)k=Q;else for($e=0;;){if(($e|0)>(x|0)){sr=32;break t}if((W|0)==(m|0)&(F&-117440513|0)==(E|0)){he=mt(W|0,F|0,56)|0,Pe()|0,he=he&7,we=he+1|0,lr=mt(W|0,F|0,45)|0,Pe()|0;i:do if(!(Ai(lr&127)|0))F=7;else{if(W=mt(W|0,F|0,52)|0,Pe()|0,W=W&15,!W){F=6;break}for(F=1;;){if(lr=Nt(7,0,(15-F|0)*3|0)|0,!((lr&m|0)==0&((Pe()|0)&E|0)==0)){F=7;break i}if(F>>>0<W>>>0)F=F+1|0;else{F=6;break}}}while(!1);if((he+2|0)>>>0>F>>>0){sr=42;break t}lr=Nt(we|0,0,56)|0,E=Pe()|0|E&-117440513,we=Q,y[we>>2]=0,y[we+4>>2]=0,m=lr|m}else k=(k+1|0)%(x|0)|0;if(Q=ar+(k<<3)|0,F=Q,W=y[F>>2]|0,F=y[F+4>>2]|0,(W|0)==0&(F|0)==0){k=Q;break}else $e=$e+1|0}lr=k,y[lr>>2]=m,y[lr+4>>2]=E}if(R=R+1|0,(R|0)>=(x|0))break r;E=mr+(R<<3)|0,m=y[E>>2]|0,E=y[E+4>>2]|0}}while(!1);if((x+5|0)>>>0<11){sr=85;break}if(nt=qe((x|0)/6|0,8)|0,!nt){sr=49;break}r:do if(It){$e=0,we=0;do{if(F=ar+($e<<3)|0,E=F,R=y[E>>2]|0,E=y[E+4>>2]|0,!((R|0)==0&(E|0)==0)){W=mt(R|0,E|0,56)|0,Pe()|0,W=W&7,m=W+1|0,Q=E&-117440513,lr=mt(R|0,E|0,45)|0,Pe()|0;i:do if(Ai(lr&127)|0){if(he=mt(R|0,E|0,52)|0,Pe()|0,he=he&15,he|0)for(k=1;;){if(lr=Nt(7,0,(15-k|0)*3|0)|0,!((R&lr|0)==0&(Q&(Pe()|0)|0)==0))break i;if(k>>>0<he>>>0)k=k+1|0;else break}E=Nt(m|0,0,56)|0,R=E|R,E=Pe()|0|Q,m=F,y[m>>2]=R,y[m+4>>2]=E,m=W+2|0}while(!1);(m|0)==7&&(lr=nt+(we<<3)|0,y[lr>>2]=R,y[lr+4>>2]=E&-117440513,we=we+1|0)}$e=$e+1|0}while(($e|0)!=(x|0));if(It){if($e=((x|0)<0)<<31>>31,Qe=Nt(bt|0,0,52)|0,Ue=Pe()|0,bt>>>0>15){if(!((wt|0)==0&(P|0)==0)){P=4,sr=84;break t}for(P=0;;){if(P=P+1|0,(P|0)>=(x|0)){R=0,P=we;break r}if(lr=mr+(P<<3)|0,!((y[lr>>2]|0)==0&(y[lr+4>>2]|0)==0)){P=4,sr=84;break t}}}for(he=0,R=0,Q=wt;;){do if(!((Q|0)==0&(P|0)==0)){if(F=mt(Q|0,P|0,52)|0,Pe()|0,F=F&15,(F|0)<(bt|0)){P=12,sr=84;break t}do if((F|0)==(bt|0))E=Q,F=P;else{if(E=Q|Qe,m=P&-15728641|Ue,F>>>0<at>>>0){F=m;break}k=bt;do lr=Nt(7,0,(14-k|0)*3|0)|0,k=k+1|0,E=lr|E,m=Pe()|0|m;while(k>>>0<F>>>0);F=m}while(!1);for(k=Kt(E|0,F|0,x|0,$e|0)|0,Pe()|0,m=0;;){if((m|0)>(x|0)){sr=77;break t}if(lr=ar+(k<<3)|0,W=y[lr+4>>2]|0,(W&-117440513|0)==(F|0)&&(y[lr>>2]|0)==(E|0)){sr=79;break}if(k=(k+1|0)%(x|0)|0,lr=ar+(k<<3)|0,(y[lr>>2]|0)==(E|0)&&(y[lr+4>>2]|0)==(F|0))break;m=m+1|0}if((sr|0)==79&&(sr=0,!0&(W&117440512|0)==100663296))break;lr=A+(R<<3)|0,y[lr>>2]=Q,y[lr+4>>2]=P,R=R+1|0}while(!1);if(P=he+1|0,(P|0)>=(x|0)){P=we;break r}lr=mr+(P<<3)|0,he=P,Q=y[lr>>2]|0,P=y[lr+4>>2]|0}}else R=0,P=we}else R=0,P=0;while(!1);if(Fi(ar|0,0,ft|0)|0,Wi(mr|0,nt|0,P<<3|0)|0,Be(nt),P)A=A+(R<<3)|0,x=P;else break e}if((sr|0)==17)!0&(P&117440512|0)==0?(P=4,sr=28):sr=22;else if((sr|0)==32)Fr(23313,22674,362,22684);else{if((sr|0)==42)return Be(mr),Be(ar),lr=10,lr|0;if((sr|0)==49)return Be(mr),Be(ar),lr=13,lr|0;if((sr|0)==77)Fr(23313,22674,462,22684);else{if((sr|0)==84)return Be(nt),Be(mr),Be(ar),lr=P,lr|0;if((sr|0)==85){Wi(A|0,mr|0,x<<3|0)|0;break}}}if((sr|0)==22)return Be(mr),Be(ar),lr=5,lr|0;if((sr|0)==28)return Be(mr),Be(ar),lr=P,lr|0}while(!1);return Be(mr),Be(ar),lr=0,lr|0}function SA(m,A,x,E,P,R,k){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0,R=R|0,k=k|0;var F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0;if(nt=be,be=be+16|0,Ue=nt,!((x|0)>0|(x|0)==0&A>>>0>0))return Ue=0,be=nt,Ue|0;if((k|0)>=16)return Ue=12,be=nt,Ue|0;$e=0,Qe=0,we=0,F=0;e:for(;;){if(Q=m+($e<<3)|0,W=y[Q>>2]|0,Q=y[Q+4>>2]|0,he=mt(W|0,Q|0,52)|0,Pe()|0,(he&15|0)>(k|0)){F=12,W=11;break}if(Nd(Ue,W,Q,k),he=Ue,Q=y[he>>2]|0,he=y[he+4>>2]|0,(Q|0)==0&(he|0)==0)W=we;else{W=we;do{if(!((F|0)<(R|0)|(F|0)==(R|0)&W>>>0<P>>>0)){W=10;break e}we=E+(W<<3)|0,y[we>>2]=Q,y[we+4>>2]=he,W=Ge(W|0,F|0,1,0)|0,F=Pe()|0,IA(Ue),we=Ue,Q=y[we>>2]|0,he=y[we+4>>2]|0}while(!((Q|0)==0&(he|0)==0))}if($e=Ge($e|0,Qe|0,1,0)|0,Qe=Pe()|0,(Qe|0)<(x|0)|(Qe|0)==(x|0)&$e>>>0<A>>>0)we=W;else{F=0,W=11;break}}return(W|0)==10?(Ue=14,be=nt,Ue|0):(W|0)==11?(be=nt,F|0):0}function eo(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0;$e=be,be=be+16|0,we=$e;e:do if((x|0)>0|(x|0)==0&A>>>0>0){for(Q=0,k=0,R=0,he=0;;){if(W=m+(Q<<3)|0,F=y[W>>2]|0,W=y[W+4>>2]|0,!((F|0)==0&(W|0)==0)&&(W=(Ca(F,W,E,we)|0)==0,F=we,k=Ge(y[F>>2]|0,y[F+4>>2]|0,k|0,R|0)|0,R=Pe()|0,!W)){R=12;break}if(Q=Ge(Q|0,he|0,1,0)|0,he=Pe()|0,!((he|0)<(x|0)|(he|0)==(x|0)&Q>>>0<A>>>0))break e}return be=$e,R|0}else k=0,R=0;while(!1);return y[P>>2]=k,y[P+4>>2]=R,P=0,be=$e,P|0}function $l(m,A){return m=m|0,A=A|0,A=mt(m|0,A|0,52)|0,Pe()|0,A&1|0}function Es(m,A){m=m|0,A=A|0;var x=0,E=0,P=0;if(P=mt(m|0,A|0,52)|0,Pe()|0,P=P&15,!P)return P=0,P|0;for(E=1;;){if(x=mt(m|0,A|0,(15-E|0)*3|0)|0,Pe()|0,x=x&7,x|0){E=5;break}if(E>>>0<P>>>0)E=E+1|0;else{x=0,E=5;break}}return(E|0)==5?x|0:0}function Fd(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0,W=0;if(W=mt(m|0,A|0,52)|0,Pe()|0,W=W&15,!W)return F=A,W=m,Yr(F|0),W|0;for(F=1,x=0;;){R=(15-F|0)*3|0,E=Nt(7,0,R|0)|0,P=Pe()|0,k=mt(m|0,A|0,R|0)|0,Pe()|0,R=Nt(jl(k&7)|0,0,R|0)|0,k=Pe()|0,m=R|m&~E,A=k|A&~P;e:do if(!x)if((R&E|0)==0&(k&P|0)==0)x=0;else if(E=mt(m|0,A|0,52)|0,Pe()|0,E=E&15,!E)x=1;else{x=1;t:for(;;){switch(k=mt(m|0,A|0,(15-x|0)*3|0)|0,Pe()|0,k&7){case 1:break t;case 0:break;default:{x=1;break e}}if(x>>>0<E>>>0)x=x+1|0;else{x=1;break e}}for(x=1;;)if(k=(15-x|0)*3|0,P=mt(m|0,A|0,k|0)|0,Pe()|0,R=Nt(7,0,k|0)|0,A=A&~(Pe()|0),k=Nt(jl(P&7)|0,0,k|0)|0,m=m&~R|k,A=A|(Pe()|0),x>>>0<E>>>0)x=x+1|0;else{x=1;break}}while(!1);if(F>>>0<W>>>0)F=F+1|0;else break}return Yr(A|0),m|0}function Ia(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0;if(E=mt(m|0,A|0,52)|0,Pe()|0,E=E&15,!E)return x=A,E=m,Yr(x|0),E|0;for(x=1;R=(15-x|0)*3|0,k=mt(m|0,A|0,R|0)|0,Pe()|0,P=Nt(7,0,R|0)|0,A=A&~(Pe()|0),R=Nt(jl(k&7)|0,0,R|0)|0,m=R|m&~P,A=Pe()|0|A,x>>>0<E>>>0;)x=x+1|0;return Yr(A|0),m|0}function Hm(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0,W=0;if(W=mt(m|0,A|0,52)|0,Pe()|0,W=W&15,!W)return F=A,W=m,Yr(F|0),W|0;for(F=1,x=0;;){R=(15-F|0)*3|0,E=Nt(7,0,R|0)|0,P=Pe()|0,k=mt(m|0,A|0,R|0)|0,Pe()|0,R=Nt(ca(k&7)|0,0,R|0)|0,k=Pe()|0,m=R|m&~E,A=k|A&~P;e:do if(!x)if((R&E|0)==0&(k&P|0)==0)x=0;else if(E=mt(m|0,A|0,52)|0,Pe()|0,E=E&15,!E)x=1;else{x=1;t:for(;;){switch(k=mt(m|0,A|0,(15-x|0)*3|0)|0,Pe()|0,k&7){case 1:break t;case 0:break;default:{x=1;break e}}if(x>>>0<E>>>0)x=x+1|0;else{x=1;break e}}for(x=1;;)if(P=(15-x|0)*3|0,R=Nt(7,0,P|0)|0,k=A&~(Pe()|0),A=mt(m|0,A|0,P|0)|0,Pe()|0,A=Nt(ca(A&7)|0,0,P|0)|0,m=m&~R|A,A=k|(Pe()|0),x>>>0<E>>>0)x=x+1|0;else{x=1;break}}while(!1);if(F>>>0<W>>>0)F=F+1|0;else break}return Yr(A|0),m|0}function el(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0;if(E=mt(m|0,A|0,52)|0,Pe()|0,E=E&15,!E)return x=A,E=m,Yr(x|0),E|0;for(x=1;k=(15-x|0)*3|0,R=Nt(7,0,k|0)|0,P=A&~(Pe()|0),A=mt(m|0,A|0,k|0)|0,Pe()|0,A=Nt(ca(A&7)|0,0,k|0)|0,m=A|m&~R,A=Pe()|0|P,x>>>0<E>>>0;)x=x+1|0;return Yr(A|0),m|0}function qu(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0;if(W=be,be=be+64|0,F=W+40|0,E=W+24|0,P=W+12|0,R=W,Nt(A|0,0,52)|0,x=Pe()|0|134225919,!A)return(y[m+4>>2]|0)>2||(y[m+8>>2]|0)>2||(y[m+12>>2]|0)>2?(k=0,F=0,Yr(k|0),be=W,F|0):(Nt(Sd(m)|0,0,45)|0,k=Pe()|0|x,F=-1,Yr(k|0),be=W,F|0);if(y[F>>2]=y[m>>2],y[F+4>>2]=y[m+4>>2],y[F+8>>2]=y[m+8>>2],y[F+12>>2]=y[m+12>>2],k=F+4|0,(A|0)>0)for(m=-1;y[E>>2]=y[k>>2],y[E+4>>2]=y[k+4>>2],y[E+8>>2]=y[k+8>>2],A&1?(tf(k),y[P>>2]=y[k>>2],y[P+4>>2]=y[k+4>>2],y[P+8>>2]=y[k+8>>2],Oc(P)):(rf(k),y[P>>2]=y[k>>2],y[P+4>>2]=y[k+4>>2],y[P+8>>2]=y[k+8>>2],Ka(P)),Jh(E,P,R),ls(R),he=(15-A|0)*3|0,Q=Nt(7,0,he|0)|0,x=x&~(Pe()|0),he=Nt(ef(R)|0,0,he|0)|0,m=he|m&~Q,x=Pe()|0|x,(A|0)>1;)A=A+-1|0;else m=-1;e:do if((y[k>>2]|0)<=2&&(y[F+8>>2]|0)<=2&&(y[F+12>>2]|0)<=2){if(E=Sd(F)|0,A=Nt(E|0,0,45)|0,A=A|m,m=Pe()|0|x&-1040385,R=Cd(F)|0,!(Ai(E)|0)){if((R|0)<=0)break;for(P=0;;){if(E=mt(A|0,m|0,52)|0,Pe()|0,E=E&15,E)for(x=1;he=(15-x|0)*3|0,F=mt(A|0,m|0,he|0)|0,Pe()|0,Q=Nt(7,0,he|0)|0,m=m&~(Pe()|0),he=Nt(jl(F&7)|0,0,he|0)|0,A=A&~Q|he,m=m|(Pe()|0),x>>>0<E>>>0;)x=x+1|0;if(P=P+1|0,(P|0)==(R|0))break e}}P=mt(A|0,m|0,52)|0,Pe()|0,P=P&15;t:do if(P){x=1;r:for(;;){switch(he=mt(A|0,m|0,(15-x|0)*3|0)|0,Pe()|0,he&7){case 1:break r;case 0:break;default:break t}if(x>>>0<P>>>0)x=x+1|0;else break t}if(ju(E,y[F>>2]|0)|0)for(x=1;F=(15-x|0)*3|0,Q=Nt(7,0,F|0)|0,he=m&~(Pe()|0),m=mt(A|0,m|0,F|0)|0,Pe()|0,m=Nt(ca(m&7)|0,0,F|0)|0,A=A&~Q|m,m=he|(Pe()|0),x>>>0<P>>>0;)x=x+1|0;else for(x=1;he=(15-x|0)*3|0,F=mt(A|0,m|0,he|0)|0,Pe()|0,Q=Nt(7,0,he|0)|0,m=m&~(Pe()|0),he=Nt(jl(F&7)|0,0,he|0)|0,A=A&~Q|he,m=m|(Pe()|0),x>>>0<P>>>0;)x=x+1|0}while(!1);if((R|0)>0){x=0;do A=Fd(A,m)|0,m=Pe()|0,x=x+1|0;while((x|0)!=(R|0))}}else A=0,m=0;while(!1);return Q=m,he=A,Yr(Q|0),be=W,he|0}function yn(m){return m=m|0,(m|0)%2|0|0}function ur(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0;return P=be,be=be+16|0,E=P,A>>>0>15?(E=4,be=P,E|0):(y[m+4>>2]&2146435072|0)==2146435072||(y[m+8+4>>2]&2146435072|0)==2146435072?(E=3,be=P,E|0):(Ld(m,A,E),A=qu(E,A)|0,E=Pe()|0,y[x>>2]=A,y[x+4>>2]=E,(A|0)==0&(E|0)==0&&Fr(23313,22674,786,22697),E=0,be=P,E|0)}function hf(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0;if(P=x+4|0,R=mt(m|0,A|0,52)|0,Pe()|0,R=R&15,k=mt(m|0,A|0,45)|0,Pe()|0,E=(R|0)==0,Ai(k&127)|0){if(E)return k=1,k|0;E=1}else{if(E)return k=0,k|0;!(y[P>>2]|0)&&!(y[x+8>>2]|0)?E=(y[x+12>>2]|0)!=0&1:E=1}for(x=1;x&1?Oc(P):Ka(P),k=mt(m|0,A|0,(15-x|0)*3|0)|0,Pe()|0,Hu(P,k&7),x>>>0<R>>>0;)x=x+1|0;return E|0}function Vo(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0;if(he=be,be=be+16|0,W=he,Q=mt(m|0,A|0,45)|0,Pe()|0,Q=Q&127,Q>>>0>121)return y[x>>2]=0,y[x+4>>2]=0,y[x+8>>2]=0,y[x+12>>2]=0,Q=5,be=he,Q|0;e:do if(Ai(Q)|0&&(R=mt(m|0,A|0,52)|0,Pe()|0,R=R&15,(R|0)!=0)){E=1;t:for(;;){switch(F=mt(m|0,A|0,(15-E|0)*3|0)|0,Pe()|0,F&7){case 5:break t;case 0:break;default:{E=A;break e}}if(E>>>0<R>>>0)E=E+1|0;else{E=A;break e}}for(P=1,E=A;A=(15-P|0)*3|0,k=Nt(7,0,A|0)|0,F=E&~(Pe()|0),E=mt(m|0,E|0,A|0)|0,Pe()|0,E=Nt(ca(E&7)|0,0,A|0)|0,m=m&~k|E,E=F|(Pe()|0),P>>>0<R>>>0;)P=P+1|0}else E=A;while(!1);if(F=7696+(Q*28|0)|0,y[x>>2]=y[F>>2],y[x+4>>2]=y[F+4>>2],y[x+8>>2]=y[F+8>>2],y[x+12>>2]=y[F+12>>2],!(hf(m,E,x)|0))return Q=0,be=he,Q|0;if(k=x+4|0,y[W>>2]=y[k>>2],y[W+4>>2]=y[k+4>>2],y[W+8>>2]=y[k+8>>2],R=mt(m|0,E|0,52)|0,Pe()|0,F=R&15,R&1?(Ka(k),R=F+1|0):R=F,!(Ai(Q)|0))E=0;else{e:do if(!F)E=0;else for(A=1;;){if(P=mt(m|0,E|0,(15-A|0)*3|0)|0,Pe()|0,P=P&7,P|0){E=P;break e}if(A>>>0<F>>>0)A=A+1|0;else{E=0;break}}while(!1);E=(E|0)==4&1}if(!(Ja(x,R,E,0)|0))(R|0)!=(F|0)&&(y[k>>2]=y[W>>2],y[k+4>>2]=y[W+4>>2],y[k+8>>2]=y[W+8>>2]);else{if(Ai(Q)|0)do;while(Ja(x,R,0,0)|0);(R|0)!=(F|0)&&rf(k)}return Q=0,be=he,Q|0}function Uc(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;return R=be,be=be+16|0,E=R,P=Vo(m,A,E)|0,P|0?(be=R,P|0):(P=mt(m|0,A|0,52)|0,Pe()|0,Od(E,P&15,x),P=0,be=R,P|0)}function jo(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0;if(k=be,be=be+16|0,R=k,E=Vo(m,A,R)|0,E|0)return R=E,be=k,R|0;E=mt(m|0,A|0,45)|0,Pe()|0,E=(Ai(E&127)|0)==0,P=mt(m|0,A|0,52)|0,Pe()|0,P=P&15;e:do if(!E){if(P|0)for(E=1;;){if(F=Nt(7,0,(15-E|0)*3|0)|0,!((F&m|0)==0&((Pe()|0)&A|0)==0))break e;if(E>>>0<P>>>0)E=E+1|0;else break}return af(R,P,0,5,x),F=0,be=k,F|0}while(!1);return Sa(R,P,0,6,x),F=0,be=k,F|0}function tl(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;if(P=mt(m|0,A|0,45)|0,Pe()|0,!(Ai(P&127)|0))return P=2,y[x>>2]=P,0;if(P=mt(m|0,A|0,52)|0,Pe()|0,P=P&15,!P)return P=5,y[x>>2]=P,0;for(E=1;;){if(R=Nt(7,0,(15-E|0)*3|0)|0,!((R&m|0)==0&((Pe()|0)&A|0)==0)){E=2,m=6;break}if(E>>>0<P>>>0)E=E+1|0;else{E=5,m=6;break}}return(m|0)==6&&(y[x>>2]=E),0}function ff(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0;we=be,be=be+128|0,Q=we+112|0,R=we+96|0,he=we,P=mt(m|0,A|0,52)|0,Pe()|0,F=P&15,y[Q>>2]=F,k=mt(m|0,A|0,45)|0,Pe()|0,k=k&127;e:do if(Ai(k)|0){if(F|0)for(E=1;;){if(W=Nt(7,0,(15-E|0)*3|0)|0,!((W&m|0)==0&((Pe()|0)&A|0)==0)){P=0;break e}if(E>>>0<F>>>0)E=E+1|0;else break}if(P&1)P=1;else return W=Nt(F+1|0,0,52)|0,he=Pe()|0|A&-15728641,Q=Nt(7,0,(14-F|0)*3|0)|0,he=ff((W|m)&~Q,he&~(Pe()|0),x)|0,be=we,he|0}else P=0;while(!1);if(E=Vo(m,A,R)|0,!E){P?(lf(R,Q,he),W=5):(Dd(R,Q,he),W=6);e:do if(Ai(k)|0)if(!F)m=5;else for(E=1;;){if(k=Nt(7,0,(15-E|0)*3|0)|0,!((k&m|0)==0&((Pe()|0)&A|0)==0)){m=2;break e}if(E>>>0<F>>>0)E=E+1|0;else{m=5;break}}else m=2;while(!1);Fi(x|0,-1,m<<2|0)|0;e:do if(P)for(R=0;;){if(k=he+(R<<4)|0,Nc(k,y[Q>>2]|0)|0,k=y[k>>2]|0,F=y[x>>2]|0,(F|0)==-1|(F|0)==(k|0))E=x;else{P=0;do{if(P=P+1|0,P>>>0>=m>>>0){E=1;break e}E=x+(P<<2)|0,F=y[E>>2]|0}while(!((F|0)==-1|(F|0)==(k|0)))}if(y[E>>2]=k,R=R+1|0,R>>>0>=W>>>0){E=0;break}}else for(R=0;;){if(k=he+(R<<4)|0,Ja(k,y[Q>>2]|0,0,1)|0,k=y[k>>2]|0,F=y[x>>2]|0,(F|0)==-1|(F|0)==(k|0))E=x;else{P=0;do{if(P=P+1|0,P>>>0>=m>>>0){E=1;break e}E=x+(P<<2)|0,F=y[E>>2]|0}while(!((F|0)==-1|(F|0)==(k|0)))}if(y[E>>2]=k,R=R+1|0,R>>>0>=W>>>0){E=0;break}}while(!1)}return he=E,be=we,he|0}function oi(){return 12}function Vc(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0,W=0;if(m>>>0>15)return F=4,F|0;if(Nt(m|0,0,52)|0,F=Pe()|0|134225919,!m){x=0,E=0;do Ai(E)|0&&(Nt(E|0,0,45)|0,k=F|(Pe()|0),m=A+(x<<3)|0,y[m>>2]=-1,y[m+4>>2]=k,x=x+1|0),E=E+1|0;while((E|0)!=122);return x=0,x|0}x=0,k=0;do{if(Ai(k)|0){for(Nt(k|0,0,45)|0,E=1,P=-1,R=F|(Pe()|0);W=Nt(7,0,(15-E|0)*3|0)|0,P=P&~W,R=R&~(Pe()|0),(E|0)!=(m|0);)E=E+1|0;W=A+(x<<3)|0,y[W>>2]=P,y[W+4>>2]=R,x=x+1|0}k=k+1|0}while((k|0)!=122);return x=0,x|0}function CA(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0;if(at=be,be=be+16|0,It=at,wt=mt(m|0,A|0,52)|0,Pe()|0,wt=wt&15,x>>>0>15)return wt=4,be=at,wt|0;if((wt|0)<(x|0))return wt=12,be=at,wt|0;if((wt|0)!=(x|0))if(R=Nt(x|0,0,52)|0,R=R|m,F=Pe()|0|A&-15728641,(wt|0)>(x|0)){W=x;do nt=Nt(7,0,(14-W|0)*3|0)|0,W=W+1|0,R=nt|R,F=Pe()|0|F;while((W|0)<(wt|0));nt=R}else nt=R;else nt=m,F=A;Ue=mt(nt|0,F|0,45)|0,Pe()|0;e:do if(Ai(Ue&127)|0){if(W=mt(nt|0,F|0,52)|0,Pe()|0,W=W&15,W|0)for(R=1;;){if(Ue=Nt(7,0,(15-R|0)*3|0)|0,!((Ue&nt|0)==0&((Pe()|0)&F|0)==0)){Q=33;break e}if(R>>>0<W>>>0)R=R+1|0;else break}if(Ue=E,y[Ue>>2]=0,y[Ue+4>>2]=0,(wt|0)>(x|0)){for(Ue=A&-15728641,Qe=wt;;){if($e=Qe,Qe=Qe+-1|0,Qe>>>0>15|(wt|0)<(Qe|0)){Q=19;break}if((wt|0)!=(Qe|0))if(R=Nt(Qe|0,0,52)|0,R=R|m,W=Pe()|0|Ue,(wt|0)<($e|0))we=R;else{Q=Qe;do we=Nt(7,0,(14-Q|0)*3|0)|0,Q=Q+1|0,R=we|R,W=Pe()|0|W;while((Q|0)<(wt|0));we=R}else we=m,W=A;if(he=mt(we|0,W|0,45)|0,Pe()|0,!(Ai(he&127)|0))R=0;else{he=mt(we|0,W|0,52)|0,Pe()|0,he=he&15;t:do if(!he)R=0;else for(Q=1;;){if(R=mt(we|0,W|0,(15-Q|0)*3|0)|0,Pe()|0,R=R&7,R|0)break t;if(Q>>>0<he>>>0)Q=Q+1|0;else{R=0;break}}while(!1);R=(R|0)==0&1}if(W=mt(m|0,A|0,(15-$e|0)*3|0)|0,Pe()|0,W=W&7,(W|0)==7){P=5,Q=42;break}if(R=(R|0)!=0,(W|0)==1&R){P=5,Q=42;break}if(we=W+(((W|0)!=0&R)<<31>>31)|0,we|0&&(Q=wt-$e|0,Q=cs(7,0,Q,((Q|0)<0)<<31>>31)|0,he=Pe()|0,R?(R=Tt(Q|0,he|0,5,0)|0,R=Ge(R|0,Pe()|0,-5,-1)|0,R=Mt(R|0,Pe()|0,6,0)|0,R=Ge(R|0,Pe()|0,1,0)|0,W=Pe()|0):(R=Q,W=he),$e=we+-1|0,$e=Tt(Q|0,he|0,$e|0,(($e|0)<0)<<31>>31|0)|0,$e=Ge(R|0,W|0,$e|0,Pe()|0)|0,we=Pe()|0,he=E,he=Ge($e|0,we|0,y[he>>2]|0,y[he+4>>2]|0)|0,we=Pe()|0,$e=E,y[$e>>2]=he,y[$e+4>>2]=we),(Qe|0)<=(x|0)){Q=37;break}}if((Q|0)==19)Fr(23313,22674,1099,22710);else if((Q|0)==37){k=E,P=y[k+4>>2]|0,k=y[k>>2]|0;break}else if((Q|0)==42)return be=at,P|0}else P=0,k=0}else Q=33;while(!1);e:do if((Q|0)==33)if(Ue=E,y[Ue>>2]=0,y[Ue+4>>2]=0,(wt|0)>(x|0)){for(R=wt;;){if(P=mt(m|0,A|0,(15-R|0)*3|0)|0,Pe()|0,P=P&7,(P|0)==7){P=5;break}if(k=wt-R|0,k=cs(7,0,k,((k|0)<0)<<31>>31)|0,P=Tt(k|0,Pe()|0,P|0,0)|0,k=Pe()|0,Ue=E,k=Ge(y[Ue>>2]|0,y[Ue+4>>2]|0,P|0,k|0)|0,P=Pe()|0,Ue=E,y[Ue>>2]=k,y[Ue+4>>2]=P,R=R+-1|0,(R|0)<=(x|0))break e}return be=at,P|0}else P=0,k=0;while(!1);return Ca(nt,F,wt,It)|0&&Fr(23313,22674,1063,22725),wt=It,It=y[wt+4>>2]|0,((P|0)>-1|(P|0)==-1&k>>>0>4294967295)&((It|0)>(P|0)|((It|0)==(P|0)?(y[wt>>2]|0)>>>0>k>>>0:0))?(wt=0,be=at,wt|0):(Fr(23313,22674,1139,22710),0)}function Zu(m,A,x,E,P,R){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0,R=R|0;var k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0;if(we=be,be=be+16|0,k=we,P>>>0>15)return R=4,be=we,R|0;if(F=mt(x|0,E|0,52)|0,Pe()|0,F=F&15,(F|0)>(P|0))return R=12,be=we,R|0;if(Ca(x,E,P,k)|0&&Fr(23313,22674,1063,22725),he=k,Q=y[he+4>>2]|0,!(((A|0)>-1|(A|0)==-1&m>>>0>4294967295)&((Q|0)>(A|0)|((Q|0)==(A|0)?(y[he>>2]|0)>>>0>m>>>0:0))))return R=2,be=we,R|0;he=P-F|0,P=Nt(P|0,0,52)|0,W=Pe()|0|E&-15728641,Q=R,y[Q>>2]=P|x,y[Q+4>>2]=W,Q=mt(x|0,E|0,45)|0,Pe()|0;e:do if(Ai(Q&127)|0){if(F|0)for(k=1;;){if(Q=Nt(7,0,(15-k|0)*3|0)|0,!((Q&x|0)==0&((Pe()|0)&E|0)==0))break e;if(k>>>0<F>>>0)k=k+1|0;else break}if((he|0)<1)return R=0,be=we,R|0;for(Q=F^15,E=-1,W=1,k=1;;){F=he-W|0,F=cs(7,0,F,((F|0)<0)<<31>>31)|0,x=Pe()|0;do if(k)if(k=Tt(F|0,x|0,5,0)|0,k=Ge(k|0,Pe()|0,-5,-1)|0,k=Mt(k|0,Pe()|0,6,0)|0,P=Pe()|0,(A|0)>(P|0)|(A|0)==(P|0)&m>>>0>k>>>0){A=Ge(m|0,A|0,-1,-1)|0,A=Ze(A|0,Pe()|0,k|0,P|0)|0,k=Pe()|0,$e=R,Ue=y[$e>>2]|0,$e=y[$e+4>>2]|0,nt=(Q+E|0)*3|0,Qe=Nt(7,0,nt|0)|0,$e=$e&~(Pe()|0),E=Mt(A|0,k|0,F|0,x|0)|0,m=Pe()|0,P=Ge(E|0,m|0,2,0)|0,nt=Nt(P|0,Pe()|0,nt|0)|0,$e=Pe()|0|$e,P=R,y[P>>2]=nt|Ue&~Qe,y[P+4>>2]=$e,m=Tt(E|0,m|0,F|0,x|0)|0,m=Ze(A|0,k|0,m|0,Pe()|0)|0,k=0,A=Pe()|0;break}else{nt=R,Qe=y[nt>>2]|0,nt=y[nt+4>>2]|0,Ue=Nt(7,0,(Q+E|0)*3|0)|0,nt=nt&~(Pe()|0),k=R,y[k>>2]=Qe&~Ue,y[k+4>>2]=nt,k=1;break}else Qe=R,P=y[Qe>>2]|0,Qe=y[Qe+4>>2]|0,E=(Q+E|0)*3|0,$e=Nt(7,0,E|0)|0,Qe=Qe&~(Pe()|0),nt=Mt(m|0,A|0,F|0,x|0)|0,k=Pe()|0,E=Nt(nt|0,k|0,E|0)|0,Qe=Pe()|0|Qe,Ue=R,y[Ue>>2]=E|P&~$e,y[Ue+4>>2]=Qe,k=Tt(nt|0,k|0,F|0,x|0)|0,m=Ze(m|0,A|0,k|0,Pe()|0)|0,k=0,A=Pe()|0;while(!1);if((he|0)>(W|0))E=~W,W=W+1|0;else{A=0;break}}return be=we,A|0}while(!1);if((he|0)<1)return nt=0,be=we,nt|0;for(P=F^15,k=1;;)if(Ue=he-k|0,Ue=cs(7,0,Ue,((Ue|0)<0)<<31>>31)|0,nt=Pe()|0,W=R,x=y[W>>2]|0,W=y[W+4>>2]|0,F=(P-k|0)*3|0,E=Nt(7,0,F|0)|0,W=W&~(Pe()|0),$e=Mt(m|0,A|0,Ue|0,nt|0)|0,Qe=Pe()|0,F=Nt($e|0,Qe|0,F|0)|0,W=Pe()|0|W,Q=R,y[Q>>2]=F|x&~E,y[Q+4>>2]=W,nt=Tt($e|0,Qe|0,Ue|0,nt|0)|0,m=Ze(m|0,A|0,nt|0,Pe()|0)|0,A=Pe()|0,(he|0)<=(k|0)){A=0;break}else k=k+1|0;return be=we,A|0}function Nd(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0;P=mt(A|0,x|0,52)|0,Pe()|0,P=P&15,(A|0)==0&(x|0)==0|((E|0)>15|(P|0)>(E|0))?(E=-1,P=-1,A=0,x=0):(R=zc(A,x,P+1|0,E)|0,x=(Pe()|0)&-15728641,A=Nt(E|0,0,52)|0,A=R|A,x=x|(Pe()|0),R=(Vi(A,x)|0)==0,E=R?-1:E),R=m,y[R>>2]=A,y[R+4>>2]=x,y[m+8>>2]=P,y[m+12>>2]=E}function IA(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0,W=0,Q=0;if(x=m,A=y[x>>2]|0,x=y[x+4>>2]|0,!((A|0)==0&(x|0)==0)&&(E=mt(A|0,x|0,52)|0,Pe()|0,E=E&15,F=Nt(1,0,(E^15)*3|0)|0,A=Ge(F|0,Pe()|0,A|0,x|0)|0,x=Pe()|0,F=m,y[F>>2]=A,y[F+4>>2]=x,F=m+8|0,k=y[F>>2]|0,!((E|0)<(k|0)))){for(W=m+12|0,R=E;;){if((R|0)==(k|0)){E=5;break}if(Q=(R|0)==(y[W>>2]|0),P=(15-R|0)*3|0,E=mt(A|0,x|0,P|0)|0,Pe()|0,E=E&7,Q&((E|0)==1&!0)){E=7;break}if(!((E|0)==7&!0)){E=10;break}if(Q=Nt(1,0,P|0)|0,A=Ge(A|0,x|0,Q|0,Pe()|0)|0,x=Pe()|0,Q=m,y[Q>>2]=A,y[Q+4>>2]=x,(R|0)>(k|0))R=R+-1|0;else{E=10;break}}if((E|0)==5){Q=m,y[Q>>2]=0,y[Q+4>>2]=0,y[F>>2]=-1,y[W>>2]=-1;return}else if((E|0)==7){k=Nt(1,0,P|0)|0,k=Ge(A|0,x|0,k|0,Pe()|0)|0,F=Pe()|0,Q=m,y[Q>>2]=k,y[Q+4>>2]=F,y[W>>2]=R+-1;return}else if((E|0)==10)return}}function ql(m){m=+m;var A=0;return A=m<0?m+6.283185307179586:m,+(m>=6.283185307179586?A+-6.283185307179586:A)}function rl(m,A){return m=m|0,A=A|0,+Ui(+(+Ee[m>>3]-+Ee[A>>3]))<17453292519943298e-27?(A=+Ui(+(+Ee[m+8>>3]-+Ee[A+8>>3]))<17453292519943298e-27,A|0):(A=0,A|0)}function zd(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0;return P=+Ee[A>>3],E=+Ee[m>>3],R=+Si(+((P-E)*.5)),x=+Si(+((+Ee[A+8>>3]-+Ee[m+8>>3])*.5)),x=R*R+x*(+vi(+P)*+vi(+E)*x),+(+_o(+ +dn(+x),+ +dn(+(1-x)))*2)}function jc(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0;return P=+Ee[A>>3],E=+Ee[m>>3],R=+Si(+((P-E)*.5)),x=+Si(+((+Ee[A+8>>3]-+Ee[m+8>>3])*.5)),x=R*R+x*(+vi(+P)*+vi(+E)*x),+(+_o(+ +dn(+x),+ +dn(+(1-x)))*2*6371.007180918475)}function Ud(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0;return P=+Ee[A>>3],E=+Ee[m>>3],R=+Si(+((P-E)*.5)),x=+Si(+((+Ee[A+8>>3]-+Ee[m+8>>3])*.5)),x=R*R+x*(+vi(+P)*+vi(+E)*x),+(+_o(+ +dn(+x),+ +dn(+(1-x)))*2*6371.007180918475*1e3)}function Wm(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0;return R=+Ee[A>>3],E=+vi(+R),P=+Ee[A+8>>3]-+Ee[m+8>>3],k=E*+Si(+P),x=+Ee[m>>3],+ +_o(+k,+(+Si(+R)*+vi(+x)-+vi(+P)*(E*+Si(+x))))}function $m(m,A,x,E){m=m|0,A=+A,x=+x,E=E|0;var P=0,R=0,k=0,F=0;if(x<1e-16){y[E>>2]=y[m>>2],y[E+4>>2]=y[m+4>>2],y[E+8>>2]=y[m+8>>2],y[E+12>>2]=y[m+12>>2];return}R=A<0?A+6.283185307179586:A,R=A>=6.283185307179586?R+-6.283185307179586:R;do if(R<1e-16)A=+Ee[m>>3]+x,Ee[E>>3]=A,P=E;else{if(P=+Ui(+(R+-3.141592653589793))<1e-16,A=+Ee[m>>3],P){A=A-x,Ee[E>>3]=A,P=E;break}if(k=+vi(+x),x=+Si(+x),A=k*+Si(+A)+ +vi(+R)*(x*+vi(+A)),A=A>1?1:A,A=+Ll(+(A<-1?-1:A)),Ee[E>>3]=A,+Ui(+(A+-1.5707963267948966))<1e-16){Ee[E>>3]=1.5707963267948966,Ee[E+8>>3]=0;return}if(+Ui(+(A+1.5707963267948966))<1e-16){Ee[E>>3]=-1.5707963267948966,Ee[E+8>>3]=0;return}if(F=+vi(+A),R=x*+Si(+R)/F,x=+Ee[m>>3],A=(k-+Si(+A)*+Si(+x))/+vi(+x)/F,k=R>1?1:R,A=A>1?1:A,A=+Ee[m+8>>3]+ +_o(+(k<-1?-1:k),+(A<-1?-1:A)),A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);Ee[E+8>>3]=A;return}while(!1);if(+Ui(+(A+-1.5707963267948966))<1e-16){Ee[P>>3]=1.5707963267948966,Ee[E+8>>3]=0;return}if(+Ui(+(A+1.5707963267948966))<1e-16){Ee[P>>3]=-1.5707963267948966,Ee[E+8>>3]=0;return}if(A=+Ee[m+8>>3],A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);Ee[E+8>>3]=A}function Pa(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20528+(m<<3)>>3],A=0,A|0)}function an(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20656+(m<<3)>>3],A=0,A|0)}function Xu(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20784+(m<<3)>>3],A=0,A|0)}function df(m,A){return m=m|0,A=A|0,m>>>0>15?(A=4,A|0):(Ee[A>>3]=+Ee[20912+(m<<3)>>3],A=0,A|0)}function Zl(m,A){m=m|0,A=A|0;var x=0;return m>>>0>15?(A=4,A|0):(x=cs(7,0,m,((m|0)<0)<<31>>31)|0,x=Tt(x|0,Pe()|0,120,0)|0,m=Pe()|0,y[A>>2]=x|2,y[A+4>>2]=m,A=0,A|0)}function Vd(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0;return $e=+Ee[A>>3],he=+Ee[m>>3],W=+Si(+(($e-he)*.5)),R=+Ee[A+8>>3],Q=+Ee[m+8>>3],k=+Si(+((R-Q)*.5)),F=+vi(+he),we=+vi(+$e),k=W*W+k*(we*F*k),k=+_o(+ +dn(+k),+ +dn(+(1-k)))*2,W=+Ee[x>>3],$e=+Si(+((W-$e)*.5)),E=+Ee[x+8>>3],R=+Si(+((E-R)*.5)),P=+vi(+W),R=$e*$e+R*(we*P*R),R=+_o(+ +dn(+R),+ +dn(+(1-R)))*2,W=+Si(+((he-W)*.5)),E=+Si(+((Q-E)*.5)),E=W*W+E*(F*P*E),E=+_o(+ +dn(+E),+ +dn(+(1-E)))*2,P=(k+R+E)*.5,+(+Pc(+ +dn(+(+Ic(+(P*.5))*+Ic(+((P-k)*.5))*+Ic(+((P-R)*.5))*+Ic(+((P-E)*.5)))))*4)}function Gc(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0;if(F=be,be=be+192|0,R=F+168|0,k=F,P=Uc(m,A,R)|0,P|0)return x=P,be=F,x|0;if(jo(m,A,k)|0&&Fr(23313,22742,386,22751),A=y[k>>2]|0,(A|0)>0){if(E=+Vd(k+8|0,k+8+(((A|0)!=1&1)<<4)|0,R)+0,(A|0)!=1){m=1;do P=m,m=m+1|0,E=E+ +Vd(k+8+(P<<4)|0,k+8+(((m|0)%(A|0)|0)<<4)|0,R);while((m|0)<(A|0))}}else E=0;return Ee[x>>3]=E,x=0,be=F,x|0}function qm(m,A,x){return m=m|0,A=A|0,x=x|0,m=Gc(m,A,x)|0,m|0||(Ee[x>>3]=+Ee[x>>3]*6371.007180918475*6371.007180918475),m|0}function ha(m,A,x){return m=m|0,A=A|0,x=x|0,m=Gc(m,A,x)|0,m|0||(Ee[x>>3]=+Ee[x>>3]*6371.007180918475*6371.007180918475*1e3*1e3),m|0}function Yu(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0;if(F=be,be=be+176|0,k=F,m=Wl(m,A,k)|0,m|0)return k=m,be=F,k|0;if(Ee[x>>3]=0,m=y[k>>2]|0,(m|0)<=1)return k=0,be=F,k|0;A=m+-1|0,m=0,E=+Ee[k+8>>3],P=+Ee[k+16>>3],R=0;do m=m+1|0,Q=E,E=+Ee[k+8+(m<<4)>>3],he=+Si(+((E-Q)*.5)),W=P,P=+Ee[k+8+(m<<4)+8>>3],W=+Si(+((P-W)*.5)),W=he*he+W*(+vi(+E)*+vi(+Q)*W),R=R+ +_o(+ +dn(+W),+ +dn(+(1-W)))*2;while((m|0)<(A|0));return Ee[x>>3]=R,k=0,be=F,k|0}function yr(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0;if(F=be,be=be+176|0,k=F,m=Wl(m,A,k)|0,m|0)return k=m,R=+Ee[x>>3],R=R*6371.007180918475,Ee[x>>3]=R,be=F,k|0;if(Ee[x>>3]=0,m=y[k>>2]|0,(m|0)<=1)return k=0,R=0,R=R*6371.007180918475,Ee[x>>3]=R,be=F,k|0;A=m+-1|0,m=0,E=+Ee[k+8>>3],P=+Ee[k+16>>3],R=0;do m=m+1|0,Q=E,E=+Ee[k+8+(m<<4)>>3],he=+Si(+((E-Q)*.5)),W=P,P=+Ee[k+8+(m<<4)+8>>3],W=+Si(+((P-W)*.5)),W=he*he+W*(+vi(+Q)*+vi(+E)*W),R=R+ +_o(+ +dn(+W),+ +dn(+(1-W)))*2;while((m|0)!=(A|0));return Ee[x>>3]=R,k=0,he=R,he=he*6371.007180918475,Ee[x>>3]=he,be=F,k|0}function Mr(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0;if(F=be,be=be+176|0,k=F,m=Wl(m,A,k)|0,m|0)return k=m,R=+Ee[x>>3],R=R*6371.007180918475,R=R*1e3,Ee[x>>3]=R,be=F,k|0;if(Ee[x>>3]=0,m=y[k>>2]|0,(m|0)<=1)return k=0,R=0,R=R*6371.007180918475,R=R*1e3,Ee[x>>3]=R,be=F,k|0;A=m+-1|0,m=0,E=+Ee[k+8>>3],P=+Ee[k+16>>3],R=0;do m=m+1|0,Q=E,E=+Ee[k+8+(m<<4)>>3],he=+Si(+((E-Q)*.5)),W=P,P=+Ee[k+8+(m<<4)+8>>3],W=+Si(+((P-W)*.5)),W=he*he+W*(+vi(+Q)*+vi(+E)*W),R=R+ +_o(+ +dn(+W),+ +dn(+(1-W)))*2;while((m|0)!=(A|0));return Ee[x>>3]=R,k=0,he=R,he=he*6371.007180918475,he=he*1e3,Ee[x>>3]=he,be=F,k|0}function pf(m){m=m|0;var A=0,x=0,E=0;return A=qe(1,12)|0,A||Fr(22832,22787,49,22845),x=m+4|0,E=y[x>>2]|0,E|0?(E=E+8|0,y[E>>2]=A,y[x>>2]=A,A|0):(y[m>>2]|0&&Fr(22862,22787,61,22885),E=m,y[E>>2]=A,y[x>>2]=A,A|0)}function jd(m,A){m=m|0,A=A|0;var x=0,E=0;return E=Ve(24)|0,E||Fr(22899,22787,78,22913),y[E>>2]=y[A>>2],y[E+4>>2]=y[A+4>>2],y[E+8>>2]=y[A+8>>2],y[E+12>>2]=y[A+12>>2],y[E+16>>2]=0,A=m+4|0,x=y[A>>2]|0,x|0?(y[x+16>>2]=E,y[A>>2]=E,E|0):(y[m>>2]|0&&Fr(22928,22787,82,22913),y[m>>2]=E,y[A>>2]=E,E|0)}function Af(m){m=m|0;var A=0,x=0,E=0,P=0;if(m)for(E=1;;){if(A=y[m>>2]|0,A|0)do{if(x=y[A>>2]|0,x|0)do P=x,x=y[x+16>>2]|0,Be(P);while(x|0);P=A,A=y[A+8>>2]|0,Be(P)}while(A|0);if(A=m,m=y[m+8>>2]|0,E||Be(A),m)E=0;else break}}function to(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0,lr=0,di=0,ti=0,ii=0,Hr=0,Ur=0,jr=0,Ni=0,Wr=0;if(P=m+8|0,y[P>>2]|0)return Wr=1,Wr|0;if(E=y[m>>2]|0,!E)return Wr=0,Wr|0;A=E,x=0;do x=x+1|0,A=y[A+8>>2]|0;while(A|0);if(x>>>0<2)return Wr=0,Wr|0;jr=Ve(x<<2)|0,jr||Fr(22948,22787,317,22967),Ur=Ve(x<<5)|0,Ur||Fr(22989,22787,321,22967),y[m>>2]=0,mr=m+4|0,y[mr>>2]=0,y[P>>2]=0,x=0,Hr=0,ar=0,we=0;e:for(;;){if(he=y[E>>2]|0,he){R=0,k=he;do{if(W=+Ee[k+8>>3],A=k,k=y[k+16>>2]|0,Q=(k|0)==0,P=Q?he:k,F=+Ee[P+8>>3],+Ui(+(W-F))>3.141592653589793){Wr=14;break}R=R+(F-W)*(+Ee[A>>3]+ +Ee[P>>3])}while(!Q);if((Wr|0)==14){Wr=0,R=0,A=he;do ft=+Ee[A+8>>3],ii=A+16|0,ti=y[ii>>2]|0,ti=ti|0?ti:he,bt=+Ee[ti+8>>3],R=R+(+Ee[A>>3]+ +Ee[ti>>3])*((bt<0?bt+6.283185307179586:bt)-(ft<0?ft+6.283185307179586:ft)),A=y[(A|0?ii:E)>>2]|0;while(A|0)}R>0?(y[jr+(Hr<<2)>>2]=E,Hr=Hr+1|0,P=ar,A=we):Wr=19}else Wr=19;if((Wr|0)==19){Wr=0;do if(x){if(A=x+8|0,y[A>>2]|0){Wr=21;break e}if(x=qe(1,12)|0,!x){Wr=23;break e}y[A>>2]=x,P=x+4|0,k=x,A=we}else if(we){P=mr,k=we+8|0,A=E,x=m;break}else if(y[m>>2]|0){Wr=27;break e}else{P=mr,k=m,A=E,x=m;break}while(!1);if(y[k>>2]=E,y[P>>2]=E,k=Ur+(ar<<5)|0,Q=y[E>>2]|0,Q){for(he=Ur+(ar<<5)+8|0,Ee[he>>3]=17976931348623157e292,we=Ur+(ar<<5)+24|0,Ee[we>>3]=17976931348623157e292,Ee[k>>3]=-17976931348623157e292,$e=Ur+(ar<<5)+16|0,Ee[$e>>3]=-17976931348623157e292,wt=17976931348623157e292,at=-17976931348623157e292,P=0,Qe=Q,W=17976931348623157e292,nt=17976931348623157e292,It=-17976931348623157e292,F=-17976931348623157e292;R=+Ee[Qe>>3],ft=+Ee[Qe+8>>3],Qe=y[Qe+16>>2]|0,Ue=(Qe|0)==0,bt=+Ee[(Ue?Q:Qe)+8>>3],R<W&&(Ee[he>>3]=R,W=R),ft<nt&&(Ee[we>>3]=ft,nt=ft),R>It?Ee[k>>3]=R:R=It,ft>F&&(Ee[$e>>3]=ft,F=ft),wt=ft>0&ft<wt?ft:wt,at=ft<0&ft>at?ft:at,P=P|+Ui(+(ft-bt))>3.141592653589793,!Ue;)It=R;P&&(Ee[$e>>3]=at,Ee[we>>3]=wt)}else y[k>>2]=0,y[k+4>>2]=0,y[k+8>>2]=0,y[k+12>>2]=0,y[k+16>>2]=0,y[k+20>>2]=0,y[k+24>>2]=0,y[k+28>>2]=0;P=ar+1|0}if(ii=E+8|0,E=y[ii>>2]|0,y[ii>>2]=0,E)ar=P,we=A;else{Wr=45;break}}if((Wr|0)==21)Fr(22765,22787,35,22799);else if((Wr|0)==23)Fr(22819,22787,37,22799);else if((Wr|0)==27)Fr(22862,22787,61,22885);else if((Wr|0)==45){e:do if((Hr|0)>0){for(ii=(P|0)==0,di=P<<2,ti=(m|0)==0,lr=0,A=0;;){if(sr=y[jr+(lr<<2)>>2]|0,ii)Wr=73;else{if(ar=Ve(di)|0,!ar){Wr=50;break}if(mr=Ve(di)|0,!mr){Wr=52;break}t:do if(ti)x=0;else{for(P=0,x=0,k=m;E=Ur+(P<<5)|0,Gd(y[k>>2]|0,E,y[sr>>2]|0)|0?(y[ar+(x<<2)>>2]=k,y[mr+(x<<2)>>2]=E,Ue=x+1|0):Ue=x,k=y[k+8>>2]|0,k;)P=P+1|0,x=Ue;if((Ue|0)>0)if(E=y[ar>>2]|0,(Ue|0)==1)x=E;else for($e=0,Qe=-1,x=E,we=E;;){for(Q=y[we>>2]|0,E=0,k=0;P=y[y[ar+(k<<2)>>2]>>2]|0,(P|0)==(Q|0)?he=E:he=E+((Gd(P,y[mr+(k<<2)>>2]|0,y[Q>>2]|0)|0)&1)|0,k=k+1|0,(k|0)!=(Ue|0);)E=he;if(P=(he|0)>(Qe|0),x=P?we:x,E=$e+1|0,(E|0)==(Ue|0))break t;$e=E,Qe=P?he:Qe,we=y[ar+(E<<2)>>2]|0}else x=0}while(!1);if(Be(ar),Be(mr),x){if(P=x+4|0,E=y[P>>2]|0,E)x=E+8|0;else if(y[x>>2]|0){Wr=70;break}y[x>>2]=sr,y[P>>2]=sr}else Wr=73}if((Wr|0)==73){if(Wr=0,A=y[sr>>2]|0,A|0)do mr=A,A=y[A+16>>2]|0,Be(mr);while(A|0);Be(sr),A=1}if(lr=lr+1|0,(lr|0)>=(Hr|0)){Ni=A;break e}}(Wr|0)==50?Fr(23004,22787,249,23023):(Wr|0)==52?Fr(23042,22787,252,23023):(Wr|0)==70&&Fr(22862,22787,61,22885)}else Ni=0;while(!1);return Be(jr),Be(Ur),Wr=Ni,Wr|0}return 0}function Gd(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0;if(!(Id(A,x)|0)||(A=Ul(A)|0,E=+Ee[x>>3],P=+Ee[x+8>>3],P=A&P<0?P+6.283185307179586:P,m=y[m>>2]|0,!m))return m=0,m|0;if(A){A=0,Q=P,x=m;e:for(;;){for(;k=+Ee[x>>3],P=+Ee[x+8>>3],x=x+16|0,he=y[x>>2]|0,he=he|0?he:m,R=+Ee[he>>3],F=+Ee[he+8>>3],k>R?(W=k,k=F):(W=R,R=k,k=P,P=F),E=E==R|E==W?E+2220446049250313e-31:E,!!(E<R|E>W);)if(x=y[x>>2]|0,!x){x=22;break e}if(F=k<0?k+6.283185307179586:k,k=P<0?P+6.283185307179586:P,Q=F==Q|k==Q?Q+-2220446049250313e-31:Q,W=F+(k-F)*((E-R)/(W-R)),(W<0?W+6.283185307179586:W)>Q&&(A=A^1),x=y[x>>2]|0,!x){x=22;break}}if((x|0)==22)return A|0}else{A=0,Q=P,x=m;e:for(;;){for(;k=+Ee[x>>3],P=+Ee[x+8>>3],x=x+16|0,he=y[x>>2]|0,he=he|0?he:m,R=+Ee[he>>3],F=+Ee[he+8>>3],k>R?(W=k,k=F):(W=R,R=k,k=P,P=F),E=E==R|E==W?E+2220446049250313e-31:E,!!(E<R|E>W);)if(x=y[x>>2]|0,!x){x=22;break e}if(Q=k==Q|P==Q?Q+-2220446049250313e-31:Q,k+(P-k)*((E-R)/(W-R))>Q&&(A=A^1),x=y[x>>2]|0,!x){x=22;break}}if((x|0)==22)return A|0}return 0}function Sn(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0;if(at=be,be=be+32|0,wt=at+16|0,It=at,R=mt(m|0,A|0,52)|0,Pe()|0,R=R&15,Qe=mt(x|0,E|0,52)|0,Pe()|0,(R|0)!=(Qe&15|0))return wt=12,be=at,wt|0;if(Q=mt(m|0,A|0,45)|0,Pe()|0,Q=Q&127,he=mt(x|0,E|0,45)|0,Pe()|0,he=he&127,Q>>>0>121|he>>>0>121)return wt=5,be=at,wt|0;if(Qe=(Q|0)!=(he|0),Qe){if(F=Rc(Q,he)|0,(F|0)==7)return wt=1,be=at,wt|0;W=Rc(he,Q)|0,(W|0)==7?Fr(23066,23090,161,23100):(Ue=F,k=W)}else Ue=0,k=0;we=Ai(Q)|0,$e=Ai(he)|0,y[wt>>2]=0,y[wt+4>>2]=0,y[wt+8>>2]=0,y[wt+12>>2]=0;do if(Ue){if(he=y[4272+(Q*28|0)+(Ue<<2)>>2]|0,F=(he|0)>0,$e)if(F){Q=0,W=x,F=E;do W=Hm(W,F)|0,F=Pe()|0,k=ca(k)|0,(k|0)==1&&(k=ca(1)|0),Q=Q+1|0;while((Q|0)!=(he|0));he=k,Q=W,W=F}else he=k,Q=x,W=E;else if(F){Q=0,W=x,F=E;do W=el(W,F)|0,F=Pe()|0,k=ca(k)|0,Q=Q+1|0;while((Q|0)!=(he|0));he=k,Q=W,W=F}else he=k,Q=x,W=E;if(hf(Q,W,wt)|0,Qe||Fr(23115,23090,191,23100),F=(we|0)!=0,k=($e|0)!=0,F&k&&Fr(23142,23090,192,23100),F){if(k=Es(m,A)|0,(k|0)==7){R=5;break}if(Br[21872+(k*7|0)+Ue>>0]|0){R=1;break}W=y[21040+(k*28|0)+(Ue<<2)>>2]|0,Q=W}else if(k){if(k=Es(Q,W)|0,(k|0)==7){R=5;break}if(Br[21872+(k*7|0)+he>>0]|0){R=1;break}Q=0,W=y[21040+(he*28|0)+(k<<2)>>2]|0}else Q=0,W=0;if((Q|W|0)<0)R=5;else{if((W|0)>0){F=wt+4|0,k=0;do Vl(F),k=k+1|0;while((k|0)!=(W|0))}if(y[It>>2]=0,y[It+4>>2]=0,y[It+8>>2]=0,Hu(It,Ue),R|0)for(;yn(R)|0?Oc(It):Ka(It),(R|0)>1;)R=R+-1|0;if((Q|0)>0){R=0;do Vl(It),R=R+1|0;while((R|0)!=(Q|0))}nt=wt+4|0,zs(nt,It,nt),ls(nt),nt=51}}else if(hf(x,E,wt)|0,(we|0)!=0&($e|0)!=0)if((he|0)!=(Q|0)&&Fr(23173,23090,261,23100),k=Es(m,A)|0,R=Es(x,E)|0,(k|0)==7|(R|0)==7)R=5;else if(Br[21872+(k*7|0)+R>>0]|0)R=1;else if(k=y[21040+(k*28|0)+(R<<2)>>2]|0,(k|0)>0){F=wt+4|0,R=0;do Vl(F),R=R+1|0;while((R|0)!=(k|0));nt=51}else nt=51;else nt=51;while(!1);return(nt|0)==51&&(R=wt+4|0,y[P>>2]=y[R>>2],y[P+4>>2]=y[R+4>>2],y[P+8>>2]=y[R+8>>2],R=0),wt=R,be=at,wt|0}function PA(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0;if(nt=be,be=be+48|0,Q=nt+36|0,k=nt+24|0,F=nt+12|0,W=nt,P=mt(m|0,A|0,52)|0,Pe()|0,P=P&15,$e=mt(m|0,A|0,45)|0,Pe()|0,$e=$e&127,$e>>>0>121)return E=5,be=nt,E|0;if(he=Ai($e)|0,Nt(P|0,0,52)|0,It=Pe()|0|134225919,R=E,y[R>>2]=-1,y[R+4>>2]=It,!P)return P=ef(x)|0,(P|0)==7||(P=zl($e,P)|0,(P|0)==127)?(It=1,be=nt,It|0):(Qe=Nt(P|0,0,45)|0,Ue=Pe()|0,$e=E,Ue=y[$e+4>>2]&-1040385|Ue,It=E,y[It>>2]=y[$e>>2]|Qe,y[It+4>>2]=Ue,It=0,be=nt,It|0);for(y[Q>>2]=y[x>>2],y[Q+4>>2]=y[x+4>>2],y[Q+8>>2]=y[x+8>>2],x=P;;){if(R=x,x=x+-1|0,y[k>>2]=y[Q>>2],y[k+4>>2]=y[Q+4>>2],y[k+8>>2]=y[Q+8>>2],yn(R)|0){if(P=Lc(Q)|0,P|0){x=13;break}y[F>>2]=y[Q>>2],y[F+4>>2]=y[Q+4>>2],y[F+8>>2]=y[Q+8>>2],Oc(F)}else{if(P=Gu(Q)|0,P|0){x=13;break}y[F>>2]=y[Q>>2],y[F+4>>2]=y[Q+4>>2],y[F+8>>2]=y[Q+8>>2],Ka(F)}if(Jh(k,F,W),ls(W),P=E,at=y[P>>2]|0,P=y[P+4>>2]|0,bt=(15-R|0)*3|0,wt=Nt(7,0,bt|0)|0,P=P&~(Pe()|0),bt=Nt(ef(W)|0,0,bt|0)|0,P=Pe()|0|P,It=E,y[It>>2]=bt|at&~wt,y[It+4>>2]=P,(R|0)<=1){x=14;break}}e:do if((x|0)!=13&&(x|0)==14)if((y[Q>>2]|0)<=1&&(y[Q+4>>2]|0)<=1&&(y[Q+8>>2]|0)<=1){x=ef(Q)|0,P=zl($e,x)|0,(P|0)==127?W=0:W=Ai(P)|0;t:do if(x){if(he){if(P=Es(m,A)|0,(P|0)==7){P=5;break e}if(R=y[21248+(P*28|0)+(x<<2)>>2]|0,(R|0)>0){P=x,x=0;do P=jl(P)|0,x=x+1|0;while((x|0)!=(R|0))}else P=x;if((P|0)==1){P=9;break e}x=zl($e,P)|0,(x|0)==127&&Fr(23200,23090,411,23230),Ai(x)|0?Fr(23245,23090,412,23230):(Ue=x,Qe=R,we=P)}else Ue=P,Qe=0,we=x;if(F=y[4272+($e*28|0)+(we<<2)>>2]|0,(F|0)<=-1&&Fr(23276,23090,419,23230),!W){if((Qe|0)<0){P=5;break e}if(Qe|0){R=E,P=0,x=y[R>>2]|0,R=y[R+4>>2]|0;do x=Ia(x,R)|0,R=Pe()|0,bt=E,y[bt>>2]=x,y[bt+4>>2]=R,P=P+1|0;while((P|0)<(Qe|0))}if((F|0)<=0){P=Ue,x=58;break}for(R=E,P=0,x=y[R>>2]|0,R=y[R+4>>2]|0;;)if(x=Ia(x,R)|0,R=Pe()|0,bt=E,y[bt>>2]=x,y[bt+4>>2]=R,P=P+1|0,(P|0)==(F|0)){P=Ue,x=58;break t}}if(k=Rc(Ue,$e)|0,(k|0)==7&&Fr(23066,23090,428,23230),P=E,x=y[P>>2]|0,P=y[P+4>>2]|0,(F|0)>0){R=0;do x=Ia(x,P)|0,P=Pe()|0,bt=E,y[bt>>2]=x,y[bt+4>>2]=P,R=R+1|0;while((R|0)!=(F|0))}if(P=Es(x,P)|0,(P|0)==7&&Fr(23313,23090,440,23230),x=Xh(Ue)|0,x=y[(x?21664:21456)+(k*28|0)+(P<<2)>>2]|0,(x|0)<0&&Fr(23313,23090,454,23230),!x)P=Ue,x=58;else{k=E,P=0,R=y[k>>2]|0,k=y[k+4>>2]|0;do R=Fd(R,k)|0,k=Pe()|0,bt=E,y[bt>>2]=R,y[bt+4>>2]=k,P=P+1|0;while((P|0)<(x|0));P=Ue,x=58}}else if((he|0)!=0&(W|0)!=0){if(x=Es(m,A)|0,R=E,R=Es(y[R>>2]|0,y[R+4>>2]|0)|0,(x|0)==7|(R|0)==7){P=5;break e}if(R=y[21248+(x*28|0)+(R<<2)>>2]|0,(R|0)<0){P=5;break e}if(!R)x=59;else{F=E,x=0,k=y[F>>2]|0,F=y[F+4>>2]|0;do k=Ia(k,F)|0,F=Pe()|0,bt=E,y[bt>>2]=k,y[bt+4>>2]=F,x=x+1|0;while((x|0)<(R|0));x=58}}else x=58;while(!1);if((x|0)==58&&W&&(x=59),(x|0)==59&&(bt=E,(Es(y[bt>>2]|0,y[bt+4>>2]|0)|0)==1)){P=9;break}bt=E,wt=y[bt>>2]|0,bt=y[bt+4>>2]&-1040385,at=Nt(P|0,0,45)|0,bt=bt|(Pe()|0),P=E,y[P>>2]=wt|at,y[P+4>>2]=bt,P=0}else P=1;while(!1);return bt=P,be=nt,bt|0}function Ku(m,A,x,E,P,R){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0,R=R|0;var k=0,F=0;return F=be,be=be+16|0,k=F,P?m=15:(m=Sn(m,A,x,E,k)|0,m||(sf(k,R),m=0)),be=F,m|0}function Cn(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0;return k=be,be=be+16|0,R=k,E?x=15:(x=of(x,R)|0,x||(x=PA(m,A,R,P)|0)),be=k,x|0}function Bn(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0;return W=be,be=be+32|0,k=W+12|0,F=W,R=Sn(m,A,m,A,k)|0,R|0?(F=R,be=W,F|0):(m=Sn(m,A,x,E,F)|0,m|0?(F=m,be=W,F|0):(k=Gl(k,F)|0,F=P,y[F>>2]=k,y[F+4>>2]=((k|0)<0)<<31>>31,F=0,be=W,F|0))}function MA(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0;return W=be,be=be+32|0,k=W+12|0,F=W,R=Sn(m,A,m,A,k)|0,!R&&(R=Sn(m,A,x,E,F)|0,!R)?(E=Gl(k,F)|0,E=Ge(E|0,((E|0)<0)<<31>>31|0,1,0)|0,k=Pe()|0,F=P,y[F>>2]=E,y[F+4>>2]=k,F=0,be=W,F|0):(F=R,be=W,F|0)}function Qu(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0,lr=0;if(sr=be,be=be+48|0,k=sr+24|0,F=sr+12|0,mr=sr,R=Sn(m,A,m,A,k)|0,!R&&(R=Sn(m,A,x,E,F)|0,!R)){ft=Gl(k,F)|0,ar=((ft|0)<0)<<31>>31,y[k>>2]=0,y[k+4>>2]=0,y[k+8>>2]=0,y[F>>2]=0,y[F+4>>2]=0,y[F+8>>2]=0,Sn(m,A,m,A,k)|0&&Fr(23313,23090,691,23299),Sn(m,A,x,E,F)|0&&Fr(23313,23090,696,23299),Wu(k),Wu(F),ft?(we=y[k>>2]|0,Ue=+(ft|0),wt=k+4|0,$e=y[wt>>2]|0,at=k+8|0,Qe=y[at>>2]|0,bt=k,E=we,R=$e,x=Qe,nt=+((y[F>>2]|0)-we|0)/Ue,It=+((y[F+4>>2]|0)-$e|0)/Ue,Ue=+((y[F+8>>2]|0)-Qe|0)/Ue):(R=k+4|0,x=k+8|0,wt=R,at=x,bt=k,E=y[k>>2]|0,R=y[R>>2]|0,x=y[x>>2]|0,nt=0,It=0,Ue=0),y[mr>>2]=E,Qe=mr+4|0,y[Qe>>2]=R,$e=mr+8|0,y[$e>>2]=x;e:do if((ft|0)<0)R=0;else for(he=0,we=0,R=E;;){Q=+(we>>>0)+4294967296*+(he|0),lr=nt*Q+ +(R|0),W=It*Q+ +(y[wt>>2]|0),Q=Ue*Q+ +(y[at>>2]|0),x=~~+ki(+lr),k=~~+ki(+W),R=~~+ki(+Q),lr=+Ui(+(+(x|0)-lr)),W=+Ui(+(+(k|0)-W)),Q=+Ui(+(+(R|0)-Q));do if(lr>W&lr>Q)x=0-(k+R)|0,E=k;else if(F=0-x|0,W>Q){E=F-R|0;break}else{E=k,R=F-k|0;break}while(!1);if(y[mr>>2]=x,y[Qe>>2]=E,y[$e>>2]=R,kc(mr),R=PA(m,A,mr,P+(we<<3)|0)|0,R|0)break e;if(!((he|0)<(ar|0)|(he|0)==(ar|0)&we>>>0<ft>>>0)){R=0;break e}R=Ge(we|0,he|0,1,0)|0,F=Pe()|0,he=F,we=R,R=y[bt>>2]|0}while(!1);return mr=R,be=sr,mr|0}return mr=R,be=sr,mr|0}function cs(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0;if((x|0)==0&(E|0)==0)return P=0,R=1,Yr(P|0),R|0;R=m,P=A,m=1,A=0;do k=(x&1|0)==0&!0,m=Tt((k?1:R)|0,(k?0:P)|0,m|0,A|0)|0,A=Pe()|0,x=Ut(x|0,E|0,1)|0,E=Pe()|0,R=Tt(R|0,P|0,R|0,P|0)|0,P=Pe()|0;while(!((x|0)==0&(E|0)==0));return Yr(A|0),m|0}function Ju(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0;if(!(Id(A,x)|0)||(A=Ul(A)|0,E=+Ee[x>>3],P=+Ee[x+8>>3],P=A&P<0?P+6.283185307179586:P,$e=y[m>>2]|0,($e|0)<=0))return $e=0,$e|0;if(we=y[m+4>>2]|0,A){A=0,he=P,x=-1,m=0;e:for(;;){for(Q=m;k=+Ee[we+(Q<<4)>>3],P=+Ee[we+(Q<<4)+8>>3],m=(x+2|0)%($e|0)|0,R=+Ee[we+(m<<4)>>3],F=+Ee[we+(m<<4)+8>>3],k>R?(W=k,k=F):(W=R,R=k,k=P,P=F),E=E==R|E==W?E+2220446049250313e-31:E,!!(E<R|E>W);)if(x=Q+1|0,(x|0)>=($e|0)){x=22;break e}else m=Q,Q=x,x=m;if(F=k<0?k+6.283185307179586:k,k=P<0?P+6.283185307179586:P,he=F==he|k==he?he+-2220446049250313e-31:he,W=F+(k-F)*((E-R)/(W-R)),(W<0?W+6.283185307179586:W)>he&&(A=A^1),m=Q+1|0,(m|0)>=($e|0)){x=22;break}else x=Q}if((x|0)==22)return A|0}else{A=0,he=P,x=-1,m=0;e:for(;;){for(Q=m;k=+Ee[we+(Q<<4)>>3],P=+Ee[we+(Q<<4)+8>>3],m=(x+2|0)%($e|0)|0,R=+Ee[we+(m<<4)>>3],F=+Ee[we+(m<<4)+8>>3],k>R?(W=k,k=F):(W=R,R=k,k=P,P=F),E=E==R|E==W?E+2220446049250313e-31:E,!!(E<R|E>W);)if(x=Q+1|0,(x|0)>=($e|0)){x=22;break e}else m=Q,Q=x,x=m;if(he=k==he|P==he?he+-2220446049250313e-31:he,k+(P-k)*((E-R)/(W-R))>he&&(A=A^1),m=Q+1|0,(m|0)>=($e|0)){x=22;break}else x=Q}if((x|0)==22)return A|0}return 0}function Hc(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0;if(Ue=y[m>>2]|0,!Ue){y[A>>2]=0,y[A+4>>2]=0,y[A+8>>2]=0,y[A+12>>2]=0,y[A+16>>2]=0,y[A+20>>2]=0,y[A+24>>2]=0,y[A+28>>2]=0;return}if(nt=A+8|0,Ee[nt>>3]=17976931348623157e292,It=A+24|0,Ee[It>>3]=17976931348623157e292,Ee[A>>3]=-17976931348623157e292,wt=A+16|0,Ee[wt>>3]=-17976931348623157e292,!((Ue|0)<=0)){for($e=y[m+4>>2]|0,Q=17976931348623157e292,he=-17976931348623157e292,we=0,m=-1,R=17976931348623157e292,k=17976931348623157e292,W=-17976931348623157e292,E=-17976931348623157e292,Qe=0;x=+Ee[$e+(Qe<<4)>>3],F=+Ee[$e+(Qe<<4)+8>>3],m=m+2|0,P=+Ee[$e+(((m|0)==(Ue|0)?0:m)<<4)+8>>3],x<R&&(Ee[nt>>3]=x,R=x),F<k&&(Ee[It>>3]=F,k=F),x>W?Ee[A>>3]=x:x=W,F>E&&(Ee[wt>>3]=F,E=F),Q=F>0&F<Q?F:Q,he=F<0&F>he?F:he,we=we|+Ui(+(F-P))>3.141592653589793,m=Qe+1|0,(m|0)!=(Ue|0);)at=Qe,W=x,Qe=m,m=at;we&&(Ee[wt>>3]=he,Ee[It>>3]=Q)}}function mf(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0,mr=0,sr=0;if(Ue=y[m>>2]|0,Ue){if(nt=A+8|0,Ee[nt>>3]=17976931348623157e292,It=A+24|0,Ee[It>>3]=17976931348623157e292,Ee[A>>3]=-17976931348623157e292,wt=A+16|0,Ee[wt>>3]=-17976931348623157e292,(Ue|0)>0){for(P=y[m+4>>2]|0,$e=17976931348623157e292,Qe=-17976931348623157e292,E=0,x=-1,W=17976931348623157e292,Q=17976931348623157e292,we=-17976931348623157e292,k=-17976931348623157e292,at=0;R=+Ee[P+(at<<4)>>3],he=+Ee[P+(at<<4)+8>>3],mr=x+2|0,F=+Ee[P+(((mr|0)==(Ue|0)?0:mr)<<4)+8>>3],R<W&&(Ee[nt>>3]=R,W=R),he<Q&&(Ee[It>>3]=he,Q=he),R>we?Ee[A>>3]=R:R=we,he>k&&(Ee[wt>>3]=he,k=he),$e=he>0&he<$e?he:$e,Qe=he<0&he>Qe?he:Qe,E=E|+Ui(+(he-F))>3.141592653589793,x=at+1|0,(x|0)!=(Ue|0);)mr=at,we=R,at=x,x=mr;E&&(Ee[wt>>3]=Qe,Ee[It>>3]=$e)}}else y[A>>2]=0,y[A+4>>2]=0,y[A+8>>2]=0,y[A+12>>2]=0,y[A+16>>2]=0,y[A+20>>2]=0,y[A+24>>2]=0,y[A+28>>2]=0;if(mr=m+8|0,x=y[mr>>2]|0,!((x|0)<=0)){ar=m+12|0,ft=0;do if(P=y[ar>>2]|0,E=ft,ft=ft+1|0,It=A+(ft<<5)|0,wt=y[P+(E<<3)>>2]|0,wt){if(at=A+(ft<<5)+8|0,Ee[at>>3]=17976931348623157e292,m=A+(ft<<5)+24|0,Ee[m>>3]=17976931348623157e292,Ee[It>>3]=-17976931348623157e292,bt=A+(ft<<5)+16|0,Ee[bt>>3]=-17976931348623157e292,(wt|0)>0){for(Ue=y[P+(E<<3)+4>>2]|0,$e=17976931348623157e292,Qe=-17976931348623157e292,P=0,E=-1,nt=0,W=17976931348623157e292,Q=17976931348623157e292,he=-17976931348623157e292,k=-17976931348623157e292;R=+Ee[Ue+(nt<<4)>>3],we=+Ee[Ue+(nt<<4)+8>>3],E=E+2|0,F=+Ee[Ue+(((E|0)==(wt|0)?0:E)<<4)+8>>3],R<W&&(Ee[at>>3]=R,W=R),we<Q&&(Ee[m>>3]=we,Q=we),R>he?Ee[It>>3]=R:R=he,we>k&&(Ee[bt>>3]=we,k=we),$e=we>0&we<$e?we:$e,Qe=we<0&we>Qe?we:Qe,P=P|+Ui(+(we-F))>3.141592653589793,E=nt+1|0,(E|0)!=(wt|0);)sr=nt,nt=E,he=R,E=sr;P&&(Ee[bt>>3]=Qe,Ee[m>>3]=$e)}}else y[It>>2]=0,y[It+4>>2]=0,y[It+8>>2]=0,y[It+12>>2]=0,y[It+16>>2]=0,y[It+20>>2]=0,y[It+24>>2]=0,y[It+28>>2]=0,x=y[mr>>2]|0;while((ft|0)<(x|0))}}function Xl(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;if(!(Ju(m,A,x)|0))return P=0,P|0;if(P=m+8|0,(y[P>>2]|0)<=0)return P=1,P|0;for(E=m+12|0,m=0;;){if(R=m,m=m+1|0,Ju((y[E>>2]|0)+(R<<3)|0,A+(m<<5)|0,x)|0){m=0,E=6;break}if((m|0)>=(y[P>>2]|0)){m=1,E=6;break}}return(E|0)==6?m|0:0}function Hd(){return 8}function Wc(){return 16}function Yl(){return 168}function Wd(){return 8}function gf(){return 16}function Kl(){return 12}function $d(){return 8}function qd(m){return m=m|0,+(+((y[m>>2]|0)>>>0)+4294967296*+(y[m+4>>2]|0))}function eh(m){m=m|0;var A=0,x=0;return x=+Ee[m>>3],A=+Ee[m+8>>3],+ +dn(+(x*x+A*A))}function _f(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0;Q=+Ee[m>>3],W=+Ee[A>>3]-Q,F=+Ee[m+8>>3],k=+Ee[A+8>>3]-F,we=+Ee[x>>3],R=+Ee[E>>3]-we,$e=+Ee[x+8>>3],he=+Ee[E+8>>3]-$e,R=(R*(F-$e)-(Q-we)*he)/(W*he-k*R),Ee[P>>3]=Q+W*R,Ee[P+8>>3]=F+k*R}function S(m,A){return m=m|0,A=A|0,+Ui(+(+Ee[m>>3]-+Ee[A>>3]))<11920928955078125e-23?(A=+Ui(+(+Ee[m+8>>3]-+Ee[A+8>>3]))<11920928955078125e-23,A|0):(A=0,A|0)}function o(m,A){m=m|0,A=A|0;var x=0,E=0,P=0;return P=+Ee[m>>3]-+Ee[A>>3],E=+Ee[m+8>>3]-+Ee[A+8>>3],x=+Ee[m+16>>3]-+Ee[A+16>>3],+(P*P+E*E+x*x)}function u(m,A){m=m|0,A=A|0;var x=0,E=0,P=0;x=+Ee[m>>3],E=+vi(+x),x=+Si(+x),Ee[A+16>>3]=x,x=+Ee[m+8>>3],P=E*+vi(+x),Ee[A>>3]=P,x=E*+Si(+x),Ee[A+8>>3]=x}function _(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;if(R=be,be=be+16|0,P=R,E=Vi(m,A)|0,(x+-1|0)>>>0>5||(E=(E|0)!=0,(x|0)==1&E))return P=-1,be=R,P|0;do if(v(m,A,P)|0)E=-1;else if(E){E=((y[21936+(x<<2)>>2]|0)+5-(y[P>>2]|0)|0)%5|0;break}else{E=((y[21968+(x<<2)>>2]|0)+6-(y[P>>2]|0)|0)%6|0;break}while(!1);return P=E,be=R,P|0}function v(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0,Q=0;if(Q=be,be=be+32|0,k=Q+16|0,F=Q,E=Vo(m,A,k)|0,E|0)return x=E,be=Q,x|0;R=kd(m,A)|0,W=Es(m,A)|0,Nl(R,F),E=Yh(R,y[k>>2]|0)|0;e:do if(Ai(R)|0){do switch(R|0){case 4:{m=0;break}case 14:{m=1;break}case 24:{m=2;break}case 38:{m=3;break}case 49:{m=4;break}case 58:{m=5;break}case 63:{m=6;break}case 72:{m=7;break}case 83:{m=8;break}case 97:{m=9;break}case 107:{m=10;break}case 117:{m=11;break}default:{E=1;break e}}while(!1);if(P=y[22e3+(m*24|0)+8>>2]|0,A=y[22e3+(m*24|0)+16>>2]|0,m=y[k>>2]|0,(m|0)!=(y[F>>2]|0)&&(F=Xh(R)|0,m=y[k>>2]|0,F|(m|0)==(A|0)&&(E=(E+1|0)%6|0)),(W|0)==3&(m|0)==(A|0)){E=(E+5|0)%6|0,P=22;break}(W|0)==5&(m|0)==(P|0)&&(E=(E+1|0)%6|0),P=22}else P=22;while(!1);return(P|0)==22&&(y[x>>2]=E,E=0),x=E,be=Q,x|0}function C(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0;if(bt=be,be=be+32|0,at=bt+24|0,It=bt+20|0,Ue=bt+8|0,Qe=bt+16|0,$e=bt,W=(Vi(m,A)|0)==0,W=W?6:5,he=mt(m|0,A|0,52)|0,Pe()|0,he=he&15,W>>>0<=x>>>0)return E=2,be=bt,E|0;we=(he|0)==0,!we&&(nt=Nt(7,0,(he^15)*3|0)|0,(nt&m|0)==0&((Pe()|0)&A|0)==0)?P=x:R=4;e:do if((R|0)==4){if(P=(Vi(m,A)|0)!=0,((P?4:5)|0)<(x|0)||v(m,A,at)|0||(R=(y[at>>2]|0)+x|0,P?P=22288+(((R|0)%5|0)<<2)|0:P=22320+(((R|0)%6|0)<<2)|0,nt=y[P>>2]|0,(nt|0)==7))return E=1,be=bt,E|0;y[It>>2]=0,P=ts(m,A,nt,It,Ue)|0;do if(!P){if(F=Ue,Q=y[F>>2]|0,F=y[F+4>>2]|0,k=F>>>0<A>>>0|(F|0)==(A|0)&Q>>>0<m>>>0,R=k?Q:m,k=k?F:A,!we&&(we=Nt(7,0,(he^15)*3|0)|0,(Q&we|0)==0&(F&(Pe()|0)|0)==0))P=x;else{if(F=(x+-1+W|0)%(W|0)|0,P=Vi(m,A)|0,(F|0)<0&&Fr(23313,23315,245,23324),W=(P|0)!=0,((W?4:5)|0)<(F|0)&&Fr(23313,23315,245,23324),v(m,A,at)|0&&Fr(23313,23315,245,23324),P=(y[at>>2]|0)+F|0,W?P=22288+(((P|0)%5|0)<<2)|0:P=22320+(((P|0)%6|0)<<2)|0,F=y[P>>2]|0,(F|0)==7&&Fr(23313,23315,245,23324),y[Qe>>2]=0,P=ts(m,A,F,Qe,$e)|0,P|0)break;Q=$e,W=y[Q>>2]|0,Q=y[Q+4>>2]|0;do if(Q>>>0<k>>>0|(Q|0)==(k|0)&W>>>0<R>>>0){if(Vi(W,Q)|0?R=$h(W,Q,m,A)|0:R=y[22384+((((y[Qe>>2]|0)+(y[22352+(F<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,P=Vi(W,Q)|0,(R+-1|0)>>>0>5){P=-1,R=W,k=Q;break}if(P=(P|0)!=0,(R|0)==1&P){P=-1,R=W,k=Q;break}do if(v(W,Q,at)|0)P=-1;else if(P){P=((y[21936+(R<<2)>>2]|0)+5-(y[at>>2]|0)|0)%5|0;break}else{P=((y[21968+(R<<2)>>2]|0)+6-(y[at>>2]|0)|0)%6|0;break}while(!1);R=W,k=Q}else P=x;while(!1);F=Ue,Q=y[F>>2]|0,F=y[F+4>>2]|0}if((R|0)==(Q|0)&(k|0)==(F|0)){if(W=(Vi(Q,F)|0)!=0,W?m=$h(Q,F,m,A)|0:m=y[22384+((((y[It>>2]|0)+(y[22352+(nt<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,P=Vi(Q,F)|0,(m+-1|0)>>>0<=5&&(wt=(P|0)!=0,!((m|0)==1&wt)))do if(v(Q,F,at)|0)P=-1;else if(wt){P=((y[21936+(m<<2)>>2]|0)+5-(y[at>>2]|0)|0)%5|0;break}else{P=((y[21968+(m<<2)>>2]|0)+6-(y[at>>2]|0)|0)%6|0;break}while(!1);else P=-1;P=P+1|0,P=(P|0)==6|W&(P|0)==5?0:P}A=k,m=R;break e}while(!1);return E=P,be=bt,E|0}while(!1);return wt=Nt(P|0,0,56)|0,at=Pe()|0|A&-2130706433|536870912,y[E>>2]=wt|m,y[E+4>>2]=at,E=0,be=bt,E|0}function O(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;return R=(Vi(m,A)|0)==0,E=C(m,A,0,x)|0,P=(E|0)==0,R?!P||(E=C(m,A,1,x+8|0)|0,E|0)||(E=C(m,A,2,x+16|0)|0,E|0)||(E=C(m,A,3,x+24|0)|0,E|0)||(E=C(m,A,4,x+32|0)|0,E)?(R=E,R|0):C(m,A,5,x+40|0)|0:!P||(E=C(m,A,1,x+8|0)|0,E|0)||(E=C(m,A,2,x+16|0)|0,E|0)||(E=C(m,A,3,x+24|0)|0,E|0)||(E=C(m,A,4,x+32|0)|0,E|0)?(R=E,R|0):(R=x+40|0,y[R>>2]=0,y[R+4>>2]=0,R=0,R|0)}function N(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0,F=0,W=0;return W=be,be=be+192|0,P=W,R=W+168|0,k=mt(m|0,A|0,56)|0,Pe()|0,k=k&7,F=A&-2130706433|134217728,E=Vo(m,F,R)|0,E|0?(F=E,be=W,F|0):(A=mt(m|0,A|0,52)|0,Pe()|0,A=A&15,Vi(m,F)|0?af(R,A,k,1,P):Sa(R,A,k,1,P),F=P+8|0,y[x>>2]=y[F>>2],y[x+4>>2]=y[F+4>>2],y[x+8>>2]=y[F+8>>2],y[x+12>>2]=y[F+12>>2],F=0,be=W,F|0)}function V(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0;return P=be,be=be+16|0,x=P,!(!0&(A&2013265920|0)==536870912)||(E=A&-2130706433|134217728,!(cf(m,E)|0))?(E=0,be=P,E|0):(R=mt(m|0,A|0,56)|0,Pe()|0,R=(C(m,E,R&7,x)|0)==0,E=x,E=R&((y[E>>2]|0)==(m|0)?(y[E+4>>2]|0)==(A|0):0)&1,be=P,E|0)}function H(m,A,x){m=m|0,A=A|0,x=x|0;var E=0;(A|0)>0?(E=qe(A,4)|0,y[m>>2]=E,E||Fr(23337,23360,40,23374)):y[m>>2]=0,y[m+4>>2]=A,y[m+8>>2]=0,y[m+12>>2]=x}function K(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0;P=m+4|0,R=m+12|0,k=m+8|0;e:for(;;){for(x=y[P>>2]|0,A=0;;){if((A|0)>=(x|0))break e;if(E=y[m>>2]|0,F=y[E+(A<<2)>>2]|0,!F)A=A+1|0;else break}A=E+(~~(+Ui(+(+kn(10,+ +(15-(y[R>>2]|0)|0))*(+Ee[F>>3]+ +Ee[F+8>>3])))%+(x|0))>>>0<<2)|0,x=y[A>>2]|0;t:do if(x|0){if(E=F+32|0,(x|0)==(F|0))y[A>>2]=y[E>>2];else{if(x=x+32|0,A=y[x>>2]|0,!A)break;for(;(A|0)!=(F|0);)if(x=A+32|0,A=y[x>>2]|0,!A)break t;y[x>>2]=y[E>>2]}Be(F),y[k>>2]=(y[k>>2]|0)+-1}while(!1)}Be(y[m>>2]|0)}function ne(m){m=m|0;var A=0,x=0,E=0;for(E=y[m+4>>2]|0,x=0;;){if((x|0)>=(E|0)){A=0,x=4;break}if(A=y[(y[m>>2]|0)+(x<<2)>>2]|0,!A)x=x+1|0;else{x=4;break}}return(x|0)==4?A|0:0}function ie(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0;if(x=~~(+Ui(+(+kn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,x=(y[m>>2]|0)+(x<<2)|0,E=y[x>>2]|0,!E)return R=1,R|0;R=A+32|0;do if((E|0)!=(A|0)){if(x=y[E+32>>2]|0,!x)return R=1,R|0;for(P=x;;){if((P|0)==(A|0)){P=8;break}if(x=y[P+32>>2]|0,x)E=P,P=x;else{x=1,P=10;break}}if((P|0)==8){y[E+32>>2]=y[R>>2];break}else if((P|0)==10)return x|0}else y[x>>2]=y[R>>2];while(!1);return Be(A),R=m+8|0,y[R>>2]=(y[R>>2]|0)+-1,R=0,R|0}function fe(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0;R=Ve(40)|0,R||Fr(23390,23360,98,23403),y[R>>2]=y[A>>2],y[R+4>>2]=y[A+4>>2],y[R+8>>2]=y[A+8>>2],y[R+12>>2]=y[A+12>>2],P=R+16|0,y[P>>2]=y[x>>2],y[P+4>>2]=y[x+4>>2],y[P+8>>2]=y[x+8>>2],y[P+12>>2]=y[x+12>>2],y[R+32>>2]=0,P=~~(+Ui(+(+kn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,P=(y[m>>2]|0)+(P<<2)|0,E=y[P>>2]|0;do if(!E)y[P>>2]=R;else{for(;!(rl(E,A)|0&&rl(E+16|0,x)|0);)if(P=y[E+32>>2]|0,E=P|0?P:E,!(y[E+32>>2]|0)){k=10;break}if((k|0)==10){y[E+32>>2]=R;break}return Be(R),k=E,k|0}while(!1);return k=m+8|0,y[k>>2]=(y[k>>2]|0)+1,k=R,k|0}function Ae(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0;if(P=~~(+Ui(+(+kn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,P=y[(y[m>>2]|0)+(P<<2)>>2]|0,!P)return x=0,x|0;if(!x){for(m=P;;){if(rl(m,A)|0){E=10;break}if(m=y[m+32>>2]|0,!m){m=0,E=10;break}}if((E|0)==10)return m|0}for(m=P;;){if(rl(m,A)|0&&rl(m+16|0,x)|0){E=10;break}if(m=y[m+32>>2]|0,!m){m=0,E=10;break}}return(E|0)==10?m|0:0}function Ie(m,A){m=m|0,A=A|0;var x=0;if(x=~~(+Ui(+(+kn(10,+ +(15-(y[m+12>>2]|0)|0))*(+Ee[A>>3]+ +Ee[A+8>>3])))%+(y[m+4>>2]|0))>>>0,m=y[(y[m>>2]|0)+(x<<2)>>2]|0,!m)return x=0,x|0;for(;;){if(rl(m,A)|0){A=5;break}if(m=y[m+32>>2]|0,!m){m=0,A=5;break}}return(A|0)==5?m|0:0}function Se(){return 23424}function Me(m){return m=+m,+ +ji(+m)}function ke(m){return m=+m,~~+Me(m)|0}function Ve(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0,nt=0,It=0,wt=0,at=0,bt=0,ft=0,ar=0;ar=be,be=be+16|0,$e=ar;do if(m>>>0<245){if(Q=m>>>0<11?16:m+11&-8,m=Q>>>3,we=y[5857]|0,x=we>>>m,x&3|0)return A=(x&1^1)+m|0,m=23468+(A<<1<<2)|0,x=m+8|0,E=y[x>>2]|0,P=E+8|0,R=y[P>>2]|0,(R|0)==(m|0)?y[5857]=we&~(1<<A):(y[R+12>>2]=m,y[x>>2]=R),ft=A<<3,y[E+4>>2]=ft|3,ft=E+ft+4|0,y[ft>>2]=y[ft>>2]|1,ft=P,be=ar,ft|0;if(he=y[5859]|0,Q>>>0>he>>>0){if(x|0)return A=2<<m,A=x<<m&(A|0-A),A=(A&0-A)+-1|0,F=A>>>12&16,A=A>>>F,x=A>>>5&8,A=A>>>x,R=A>>>2&4,A=A>>>R,m=A>>>1&2,A=A>>>m,E=A>>>1&1,E=(x|F|R|m|E)+(A>>>E)|0,A=23468+(E<<1<<2)|0,m=A+8|0,R=y[m>>2]|0,F=R+8|0,x=y[F>>2]|0,(x|0)==(A|0)?(m=we&~(1<<E),y[5857]=m):(y[x+12>>2]=A,y[m>>2]=x,m=we),ft=E<<3,k=ft-Q|0,y[R+4>>2]=Q|3,P=R+Q|0,y[P+4>>2]=k|1,y[R+ft>>2]=k,he|0&&(E=y[5862]|0,A=he>>>3,x=23468+(A<<1<<2)|0,A=1<<A,m&A?(m=x+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=x,m=x+8|0),y[m>>2]=E,y[A+12>>2]=E,y[E+8>>2]=A,y[E+12>>2]=x),y[5859]=k,y[5862]=P,ft=F,be=ar,ft|0;if(R=y[5858]|0,R){for(x=(R&0-R)+-1|0,P=x>>>12&16,x=x>>>P,E=x>>>5&8,x=x>>>E,k=x>>>2&4,x=x>>>k,F=x>>>1&2,x=x>>>F,W=x>>>1&1,W=y[23732+((E|P|k|F|W)+(x>>>W)<<2)>>2]|0,x=W,F=W,W=(y[W+4>>2]&-8)-Q|0;m=y[x+16>>2]|0,!(!m&&(m=y[x+20>>2]|0,!m));)k=(y[m+4>>2]&-8)-Q|0,P=k>>>0<W>>>0,x=m,F=P?m:F,W=P?k:W;if(k=F+Q|0,k>>>0>F>>>0){P=y[F+24>>2]|0,A=y[F+12>>2]|0;do if((A|0)==(F|0)){if(m=F+20|0,A=y[m>>2]|0,!A&&(m=F+16|0,A=y[m>>2]|0,!A)){x=0;break}for(;;)if(E=A+20|0,x=y[E>>2]|0,x)A=x,m=E;else if(E=A+16|0,x=y[E>>2]|0,x)A=x,m=E;else break;y[m>>2]=0,x=A}else x=y[F+8>>2]|0,y[x+12>>2]=A,y[A+8>>2]=x,x=A;while(!1);do if(P|0){if(A=y[F+28>>2]|0,m=23732+(A<<2)|0,(F|0)==(y[m>>2]|0)){if(y[m>>2]=x,!x){y[5858]=R&~(1<<A);break}}else if(ft=P+16|0,y[((y[ft>>2]|0)==(F|0)?ft:P+20|0)>>2]=x,!x)break;y[x+24>>2]=P,A=y[F+16>>2]|0,A|0&&(y[x+16>>2]=A,y[A+24>>2]=x),A=y[F+20>>2]|0,A|0&&(y[x+20>>2]=A,y[A+24>>2]=x)}while(!1);return W>>>0<16?(ft=W+Q|0,y[F+4>>2]=ft|3,ft=F+ft+4|0,y[ft>>2]=y[ft>>2]|1):(y[F+4>>2]=Q|3,y[k+4>>2]=W|1,y[k+W>>2]=W,he|0&&(E=y[5862]|0,A=he>>>3,x=23468+(A<<1<<2)|0,A=1<<A,A&we?(m=x+8|0,A=y[m>>2]|0):(y[5857]=A|we,A=x,m=x+8|0),y[m>>2]=E,y[A+12>>2]=E,y[E+8>>2]=A,y[E+12>>2]=x),y[5859]=W,y[5862]=k),ft=F+8|0,be=ar,ft|0}else we=Q}else we=Q}else we=Q}else if(m>>>0<=4294967231)if(m=m+11|0,Q=m&-8,E=y[5858]|0,E){P=0-Q|0,m=m>>>8,m?Q>>>0>16777215?W=31:(we=(m+1048320|0)>>>16&8,nt=m<<we,F=(nt+520192|0)>>>16&4,nt=nt<<F,W=(nt+245760|0)>>>16&2,W=14-(F|we|W)+(nt<<W>>>15)|0,W=Q>>>(W+7|0)&1|W<<1):W=0,x=y[23732+(W<<2)>>2]|0;e:do if(!x)x=0,m=0,nt=61;else for(m=0,F=Q<<((W|0)==31?0:25-(W>>>1)|0),R=0;;){if(k=(y[x+4>>2]&-8)-Q|0,k>>>0<P>>>0)if(k)m=x,P=k;else{m=x,P=0,nt=65;break e}if(nt=y[x+20>>2]|0,x=y[x+16+(F>>>31<<2)>>2]|0,R=(nt|0)==0|(nt|0)==(x|0)?R:nt,x)F=F<<1;else{x=R,nt=61;break}}while(!1);if((nt|0)==61){if((x|0)==0&(m|0)==0){if(m=2<<W,m=(m|0-m)&E,!m){we=Q;break}we=(m&0-m)+-1|0,k=we>>>12&16,we=we>>>k,R=we>>>5&8,we=we>>>R,F=we>>>2&4,we=we>>>F,W=we>>>1&2,we=we>>>W,x=we>>>1&1,m=0,x=y[23732+((R|k|F|W|x)+(we>>>x)<<2)>>2]|0}x?nt=65:(F=m,k=P)}if((nt|0)==65)for(R=x;;)if(we=(y[R+4>>2]&-8)-Q|0,x=we>>>0<P>>>0,P=x?we:P,m=x?R:m,x=y[R+16>>2]|0,x||(x=y[R+20>>2]|0),x)R=x;else{F=m,k=P;break}if(F|0&&k>>>0<((y[5859]|0)-Q|0)>>>0&&(he=F+Q|0,he>>>0>F>>>0)){R=y[F+24>>2]|0,A=y[F+12>>2]|0;do if((A|0)==(F|0)){if(m=F+20|0,A=y[m>>2]|0,!A&&(m=F+16|0,A=y[m>>2]|0,!A)){A=0;break}for(;;)if(P=A+20|0,x=y[P>>2]|0,x)A=x,m=P;else if(P=A+16|0,x=y[P>>2]|0,x)A=x,m=P;else break;y[m>>2]=0}else ft=y[F+8>>2]|0,y[ft+12>>2]=A,y[A+8>>2]=ft;while(!1);do if(R){if(m=y[F+28>>2]|0,x=23732+(m<<2)|0,(F|0)==(y[x>>2]|0)){if(y[x>>2]=A,!A){E=E&~(1<<m),y[5858]=E;break}}else if(ft=R+16|0,y[((y[ft>>2]|0)==(F|0)?ft:R+20|0)>>2]=A,!A)break;y[A+24>>2]=R,m=y[F+16>>2]|0,m|0&&(y[A+16>>2]=m,y[m+24>>2]=A),m=y[F+20>>2]|0,m&&(y[A+20>>2]=m,y[m+24>>2]=A)}while(!1);e:do if(k>>>0<16)ft=k+Q|0,y[F+4>>2]=ft|3,ft=F+ft+4|0,y[ft>>2]=y[ft>>2]|1;else{if(y[F+4>>2]=Q|3,y[he+4>>2]=k|1,y[he+k>>2]=k,A=k>>>3,k>>>0<256){x=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=x+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=x,m=x+8|0),y[m>>2]=he,y[A+12>>2]=he,y[he+8>>2]=A,y[he+12>>2]=x;break}if(A=k>>>8,A?k>>>0>16777215?x=31:(bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,x=(ft+245760|0)>>>16&2,x=14-(at|bt|x)+(ft<<x>>>15)|0,x=k>>>(x+7|0)&1|x<<1):x=0,A=23732+(x<<2)|0,y[he+28>>2]=x,m=he+16|0,y[m+4>>2]=0,y[m>>2]=0,m=1<<x,!(E&m)){y[5858]=E|m,y[A>>2]=he,y[he+24>>2]=A,y[he+12>>2]=he,y[he+8>>2]=he;break}A=y[A>>2]|0;t:do if((y[A+4>>2]&-8|0)!=(k|0)){for(E=k<<((x|0)==31?0:25-(x>>>1)|0);x=A+16+(E>>>31<<2)|0,m=y[x>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(k|0)){A=m;break t}else E=E<<1,A=m;y[x>>2]=he,y[he+24>>2]=A,y[he+12>>2]=he,y[he+8>>2]=he;break e}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=he,y[bt>>2]=he,y[he+8>>2]=ft,y[he+12>>2]=A,y[he+24>>2]=0}while(!1);return ft=F+8|0,be=ar,ft|0}else we=Q}else we=Q;else we=-1;while(!1);if(x=y[5859]|0,x>>>0>=we>>>0)return A=x-we|0,m=y[5862]|0,A>>>0>15?(ft=m+we|0,y[5862]=ft,y[5859]=A,y[ft+4>>2]=A|1,y[m+x>>2]=A,y[m+4>>2]=we|3):(y[5859]=0,y[5862]=0,y[m+4>>2]=x|3,ft=m+x+4|0,y[ft>>2]=y[ft>>2]|1),ft=m+8|0,be=ar,ft|0;if(k=y[5860]|0,k>>>0>we>>>0)return at=k-we|0,y[5860]=at,ft=y[5863]|0,bt=ft+we|0,y[5863]=bt,y[bt+4>>2]=at|1,y[ft+4>>2]=we|3,ft=ft+8|0,be=ar,ft|0;if(y[5975]|0?m=y[5977]|0:(y[5977]=4096,y[5976]=4096,y[5978]=-1,y[5979]=-1,y[5980]=0,y[5968]=0,y[5975]=$e&-16^1431655768,m=4096),F=we+48|0,W=we+47|0,R=m+W|0,P=0-m|0,Q=R&P,Q>>>0<=we>>>0||(m=y[5967]|0,m|0&&(he=y[5965]|0,$e=he+Q|0,$e>>>0<=he>>>0|$e>>>0>m>>>0)))return ft=0,be=ar,ft|0;e:do if(y[5968]&4)A=0,nt=143;else{x=y[5863]|0;t:do if(x){for(E=23876;$e=y[E>>2]|0,!($e>>>0<=x>>>0&&($e+(y[E+4>>2]|0)|0)>>>0>x>>>0);)if(m=y[E+8>>2]|0,m)E=m;else{nt=128;break t}if(A=R-k&P,A>>>0<2147483647)if(m=yi(A|0)|0,(m|0)==((y[E>>2]|0)+(y[E+4>>2]|0)|0)){if((m|0)!=-1){k=A,R=m,nt=145;break e}}else E=m,nt=136;else A=0}else nt=128;while(!1);do if((nt|0)==128)if(x=yi(0)|0,(x|0)!=-1&&(A=x,Qe=y[5976]|0,Ue=Qe+-1|0,A=(Ue&A|0?(Ue+A&0-Qe)-A|0:0)+Q|0,Qe=y[5965]|0,Ue=A+Qe|0,A>>>0>we>>>0&A>>>0<2147483647)){if($e=y[5967]|0,$e|0&&Ue>>>0<=Qe>>>0|Ue>>>0>$e>>>0){A=0;break}if(m=yi(A|0)|0,(m|0)==(x|0)){k=A,R=x,nt=145;break e}else E=m,nt=136}else A=0;while(!1);do if((nt|0)==136){if(x=0-A|0,!(F>>>0>A>>>0&(A>>>0<2147483647&(E|0)!=-1)))if((E|0)==-1){A=0;break}else{k=A,R=E,nt=145;break e}if(m=y[5977]|0,m=W-A+m&0-m,m>>>0>=2147483647){k=A,R=E,nt=145;break e}if((yi(m|0)|0)==-1){yi(x|0)|0,A=0;break}else{k=m+A|0,R=E,nt=145;break e}}while(!1);y[5968]=y[5968]|4,nt=143}while(!1);if((nt|0)==143&&Q>>>0<2147483647&&(at=yi(Q|0)|0,Ue=yi(0)|0,It=Ue-at|0,wt=It>>>0>(we+40|0)>>>0,!((at|0)==-1|wt^1|at>>>0<Ue>>>0&((at|0)!=-1&(Ue|0)!=-1)^1))&&(k=wt?It:A,R=at,nt=145),(nt|0)==145){A=(y[5965]|0)+k|0,y[5965]=A,A>>>0>(y[5966]|0)>>>0&&(y[5966]=A),W=y[5863]|0;e:do if(W){for(A=23876;;){if(m=y[A>>2]|0,x=y[A+4>>2]|0,(R|0)==(m+x|0)){nt=154;break}if(E=y[A+8>>2]|0,E)A=E;else break}if((nt|0)==154&&(bt=A+4|0,(y[A+12>>2]&8|0)==0)&&R>>>0>W>>>0&m>>>0<=W>>>0){y[bt>>2]=x+k,ft=(y[5860]|0)+k|0,at=W+8|0,at=at&7|0?0-at&7:0,bt=W+at|0,at=ft-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[W+ft+4>>2]=40,y[5864]=y[5979];break}for(R>>>0<(y[5861]|0)>>>0&&(y[5861]=R),x=R+k|0,A=23876;;){if((y[A>>2]|0)==(x|0)){nt=162;break}if(m=y[A+8>>2]|0,m)A=m;else break}if((nt|0)==162&&!(y[A+12>>2]&8|0)){y[A>>2]=R,he=A+4|0,y[he>>2]=(y[he>>2]|0)+k,he=R+8|0,he=R+(he&7|0?0-he&7:0)|0,A=x+8|0,A=x+(A&7|0?0-A&7:0)|0,Q=he+we|0,F=A-he-we|0,y[he+4>>2]=we|3;t:do if((W|0)==(A|0))ft=(y[5860]|0)+F|0,y[5860]=ft,y[5863]=Q,y[Q+4>>2]=ft|1;else{if((y[5862]|0)==(A|0)){ft=(y[5859]|0)+F|0,y[5859]=ft,y[5862]=Q,y[Q+4>>2]=ft|1,y[Q+ft>>2]=ft;break}if(m=y[A+4>>2]|0,(m&3|0)==1){k=m&-8,E=m>>>3;r:do if(m>>>0<256)if(m=y[A+8>>2]|0,x=y[A+12>>2]|0,(x|0)==(m|0)){y[5857]=y[5857]&~(1<<E);break}else{y[m+12>>2]=x,y[x+8>>2]=m;break}else{R=y[A+24>>2]|0,m=y[A+12>>2]|0;do if((m|0)==(A|0)){if(x=A+16|0,E=x+4|0,m=y[E>>2]|0,m)x=E;else if(m=y[x>>2]|0,!m){m=0;break}for(;;)if(P=m+20|0,E=y[P>>2]|0,E)m=E,x=P;else if(P=m+16|0,E=y[P>>2]|0,E)m=E,x=P;else break;y[x>>2]=0}else ft=y[A+8>>2]|0,y[ft+12>>2]=m,y[m+8>>2]=ft;while(!1);if(!R)break;x=y[A+28>>2]|0,E=23732+(x<<2)|0;do if((y[E>>2]|0)!=(A|0)){if(ft=R+16|0,y[((y[ft>>2]|0)==(A|0)?ft:R+20|0)>>2]=m,!m)break r}else{if(y[E>>2]=m,m|0)break;y[5858]=y[5858]&~(1<<x);break r}while(!1);if(y[m+24>>2]=R,x=A+16|0,E=y[x>>2]|0,E|0&&(y[m+16>>2]=E,y[E+24>>2]=m),x=y[x+4>>2]|0,!x)break;y[m+20>>2]=x,y[x+24>>2]=m}while(!1);A=A+k|0,P=k+F|0}else P=F;if(A=A+4|0,y[A>>2]=y[A>>2]&-2,y[Q+4>>2]=P|1,y[Q+P>>2]=P,A=P>>>3,P>>>0<256){x=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=x+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=x,m=x+8|0),y[m>>2]=Q,y[A+12>>2]=Q,y[Q+8>>2]=A,y[Q+12>>2]=x;break}A=P>>>8;do if(!A)E=0;else{if(P>>>0>16777215){E=31;break}bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,E=(ft+245760|0)>>>16&2,E=14-(at|bt|E)+(ft<<E>>>15)|0,E=P>>>(E+7|0)&1|E<<1}while(!1);if(A=23732+(E<<2)|0,y[Q+28>>2]=E,m=Q+16|0,y[m+4>>2]=0,y[m>>2]=0,m=y[5858]|0,x=1<<E,!(m&x)){y[5858]=m|x,y[A>>2]=Q,y[Q+24>>2]=A,y[Q+12>>2]=Q,y[Q+8>>2]=Q;break}A=y[A>>2]|0;r:do if((y[A+4>>2]&-8|0)!=(P|0)){for(E=P<<((E|0)==31?0:25-(E>>>1)|0);x=A+16+(E>>>31<<2)|0,m=y[x>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(P|0)){A=m;break r}else E=E<<1,A=m;y[x>>2]=Q,y[Q+24>>2]=A,y[Q+12>>2]=Q,y[Q+8>>2]=Q;break t}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=Q,y[bt>>2]=Q,y[Q+8>>2]=ft,y[Q+12>>2]=A,y[Q+24>>2]=0}while(!1);return ft=he+8|0,be=ar,ft|0}for(A=23876;m=y[A>>2]|0,!(m>>>0<=W>>>0&&(ft=m+(y[A+4>>2]|0)|0,ft>>>0>W>>>0));)A=y[A+8>>2]|0;P=ft+-47|0,m=P+8|0,m=P+(m&7|0?0-m&7:0)|0,P=W+16|0,m=m>>>0<P>>>0?W:m,A=m+8|0,x=k+-40|0,at=R+8|0,at=at&7|0?0-at&7:0,bt=R+at|0,at=x-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[R+x+4>>2]=40,y[5864]=y[5979],x=m+4|0,y[x>>2]=27,y[A>>2]=y[5969],y[A+4>>2]=y[5970],y[A+8>>2]=y[5971],y[A+12>>2]=y[5972],y[5969]=R,y[5970]=k,y[5972]=0,y[5971]=A,A=m+24|0;do bt=A,A=A+4|0,y[A>>2]=7;while((bt+8|0)>>>0<ft>>>0);if((m|0)!=(W|0)){if(R=m-W|0,y[x>>2]=y[x>>2]&-2,y[W+4>>2]=R|1,y[m>>2]=R,A=R>>>3,R>>>0<256){x=23468+(A<<1<<2)|0,m=y[5857]|0,A=1<<A,m&A?(m=x+8|0,A=y[m>>2]|0):(y[5857]=m|A,A=x,m=x+8|0),y[m>>2]=W,y[A+12>>2]=W,y[W+8>>2]=A,y[W+12>>2]=x;break}if(A=R>>>8,A?R>>>0>16777215?E=31:(bt=(A+1048320|0)>>>16&8,ft=A<<bt,at=(ft+520192|0)>>>16&4,ft=ft<<at,E=(ft+245760|0)>>>16&2,E=14-(at|bt|E)+(ft<<E>>>15)|0,E=R>>>(E+7|0)&1|E<<1):E=0,x=23732+(E<<2)|0,y[W+28>>2]=E,y[W+20>>2]=0,y[P>>2]=0,A=y[5858]|0,m=1<<E,!(A&m)){y[5858]=A|m,y[x>>2]=W,y[W+24>>2]=x,y[W+12>>2]=W,y[W+8>>2]=W;break}A=y[x>>2]|0;t:do if((y[A+4>>2]&-8|0)!=(R|0)){for(E=R<<((E|0)==31?0:25-(E>>>1)|0);x=A+16+(E>>>31<<2)|0,m=y[x>>2]|0,!!m;)if((y[m+4>>2]&-8|0)==(R|0)){A=m;break t}else E=E<<1,A=m;y[x>>2]=W,y[W+24>>2]=A,y[W+12>>2]=W,y[W+8>>2]=W;break e}while(!1);bt=A+8|0,ft=y[bt>>2]|0,y[ft+12>>2]=W,y[bt>>2]=W,y[W+8>>2]=ft,y[W+12>>2]=A,y[W+24>>2]=0}}else ft=y[5861]|0,(ft|0)==0|R>>>0<ft>>>0&&(y[5861]=R),y[5969]=R,y[5970]=k,y[5972]=0,y[5866]=y[5975],y[5865]=-1,y[5870]=23468,y[5869]=23468,y[5872]=23476,y[5871]=23476,y[5874]=23484,y[5873]=23484,y[5876]=23492,y[5875]=23492,y[5878]=23500,y[5877]=23500,y[5880]=23508,y[5879]=23508,y[5882]=23516,y[5881]=23516,y[5884]=23524,y[5883]=23524,y[5886]=23532,y[5885]=23532,y[5888]=23540,y[5887]=23540,y[5890]=23548,y[5889]=23548,y[5892]=23556,y[5891]=23556,y[5894]=23564,y[5893]=23564,y[5896]=23572,y[5895]=23572,y[5898]=23580,y[5897]=23580,y[5900]=23588,y[5899]=23588,y[5902]=23596,y[5901]=23596,y[5904]=23604,y[5903]=23604,y[5906]=23612,y[5905]=23612,y[5908]=23620,y[5907]=23620,y[5910]=23628,y[5909]=23628,y[5912]=23636,y[5911]=23636,y[5914]=23644,y[5913]=23644,y[5916]=23652,y[5915]=23652,y[5918]=23660,y[5917]=23660,y[5920]=23668,y[5919]=23668,y[5922]=23676,y[5921]=23676,y[5924]=23684,y[5923]=23684,y[5926]=23692,y[5925]=23692,y[5928]=23700,y[5927]=23700,y[5930]=23708,y[5929]=23708,y[5932]=23716,y[5931]=23716,ft=k+-40|0,at=R+8|0,at=at&7|0?0-at&7:0,bt=R+at|0,at=ft-at|0,y[5863]=bt,y[5860]=at,y[bt+4>>2]=at|1,y[R+ft+4>>2]=40,y[5864]=y[5979];while(!1);if(A=y[5860]|0,A>>>0>we>>>0)return at=A-we|0,y[5860]=at,ft=y[5863]|0,bt=ft+we|0,y[5863]=bt,y[bt+4>>2]=at|1,y[ft+4>>2]=we|3,ft=ft+8|0,be=ar,ft|0}return ft=Se()|0,y[ft>>2]=12,ft=0,be=ar,ft|0}function Be(m){m=m|0;var A=0,x=0,E=0,P=0,R=0,k=0,F=0,W=0;if(m){x=m+-8|0,P=y[5861]|0,m=y[m+-4>>2]|0,A=m&-8,W=x+A|0;do if(m&1)F=x,k=x;else{if(E=y[x>>2]|0,!(m&3)||(k=x+(0-E)|0,R=E+A|0,k>>>0<P>>>0))return;if((y[5862]|0)==(k|0)){if(m=W+4|0,A=y[m>>2]|0,(A&3|0)!=3){F=k,A=R;break}y[5859]=R,y[m>>2]=A&-2,y[k+4>>2]=R|1,y[k+R>>2]=R;return}if(x=E>>>3,E>>>0<256)if(m=y[k+8>>2]|0,A=y[k+12>>2]|0,(A|0)==(m|0)){y[5857]=y[5857]&~(1<<x),F=k,A=R;break}else{y[m+12>>2]=A,y[A+8>>2]=m,F=k,A=R;break}P=y[k+24>>2]|0,m=y[k+12>>2]|0;do if((m|0)==(k|0)){if(A=k+16|0,x=A+4|0,m=y[x>>2]|0,m)A=x;else if(m=y[A>>2]|0,!m){m=0;break}for(;;)if(E=m+20|0,x=y[E>>2]|0,x)m=x,A=E;else if(E=m+16|0,x=y[E>>2]|0,x)m=x,A=E;else break;y[A>>2]=0}else F=y[k+8>>2]|0,y[F+12>>2]=m,y[m+8>>2]=F;while(!1);if(P){if(A=y[k+28>>2]|0,x=23732+(A<<2)|0,(y[x>>2]|0)==(k|0)){if(y[x>>2]=m,!m){y[5858]=y[5858]&~(1<<A),F=k,A=R;break}}else if(F=P+16|0,y[((y[F>>2]|0)==(k|0)?F:P+20|0)>>2]=m,!m){F=k,A=R;break}y[m+24>>2]=P,A=k+16|0,x=y[A>>2]|0,x|0&&(y[m+16>>2]=x,y[x+24>>2]=m),A=y[A+4>>2]|0,A?(y[m+20>>2]=A,y[A+24>>2]=m,F=k,A=R):(F=k,A=R)}else F=k,A=R}while(!1);if(!(k>>>0>=W>>>0)&&(m=W+4|0,E=y[m>>2]|0,!!(E&1))){if(E&2)y[m>>2]=E&-2,y[F+4>>2]=A|1,y[k+A>>2]=A,P=A;else{if((y[5863]|0)==(W|0)){if(W=(y[5860]|0)+A|0,y[5860]=W,y[5863]=F,y[F+4>>2]=W|1,(F|0)!=(y[5862]|0))return;y[5862]=0,y[5859]=0;return}if((y[5862]|0)==(W|0)){W=(y[5859]|0)+A|0,y[5859]=W,y[5862]=k,y[F+4>>2]=W|1,y[k+W>>2]=W;return}P=(E&-8)+A|0,x=E>>>3;do if(E>>>0<256)if(A=y[W+8>>2]|0,m=y[W+12>>2]|0,(m|0)==(A|0)){y[5857]=y[5857]&~(1<<x);break}else{y[A+12>>2]=m,y[m+8>>2]=A;break}else{R=y[W+24>>2]|0,m=y[W+12>>2]|0;do if((m|0)==(W|0)){if(A=W+16|0,x=A+4|0,m=y[x>>2]|0,m)A=x;else if(m=y[A>>2]|0,!m){x=0;break}for(;;)if(E=m+20|0,x=y[E>>2]|0,x)m=x,A=E;else if(E=m+16|0,x=y[E>>2]|0,x)m=x,A=E;else break;y[A>>2]=0,x=m}else x=y[W+8>>2]|0,y[x+12>>2]=m,y[m+8>>2]=x,x=m;while(!1);if(R|0){if(m=y[W+28>>2]|0,A=23732+(m<<2)|0,(y[A>>2]|0)==(W|0)){if(y[A>>2]=x,!x){y[5858]=y[5858]&~(1<<m);break}}else if(E=R+16|0,y[((y[E>>2]|0)==(W|0)?E:R+20|0)>>2]=x,!x)break;y[x+24>>2]=R,m=W+16|0,A=y[m>>2]|0,A|0&&(y[x+16>>2]=A,y[A+24>>2]=x),m=y[m+4>>2]|0,m|0&&(y[x+20>>2]=m,y[m+24>>2]=x)}}while(!1);if(y[F+4>>2]=P|1,y[k+P>>2]=P,(F|0)==(y[5862]|0)){y[5859]=P;return}}if(m=P>>>3,P>>>0<256){x=23468+(m<<1<<2)|0,A=y[5857]|0,m=1<<m,A&m?(A=x+8|0,m=y[A>>2]|0):(y[5857]=A|m,m=x,A=x+8|0),y[A>>2]=F,y[m+12>>2]=F,y[F+8>>2]=m,y[F+12>>2]=x;return}m=P>>>8,m?P>>>0>16777215?E=31:(k=(m+1048320|0)>>>16&8,W=m<<k,R=(W+520192|0)>>>16&4,W=W<<R,E=(W+245760|0)>>>16&2,E=14-(R|k|E)+(W<<E>>>15)|0,E=P>>>(E+7|0)&1|E<<1):E=0,m=23732+(E<<2)|0,y[F+28>>2]=E,y[F+20>>2]=0,y[F+16>>2]=0,A=y[5858]|0,x=1<<E;e:do if(!(A&x))y[5858]=A|x,y[m>>2]=F,y[F+24>>2]=m,y[F+12>>2]=F,y[F+8>>2]=F;else{m=y[m>>2]|0;t:do if((y[m+4>>2]&-8|0)!=(P|0)){for(E=P<<((E|0)==31?0:25-(E>>>1)|0);x=m+16+(E>>>31<<2)|0,A=y[x>>2]|0,!!A;)if((y[A+4>>2]&-8|0)==(P|0)){m=A;break t}else E=E<<1,m=A;y[x>>2]=F,y[F+24>>2]=m,y[F+12>>2]=F,y[F+8>>2]=F;break e}while(!1);k=m+8|0,W=y[k>>2]|0,y[W+12>>2]=F,y[k>>2]=F,y[F+8>>2]=W,y[F+12>>2]=m,y[F+24>>2]=0}while(!1);if(W=(y[5865]|0)+-1|0,y[5865]=W,!(W|0)){for(m=23884;m=y[m>>2]|0,m;)m=m+8|0;y[5865]=-1}}}}function qe(m,A){m=m|0,A=A|0;var x=0;return m?(x=oa(A,m)|0,(A|m)>>>0>65535&&(x=((x>>>0)/(m>>>0)|0|0)==(A|0)?x:-1)):x=0,m=Ve(x)|0,!m||!(y[m+-4>>2]&3)||Fi(m|0,0,x|0)|0,m|0}function Ge(m,A,x,E){return m=m|0,A=A|0,x=x|0,E=E|0,x=m+x>>>0,Yr(A+E+(x>>>0<m>>>0|0)>>>0|0),x|0|0}function Ze(m,A,x,E){return m=m|0,A=A|0,x=x|0,E=E|0,E=A-E-(x>>>0>m>>>0|0)>>>0,Yr(E|0),m-x>>>0|0|0}function _t(m){return m=m|0,(m?31-(Dl(m^m-1)|0)|0:32)|0}function At(m,A,x,E,P){m=m|0,A=A|0,x=x|0,E=E|0,P=P|0;var R=0,k=0,F=0,W=0,Q=0,he=0,we=0,$e=0,Qe=0,Ue=0;if(he=m,W=A,Q=W,k=x,$e=E,F=$e,!Q)return R=(P|0)!=0,F?R?(y[P>>2]=m|0,y[P+4>>2]=A&0,$e=0,P=0,Yr($e|0),P|0):($e=0,P=0,Yr($e|0),P|0):(R&&(y[P>>2]=(he>>>0)%(k>>>0),y[P+4>>2]=0),$e=0,P=(he>>>0)/(k>>>0)>>>0,Yr($e|0),P|0);R=(F|0)==0;do if(k){if(!R){if(R=(Dl(F|0)|0)-(Dl(Q|0)|0)|0,R>>>0<=31){we=R+1|0,F=31-R|0,A=R-31>>31,k=we,m=he>>>(we>>>0)&A|Q<<F,A=Q>>>(we>>>0)&A,R=0,F=he<<F;break}return P?(y[P>>2]=m|0,y[P+4>>2]=W|A&0,$e=0,P=0,Yr($e|0),P|0):($e=0,P=0,Yr($e|0),P|0)}if(R=k-1|0,R&k|0){F=(Dl(k|0)|0)+33-(Dl(Q|0)|0)|0,Ue=64-F|0,we=32-F|0,W=we>>31,Qe=F-32|0,A=Qe>>31,k=F,m=we-1>>31&Q>>>(Qe>>>0)|(Q<<we|he>>>(F>>>0))&A,A=A&Q>>>(F>>>0),R=he<<Ue&W,F=(Q<<Ue|he>>>(Qe>>>0))&W|he<<we&F-33>>31;break}return P|0&&(y[P>>2]=R&he,y[P+4>>2]=0),(k|0)==1?(Qe=W|A&0,Ue=m|0|0,Yr(Qe|0),Ue|0):(Ue=_t(k|0)|0,Qe=Q>>>(Ue>>>0)|0,Ue=Q<<32-Ue|he>>>(Ue>>>0)|0,Yr(Qe|0),Ue|0)}else{if(R)return P|0&&(y[P>>2]=(Q>>>0)%(k>>>0),y[P+4>>2]=0),Qe=0,Ue=(Q>>>0)/(k>>>0)>>>0,Yr(Qe|0),Ue|0;if(!he)return P|0&&(y[P>>2]=0,y[P+4>>2]=(Q>>>0)%(F>>>0)),Qe=0,Ue=(Q>>>0)/(F>>>0)>>>0,Yr(Qe|0),Ue|0;if(R=F-1|0,!(R&F))return P|0&&(y[P>>2]=m|0,y[P+4>>2]=R&Q|A&0),Qe=0,Ue=Q>>>((_t(F|0)|0)>>>0),Yr(Qe|0),Ue|0;if(R=(Dl(F|0)|0)-(Dl(Q|0)|0)|0,R>>>0<=30){A=R+1|0,F=31-R|0,k=A,m=Q<<F|he>>>(A>>>0),A=Q>>>(A>>>0),R=0,F=he<<F;break}return P?(y[P>>2]=m|0,y[P+4>>2]=W|A&0,Qe=0,Ue=0,Yr(Qe|0),Ue|0):(Qe=0,Ue=0,Yr(Qe|0),Ue|0)}while(!1);if(!k)Q=F,W=0,F=0;else{we=x|0|0,he=$e|E&0,Q=Ge(we|0,he|0,-1,-1)|0,x=Pe()|0,W=F,F=0;do E=W,W=R>>>31|W<<1,R=F|R<<1,E=m<<1|E>>>31|0,$e=m>>>31|A<<1|0,Ze(Q|0,x|0,E|0,$e|0)|0,Ue=Pe()|0,Qe=Ue>>31|((Ue|0)<0?-1:0)<<1,F=Qe&1,m=Ze(E|0,$e|0,Qe&we|0,(((Ue|0)<0?-1:0)>>31|((Ue|0)<0?-1:0)<<1)&he|0)|0,A=Pe()|0,k=k-1|0;while(k|0);Q=W,W=0}return k=0,P|0&&(y[P>>2]=m,y[P+4>>2]=A),Qe=(R|0)>>>31|(Q|k)<<1|(k<<1|R>>>31)&0|W,Ue=(R<<1|0)&-2|F,Yr(Qe|0),Ue|0}function Mt(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0;return Q=A>>31|((A|0)<0?-1:0)<<1,W=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,R=E>>31|((E|0)<0?-1:0)<<1,P=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,F=Ze(Q^m|0,W^A|0,Q|0,W|0)|0,k=Pe()|0,m=R^Q,A=P^W,Ze((At(F,k,Ze(R^x|0,P^E|0,R|0,P|0)|0,Pe()|0,0)|0)^m|0,(Pe()|0)^A|0,m|0,A|0)|0}function Lt(m,A){m=m|0,A=A|0;var x=0,E=0,P=0,R=0;return R=m&65535,P=A&65535,x=oa(P,R)|0,E=m>>>16,m=(x>>>16)+(oa(P,E)|0)|0,P=A>>>16,A=oa(P,R)|0,Yr((m>>>16)+(oa(P,E)|0)+(((m&65535)+A|0)>>>16)|0),m+A<<16|x&65535|0|0}function Tt(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0;return P=m,R=x,x=Lt(P,R)|0,m=Pe()|0,Yr((oa(A,R)|0)+(oa(E,P)|0)+m|m&0|0),x|0|0|0}function er(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0,k=0,F=0,W=0,Q=0;return P=be,be=be+16|0,F=P|0,k=A>>31|((A|0)<0?-1:0)<<1,R=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,Q=E>>31|((E|0)<0?-1:0)<<1,W=((E|0)<0?-1:0)>>31|((E|0)<0?-1:0)<<1,m=Ze(k^m|0,R^A|0,k|0,R|0)|0,A=Pe()|0,At(m,A,Ze(Q^x|0,W^E|0,Q|0,W|0)|0,Pe()|0,F)|0,E=Ze(y[F>>2]^k|0,y[F+4>>2]^R|0,k|0,R|0)|0,x=Pe()|0,be=P,Yr(x|0),E|0}function Kt(m,A,x,E){m=m|0,A=A|0,x=x|0,E=E|0;var P=0,R=0;return R=be,be=be+16|0,P=R|0,At(m,A,x,E,P)|0,be=R,Yr(y[P+4>>2]|0),y[P>>2]|0|0}function Ut(m,A,x){return m=m|0,A=A|0,x=x|0,(x|0)<32?(Yr(A>>x|0),m>>>x|(A&(1<<x)-1)<<32-x):(Yr(((A|0)<0?-1:0)|0),A>>x-32|0)}function mt(m,A,x){return m=m|0,A=A|0,x=x|0,(x|0)<32?(Yr(A>>>x|0),m>>>x|(A&(1<<x)-1)<<32-x):(Yr(0),A>>>x-32|0)}function Nt(m,A,x){return m=m|0,A=A|0,x=x|0,(x|0)<32?(Yr(A<<x|(m&(1<<x)-1<<32-x)>>>32-x|0),m<<x):(Yr(m<<x-32|0),0)}function Ii(m,A){return m=+m,A=+A,m!=m?+A:A!=A?+m:+gA(+m,+A)}function Gr(m,A){return m=+m,A=+A,m!=m?+A:A!=A?+m:+Ol(+m,+A)}function ki(m){return m=+m,m>=0?+Wn(m+.5):+sa(m-.5)}function Wi(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0;if((x|0)>=8192)return Wh(m|0,A|0,x|0)|0,m|0;if(R=m|0,P=m+x|0,(m&3)==(A&3)){for(;m&3;){if(!x)return R|0;Br[m>>0]=Br[A>>0]|0,m=m+1|0,A=A+1|0,x=x-1|0}for(x=P&-4|0,E=x-64|0;(m|0)<=(E|0);)y[m>>2]=y[A>>2],y[m+4>>2]=y[A+4>>2],y[m+8>>2]=y[A+8>>2],y[m+12>>2]=y[A+12>>2],y[m+16>>2]=y[A+16>>2],y[m+20>>2]=y[A+20>>2],y[m+24>>2]=y[A+24>>2],y[m+28>>2]=y[A+28>>2],y[m+32>>2]=y[A+32>>2],y[m+36>>2]=y[A+36>>2],y[m+40>>2]=y[A+40>>2],y[m+44>>2]=y[A+44>>2],y[m+48>>2]=y[A+48>>2],y[m+52>>2]=y[A+52>>2],y[m+56>>2]=y[A+56>>2],y[m+60>>2]=y[A+60>>2],m=m+64|0,A=A+64|0;for(;(m|0)<(x|0);)y[m>>2]=y[A>>2],m=m+4|0,A=A+4|0}else for(x=P-4|0;(m|0)<(x|0);)Br[m>>0]=Br[A>>0]|0,Br[m+1>>0]=Br[A+1>>0]|0,Br[m+2>>0]=Br[A+2>>0]|0,Br[m+3>>0]=Br[A+3>>0]|0,m=m+4|0,A=A+4|0;for(;(m|0)<(P|0);)Br[m>>0]=Br[A>>0]|0,m=m+1|0,A=A+1|0;return R|0}function Fi(m,A,x){m=m|0,A=A|0,x=x|0;var E=0,P=0,R=0,k=0;if(R=m+x|0,A=A&255,(x|0)>=67){for(;m&3;)Br[m>>0]=A,m=m+1|0;for(E=R&-4|0,k=A|A<<8|A<<16|A<<24,P=E-64|0;(m|0)<=(P|0);)y[m>>2]=k,y[m+4>>2]=k,y[m+8>>2]=k,y[m+12>>2]=k,y[m+16>>2]=k,y[m+20>>2]=k,y[m+24>>2]=k,y[m+28>>2]=k,y[m+32>>2]=k,y[m+36>>2]=k,y[m+40>>2]=k,y[m+44>>2]=k,y[m+48>>2]=k,y[m+52>>2]=k,y[m+56>>2]=k,y[m+60>>2]=k,m=m+64|0;for(;(m|0)<(E|0);)y[m>>2]=k,m=m+4|0}for(;(m|0)<(R|0);)Br[m>>0]=A,m=m+1|0;return R-x|0}function ji(m){return m=+m,m>=0?+Wn(m+.5):+sa(m-.5)}function yi(m){m=m|0;var A=0,x=0,E=0;return E=_A()|0,x=y[Js>>2]|0,A=x+m|0,(m|0)>0&(A|0)<(x|0)|(A|0)<0?(vd(A|0)|0,Hh(12),-1):(A|0)>(E|0)&&!(aa(A|0)|0)?(Hh(12),-1):(y[Js>>2]=A,x|0)}return{___divdi3:Mt,___muldi3:Tt,___remdi3:er,___uremdi3:Kt,_areNeighborCells:Fc,_bitshift64Ashr:Ut,_bitshift64Lshr:mt,_bitshift64Shl:Nt,_calloc:qe,_cellAreaKm2:qm,_cellAreaM2:ha,_cellAreaRads2:Gc,_cellToBoundary:jo,_cellToCenterChild:Co,_cellToChildPos:CA,_cellToChildren:Ts,_cellToChildrenSize:Ca,_cellToLatLng:Uc,_cellToLocalIj:Ku,_cellToParent:uf,_cellToVertex:C,_cellToVertexes:O,_cellsToDirectedEdge:Gm,_cellsToLinkedMultiPolygon:Mc,_childPosToCell:Zu,_compactCells:ua,_destroyLinkedMultiPolygon:Af,_directedEdgeToBoundary:Wl,_directedEdgeToCells:So,_edgeLengthKm:yr,_edgeLengthM:Mr,_edgeLengthRads:Yu,_emscripten_replace_memory:wd,_free:Be,_getBaseCellNumber:kd,_getDirectedEdgeDestination:Rn,_getDirectedEdgeOrigin:TA,_getHexagonAreaAvgKm2:Pa,_getHexagonAreaAvgM2:an,_getHexagonEdgeLengthAvgKm:Xu,_getHexagonEdgeLengthAvgM:df,_getIcosahedronFaces:ff,_getNumCells:Zl,_getPentagons:Vc,_getRes0Cells:Bc,_getResolution:EA,_greatCircleDistanceKm:jc,_greatCircleDistanceM:Ud,_greatCircleDistanceRads:zd,_gridDisk:xA,_gridDiskDistances:bA,_gridDistance:Bn,_gridPathCells:Qu,_gridPathCellsSize:MA,_gridRingUnsafe:qh,_i64Add:Ge,_i64Subtract:Ze,_isPentagon:Vi,_isResClassIII:$l,_isValidCell:cf,_isValidDirectedEdge:Hl,_isValidVertex:V,_latLngToCell:ur,_llvm_maxnum_f64:Ii,_llvm_minnum_f64:Gr,_llvm_round_f64:ki,_localIjToCell:Cn,_malloc:Ve,_maxFaceCount:tl,_maxGridDiskSize:jm,_maxPolygonToCellsSize:Zh,_memcpy:Wi,_memset:Fi,_originToDirectedEdges:Bd,_pentagonCount:oi,_polygonToCells:Ed,_readInt64AsDoubleFromPointer:qd,_res0CellCount:wA,_round:ji,_sbrk:yi,_sizeOfCellBoundary:Yl,_sizeOfCoordIJ:$d,_sizeOfGeoLoop:Wd,_sizeOfGeoPolygon:gf,_sizeOfH3Index:Hd,_sizeOfLatLng:Wc,_sizeOfLinkedGeoPolygon:Kl,_uncompactCells:SA,_uncompactCellsSize:eo,_vertexToLatLng:N,establishStackSpace:Td,stackAlloc:yA,stackRestore:kl,stackSave:Ci}}(rr,nr,Oe),Dr=e.___divdi3=We.___divdi3,Er=e.___muldi3=We.___muldi3,kr=e.___remdi3=We.___remdi3,pi=e.___uremdi3=We.___uremdi3,Gt=e._areNeighborCells=We._areNeighborCells,dr=e._bitshift64Ashr=We._bitshift64Ashr,tr=e._bitshift64Lshr=We._bitshift64Lshr,zr=e._bitshift64Shl=We._bitshift64Shl,mn=e._calloc=We._calloc,ta=e._cellAreaKm2=We._cellAreaKm2,Pr=e._cellAreaM2=We._cellAreaM2,Vn=e._cellAreaRads2=We._cellAreaRads2,Ji=e._cellToBoundary=We._cellToBoundary,Ru=e._cellToCenterChild=We._cellToCenterChild,Cl=e._cellToChildPos=We._cellToChildPos,St=e._cellToChildren=We._cellToChildren,Xr=e._cellToChildrenSize=We._cellToChildrenSize,ri=e._cellToLatLng=We._cellToLatLng,Fs=e._cellToLocalIj=We._cellToLocalIj,jn=e._cellToParent=We._cellToParent,po=e._cellToVertex=We._cellToVertex,Jn=e._cellToVertexes=We._cellToVertexes,xi=e._cellsToDirectedEdge=We._cellsToDirectedEdge,Il=e._cellsToLinkedMultiPolygon=We._cellsToLinkedMultiPolygon,Xs=e._childPosToCell=We._childPosToCell,Bu=e._compactCells=We._compactCells,Ys=e._destroyLinkedMultiPolygon=We._destroyLinkedMultiPolygon,Lh=e._directedEdgeToBoundary=We._directedEdgeToBoundary,Tc=e._directedEdgeToCells=We._directedEdgeToCells,Ad=e._edgeLengthKm=We._edgeLengthKm,ba=e._edgeLengthM=We._edgeLengthM,Pl=e._edgeLengthRads=We._edgeLengthRads,Gn=e._emscripten_replace_memory=We._emscripten_replace_memory,Ec=e._free=We._free,hA=e._getBaseCellNumber=We._getBaseCellNumber,Fm=e._getDirectedEdgeDestination=We._getDirectedEdgeDestination,fA=e._getDirectedEdgeOrigin=We._getDirectedEdgeOrigin,md=e._getHexagonAreaAvgKm2=We._getHexagonAreaAvgKm2,Oh=e._getHexagonAreaAvgM2=We._getHexagonAreaAvgM2,ra=e._getHexagonEdgeLengthAvgKm=We._getHexagonEdgeLengthAvgKm,ci=e._getHexagonEdgeLengthAvgM=We._getHexagonEdgeLengthAvgM,Sc=e._getIcosahedronFaces=We._getIcosahedronFaces,Ml=e._getNumCells=We._getNumCells,Za=e._getPentagons=We._getPentagons,Lu=e._getRes0Cells=We._getRes0Cells,bi=e._getResolution=We._getResolution,zo=e._greatCircleDistanceKm=We._greatCircleDistanceKm,Dh=e._greatCircleDistanceM=We._greatCircleDistanceM,Ou=e._greatCircleDistanceRads=We._greatCircleDistanceRads,Ks=e._gridDisk=We._gridDisk,vs=e._gridDiskDistances=We._gridDiskDistances,gn=e._gridDistance=We._gridDistance,gd=e._gridPathCells=We._gridPathCells,Qs=e._gridPathCellsSize=We._gridPathCellsSize,Ao=e._gridRingUnsafe=We._gridRingUnsafe,es=e._i64Add=We._i64Add,Nm=e._i64Subtract=We._i64Subtract,Rl=e._isPentagon=We._isPentagon,_n=e._isResClassIII=We._isResClassIII,Du=e._isValidCell=We._isValidCell,Bl=e._isValidDirectedEdge=We._isValidDirectedEdge,kh=e._isValidVertex=We._isValidVertex,mo=e._latLngToCell=We._latLngToCell,fn=e._llvm_maxnum_f64=We._llvm_maxnum_f64,va=e._llvm_minnum_f64=We._llvm_minnum_f64,Bi=e._llvm_round_f64=We._llvm_round_f64,ei=e._localIjToCell=We._localIjToCell,ku=e._malloc=We._malloc,_i=e._maxFaceCount=We._maxFaceCount,Fu=e._maxGridDiskSize=We._maxGridDiskSize,ia=e._maxPolygonToCellsSize=We._maxPolygonToCellsSize,Fh=e._memcpy=We._memcpy,Nh=e._memset=We._memset,_d=e._originToDirectedEdges=We._originToDirectedEdges,zh=e._pentagonCount=We._pentagonCount,Uh=e._polygonToCells=We._polygonToCells,yd=e._readInt64AsDoubleFromPointer=We._readInt64AsDoubleFromPointer,Nu=e._res0CellCount=We._res0CellCount,zm=e._round=We._round,Cc=e._sbrk=We._sbrk,ws=e._sizeOfCellBoundary=We._sizeOfCellBoundary,xd=e._sizeOfCoordIJ=We._sizeOfCoordIJ,Um=e._sizeOfGeoLoop=We._sizeOfGeoLoop,Ns=e._sizeOfGeoPolygon=We._sizeOfGeoPolygon,Hn=e._sizeOfH3Index=We._sizeOfH3Index,na=e._sizeOfLatLng=We._sizeOfLatLng,zu=e._sizeOfLinkedGeoPolygon=We._sizeOfLinkedGeoPolygon,dA=e._uncompactCells=We._uncompactCells,Vm=e._uncompactCellsSize=We._uncompactCellsSize,Xa=e._vertexToLatLng=We._vertexToLatLng,pA=e.establishStackSpace=We.establishStackSpace,AA=e.stackAlloc=We.stackAlloc,Vh=e.stackRestore=We.stackRestore,jh=e.stackSave=We.stackSave;if(e.asm=We,e.cwrap=me,e.setValue=G,e.getValue=Z,Ft){si(Ft)||(Ft=a(Ft));{Vr("memory initializer");var go=function(gt){gt.byteLength&&(gt=new Uint8Array(gt)),De.set(gt,z),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Jt("memory initializer")},bd=function(){c(Ft,go,function(){throw"could not load memory initializer "+Ft})},Ya=zt(Ft);if(Ya)go(Ya.buffer);else if(e.memoryInitializerRequest){var Gh=function(){var gt=e.memoryInitializerRequest,Wt=gt.response;if(gt.status!==200&&gt.status!==0){var or=zt(e.memoryInitializerRequestURL);if(or)Wt=or.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+gt.status+", retrying "+Ft),bd();return}}go(Wt)};e.memoryInitializerRequest.response?setTimeout(Gh,0):e.memoryInitializerRequest.addEventListener("load",Gh)}else bd()}}var wa;as=function gt(){wa||Uu(),wa||(as=gt)};function Uu(gt){if(gt=gt||n,os>0||(Ri(),os>0))return;function Wt(){wa||(wa=!0,!q&&(li(),Qi(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),Di()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),Wt()},1)):Wt()}e.run=Uu;function Ta(gt){throw e.onAbort&&e.onAbort(gt),gt+="",d(gt),p(gt),q=!0,"abort("+gt+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Ta,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Uu(),r}(typeof Yi=="object"?Yi:{}),fi="number",qr=fi,ky=fi,Kr=fi,Qr=fi,Do=fi,Sr=fi,Ace=[["sizeOfH3Index",fi],["sizeOfLatLng",fi],["sizeOfCellBoundary",fi],["sizeOfGeoLoop",fi],["sizeOfGeoPolygon",fi],["sizeOfLinkedGeoPolygon",fi],["sizeOfCoordIJ",fi],["readInt64AsDoubleFromPointer",fi],["isValidCell",ky,[Kr,Qr]],["latLngToCell",qr,[fi,fi,Do,Sr]],["cellToLatLng",qr,[Kr,Qr,Sr]],["cellToBoundary",qr,[Kr,Qr,Sr]],["maxGridDiskSize",qr,[fi,Sr]],["gridDisk",qr,[Kr,Qr,fi,Sr]],["gridDiskDistances",qr,[Kr,Qr,fi,Sr,Sr]],["gridRingUnsafe",qr,[Kr,Qr,fi,Sr]],["maxPolygonToCellsSize",qr,[Sr,Do,fi,Sr]],["polygonToCells",qr,[Sr,Do,fi,Sr]],["cellsToLinkedMultiPolygon",qr,[Sr,fi,Sr]],["destroyLinkedMultiPolygon",null,[Sr]],["compactCells",qr,[Sr,Sr,fi,fi]],["uncompactCells",qr,[Sr,fi,fi,Sr,fi,Do]],["uncompactCellsSize",qr,[Sr,fi,fi,Do,Sr]],["isPentagon",ky,[Kr,Qr]],["isResClassIII",ky,[Kr,Qr]],["getBaseCellNumber",fi,[Kr,Qr]],["getResolution",fi,[Kr,Qr]],["maxFaceCount",qr,[Kr,Qr,Sr]],["getIcosahedronFaces",qr,[Kr,Qr,Sr]],["cellToParent",qr,[Kr,Qr,Do,Sr]],["cellToChildren",qr,[Kr,Qr,Do,Sr]],["cellToCenterChild",qr,[Kr,Qr,Do,Sr]],["cellToChildrenSize",qr,[Kr,Qr,Do,Sr]],["cellToChildPos",qr,[Kr,Qr,Do,Sr]],["childPosToCell",qr,[fi,fi,Kr,Qr,Do,Sr]],["areNeighborCells",qr,[Kr,Qr,Kr,Qr,Sr]],["cellsToDirectedEdge",qr,[Kr,Qr,Kr,Qr,Sr]],["getDirectedEdgeOrigin",qr,[Kr,Qr,Sr]],["getDirectedEdgeDestination",qr,[Kr,Qr,Sr]],["isValidDirectedEdge",ky,[Kr,Qr]],["directedEdgeToCells",qr,[Kr,Qr,Sr]],["originToDirectedEdges",qr,[Kr,Qr,Sr]],["directedEdgeToBoundary",qr,[Kr,Qr,Sr]],["gridDistance",qr,[Kr,Qr,Kr,Qr,Sr]],["gridPathCells",qr,[Kr,Qr,Kr,Qr,Sr]],["gridPathCellsSize",qr,[Kr,Qr,Kr,Qr,Sr]],["cellToLocalIj",qr,[Kr,Qr,Kr,Qr,fi,Sr]],["localIjToCell",qr,[Kr,Qr,Sr,fi,Sr]],["getHexagonAreaAvgM2",qr,[Do,Sr]],["getHexagonAreaAvgKm2",qr,[Do,Sr]],["getHexagonEdgeLengthAvgM",qr,[Do,Sr]],["getHexagonEdgeLengthAvgKm",qr,[Do,Sr]],["greatCircleDistanceM",fi,[Sr,Sr]],["greatCircleDistanceKm",fi,[Sr,Sr]],["greatCircleDistanceRads",fi,[Sr,Sr]],["cellAreaM2",qr,[Kr,Qr,Sr]],["cellAreaKm2",qr,[Kr,Qr,Sr]],["cellAreaRads2",qr,[Kr,Qr,Sr]],["edgeLengthM",qr,[Kr,Qr,Sr]],["edgeLengthKm",qr,[Kr,Qr,Sr]],["edgeLengthRads",qr,[Kr,Qr,Sr]],["getNumCells",qr,[Do,Sr]],["getRes0Cells",qr,[Sr]],["res0CellCount",fi],["getPentagons",qr,[fi,Sr]],["pentagonCount",fi],["cellToVertex",qr,[Kr,Qr,fi,Sr]],["cellToVertexes",qr,[Kr,Qr,Sr]],["vertexToLatLng",qr,[Kr,Qr,Sr]],["isValidVertex",ky,[Kr,Qr]]],mce=0,gce=1,_ce=2,yce=3,Gz=4,xce=5,bce=6,vce=7,wce=8,Tce=9,Ece=10,Sce=11,Cce=12,Ice=13,Pce=14,Mce=15,Eo={};Eo[mce]="Success";Eo[gce]="The operation failed but a more specific error is not available";Eo[_ce]="Argument was outside of acceptable range";Eo[yce]="Latitude or longitude arguments were outside of acceptable range";Eo[Gz]="Resolution argument was outside of acceptable range";Eo[xce]="Cell argument was not valid";Eo[bce]="Directed edge argument was not valid";Eo[vce]="Undirected edge argument was not valid";Eo[wce]="Vertex argument was not valid";Eo[Tce]="Pentagon distortion was encountered";Eo[Ece]="Duplicate input";Eo[Sce]="Cell arguments were not neighbors";Eo[Cce]="Cell arguments had incompatible resolutions";Eo[Ice]="Memory allocation failed";Eo[Pce]="Bounds of provided memory were insufficient";Eo[Mce]="Mode or flags argument was not valid";var Hz=1e3,Rce=1001,Wz=1002,Ow={};Ow[Hz]="Unknown unit";Ow[Rce]="Array length out of bounds";Ow[Wz]="Got unexpected null value for H3 index";var Bce="Unknown error";function $z(r,e,t){var i=t&&"value"in t,n=new Error((r[e]||Bce)+" (code: "+e+(i?", value: "+t.value:"")+")");return n.code=e,n}function qz(r,e){var t=arguments.length===2?{value:e}:{};return $z(Eo,r,t)}function Zz(r,e){var t=arguments.length===2?{value:e}:{};return $z(Ow,r,t)}function Kp(r){if(r!==0)throw qz(r)}var Os={};Ace.forEach(function(e){Os[e[0]]=Yi.cwrap.apply(Yi,e)});var fm=16;var Xz=4,Uz=4,ud=8,Lce=8,Bw=Os.sizeOfH3Index(),Yz=Os.sizeOfLatLng(),Oce=Os.sizeOfCellBoundary(),zVe=Os.sizeOfGeoPolygon(),UVe=Os.sizeOfGeoLoop(),Dce=Os.sizeOfLinkedGeoPolygon(),VVe=Os.sizeOfCoordIJ(),Vz={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function kce(r){if(typeof r!="number"||r<0||r>15||Math.floor(r)!==r)throw qz(Gz,r);return r}function Fce(r){if(!r)throw Zz(Wz);return r}var jVe=Math.pow(2,32)-1;var Nce=/[^0-9a-fA-F]/;function Qp(r){if(Array.isArray(r)&&r.length===2&&Number.isInteger(r[0])&&Number.isInteger(r[1]))return r;if(typeof r!="string"||Nce.test(r))return[0,0];var e=parseInt(r.substring(0,r.length-8),fm),t=parseInt(r.substring(r.length-8),fm);return[t,e]}function jz(r){if(r>=0)return r.toString(fm);r=r&2147483647;var e=Kz(8,r.toString(fm)),t=(parseInt(e[0],fm)+8).toString(fm);return e=t+e.substring(1),e}function zce(r,e){return jz(e)+Kz(8,jz(r))}function Kz(r,e){for(var t=r-e.length,i="",n=0;n<t;n++)i+="0";return i=i+e,i}var GVe=Math.pow(2,32);function Uce(r,e){e===void 0&&(e=0);var t=Yi.getValue(r+Bw*e,"i32"),i=Yi.getValue(r+Bw*e+Xz,"i32");return i?zce(t,i):null}function Vce(r,e){return e===void 0&&(e=0),Yi.getValue(r+ud*e,"double")}function jce(r){return Os.readInt64AsDoubleFromPointer(r)}function Gce(r,e,t){Yi.HEAPU32.set(Qp(r),e/Xz+2*t)}function Hce(r,e){for(var t=e.length,i=0;i<t;i++)Gce(e[i],r,i)}function Lw(r){return Zce(Yi.getValue(r,"double"))}function GI(r){return[Lw(r),Lw(r+ud)]}function Qz(r){return[Lw(r+ud),Lw(r)]}function Wce(r,e,t){for(var i=Yi.getValue(r,"i32"),n=r+ud,s=[],a=e?Qz:GI,c=0;c<i*2;c+=2)s.push(a(n+ud*c));return t&&s.push(s[0]),s}function $ce(r,e){for(var t=[],i=e?Qz:GI,n,s,a,c;r;){for(t.push(n=[]),s=Yi.getValue(r,"i8*");s;){for(n.push(a=[]),c=Yi.getValue(s,"i8*");c;)a.push(i(c)),c=Yi.getValue(c+ud*2,"i8*");e&&a.push(a[0]),s=Yi.getValue(s+Uz*2,"i8*")}r=Yi.getValue(r+Uz*2,"i8*")}return t}function Jz(r){var e=Qp(r),t=e[0],i=e[1];return!!Os.isPentagon(t,i)}function eU(r){var e=Qp(r),t=e[0],i=e[1];return Os.isValidCell(t,i)?Os.getResolution(t,i):-1}function tU(r,e,t){var i=Yi._malloc(Yz);Yi.HEAPF64.set([r,e].map(qce),i/ud);var n=Yi._malloc(Bw);try{return Kp(Os.latLngToCell(i,t,n)),Fce(Uce(n))}finally{Yi._free(n),Yi._free(i)}}function Fy(r){var e=Yi._malloc(Yz),t=Qp(r),i=t[0],n=t[1];try{return Kp(Os.cellToLatLng(i,n,e)),GI(e)}finally{Yi._free(e)}}function rU(r,e){var t=Yi._malloc(Oce),i=Qp(r),n=i[0],s=i[1];try{return Kp(Os.cellToBoundary(n,s,t)),Wce(t,e,e)}finally{Yi._free(t)}}function iU(r,e){if(!r||!r.length)return[];var t=r.length,i=Yi._calloc(t,Bw);Hce(i,r);var n=Yi._calloc(Dce);try{return Kp(Os.cellsToLinkedMultiPolygon(i,t,n)),$ce(n,e)}finally{Os.destroyLinkedMultiPolygon(n),Yi._free(n),Yi._free(i)}}function nU(r,e){var t=Qp(r),i=t[0],n=t[1],s=Qp(e),a=s[0],c=s[1],d=Yi._malloc(Lce);try{return Kp(Os.gridDistance(i,n,a,c,d)),jce(d)}finally{Yi._free(d)}}function sU(r,e){kce(r);var t=Yi._malloc(ud);try{switch(e){case Vz.m:Kp(Os.getHexagonEdgeLengthAvgM(r,t));break;case Vz.km:Kp(Os.getHexagonEdgeLengthAvgKm(r,t));break;default:throw Zz(Hz,e)}return Vce(t)}finally{Yi._free(t)}}function qce(r){return r*Math.PI/180}function Zce(r){return r*180/Math.PI}function Dw(r,e){e=e===void 0?r[0][0]:e;for(let t of r){let i=t[0]-e;i>180?t[0]-=360:i<-180&&(t[0]+=360)}}function Xce(r,e,t){let[i,n]=Fy(r),s=e.length;Dw(e,n);let a=e[0]===e[s-1]?s-1:s;for(let c=0;c<a;c++)e[c][0]=wo(n,e[c][0],t),e[c][1]=wo(i,e[c][1],t)}function oU(r,e,t){let i=r(e,t),[n,s]=Fy(i);return[s,n]}function HI(r,e=1){let t=rU(r,!0);return e!==1?Xce(r,t,e):Dw(t),t}function aU(r){let e=new Float64Array(r.length*2),t=0;for(let i of r)e[t++]=i[0],e[t++]=i[1];return e}var Yce=10;function Kce(r,e){let t;return r==null?t=e:typeof r=="object"?t={...r,coverage:e}:t={getHexagon:r,coverage:e},t}var Qce={...nd.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:r=>r.hexagon},extruded:!0},dm=class r extends Zn{initializeState(){r._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:t}){if(e.highPrecision!==!0&&(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagon)){let i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,t=!1,i=!1,{iterable:n,objectInfo:s}=gs(this.props.data);for(let a of n){s.index++;let c=this.props.getHexagon(a,s),d=eU(c);if(e<0){if(e=d,!this.props.highPrecision)break}else if(e!==d){i=!0;break}if(Jz(c)){t=!0;break}}return{resolution:e,edgeLengthKM:e>=0?sU(e,"km"):0,hasMultipleRes:i,hasPentagon:t}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){let{resolution:e,hasPentagon:t,hasMultipleRes:i}=this.state,{viewport:n}=this.context;return!!n?.resolution||i||t||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;let{resolution:t,edgeLengthKM:i,centerHex:n}=this.state;if(t<0)return;let s=this.props.centerHexagon||tU(e.latitude,e.longitude,t);if(n===s)return;if(n)try{if(nU(n,s)*i<Yce)return}catch{}let{unitsPerMeter:a}=e.distanceScales,c=HI(s),[d,p]=Fy(s),[b,T]=e.projectFlat([p,d]);c=c.map(B=>{let z=e.projectFlat(B);return[(z[0]-b)/a[0],(z[1]-T)/a[1]]}),this.setState({centerHex:s,vertices:c})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){let{elevationScale:e,material:t,coverage:i,extruded:n,wireframe:s,stroked:a,filled:c,lineWidthUnits:d,lineWidthScale:p,lineWidthMinPixels:b,lineWidthMaxPixels:T,getFillColor:B,getElevation:z,getLineColor:G,getLineWidth:Z,transitions:q,updateTriggers:re}=this.props;return{elevationScale:e,extruded:n,coverage:i,wireframe:s,stroked:a,filled:c,lineWidthUnits:d,lineWidthScale:p,lineWidthMinPixels:b,lineWidthMaxPixels:T,material:t,getElevation:z,getFillColor:B,getLineColor:G,getLineWidth:Z,transitions:q,updateTriggers:{getFillColor:re.getFillColor,getElevation:re.getElevation,getLineColor:re.getLineColor,getLineWidth:re.getLineWidth}}}_renderPolygonLayer(){let{data:e,getHexagon:t,updateTriggers:i,coverage:n}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",nd),a=this._getForwardProps();return a.updateTriggers.getPolygon=Kce(i.getHexagon,n),new s(a,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:a.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(c,d)=>{let p=t(c,d);return aU(HI(p,n))}})}_renderColumnLayer(){let{data:e,getHexagon:t,updateTriggers:i}=this.props,n=this.getSubLayerClass("hexagon-cell",vu),s=this._getForwardProps();return s.updateTriggers.getPosition=i.getHexagon,new n(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:oU.bind(null,t)})}};dm.defaultProps=Qce;dm.layerName="H3HexagonLayer";dm._checkH3Lib=()=>{};var kw=dm;var Jce={getHexagons:{type:"accessor",value:r=>r.hexagons}},Ny=class extends Eu{initializeState(){kw._checkH3Lib()}updateState({props:e,changeFlags:t}){if(t.dataChanged||t.updateTriggersChanged&&t.updateTriggersChanged.getHexagons){let{data:i,getHexagons:n}=e,s=[],{iterable:a,objectInfo:c}=gs(i);for(let d of a){c.index++;let p=n(d,c),b=iU(p,!0);for(let T of b){for(let B of T)Dw(B);s.push(this.getSubLayerRow({polygon:T},d,c.index))}}this.setState({polygons:s})}}indexToBounds(){let{getElevation:e,getFillColor:t,getLineColor:i,getLineWidth:n}=this.props;return{data:this.state.polygons,getPolygon:s=>s.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(t),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(n)}}};Ny.layerName="H3ClusterLayer";Ny.defaultProps=Jce;var lU=Ny;var WI=Math.PI/180,Fw=new Float32Array(16),cU=new Float32Array(12);function uU(r,e,t){let i=e[0]*WI,n=e[1]*WI,s=e[2]*WI,a=Math.sin(s),c=Math.sin(i),d=Math.sin(n),p=Math.cos(s),b=Math.cos(i),T=Math.cos(n),B=t[0],z=t[1],G=t[2];r[0]=B*T*b,r[1]=B*d*b,r[2]=B*-c,r[3]=z*(-d*p+T*c*a),r[4]=z*(T*p+d*c*a),r[5]=z*b*a,r[6]=G*(d*a+T*c*p),r[7]=G*(-T*a+d*c*p),r[8]=G*b*p}function hU(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}var Nw={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,{startRow:e,endRow:t}){let{data:i,getOrientation:n,getScale:s,getTranslation:a,getTransformMatrix:c}=this.props,d=Array.isArray(c),p=d&&c.length===16,b=Array.isArray(s),T=Array.isArray(n),B=Array.isArray(a),z=p||!d&&!!c(i[0]);z?r.constant=p:r.constant=T&&b&&B;let G=r.value;if(r.constant){let Z;z?(Fw.set(c),Z=hU(Fw)):(Z=cU,uU(Z,n,s),Z.set(a,9)),r.value=new Float32Array(Z)}else{let Z=e*r.size,{iterable:q,objectInfo:re}=gs(i,e,t);for(let ee of q){re.index++;let ae;if(z)Fw.set(p?c:c(ee,re)),ae=hU(Fw);else{ae=cU;let me=T?n:n(ee,re),Le=b?s:s(ee,re);uU(ae,me,Le),ae.set(B?a:a(ee,re),9)}G[Z++]=ae[0],G[Z++]=ae[1],G[Z++]=ae[2],G[Z++]=ae[3],G[Z++]=ae[4],G[Z++]=ae[5],G[Z++]=ae[6],G[Z++]=ae[7],G[Z++]=ae[8],G[Z++]=ae[9],G[Z++]=ae[10],G[Z++]=ae[11]}}}};function zw(r,e){return e===br.CARTESIAN||e===br.METER_OFFSETS||e===br.DEFAULT&&!r.isGeospatial}var fU=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,dU={name:"simpleMesh",vs:fU,fs:fU,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}};var pU=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var AU=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function $I(r){let e=r.positions||r.POSITION;cr.assert(e,'no "postions" or "POSITION" attribute in mesh');let t=e.value.length/e.size,i=r.COLOR_0||r.colors;i||(i={size:3,value:new Float32Array(t*3).fill(1)});let n=r.NORMAL||r.normals;n||(n={size:3,value:new Float32Array(t*3).fill(0)});let s=r.TEXCOORD_0||r.texCoords;return s||(s={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:i,normals:n,texCoords:s}}function mU(r){return r instanceof Xi?(r.attributes=$I(r.attributes),r):r.attributes?new Xi({...r,topology:"triangle-list",attributes:$I(r.attributes)}):new Xi({topology:"triangle-list",attributes:$I(r)})}var eue=[0,0,0,255],tue={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:eue},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},zy=class extends sn{getShaders(){return super.getShaders({vs:pU,fs:AU,modules:[Pi,_0,wn,dU]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;let{mesh:t}=this.props;if(!t)return null;if(e=t.header?.boundingBox,!e){let{attributes:i}=mU(t);i.POSITION=i.POSITION||i.positions,e=ch(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Nw}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);let{props:t,oldProps:i,changeFlags:n}=e;if(t.mesh!==i.mesh||n.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);let s=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==i.texture&&t.texture instanceof tn&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){let{model:t}=this.state;if(!t)return;let{viewport:i,renderPass:n}=this.context,{sizeScale:s,coordinateSystem:a,_instanced:c}=this.props,d={sizeScale:s,composeModelMatrix:!c||zw(i,a),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:d}),t.draw(n)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){let t=new hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:mU(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state,s={sampler:i||n,hasTexture:!!i};return t.shaderInputs.setProps({simpleMesh:s}),t}setTexture(e){let{emptyTexture:t,model:i}=this.state;if(i){let n={sampler:e||t,hasTexture:!!e};i.shaderInputs.setProps({simpleMesh:n})}}};zy.defaultProps=tue;zy.layerName="SimpleMeshLayer";var pm=zy;var xc;(function(r){r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.ONE=1]="ONE",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.LINEAR=9729]="LINEAR",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(xc||(xc={}));function Vy(r,e,t,i){let n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;let{imageBasedLightingEnvironment:s}=i;return s&&(n.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,n.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,n.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,n.uniforms.scaleIBLAmbient=[1,1]),i?.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.scaleDiffBaseMR=[0,0,0,0],n.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(n.defines.HAS_NORMALS=1),t.TANGENT&&i?.useTangents&&(n.defines.HAS_TANGENTS=1),t.TEXCOORD_0&&(n.defines.HAS_UV=1),i?.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),i?.lights&&(n.defines.USE_LIGHTS=1),e&&rue(r,e,n),n}function rue(r,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&iue(r,e.pbrMetallicRoughness,t),e.normalTexture){Uy(r,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);let{scale:i=1}=e.normalTexture;t.uniforms.normalScale=i}if(e.occlusionTexture){Uy(r,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);let{strength:i=1}=e.occlusionTexture;t.uniforms.occlusionStrength=i}switch(e.emissiveTexture&&(Uy(r,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":let{alphaCutoff:i=.5}=e;t.defines.ALPHA_CUTOFF=1,t.uniforms.alphaCutoff=i;break;case"BLEND":Vt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=xc.FUNC_ADD,t.glParameters.blendFunc=[xc.SRC_ALPHA,xc.ONE_MINUS_SRC_ALPHA,xc.ONE,xc.ONE_MINUS_SRC_ALPHA];break}}function iue(r,e,t){e.baseColorTexture&&Uy(r,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Uy(r,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);let{metallicFactor:i=1,roughnessFactor:n=1}=e;t.uniforms.metallicRoughnessValues=[i,n]}function Uy(r,e,t,i=null,n){let s=e?.texture?.sampler?.parameters||{},a=e.texture.source.image,c,d={};a.compressed?(c=a,d={[xc.TEXTURE_MIN_FILTER]:a.data.length>1?xc.LINEAR_MIPMAP_NEAREST:xc.LINEAR}):c={data:a};let p=r.createTexture({id:e.uniformName||e.id,parameters:{...s,...d},pixelStore:{[xc.UNPACK_FLIP_Y_WEBGL]:!1},...c});n.bindings[t]=p,i&&(n.defines[i]=1),n.generatedTextures.push(p)}var gU="4.3.2";var Uw={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"},_U;async function ZI(r){uE(r.modules);let e=hE("basis");return e||(_U||=nue(r),await _U)}async function nue(r){let e=null,t=null;return[e,t]=await Promise.all([await tu(Uw.TRANSCODER,"textures",r),await tu(Uw.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await sue(e,t)}function sue(r,e){let t={};return e&&(t.wasmBinary=e),new Promise(i=>{r(t).then(n=>{let{BasisFile:s,initializeBasis:a}=n;a(),i({BasisFile:s})})})}var qI;async function XI(r){let e=r.modules||{};return e.basisEncoder?e.basisEncoder:(qI=qI||oue(r),await qI)}async function oue(r){let e=null,t=null;return[e,t]=await Promise.all([await tu(Uw.ENCODER,"textures",r),await tu(Uw.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await aue(e,t)}function aue(r,e){let t={};return e&&(t.wasmBinary=e),new Promise(i=>{r(t).then(n=>{let{BasisFile:s,KTX2File:a,initializeBasis:c,BasisEncoder:d}=n;c(),i({BasisFile:s,KTX2File:a,BasisEncoder:d})})})}var Jp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};var lue=["","WEBKIT_","MOZ_"],yU={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},Vw=null;function xU(r){if(!Vw){r=r||cue()||void 0,Vw=new Set;for(let e of lue)for(let t in yU)if(r&&r.getExtension(`${e}${t}`)){let i=yU[t];Vw.add(i)}}return Vw}function cue(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var qa=[171,75,84,88,32,50,48,187,13,10,26,10];function bU(r){let e=new Uint8Array(r);return!(e.byteLength<qa.length||e[0]!==qa[0]||e[1]!==qa[1]||e[2]!==qa[2]||e[3]!==qa[3]||e[4]!==qa[4]||e[5]!==qa[5]||e[6]!==qa[6]||e[7]!==qa[7]||e[8]!==qa[8]||e[9]!==qa[9]||e[10]!==qa[10]||e[11]!==qa[11])}var uue={etc1:{basisFormat:0,compressed:!0,format:Jp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Jp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Jp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Jp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Jp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Jp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function wU(r,e){if(e.basis.containerFormat==="auto"){if(bU(r)){let i=await XI(e);return vU(i.KTX2File,r,e)}let{BasisFile:t}=await ZI(e);return YI(t,r,e)}switch(e.basis.module){case"encoder":let t=await XI(e);switch(e.basis.containerFormat){case"ktx2":return vU(t.KTX2File,r,e);case"basis":default:return YI(t.BasisFile,r,e)}case"transcoder":default:let{BasisFile:i}=await ZI(e);return YI(i,r,e)}}function YI(r,e,t){let i=new r(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");let n=i.getNumImages(),s=[];for(let a=0;a<n;a++){let c=i.getNumLevels(a),d=[];for(let p=0;p<c;p++)d.push(hue(i,a,p,t));s.push(d)}return s}finally{i.close(),i.delete()}}function hue(r,e,t,i){let n=r.getImageWidth(e,t),s=r.getImageHeight(e,t),a=r.getHasAlpha(),{compressed:c,format:d,basisFormat:p}=TU(i,a),b=r.getImageTranscodedSizeInBytes(e,t,p),T=new Uint8Array(b);if(!r.transcodeImage(T,e,t,p,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:s,data:T,compressed:c,format:d,hasAlpha:a}}function vU(r,e,t){let i=new r(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");let n=i.getLevels(),s=[];for(let a=0;a<n;a++)s.push(fue(i,a,t));return[s]}finally{i.close(),i.delete()}}function fue(r,e,t){let{alphaFlag:i,height:n,width:s}=r.getImageLevelInfo(e,0,0),{compressed:a,format:c,basisFormat:d}=TU(t,i),p=r.getImageTranscodedSizeInBytes(e,0,0,d),b=new Uint8Array(p);if(!r.transcodeImage(b,e,0,0,d,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:n,data:b,compressed:a,levelSize:p,hasAlpha:i,format:c}}function TU(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=jw()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),uue[t]}function jw(){let r=xU();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}var EU={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:gU,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},KI={...EU,parse:wU};var due={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pue={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},JI=class{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;let i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:s,path:a})=>{xue(i,n,s,a),mue(s,s._node)})}},Gw=class{animations;constructor(e){this.animations=e.animations.map((t,i)=>{let n=t.name||`Animation-${i}`,s=t.samplers.map(({input:c,interpolation:d="LINEAR",output:p})=>({input:SU(e.accessors[c]),interpolation:d,output:SU(e.accessors[p])})),a=t.channels.map(({sampler:c,target:d})=>({sampler:s[c],target:e.nodes[d.node],path:d.path}));return new JI({name:n,channels:a})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}};function SU(r){if(!r._animation){let e=pue[r.componentType],t=due[r.type],i=t*r.count,{buffer:n,byteOffset:s}=r.bufferView.data,a=new e(n,s+(r.byteOffset||0),i);if(t===1)r._animation=Array.from(a);else{let c=[];for(let d=0;d<a.length;d+=t)c.push(Array.from(a.slice(d,d+t)));r._animation=c}}return r._animation}var Aue=new vr;function mue(r,e){if(e.matrix.identity(),r.translation&&e.matrix.translate(r.translation),r.rotation){let t=Aue.fromQuaternion(r.rotation);e.matrix.multiplyRight(t)}r.scale&&e.matrix.scale(r.scale)}var QI=new ml;function gue(r,e,t,i,n){if(e==="rotation"){QI.slerp({start:t,target:i,ratio:n});for(let s=0;s<QI.length;s++)r[e][s]=QI[s]}else for(let s=0;s<t.length;s++)r[e][s]=n*i[s]+(1-n)*t[s]}function _ue(r,e,{p0:t,outTangent0:i,inTangent1:n,p1:s,tDiff:a,ratio:c}){for(let d=0;d<r[e].length;d++){let p=i[d]*a,b=n[d]*a;r[e][d]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*t[d]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*p+(-2*Math.pow(c,3)+3*Math.pow(c,2))*s[d]+(Math.pow(c,3)-Math.pow(c,2))*b}}function yue(r,e,t){for(let i=0;i<t.length;i++)r[e][i]=t[i]}function xue(r,{input:e,interpolation:t,output:i},n,s){let a=e[e.length-1],c=r%a,d=e.findIndex(B=>B>=c),p=Math.max(0,d-1);if(!Array.isArray(n[s]))switch(s){case"translation":n[s]=[0,0,0];break;case"rotation":n[s]=[0,0,0,1];break;case"scale":n[s]=[1,1,1];break;default:Vt.warn(`Bad animation path ${s}`)()}let b=e[p],T=e[d];switch(t){case"STEP":yue(n,s,i[p]);break;case"LINEAR":if(T>b){let B=(c-b)/(T-b);gue(n,s,i[p],i[d],B)}break;case"CUBICSPLINE":if(T>b){let B=(c-b)/(T-b),z=T-b,G=i[3*p+1],Z=i[3*p+2],q=i[3*d+0],re=i[3*d+1];_ue(n,s,{p0:G,outTangent0:Z,inTangent1:q,p1:re,tDiff:z,ratio:B})}break;default:Vt.warn(`Interpolation ${t} not supported`)();break}}var bue=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,vue=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,wue=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function CU(r,e){let{id:t,geometry:i,material:n,vertexCount:s,materialOptions:a,modelOptions:c}=e,d=Vy(r,n,i.attributes,a);Vt.info(4,"createGLTFModel defines: ",d.defines)();let p=[],b={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},T={id:t,source:bue,vs:vue,fs:wue,geometry:i,topology:i.topology,vertexCount:s,modules:[wp],...c,defines:{...d.defines,...c.defines},parameters:{...b,...d.parameters,...c.parameters}},B=new hi(r,T),{camera:z,...G}={...d.uniforms,...c.uniforms,...d.bindings,...c.bindings};return B.shaderInputs.setProps({pbrMaterial:G,pbrProjection:{camera:z}}),new $f({managedResources:p,model:B})}var eA;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(eA||(eA={}));function IU(r){switch(r){case eA.POINTS:return"point-list";case eA.LINES:return"line-list";case eA.LINE_STRIP:return"line-strip";case eA.TRIANGLES:return"triangle-list";case eA.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(r))}}var Tue={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},Hw=class{device;options;gltf;constructor(e,t={}){this.device=e,this.options={...Tue,...t}}instantiate(e){return this.gltf=eP(e),(this.gltf.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new Gw(this.gltf):null}createScene(e){let i=(e.nodes||[]).map(s=>this.createNode(s));return new _h({id:e.name||e.id,children:i})}createNode(e){if(!e._node){let n=(e.children||[]).map(a=>this.createNode(a));e.mesh&&n.push(this.createMesh(e.mesh));let s=new _h({id:e.name||e.id,children:n});if(e.matrix)s.setMatrix(e.matrix);else{if(s.matrix.identity(),e.translation&&s.matrix.translate(e.translation),e.rotation){let a=new vr().fromQuaternion(e.rotation);s.matrix.multiplyRight(a)}e.scale&&s.matrix.scale(e.scale)}e._node=s}let t=this.gltf.nodes.find(i=>i.id===e.id);return t._node=e._node,e._node}createMesh(e){if(!e._mesh){let i=(e.primitives||[]).map((s,a)=>this.createPrimitive(s,a,e)),n=new _h({id:e.name||e.id,children:i});e._mesh=n}return e._mesh}createPrimitive(e,t,i){let n=e.name||`${i.name||i.id}-primitive-${t}`,s=IU(e.mode||4),a=e.indices?e.indices.count:this.getVertexCount(e.attributes),c=CU(this.device,{id:n,geometry:this.createGeometry(n,e,s),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:a});return c.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],c}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,t,i){let n={};for(let[s,a]of Object.entries(t.attributes)){let{components:c,size:d,value:p}=a;n[s]={size:d??c,value:p}}return new Xi({id:e,topology:i,indices:t.indices.value,attributes:n})}createBuffer(e,t){e.bufferView||(e.bufferView={});let{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[t]||(i.lumaBuffers[t]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}};function eP(r){if(ArrayBuffer.isView(r)||r instanceof ArrayBuffer||r instanceof ImageBitmap)return r;if(Array.isArray(r))return r.map(eP);if(r&&typeof r=="object"){let e={};for(let t in r)e[t]=eP(r[t]);return e}return r}function tP(r,e,t){let i=new Hw(r,t),n=i.instantiate(e),s=i.createAnimator();return{scenes:n,animator:s}}var rP={};Ms(rP,{createExtMeshFeatures:()=>Vue,decode:()=>kue,encode:()=>Fue,name:()=>Due});function qs(r,e){if(!r)throw new Error(e||"assert failed: gltf")}var Ww={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$w={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};var Eue=1.33,PU=["SCALAR","VEC2","VEC3","VEC4"],Sue=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Cue=new Map(Sue),Iue={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Pue={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Mue={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function qw(r){return PU[r-1]||PU[0]}function hd(r){let e=Cue.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function Am(r,e){let t=Mue[r.componentType],i=Iue[r.type],n=Pue[r.componentType],s=r.count*i,a=r.count*i*n;qs(a>=0&&a<=e.byteLength);let c=$w[r.componentType],d=Ww[r.type];return{ArrayType:t,length:s,byteLength:a,componentByteSize:c,numberOfComponentsInElement:d}}function jy(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];let i=e.map(a=>a.bufferView);t=t.filter(a=>!i.includes(a));let n=t.reduce((a,c)=>a+c.byteLength,0),s=e.reduce((a,c)=>{let{width:d,height:p}=c.image;return a+d*p},0);return n+Math.ceil(4*s*Eue)}function MU(r,e,t){let i=r.bufferViews[t];qs(i);let n=i.buffer,s=e[n];qs(s);let a=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,i.byteLength)}function RU(r,e,t){let i=typeof t=="number"?r.accessors?.[t]:t;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);let n=r.bufferViews?.[i.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);let{arrayBuffer:s,byteOffset:a}=e[n.buffer],c=(a||0)+(i.byteOffset||0)+(n.byteOffset||0),{ArrayType:d,length:p,componentByteSize:b,numberOfComponentsInElement:T}=Am(i,n),B=b*T,z=n.byteStride||B;if(typeof n.byteStride>"u"||n.byteStride===B)return new d(s,c,p);let G=new d(p);for(let Z=0;Z<i.count;Z++){let q=new d(s,c+Z*z,T);G.set(q,Z*T)}return G}function Rue(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}var Ki=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Rue(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){let t=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof t=="string"||typeof i=="string"}getExtension(e){let t=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return t?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;let i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);let t=e.buffer,i=this.gltf.buffers[t];qs(i);let n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){let t=this.getAccessor(e);return RU(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);let t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,s=t.byteOffset||0;return new Uint8Array(n,s,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){let n=e.extensions||{};n[t]=i}removeObjectExtension(e,t){let i=e?.extensions||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let n=this.json.extensionsRemoved;n.includes(t)||n.push(t)}delete i[t]}addExtension(e,t={}){return qs(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return qs(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){let{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){let{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];let n={mesh:t};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){let{attributes:t,indices:i,material:n,mode:s=4}=e,c={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(i){let d=this._addIndices(i);c.primitives[0].indices=d}return Number.isFinite(n)&&(c.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(c),this.json.meshes.length-1}addPointCloud(e){let i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,t){let i=lp(e),n=t||i?.mimeType,a={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e,t=0,i=this.byteLength){let n=e.byteLength;qs(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);let s={buffer:t,byteOffset:i,byteLength:n};return this.byteLength+=Bf(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){let i={bufferView:e,type:qw(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){let i=this.addBufferView(e),n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));let s={size:t.size,componentType:hd(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(s,t))}addTexture(e){let{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){let e=this.byteLength,t=new ArrayBuffer(e),i=new Uint8Array(t),n=0;for(let s of this.sourceBuffers||[])n=wE(s,i,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let i=!0;for(;i;){let n=e.indexOf(t);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){let t={};for(let i in e){let n=e[i],s=this._getGltfAttributeName(i),a=this.addBinaryBuffer(n.value,n);t[s]=a}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){let i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];let n=e.subarray(0,t);for(let s of n)i.min.push(s),i.max.push(s);for(let s=t;s<e.length;s+=t)for(let a=0;a<t;a++)i.min[0+a]=Math.min(i.min[0+a],e[s+a]),i.max[0+a]=Math.max(i.max[0+a],e[s+a]);return i}};function BU(r){return(r%1+1)%1}var LU={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Bue={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},OU={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Gy(r,e){return OU[e]*LU[r]}function mm(r,e,t,i){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;let n=r.getTypedArrayForBufferView(e),s=gm(n,"SCALAR",t,i+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function gm(r,e,t,i=1){let n=LU[e],s=Bue[t],a=OU[t],c=i*n,d=c*a,p=r.buffer,b=r.byteOffset;return b%a!==0&&(p=new Uint8Array(p).slice(b,b+d).buffer,b=0),new s(p,b,c)}function _m(r,e,t){let i=`TEXCOORD_${e.texCoord||0}`,n=t.attributes[i],s=r.getTypedArrayForAccessor(n),a=r.gltf.json,c=e.index,d=a.textures?.[c]?.source;if(typeof d<"u"){let p=a.images?.[d]?.mimeType,b=r.gltf.images?.[d];if(b&&typeof b.width<"u"){let T=[];for(let B=0;B<s.length;B+=2){let z=Lue(b,p,s,B,e.channels);T.push(z)}return T}}return[]}function Zw(r,e,t,i,n){if(!t?.length)return;let s=[];for(let b of t){let T=i.findIndex(B=>B===b);T===-1&&(T=i.push(b)-1),s.push(T)}let a=new Uint32Array(s),c=r.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength})-1,d=r.addBufferView(a,c,0),p=r.addAccessor(d,{size:1,componentType:hd(a),count:a.length});n.attributes[e]=p}function Lue(r,e,t,i,n=[0]){let s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=t[i],c=t[i+1],d=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(d=4);let p=Oue(a,c,r,d),b=0;for(let T of n){let B=typeof T=="number"?Object.values(s)[T]:s[T],z=p+B.offset,G=Hg(r);if(G.data.length<=z)throw new Error(`${G.data.length} <= ${z}`);let Z=G.data[z];b|=Z<<B.shift}return b}function Oue(r,e,t,i=1){let n=t.width,s=BU(r)*(n-1),a=Math.round(s),c=t.height,d=BU(e)*(c-1),p=Math.round(d),b=t.components?t.components:i;return(p*n+a)*b}function Xw(r,e,t,i,n){let s=[];for(let a=0;a<e;a++){let c=t[a],d=t[a+1]-t[a];if(d+c>i)break;let p=c/n,b=d/n;s.push(r.slice(p,p+b))}return s}function Yw(r,e,t){let i=[];for(let n=0;n<e;n++){let s=n*t;i.push(r.slice(s,s+t))}return i}function Kw(r,e,t,i){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){let n=[],s=new TextDecoder("utf8"),a=0;for(let c=0;c<r;c++){let d=i[c+1]-i[c];if(d+a<=e.length){let p=e.subarray(a,d+a),b=s.decode(p);n.push(b),a+=d}}return n}return[]}var ym="EXT_mesh_features",Due=ym;async function kue(r,e){let t=new Ki(r);Nue(t,e)}function Fue(r,e){let t=new Ki(r);return Uue(t,e),t.createBinaryChunk(),t.gltf}function Nue(r,e){let t=r.gltf.json;if(t.meshes)for(let i of t.meshes)for(let n of i.primitives)zue(r,n,e)}function zue(r,e,t){if(!t?.gltf?.loadBuffers)return;let n=e.extensions?.[ym]?.featureIds;if(n)for(let s of n){let a;if(typeof s.attribute<"u"){let c=`_FEATURE_ID_${s.attribute}`,d=e.attributes[c];a=r.getTypedArrayForAccessor(d)}else typeof s.texture<"u"&&t?.gltf?.loadImages?a=_m(r,s.texture,e):a=[];s.data=a}}function Uue(r,e){let t=r.gltf.json.meshes;if(t)for(let i of t)for(let n of i.primitives)jue(r,n)}function Vue(r,e,t,i){e.extensions||(e.extensions={});let n=e.extensions[ym];n||(n={featureIds:[]},e.extensions[ym]=n);let{featureIds:s}=n,a={featureCount:t.length,propertyTable:i,data:t};s.push(a),r.addObjectExtension(e,ym,n)}function jue(r,e){let t=e.extensions?.[ym];if(!t)return;let i=t.featureIds;i.forEach((n,s)=>{if(n.data){let{accessorKey:a,index:c}=Gue(e.attributes),d=new Uint32Array(n.data);i[s]={featureCount:d.length,propertyTable:n.propertyTable,attribute:c},r.gltf.buffers.push({arrayBuffer:d.buffer,byteOffset:d.byteOffset,byteLength:d.byteLength});let p=r.addBufferView(d),b=r.addAccessor(p,{size:1,componentType:hd(d),count:d.length});e.attributes[a]=b}})}function Gue(r){let e="_FEATURE_ID_",t=Object.keys(r).filter(s=>s.indexOf(e)===0),i=-1;for(let s of t){let a=Number(s.substring(e.length));a>i&&(i=a)}return i++,{accessorKey:`${e}${i}`,index:i}}var sP={};Ms(sP,{createExtStructuralMetadata:()=>hhe,decode:()=>Wue,encode:()=>$ue,name:()=>Hue});var xm="EXT_structural_metadata",Hue=xm;async function Wue(r,e){let t=new Ki(r);que(t,e)}function $ue(r,e){let t=new Ki(r);return che(t,e),t.createBinaryChunk(),t.gltf}function que(r,e){if(!e.gltf?.loadBuffers)return;let t=r.getExtension(xm);t&&(e.gltf?.loadImages&&Zue(r,t),Xue(r,t))}function Zue(r,e){let t=e.propertyTextures,i=r.gltf.json;if(t&&i.meshes)for(let n of i.meshes)for(let s of n.primitives)Kue(r,t,s,e)}function Xue(r,e){let t=e.schema;if(!t)return;let i=t.classes,n=e.propertyTables;if(i&&n)for(let s in i){let a=Yue(n,s);a&&Jue(r,t,a)}}function Yue(r,e){for(let t of r)if(t.class===e)return t;return null}function Kue(r,e,t,i){if(!e)return;let s=t.extensions?.[xm]?.propertyTextures;if(s)for(let a of s){let c=e[a];Que(r,c,t,i)}}function Que(r,e,t,i){if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);let n=e.class;for(let s in e.properties){let a=`${n}_${s}`,c=e.properties?.[s];if(!c)continue;c.data||(c.data=[]);let d=c.data,p=_m(r,c,t);p!==null&&(Zw(r,a,p,d,t),c.data=d,i.dataAttributeNames.push(a))}}function Jue(r,e,t){let i=e.classes?.[t.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);let n=t.count;for(let s in i.properties){let a=i.properties[s],c=t.properties?.[s];if(c){let d=ehe(r,e,a,n,c);c.data=d}}}function ehe(r,e,t,i,n){let s=[],a=n.values,c=r.getTypedArrayForBufferView(a),d=the(r,t,n,i),p=rhe(r,n,i);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=ihe(t,i,c,d);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{s=Kw(i,c,d,p);break}case"ENUM":{s=nhe(e,t,i,c,d);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return s}function the(r,e,t,i){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?mm(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",i):null}function rhe(r,e,t){return typeof e.stringOffsets<"u"?mm(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function ihe(r,e,t,i){let n=r.array,s=r.count,a=Gy(r.type,r.componentType),c=t.byteLength/a,d;return r.componentType?d=gm(t,r.type,r.componentType,c):d=t,n?i?Xw(d,e,i,t.length,a):s?Yw(d,e,s):[]:d}function nhe(r,e,t,i,n){let s=e.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let a=r.enums?.[s];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);let c=a.valueType||"UINT16",d=Gy(e.type,c),p=i.byteLength/d,b=gm(i,e.type,c,p);if(b||(b=i),e.array){if(n)return she({valuesData:b,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i.length,elementSize:d,enumEntry:a});let T=e.count;return T?ohe(b,t,T,a):[]}return nP(b,0,t,a)}function she(r){let{valuesData:e,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n,elementSize:s,enumEntry:a}=r,c=[];for(let d=0;d<t;d++){let p=i[d],b=i[d+1]-i[d];if(b+p>n)break;let T=p/s,B=b/s,z=nP(e,T,B,a);c.push(z)}return c}function ohe(r,e,t,i){let n=[];for(let s=0;s<e;s++){let a=t*s,c=nP(r,a,t,i);n.push(c)}return n}function nP(r,e,t,i){let n=[];for(let s=0;s<t;s++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)n.push("");else{let a=r[e+s],c=ahe(i,a);c?n.push(c.name):n.push("")}return n}function ahe(r,e){for(let t of r.values)if(t.value===e)return t;return null}var lhe="schemaClassId";function che(r,e){let t=r.getExtension(xm);if(t&&t.propertyTables)for(let i of t.propertyTables){let n=i.class,s=t.schema?.classes?.[n];i.properties&&s&&uhe(i,s,r)}}function uhe(r,e,t){for(let i in r.properties){let n=r.properties[i].data;if(n){let s=e.properties[i];if(s){let a=phe(n,s,t);r.properties[i]=a}}}}function hhe(r,e,t=lhe){let i=r.getExtension(xm);i||(i=r.addExtension(xm)),i.schema=fhe(e,t,i.schema);let n=dhe(e,t,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(n)-1}function fhe(r,e,t){let i=t??{id:"schema_id"},n={properties:{}};for(let s of r){let a={type:s.elementType,componentType:s.componentType};n.properties[s.name]=a}return i.classes={},i.classes[e]=n,i}function dhe(r,e,t){let i={class:e,count:0},n=0,s=t.classes?.[e];for(let a of r){if(n===0&&(n=a.values.length),n!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");s?.properties[a.name]&&(i.properties||(i.properties={}),i.properties[a.name]={values:0,data:a.values})}return i.count=n,i}function phe(r,e,t){let i={values:0};if(e.type==="STRING"){let{stringData:n,stringOffsets:s}=ghe(r);i.stringOffsets=iP(s,t),i.values=iP(n,t)}else if(e.type==="SCALAR"&&e.componentType){let n=mhe(r,e.componentType);i.values=iP(n,t)}return i}var Ahe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function mhe(r,e){let t=[];for(let n of r)t.push(Number(n));let i=Ahe[e];if(!i)throw new Error("Illegal component type");return new i(t)}function ghe(r){let e=new TextEncoder,t=[],i=0;for(let d of r){let p=e.encode(d);i+=p.length,t.push(p)}let n=new Uint8Array(i),s=[],a=0;for(let d of t)n.set(d,a),s.push(a),a+=d.length;s.push(a);let c=new Uint32Array(s);return{stringData:n,stringOffsets:c}}function iP(r,e){return e.gltf.buffers.push({arrayBuffer:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}),e.addBufferView(r)}var oP={};Ms(oP,{decode:()=>yhe,name:()=>_he});var DU="EXT_feature_metadata",_he=DU;async function yhe(r,e){let t=new Ki(r);xhe(t,e)}function xhe(r,e){if(!e.gltf?.loadBuffers)return;let t=r.getExtension(DU);t&&(e.gltf?.loadImages&&bhe(r,t),vhe(r,t))}function bhe(r,e){let t=e.schema;if(!t)return;let i=t.classes,{featureTextures:n}=e;if(i&&n)for(let s in i){let a=i[s],c=The(n,s);c&&She(r,c,a)}}function vhe(r,e){let t=e.schema;if(!t)return;let i=t.classes,n=e.featureTables;if(i&&n)for(let s in i){let a=whe(n,s);a&&Ehe(r,t,a)}}function whe(r,e){for(let t in r){let i=r[t];if(i.class===e)return i}return null}function The(r,e){for(let t in r){let i=r[t];if(i.class===e)return i}return null}function Ehe(r,e,t){if(!t.class)return;let i=e.classes?.[t.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);let n=t.count;for(let s in i.properties){let a=i.properties[s],c=t.properties?.[s];if(c){let d=Che(r,e,a,n,c);c.data=d}}}function She(r,e,t){let i=e.class;for(let n in t.properties){let s=e?.properties?.[n];if(s){let a=Bhe(r,s,i);s.data=a}}}function Che(r,e,t,i,n){let s=[],a=n.bufferView,c=r.getTypedArrayForBufferView(a),d=Ihe(r,t,n,i),p=Phe(r,t,n,i);return t.type==="STRING"||t.componentType==="STRING"?s=Kw(i,c,d,p):Mhe(t)&&(s=Rhe(t,i,c,d)),s}function Ihe(r,e,t,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?mm(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",i):null}function Phe(r,e,t,i){return typeof t.stringOffsetBufferView<"u"?mm(r,t.stringOffsetBufferView,t.offsetType||"UINT32",i):null}function Mhe(r){let e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function Rhe(r,e,t,i){let n=r.type==="ARRAY",s=r.componentCount,a="SCALAR",c=r.componentType||r.type,d=Gy(a,c),p=t.byteLength/d,b=gm(t,a,c,p);return n?i?Xw(b,e,i,t.length,d):s?Yw(b,e,s):[]:b}function Bhe(r,e,t){let i=r.gltf.json;if(!i.meshes)return[];let n=[];for(let s of i.meshes)for(let a of s.primitives)Lhe(r,t,e,n,a);return n}function Lhe(r,e,t,i,n){let s={channels:t.channels,...t.texture},a=_m(r,s,n);a&&Zw(r,e,a,i,n)}var kU="4.3.2";var bm=!0,FU=1735152710,cP=12,Qw=8,Ohe=1313821514,Dhe=5130562,khe=0,Fhe=0,Nhe=1;function zhe(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function NU(r,e=0,t={}){let i=new DataView(r),{magic:n=FU}=t,s=i.getUint32(e,!1);return s===n||s===FU}function zU(r,e,t=0,i={}){let n=new DataView(e),s=zhe(n,t+0),a=n.getUint32(t+4,bm),c=n.getUint32(t+8,bm);switch(Object.assign(r,{header:{byteOffset:t,byteLength:c,hasBinChunk:!1},type:s,version:a,json:{},binChunks:[]}),t+=cP,r.version){case 1:return Uhe(r,n,t);case 2:return Vhe(r,n,t,i={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function Uhe(r,e,t){Ti(r.header.byteLength>cP+Qw);let i=e.getUint32(t+0,bm),n=e.getUint32(t+4,bm);return t+=Qw,Ti(n===khe),aP(r,e,t,i),t+=i,t+=lP(r,e,t,r.header.byteLength),t}function Vhe(r,e,t,i){return Ti(r.header.byteLength>cP+Qw),jhe(r,e,t,i),t+r.header.byteLength}function jhe(r,e,t,i){for(;t+8<=r.header.byteLength;){let n=e.getUint32(t+0,bm),s=e.getUint32(t+4,bm);switch(t+=Qw,s){case Ohe:aP(r,e,t,n);break;case Dhe:lP(r,e,t,n);break;case Fhe:i.strict||aP(r,e,t,n);break;case Nhe:i.strict||lP(r,e,t,n);break;default:break}t+=Bf(n,4)}return t}function aP(r,e,t,i){let n=new Uint8Array(e.buffer,t,i),a=new TextDecoder("utf8").decode(n);return r.json=JSON.parse(a),Bf(i,4)}function lP(r,e,t,i){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:i,arrayBuffer:e.buffer}),Bf(i,4)}function uP(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;let i=e.baseUri||e.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return i.substr(0,i.lastIndexOf("/")+1)+r}var fP={};Ms(fP,{decode:()=>efe,name:()=>Jhe});var Ghe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Hhe="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Whe=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),$he=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),qhe={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Zhe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function UU(r,e,t,i,n,s="NONE"){let a=await Xhe();Qhe(a,a.exports[Zhe[n]],r,e,t,i,a.exports[qhe[s||"NONE"]])}var hP;async function Xhe(){return hP||(hP=Yhe()),hP}async function Yhe(){let r=Ghe;WebAssembly.validate(Whe)&&(r=Hhe,console.log("Warning: meshopt_decoder is using experimental SIMD support"));let e=await WebAssembly.instantiate(Khe(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function Khe(r){let e=new Uint8Array(r.length);for(let i=0;i<r.length;++i){let n=r.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let t=0;for(let i=0;i<r.length;++i)e[t++]=e[i]<60?$he[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,t)}function Qhe(r,e,t,i,n,s,a){let c=r.exports.sbrk,d=i+3&-4,p=c(d*n),b=c(s.length),T=new Uint8Array(r.exports.memory.buffer);T.set(s,b);let B=e(p,i,n,b,s.length);if(B===0&&a&&a(p,d,n),t.set(T.subarray(p,p+i*n)),c(p-c(0)),B!==0)throw new Error(`Malformed buffer data: ${B}`)}var Jw="EXT_meshopt_compression",Jhe=Jw;async function efe(r,e){let t=new Ki(r);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;let i=[];for(let n of r.json.bufferViews||[])i.push(tfe(t,n));await Promise.all(i),t.removeExtension(Jw)}async function tfe(r,e){let t=r.getObjectExtension(e,Jw);if(t){let{byteOffset:i=0,byteLength:n=0,byteStride:s,count:a,mode:c,filter:d="NONE",buffer:p}=t,b=r.gltf.buffers[p],T=new Uint8Array(b.arrayBuffer,b.byteOffset+i,n),B=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await UU(B,a,s,T,c,d),r.removeObjectExtension(e,Jw)}}var dP={};Ms(dP,{name:()=>rfe,preprocess:()=>ife});var vm="EXT_texture_webp",rfe=vm;function ife(r,e){let t=new Ki(r);if(!WE("image/webp")){if(t.getRequiredExtensions().includes(vm))throw new Error(`gltf: Required extension ${vm} not supported by browser`);return}let{json:i}=t;for(let n of i.textures||[]){let s=t.getObjectExtension(n,vm);s&&(n.source=s.source),t.removeObjectExtension(n,vm)}t.removeExtension(vm)}var pP={};Ms(pP,{name:()=>nfe,preprocess:()=>sfe});var e3="KHR_texture_basisu",nfe=e3;function sfe(r,e){let t=new Ki(r),{json:i}=t;for(let n of i.textures||[]){let s=t.getObjectExtension(n,e3);s&&(n.source=s.source,t.removeObjectExtension(n,e3))}t.removeExtension(e3)}var yP={};Ms(yP,{decode:()=>bfe,encode:()=>vfe,name:()=>yfe,preprocess:()=>xfe});var VU="4.3.2";var jU={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:VU,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function HU(r,e,t){let i=WU(e.metadata),n=[],s=ofe(e.attributes);for(let a in r){let c=r[a],d=GU(a,c,s[a]);n.push(d)}if(t){let a=GU("indices",t);n.push(a)}return{fields:n,metadata:i}}function ofe(r){let e={};for(let t in r){let i=r[t];e[i.name||"undefined"]=i}return e}function GU(r,e,t){let i=t?WU(t.metadata):void 0;return zE(r,e,i)}function WU(r){Object.entries(r);let e={};for(let t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}var $U={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},afe={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},lfe=4,Hy=class{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){let i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);let n=this.decoder.GetEncodedGeometryType(i),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(n){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(i,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(i,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){let B=`DRACO decompression failed: ${a.error_msg()}`;throw new Error(B)}let c=this._getDracoLoaderData(s,n,t),d=this._getMeshData(s,c,t),p=ch(d.attributes),b=HU(d.attributes,c,d.indices);return{loader:"draco",loaderData:c,header:{vertexCount:s.num_points(),boundingBox:p},...d,schema:b}}finally{this.draco.destroy(i),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,i){let n=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(e,t){let i={};for(let n=0;n<e.num_attributes();n++){let s=this.decoder.GetAttribute(e,n),a=this._getAttributeMetadata(e,n);i[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:a};let c=this._getQuantizationTransform(s,t);c&&(i[s.unique_id()].quantization_transform=c);let d=this._getOctahedronTransform(s,t);d&&(i[s.unique_id()].octahedron_transform=d)}return i}_getMeshData(e,t,i){let n=this._getMeshAttributes(t,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,i){let n={};for(let s of Object.values(e.attributes)){let a=this._deduceAttributeName(s,i);s.name=a;let c=this._getAttributeValues(t,s);if(c){let{value:d,size:p}=c;n[a]={value:d,size:p,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return n}_getTriangleListIndices(e){let i=e.num_faces()*3,n=i*lfe,s=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,s),new Uint32Array(this.draco.HEAPF32.buffer,s,i).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){let t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),hfe(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){let i=afe[t.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;let n=t.num_components,a=e.num_points()*n,c=a*i.BYTES_PER_ELEMENT,d=cfe(this.draco,i),p,b=this.draco._malloc(c);try{let T=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,T,d,c,b),p=new i(this.draco.HEAPF32.buffer,b,a).slice()}finally{this.draco._free(b)}return{value:p,size:n}}_deduceAttributeName(e,t){let i=e.unique_id;for(let[a,c]of Object.entries(t.extraAttributes||{}))if(c===i)return a;let n=e.attribute_type;for(let a in $U)if(this.draco[a]===n)return $U[a];let s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){let t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){let i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};let t={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){let s=this.metadataQuerier.GetEntryName(e,n);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){let i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);let n=ufe(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){let{quantizedAttributes:t=[],octahedronAttributes:i=[]}=e,n=[...t,...i];for(let s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,t){let{quantizedAttributes:i=[]}=t,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){let a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(c=>a.min_value(c))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,t){let{octahedronAttributes:i=[]}=t,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){let a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}};function cfe(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function ufe(r){let e=r.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=r.GetValue(i);return t}function hfe(r){let e=r.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=r.GetValue(i);return t}var ffe="1.5.6",dfe="1.4.1",AP=`https://www.gstatic.com/draco/versioned/decoders/${ffe}`,_a={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},mP={[_a.DECODER]:`${AP}/${_a.DECODER}`,[_a.DECODER_WASM]:`${AP}/${_a.DECODER_WASM}`,[_a.FALLBACK_DECODER]:`${AP}/${_a.FALLBACK_DECODER}`,[_a.ENCODER]:`https://raw.githubusercontent.com/google/draco/${dfe}/javascript/${_a.ENCODER}`},gP;async function qU(r){let e=r.modules||{};return e.draco3d?gP||=e.draco3d.createDecoderModule({}).then(t=>({draco:t})):gP||=pfe(r),await gP}async function pfe(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await tu(mP[_a.FALLBACK_DECODER],"draco",r,_a.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await tu(mP[_a.DECODER],"draco",r,_a.DECODER),await tu(mP[_a.DECODER_WASM],"draco",r,_a.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await Afe(e,t)}function Afe(r,e){let t={};return e&&(t.wasmBinary=e),new Promise(i=>{r({...t,onModuleLoaded:n=>i({draco:n})})})}var t3={...jU,parse:mfe};async function mfe(r,e){let{draco:t}=await qU(e),i=new Hy(t);try{return i.parseSync(r,e?.draco)}finally{i.destroy()}}function ZU(r){let e={};for(let t in r){let i=r[t];if(t!=="indices"){let n=_P(i);e[t]=n}}return e}function _P(r){let{buffer:e,size:t,count:i}=gfe(r);return{value:e,size:t,byteOffset:0,count:i,type:qw(t),componentType:hd(e)}}function gfe(r){let e=r,t=1,i=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=_fe(e,Float32Array)),i=e.length/t),{buffer:e,size:t,count:i}}function _fe(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}var fd="KHR_draco_mesh_compression",yfe=fd;function xfe(r,e,t){let i=new Ki(r);for(let n of XU(i))i.getObjectExtension(n,fd)}async function bfe(r,e,t){if(!e?.gltf?.decompressMeshes)return;let i=new Ki(r),n=[];for(let s of XU(i))i.getObjectExtension(s,fd)&&n.push(wfe(i,s,e,t));await Promise.all(n),i.removeExtension(fd)}function vfe(r,e={}){let t=new Ki(r);for(let i of t.json.meshes||[])Tfe(i,e),t.addRequiredExtension(fd)}async function wfe(r,e,t,i){let n=r.getObjectExtension(e,fd);if(!n)return;let s=r.getTypedArrayForBufferView(n.bufferView),a=np(s.buffer,s.byteOffset),c={...t};delete c["3d-tiles"];let d=await za(a,t3,c,i),p=ZU(d.attributes);for(let[b,T]of Object.entries(p))if(b in e.attributes){let B=e.attributes[b],z=r.getAccessor(B);z?.min&&z?.max&&(T.min=z.min,T.max=z.max)}e.attributes=p,d.indices&&(e.indices=_P(d.indices)),r.removeObjectExtension(e,fd),Efe(e)}function Tfe(r,e,t=4,i,n){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");let s=i.DracoWriter.encodeSync({attributes:r}),a=n?.parseSync?.({attributes:r}),c=i._addFauxAttributes(a.attributes),d=i.addBufferView(s);return{primitives:[{attributes:c,mode:t,extensions:{[fd]:{bufferView:d,attributes:c}}}]}}function Efe(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*XU(r){for(let e of r.json.meshes||[])for(let t of e.primitives)yield t}var xP={};Ms(xP,{decode:()=>Pfe,name:()=>Sfe});var i3="KHR_texture_transform",Sfe=i3,r3=new st,Cfe=new nn,Ife=new nn;async function Pfe(r,e){if(!new Ki(r).hasExtension(i3)||!e.gltf?.loadBuffers)return;let n=r.json.materials||[];for(let s=0;s<n.length;s++)Mfe(s,r)}function Mfe(r,e){let t=e.json.materials?.[r],i=[t?.pbrMetallicRoughness?.baseColorTexture,t?.emissiveTexture,t?.normalTexture,t?.occlusionTexture,t?.pbrMetallicRoughness?.metallicRoughnessTexture],n=[];for(let s of i)s&&s?.extensions?.[i3]&&Rfe(e,r,s,n)}function Rfe(r,e,t,i){let n=Bfe(t,i);if(!n)return;let s=r.json.meshes||[];for(let a of s)for(let c of a.primitives){let d=c.material;Number.isFinite(d)&&e===d&&Lfe(r,c,n)}}function Bfe(r,e){let t=r.extensions?.[i3],{texCoord:i=0}=r,{texCoord:n=i}=t;if(!(e.findIndex(([a,c])=>a===i&&c===n)!==-1)){let a=kfe(t);return i!==n&&(r.texCoord=n),e.push([i,n]),{originalTexCoord:i,texCoord:n,matrix:a}}return null}function Lfe(r,e,t){let{originalTexCoord:i,texCoord:n,matrix:s}=t,a=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(a)){let c=r.json.accessors?.[a];if(c&&c.bufferView){let d=r.json.bufferViews?.[c.bufferView];if(d){let{arrayBuffer:p,byteOffset:b}=r.buffers[d.buffer],T=(b||0)+(c.byteOffset||0)+(d.byteOffset||0),{ArrayType:B,length:z}=Am(c,d),G=$w[c.componentType],Z=Ww[c.type],q=d.byteStride||G*Z,re=new Float32Array(z);for(let ee=0;ee<c.count;ee++){let ae=new B(p,T+ee*q,2);r3.set(ae[0],ae[1],1),r3.transformByMatrix3(s),re.set([r3[0],r3[1]],ee*Z)}i===n?Ofe(c,d,r.buffers,re):Dfe(n,c,e,r,re)}}}}function Ofe(r,e,t,i){r.componentType=5126,t.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function Dfe(r,e,t,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});let s=i.json.bufferViews;if(!s)return;s.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});let a=i.json.accessors;a&&(a.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=a.length-1)}function kfe(r){let{offset:e=[0,0],rotation:t=0,scale:i=[1,1]}=r,n=new nn().set(1,0,0,0,1,0,e[0],e[1],1),s=Cfe.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),a=Ife.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(s).multiplyRight(a)}var bP={};Ms(bP,{decode:()=>Nfe,encode:()=>zfe,name:()=>Ffe});var tA="KHR_lights_punctual",Ffe=tA;async function Nfe(r){let e=new Ki(r),{json:t}=e,i=e.getExtension(tA);i&&(e.json.lights=i.lights,e.removeExtension(tA));for(let n of t.nodes||[]){let s=e.getObjectExtension(n,tA);s&&(n.light=s.light),e.removeObjectExtension(n,tA)}}async function zfe(r){let e=new Ki(r),{json:t}=e;if(t.lights){let i=e.addExtension(tA);qs(!i.lights),i.lights=t.lights,delete t.lights}if(e.json.lights){for(let i of e.json.lights){let n=i.node;e.addObjectExtension(n,tA,i)}delete e.json.lights}}var vP={};Ms(vP,{decode:()=>Vfe,encode:()=>jfe,name:()=>Ufe});var Wy="KHR_materials_unlit",Ufe=Wy;async function Vfe(r){let e=new Ki(r),{json:t}=e;for(let i of t.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,Wy);e.removeExtension(Wy)}function jfe(r){let e=new Ki(r),{json:t}=e;if(e.materials)for(let i of t.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,Wy,{}),e.addExtension(Wy))}var wP={};Ms(wP,{decode:()=>Hfe,encode:()=>Wfe,name:()=>Gfe});var $y="KHR_techniques_webgl",Gfe=$y;async function Hfe(r){let e=new Ki(r),{json:t}=e,i=e.getExtension($y);if(i){let n=$fe(i,e);for(let s of t.materials||[]){let a=e.getObjectExtension(s,$y);a&&(s.technique=Object.assign({},a,n[a.technique]),s.technique.values=qfe(s.technique,e)),e.removeObjectExtension(s,$y)}e.removeExtension($y)}}async function Wfe(r,e){}function $fe(r,e){let{programs:t=[],shaders:i=[],techniques:n=[]}=r,s=new TextDecoder;return i.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(a=>{a.fragmentShader=i[a.fragmentShader],a.vertexShader=i[a.vertexShader]}),n.forEach(a=>{a.program=t[a.program]}),n}function qfe(r,e){let t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(i=>{r.uniforms[i].value&&!(i in t)&&(t[i]=r.uniforms[i].value)}),Object.keys(t).forEach(i=>{typeof t[i]=="object"&&t[i].index!==void 0&&(t[i].texture=e.getTexture(t[i].index))}),t}var YU=[sP,rP,fP,dP,pP,yP,bP,vP,wP,xP,oP];function KU(r,e={},t){let i=YU.filter(n=>JU(n.name,e));for(let n of i)n.preprocess?.(r,e,t)}async function QU(r,e={},t){let i=YU.filter(n=>JU(n.name,e));for(let n of i)await n.decode?.(r,e,t)}function JU(r,e){let t=e?.gltf?.excludeExtensions||{};return!(r in t&&!t[r])}var TP="KHR_binary_glTF";function eV(r){let e=new Ki(r),{json:t}=e;for(let i of t.images||[]){let n=e.getObjectExtension(i,TP);n&&Object.assign(i,n),e.removeObjectExtension(i,TP)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(TP)}var tV={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Xfe={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},EP=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,t){this.json=e.json;let i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),eV(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(let t in tV)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){let i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(let n in i){let s=i[n];s.id=s.id||n;let a=e[t].length;e[t].push(s),this.idToIndexMap[t][n]=a}}}_convertObjectIdsToArrayIndices(e){for(let t in tV)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(let t of e.textures)this._convertTextureIds(t);for(let t of e.meshes)this._convertMeshIds(t);for(let t of e.nodes)this._convertNodeIds(t);for(let t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(let t of e.primitives){let{attributes:i,indices:n,material:s}=t;for(let a in i)i[a]=this._convertIdToIndex(i[a],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(let i of e[t])for(let n in i){let s=i[n],a=this._convertIdToIndex(s,n);i[n]=a}}_convertIdToIndex(e,t){let i=Xfe[t];if(i in this.idToIndexMap){let n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return n}return e}_updateObjects(e){for(let t of this.json.buffers)delete t.type}_updateMaterial(e){for(let t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let i=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,n=e.textures.findIndex(s=>s.id===i);n!==-1&&(t.pbrMetallicRoughness.baseColorTexture={index:n})}}};function rV(r,e={}){return new EP().normalize(r,e)}async function iV(r,e,t=0,i,n){return Yfe(r,e,t,i),rV(r,{normalize:i?.gltf?.normalize}),KU(r,i,n),i?.gltf?.loadBuffers&&r.json.buffers&&await Kfe(r,i,n),i?.gltf?.loadImages&&await Qfe(r,i,n),await QU(r,i,n),r}function Yfe(r,e,t,i){if(i.uri&&(r.baseUri=i.uri),e instanceof ArrayBuffer&&!NU(e,t,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=xE(e);else if(e instanceof ArrayBuffer){let a={};t=zU(a,e,t,i.glb),qs(a.type==="glTF",`Invalid GLB magic string ${a.type}`),r._glb=a,r.json=a.json}else qs(!1,"GLTF: must be ArrayBuffer or string");let n=r.json.buffers||[];if(r.buffers=new Array(n.length).fill(null),r._glb&&r._glb.header.hasBinChunk){let{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}let s=r.json.images||[];r.images=new Array(s.length).fill({})}async function Kfe(r,e,t){let i=r.json.buffers||[];for(let n=0;n<i.length;++n){let s=i[n];if(s.uri){let{fetch:a}=t;qs(a);let c=uP(s.uri,e),p=await(await t?.fetch?.(c))?.arrayBuffer?.();r.buffers[n]={arrayBuffer:p,byteOffset:0,byteLength:p.byteLength},delete s.uri}else r.buffers[n]===null&&(r.buffers[n]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function Qfe(r,e,t){let i=Jfe(r),n=r.json.images||[],s=[];for(let a of i)s.push(ede(r,n[a],a,e,t));return await Promise.all(s)}function Jfe(r){let e=new Set,t=r.json.textures||[];for(let i of t)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function ede(r,e,t,i,n){let s;if(e.uri&&!e.hasOwnProperty("bufferView")){let c=uP(e.uri,i),{fetch:d}=n;s=await(await d(c)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){let c=MU(r.json,r.buffers,e.bufferView);s=np(c.buffer,c.byteOffset,c.byteLength)}qs(s,"glTF image has no data");let a=await za(s,[Of,KI],{...i,mimeType:e.mimeType,basis:i.basis||{format:jw()}},n);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),r.images=r.images||[],r.images[t]=a}var Ch={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:kU,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:tde,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function tde(r,e={},t){e={...Ch.options,...e},e.gltf={...Ch.options.gltf,...e.gltf};let{byteOffset:i=0}=e;return await iV({},r,i,e,t)}var rde={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ide={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},vl={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},nde={magFilter:vl.TEXTURE_MAG_FILTER,minFilter:vl.TEXTURE_MIN_FILTER,wrapS:vl.TEXTURE_WRAP_S,wrapT:vl.TEXTURE_WRAP_T},sde={[vl.TEXTURE_MAG_FILTER]:vl.LINEAR,[vl.TEXTURE_MIN_FILTER]:vl.NEAREST_MIPMAP_LINEAR,[vl.TEXTURE_WRAP_S]:vl.REPEAT,[vl.TEXTURE_WRAP_T]:vl.REPEAT};function ode(){return{id:"default-sampler",parameters:sde}}function ade(r){return ide[r]}function lde(r){return rde[r]}var SP=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,t={}){let{json:i,buffers:n=[],images:s=[]}=e,{baseUri:a=""}=e;return qs(i),this.baseUri=a,this.buffers=n,this.images=s,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){let i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,s)=>this._resolveBufferView(n,s))),e.images&&(i.images=e.images.map((n,s)=>this._resolveImage(n,s))),e.samplers&&(i.samplers=e.samplers.map((n,s)=>this._resolveSampler(n,s))),e.textures&&(i.textures=e.textures.map((n,s)=>this._resolveTexture(n,s))),e.accessors&&(i.accessors=e.accessors.map((n,s)=>this._resolveAccessor(n,s))),e.materials&&(i.materials=e.materials.map((n,s)=>this._resolveMaterial(n,s))),e.meshes&&(i.meshes=e.meshes.map((n,s)=>this._resolveMesh(n,s))),e.nodes&&(i.nodes=e.nodes.map((n,s)=>this._resolveNode(n,s)),i.nodes=i.nodes.map((n,s)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,s)=>this._resolveSkin(n,s))),e.scenes&&(i.scenes=e.scenes.map((n,s)=>this._resolveScene(n,s))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;let i=e&&e[t];return i||console.warn(`glTF file error: Could not find ${e}[${t}]`),i}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,t){let i={...e,id:e?.id||`node-${t}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,s)=>{let a=this.getMesh(s);return n.id=a.id,n.primitives=n.primitives.concat(a.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){let i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:i}}_resolveMesh(e,t){let i={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{let s={...n,attributes:{},indices:void 0,material:void 0},a=n.attributes;for(let c in a)s.attributes[c]=this.getAccessor(a[c]);return n.indices!==void 0&&(s.indices=this.getAccessor(n.indices)),n.material!==void 0&&(s.material=this.getMaterial(n.material)),s})),i}_resolveMaterial(e,t){let i={...e,id:e.id||`material-${t}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};let n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,t){let i=ade(e.componentType),n=lde(e.type),s=i*n,a={...e,id:e.id||`accessor-${t}`,bytesPerComponent:i,components:n,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){let c=a.bufferView.buffer,{ArrayType:d,byteLength:p}=Am(a,a.bufferView),b=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+c.byteOffset,T=c.arrayBuffer.slice(b,b+p);a.bufferView.byteStride&&(T=this._getValueFromInterleavedBuffer(c,b,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new d(T)}return a}_getValueFromInterleavedBuffer(e,t,i,n,s){let a=new Uint8Array(s*n);for(let c=0;c<s;c++){let d=t+c*i;a.set(new Uint8Array(e.arrayBuffer.slice(d,d+n)),c*n)}return a.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):ode(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){let i={id:e.id||`sampler-${t}`,...e,parameters:{}};for(let n in i){let s=this._enumSamplerParameter(n);s!==void 0&&(i.parameters[s]=i[n])}return i}_enumSamplerParameter(e){return nde[e]}_resolveImage(e,t){let i={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[t];return n&&(i.image=n),i}_resolveBufferView(e,t){let i=e.buffer,n=this.buffers[i].arrayBuffer,s=this.buffers[i].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,s,e.byteLength)}}_resolveCamera(e,t){let i={...e,id:e.id||`camera-${t}`};return i.perspective,i.orthographic,i}};function rA(r,e){return new SP().postProcess(r,e)}async function nV(r){let e=[];return r.scenes.forEach(t=>{t.traverse(i=>{Object.values(i.model.uniforms).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await cde(()=>e.some(t=>!t.loaded))}async function cde(r){for(;r();)await new Promise(e=>requestAnimationFrame(e))}var sV=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,oV={name:"scenegraph",vs:sV,fs:sV,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}};var aV=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var lV=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var cV=[255,255,255,255],ude={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:cV},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Ch]},qy=class extends sn{getShaders(){let e={},t;this.props._lighting==="pbr"?(t=wp,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};let i=[Pi,wn,oV,t];return super.getShaders({defines:e,vs:aV,fs:lV,modules:i})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:cV,transition:!0},instanceModelMatrix:Nw})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e;t.scenegraph!==i.scenegraph?this._updateScenegraph():t._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){let e=this.props,{device:t}=this.context,i=null;if(e.scenegraph instanceof pu)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){let c=e.scenegraph,d=c.json?rA(c):c,p=tP(t,d,this._getModelOptions());i={gltf:d,...p},nV(p).then(()=>{this.setNeedsRedraw()}).catch(b=>{this.raiseError(b,"loading glTF")})}let n={layer:this,device:this.context.device},s=e.getScene(i,n),a=e.getAnimator(i,n);if(s instanceof _h){this.state.scenegraph?.destroy(),this._applyAnimationsProp(a,e._animations);let c=[];s.traverse(d=>{d instanceof $f&&c.push(d.model)}),this.setState({scenegraph:s,animator:a,models:c}),this.getAttributeManager().invalidateAll()}else s!==null&&cr.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,t){if(!e||!t)return;let i=e.getAnimations();Object.keys(t).sort().forEach(n=>{let s=t[n];if(n==="*")i.forEach(a=>{Object.assign(a,s)});else if(Number.isFinite(Number(n))){let a=Number(n);a>=0&&a<i.length?Object.assign(i[a],s):cr.warn(`animation ${n} not found`)()}else{let a=i.find(({name:c})=>c===n);a?Object.assign(a,s):cr.warn(`animation ${n} not found`)()}})}_getModelOptions(){let{_imageBasedLightingEnvironment:e}=this.props,t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());let{viewport:t,renderPass:i}=this.context,{sizeScale:n,sizeMinPixels:s,sizeMaxPixels:a,coordinateSystem:c}=this.props,d=this.getNumInstances();this.state.scenegraph.traverse((p,{worldMatrix:b})=>{if(p instanceof $f){let{model:T}=p;T.setInstanceCount(d);let B={camera:T.uniforms.cameraPosition},z={sizeScale:n,sizeMinPixels:s,sizeMaxPixels:a,composeModelMatrix:zw(t,c),sceneModelMatrix:b};T.shaderInputs.setProps({pbrProjection:B,scenegraph:z}),T.draw(i)}})}};qy.defaultProps=ude;qy.layerName="ScenegraphLayer";var CP=qy;var uV=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,hV={name:"mesh",vs:uV,fs:uV,uniformTypes:{pickFeatureIds:"f32"}};var fV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var dV=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function hde(r){let e=r.positions||r.POSITION,t=e.value.length/e.size;r.COLOR_0||r.colors||(r.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}var fde={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},Zy=class extends pm{getShaders(){let e=super.getShaders();return e.modules.push(wp,hV),{...e,vs:fV,fs:dV}}initializeState(){let{featureIds:e}=this.props;super.initializeState();let t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);let{props:t,oldProps:i}=e;t.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){let{featureIds:t}=this.props,{model:i}=this.state;if(!i)return;let n={pickFeatureIds:!!t},s={camera:i.uniforms.cameraPosition};i.shaderInputs.setProps({pbrProjection:s,mesh:n}),super.draw(e)}getModel(e){let{id:t}=this.props,i=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:i});let n=this.getShaders();return hde(e.attributes),new hi(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...n.defines,...i?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:i?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){let{model:t}=this.state;if(t){let{mesh:i}=this.props,n=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:n});let{pbr_baseColorSampler:s}=n.bindings,{emptyTexture:a}=this.state,c={sampler:s||a,hasTexture:!!s},{camera:d,...p}={...n.bindings,...n.uniforms};t.shaderInputs.setProps({simpleMesh:c,pbrMaterial:p})}}parseMaterial(e,t){let i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return Vy(this.context.device,{unlit:i,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){let t=this.props.featureIds,i=new Uint8ClampedArray(t.length*e.size),n=[];for(let s=0;s<t.length;s++)this.encodePickingColor(t[s],n),i[s*3]=n[0],i[s*3+1]=n[1],i[s*3+2]=n[2];e.value=i}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(t=>t.destroy()),this.setState({parsedPBRMaterial:null})}};Zy.layerName="MeshLayer";Zy.defaultProps=fde;var pV=Zy;var Ih=6356752314245179e-9,dde={radii:[6378137,6378137,Ih],radiiSquared:[6378137*6378137,6378137*6378137,Ih*Ih],oneOverRadii:[1/6378137,1/6378137,1/Ih],oneOverRadiiSquared:[1/(6378137*6378137),1/(6378137*6378137),1/(Ih*Ih)],maximumRadius:Math.max(6378137,6378137,Ih),centerToleranceSquared:.1};function n3(r){return r}var AWe=new st;function pde(r,e=[],t=n3){return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function AV(r,e=[]){return pde(r,e,In._cartographicRadians?n3:FS)}function Ade(r,e,t=n3){return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function mV(r,e){return Ade(r,e,In._cartographicRadians?n3:NS)}var gV=1e-14,mde=new st,_V={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},IP={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Xy={east:new st,north:new st,up:new st,west:new st,south:new st,down:new st},gde=new st,_de=new st,yde=new st;function PP(r,e,t,i,n,s){let a=_V[e]&&_V[e][t];lo(a&&(!i||i===a));let c,d,p,b=mde.copy(n);if(Bs(b.x,0,gV)&&Bs(b.y,0,gV)){let B=Math.sign(b.z);c=gde.fromArray(IP[e]),e!=="east"&&e!=="west"&&c.scale(B),d=_de.fromArray(IP[t]),t!=="east"&&t!=="west"&&d.scale(B),p=yde.fromArray(IP[i]),i!=="east"&&i!=="west"&&p.scale(B)}else{let{up:B,east:z,north:G}=Xy;z.set(-b.y,b.x,0).normalize(),r.geodeticSurfaceNormal(b,B),G.copy(B).cross(z);let{down:Z,west:q,south:re}=Xy;Z.copy(B).scale(-1),q.copy(z).scale(-1),re.copy(G).scale(-1),c=Xy[e],d=Xy[t],p=Xy[i]}return s[0]=c.x,s[1]=c.y,s[2]=c.z,s[3]=0,s[4]=d.x,s[5]=d.y,s[6]=d.z,s[7]=0,s[8]=p.x,s[9]=p.y,s[10]=p.z,s[11]=0,s[12]=b.x,s[13]=b.y,s[14]=b.z,s[15]=1,s}var wm=new st,xde=new st,bde=new st;function yV(r,e,t=[]){let{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:s}=e;wm.from(r);let a=wm.x,c=wm.y,d=wm.z,p=i.x,b=i.y,T=i.z,B=a*a*p*p,z=c*c*b*b,G=d*d*T*T,Z=B+z+G,q=Math.sqrt(1/Z);if(!Number.isFinite(q))return;let re=xde;if(re.copy(r).scale(q),Z<s)return re.to(t);let ee=n.x,ae=n.y,me=n.z,Le=bde;Le.set(re.x*ee*2,re.y*ae*2,re.z*me*2);let je=(1-q)*wm.len()/(.5*Le.len()),Je=0,J,te,X,ye;do{je-=Je,J=1/(1+je*ee),te=1/(1+je*ae),X=1/(1+je*me);let _e=J*J,Oe=te*te,ve=X*X,De=_e*J,Xe=Oe*te,rt=ve*X;ye=B*_e+z*Oe+G*ve-1;let yt=-2*(B*De*ee+z*Xe*ae+G*rt*me);Je=ye/yt}while(Math.abs(ye)>lc.EPSILON12);return wm.scale([J,te,X]).to(t)}var s3=new st,xV=new st,Tde=new st,bc=new st,Ede=new st,o3=new st,Mi=class{constructor(e=0,t=0,i=0){this.centerToleranceSquared=lc.EPSILON1,lo(e>=0),lo(t>=0),lo(i>=0),this.radii=new st(e,t,i),this.radiiSquared=new st(e*e,t*t,i*i),this.radiiToTheFourth=new st(e*e*e*e,t*t*t*t,i*i*i*i),this.oneOverRadii=new st(e===0?0:1/e,t===0?0:1/t,i===0?0:1/i),this.oneOverRadiiSquared=new st(e===0?0:1/(e*e),t===0?0:1/(t*t),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,t,i),this.maximumRadius=Math.max(e,t,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){let i=xV,n=Tde,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,i),n.copy(this.radiiSquared).scale(i);let a=Math.sqrt(i.dot(n));return n.scale(1/a),i.scale(s),n.add(i),n.to(t)}cartesianToCartographic(e,t=[0,0,0]){o3.from(e);let i=this.scaleToGeodeticSurface(o3,bc);if(!i)return;let n=this.geodeticSurfaceNormal(i,xV),s=Ede;s.copy(o3).subtract(i);let a=Math.atan2(n.y,n.x),c=Math.asin(n.z),d=Math.sign(To.dot(s,o3))*To.length(s);return mV([a,c,d],t)}eastNorthUpToFixedFrame(e,t=new vr){return PP(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,i,n,s=new vr){return PP(this,e,t,i,n,s)}geocentricSurfaceNormal(e,t=[0,0,0]){return s3.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){let i=AV(e),n=i[0],s=i[1],a=Math.cos(s);return s3.set(a*Math.cos(n),a*Math.sin(n),Math.sin(s)).normalize(),s3.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return s3.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return yV(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){bc.from(e);let i=bc.x,n=bc.y,s=bc.z,a=this.oneOverRadiiSquared,c=1/Math.sqrt(i*i*a.x+n*n*a.y+s*s*a.z);return bc.multiplyScalar(c).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return bc.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return bc.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,i=[0,0,0]){lo(Bs(this.radii.x,this.radii.y,lc.EPSILON15)),lo(this.radii.z>0),bc.from(e);let n=bc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return bc.set(0,0,n).to(i)}};Mi.WGS84=new Mi(6378137,6378137,Ih);var a3=class{item;previous;next;constructor(e,t,i){this.item=e,this.previous=t,this.next=i}};var l3=class{head=null;tail=null;_length=0;get length(){return this._length}add(e){let t=new a3(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){let i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length}};var c3=class{_list;_sentinel;_trimTiles;constructor(){this._list=new l3,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){let t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,i){t._cacheNode||(t._cacheNode=this._list.add(t),i&&i(e,t))}unloadTile(e,t,i){let n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,i&&i(e,t))}unloadTiles(e,t){let i=this._trimTiles;this._trimTiles=!1;let n=this._list,s=e.maximumMemoryUsage*1024*1024,a=this._sentinel,c=n.head;for(;c!==a&&(e.gpuMemoryUsageInBytes>s||i);){let d=c.item;c=c.next,this.unloadTile(e,d,t)}}trim(){this._trimTiles=!0}};function bV(r,e){Ti(r),Ti(e);let{rtcCenter:t,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:s}}=r,a=new vr(n);switch(t&&a.translate(t),i){case"Z":break;case"Y":let T=new vr().rotateX(Math.PI/2);a=a.multiplyRight(T);break;case"X":let B=new vr().rotateY(-Math.PI/2);a=a.multiplyRight(B);break;default:break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);let c=new st(s);e.cartesianModelMatrix=a,e.cartesianOrigin=c;let d=Mi.WGS84.cartesianToCartographic(c,new st),b=Mi.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=b.multiplyRight(a),e.cartographicOrigin=d,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}var vV=new st,MP=new st,RP=new Qo([new Oo,new Oo,new Oo,new Oo,new Oo,new Oo]);function TV(r,e){let{cameraDirection:t,cameraUp:i,height:n}=r,{metersPerUnit:s}=r.distanceScales,a=u3(r,r.center),c=Mi.WGS84.eastNorthUpToFixedFrame(a),d=r.unprojectPosition(r.cameraPosition),p=Mi.WGS84.cartographicToCartesian(d,new st),b=new st(c.transformAsVector(new st(t).scale(s))).normalize(),T=new st(c.transformAsVector(new st(i).scale(s))).normalize();Sde(r);let B=r.constructor,{longitude:z,latitude:G,width:Z,bearing:q,zoom:re}=r,ee=new B({longitude:z,latitude:G,height:n,width:Z,bearing:q,zoom:re,pitch:0});return{camera:{position:p,direction:b,up:T},viewport:r,topDownViewport:ee,height:n,cullingVolume:RP,frameNumber:e,sseDenominator:1.15}}function EV(r,e,t){if(t===0||r.length<=t)return[r,[]];let i=[],{longitude:n,latitude:s}=e.viewport;for(let[p,b]of r.entries()){let[T,B]=b.header.mbs,z=Math.abs(n-T),G=Math.abs(s-B),Z=Math.sqrt(G*G+z*z);i.push([p,Z])}let a=i.sort((p,b)=>p[1]-b[1]),c=[];for(let p=0;p<t;p++)c.push(r[a[p][0]]);let d=[];for(let p=t;p<a.length;p++)d.push(r[a[p][0]]);return[c,d]}function Sde(r){let e=r.getFrustumPlanes(),t=wV(e.near,r.cameraPosition),i=u3(r,t),n=u3(r,r.cameraPosition,MP),s=0;RP.planes[s++].fromPointNormal(i,vV.copy(i).subtract(n));for(let a in e){if(a==="near")continue;let c=e[a],d=wV(c,t,MP),p=u3(r,d,MP);RP.planes[s++].fromPointNormal(p,vV.copy(i).subtract(p))}}function wV(r,e,t=new st){let i=r.normal.dot(e);return t.copy(r.normal).scale(r.distance-i).add(e),t}function u3(r,e,t=new st){let i=r.unprojectPosition(e);return Mi.WGS84.cartographicToCartesian(i,t)}var Cde=6378137,Ide=6378137,BP=6356752314245179e-9,Tm=new st;function SV(r,e){if(r instanceof Eh){let{halfAxes:t}=r,i=Pde(t);return Math.log2(BP/(i+e[2]))}else if(r instanceof Su){let{radius:t}=r;return Math.log2(BP/(t+e[2]))}else if(r.width&&r.height){let{width:t,height:i}=r,n=Math.log2(Cde/t),s=Math.log2(Ide/i);return(n+s)/2}return 1}function LP(r,e,t){Mi.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],Tm);let i=Math.sqrt(Math.pow(Tm[0]-t[0],2)+Math.pow(Tm[1]-t[1],2)+Math.pow(Tm[2]-t[2],2));return Math.log2(BP/(i+e[2]))}function CV(r,e,t){let[i,n,s,a]=r;return LP({xmin:i,xmax:s,ymin:n,ymax:a,zmin:0,zmax:0},e,t)}function Pde(r){r.getColumn(0,Tm);let e=r.getColumn(1),t=r.getColumn(2);return Tm.add(e).add(t).len()}var Jo={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},ko;(function(r){r[r.ADD=1]="ADD",r[r.REPLACE=2]="REPLACE"})(ko||(ko={}));var wl;(function(r){r.EMPTY="empty",r.SCENEGRAPH="scenegraph",r.POINTCLOUD="pointcloud",r.MESH="mesh"})(wl||(wl={}));var ho;(function(r){r.I3S="I3S",r.TILES3D="TILES3D"})(ho||(ho={}));var Ph;(function(r){r.GEOMETRIC_ERROR="geometricError",r.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Ph||(Ph={}));var IV={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function BV(r){return r!=null}var Fo=new st,h3=new st,Mde=new st,Rde=new st,iA=new st,PV=new st,MV=new st,RV=new st;function f3(r,e,t){if(Ti(r,"3D Tile: boundingVolume must be defined"),r.box)return OV(r.box,e,t);if(r.region)return Lde(r.region);if(r.sphere)return Bde(r.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function LV(r,e){if(r.box)return Ode(e);if(r.region){let[t,i,n,s,a,c]=r.region;return[[Ga(t),Ga(i),a],[Ga(n),Ga(s),c]]}if(r.sphere)return Dde(e);throw new Error("Unkown boundingVolume type")}function OV(r,e,t){let i=new st(r[0],r[1],r[2]);e.transform(i,i);let n=[];if(r.length===10){let p=r.slice(3,6),b=new ml;b.fromArray(r,6);let T=new st([1,0,0]),B=new st([0,1,0]),z=new st([0,0,1]);T.transformByQuaternion(b),T.scale(p[0]),B.transformByQuaternion(b),B.scale(p[1]),z.transformByQuaternion(b),z.scale(p[2]),n=[...T.toArray(),...B.toArray(),...z.toArray()]}else n=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];let s=e.transformAsVector(n.slice(0,3)),a=e.transformAsVector(n.slice(3,6)),c=e.transformAsVector(n.slice(6,9)),d=new nn([s[0],s[1],s[2],a[0],a[1],a[2],c[0],c[1],c[2]]);return BV(t)?(t.center=i,t.halfAxes=d,t):new Eh(i,d)}function Bde(r,e,t){let i=new st(r[0],r[1],r[2]);e.transform(i,i);let n=e.getScale(h3),s=Math.max(Math.max(n[0],n[1]),n[2]),a=r[3]*s;return BV(t)?(t.center=i,t.radius=a,t):new Su(i,a)}function Lde(r){let[e,t,i,n,s,a]=r,c=Mi.WGS84.cartographicToCartesian([Ga(e),Ga(n),s],Mde),d=Mi.WGS84.cartographicToCartesian([Ga(i),Ga(t),a],Rde),p=new st().addVectors(c,d).multiplyByScalar(.5);return Mi.WGS84.cartesianToCartographic(p,iA),Mi.WGS84.cartographicToCartesian([Ga(i),iA[1],iA[2]],PV),Mi.WGS84.cartographicToCartesian([iA[0],Ga(n),iA[2]],MV),Mi.WGS84.cartographicToCartesian([iA[0],iA[1],a],RV),OV([...p,...PV.subtract(p),...MV.subtract(p),...RV.subtract(p)],new vr)}function Ode(r){let e=DV(),{halfAxes:t}=r,i=new st(t.getColumn(0)),n=new st(t.getColumn(1)),s=new st(t.getColumn(2));for(let a=0;a<2;a++){for(let c=0;c<2;c++){for(let d=0;d<2;d++)Fo.copy(r.center),Fo.add(i),Fo.add(n),Fo.add(s),kV(e,Fo),s.negate();n.negate()}i.negate()}return e}function Dde(r){let e=DV(),{center:t,radius:i}=r,n=Mi.WGS84.scaleToGeodeticSurface(t,Fo),s;n?s=Mi.WGS84.geodeticSurfaceNormal(n):s=new st(0,0,1);let a=new st(s[2],-s[1],0);a.len()>0?a.normalize():a=new st(0,1,0);let c=a.clone().cross(s);for(let d of[a,c,s]){h3.copy(d).scale(i);for(let p=0;p<2;p++)Fo.copy(t),Fo.add(h3),kV(e,Fo),h3.negate()}return e}function DV(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function kV(r,e){Mi.WGS84.cartesianToCartographic(e,Fo),r[0][0]=Math.min(r[0][0],Fo[0]),r[0][1]=Math.min(r[0][1],Fo[1]),r[0][2]=Math.min(r[0][2],Fo[2]),r[1][0]=Math.max(r[1][0],Fo[0]),r[1][1]=Math.max(r[1][1],Fo[1]),r[1][2]=Math.max(r[1][2],Fo[2])}var t$e=new st,r$e=new st,i$e=new vr,n$e=new st,s$e=new st,o$e=new st;function kde(r,e){let t=r*e;return 1-Math.exp(-(t*t))}function Fde(r,e){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){let t=r.dynamicScreenSpaceErrorComputedDensity,i=r.dynamicScreenSpaceErrorFactor;return kde(e,t)*i}return 0}function FV(r,e,t){let i=r.tileset,n=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=t?n:r.lodMetricValue;if(s===0)return 0;let a=Math.max(r._distanceToCamera,1e-7),{height:c,sseDenominator:d}=e,{viewDistanceScale:p}=i.options,b=s*c*(p||1)/(a*d);return b-=Fde(i,a),b}var OP=new st,NV=new st,dd=new st,zV=new st,Nde=new st,DP=new vr,UV=new vr;function VV(r,e){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";let t=2*kP(r,e);return t<2?"OUT":!r.header.children||t<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function kP(r,e){let{topDownViewport:t}=e,i=r.header.mbs[1],n=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],c=[...r.boundingVolume.center],d=t.unprojectPosition(t.cameraPosition);Mi.WGS84.cartographicToCartesian(d,OP),NV.copy(OP).subtract(c).normalize(),Mi.WGS84.eastNorthUpToFixedFrame(c,DP),UV.copy(DP).invert(),dd.copy(OP).transform(UV);let p=Math.sqrt(dd[0]*dd[0]+dd[1]*dd[1]),b=p*p/dd[2];zV.copy([dd[0],dd[1],b]);let B=zV.transform(DP).subtract(c).normalize(),G=NV.cross(B).normalize().scale(a).add(c),Z=Mi.WGS84.cartesianToCartographic(G),q=t.project([n,i,s]),re=t.project(Z);return Nde.copy(q).subtract(re).magnitude()}function jV(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}var Yy=class{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ti(e<this._array.length),this._array[e]}set(e,t){Ti(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){let t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){let t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){let e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ti(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ti(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}};var zde={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""},Pu=class{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new Yy;_emptyTraversalStack=new Yy;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...zde,...e}}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){let i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){let s=i.pop(),a=!1;this.canTraverse(s,t)&&(this.updateChildTiles(s,t),a=this.updateAndPushChildren(s,t,i,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));let c=s.parent,d=!!(!c||c._shouldRefine),p=!a;s.hasRenderContent?s.refine===ko.ADD?(this.loadTile(s,t),this.selectTile(s,t)):s.refine===ko.REPLACE&&(this.loadTile(s,t),p&&this.selectTile(s,t)):(this.emptyTiles[s.id]=s,this.loadTile(s,t),p&&this.selectTile(s,t)),this.touchTile(s,t),s._shouldRefine=a&&d}let n=new Date().getTime();(this.traversalFinished(t)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(t))}updateChildTiles(e,t){let i=e.children;for(let n of i)this.updateTile(n,t)}updateAndPushChildren(e,t,i,n){let{loadSiblings:s,skipLevelOfDetail:a}=this.options,c=e.children;c.sort(this.compareDistanceToCamera.bind(this));let d=e.refine===ko.REPLACE&&e.hasRenderContent&&!a,p=!1,b=!0;for(let T of c)if(T._selectionDepth=n,T.isVisibleAndInRequestVolume?(i.find(T)&&i.delete(T),i.push(T),p=!0):(d||s)&&(this.loadTile(T,t),this.touchTile(T,t)),d){let B;if(T._inRequestVolume?T.hasRenderContent?B=T.contentAvailable:B=this.executeEmptyTraversal(T,t):B=!1,b=b&&B,!b)return!1}return p||(b=!1),b}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,i=!1){let n=e._screenSpaceError;return i&&(n=e.getScreenSpaceError(t,!0)),n>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){let i=[];if(this.options.viewportTraversersMap)for(let n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===t.viewport.id&&i.push(n);else i.push(t.viewport.id);e.updateVisibility(t,i)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let i=!1;for(let n of e.children)n.updateVisibility(t),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0,n=this._emptyTraversalStack;for(n.push(e);n.length>0;){let s=n.pop(),a=!s.hasRenderContent&&this.canTraverse(s,t),c=!s.hasRenderContent&&s.children.length===0;if(!a&&!s.contentAvailable&&!c&&(i=!1),this.updateTile(s,t),s.isVisibleAndInRequestVolume||(this.loadTile(s,t),this.touchTile(s,t)),a){let d=s.children;for(let p of d)n.push(p)}}return i}};var GV=new st;function Ude(r){return r!=null}var nA=class{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=Jo.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new vr;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new Pu({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new vr;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,t,i,n=""){this.header=t,this.tileset=e,this.id=n||t.id,this.url=t.url,this.parent=i,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Jo.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Jo.UNLOADED}get contentExpired(){return this.contentState===Jo.EXPIRED}get contentFailed(){return this.contentState===Jo.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=LV(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case ho.I3S:return kP(this,e);case ho.TILES3D:return FV(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){let e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,i=this.refine===ko.ADD||t;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Jo.UNLOADED)return-1;let n=this.parent,a=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,c=e.root?e.root._screenSpaceError:0;return Math.max(c-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Jo.LOADING;let t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=Jo.UNLOADED,!1;try{let i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,s={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await oo(i,n,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Jo.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Jo.FAILED,i}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Jo.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;let i=this.parent,n=i?i._visibilityPlaneMask:Qo.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){let s=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==Qo.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){let{cullingVolume:i}=e,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,t)}contentVisibility(){return!0}distanceToTile(e){let t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){let t=this.boundingVolume;return GV.subVectors(t.center,e.position),e.direction.dot(GV)}insideViewerRequestVolume(e){let t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Ude(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){let e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Jo.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new vr(e.transform):new vr;let t=this.parent,i=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new vr(n).multiplyRight(this.transform);let s=t&&t._initialTransform?t._initialTransform.clone():new vr;this._initialTransform=new vr(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Jo.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Qo.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||ko.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break;default:}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=f3(e.boundingVolume,this.computedTransform,this.boundingVolume);let t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=f3(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=f3(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new vr){let t=e.clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return jV(this.tileset.tileset)}}};var d3=class extends Pu{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;let i=e.children.length>0;if(e.hasTilesetContent&&i){let a=e.children[0];this.updateTileVisibility(a,t),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}let n=e.refine===ko.REPLACE,s=e._optimChildrenWithinParent===IV.USE_OPTIMIZATION;if(n&&s&&i&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){let{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==ko.ADD?!1:!this.shouldRefine(e,t,!0)}};var p3=class{frameNumberMap=new Map;register(e,t){let i=this.frameNumberMap.get(e)||new Map,n=i.get(t)||0;i.set(t,n+1),this.frameNumberMap.set(e,i)}deregister(e,t){let i=this.frameNumberMap.get(e);if(!i)return;let n=i.get(t)||1;i.set(t,n-1)}isZero(e,t){return(this.frameNumberMap.get(e)?.get(t)||0)===0}};var FP={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"},A3=class{_statusMap;pendingTilesRegister=new p3;constructor(){this._statusMap={}}add(e,t,i,n){if(!this._statusMap[t]){let{frameNumber:s,viewport:{id:a}}=n;this._statusMap[t]={request:e,callback:i,key:t,frameState:n,status:FP.REQUESTED},this.pendingTilesRegister.register(a,s),e().then(c=>{this._statusMap[t].status=FP.COMPLETED;let{frameNumber:d,viewport:{id:p}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(p,d),this._statusMap[t].callback(c,n)}).catch(c=>{this._statusMap[t].status=FP.ERROR;let{frameNumber:d,viewport:{id:p}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(p,d),i(c)})}}update(e,t){if(this._statusMap[e]){let{frameNumber:i,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,i);let{frameNumber:s,viewport:{id:a}}=t;this.pendingTilesRegister.register(a,s),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}};var m3=class extends Pu{_tileManager;constructor(e){super(e),this._tileManager=new A3}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=VV(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){let i=e.header.children||[],n=e.children,s=e.tileset;for(let a of i){let c=`${a.id}-${t.viewport.id}`,d=n&&n.find(p=>p.id===c);if(d)d&&this.updateTile(d,t);else{let p=()=>this._loadTile(a.id,s);this._tileManager.find(c)?this._tileManager.update(c,t):(s.tileset.nodePages&&(p=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(p,c,T=>this._onTileLoad(T,e,c),t))}}return!1}async _loadTile(e,t){let{loader:i}=t,n=t.getTileUrl(`${t.url}/nodes/${e}`),s={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await oo(n,i,s)}_onTileLoad(e,t,i){let n=new nA(t.tileset,e,t,i);t.children.push(n);let s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,s)}};var Vde={description:"",ellipsoid:Mi.WGS84,modelMatrix:new vr,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},g3="Tiles In Tileset(s)",NP="Tiles In Memory",HV="Tiles In View",WV="Tiles To Render",$V="Tiles Loaded",zP="Tiles Loading",qV="Tiles Unloaded",ZV="Failed Tile Loads",XV="Points/Vertices",UP="Tile Memory Use",YV="Maximum Screen Space Error",Ky=class{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new c3;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,t){this.options={...Vde,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Ua.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Lf({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Mo({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let i=e;return this.queryParams.length&&(i=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;let t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;let i=[];for(let n of t){let s=n.id;this._needTraverse(s)?i.push(s):this.traverseCounter--}for(let n of t){let s=n.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!i.includes(s))continue;let a=TV(n,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){let t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});let i=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),[s,a]=EV(n,e,this.options.maximumTilesSelected);i.selectedTiles=s;for(let c of a)c.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(let e in this.frameStateData){let t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(let e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;let i=new Set(e.map(a=>a.id)),n=new Set(t.map(a=>a.id)),s=e.filter(a=>!n.has(a.id)).length>0;return s=s||t.filter(a=>!i.has(a.id)).length>0,s}_loadTiles(){for(let e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(let i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?t+=i.content.pointCount:t+=i.content.vertexCount);this.stats.get(HV).count=this.selectedTiles.length,this.stats.get(WV).count=e,this.stats.get(XV).count=t,this.stats.get(YV).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===ho.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===ho.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===ho.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){let e=this.tileset.fullExtent;if(e){let{xmin:i,xmax:n,ymin:s,ymax:a,zmin:c,zmax:d}=e;this.cartographicCenter=new st(i+(n-i)/2,s+(a-s)/2,c+(d-c)/2),this.cartesianCenter=new st,Mi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=LP(e,this.cartographicCenter,this.cartesianCenter);return}let t=this.tileset.store?.extent;if(t){let[i,n,s,a]=t;this.cartographicCenter=new st(i+(s-i)/2,n+(a-n)/2,0),this.cartesianCenter=new st,Mi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=CV(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new st,this.zoom=1}calculateViewPropsTiles3D(){let e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new st,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new st,Mi.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new st(0,0,-Mi.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=SV(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(g3),this.stats.get(zP),this.stats.get(NP),this.stats.get(HV),this.stats.get(WV),this.stats.get($V),this.stats.get(qV),this.stats.get(ZV),this.stats.get(XV),this.stats.get(UP,"memory"),this.stats.get(YV)}_initializeTileHeaders(e,t){let i=new nA(this,e.root,t);if(t&&(t.children.push(i),i.depth=t.depth+1),this.type===ho.TILES3D){let n=[];for(n.push(i);n.length>0;){let s=n.pop();this.stats.get(g3).incrementCount();let a=s.header.children||[];for(let c of a){let d=new nA(this,c,s);if(d.contentUrl?.includes("?session=")){let b=new URL(d.contentUrl).searchParams.get("session");b&&(this._queryParams.session=b)}s.children.push(d),d.depth=s.depth+1,n.push(d)}}}return i}_initializeTraverser(){let e;switch(this.type){case ho.TILES3D:e=d3;break;case ho.I3S:e=m3;break;default:e=Pu}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(ZV).incrementCount();let i=t.message||t.toString(),n=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,n)}_onTileLoad(e,t){if(t){if(this.type===ho.I3S){let i=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(g3).reset(),this.stats.get(g3).addCount(i)}e&&e.content&&bV(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===ho.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break;default:}else if(this.type===ho.TILES3D){let{extensionsRemoved:t=[]}=e.content?.gltf||{};t.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),t.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),t.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(zP).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(zP).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get($V).incrementCount(),this.stats.get(NP).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(UP).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(NP).decrementCount(),this.stats.get(qV).incrementCount(),this.stats.get(UP).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){let e=[];for(this.root&&e.push(this.root);e.length>0;){let t=e.pop();for(let i of t.children)e.push(i);this._destroyTile(t)}this.root=null}_destroySubtree(e){let t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(let n of e.children)i.push(n);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){let t=new URLSearchParams(e.queryString),i=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}};var _3="4.3.2";var sA={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},iqe=Object.keys(sA);function VP(r,e,t){Ti(r instanceof ArrayBuffer);let i=new TextDecoder("utf8"),n=new Uint8Array(r,e,t);return i.decode(n)}function KV(r,e=0){let t=new DataView(r);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}var jde={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},bs={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},gi={...jde,...bs};var jP={[bs.DOUBLE]:Float64Array,[bs.FLOAT]:Float32Array,[bs.UNSIGNED_SHORT]:Uint16Array,[bs.UNSIGNED_INT]:Uint32Array,[bs.UNSIGNED_BYTE]:Uint8Array,[bs.BYTE]:Int8Array,[bs.SHORT]:Int16Array,[bs.INT]:Int32Array},Gde={DOUBLE:bs.DOUBLE,FLOAT:bs.FLOAT,UNSIGNED_SHORT:bs.UNSIGNED_SHORT,UNSIGNED_INT:bs.UNSIGNED_INT,UNSIGNED_BYTE:bs.UNSIGNED_BYTE,BYTE:bs.BYTE,SHORT:bs.SHORT,INT:bs.INT},GP="Failed to convert GL type",vc=class r{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(let t in jP)if(jP[t]===e)return t;throw new Error(GP)}static fromName(e){let t=Gde[e];if(!t)throw new Error(GP);return t}static getArrayType(e){switch(e){case bs.UNSIGNED_SHORT_5_6_5:case bs.UNSIGNED_SHORT_4_4_4_4:case bs.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:let t=jP[e];if(!t)throw new Error(GP);return t}}static getByteSize(e){return r.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!r.getArrayType(e)}static createTypedArray(e,t,i=0,n){n===void 0&&(n=(t.byteLength-i)/r.getByteSize(e));let s=r.getArrayType(e);return new s(t,i,n)}};function QV(r,e){if(!r)throw new Error(`math.gl assertion failed. ${e}`)}function HP(r,e=[0,0,0]){let t=r>>11&31,i=r>>5&63,n=r&31;return e[0]=t<<3,e[1]=i<<2,e[2]=n<<3,e}var pqe=1/256;var Aqe=new xp,mqe=new st,gqe=new xp,_qe=new xp,yqe=new Uint8Array(1);function JV(r,e=255){return ao(r,0,e)/e*2-1}function ej(r){return r<0?-1:1}function tj(r,e,t,i){if(QV(i),r<0||r>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(i.x=JV(r,t),i.y=JV(e,t),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){let n=i.x;i.x=(1-Math.abs(i.y))*ej(n),i.y=(1-Math.abs(n))*ej(i.y)}return i.normalize()}function WP(r,e,t){return tj(r,e,255,t)}var Mh=class{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,t){this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=gi.UNSIGNED_INT,i=1){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,n.byteOffset):n}getPropertyArray(e,t,i){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=vc.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,i,n,s){let a=this.json[e];if(!a)return a;let c=this.getPropertyArray(e,t,i);if(i===1)return c[n];for(let d=0;d<i;++d)s[d]=c[i*n+d];return s}_getTypedArrayFromBinary(e,t,i,n,s){let a=this._cachedTypedArrays,c=a[e];return c||(c=vc.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,n*i),a[e]=c),c}_getTypedArrayFromArray(e,t,i){let n=this._cachedTypedArrays,s=n[e];return s||(s=vc.createTypedArray(t,i),n[e]=s),s}};var Hde={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wde={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},$de={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function rj(r,e,t,i){let{componentType:n}=r;Ti(r.componentType);let s=typeof n=="string"?vc.fromName(n):n,a=Hde[r.type],c=Wde[r.type],d=$de[r.type];return t+=r.byteOffset,{values:vc.createTypedArray(s,e,t,a*i),type:s,size:a,unpacker:c,packer:d}}var Mu=r=>r!==void 0;function ij(r,e,t){if(!e)return null;let i=r.getExtension("3DTILES_batch_table_hierarchy"),n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?qde(i,t):null}function qde(r,e){let t,i,n,s=r.instancesLength,a=r.classes,c=r.classIds,d=r.parentCounts,p=r.parentIds,b=s;Mu(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,n=getBinaryAccessor(c),c=n.createArrayBufferView(e.buffer,e.byteOffset+c.byteOffset,s));let T;if(Mu(d))for(Mu(d.byteOffset)&&(d.componentType=defaultValue(d.componentType,GL.UNSIGNED_SHORT),d.type=AttributeType.SCALAR,n=getBinaryAccessor(d),d=n.createArrayBufferView(e.buffer,e.byteOffset+d.byteOffset,s)),T=new Uint16Array(s),b=0,t=0;t<s;++t)T[t]=b,b+=d[t];Mu(p)&&Mu(p.byteOffset)&&(p.componentType=defaultValue(p.componentType,GL.UNSIGNED_SHORT),p.type=AttributeType.SCALAR,n=getBinaryAccessor(p),p=n.createArrayBufferView(e.buffer,e.byteOffset+p.byteOffset,b));let B=a.length;for(t=0;t<B;++t){let q=a[t].length,re=a[t].instances,ee=getBinaryProperties(q,re,e);a[t].instances=combine(ee,re)}let z=new Array(B).fill(0),G=new Uint16Array(s);for(t=0;t<s;++t)i=c[t],G[t]=z[i],++z[i];let Z={classes:a,classIds:c,classIndexes:G,parentCounts:d,parentIndexes:T,parentIds:p};return Yde(Z),Z}function Em(r,e,t){if(!r)return;let i=r.parentCounts;return r.parentIds?t(r,e):i>0?Zde(r,e,t):Xde(r,e,t)}function Zde(r,e,t){let i=r.classIds,n=r.parentCounts,s=r.parentIds,a=r.parentIndexes,c=i.length,d=scratchVisited;d.length=Math.max(d.length,c);let p=++marker,b=scratchStack;for(b.length=0,b.push(e);b.length>0;){if(e=b.pop(),d[e]===p)continue;d[e]=p;let T=t(r,e);if(Mu(T))return T;let B=n[e],z=a[e];for(let G=0;G<B;++G){let Z=s[z+G];Z!==e&&b.push(Z)}}return null}function Xde(r,e,t){let i=!0;for(;i;){let n=t(r,e);if(Mu(n))return n;let s=r.parentIds[e];i=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function Yde(r){let e=[],i=r.classIds.length;for(let n=0;n<i;++n)nj(r,n,stack)}function nj(r,e,t){let i=r.parentCounts,n=r.parentIds,s=r.parentIndexes,c=r.classIds.length;if(!Mu(n))return;assert(e<c,`Parent index ${e} exceeds the total number of instances: ${c}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);let d=Mu(i)?i[e]:1,p=Mu(i)?s[e]:e;for(let b=0;b<d;++b){let T=n[p+b];T!==e&&nj(r,T,t)}t.pop(e)}function ya(r){return r!=null}var y3=(r,e)=>r,Kde={HIERARCHY:!0,extensions:!0,extras:!0},oA=class{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,t,i,n={}){Ti(i>=0),this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=this.json?.extensions||{},this._properties={};for(let s in this.json)Kde[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=ij(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Ti(typeof t=="string",t),this._hierarchy){let i=Em(this._hierarchy,e,(n,s)=>{let a=n.classIds[s];return n.classes[a].name===t});return ya(i)}return!1}isExactClass(e,t){return Ti(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){let t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Ti(typeof t=="string",t),ya(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=ya(t)?t:[],t.length=0;let i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Ti(typeof t=="string",t),this._binaryProperties){let n=this._binaryProperties[t];if(ya(n))return this._getBinaryProperty(n,e)}let i=this._properties[t];if(ya(i))return y3(i[e],!0);if(this._hierarchy){let n=this._getHierarchyProperty(e,t);if(ya(n))return n}}setProperty(e,t,i){let n=this.featureCount;if(this._checkBatchId(e),Ti(typeof t=="string",t),this._binaryProperties){let a=this._binaryProperties[t];if(a){this._setBinaryProperty(a,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let s=this._properties[t];ya(s)||(this._properties[t]=new Array(n),s=this._properties[t]),s[e]=y3(i,!0)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(let t in this._properties){let i=this._properties[t],n=this._initializeBinaryProperty(t,i);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){let i=t;Ti(this.binary,`Property ${e} requires a batch table binary.`),Ti(i.type,`Property ${e} requires a type.`);let n=rj(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;let i=Em(this._hierarchy,e,(n,s)=>{let a=n.classIds[s],c=n.classes[a].instances;return ya(c[t])});return ya(i)}_getPropertyNamesInHierarchy(e,t){Em(this._hierarchy,e,(i,n)=>{let s=i.classIds[n],a=i.classes[s].instances;for(let c in a)a.hasOwnProperty(c)&&t.indexOf(c)===-1&&t.push(c)})}_getHierarchyProperty(e,t){return Em(this._hierarchy,e,(i,n)=>{let s=i.classIds[n],a=i.classes[s],c=i.classIndexes[n],d=a.instances[t];return ya(d)?ya(d.typedArray)?this._getBinaryProperty(d,c):y3(d[c],!0):null})}_setHierarchyProperty(e,t,i,n){let s=Em(this._hierarchy,t,(a,c)=>{let d=a.classIds[c],p=a.classes[d],b=a.classIndexes[c],T=p.instances[i];return ya(T)?(Ti(c===t,`Inherited property "${i}" is read-only.`),ya(T.typedArray)?this._setBinaryProperty(T,b,n):T[b]=y3(n,!0),!0):!1});return ya(s)}};function pd(r,e,t=0){let i=new DataView(e);if(r.magic=i.getUint32(t,!0),t+=4,r.version=i.getUint32(t,!0),t+=4,r.byteLength=i.getUint32(t,!0),t+=4,r.version!==1)throw new Error(`3D Tile Version ${r.version} not supported`);return t}var Sm=4,sj="b3dm tile in legacy format.";function Cm(r,e,t){let i=new DataView(e),n;r.header=r.header||{};let s=i.getUint32(t,!0);t+=Sm;let a=i.getUint32(t,!0);t+=Sm;let c=i.getUint32(t,!0);t+=Sm;let d=i.getUint32(t,!0);return t+=Sm,c>=570425344?(t-=Sm*2,n=s,c=a,d=0,s=0,a=0,console.warn(sj)):d>=570425344&&(t-=Sm,n=c,c=s,d=a,s=0,a=0,console.warn(sj)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=c,r.header.batchTableBinaryByteLength=d,r.header.batchLength=n,t}function Im(r,e,t,i){return t=Qde(r,e,t,i),t=Jde(r,e,t,i),t}function Qde(r,e,t,i){let{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:a}=r.header||{};if(r.featureTableJson={BATCH_LENGTH:a||0},n&&n>0){let c=VP(e,t,n);r.featureTableJson=JSON.parse(c)}return t+=n||0,r.featureTableBinary=new Uint8Array(e,t,s),t+=s||0,t}function Jde(r,e,t,i){let{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=r.header||{};if(n&&n>0){let a=VP(e,t,n);r.batchTableJson=JSON.parse(a),t+=n,s&&s>0&&(r.batchTableBinary=new Uint8Array(e,t,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=s)}return t}function $P(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;let{batchIds:i,isRGB565:n,pointCount:s=0}=r;if(i&&t){let a=new Uint8ClampedArray(s*3);for(let c=0;c<s;c++){let d=i[c],b=t.getProperty(d,"dimensions").map(T=>T*255);a[c*3]=b[0],a[c*3+1]=b[1],a[c*3+2]=b[2]}return{type:gi.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(e&&n){let a=new Uint8ClampedArray(s*3);for(let c=0;c<s;c++){let d=HP(e[c]);a[c*3]=d[0],a[c*3+1]=d[1],a[c*3+2]=d[2]}return{type:gi.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===s*3?{type:gi.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:gi.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}var oj=new st;function aj(r,e){if(!e)return null;if(r.isOctEncoded16P){let t=new Float32Array((r.pointsLength||0)*3);for(let i=0;i<(r.pointsLength||0);i++)WP(e[i*2],e[i*2+1],oj),oj.toArray(t,i*3);return{type:gi.FLOAT,size:2,value:t}}return{type:gi.FLOAT,size:2,value:e}}function lj(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,epe(r,e)):{type:gi.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function epe(r,e){let t=new st,i=new Float32Array(r.pointCount*3);for(let n=0;n<r.pointCount;n++)t.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(i,n*3);return i}async function cj(r,e,t,i,n){t=pd(r,e,t),t=Cm(r,e,t),t=Im(r,e,t,i),tpe(r);let{featureTable:s,batchTable:a}=rpe(r);return await ape(r,s,a,i,n),ipe(r,s,i),npe(r,s,a),spe(r,s),t}function tpe(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function rpe(r){let e=new Mh(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",gi.FLOAT,3);let i=ope(r,e);return{featureTable:e,batchTable:i}}function ipe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",gi.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){let i=e.getPropertyArray("POSITION_QUANTIZED",gi.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",gi.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",gi.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=lj(r,i,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function npe(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",gi.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",gi.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",gi.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=$P(r,i,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",gi.UNSIGNED_BYTE,4))}function spe(r,e){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",gi.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",gi.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=aj(r,t)}}function ope(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",gi.UNSIGNED_SHORT,1),r.batchIds)){let i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");let{batchTableJson:n,batchTableBinary:s}=r;t=new oA(n,s,i)}return t}async function ape(r,e,t,i,n){let s,a,c,d=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];d&&(c=d.properties);let p=e.getExtension("3DTILES_draco_point_compression");if(p){a=p.properties;let T=p.byteOffset,B=p.byteLength;if(!a||!Number.isFinite(T)||!B)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(r.featureTableBinary||[]).slice(T,T+B),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;let b={buffer:s,properties:{...a,...c},featureTableProperties:a,batchTableProperties:c,dequantizeInShader:!1};return await lpe(r,b,i,n)}async function lpe(r,e,t,i){if(!i)return;let n={...t,draco:{...t?.draco,extraAttributes:e.batchTableProperties||{}}};delete n["3d-tiles"];let s=await za(e.buffer,t3,n,i),a=s.attributes.POSITION&&s.attributes.POSITION.value,c=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,d=s.attributes.NORMAL&&s.attributes.NORMAL.value,p=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,b=a&&s.attributes.POSITION.value.quantization,T=d&&s.attributes.NORMAL.value.quantization;if(b){let z=s.POSITION.data.quantization,G=z.range;r.quantizedVolumeScale=new st(G,G,G),r.quantizedVolumeOffset=new st(z.minValues),r.quantizedRange=(1<<z.quantizationBits)-1,r.isQuantizedDraco=!0}T&&(r.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);let B={};if(e.batchTableProperties)for(let z of Object.keys(e.batchTableProperties))s.attributes[z]&&s.attributes[z].value&&(B[z.toLowerCase()]=s.attributes[z].value);r.attributes={positions:a,colors:$P(r,c,void 0),normals:d,batchIds:p,...B}}var x3={URI:0,EMBEDDED:1};function b3(r,e,t,i){r.rotateYtoZ=!0;let n=(r.byteOffset||0)+(r.byteLength||0)-t;if(n===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=np(e,t,n),r.gltfByteOffset=0,r.gltfByteLength=n,t%4===0||console.warn(`${r.type}: embedded glb is not aligned to a 4-byte boundary.`),(r.byteOffset||0)+(r.byteLength||0)}async function v3(r,e,t,i){let n=t?.["3d-tiles"]||{};if(cpe(r,e,t),n.loadGLTF){if(!i)return;if(r.gltfUrl){let{fetch:s}=i,a=await s(r.gltfUrl,t);r.gltfArrayBuffer=await a.arrayBuffer(),r.gltfByteOffset=0}if(r.gltfArrayBuffer){let s=await za(r.gltfArrayBuffer,Ch,t,i);r.gltf=rA(s),r.gpuMemoryUsageInBytes=jy(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength}}}function cpe(r,e,t){switch(e){case x3.URI:if(r.gltfArrayBuffer){let i=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(i);r.gltfUrl=s.replace(/[\s\0]+$/,"")}delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case x3.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function uj(r,e,t,i,n){t=upe(r,e,t,i,n),await v3(r,x3.EMBEDDED,i,n);let s=r?.gltf?.extensions;return s&&s.CESIUM_RTC&&(r.rtcCenter=s.CESIUM_RTC.center),t}function upe(r,e,t,i,n){t=pd(r,e,t),t=Cm(r,e,t),t=Im(r,e,t,i),t=b3(r,e,t,i);let s=new Mh(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",gi.FLOAT,3),t}async function hj(r,e,t,i,n){return t=hpe(r,e,t,i,n),await v3(r,r.gltfFormat||0,i,n),t}function hpe(r,e,t,i,n){if(t=pd(r,e,t),r.version!==1)throw new Error(`Instanced 3D Model version ${r.version} is not supported`);t=Cm(r,e,t);let s=new DataView(e);if(r.gltfFormat=s.getUint32(t,!0),t+=4,t=Im(r,e,t,i),t=b3(r,e,t,i),!r?.header?.featureTableJsonByteLength||r.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");let a=new Mh(r.featureTableJson,r.featureTableBinary),c=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",gi.FLOAT,3);let d=new oA(r.batchTableJson,r.batchTableBinary,c);return fpe(r,a,d,c),t}function fpe(r,e,t,i){let n=new Array(i),s=new st,a=new st,c=new st,d=new st,p=new nn,b=new ml,T=new st,B={},z=new vr,G=[],Z=[],q=[],re=[];for(let ee=0;ee<i;ee++){let ae;if(e.hasProperty("POSITION"))ae=e.getProperty("POSITION",gi.FLOAT,3,ee,s);else if(e.hasProperty("POSITION_QUANTIZED")){ae=e.getProperty("POSITION_QUANTIZED",gi.UNSIGNED_SHORT,3,ee,s);let X=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",gi.FLOAT,3);if(!X)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let ye=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",gi.FLOAT,3);if(!ye)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let _e=65535;for(let Oe=0;Oe<3;Oe++)ae[Oe]=ae[Oe]/_e*ye[Oe]+X[Oe]}if(!ae)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");s.copy(ae),B.translation=s,r.normalUp=e.getProperty("NORMAL_UP",gi.FLOAT,3,ee,G),r.normalRight=e.getProperty("NORMAL_RIGHT",gi.FLOAT,3,ee,Z);let me=!1;if(r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",gi.UNSIGNED_SHORT,2,ee,G),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",gi.UNSIGNED_SHORT,2,ee,Z),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(Mi.WGS84.eastNorthUpToFixedFrame(s,z),z.getRotationMatrix3(p)):p.identity()}me&&(d.copy(a).cross(c).normalize(),p.setColumn(0,a),p.setColumn(1,c),p.setColumn(2,d)),b.fromMatrix3(p),B.rotation=b,T.set(1,1,1);let Le=e.getProperty("SCALE",gi.FLOAT,1,ee,q);Number.isFinite(Le)&&T.multiplyByScalar(Le);let je=e.getProperty("SCALE_NON_UNIFORM",gi.FLOAT,3,ee,G);je&&T.scale(je),B.scale=T;let Je=e.getProperty("BATCH_ID",gi.UNSIGNED_SHORT,1,ee,re);Je===void 0&&(Je=ee);let J=new vr().fromQuaternion(B.rotation);z.identity(),z.translate(B.translation),z.multiplyRight(J),z.scale(B.scale);let te=z.clone();n[ee]={modelMatrix:te,batchId:Je}}r.instances=n}async function fj(r,e,t,i,n,s){t=pd(r,e,t);let a=new DataView(e);for(r.tilesLength=a.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&(r.byteLength||0)-t>12;){let c={shape:"tile3d"};r.tiles.push(c),t=await s(e,t,i,n,c)}return t}async function dj(r,e,t,i){if(r.rotateYtoZ=!0,r.gltfUpAxis=t?.["3d-tiles"]?.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",t?.["3d-tiles"]?.loadGLTF){if(!i)return e.byteLength;let n=await za(e,Ch,t,i);r.gltf=rA(n),r.gpuMemoryUsageInBytes=jy(r.gltf)}else r.gltfArrayBuffer=e;return e.byteLength}async function qP(r,e=0,t,i,n={shape:"tile3d"}){switch(n.byteOffset=e,n.type=KV(r,e),n.type){case sA.COMPOSITE:return await fj(n,r,e,t,i,qP);case sA.BATCHED_3D_MODEL:return await uj(n,r,e,t,i);case sA.GLTF:return await dj(n,r,t,i);case sA.INSTANCED_3D_MODEL:return await hj(n,r,e,t,i);case sA.POINT_CLOUD:return await cj(n,r,e,t,i);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}async function ZP(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==1952609651)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==1)throw new Error("Wrong subtree file verson, must be 1");let s=pj(r.slice(8,16)),a=new Uint8Array(r,24,s),d=new TextDecoder("utf8").decode(a),p=JSON.parse(d),b=pj(r.slice(16,24)),T=new ArrayBuffer(0);if(b&&(T=r.slice(24+s)),await w3(p,p.tileAvailability,T,t),Array.isArray(p.contentAvailability))for(let B of p.contentAvailability)await w3(p,B,T,t);else await w3(p,p.contentAvailability,T,t);return await w3(p,p.childSubtreeAvailability,T,t),p}async function w3(r,e,t,i){let n=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof n!="number")return;let s=r.bufferViews[n],a=r.buffers[s.buffer];if(!i?.baseUrl)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(a.uri){let d=`${i?.baseUrl||""}/${a.uri}`,b=await(await i.fetch(d)).arrayBuffer();e.explicitBitstream=new Uint8Array(b,s.byteOffset,s.byteLength);return}let c=r.buffers.slice(0,s.buffer).reduce((d,p)=>d+p.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(c,c+a.byteLength),s.byteOffset,s.byteLength)}function pj(r){let e=new DataView(r),t=e.getUint32(0,!0),i=e.getUint32(4,!0);return t+2**32*i}var T3={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:_3,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:ZP,options:{}};var Tl=null;try{Tl=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Tn(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Tn.prototype.__isLong__;Object.defineProperty(Tn.prototype,"__isLong__",{value:!0});function No(r){return(r&&r.__isLong__)===!0}function Aj(r){var e=Math.clz32(r&-r);return r?31-e:e}Tn.isLong=No;var mj={},gj={};function aA(r,e){var t,i,n;return e?(r>>>=0,(n=0<=r&&r<256)&&(i=gj[r],i)?i:(t=Zi(r,0,!0),n&&(gj[r]=t),t)):(r|=0,(n=-128<=r&&r<128)&&(i=mj[r],i)?i:(t=Zi(r,r<0?-1:0,!1),n&&(mj[r]=t),t))}Tn.fromInt=aA;function El(r,e){if(isNaN(r))return e?Rh:wc;if(e){if(r<0)return Rh;if(r>=bj)return Tj}else{if(r<=-yj)return xa;if(r+1>=yj)return wj}return r<0?El(-r,e).neg():Zi(r%Mm|0,r/Mm|0,e)}Tn.fromNumber=El;function Zi(r,e,t){return new Tn(r,e,t)}Tn.fromBits=Zi;var E3=Math.pow;function YP(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?Rh:wc;if(t=t||10,t<2||36<t)throw RangeError("radix");var i;if((i=r.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return YP(r.substring(1),e,t).neg();for(var n=El(E3(t,8)),s=wc,a=0;a<r.length;a+=8){var c=Math.min(8,r.length-a),d=parseInt(r.substring(a,a+c),t);if(c<8){var p=El(E3(t,c));s=s.mul(p).add(El(d))}else s=s.mul(n),s=s.add(El(d))}return s.unsigned=e,s}Tn.fromString=YP;function Sl(r,e){return typeof r=="number"?El(r,e):typeof r=="string"?YP(r,e):Zi(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Tn.fromValue=Sl;var _j=65536,dpe=1<<24,Mm=_j*_j,bj=Mm*Mm,yj=bj/2,xj=aA(dpe),wc=aA(0);Tn.ZERO=wc;var Rh=aA(0,!0);Tn.UZERO=Rh;var Pm=aA(1);Tn.ONE=Pm;var vj=aA(1,!0);Tn.UONE=vj;var XP=aA(-1);Tn.NEG_ONE=XP;var wj=Zi(-1,2147483647,!1);Tn.MAX_VALUE=wj;var Tj=Zi(-1,-1,!0);Tn.MAX_UNSIGNED_VALUE=Tj;var xa=Zi(0,-2147483648,!1);Tn.MIN_VALUE=xa;var ir=Tn.prototype;ir.toInt=function(){return this.unsigned?this.low>>>0:this.low};ir.toNumber=function(){return this.unsigned?(this.high>>>0)*Mm+(this.low>>>0):this.high*Mm+(this.low>>>0)};ir.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(xa)){var t=El(e),i=this.div(t),n=i.mul(t).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=El(E3(e,6),this.unsigned),a=this,c="";;){var d=a.div(s),p=a.sub(d.mul(s)).toInt()>>>0,b=p.toString(e);if(a=d,a.isZero())return b+c;for(;b.length<6;)b="0"+b;c=""+b+c}};ir.getHighBits=function(){return this.high};ir.getHighBitsUnsigned=function(){return this.high>>>0};ir.getLowBits=function(){return this.low};ir.getLowBitsUnsigned=function(){return this.low>>>0};ir.getNumBitsAbs=function(){if(this.isNegative())return this.eq(xa)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};ir.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};ir.isZero=function(){return this.high===0&&this.low===0};ir.eqz=ir.isZero;ir.isNegative=function(){return!this.unsigned&&this.high<0};ir.isPositive=function(){return this.unsigned||this.high>=0};ir.isOdd=function(){return(this.low&1)===1};ir.isEven=function(){return(this.low&1)===0};ir.equals=function(e){return No(e)||(e=Sl(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ir.eq=ir.equals;ir.notEquals=function(e){return!this.eq(e)};ir.neq=ir.notEquals;ir.ne=ir.notEquals;ir.lessThan=function(e){return this.comp(e)<0};ir.lt=ir.lessThan;ir.lessThanOrEqual=function(e){return this.comp(e)<=0};ir.lte=ir.lessThanOrEqual;ir.le=ir.lessThanOrEqual;ir.greaterThan=function(e){return this.comp(e)>0};ir.gt=ir.greaterThan;ir.greaterThanOrEqual=function(e){return this.comp(e)>=0};ir.gte=ir.greaterThanOrEqual;ir.ge=ir.greaterThanOrEqual;ir.compare=function(e){if(No(e)||(e=Sl(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ir.comp=ir.compare;ir.negate=function(){return!this.unsigned&&this.eq(xa)?xa:this.not().add(Pm)};ir.neg=ir.negate;ir.add=function(e){No(e)||(e=Sl(e));var t=this.high>>>16,i=this.high&65535,n=this.low>>>16,s=this.low&65535,a=e.high>>>16,c=e.high&65535,d=e.low>>>16,p=e.low&65535,b=0,T=0,B=0,z=0;return z+=s+p,B+=z>>>16,z&=65535,B+=n+d,T+=B>>>16,B&=65535,T+=i+c,b+=T>>>16,T&=65535,b+=t+a,b&=65535,Zi(B<<16|z,b<<16|T,this.unsigned)};ir.subtract=function(e){return No(e)||(e=Sl(e)),this.add(e.neg())};ir.sub=ir.subtract;ir.multiply=function(e){if(this.isZero())return this;if(No(e)||(e=Sl(e)),Tl){var t=Tl.mul(this.low,this.high,e.low,e.high);return Zi(t,Tl.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Rh:wc;if(this.eq(xa))return e.isOdd()?xa:wc;if(e.eq(xa))return this.isOdd()?xa:wc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(xj)&&e.lt(xj))return El(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,s=this.low>>>16,a=this.low&65535,c=e.high>>>16,d=e.high&65535,p=e.low>>>16,b=e.low&65535,T=0,B=0,z=0,G=0;return G+=a*b,z+=G>>>16,G&=65535,z+=s*b,B+=z>>>16,z&=65535,z+=a*p,B+=z>>>16,z&=65535,B+=n*b,T+=B>>>16,B&=65535,B+=s*p,T+=B>>>16,B&=65535,B+=a*d,T+=B>>>16,B&=65535,T+=i*b+n*p+s*d+a*c,T&=65535,Zi(z<<16|G,T<<16|B,this.unsigned)};ir.mul=ir.multiply;ir.divide=function(e){if(No(e)||(e=Sl(e)),e.isZero())throw Error("division by zero");if(Tl){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Tl.div_u:Tl.div_s)(this.low,this.high,e.low,e.high);return Zi(t,Tl.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Rh:wc;var i,n,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Rh;if(e.gt(this.shru(1)))return vj;s=Rh}else{if(this.eq(xa)){if(e.eq(Pm)||e.eq(XP))return xa;if(e.eq(xa))return Pm;var a=this.shr(1);return i=a.div(e).shl(1),i.eq(wc)?e.isNegative()?Pm:XP:(n=this.sub(e.mul(i)),s=i.add(n.div(e)),s)}else if(e.eq(xa))return this.unsigned?Rh:wc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=wc}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var c=Math.ceil(Math.log(i)/Math.LN2),d=c<=48?1:E3(2,c-48),p=El(i),b=p.mul(e);b.isNegative()||b.gt(n);)i-=d,p=El(i,this.unsigned),b=p.mul(e);p.isZero()&&(p=Pm),s=s.add(p),n=n.sub(b)}return s};ir.div=ir.divide;ir.modulo=function(e){if(No(e)||(e=Sl(e)),Tl){var t=(this.unsigned?Tl.rem_u:Tl.rem_s)(this.low,this.high,e.low,e.high);return Zi(t,Tl.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ir.mod=ir.modulo;ir.rem=ir.modulo;ir.not=function(){return Zi(~this.low,~this.high,this.unsigned)};ir.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};ir.clz=ir.countLeadingZeros;ir.countTrailingZeros=function(){return this.low?Aj(this.low):Aj(this.high)+32};ir.ctz=ir.countTrailingZeros;ir.and=function(e){return No(e)||(e=Sl(e)),Zi(this.low&e.low,this.high&e.high,this.unsigned)};ir.or=function(e){return No(e)||(e=Sl(e)),Zi(this.low|e.low,this.high|e.high,this.unsigned)};ir.xor=function(e){return No(e)||(e=Sl(e)),Zi(this.low^e.low,this.high^e.high,this.unsigned)};ir.shiftLeft=function(e){return No(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Zi(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Zi(0,this.low<<e-32,this.unsigned)};ir.shl=ir.shiftLeft;ir.shiftRight=function(e){return No(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Zi(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Zi(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ir.shr=ir.shiftRight;ir.shiftRightUnsigned=function(e){return No(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Zi(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Zi(this.high,0,this.unsigned):Zi(this.high>>>e-32,0,this.unsigned)};ir.shru=ir.shiftRightUnsigned;ir.shr_u=ir.shiftRightUnsigned;ir.rotateLeft=function(e){var t;return No(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Zi(this.high,this.low,this.unsigned):e<32?(t=32-e,Zi(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Zi(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};ir.rotl=ir.rotateLeft;ir.rotateRight=function(e){var t;return No(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Zi(this.high,this.low,this.unsigned):e<32?(t=32-e,Zi(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Zi(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};ir.rotr=ir.rotateRight;ir.toSigned=function(){return this.unsigned?Zi(this.low,this.high,!1):this};ir.toUnsigned=function(){return this.unsigned?this:Zi(this.low,this.high,!0)};ir.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ir.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ir.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Tn.fromBytes=function(e,t,i){return i?Tn.fromBytesLE(e,t):Tn.fromBytesBE(e,t)};Tn.fromBytesLE=function(e,t){return new Tn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Tn.fromBytesBE=function(e,t){return new Tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};typeof BigInt=="function"&&(Tn.fromBigInt=function(e,t){var i=Number(BigInt.asIntN(32,e)),n=Number(BigInt.asIntN(32,e>>BigInt(32)));return Zi(i,n,t)},Tn.fromValue=function(e,t){return typeof e=="bigint"?fromBigInt(e,t):Sl(e,t)},ir.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});var Rm=Tn;var ppe=16;function Qy(r){r==="X"&&(r="");let e=r.padEnd(ppe,"0");return Rm.fromString(e,!0,16)}function KP(r){if(r.isZero())return"X";let e=r.countTrailingZeros(),t=e%4;e=(e-t)/4;let i=e;e*=4;let s=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-s.length).join("0")+s}function QP(r,e){let t=Ape(r).shiftRightUnsigned(2);return r.add(Rm.fromNumber(2*e+1-4).multiply(t))}function Ape(r){return r.and(r.not().add(1))}var mpe=3,gpe=30,_pe=2*gpe+1,Ej=180/Math.PI;function Cj(r){if(r.length===0)throw new Error(`Invalid Hilbert quad key ${r}`);let e=r.split("/"),t=parseInt(e[0],10),i=e[1],n=i.length,s=0,a=[0,0];for(let c=n-1;c>=0;c--){s=n-c;let d=i[c],p=0,b=0;d==="1"?b=1:d==="2"?(p=1,b=1):d==="3"&&(p=1);let T=Math.pow(2,s-1);ype(T,a,p,b),a[0]+=T*p,a[1]+=T*b}if(t%2===1){let c=a[0];a[0]=a[1],a[1]=c}return{face:t,ij:a,level:s}}function Ij(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<mpe+_pe;)e="0"+e;let t=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,t),s=n.length/2,a=Rm.fromString(i,!0,2).toString(10),c="";if(s!==0)for(c=Rm.fromString(n,!0,2).toString(4);c.length<s;)c="0"+c;return`${a}/${c}`}function JP(r,e,t){let i=1<<e;return[(r[0]+t[0])/i,(r[1]+t[1])/i]}function Sj(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function eM(r){return[Sj(r[0]),Sj(r[1])]}function tM(r,[e,t]){switch(r){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function rM([r,e,t]){let i=Math.atan2(t,Math.sqrt(r*r+e*e));return[Math.atan2(e,r)*Ej,i*Ej]}function ype(r,e,t,i){if(i===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function Pj(r){let e=JP(r.ij,r.level,[.5,.5]),t=eM(e),i=tM(r.face,t);return rM(i)}var xpe=100;function iM(r){let{face:e,ij:t,level:i}=r,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(xpe*Math.pow(2,-i))),a=new Float64Array(4*s*2+2),c=0,d=0;for(let p=0;p<4;p++){let b=n[p].slice(0),T=n[p+1],B=(T[0]-b[0])/s,z=(T[1]-b[1])/s;for(let G=0;G<s;G++){b[0]+=B,b[1]+=z;let Z=JP(t,i,b),q=eM(Z),re=tM(e,q),ee=rM(re);Math.abs(ee[1])>89.999&&(ee[0]=d);let ae=ee[0]-d;ee[0]+=ae>180?-360:ae<-180?360:0,a[c++]=ee[0],a[c++]=ee[1],d=ee[0]}}return a[c++]=a[0],a[c++]=a[1],a}function Bm(r){let e=bpe(r);return Cj(e)}function bpe(r){if(r.indexOf("/")>0)return r;let e=Qy(r);return Ij(e)}function nM(r){let e=Bm(r);return Pj(e)}function Rj(r){let e;if(r.face===2||r.face===5){let t=null,i=0;for(let n=0;n<4;n++){let s=`${r.face}/${n}`,a=Bm(s),c=iM(a);(typeof t>"u"||t===null)&&(t=new Float64Array(4*c.length)),t.set(c,i),i+=c.length}e=Mj(t)}else{let t=iM(r);e=Mj(t)}return e}function Mj(r){if(r.length%2!==0)throw new Error("Invalid corners");let e=[],t=[];for(let i=0;i<r.length;i+=2)e.push(r[i]),t.push(r[i+1]);return e.sort((i,n)=>i-n),t.sort((i,n)=>i-n),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function sM(r,e){let t=e?.minimumHeight||0,i=e?.maximumHeight||0,n=Bm(r),s=Rj(n),a=s.west,c=s.south,d=s.east,p=s.north,b=[];return b.push(new st(a,p,t)),b.push(new st(d,p,t)),b.push(new st(d,c,t)),b.push(new st(a,c,t)),b.push(new st(a,p,i)),b.push(new st(d,p,i)),b.push(new st(d,c,i)),b.push(new st(a,c,i)),b}function S3(r){let e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},i=sM(e,t),n=nM(e),s=n[0],a=n[1],c=Mi.WGS84.cartographicToCartesian([s,a,t.maximumHeight]),d=new st(c[0],c[1],c[2]);i.push(d);let p=By(i);return[...p.center,...p.halfAxes]}var vpe=4,wpe=8,Tpe={QUADTREE:vpe,OCTREE:wpe};function Epe(r,e,t){if(r?.box){let i=Qy(r.s2VolumeInfo.token),n=QP(i,e),s=KP(n),a={...r.s2VolumeInfo};switch(a.token=s,t){case"OCTREE":let p=r.s2VolumeInfo,b=p.maximumHeight-p.minimumHeight,T=b/2,B=p.minimumHeight+b/2;p.minimumHeight=B-T,p.maximumHeight=B+T;break;default:break}return{box:S3(a),s2VolumeInfo:a}}}async function aM(r){let{subtree:e,subtreeData:t={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:n=0,implicitOptions:s,loaderOptions:a,s2VolumeBox:c}=r,{subdivisionScheme:d,subtreeLevels:p,maximumLevel:b,contentUrlTemplate:T,subtreesUriTemplate:B,basePath:z}=s,G={children:[],lodMetricValue:0,contentUrl:""};if(!b)return lE.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${T} won't be loaded...`),G;let Z=i.localLevel+1,q=t.level+Z;if(q>b)return G;let re=Tpe[d],ee=Math.log2(re),ae=n&1,me=n>>1&1,Le=n>>2&1,je=lA(i.localX,ae,1),Je=lA(i.localY,me,1),J=lA(i.localZ,Le,1),te=lA(t.x,je,Z),X=lA(t.y,Je,Z),ye=lA(t.z,J,Z),_e=lA(i.mortonIndex,n,ee),Oe=Z===p&&oM(e.childSubtreeAvailability,_e),ve,De,Xe,rt;if(Oe){let Xt=`${z}/${B}`,jt=C3(Xt,q,te,X,ye);ve=await oo(jt,T3,a),rt=0,De={level:q,x:te,y:X,z:ye},Xe={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else ve=e,rt=(re**Z-1)/(re-1)+_e,De=t,Xe={mortonIndex:_e,localLevel:Z,localX:je,localY:Je,localZ:J};if(!oM(ve.tileAvailability,rt))return G;oM(ve.contentAvailability,rt)&&(G.contentUrl=C3(T,q,te,X,ye));for(let Xt=0;Xt<re;Xt++){let jt=Epe(c,Xt,d),fr=await aM({subtree:ve,subtreeData:De,parentData:Xe,childIndex:Xt,implicitOptions:s,loaderOptions:a,s2VolumeBox:jt});(fr.contentUrl||fr.children.length)&&G.children.push(fr)}return G.contentUrl||G.children.length?Spe(G,{level:q,x:te,y:X,z:ye},s,c):G}function oM(r,e){let t;return Array.isArray(r)?(t=r[0],r.length>1&&lE.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=r,"constant"in t?!!t.constant:t.explicitBitstream?Ppe(e,t.explicitBitstream):!1}function Spe(r,e,t,i){let{basePath:n,refine:s,getRefine:a,lodMetricType:c,getTileType:d,rootLodMetricValue:p,rootBoundingVolume:b}=t,T=r.contentUrl&&r.contentUrl.replace(`${n}/`,""),B=p/2**e.level,z=i?.box?{box:i.box}:b,G=Cpe(z,e,t.subdivisionScheme);return{children:r.children,contentUrl:r.contentUrl,content:{uri:T},id:r.contentUrl,refine:a(s),type:d(r),lodMetricType:c,lodMetricValue:B,geometricError:B,transform:r.transform,boundingVolume:G}}function Cpe(r,e,t){if(r.region){let{level:i,x:n,y:s,z:a}=e,[c,d,p,b,T,B]=r.region,z=2**i,G=(p-c)/z,[Z,q]=[c+G*n,c+G*(n+1)],re=(b-d)/z,[ee,ae]=[d+re*s,d+re*(s+1)],me,Le;if(t==="OCTREE"){let je=(B-T)/z;[me,Le]=[T+je*a,T+je*(a+1)]}else[me,Le]=[T,B];return{region:[Z,ee,q,ae,me,Le]}}if(r.box)return r;throw new Error(`Unsupported bounding volume type ${JSON.stringify(r)}`)}function lA(r,e,t){return(r<<t)+e}function C3(r,e,t,i,n){let s=Ipe({level:e,x:t,y:i,z:n});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function Ipe(r){let e={};for(let t in r)e[`{${t}}`]=r[t];return e}function Ppe(r,e){let t=Math.floor(r/8),i=r%8;return(e[t]>>i&1)===1}function cM(r,e=""){if(!e)return wl.EMPTY;let i=e.split("?")[0].split(".").pop();switch(i){case"pnts":return wl.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return wl.SCENEGRAPH;default:return i||wl.EMPTY}}function uM(r){switch(r){case"REPLACE":case"replace":return ko.REPLACE;case"ADD":case"add":return ko.ADD;default:return r}}function lM(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){let i=new URL(r,`${e}/`);return decodeURI(i.toString())}else if(r.startsWith("/"))return r;return Ua.resolve(e,r)}function Bj(r,e){if(!r)return null;let t;if(r.content){let n=r.content.uri||r.content?.url;typeof n<"u"&&(t=lM(n,e))}return{...r,id:t,contentUrl:t,lodMetricType:Ph.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:cM(r,t),refine:uM(r.refine)}}async function Dj(r,e,t){let i=null,n=Oj(r.root);n&&r.root?i=await Lj(r.root,r,e,n,t):i=Bj(r.root,e);let s=[];for(s.push(i);s.length>0;){let a=s.pop()||{},c=a.children||[],d=[];for(let p of c){let b=Oj(p),T;b?T=await Lj(p,r,e,b,t):T=Bj(p,e),T&&(d.push(T),s.push(T))}a.children=d}return i}async function Lj(r,e,t,i,n){let{subdivisionScheme:s,maximumLevel:a,availableLevels:c,subtreeLevels:d,subtrees:{uri:p}}=i,b=C3(p,0,0,0,0),T=lM(b,t),B=await oo(T,T3,n),z=r.content?.uri,G=z?lM(z,t):"",Z=e?.root?.refine,q=r.geometricError,re=r.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(re){let Le={box:S3(re),s2VolumeInfo:re};r.boundingVolume=Le}let ee=r.boundingVolume,ae={contentUrlTemplate:G,subtreesUriTemplate:p,subdivisionScheme:s,subtreeLevels:d,maximumLevel:Number.isFinite(c)?c-1:a,refine:Z,basePath:t,lodMetricType:Ph.GEOMETRIC_ERROR,rootLodMetricValue:q,rootBoundingVolume:ee,getTileType:cM,getRefine:uM};return await Mpe(r,t,B,ae,n)}async function Mpe(r,e,t,i,n){if(!r)return null;let{children:s,contentUrl:a}=await aM({subtree:t,implicitOptions:i,loaderOptions:n}),c,d=null;return a&&(c=a,d={uri:a.replace(`${e}/`,"")}),{...r,id:c,contentUrl:c,lodMetricType:Ph.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:cM(r,c),refine:uM(r.refine),content:d||r.content,children:s}}function Oj(r){return r?.extensions?.["3DTILES_implicit_tiling"]||r?.implicitTiling}var I3={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:_3,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Rpe,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Rpe(r,e={},t){let i=e["3d-tiles"]||{},n;return i.isTileset==="auto"?n=t?.url&&t.url.indexOf(".json")!==-1:n=i.isTileset,n?Bpe(r,e,t):Lpe(r,e,t)}async function Bpe(r,e,t){let i=JSON.parse(new TextDecoder().decode(r)),n=t?.url||"",s=Ope(n),a=await Dj(i,s,e||{});return{...i,shape:"tileset3d",loader:I3,url:n,queryString:t?.queryString||"",basePath:s,root:a||i.root,type:ho.TILES3D,lodMetricType:Ph.GEOMETRIC_ERROR,lodMetricValue:i.root?.geometricError||0}}async function Lpe(r,e,t){let i={content:{shape:"tile3d",featureIds:null}};return await qP(r,0,e,t,i.content),i.content}function Ope(r){return Ua.dirname(r)}var kj=[0],Dpe={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:I3,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,e,t)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}},Jy=class extends Zn{initializeState(){"onTileLoadFail"in this.props&&cr.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:i}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),i.viewportChanged){let{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(i.propsChanged){let{layerMap:n}=this.state;for(let s in n)n[s].needsUpdate=!0}}activateViewport(e){let{activeViewports:t,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,t[e.id]=e;let n=i?.[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){let i=t&&t.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:t}){let{tile:i}=e.props,{id:n}=t;return i.selected&&i.viewportIds.includes(n)}_updateAutoHighlight(e){let t=e.sourceTile,i=this.state.layerMap[t?.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){let{loadOptions:t={}}=this.props,i=this.props.loader||this.props.loaders,n=Array.isArray(i)?i[0]:i,s={loadOptions:{...t}},a=e;if(n.preload){let p=await n.preload(e,t);p.url&&(a=p.url),p.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:p.headers}),Object.assign(s,p)}let c=await oo(a,n,s.loadOptions),d=new Ky(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:d,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(d)}_onTileLoad(e){let{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;let{tileset3d:t}=this.state,{timeline:i}=this.context,n=Object.keys(e).length;!i||!n||!t||t.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case wl.POINTCLOUD:return this._makePointCloudLayer(e,t);case wl.SCENEGRAPH:return this._make3DModelLayer(e);case wl.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){let{attributes:i,pointCount:n,constantRGBA:s,cartographicOrigin:a,modelMatrix:c}=e.content,{positions:d,normals:p,colors:b}=i;if(!d)return null;let T=t&&t.props.data||{header:{vertexCount:n},attributes:{POSITION:d,NORMAL:p,COLOR_0:b}},{pointSize:B,getPointColor:z}=this.props,G=this.getSubLayerClass("pointcloud",Dv);return new G({pointSize:B},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:T,coordinateSystem:br.METER_OFFSETS,coordinateOrigin:a,modelMatrix:c,getColor:s||z,_offset:0})}_make3DModelLayer(e){let{gltf:t,instances:i,cartographicOrigin:n,modelMatrix:s}=e.content,a=this.getSubLayerClass("scenegraph",CP);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||kj,scenegraph:t,coordinateSystem:br.METER_OFFSETS,coordinateOrigin:n,modelMatrix:s,getTransformMatrix:c=>c.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){let i=e.content,{attributes:n,indices:s,modelMatrix:a,cartographicOrigin:c,coordinateSystem:d=br.METER_OFFSETS,material:p,featureIds:b}=i,{_getMeshColor:T}=this.props,B=t&&t.props.mesh||new Xi({topology:"triangle-list",attributes:kpe(n),indices:s}),z=this.getSubLayerClass("mesh",pV);return new z(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:B,data:kj,getColor:T(e),pbrMaterial:p,modelMatrix:a,coordinateOrigin:c,coordinateSystem:d,featureIds:b,_offset:0})}renderLayers(){let{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(i=>{let n=t[i.id]=t[i.id]||{tile:i},{layer:s}=n;return i.selected&&(s?n.needsUpdate&&(s=this._getSubLayer(i,s),n.needsUpdate=!1):s=this._getSubLayer(i)),n.layer=s,s}).filter(Boolean):null}};Jy.defaultProps=Dpe;Jy.layerName="Tile3DLayer";var Fj=Jy;function kpe(r){let e={};return e.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(e.normals=r.normals),r.texCoords&&(e.texCoords=r.texCoords),r.colors&&(e.colors=r.colors),r.uvRegions&&(e.uvRegions=r.uvRegions),e}var Fpe=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function hM(r){return r>>1^-(r&1)}function Npe(r){let e=0,t={};for(let[i,n]of Fpe){let s=n===8?r.getFloat64:r.getFloat32;t[i]=s.call(r,e,!0),e+=n}return{header:t,headerEndPosition:e}}function zpe(r,e){let t=e,i=3,n=r.getUint32(t,!0),s=new Uint16Array(n*i);t+=Uint32Array.BYTES_PER_ELEMENT;let a=Uint16Array.BYTES_PER_ELEMENT,c=n*a,d=t,p=d+c,b=p+c,T=0,B=0,z=0;for(let G=0;G<n;G++)T+=hM(r.getUint16(d+a*G,!0)),B+=hM(r.getUint16(p+a*G,!0)),z+=hM(r.getUint16(b+a*G,!0)),s[G]=T,s[G+n]=B,s[G+n*2]=z;return t+=c*3,{vertexData:s,vertexDataEndPosition:t}}function ex(r,e,t,i,n=!0){let s;if(i===2?s=new Uint16Array(r,e,t):s=new Uint32Array(r,e,t),!n)return s;let a=0;for(let c=0;c<s.length;++c){let d=s[c];s[c]=a-d,d===0&&++a}return s}function Upe(r,e,t){let i=t,n=3,a=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%a!==0&&(i+=a-i%a);let c=r.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let d=c*3,p=ex(r.buffer,i,d,a);return i+=d*a,{triangleIndicesEndPosition:i,triangleIndices:p}}function Vpe(r,e,t){let i=t,n=3,a=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,c=r.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let d=ex(r.buffer,i,c,a,!1);i+=c*a;let p=r.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let b=ex(r.buffer,i,p,a,!1);i+=p*a;let T=r.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let B=ex(r.buffer,i,T,a,!1);i+=T*a;let z=r.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let G=ex(r.buffer,i,z,a,!1);return i+=z*a,{edgeIndicesEndPosition:i,westIndices:d,southIndices:b,eastIndices:B,northIndices:G}}function jpe(r){return new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}function Gpe(r){return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function Hpe(r,e){let t={};if(r.byteLength<=e)return{extensions:t,extensionsEndPosition:e};let i=e;for(;i<r.byteLength;){let n=r.getUint8(i,!0);i+=Uint8Array.BYTES_PER_ELEMENT;let s=r.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let a=new DataView(r.buffer,i,s);switch(n){case 1:{t.vertexNormals=jpe(a);break}case 2:{t.waterMask=Gpe(a);break}default:}i+=s}return{extensions:t,extensionsEndPosition:i}}var cA={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},Wpe={maxDecodingStep:cA.extensions};function fM(r,e){let t=Object.assign({},Wpe,e),i=new DataView(r),{header:n,headerEndPosition:s}=Npe(i);if(t.maxDecodingStep<cA.vertices)return{header:n};let{vertexData:a,vertexDataEndPosition:c}=zpe(i,s);if(t.maxDecodingStep<cA.triangleIndices)return{header:n,vertexData:a};let{triangleIndices:d,triangleIndicesEndPosition:p}=Upe(i,a,c);if(t.maxDecodingStep<cA.edgeIndices)return{header:n,vertexData:a,triangleIndices:d};let{westIndices:b,southIndices:T,eastIndices:B,northIndices:z,edgeIndicesEndPosition:G}=Vpe(i,a,p);if(t.maxDecodingStep<cA.extensions)return{header:n,vertexData:a,triangleIndices:d,westIndices:b,northIndices:z,eastIndices:B,southIndices:T};let{extensions:Z}=Hpe(i,G);return{header:n,vertexData:a,triangleIndices:d,westIndices:b,northIndices:z,eastIndices:B,southIndices:T,extensions:Z}}function P3(r,e,t,i){let n=i?qpe(i,r.POSITION.value):$pe(e),s=new r.POSITION.value.constructor(n.length*6),a=new r.TEXCOORD_0.value.constructor(n.length*4),c=new e.constructor(n.length*6);for(let p=0;p<n.length;p++){let b=n[p];Zpe({edge:b,edgeIndex:p,attributes:r,skirtHeight:t,newPosition:s,newTexcoord0:a,newTriangles:c})}r.POSITION.value=kg(r.POSITION.value,s),r.TEXCOORD_0.value=kg(r.TEXCOORD_0.value,a);let d=e instanceof Array?e.concat(c):kg(e,c);return{attributes:r,triangles:d}}function $pe(r){let e=[];for(let n=0;n<r.length;n+=3)e.push([r[n],r[n+1]]),e.push([r[n+1],r[n+2]]),e.push([r[n+2],r[n]]);e.sort((n,s)=>Math.min(...n)-Math.min(...s)||Math.max(...n)-Math.max(...s));let t=[],i=0;for(;i<e.length;)e[i][0]===e[i+1]?.[1]&&e[i][1]===e[i+1]?.[0]?i+=2:(t.push(e[i]),i++);return t}function qpe(r,e){r.westIndices.sort((i,n)=>e[3*i+1]-e[3*n+1]),r.eastIndices.sort((i,n)=>e[3*n+1]-e[3*i+1]),r.southIndices.sort((i,n)=>e[3*n]-e[3*i]),r.northIndices.sort((i,n)=>e[3*i]-e[3*n]);let t=[];for(let i in r){let n=r[i];for(let s=0;s<n.length-1;s++)t.push([n[s],n[s+1]])}return t}function Zpe({edge:r,edgeIndex:e,attributes:t,skirtHeight:i,newPosition:n,newTexcoord0:s,newTriangles:a}){let c=t.POSITION.value.length,d=e*2,p=e*2+1;n.set(t.POSITION.value.subarray(r[0]*3,r[0]*3+3),d*3),n[d*3+2]=n[d*3+2]-i,n.set(t.POSITION.value.subarray(r[1]*3,r[1]*3+3),p*3),n[p*3+2]=n[p*3+2]-i,s.set(t.TEXCOORD_0.value.subarray(r[0]*2,r[0]*2+2),d*2),s.set(t.TEXCOORD_0.value.subarray(r[1]*2,r[1]*2+2),p*2);let b=e*2*3;a[b]=r[0],a[b+1]=c/3+p,a[b+2]=r[1],a[b+3]=c/3+p,a[b+4]=r[0],a[b+5]=c/3+d}function dM(r,e={}){let{bounds:t}=e,{header:i,vertexData:n,triangleIndices:s,westIndices:a,northIndices:c,eastIndices:d,southIndices:p}=fM(r,cA.triangleIndices),b=s,T=Xpe(n,i,t),B=ch(T);if(e?.skirtHeight){let{attributes:z,triangles:G}=P3(T,b,e.skirtHeight,{westIndices:a,northIndices:c,eastIndices:d,southIndices:p});T=z,b=G}return{loaderData:{header:{}},header:{vertexCount:b.length,boundingBox:B},schema:void 0,topology:"triangle-list",mode:4,indices:{value:b,size:1},attributes:T}}function Xpe(r,e,t){let{minHeight:i,maxHeight:n}=e,[s,a,c,d]=t||[0,0,1,1],p=c-s,b=d-a,T=n-i,B=r.length/3,z=new Float32Array(B*3),G=new Float32Array(B*2);for(let Z=0;Z<B;Z++){let q=r[Z]/32767,re=r[Z+B]/32767,ee=r[Z+B*2]/32767;z[3*Z+0]=q*p+s,z[3*Z+1]=re*b+a,z[3*Z+2]=ee*T+i,G[2*Z+0]=q,G[2*Z+1]=re}return{POSITION:{value:z,size:3},TEXCOORD_0:{value:G,size:2}}}var tx=class{constructor(e=257){this.gridSize=e;let t=e-1;if(t&t-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=t*t*2-2,this.numParentTriangles=this.numTriangles-t*t,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let i=0;i<this.numTriangles;i++){let n=i+2,s=0,a=0,c=0,d=0,p=0,b=0;for(n&1?c=d=p=t:s=a=b=t;(n>>=1)>1;){let B=s+c>>1,z=a+d>>1;n&1?(c=s,d=a,s=p,a=b):(s=c,a=d,c=p,d=b),p=B,b=z}let T=i*4;this.coords[T+0]=s,this.coords[T+1]=a,this.coords[T+2]=c,this.coords[T+3]=d}}createTile(e){return new pM(e,this)}},pM=class{constructor(e,t){let i=t.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=t,this.errors=new Float32Array(e.length),this.update()}update(){let{numTriangles:e,numParentTriangles:t,coords:i,gridSize:n}=this.martini,{terrain:s,errors:a}=this;for(let c=e-1;c>=0;c--){let d=c*4,p=i[d+0],b=i[d+1],T=i[d+2],B=i[d+3],z=p+T>>1,G=b+B>>1,Z=z+G-b,q=G+p-z,re=(s[b*n+p]+s[B*n+T])/2,ee=G*n+z,ae=Math.abs(re-s[ee]);if(a[ee]=Math.max(a[ee],ae),c<t){let me=(b+q>>1)*n+(p+Z>>1),Le=(B+q>>1)*n+(T+Z>>1);a[ee]=Math.max(a[ee],a[me],a[Le])}}}getMesh(e=0){let{gridSize:t,indices:i}=this.martini,{errors:n}=this,s=0,a=0,c=t-1;i.fill(0);function d(z,G,Z,q,re,ee){let ae=z+Z>>1,me=G+q>>1;Math.abs(z-re)+Math.abs(G-ee)>1&&n[me*t+ae]>e?(d(re,ee,z,G,ae,me),d(Z,q,re,ee,ae,me)):(i[G*t+z]=i[G*t+z]||++s,i[q*t+Z]=i[q*t+Z]||++s,i[ee*t+re]=i[ee*t+re]||++s,a++)}d(0,0,c,c,c,0),d(c,c,0,0,0,c);let p=new Uint16Array(s*2),b=new Uint32Array(a*3),T=0;function B(z,G,Z,q,re,ee){let ae=z+Z>>1,me=G+q>>1;if(Math.abs(z-re)+Math.abs(G-ee)>1&&n[me*t+ae]>e)B(re,ee,z,G,ae,me),B(Z,q,re,ee,ae,me);else{let Le=i[G*t+z]-1,je=i[q*t+Z]-1,Je=i[ee*t+re]-1;p[2*Le]=z,p[2*Le+1]=G,p[2*je]=Z,p[2*je+1]=q,p[2*Je]=re,p[2*Je+1]=ee,b[T++]=Le,b[T++]=je,b[T++]=Je}}return B(0,0,c,c,c,0),B(c,c,0,0,0,c),{vertices:p,triangles:b}}};var rx=class{constructor(e,t,i=t){this.data=e,this.width=t,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;let n=t-1,s=i-1,a=this._addPoint(0,0),c=this._addPoint(n,0),d=this._addPoint(0,s),p=this._addPoint(n,s),b=this._addTriangle(p,a,d,-1,-1,-1);this._addTriangle(a,p,c,b,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,t){return this.data[this.width*t+e]}_flush(){let e=this.coords;for(let t=0;t<this._pendingLen;t++){let i=this._pending[t],n=2*this.triangles[i*3+0],s=2*this.triangles[i*3+1],a=2*this.triangles[i*3+2];this._findCandidate(e[n],e[n+1],e[s],e[s+1],e[a],e[a+1],i)}this._pendingLen=0}_findCandidate(e,t,i,n,s,a,c){let d=Math.min(e,i,s),p=Math.min(t,n,a),b=Math.max(e,i,s),T=Math.max(t,n,a),B=uA(i,n,s,a,d,p),z=uA(s,a,e,t,d,p),G=uA(e,t,i,n,d,p),Z=n-t,q=e-i,re=a-n,ee=i-s,ae=t-a,me=s-e,Le=uA(e,t,i,n,s,a),je=this.heightAt(e,t)/Le,Je=this.heightAt(i,n)/Le,J=this.heightAt(s,a)/Le,te=0,X=0,ye=0,_e=0;for(let Oe=p;Oe<=T;Oe++){let ve=0;B<0&&re!==0&&(ve=Math.max(ve,Math.floor(-B/re))),z<0&&ae!==0&&(ve=Math.max(ve,Math.floor(-z/ae))),G<0&&Z!==0&&(ve=Math.max(ve,Math.floor(-G/Z)));let De=B+re*ve,Xe=z+ae*ve,rt=G+Z*ve,tt=!1;for(let yt=d+ve;yt<=b;yt++){if(De>=0&&Xe>=0&&rt>=0){tt=!0;let Xt=je*De+Je*Xe+J*rt,jt=Math.abs(Xt-this.heightAt(yt,Oe));_e+=jt*jt,jt>te&&(te=jt,X=yt,ye=Oe)}else if(tt)break;De+=re,Xe+=ae,rt+=Z}B+=ee,z+=me,G+=q}(X===e&&ye===t||X===i&&ye===n||X===s&&ye===a)&&(te=0),this._candidates[2*c]=X,this._candidates[2*c+1]=ye,this._rms[c]=_e,this._queuePush(c,te,_e)}_step(){let e=this._queuePop(),t=e*3+0,i=e*3+1,n=e*3+2,s=this.triangles[t],a=this.triangles[i],c=this.triangles[n],d=this.coords[2*s],p=this.coords[2*s+1],b=this.coords[2*a],T=this.coords[2*a+1],B=this.coords[2*c],z=this.coords[2*c+1],G=this._candidates[2*e],Z=this._candidates[2*e+1],q=this._addPoint(G,Z);if(uA(d,p,b,T,G,Z)===0)this._handleCollinear(q,t);else if(uA(b,T,B,z,G,Z)===0)this._handleCollinear(q,i);else if(uA(B,z,d,p,G,Z)===0)this._handleCollinear(q,n);else{let re=this._halfedges[t],ee=this._halfedges[i],ae=this._halfedges[n],me=this._addTriangle(s,a,q,re,-1,-1,t),Le=this._addTriangle(a,c,q,ee,-1,me+1),je=this._addTriangle(c,s,q,ae,me+2,Le+1);this._legalize(me),this._legalize(Le),this._legalize(je)}}_addPoint(e,t){let i=this.coords.length>>1;return this.coords.push(e,t),i}_addTriangle(e,t,i,n,s,a,c=this.triangles.length){let d=c/3;return this.triangles[c+0]=e,this.triangles[c+1]=t,this.triangles[c+2]=i,this._halfedges[c+0]=n,this._halfedges[c+1]=s,this._halfedges[c+2]=a,n>=0&&(this._halfedges[n]=c+0),s>=0&&(this._halfedges[s]=c+1),a>=0&&(this._halfedges[a]=c+2),this._candidates[2*d+0]=0,this._candidates[2*d+1]=0,this._queueIndices[d]=-1,this._rms[d]=0,this._pending[this._pendingLen++]=d,c}_legalize(e){let t=this._halfedges[e];if(t<0)return;let i=e-e%3,n=t-t%3,s=i+(e+1)%3,a=i+(e+2)%3,c=n+(t+2)%3,d=n+(t+1)%3,p=this.triangles[a],b=this.triangles[e],T=this.triangles[s],B=this.triangles[c],z=this.coords;if(!Ype(z[2*p],z[2*p+1],z[2*b],z[2*b+1],z[2*T],z[2*T+1],z[2*B],z[2*B+1]))return;let G=this._halfedges[s],Z=this._halfedges[a],q=this._halfedges[c],re=this._halfedges[d];this._queueRemove(i/3),this._queueRemove(n/3);let ee=this._addTriangle(p,B,T,-1,q,G,i),ae=this._addTriangle(B,p,b,ee,Z,re,n);this._legalize(ee+1),this._legalize(ae+2)}_handleCollinear(e,t){let i=t-t%3,n=i+(t+1)%3,s=i+(t+2)%3,a=this.triangles[s],c=this.triangles[t],d=this.triangles[n],p=this._halfedges[n],b=this._halfedges[s],T=this._halfedges[t];if(T<0){let je=this._addTriangle(e,a,c,-1,b,-1,i),Je=this._addTriangle(a,e,d,je,-1,p);this._legalize(je+1),this._legalize(Je+2);return}let B=T-T%3,z=B+(T+2)%3,G=B+(T+1)%3,Z=this.triangles[z],q=this._halfedges[z],re=this._halfedges[G];this._queueRemove(B/3);let ee=this._addTriangle(a,c,e,b,-1,-1,i),ae=this._addTriangle(c,Z,e,re,-1,ee+1,B),me=this._addTriangle(Z,d,e,q,-1,ae+1),Le=this._addTriangle(d,a,e,p,ee+2,me+1);this._legalize(ee),this._legalize(ae),this._legalize(me),this._legalize(Le)}_queuePush(e,t,i){let n=this._queue.length;this._queueIndices[e]=n,this._queue.push(e),this._errors.push(t),this._rmsSum+=i,this._queueUp(n)}_queuePop(){let e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){let e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){let t=this._queueIndices[e];if(t<0){let n=this._pending.indexOf(e);if(n!==-1)this._pending[n]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}let i=this._queue.length-1;i!==t&&(this._queueSwap(t,i),this._queueDown(t,i)||this._queueUp(t)),this._queuePopBack()}_queueLess(e,t){return this._errors[e]>this._errors[t]}_queueSwap(e,t){let i=this._queue[e],n=this._queue[t];this._queue[e]=n,this._queue[t]=i,this._queueIndices[i]=t,this._queueIndices[n]=e;let s=this._errors[e];this._errors[e]=this._errors[t],this._errors[t]=s}_queueUp(e){let t=e;for(;;){let i=t-1>>1;if(i===t||!this._queueLess(t,i))break;this._queueSwap(i,t),t=i}}_queueDown(e,t){let i=e;for(;;){let n=2*i+1;if(n>=t||n<0)break;let s=n+1,a=n;if(s<t&&this._queueLess(s,n)&&(a=s),!this._queueLess(a,i))break;this._queueSwap(i,a),i=a}return i>e}};function uA(r,e,t,i,n,s){return(t-n)*(e-s)-(i-s)*(r-n)}function Ype(r,e,t,i,n,s,a,c){let d=r-a,p=e-c,b=t-a,T=i-c,B=n-a,z=s-c,G=d*d+p*p,Z=b*b+T*T,q=B*B+z*z;return d*(T*q-Z*z)-p*(b*q-Z*B)+G*(b*z-T*B)<0}function Uj(r,e){let{meshMaxError:t,bounds:i,elevationDecoder:n}=e,{data:s,width:a,height:c}=r,d,p;switch(e.tesselator){case"martini":d=M3(s,a,c,n,e.tesselator),p=Nj(t,a,d);break;case"delatin":d=M3(s,a,c,n,e.tesselator),p=zj(t,a,c,d);break;default:a===c&&!(c&a-1)?(d=M3(s,a,c,n,"martini"),p=Nj(t,a,d)):(d=M3(s,a,c,n,"delatin"),p=zj(t,a,c,d));break}let{vertices:b}=p,{triangles:T}=p,B=Kpe(b,d,a,c,i),z=ch(B);if(e.skirtHeight){let{attributes:G,triangles:Z}=P3(B,T,e.skirtHeight);B=G,T=Z}return{loaderData:{header:{}},header:{vertexCount:T.length,boundingBox:z},mode:4,indices:{value:Uint32Array.from(T),size:1},attributes:B}}function Nj(r,e,t){let i=e+1,s=new tx(i).createTile(t),{vertices:a,triangles:c}=s.getMesh(r);return{vertices:a,triangles:c}}function zj(r,e,t,i){let n=new rx(i,e+1,t+1);n.run(r);let{coords:s,triangles:a}=n;return{vertices:s,triangles:a}}function M3(r,e,t,i,n){let{rScaler:s,bScaler:a,gScaler:c,offset:d}=i,p=new Float32Array((e+1)*(t+1));for(let b=0,T=0;T<t;T++)for(let B=0;B<e;B++,b++){let z=b*4,G=r[z+0],Z=r[z+1],q=r[z+2];p[b+T]=G*s+Z*c+q*a+d}if(n==="martini"){for(let b=(e+1)*e,T=0;T<e;T++,b++)p[b]=p[b-e-1];for(let b=t,T=0;T<t+1;T++,b+=t+1)p[b]=p[b-1]}return p}function Kpe(r,e,t,i,n){let s=t+1,a=r.length/2,c=new Float32Array(a*3),d=new Float32Array(a*2),[p,b,T,B]=n||[0,0,t,i],z=(T-p)/t,G=(B-b)/i;for(let Z=0;Z<a;Z++){let q=r[Z*2],re=r[Z*2+1],ee=re*s+q;c[3*Z+0]=q*z+p,c[3*Z+1]=-re*G+B,c[3*Z+2]=e[ee],d[2*Z+0]=q/t,d[2*Z+1]=re/i}return{POSITION:{value:c,size:3},TEXCOORD_0:{value:d,size:2}}}var R3="4.3.2";var B3={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:R3,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};var Vj={dataType:null,batchType:null,name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:R3,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};var Qpe={...B3,parse:Jpe};async function Jpe(r,e,t){let i={...e,mimeType:"application/x.image",image:{...e?.image,type:"data"}},n=await za(r,[],i,t),s={...Qpe.options.terrain,...e?.terrain};return Uj(n,s)}var PYe={...Vj,parseSync:(r,e)=>dM(r,e?.["quantized-mesh"]),parse:async(r,e)=>dM(r,e?.["quantized-mesh"])};var jj=[1],eAe={...Yp.defaultProps,elevationData:cd,texture:{...cd,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[B3]};function Gj(r){return Array.isArray(r)?r.join(";"):r||""}var ix=class extends Zn{updateState({props:e,oldProps:t}){let i=e.elevationData!==t.elevationData;if(i){let{elevationData:s}=e,a=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:a})}let n=i||e.meshMaxError!==t.meshMaxError||e.elevationDecoder!==t.elevationDecoder||e.bounds!==t.bounds;if(!this.state.isTiled&&n){let s=this.loadTerrain(e);this.setState({terrain:s})}e.workerUrl&&cr.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:t,elevationDecoder:i,meshMaxError:n,signal:s}){if(!e)return null;let a=this.getLoadOptions();a={...a,terrain:{skirtHeight:this.state.isTiled?n*2:0,...a?.terrain,bounds:t,meshMaxError:n,elevationDecoder:i}};let{fetch:c}=this.props;return c(e,{propName:"elevationData",layer:this,loadOptions:a,signal:s})}getTiledTerrainData(e){let{elevationData:t,fetch:i,texture:n,elevationDecoder:s,meshMaxError:a}=this.props,{viewport:c}=this.context,d=Iu(t,e),p=n&&Iu(n,e),{signal:b}=e,T=[0,0],B=[0,0];if(c.isGeospatial){let q=e.bbox;T=c.projectFlat([q.west,q.south]),B=c.projectFlat([q.east,q.north])}else{let q=e.bbox;T=[q.left,q.bottom],B=[q.right,q.top]}let z=[T[0],T[1],B[0],B[1]],G=this.loadTerrain({elevationData:d,bounds:z,elevationDecoder:s,meshMaxError:a,signal:b}),Z=p?i(p,{propName:"texture",layer:this,loaders:[],signal:b}).catch(q=>null):Promise.resolve(null);return Promise.all([G,Z])}renderSubLayers(e){let t=this.getSubLayerClass("mesh",pm),{color:i,wireframe:n,material:s}=this.props,{data:a}=e;if(!a)return null;let[c,d]=a;return new t(e,{data:jj,mesh:c,texture:d,_instanced:!1,coordinateSystem:br.CARTESIAN,getPosition:p=>[0,0,0],getColor:i,wireframe:n,material:s})}onViewportLoad(e){if(!e)return;let{zRange:t}=this.state,i=e.map(a=>a.content).filter(Boolean).map(a=>a[0].header.boundingBox.map(d=>d[2]));if(i.length===0)return;let n=Math.min(...i.map(a=>a[0])),s=Math.max(...i.map(a=>a[1]));(!t||n<t[0]||s>t[1])&&this.setState({zRange:[n,s]})}renderLayers(){let{color:e,material:t,elevationData:i,texture:n,wireframe:s,meshMaxError:a,elevationDecoder:c,tileSize:d,maxZoom:p,minZoom:b,extent:T,maxRequests:B,onTileLoad:z,onTileUnload:G,onTileError:Z,maxCacheSize:q,maxCacheByteSize:re,refinementStrategy:ee}=this.props;if(this.state.isTiled)return new Yp(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:Gj(i),texture:Gj(n),meshMaxError:a,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:d,maxZoom:p,minZoom:b,extent:T,maxRequests:B,onTileLoad:z,onTileUnload:G,onTileError:Z,maxCacheSize:q,maxCacheByteSize:re,refinementStrategy:ee});if(!i)return null;let ae=this.getSubLayerClass("mesh",pm);return new ae(this.getSubLayerProps({id:"mesh"}),{data:jj,mesh:this.state.terrain,texture:n,_instanced:!1,getPosition:me=>[0,0,0],getColor:e,material:t,wireframe:s})}};ix.defaultProps=eAe;ix.layerName="TerrainLayer";var Hj=ix;var tAe={clipBounds:[0,0,1,1],clipByInstance:void 0},Wj=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,rAe={name:"clip",vs:Wj,uniformTypes:{bounds:"vec4<f32>"}},iAe={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},nAe={name:"clip",fs:Wj,uniformTypes:{bounds:"vec4<f32>"}},sAe={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`},nx=class extends I4{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[rAe],inject:iAe}:{modules:[nAe],inject:sAe}}draw(){let{clipBounds:e}=this.props,t={};if(this.state.clipByInstance)t.bounds=e;else{let i=this.projectPosition([e[0],e[1],0]),n=this.projectPosition([e[2],e[3],0]);t.bounds=[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[0],n[0]),Math.max(i[1],n[1])]}this.setShaderModuleProps({clip:t})}};nx.defaultProps=tAe;nx.extensionName="ClipExtension";var AM=nx;function _M(r,e,t){let i=oAe(r),n=Object.keys(i).filter(s=>i[s]!==Array);return aAe(r,{propArrayTypes:i,...e},{numericPropKeys:t&&t.numericPropKeys||n,PositionDataType:t?t.PositionDataType:Float32Array,triangulate:t?t.triangulate:!0})}function oAe(r){let e={};for(let t of r)if(t.properties)for(let i in t.properties){let n=t.properties[i];e[i]=dAe(n,e[i])}return e}function aAe(r,e,t){let{pointPositionsCount:i,pointFeaturesCount:n,linePositionsCount:s,linePathsCount:a,lineFeaturesCount:c,polygonPositionsCount:d,polygonObjectsCount:p,polygonRingsCount:b,polygonFeaturesCount:T,propArrayTypes:B,coordLength:z}=e,{numericPropKeys:G=[],PositionDataType:Z=Float32Array,triangulate:q=!0}=t,re=r[0]&&"id"in r[0],ee=r.length>65535?Uint32Array:Uint16Array,ae={type:"Point",positions:new Z(i*z),globalFeatureIds:new ee(i),featureIds:n>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},me={type:"LineString",pathIndices:s>65535?new Uint32Array(a+1):new Uint16Array(a+1),positions:new Z(s*z),globalFeatureIds:new ee(s),featureIds:c>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},Le={type:"Polygon",polygonIndices:d>65535?new Uint32Array(p+1):new Uint16Array(p+1),primitivePolygonIndices:d>65535?new Uint32Array(b+1):new Uint16Array(b+1),positions:new Z(d*z),globalFeatureIds:new ee(d),featureIds:T>65535?new Uint32Array(d):new Uint16Array(d),numericProps:{},properties:[],fields:[]};q&&(Le.triangles=[]);for(let Je of[ae,me,Le])for(let J of G){let te=B[J];Je.numericProps[J]=new te(Je.positions.length/z)}me.pathIndices[a]=s,Le.polygonIndices[p]=d,Le.primitivePolygonIndices[b]=d;let je={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(let Je of r){let J=Je.geometry,te=Je.properties||{};switch(J.type){case"Point":lAe(J,ae,je,z,te),ae.properties.push(gM(te,G)),re&&ae.fields.push({id:Je.id}),je.pointFeature++;break;case"LineString":cAe(J,me,je,z,te),me.properties.push(gM(te,G)),re&&me.fields.push({id:Je.id}),je.lineFeature++;break;case"Polygon":uAe(J,Le,je,z,te),Le.properties.push(gM(te,G)),re&&Le.fields.push({id:Je.id}),je.polygonFeature++;break;default:throw new Error("Invalid geometry type")}je.feature++}return fAe(ae,me,Le,z)}function lAe(r,e,t,i,n){e.positions.set(r.data,t.pointPosition*i);let s=r.data.length/i;yM(e,n,t.pointPosition,s),e.globalFeatureIds.fill(t.feature,t.pointPosition,t.pointPosition+s),e.featureIds.fill(t.pointFeature,t.pointPosition,t.pointPosition+s),t.pointPosition+=s}function cAe(r,e,t,i,n){e.positions.set(r.data,t.linePosition*i);let s=r.data.length/i;yM(e,n,t.linePosition,s),e.globalFeatureIds.fill(t.feature,t.linePosition,t.linePosition+s),e.featureIds.fill(t.lineFeature,t.linePosition,t.linePosition+s);for(let a=0,c=r.indices.length;a<c;++a){let d=r.indices[a],p=a===c-1?r.data.length:r.indices[a+1];e.pathIndices[t.linePath++]=t.linePosition,t.linePosition+=(p-d)/i}}function uAe(r,e,t,i,n){e.positions.set(r.data,t.polygonPosition*i);let s=r.data.length/i;yM(e,n,t.polygonPosition,s),e.globalFeatureIds.fill(t.feature,t.polygonPosition,t.polygonPosition+s),e.featureIds.fill(t.polygonFeature,t.polygonPosition,t.polygonPosition+s);for(let a=0,c=r.indices.length;a<c;++a){let d=t.polygonPosition;e.polygonIndices[t.polygonObject++]=d;let p=r.areas[a],b=r.indices[a],T=r.indices[a+1];for(let z=0,G=b.length;z<G;++z){let Z=b[z],q=z===G-1?T===void 0?r.data.length:T[0]:b[z+1];e.primitivePolygonIndices[t.polygonRing++]=t.polygonPosition,t.polygonPosition+=(q-Z)/i}let B=t.polygonPosition;hAe(e,p,b,{startPosition:d,endPosition:B,coordLength:i})}}function hAe(r,e,t,{startPosition:i,endPosition:n,coordLength:s}){if(!r.triangles)return;let a=i*s,c=n*s,d=r.positions.subarray(a,c),p=t[0],b=t.slice(1).map(B=>(B-p)/s),T=G4(d,b,s,e);for(let B=0,z=T.length;B<z;++B)r.triangles.push(i+T[B])}function mM(r,e){let t={};for(let i in r)t[i]={value:r[i],size:e};return t}function fAe(r,e,t,i){let n={shape:"binary-feature-collection",points:{...r,positions:{value:r.positions,size:i},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:mM(r.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:mM(e.numericProps,1)},polygons:{...t,positions:{value:t.positions,size:i},polygonIndices:{value:t.polygonIndices,size:1},primitivePolygonIndices:{value:t.primitivePolygonIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:mM(t.numericProps,1)}};return n.polygons&&t.triangles&&(n.polygons.triangles={value:new Uint32Array(t.triangles),size:1}),n}function yM(r,e,t,i){for(let n in r.numericProps)if(n in e){let s=e[n];r.numericProps[n].fill(s,t,t+i)}}function gM(r,e){let t={};for(let i in r)e.includes(i)||(t[i]=r[i]);return t}function dAe(r,e){return e===Array||!Number.isFinite(r)?Array:e===Float64Array||Math.fround(r)!==r?Float64Array:Float32Array}function D3(r,e){let t=e?.globalFeatureId;return t!==void 0?pAe(r,t):AAe(r,e?.type)}function pAe(r,e){let t=qj(r);for(let i of t){let n=0,s=i.featureIds.value[0];for(let a=0;a<i.featureIds.value.length;a++){let c=i.featureIds.value[a];if(c!==s){if(e===i.globalFeatureIds.value[n])return L3(i,n,a);n=a,s=c}}if(e===i.globalFeatureIds.value[n])return L3(i,n,i.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function AAe(r,e){let t=qj(r,e);return mAe(t)}function $j(r,e,t){switch(r.type){case"Point":return xAe(r,e,t);case"LineString":return yAe(r,e,t);case"Polygon":return Zj(r,e,t);default:let i=r;throw new Error(`Unsupported geometry type: ${i?.type}`)}}function qj(r,e){let t=[];return r.points&&(r.points.type="Point",t.push(r.points)),r.lines&&(r.lines.type="LineString",t.push(r.lines)),r.polygons&&(r.polygons.type="Polygon",t.push(r.polygons)),t}function mAe(r){let e=[];for(let t of r){if(t.featureIds.value.length===0)continue;let i=0,n=t.featureIds.value[0];for(let s=0;s<t.featureIds.value.length;s++){let a=t.featureIds.value[s];a!==n&&(e.push(L3(t,i,s)),i=s,n=a)}e.push(L3(t,i,t.featureIds.value.length))}return e}function L3(r,e,t){let i=$j(r,e,t),n=_Ae(r,e,t),s=gAe(r,e,t);return{type:"Feature",geometry:i,properties:n,...s}}function gAe(r,e=0,t){return r.fields&&r.fields[r.featureIds.value[e]]}function _Ae(r,e=0,t){let i=Object.assign({},r.properties[r.featureIds.value[e]]);for(let n in r.numericProps)i[n]=r.numericProps[n].value[e];return i}function Zj(r,e=-1/0,t=1/0){let{positions:i}=r,n=r.polygonIndices.value.filter(d=>d>=e&&d<=t),s=r.primitivePolygonIndices.value.filter(d=>d>=e&&d<=t);if(!(n.length>2)){let d=[];for(let p=0;p<s.length-1;p++){let b=s[p],T=s[p+1],B=O3(i,b,T);d.push(B)}return{type:"Polygon",coordinates:d}}let c=[];for(let d=0;d<n.length-1;d++){let p=n[d],b=n[d+1],T=Zj(r,p,b).coordinates;c.push(T)}return{type:"MultiPolygon",coordinates:c}}function yAe(r,e=-1/0,t=1/0){let{positions:i}=r,n=r.pathIndices.value.filter(c=>c>=e&&c<=t);if(!(n.length>2))return{type:"LineString",coordinates:O3(i,n[0],n[1])};let a=[];for(let c=0;c<n.length-1;c++){let d=O3(i,n[c],n[c+1]);a.push(d)}return{type:"MultiLineString",coordinates:a}}function xAe(r,e,t){let{positions:i}=r,n=O3(i,e,t);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function O3(r,e,t){e=e||0,t=t||r.value.length/r.size;let i=[];for(let n=e;n<t;n++){let s=Array();for(let a=n*r.size;a<(n+1)*r.size;a++)s.push(Number(r.value[a]));i.push(s)}return i}var EM=Tf(tG(),1);function NAe(r){let e=0;for(let t=0,i=r.length-1,n,s;t<r.length;i=t++)n=r[t],s=r[i],e+=(s[0]-n[0])*(n[1]+s[1]);return e}function vM(r,e){if(Array.isArray(r[0])){for(let i of r)vM(i,e);return}let t=r;t[0]/=e,t[1]/=e}function rG(r,e){for(let t=0;t<r.length;++t)r[t]/=e}function wM(r,e,t){if(typeof r[0][0]!="number"){for(let a of r)wM(a,e,t);return}let i=t*Math.pow(2,e.z),n=t*e.x,s=t*e.y;for(let a=0;a<r.length;a++){let c=r[a];c[0]=(c[0]+n)*360/i-180;let d=180-(c[1]+s)*360/i;c[1]=360/Math.PI*Math.atan(Math.exp(d*Math.PI/180))-90}}function iG(r,e,t){let{x:i,y:n,z:s}=e,a=t*Math.pow(2,s),c=t*i,d=t*n;for(let p=0,b=r.length;p<b;p+=2){r[p]=(r[p]+c)*360/a-180;let T=180-(r[p+1]+d)*360/a;r[p+1]=360/Math.PI*Math.atan(Math.exp(T*Math.PI/180))-90}}function nG(r){let e=r.length;if(e<=1)return[r];let t=[],i,n;for(let s=0;s<e;s++){let a=NAe(r[s]);a!==0&&(n===void 0&&(n=a<0),n===a<0?(i&&t.push(i),i=[r[s]]):i&&i.push(r[s]))}return i&&t.push(i),t}function sG(r){let e=r.indices.length,t="Polygon";if(e<=1)return{type:t,data:r.data,areas:[[ed(r.data)]],indices:[r.indices]};let i=[],n=[],s=[],a=[],c,d=0;for(let p,b=0,T;b<e;b++){T=r.indices[b]-d,p=r.indices[b+1]-d||r.data.length;let B=r.data.slice(T,p),z=ed(B);if(z===0){let G=r.data.slice(0,T),Z=r.data.slice(p);r.data=G.concat(Z),d+=p-T;continue}c===void 0&&(c=z<0),c===z<0?(a.length&&(i.push(s),n.push(a)),a=[T],s=[z]):(s.push(z),a.push(T))}return s&&i.push(s),a.length&&n.push(a),{type:t,areas:i,indices:n,data:r.data}}var Dm=class{properties;extent;type;id;_pbf;_geometry;_keys;_values;_geometryInfo;static types=["Unknown","Point","LineString","Polygon"];constructor(e,t,i,n,s,a){this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=n,this._values=s,this._geometryInfo=a,e.readFields(zAe,this,t)}toGeoJSONFeature(e,t){let i=this.loadGeometry();switch(e){case"wgs84":return oG(this,i,n=>wM(n,t,this.extent));default:return oG(this,i,vM)}}toBinaryFeature(e,t){let i=this.loadFlatGeometry();switch(e){case"wgs84":return this._toBinaryCoordinates(i,n=>iG(n,t,this.extent));default:return this._toBinaryCoordinates(i,rG)}}bbox(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,i=1,n=0,s=0,a=0,c=1/0,d=-1/0,p=1/0,b=-1/0;for(;e.pos<t;){if(n<=0){let T=e.readVarint();i=T&7,n=T>>3}if(n--,i===1||i===2)s+=e.readSVarint(),a+=e.readSVarint(),s<c&&(c=s),s>d&&(d=s),a<p&&(p=a),a>b&&(b=a);else if(i!==7)throw new Error(`unknown command ${i}`)}return[c,p,d,b]}_toBinaryCoordinates(e,t){let i;t(e.data,this.extent);let n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=e.indices.length,i={type:"Point",...e};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=e.indices.length,this._geometryInfo.linePositionsCount+=e.data.length/n,i={type:"LineString",...e};break;case 3:i=sG(e),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(let a of i.indices)this._geometryInfo.polygonRingsCount+=a.length;this._geometryInfo.polygonPositionsCount+=i.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}let s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,i=1,n=0,s=0,a=0,c=[],d;for(;e.pos<t;){if(n<=0){let p=e.readVarint();i=p&7,n=p>>3}switch(n--,i){case 1:case 2:s+=e.readSVarint(),a+=e.readSVarint(),i===1&&(d&&c.push(d),d=[]),d&&d.push([s,a]);break;case 7:d&&d.push(d[0].slice());break;default:throw new Error(`unknown command ${i}`)}}return d&&c.push(d),c}loadFlatGeometry(){let e=this._pbf;e.pos=this._geometry;let t=e.readVarint()+e.pos,i=1,n,s=0,a=0,c=0,d=0,p=[],b=[];for(;e.pos<t;)if(s<=0&&(n=e.readVarint(),i=n&7,s=n>>3),s--,i===1||i===2)a+=e.readSVarint(),c+=e.readSVarint(),i===1&&p.push(d),b.push(a,c),d+=2;else if(i===7){if(d>0){let T=p[p.length-1];b.push(b[T],b[T+1]),d+=2}}else throw new Error(`unknown command ${i}`);return{data:b,indices:p}}};function oG(r,e,t){let i=Dm.types[r.type],n,s,a;switch(r.type){case 1:let d=[];for(n=0;n<e.length;n++)d[n]=e[n][0];a=d,t(a,r.extent);break;case 2:for(a=e,n=0;n<a.length;n++)t(a[n],r.extent);break;case 3:for(a=nG(e),n=0;n<a.length;n++)for(s=0;s<a[n].length;s++)t(a[n][s],r.extent);break;default:throw new Error("illegal vector tile type")}a.length===1?a=a[0]:i=`Multi${i}`;let c={type:"Feature",geometry:{type:i,coordinates:a},properties:r.properties};return r.id!==null&&(c.properties||={},c.properties.id=r.id),c}function zAe(r,e,t){e&&t&&(r===1?e.id=t.readVarint():r===2?UAe(t,e):r===3?e.type=t.readVarint():r===4&&(e._geometry=t.pos))}function UAe(r,e){let t=r.readVarint()+r.pos;for(;r.pos<t;){let i=e._keys[r.readVarint()],n=e._values[r.readVarint()];e.properties[i]=n}}var N3=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(VAe,this,t),this.length=this._features.length}getGeoJSONFeature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let t=this._pbf.readVarint()+this._pbf.pos;return new Dm(this._pbf,t,this.extent,this._keys,this._values)}getBinaryFeature(e,t){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let i=this._pbf.readVarint()+this._pbf.pos;return new Dm(this._pbf,i,this.extent,this._keys,this._values,t)}};function VAe(r,e,t){e&&t&&(r===15?e.version=t.readVarint():r===1?e.name=t.readString():r===5?e.extent=t.readVarint():r===2?e._features.push(t.pos):r===3?e._keys.push(t.readString()):r===4&&e._values.push(jAe(t)))}function jAe(r){let e=null,t=r.readVarint()+r.pos;for(;r.pos<t;){let i=r.readVarint()>>3;e=i===1?r.readString():i===2?r.readFloat():i===3?r.readDouble():i===4?r.readVarint64():i===5?r.readVarint():i===6?r.readSVarint():i===7?r.readBoolean():null}return e}var sx=class{layers;constructor(e,t){this.layers=e.readFields(GAe,{},t)}};function GAe(r,e,t){if(r===3&&t){let i=new N3(t,t.readVarint()+t.pos);i.length&&e&&(e[i.name]=i)}}function SM(r,e){let t=WAe(e),i=e?.gis?.format||e?.mvt?.shape||e?.shape;switch(i){case"columnar-table":return{shape:"columnar-table",data:TM(r,t)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:aG(r,t)};case"geojson":return aG(r,t);case"binary-geometry":return TM(r,t);case"binary":return TM(r,t);default:throw new Error(i||"undefined shape")}}function TM(r,e){let[t,i]=HAe(r,e),n=_M(t,i);return n.byteLength=r.byteLength,n}function HAe(r,e){let t=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(r.byteLength<=0)return[t,i];let n=new sx(new EM.default(r));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(n.layers)).forEach(a=>{let c=n.layers[a];if(c)for(let d=0;d<c.length;d++){let p=c.getBinaryFeature(d,i),b=qAe(p,e,a);t.push(b)}}),[t,i]}function aG(r,e){if(r.byteLength<=0)return[];let t=[],i=new sx(new EM.default(r));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{let a=i.layers[s];if(a)for(let c=0;c<a.length;c++){let d=a.getGeoJSONFeature(c),p=$Ae(d,e,s);t.push(p)}}),t}function WAe(r){if(!r?.mvt)throw new Error("mvt options required");if(r.mvt?.coordinates==="wgs84"&&!r.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return r.gis&&Mg.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')(),r.mvt}function $Ae(r,e,t){let i=r.toGeoJSONFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&(i.properties||={},i.properties[e.layerProperty]=t),i}function qAe(r,e,t){let i=r.toBinaryFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=t),i}var ZAe="4.3.2",z3={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:ZAe,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}},XAe={...z3,parse:async(r,e)=>SM(r,e),parseSync:SM,binary:!0};var YAe={Point:lG,MultiPoint:KAe,LineString:cG,MultiLineString:QAe,Polygon:uG,MultiPolygon:JAe};function lG([r,e],[t,i],n){let s=wo(t[0],i[0],r),a=wo(t[1],i[1],e);return n.unprojectFlat([s,a])}function CM(r,e,t){return r.map(i=>lG(i,e,t))}function KAe(r,e,t){return CM(r,e,t)}function cG(r,e,t){return CM(r,e,t)}function QAe(r,e,t){return r.map(i=>cG(i,e,t))}function uG(r,e,t){return r.map(i=>CM(i,e,t))}function JAe(r,e,t){return r.map(i=>uG(i,e,t))}function hG(r,e,t){let i=t.projectFlat([e.west,e.north]),n=t.projectFlat([e.east,e.south]),s=[i,n];return{...r,coordinates:YAe[r.type](r.coordinates,s,t)}}var e0e=["points","lines","polygons"];function IM(r,e,t,i){for(let n of e0e){let s=r[n]&&t0e(r[n],e,t,i);if(s>=0)return s}return-1}function t0e(r,e,t,i){let n=r.featureIds.value;if(!n.length)return-1;let s=0,a=n[n.length-1]+1;if(i){let d=r0e(r,i);if(d)s=d[0],a=d[1]+1;else return-1}let c=-1;if(e in r.numericProps){let d=r.numericProps[e].value.findIndex((p,b)=>p===t&&n[b]>=s&&n[b]<a);return d>=0?r.globalFeatureIds.value[d]:-1}else e?c=fG(r.properties,d=>d[e]===t,s,a):r.fields&&(c=fG(r.fields,d=>d.id===t,s,a));return c>=0?i0e(r,c):-1}function r0e(r,e){if(!r.__layers){let t={},{properties:i}=r;for(let n=0;n<i.length;n++){let{layerName:s}=i[n];s&&(t[s]?t[s][1]=n:t[s]=[n,n])}r.__layers=t}return r.__layers[e]}function i0e(r,e){if(!r.__ids){let t=[],i=r.featureIds.value,n=r.globalFeatureIds.value;for(let s=0;s<i.length;s++)t[i[s]]=n[s];r.__ids=t}return r.__ids[e]}function fG(r,e,t,i){for(let n=t;n<i;n++)if(e(r[n],n))return n;return-1}var PM=512,n0e={...Hp.defaultProps,data:cd,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[z3],binary:!0},ox=class extends Yp{initializeState(){super.initializeState();let e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:t,context:i,changeFlags:n}){n.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:t,context:i,changeFlags:n}),this._setWGS84PropertyForTiles());let{highlightColor:s}=e;s!==t.highlightColor&&Array.isArray(s)&&this.setState({highlightColor:s})}async _updateTileData(){let e=this.props.data,t=null;if(typeof e=="string"&&!UI(e)){let{onDataLoad:i,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{t=await n(e,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),e=null}i&&i(t,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(t=e);t&&(e=t.tiles),this.setState({data:e,tileJSON:t})}_getTilesetOptions(){let e=super._getTilesetOptions(),t=this.state.tileJSON,{minZoom:i,maxZoom:n}=this.props;return t&&(Number.isFinite(t.minzoom)&&t.minzoom>i&&(e.minZoom=t.minzoom),Number.isFinite(t.maxzoom)&&(!Number.isFinite(n)||t.maxzoom<n)&&(e.maxZoom=t.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){let{data:t,binary:i}=this.state,{index:n,signal:s}=e,a=Iu(t,e);if(!a)return Promise.reject("Invalid URL");let c=this.getLoadOptions(),{fetch:d}=this.props;return c={...c,mimeType:"application/x-protobuf",mvt:{...c?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:i?{format:"binary"}:{}},d(a,{propName:"data",layer:this,loadOptions:c,signal:s})}renderSubLayers(e){let{x:t,y:i,z:n}=e.tile.index,s=Math.pow(2,n),a=PM/s,c=-a,d=PM*t/s,p=PM*(1-i/s),b=new vr().scale([a,c,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=b,e.coordinateOrigin=[d,p,0],e.coordinateSystem=br.CARTESIAN,e.extensions=[...e.extensions||[],new AM]);let T=super.renderSubLayers(e);return this.state.binary&&!(T instanceof Hp)&&cr.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),T}_updateAutoHighlight(e){let{uniqueIdProperty:t}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:n}=this.state,s=e.object,a=null,c=null;s&&(a=MM(s,t),c=dG(s));let{highlightColor:d}=this.props;typeof d=="function"&&(d=d(e)),(i!==a||n!==c)&&this.setState({highlightColor:d,hoveredFeatureId:a,hoveredFeatureLayerName:c})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){let t=super.getPickingInfo(e);if(this.state.binary&&t.index!==-1){let{data:i}=e.sourceLayer.props;t.object=D3(i,{globalFeatureId:t.index})}return t.object&&!this._isWGS84()&&(t.object=AG(t.object,t.tile.bbox,this.context.viewport)),t}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){let{hoveredFeatureId:t,hoveredFeatureLayerName:i,binary:n}=this.state,{uniqueIdProperty:s,highlightedFeatureId:a}=this.props,c=e.content,d=pG(a);if(!(pG(t)||d))return-1;let b=d?a:t;return Array.isArray(c)?c.findIndex(T=>{let B=MM(T,s)===b,z=d||dG(T)===i;return B&&z}):c&&n?IM(c,s,b,d?"":i):-1}_pickObjects(e){let{deck:t,viewport:i}=this.context,n=i.width,s=i.height,a=i.x,c=i.y,d=[this.id];return t.pickObjects({x:a,y:c,width:n,height:s,layerIds:d,maxObjects:e})}getRenderedFeatures(e=null){let t=this._pickObjects(e),i=new Set,n=[];for(let s of t){let a=MM(s.object,this.props.uniqueIdProperty);a===void 0?n.push(s.object):i.has(a)||(i.add(a),n.push(s.object))}return n}_setWGS84PropertyForTiles(){let e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];let{bbox:n}=i;if(i._contentWGS84===void 0&&VI(n)){let s=this.state.binary?D3(i.content):i.content;i._contentWGS84=s.map(a=>AG(a,n,this.context.viewport))}return i._contentWGS84}})})}};ox.layerName="MVTLayer";ox.defaultProps=n0e;var mG=ox;function MM(r,e){if(r.properties&&e)return r.properties[e];if("id"in r)return r.id}function dG(r){return r.properties?.layerName||null}function pG(r){return r!=null&&r!==""}function AG(r,e,t){let i={...r,geometry:{type:r.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>hG(r.geometry,e,t).coordinates}),i}var gG="0123456789bcdefghjkmnpqrstuvwxyz",_G={};for(let r=0;r<gG.length;r++)_G[gG.charAt(r)]=r;var s0e=-90,o0e=90,a0e=-180,l0e=180;function c0e(r){let e=!0,t=o0e,i=s0e,n=l0e,s=a0e,a,c=0;for(let d=0,p=r.length;d<p;d++){let b=r[d].toLowerCase();c=_G[b];for(let T=4;T>=0;T--){let B=c>>T&1;e?(a=(n+s)/2,B===1?s=a:n=a):(a=(t+i)/2,B===1?i=a:t=a),e=!e}}return[i,s,t,n]}function yG(r){let[e,t,i,n]=c0e(r);return[n,i,n,e,t,e,t,i,n,i]}var u0e={getGeohash:{type:"accessor",value:r=>r.geohash}},ax=class extends Eu{indexToBounds(){let{data:e,getGeohash:t}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>yG(t(i,n))}}};ax.layerName="GeohashLayer";ax.defaultProps=u0e;var xG=ax;var h0e=new bu({layers:Object.assign(Object.assign(Object.assign({},rI),hI),RM)}),bG=new V0({configuration:h0e});var f0e=function(r,e,t,i){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function c(b){try{p(i.next(b))}catch(T){a(T)}}function d(b){try{p(i.throw(b))}catch(T){a(T)}}function p(b){b.done?s(b.value):n(b.value).then(c,d)}p((i=i.apply(r,e||[])).next())})},d0e=new EB;km.default.addProtocol("pmtiles",d0e.tile);km.default.MapTilerGeocodingControl=$x;var p0e=["addControl","addImage","addTooltip","addMapboxOverlay","setCenterFromPMTiles"];function A0e(r,e){let t=r.properties;return e?uB.render(e,t):Object.keys(t).map(i=>`${i}: ${t[i]}`).join("</br>")}var lx=class{constructor(e,t,i){this._model=i,t.container=e,this._map=new km.default.Map(t)}getMap(){return this._map}getElement(){return this._map.getContainer()}getAnywidgetModel(){return this._model}executeCall(e,t){if(p0e.includes(e)){this[e](...t);return}if(this._map[e]instanceof Function){this._map[e](...t);return}console.log("NOT IMPLEMENTED")}addControl(e,t,i){this._map.addControl(new km.default[e](t),i)}addImage(e,t,i){return f0e(this,void 0,void 0,function*(){let n=yield this._map.loadImage(t);this._map.addImage(e,n.data,i)})}addTooltip(e,t){let i=new km.default.Popup({closeButton:!1,closeOnClick:!1});this._map.on("mousemove",e,n=>{let s=n.features[0],a=A0e(s,t);i.setLngLat(n.lngLat).setHTML(a).addTo(this._map)}),this._map.on("mouseleave",e,()=>{i.remove()})}addMapboxlOverlay(e){let t=e.map(bG.convert);this._mapboxOverlay||(this._mapboxOverlay=new zp({interleaved:!0,layers:t}),this._map.addControl(this._mapboxOverlay))}setCenterFromPMTiles(e){new Zx(e).getHeader().then(i=>{this._map.setCenter([i.centerLon,i.centerLat]),this._map.setZoom(i.maxZoom-2)})}};function m0e({model:r,el:e}){console.log("Welcome to maplibre-anywidget v2",e);let t=r.get("height")||"400px",i=document.createElement("div");i.id="maplibre-anywidget",i.style.height=t,i.style.width="100%",e.appendChild(i);let n=r.get("map_options"),s=window.anywidgetMapWidget=new lx(i,n,r),a=s.getMap(),c=()=>r.get("calls"),d=()=>r.get("msg");r.on("change:msg",()=>{let p=d();console.log("run",p);let[b,T]=p;s.executeCall(b,T)}),a.on("load",()=>{console.log("map loaded"),a.resize();for(let p of c()){console.log("init call",p);let[b,T]=p;s.executeCall(b,T)}r.set("load",!0),r.save_changes()})}var aQe={render:m0e};export{aQe as default};
/*! Bundled license information:

maplibre-gl/dist/maplibre-gl.js:
  (**
   * MapLibre GL JS
   * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.3.1/LICENSE.txt
   *)

long/dist/long.js:
  (**
   * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
   * Released under the Apache License, Version 2.0
   * see: https://github.com/dcodeIO/long.js for details
   *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)

long/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)
*/
